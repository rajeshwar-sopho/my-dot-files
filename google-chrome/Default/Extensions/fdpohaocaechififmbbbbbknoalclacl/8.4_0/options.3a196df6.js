(()=>{function e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r={},i={},a=n.parcelRequire60cc;null==a&&((a=function(e){if(e in r)return r[e].exports;if(e in i){var t=i[e];delete i[e];var n={id:e,exports:{}};return r[e]=n,t.call(n.exports,n,n.exports),n.exports}var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){i[e]=t},n.parcelRequire60cc=a),a.register("jQEAy",(function(t,n){e(t.exports,"ERROR_NAME",(()=>s)),e(t.exports,"getZoom",(()=>d)),e(t.exports,"captureVisibleTab",(()=>u)),e(t.exports,"isCaptureVisibleTabQuotaError",(()=>p)),e(t.exports,"sendMessage",(()=>f)),e(t.exports,"getCurrentTab",(()=>h)),e(t.exports,"openInTabs",(()=>m));var r=a("8rN6d"),i=a("8bPtr"),o=a("3k2hL");const s="ChromeTabsError",l=(0,o.genLastErrorFmt)(s),c=(0,o.genWrapError)(s),d=e=>c(chrome.tabs.getZoom(e),"getZoom"),u=(e,t)=>c(chrome.tabs.captureVisibleTab(e,t),"captureVisibleTab"),p=e=>e&&"object"==typeof e&&e.name===s&&"captureVisibleTab"===e.via&&e.message&&-1!==e.message.indexOf("MAX_CAPTURE_VISIBLE_TAB_CALLS_PER_SECOND"),f=(e,t,n)=>new Promise(((r,i)=>{chrome.tabs.sendMessage(e,t,n,(e=>{const t=(0,o.getLastError)();return t?i(l(t,"sendMessage")):r(e)}))})),h=()=>{return(e={active:!0,currentWindow:!0},c(chrome.tabs.query(e),"query")).then((e=>e[0]));var e},m=(g=(0,r.default)((function(e,t){var n,r,a;return(0,i.__generator)(this,(function(i){return n=void 0,r=t.length,[2,(a=i=>{if(i>=t.length)return t;let o=t[i],s=i===r-1;return e.incognito&&0===i?(l={url:o,incognito:!1,focused:s},c(chrome.windows.create(l),"windowsCreate")).then((e=>(n=e.id,a(i+1)))):(e=>c(chrome.tabs.create(e),"create"))({url:o,active:s,windowId:n,openerTabId:e.id,index:(e.incognito?0:e.index)+1+i}).then((e=>a(i+1)));var l})(0)]}))})),function(e,t){return g.apply(this,arguments)});var g}));var o=a("ijcw6");a("7b0kr");var s=a("iiDPj"),l=a("nKr4g"),c=a("kOtTY");const d=()=>{const e=(0,c.getQueryString)(),t=e.id||e.oid,n=e.e,r=e.url;return{options:h(t,n,r),history:m(t,n,r),capture:t?p(t,r):void 0,editor:t&&n?f(t,n,r):void 0}},u=(e,t,n)=>{let r=void 0!==n&&n;if(e){-1===e.href.indexOf("?")&&(e.href=t,r&&e.setAttribute("style",""))}},p=(e,t)=>{let n=void 0===t?null:t;const r={id:e};n&&(r.url=n);return"/capture.html"+("?"+(0,c.toQueryString)(r))},f=(e,t,n)=>{let r=void 0===n?null:n;const i={id:e,e:t};r&&(i.url=r);return"/editor.html"+("?"+(0,c.toQueryString)(i))},h=(e,t,n)=>{let r=void 0===e?null:e,i=void 0===t?null:t,a=void 0===n?null:n,o="";if(r){const e={id:r};i&&(e.e=i),a&&(e.url=a),o="?"+(0,c.toQueryString)(e)}return"/options.html"+o},m=(e,t,n)=>{let r=void 0===e?null:e,i=void 0===t?null:t,a=void 0===n?null:n,o="";if(r){const e={oid:r};i&&(e.e=i),a&&(e.url=a),o="?"+(0,c.toQueryString)(e)}return"/capture.html"+o};var g=a("jBCXK"),v=a("hGGFE"),b=a("ff4Ef"),x=(o=a("ijcw6"),{});
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/!function(){"use strict";var e={}.hasOwnProperty;function t(){for(var n=[],r=0;r<arguments.length;r++){var i=arguments[r];if(i){var a=typeof i;if("string"===a||"number"===a)n.push(i);else if(Array.isArray(i)&&i.length){var o=t.apply(null,i);o&&n.push(o)}else if("object"===a)for(var s in i)e.call(i,s)&&i[s]&&n.push(s)}}return n.join(" ")}x?(t.default=t,x=t):"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],(function(){return t})):window.classNames=t}();var y=a("7b0kr"),w=a("dChev"),E=a("fiP9V"),j=a("crHLg"),k=a("8DwkQ"),S=(a("nKr4g"),a("5Xemj"));var C=a("ceb36"),N=a("h1Khz"),T=a("8ioZ3");let R=null;const L=e=>{let t=void 0!==e&&e;if(null===R){const e=document.createElement("a");e.style.cssText="position: sticky;",R=-1!==e.style.position.indexOf("sticky")}return R&&t&&document.documentElement.classList.add("csspositionsticky"),R};var _=a("2brSn"),F=a("1I2HB"),O=a("8rN6d"),A=a("8bPtr"),I=(l=a("nKr4g"),a("2z2pA"));N=a("h1Khz"),c=a("kOtTY");const z=(e,t)=>{let n,r,i=[];return e.forEach((e=>{e[t]!==r&&(void 0!==n&&i.push(n),r=e[t],n={key:r,vals:[]}),n.vals.push(e)})),n&&n.vals.length&&i.push(n),i},M=e=>{window.clearTimeout(M.timeoutId),(0,c.asArray)(document.querySelectorAll(".notif")).forEach((e=>e.classList.add("hide"))),(0,l.$)(e).classList.remove("hide"),M.timeoutId=window.setTimeout((()=>(0,l.$)(e).classList.add("hide")),2e3)};M.timeoutId=null;const q=(P=(0,O.default)((function(e){var t,n,r;return(0,A.__generator)(this,(function(i){switch(i.label){case 0:return I.default.error("options error",e),[4,N.update(e)];case 1:return i.sent(),t=$("div",{className:"error",textContent:"An error was encountered!  "}),n=(0,c.reportLink)(window.location.href,(0,c.errorToString)(e)),r=$("a",{className:"underline",target:"_blank",rel:"noopener noreferrer",href:n,textContent:"Report issue"}),t.appendChild(r),H(),document.body.appendChild(t),window.scrollTo(0,0),[2]}}))})),function(e){return P.apply(this,arguments)});var P;const H=()=>{(0,c.asArray)(document.querySelectorAll("body > .error")).forEach((e=>{e.parentNode.removeChild(e)}))},$=(e,t)=>{let n=document.createElement(e);return t&&t.style&&(Object.assign(n.style,t.style),delete t.style),Object.assign(n,t),n},W=e=>{switch(e.type){case"checkbox":return e.checked;case"text":case"textarea":case"select-one":return e.value;default:throw new Error(`Unknown input type: ${e.type}`)}};g=a("jBCXK"),a("hGGFE"),b=a("ff4Ef"),o=a("ijcw6");var B=a("3pr9z");y=a("7b0kr");function D(){return D=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},D.apply(null,arguments)}function G(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}y=a("7b0kr"),y=a("7b0kr");var U=(y=a("7b0kr")).useLayoutEffect,K=function(e){var n=t(y).useRef(e);return U((function(){n.current=e})),n},Q=(y=a("7b0kr"),function(e,t){"function"!=typeof e?e.current=t:e(t)}),V=function(e,n){var r=t(y).useRef();return t(y).useCallback((function(t){e.current=t,r.current&&Q(r.current,null),r.current=n,n&&Q(n,t)}),[n])},X={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},Z=function(e){Object.keys(X).forEach((function(t){e.style.setProperty(t,X[t],"important")}))},Y=null,J=function(e,t){var n=e.scrollHeight;return"border-box"===t.sizingStyle.boxSizing?n+t.borderSize:n-t.paddingSize};var ee=function(){},te=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],ne=!!document.documentElement.currentStyle,re=function(e){var t=window.getComputedStyle(e);if(null===t)return null;var n,r=(n=t,te.reduce((function(e,t){return e[t]=n[t],e}),{})),i=r.boxSizing;return""===i?null:(ne&&"border-box"===i&&(r.width=parseFloat(r.width)+parseFloat(r.borderRightWidth)+parseFloat(r.borderLeftWidth)+parseFloat(r.paddingRight)+parseFloat(r.paddingLeft)+"px"),{sizingStyle:r,paddingSize:parseFloat(r.paddingBottom)+parseFloat(r.paddingTop),borderSize:parseFloat(r.borderBottomWidth)+parseFloat(r.borderTopWidth)})};function ie(e,t,n){var r=K(n);y.useLayoutEffect((function(){var n=function(e){return r.current(e)};if(e)return e.addEventListener(t,n),function(){return e.removeEventListener(t,n)}}),[])}var ae=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],oe=function(e,t){var n=e.cacheMeasurements,r=e.maxRows,i=e.minRows,a=e.onChange,o=void 0===a?ee:a,s=e.onHeightChange,l=void 0===s?ee:s,c=G(e,ae),d=void 0!==c.value,u=y.useRef(null),p=V(u,t),f=y.useRef(0),h=y.useRef(),m=function(){var e=u.current,t=n&&h.current?h.current:re(e);if(t){h.current=t;var a=function(e,t,n,r){void 0===n&&(n=1),void 0===r&&(r=1/0),Y||((Y=document.createElement("textarea")).setAttribute("tabindex","-1"),Y.setAttribute("aria-hidden","true"),Z(Y)),null===Y.parentNode&&document.body.appendChild(Y);var i=e.paddingSize,a=e.borderSize,o=e.sizingStyle,s=o.boxSizing;Object.keys(o).forEach((function(e){var t=e;Y.style[t]=o[t]})),Z(Y),Y.value=t;var l=J(Y,e);Y.value=t,l=J(Y,e),Y.value="x";var c=Y.scrollHeight-i,d=c*n;"border-box"===s&&(d=d+i+a),l=Math.max(d,l);var u=c*r;return"border-box"===s&&(u=u+i+a),[l=Math.min(u,l),c]}(t,e.value||e.placeholder||"x",i,r),o=a[0],s=a[1];f.current!==o&&(f.current=o,e.style.setProperty("height",o+"px","important"),l(o,{rowHeight:s}))}};return y.useLayoutEffect(m),function(e,t){ie(document.body,"reset",(function(n){e.current.form===n.target&&t(n)}))}(u,(function(){if(!d){var e=u.current,t=e.value;requestAnimationFrame((function(){t!==e.value&&m()}))}})),ie(window,"resize",m),function(e){ie(document.fonts,"loadingdone",e)}(m),y.createElement("textarea",D({},c,{onChange:function(e){d||m(),o(e)},ref:p}))},se=y.forwardRef(oe),le=(g=a("jBCXK"),v=a("hGGFE"),o=a("ijcw6"),y=a("7b0kr"),a("5Gpcw"));const ce=e=>{let t=e.text,n=e.cta1,r=e.cta1LinkFn,i=e.cta2,a=e.cta2LinkFn,s=e.isShow,l=e.setShow,c=e.setHide,d=e.userId;const u="premium-cta",p=s?{onClick:c}:{onMouseEnter:l,onClick:l,onFocus:l};return(0,y.useEffect)((()=>{let e,t;return s&&(e=e=>{!!e.target.closest(`.${u}`)||c()},t=e=>{27===e.keyCode&&c()},document.documentElement.addEventListener("click",e,!1),document.documentElement.addEventListener("keyup",t,!1)),()=>{e&&document.documentElement.removeEventListener("click",e,!1),t&&document.documentElement.removeEventListener("keyup",t,!1)}}),[s,c]),(0,o.jsxs)("span",{className:u,children:[(0,o.jsx)("span",(0,v.default)((0,g.default)({tabIndex:"0",className:"premium-cta--icon"},p),{children:"?"})),s&&(0,o.jsxs)("span",{className:"premium-cta--tooltip",children:[t,!1,n&&r&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("br",{}),(0,o.jsx)("a",{href:r(),children:n}),!d&&i&&a&&(0,o.jsxs)(o.Fragment,{children:[" or ",(0,o.jsx)("a",{href:a(),children:i})]})]})]})]})};ce.displayName="PremiumCta";var de=ce;const ue=e=>{let n=e.field,r=e.value,i=e.onChange,a=e.isSubOk,s=e.userId;const l=n.premiumInfo,c=!a&&!!l;c&&(r=l.basicDefault);const d=(0,b.default)((0,y.useState)(!1),2),u=d[0],p=d[1],f=()=>p(!0),h=e=>{const t=e.currentTarget,n=t.name;if(c)f();else{const e=W(t);i(n,e)}};let m;switch(n.type){case"bool":m=(0,o.jsx)("div",{className:"options-ctrl",children:(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{className:"options-input",type:"checkbox",name:n.name,checked:r,onChange:h}),(0,o.jsx)("span",{className:"label-text",children:n.label})]})});break;case"text":m=(0,o.jsxs)("div",{className:"options-ctrl flex-wrapper",children:[(0,o.jsx)("label",{children:n.label}),"textarea"===n.width?(0,o.jsx)(se,{className:"options-input",name:n.name,style:{resize:"none"},value:r,onChange:h}):(0,o.jsx)("input",{className:"options-input",type:"text",name:n.name,value:r,onChange:h,disabled:n.disabled})]});break;case"choice":m=(0,o.jsxs)("div",{className:"options-ctrl flex-wrapper",children:[(0,o.jsx)("label",{children:n.label}),(0,o.jsx)("select",{className:"options-input",name:n.name,value:r,onChange:h,children:n.convertedChoices.map((e=>(0,o.jsx)("option",{value:e.key,children:e.display||e.key},e.key)))})]});break;default:throw new Error(`unsupported type! ${n.type}`)}const w=(0,o.jsxs)("span",{className:"help",children:[n.help&&"function"==typeof n.help?n.help(r):n.help||"",c&&(0,o.jsxs)(o.Fragment,{children:[" ",(0,o.jsx)(de,(0,v.default)((0,g.default)({},l),{isShow:u,setShow:f,setHide:()=>p(!1),userId:s}))]}),(0,o.jsx)("span",{className:"msg"})]});return(0,o.jsxs)("div",{className:t(x)("options-elt",`type-${n.type}`),children:[m,w]})};ue.displayName="OptionField",ue.propTypes={field:t(B).shape({name:t(B).string.isRequired,type:t(B).oneOf(["choice","bool","text"]),group:t(B).string.isRequired,default:t(B).any,label:t(B).string.isRequired,help:t(B).string,validate:t(B).func,hidden:t(B).bool,premiumInfo:t(B).shape({text:t(B).string.isRequired,cta1:t(B).string,cta1LinkFn:t(B).func,cta2:t(B).string,cta2LinkFn:t(B).func,basicDefault:t(B).any.isRequired})}).isRequired,value:t(B).any,onChange:t(B).func.isRequired,isSubOk:t(B).bool.isRequired,userId:t(B).string};var pe=ue,fe=(g=a("jBCXK"),b=a("ff4Ef"),o=a("ijcw6"),y=a("7b0kr"),a("95ETH")),he=(a("5Xemj"),I=a("2z2pA"),a("eW2D8"));fe=a("95ETH"),S=a("5Xemj"),le=a("5Gpcw"),T=a("8ioZ3");const me=[{id:"downloads",perms:fe.PERMISSIONS.DOWNLOADS,name:(0,S.tr)("Downloads permission"),help_text:(0,S.tr)("This permission is required for the download buttons and the auto-download feature."),on_revoke:function(){T.default.remove("auto_dl2")}}];(0,le.noIframes)()||me.push({id:"iframe",perms:he.FRAME_PERMS,permsContains:he.FRAME_PERMS_CONTAINS,name:(0,S.tr)("iFrame permission"),help_html:(0,S.tr)("This permission is required in order to scroll the inner contents of $iframes$ or $framesets$.",null,[],{iframes:{content:'<a class="dim" target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe">iframes</a>',example:"iframes"},framesets:{content:'<a class="dim" target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/frameset">framesets</a>',example:"framesets"}})});o=a("ijcw6");a("7b0kr");fe=a("95ETH");const ge=e=>{let t=e.tog,n=e.value,r=e.onChange;return(0,o.jsxs)("div",{className:"perm-row cb-row",children:[(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{className:"cb-input",type:"checkbox",name:t.id,checked:n||!1,disabled:void 0===n,onChange:e=>{e.currentTarget.checked?fe.request(t.perms).then((e=>{e?(M("notif-sav"),r(t.id,!0)):M("notif-err")})).catch(q):fe.remove(t.perms).then((e=>{e?(t.on_revoke&&t.on_revoke(),M("notif-sav"),r(t.id,!1)):M("notif-err")})).catch(q)}}),(0,o.jsx)("span",{className:"cb-text",children:t.name})]}),t.help_text?(0,o.jsx)("div",{className:"cb-help",children:t.help_text}):t.help_html?(0,o.jsx)("div",{className:"cb-help",dangerouslySetInnerHTML:{__html:t.help_html}}):null]})};ge.displayName="ToggleElt";var ve=ge;const be=()=>{const e=(0,b.default)((0,y.useState)({}),2),n=e[0],r=e[1],i=(0,b.default)((0,y.useState)(!1),2),a=i[0],s=i[1],l=e=>r((t=>(0,g.default)({},t,e)));(0,y.useEffect)((()=>{me.map((e=>{fe.contains(e.permsContains||e.perms).then((t=>{l({[e.id]:t})})).catch((e=>I.default.error(e)))}))}),[]);const c=(e,t)=>{l({[e]:t})};return(0,o.jsxs)("div",{className:"container",id:"perm-settings-container",children:[(0,o.jsx)("p",{children:(0,o.jsx)("a",{href:"",className:"perm-header dim",id:"perm-toggle",onClick:e=>{e.preventDefault(),s(!a)},children:(0,o.jsxs)("strong",{children:[(0,S.tr)("Permissions"),(0,o.jsx)("span",{className:t(x)("arrow",{"pe-7s-angle-down":!a,"pe-7s-angle-up":a})})]})})}),a&&(0,o.jsxs)("div",{id:"perm-content",children:[(0,o.jsx)("p",{children:(0,S.tr)("Any optional permissions that were previously granted will appear checked here. You can revoke them at any time. If they are needed again in the future, they will be re-requested.")}),me.map((e=>(0,o.jsx)(ve,{tog:e,value:n[e.id],onChange:c},e.id)))]})]})};be.displayName="ToggleElts";var xe=be;const ye=()=>{const e=(0,b.default)((0,y.useState)(null),2),n=e[0],r=e[1],i=(0,b.default)((0,y.useState)({}),2),a=i[0],s=i[1],c=(0,b.default)((0,y.useState)(null),2),d=c[0],u=c[1],p=e=>r((t=>(0,g.default)({},t,e)));(0,y.useEffect)((()=>{C.default.pageview(),L(!0),(0,S.updateHtml)(),N.update(),Array.prototype.slice.call(document.querySelectorAll("a[data-href]")).forEach((e=>{e.href=e.dataset.href})),(0,l.$)("version-num").innerText=(0,F.getVersion)();const e=(0,j.makeLoginUrl)();l.$.findClass("account-url").forEach((t=>{t.setAttribute("href",e),t.style.display=""})),w.default.loginStateProm(!0).then((e=>{u(e)})),T.default.onUpdate((e=>{const t={};e.forEach((e=>{t[e]=T.default.state[e]})),p(t)})),T.default.load().then((e=>{r(e)}))}),[]),(0,y.useEffect)((()=>{if(k.REGISTER_SELF_URL){const e=document.getElementById("opts-menu-right");e||alert("Missing opts-menu-right wrapper!");const t=document.createElement("a");Object.assign(t.style,{display:"inline-block",marginRight:"20px",color:"#ef4444"}),t.textContent="Connect backend",t.target="_blank",t.href=`${k.REGISTER_SELF_URL}?id=${encodeURIComponent(chrome.runtime.id)}`,e.prepend(t),t.addEventListener("click",(e=>{e.shiftKey&&window.setTimeout((()=>{t.parentNode.removeChild(t)}))}),!1)}}),[]);const f=(e,t)=>{const n=T.default.getField(e);let r="";var i,o;n.process&&(i=n.process(t),t=i.val,r=i.msg),r&&a[e]!==r&&(o={[e]:r},s((e=>(0,g.default)({},e,o))));(n.validate||_.PromiseTrue)(t).then((n=>n?(p({[e]:t}),T.default.set(e,t).then((()=>{M("notif-sav")}))):void 0)).catch((e=>{q(e)}))};if(!n)return(0,o.jsx)("div",{className:"container",id:"settings-container",children:(0,S.tr)("loading…")});const h=d&&d.userId||null,m=!!d&&"sub-ok"===d.subState,R=d&&d.store&&d.store.show_experimental||!1,O=z(Object.entries(T.default.fields).map((e=>{let t=(0,b.default)(e,2),r=t[0],i=t[1];return(0,E.isFieldHidden)(i,m,n)?null:(0,v.default)((0,g.default)({},i),{name:r})})).filter((e=>e)),"group");return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"container",id:"settings-container",children:O.map(((e,r)=>{let i=e.key,a=e.vals;return(0,o.jsxs)("div",{className:"options-group",children:[(0,o.jsx)("h3",{children:i}),(0,o.jsx)("div",{className:t(x)("options-list",{last:r===O.length-1}),children:a.map((e=>e.experimental&&!R?null:(0,o.jsx)(pe,{field:e,value:n[e.name],onChange:f,userId:h,isSubOk:m},e.name)))})]},i)}))}),(0,o.jsx)(xe,{})]})};ye.displayName="App";var we=ye;!function(){const e=d(),t=e.editor||e.capture||e.history;t&&l.$.findClass("back-button").forEach((e=>{-1===e.getAttribute("href").indexOf("?")&&(e.removeAttribute("data-href"),e.href=t)})),u((0,l.$)("btn-settings"),e.options),u((0,l.$)("btn-history"),e.history)}(),(0,s.render)((0,o.jsx)(we,{}),document.getElementById("root"))})();
//# sourceMappingURL=options.3a196df6.js.map
