"use strict";(self.webpackChunkextension=self.webpackChunkextension||[]).push([[2408],{98474:(e,n,t)=>{t.r(n),t.d(n,{default:()=>W});var o=t(7527),r=t(75087),i=t(22155),l=t(50122),u=t(30395),a=t.n(u),s=t(66007),c=t(24481),d=t(17398),m=(0,i.createContext)({mutateComment:null}),f=i.createElement;function p(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function v(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?p(Object(t),!0).forEach((function(n){(0,l.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function h(e,n){var t,r=e.post,l=e.initialContent,u=e.replyTo,p=e.editCommentId,h=e.className,b=void 0===h?{}:h,y=e.style,g=e.onChange,C=e.showSubmit,w=void 0===C||C,O=e.showUserAvatar,x=void 0===O||O,I=e.formProps,S=void 0===I?{}:I,P=e.onClose,j=null==r?void 0:r.id,A=null==r||null===(t=r.source)||void 0===t?void 0:t.id,N=(0,i.useRef)(),k=(0,i.useContext)(m).mutateComment,T=k.mutateComment,E=k.isLoading,R=k.isSuccess;return(0,i.useEffect)((function(){var e;null==N||null===(e=N.current)||void 0===e||null===(e=e.textareaRef)||void 0===e||null===(e=e.current)||void 0===e||e.focus()}),[]),f("form",(0,o.A)({},S,{action:"#",onSubmit:function(e){if(e.preventDefault(),E||R)return null;var n=(0,d.Y)(e.currentTarget).content;return T(n)},className:null==b?void 0:b.container,style:y,ref:n}),f(c.A,{ref:N,className:{tab:a()("!min-h-16",null==b?void 0:b.tab),input:a()(null==b?void 0:b.input,u&&"mt-0"),profile:u&&"!mt-0",container:null==b?void 0:b.markdownContainer},postId:j,sourceId:A,showUserAvatar:x,isLoading:E,disabledSubmit:R,initialContent:l,textareaProps:{name:"content",rows:7,placeholder:"Share your thoughts"},onSubmit:function(e){if(E||R)return null;var n=e.currentTarget.value;return T(n)},enabledCommand:v(v({},s.RS),{},{upload:!0}),submitCopy:w&&(p?"Update":"Comment"),timeline:u?f("span",{className:"py-2 pl-12 text-text-tertiary typo-caption1"},"Reply to",f("span",{className:"ml-2 font-bold text-text-primary"},u)):null,onValueUpdate:g,onClose:P}))}var b=(0,i.forwardRef)(h),y=t(72870),g=t(89338),C=t(2827),w=t.n(C),O=t(69918),x=t(94198),I=t(15751),S=t(92203),P=t(5947),j=t(99604),A=t(57952),N=t(11924),k=t(30530),T=t(51722),E=t(61663),R=t(91201),D=t(80244);function M(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function q(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?M(Object(t),!0).forEach((function(n){(0,l.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):M(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var U=function(e){var n,t=e.post,o=e.editCommentId,r=e.parentCommentId,l=e.onCommented,u=null==t||null===(n=t.source)||void 0===n?void 0:n.id,a=null==t?void 0:t.id,s=null!=r?r:a,c=(0,D.Z2)().user,d=(0,O.jE)(),m=(0,R.D)(),f=m.requestMethod,p=m.isCompanion,v=(0,E.DX)().logEvent,h=(0,i.useMemo)((function(){return k.$h.apply(void 0,[k.jZ.PostCommentsMutations,c].concat((0,S.A)([a,u,o,r].filter((function(e){return!!e})))))}),[c,a,u,o,r]),b=function(e){if(e){var n=function(n){if(!n)return n;var t=structuredClone(n);if(!o){var i=function(e){return{node:q(q({},e),{},{children:{edges:[],pageInfo:null}})}}(e);if(!r)return t.postComments.edges.unshift(i),t;var l=t.postComments.edges.findIndex((function(e){return e.node.id===r}));return t.postComments.edges[l].node.children.edges.push(i),t}if(!r){var u=t.postComments.edges.findIndex((function(e){return e.node.id===o}));return t.postComments.edges[u].node=q(q({},e),{},{children:t.postComments.edges[u].node.children}),t}var a=t.postComments.edges.find((function(e){return e.node.id===r})),s=a.node.children.edges.findIndex((function(e){return e.node.id===o}));return a.node.children.edges[s].node=q(q({},e),{},{children:a.node.children}),t},i=[];(0,k.w$)(a).forEach((function(e){d.setQueryData(e,(function(t){return t?n(t):(i.push(e),null)}))})),i.forEach(function(){var e=(0,g.A)(w().mark((function e(n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.invalidateQueries({queryKey:n});case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),o||((0,k.kh)(d,a,{numComments:t.numComments+1}),v((0,N.P5)(A.VB.CommentPost,t,{extra:{commentId:r}}))),l&&l(e,!o,r)}},y=r?j.Uk:j.Fe,C=(0,P.n)({mutationFn:function(e){return f(y,e,{requestKey:JSON.stringify(h)})},onSuccess:function(e){return b(null==e?void 0:e.comment)}}),x=C.mutateAsync,I=C.isPending,M=C.isSuccess;(0,T.X)(h,{enabled:p,callback:function(e){var n=e.res;return b(null==n?void 0:n.comment)}});var U=(0,P.n)({mutationFn:function(e){return f(j.fK,e,{requestKey:JSON.stringify(h)})},onSuccess:function(e){return b(null==e?void 0:e.comment)}}),F=U.mutateAsync,L=U.isPending;return{mutateComment:(0,i.useCallback)((function(e){return o?F({id:o,content:e}):x({content:e,id:s})}),[o,s,F,x]),isLoading:I||L,isSuccess:M}},F=t(4004),L=function(){var e,n,t,o;return{width:null!==(e=null===globalThis||void 0===globalThis||null===(n=globalThis.window)||void 0===n||null===(n=n.visualViewport)||void 0===n?void 0:n.width)&&void 0!==e?e:0,height:null!==(t=null===globalThis||void 0===globalThis||null===(o=globalThis.window)||void 0===o||null===(o=o.visualViewport)||void 0===o?void 0:o.height)&&void 0!==t?t:0}},V=function(){var e,n=(0,i.useState)(L),t=n[0],o=n[1];return(0,F.M)(null===globalThis||void 0===globalThis||null===(e=globalThis.window)||void 0===e?void 0:e.visualViewport,"resize",(function(){return o(L)})),t},$=t(57434),B=t(68334),H=t(91480),K=t(86242),Q=i.createElement;function Z(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return _(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,l=!0,u=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return l=e.done,e},e:function(e){u=!0,i=e},f:function(){try{l||null==t.return||t.return()}finally{if(u)throw i}}}}function _(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,o=Array(n);t<n;t++)o[t]=e[t];return o}var z=function(e,n){var t,o;if(null!=e&&null!==(t=e.postComments)&&void 0!==t&&t.edges){var r,i=Z(null==e||null===(o=e.postComments)||void 0===o?void 0:o.edges);try{for(i.s();!(r=i.n()).done;){var l=r.value;if(l.node.id===n)return l.node;if(l.node.children){var u,a=Z(l.node.children.edges);try{for(a.s();!(u=a.n()).done;){var s=u.value;if(s.node.id===n)return s.node}}catch(e){a.e(e)}finally{a.f()}}}}catch(e){i.e(e)}finally{i.f()}}},J=function(e){var n=e.client,t=e.postId,o=e.commentId;if(o){var r,i=Z((0,k.w$)(t));try{for(i.s();!(r=i.n()).done;){var l=r.value,u=z(n.getQueryData(l),o);if(u)return u}}catch(e){i.e(e)}finally{i.f()}}};function X(e){var n,t,o,r,l,u,s,c,d,f,p=e.isOpen,v=e.onRequestClose,h=e.onAfterClose,y=e.onCommented,C=e.parentCommentId,S=e.replyToCommentId,P=e.editCommentId,j=e.post,N=(0,i.useRef)(null),k=(0,i.useRef)(null),T=(0,i.useRef)(null),E=(0,i.useRef)(null),R=(0,D.Z2)().user,M=(0,O.jE)(),q=(0,i.useState)(null),F=q[0],L=q[1],Z=!!P,_=!Z&&!!S,z=(0,K.A)({id:P,options:{enabled:!!P}}).comment,X=(0,i.useCallback)((function(e){e&&L(e)}),[L]),G=(0,$.$)({source:A.vH.NewComment}),Y=G.shouldShowCta,W=G.isEnabled,ee=G.onToggle,ne=G.onSubmitted,te=(0,i.useMemo)((function(){return J({client:M,postId:null==j?void 0:j.id,commentId:Z?P:null!=S?S:C})}),[M,null==j?void 0:j.id,Z,P,C,S]),oe=U({post:j,editCommentId:Z&&P,parentCommentId:C,onCommented:function(e,n,t){y&&y(e,n,t),v()}}),re=oe.isLoading,ie=oe.isSuccess;(0,i.useLayoutEffect)((function(){var e;null==F||null===(e=F.scrollTo)||void 0===e||e.call(F,{behavior:"auto",top:1e4})}),[F]);var le=V().height,ue=null!==(n=null===(t=T.current)||void 0===t?void 0:t.clientHeight)&&void 0!==n?n:0,ae=null!==(o=null===(r=E.current)||void 0===r?void 0:r.clientHeight)&&void 0!==o?o:0,se=le-(null!==(l=null===(u=k.current)||void 0===u?void 0:u.offsetHeight)&&void 0!==l?l:0)-ue-ae,ce=se>0?Math.max(se,300):"auto";N.current&&(null===(s=N.current.style)||void 0===s?void 0:s.height)!=="".concat(ce,"px")&&(N.current.style.height="".concat(ce,"px"));var de,me=(0,i.useMemo)((function(){return Z?{submitCopy:"Save",initialContent:null==z?void 0:z.content}:_?{submitCopy:"Reply",initialContent:null!=te&&null!==(e=te.author)&&void 0!==e&&e.id&&te.author.id!==(null==R?void 0:R.id)?"@".concat(null==te||null===(n=te.author)||void 0===n?void 0:n.username," "):void 0}:{submitCopy:"Comment"};var e,n}),[Z,_,te,z,null==R?void 0:R.id]),fe=me.submitCopy,pe=me.initialContent;return Q(x.aF,{isOpen:p,onRequestClose:v,onAfterClose:h,className:"!border-none",overlayClassName:"!touch-none"},Q(x.aF.Body,{className:"!p-0",ref:X},Q(m.Provider,{value:{mutateComment:oe}},Q(I._,{form:"write-comment",copy:{right:fe},leftButtonProps:{onClick:v},rightButtonProps:{onClick:(de=(0,g.A)(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ne();case 2:case"end":return e.stop()}}),e)}))),function(){return de.apply(this,arguments)}),loading:re,disabled:ie},className:{container:"flex-1 first:!border-none",header:"sticky top-0 z-2 w-full bg-background-default"},headerRef:k},_&&te&&Q(i.Fragment,null,Q(H.A,{post:j,comment:te,className:{container:"mx-4 mt-4 border"},postAuthorId:null==j||null===(c=j.author)||void 0===c?void 0:c.id,postScoutId:null==j||null===(d=j.scout)||void 0===d?void 0:d.id}),Q("div",{className:"ml-12 flex gap-2 border-l border-border-subtlest-tertiary py-3 pl-5 text-text-tertiary typo-caption1",ref:T},"Reply to",Q("span",{className:"font-bold text-text-primary"},null===(f=te.author)||void 0===f?void 0:f.username))),Q(b,{ref:N,replyTo:null,post:j,parentCommentId:C,editCommentId:Z&&P,initialContent:pe,className:{markdownContainer:"flex-1",container:a()("flex flex-col",_?"h-[calc(100%-2.5rem)]":"h-full"),tab:"flex-1",input:"comment-input-123 !max-h-none flex-1"},showSubmit:!1,showUserAvatar:!1,formProps:{id:"write-comment"}}),Y&&Q(B.d,{inputId:"push_notification-switch",name:"push_notification",labelClassName:"flex-1 font-normal",className:"px-3 py-3.5",compact:!1,checked:W,onToggle:ee,ref:E},"Receive updates when other members engage")))))}var G=["onClose","className"],Y=i.createElement;function W(e){var n=e.onClose,t=e.className,i=(0,r.A)(e,G),l=!(0,y.G6)(y.bh.Tablet),u=U({post:i.post,editCommentId:i.editCommentId,parentCommentId:i.parentCommentId,onCommented:i.onCommented});return l?Y(X,(0,o.A)({},i,{isOpen:!0,onRequestClose:n})):Y(m.Provider,{value:{mutateComment:u}},Y(b,(0,o.A)({},i,{className:t.input,onClose:n})))}}}]);