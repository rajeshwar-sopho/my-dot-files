var browser=browser||chrome;
function getData(){window.escapeispy||(document.body.addEventListener("keydown",function(a){27===a.keyCode&&browser.runtime.sendMessage({action:"abortRetrieval"})}),window.escapeispy=!0);var c=document.getElementsByClassName("olpOffer");0==c.length&&(console.log("using #aod-offer selector"),c=document.querySelectorAll("#aod-pinned-offer, #aod-offer"));var a=window.location.href;-1!=a.indexOf("http%3A%2F%2F")&&(a=decodeURIComponent(a.substr(a.indexOf("http%3A%2F%2F"),a.length)));var b=/\/offer-listing\/([^/]+)\/*/.exec(a);
if(b)var d=b[1];else if(b=/\/gp\/aw\/ol\/([^/]+)\/*/.exec(a))d=b[1];else if(b=/dp\/([^?]+)/.exec(a))d=b[1].split(/[?#]/)[0],d=b[1].split(/[\/]/)[0];10<d.length&&(b=/B[0-9]{2}[0-9A-Z]{7}|[0-9]{9}(X|[0-9])/.exec(a))&&(d=b[0]);b={};b.asin=d;b.url=a;b.domain=get_domain_from_url(a);b.results=[];if(a=document.getElementsByName("session-id")[0])b.sessionId=a.value;if(0<c.length)for(a=0;a<c.length;a++)b.results.push(c[a].innerHTML);c=document.getElementsByClassName("olpSecondaryPage");if(0<c.length)for(a=
0;a<b.results.length;a++)b.results[a]+=c[a].innerHTML;return b}function get_domain_from_url(c){var a=document.createElement("a");a.setAttribute("href",c);return a.hostname}
if(null==document.getElementById("phLoadingDiv")){var div=document.createElement("div");div.setAttribute("id","phLoadingDiv");div.setAttribute("class","phloading");div.innerHTML='<svg class="phspinner" width="180px" height="180px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg"><circle class="path" fill="none" stroke-width="4" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg>';document.body.appendChild(div)}var firstOffer=document.querySelector("#aod-pinned-offer");
if(firstOffer&&0<firstOffer.clientHeight||-1<window.location.href.indexOf("gp"))document.getElementById("phLoadingDiv").setAttribute("class","phloading"),browser.runtime.sendMessage({action:"getData",source:getData(document)});else{var link=document.querySelector("[data-action='show-all-offers-display']");link&&link.click();browser.runtime.sendMessage({action:"ENABLE_ISPY",source:getData(document)})};
