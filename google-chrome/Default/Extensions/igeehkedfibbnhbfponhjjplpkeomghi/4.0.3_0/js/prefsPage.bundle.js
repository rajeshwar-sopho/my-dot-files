(()=>{var e,t={9315:(e,t,n)=>{const r=n(6516),a=n(504),o=n(2306),i=n(2329),l=n(8950),c=n(3899),s=n(3212),u=n(2221),f=n(4410),m=n(2492),p=n(5744),d=n(6231),b=n(9503),h=n(3682),v=n(3588),g=n(5969),y=n(5923),w=n(3413),E=n(971),S=n(330),x=n(9245),k=n(2827),N=n(3961),O=n(1859),C=n(3870),R=n(7625),T=n(9332),P=n(7017),j=n(9433),A=n(6652),I=n(7457),_=n(542),L=n(8812),V=n(623),H=n(7536),B=n(9789),D=n(8301),M=n(1716),X=n(2782),F=n(4563),z=n(9730);e.exports={parse:l,valid:c,clean:s,inc:u,diff:f,major:m,minor:p,patch:d,prerelease:b,compare:h,rcompare:v,compareLoose:g,compareBuild:y,sort:w,rsort:E,gt:S,lt:x,eq:k,neq:N,gte:O,lte:C,cmp:R,coerce:T,Comparator:P,Range:j,satisfies:A,toComparators:I,maxSatisfying:_,minSatisfying:L,minVersion:V,validRange:H,outside:B,gtr:D,ltr:M,intersects:X,simplifyRange:F,subset:z,SemVer:o,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:a.SEMVER_SPEC_VERSION,RELEASE_TYPES:a.RELEASE_TYPES,compareIdentifiers:i.compareIdentifiers,rcompareIdentifiers:i.rcompareIdentifiers}},6970:(e,t,n)=>{"use strict";var r=n(224),a=n(7810),o=n(1932),i=n(4104),l=n(1580),c=n(5464),s=n(5517),u=n(4560),f=n(958),m=n(8824),p=n(4089),d=(0,u.AH)({width:120,marginLeft:5}),b=(0,u.AH)({width:120,marginLeft:5}),h=(0,u.AH)({marginTop:0,marginBottom:0,marginLeft:0,marginRight:4}),v=(0,u.AH)({marginTop:0,marginBottom:0,marginLeft:0,marginRight:0}),g=(0,u.AH)({marginLeft:8,marginRight:4,marginTop:"auto",marginBottom:"auto"}),y=(0,u.AH)({display:"flex",alignContent:"flex-start"});const w=function(e){var t=e.initialPrefs,n=e.onClose,o=e.onApply,w=e.onSubmit;r.Rm.debug("PreferencesModal: initialPrefs: ",t);var E=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i}((0,a.useState)(t),2),S=E[0],x=E[1],k=function(e){e.keyCode===l.wq?(e.preventDefault(),n()):e.keyCode===l.Ri&&N(e)},N=function(e){e.preventDefault(),w(S)},O=function(e){x(f.pm.update(S,e))},C=Object.keys(s.Z).map((function(e){return a.createElement("option",{key:e,value:e},e)})),R=a.createElement("select",{className:d,name:"theme",value:S.theme,onChange:function(e){O({theme:e.target.value})}},C),T=Object.keys(m.Y).map((function(e){return a.createElement("option",{key:e,value:e},e)})),P=a.createElement("select",{className:d,name:"layout",value:S.layout,onChange:function(e){O({layout:e.target.value})}},T),j=(0,p.Th)(S.fontScaleFactor),A=p.vX.map((function(e){return a.createElement("option",{key:e.toString(),value:e},e.toString())})),I=a.createElement("select",{className:b,name:"fontSize",value:j,onChange:function(e){var t=(0,p.B_)(Number.parseInt(e.target.value));O({fontScaleFactor:t})}},A),_=i.Px;return a.createElement(c.lG,{className:i.Tp,title:"Tabli Preferences",onClose:n},a.createElement(c.nB,null,a.createElement("div",{className:i.j$},a.createElement("form",{className:i.zW,onSubmit:N},a.createElement("div",{className:i.KM},a.createElement("div",{className:(0,u.cx)("checkbox",_,y)},a.createElement("input",{type:"checkbox",className:g,checked:S.popoutOnStart,onChange:function(e){O({popoutOnStart:!S.popoutOnStart})}}),a.createElement("label",{className:v},"Show Tabli popout window at startup")),a.createElement("div",{className:(0,u.cx)("checkbox",_,y)},a.createElement("input",{type:"checkbox",className:g,checked:S.dedupeTabs,onChange:function(){O({dedupeTabs:!S.dedupeTabs})}}),a.createElement("label",{className:v},"Automatically close duplicate tabs")),a.createElement("div",{className:(0,u.cx)("checkbox",_,y)},a.createElement("input",{type:"checkbox",className:g,checked:S.revertOnOpen,onChange:function(e){O({revertOnOpen:!S.revertOnOpen})}}),a.createElement("label",{className:v},"Only re-open saved tabs when re-opening saved windows")),a.createElement("div",null),a.createElement("div",null),a.createElement("div",{className:i.XX},a.createElement("label",{className:h},"Theme")),R,a.createElement("div",{className:i.XX},a.createElement("label",{className:h},"Layout")),P,a.createElement("div",{className:i.XX},a.createElement("label",{className:h},"Font Size")),I)),a.createElement("hr",null),a.createElement("div",{className:i.px},a.createElement("button",{type:"button",className:"btn btn-default btn-light tabli-dialog-button",onClick:function(e){!function(e){e.preventDefault(),o(t)}(e),n()},tabIndex:0},"Cancel"),a.createElement("button",{type:"button",className:"btn btn-info tabli-dialog-button",onClick:function(e){e.preventDefault(),o(S)},tabIndex:0,onKeyDown:k},"Apply"),a.createElement("button",{type:"button",className:"btn btn-primary btn-default tabli-dialog-button",onClick:N,tabIndex:0,onKeyDown:k},"OK")))))};var E=n(5095),S=n(4177),x=n.n(S),k=n(9926),N=n(5930),O=n.n(N),C=n(1291),R=n.n(C),T=(n(9315),n(5043)),P=n(709),j=n(1680),A=n.n(j),I=n(6146),_=n.n(I),L={throttle:A(),mapValues:_()},V=(L.throttle((function(){var e=L.mapValues(null,(function(e){return e.clearChromeSessionId()})),t={savedWindowStateVersion:1,savedWindowState:JSON.stringify(e,null,2)};chrome.storage.local.set(t,(function(){r.Rm.debug((new Date).toString()+" succesfully wrote window state")}))}),3e4),n(4455),n(3786),function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function l(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}c((r=r.apply(e,t||[])).next())}))}),H=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(c){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}},B=(O(),R(),(0,r.tZ)("chrome-events"));function D(){return V(this,void 0,void 0,(function(){var e,t;return H(this,(function(n){switch(n.label){case 0:return[4,chrome.storage.session.get("stateSnapshot")];case 1:return e=n.sent(),r.Rm.debug("readSnapStateStr: items: ",e),e&&(t=e.stateSnapshot)?[2,t]:[2,null]}}))}))}function M(){return V(this,void 0,void 0,(function(){var e,t;return H(this,(function(n){switch(n.label){case 0:return r.Rm.debug("loadSnapState: attempting to load state snapshot from session storage...:"),[4,D()];case 1:return(e=n.sent())?(t=JSON.parse(e),r.Rm.debug("loadSnapState: read from session storage: ",t),[2,(0,k.mkRef)(T.Ay.deserialize(t))]):[2,null]}}))}))}P.He(B);var X=n(4140),F=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function l(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}c((r=r.apply(e,t||[])).next())}))},z=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(c){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}},G=x(),K=function(){return F(void 0,void 0,void 0,(function(){var e;return z(this,(function(t){switch(t.label){case 0:return r.Rm.debug("onClose"),[4,G.tabs.getCurrent()];case 1:return e=t.sent(),r.Rm.debug("onClose tab: ",e),e.id&&chrome.tabs.remove([e.id]),[2]}}))}))},Y=function(e,t){return F(void 0,void 0,void 0,(function(){return z(this,(function(n){switch(n.label){case 0:return[4,E.SF(t,e)];case 1:return n.sent(),[2]}}))}))};(0,o.YT)(),window.onload=function(){return F(void 0,void 0,void 0,(function(){var e,t,n,o,i,l;return z(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,M()];case 1:return(e=c.sent())?(t=e,n=(0,k.mutableGet)(t),o=document.getElementById("prefsContent"),i=a.createElement(w,{onClose:K,initialPrefs:n.preferences,onApply:function(e){return Y(t,e)},onSubmit:function(e){return n=t,r=e,F(void 0,void 0,void 0,(function(){return z(this,(function(e){switch(e.label){case 0:return[4,Y(n,r)];case 1:return e.sent(),[4,K()];case 2:return e.sent(),[2]}}))}));var n,r}}),(0,X.H)(o).render(i),[3,3]):(r.Rm.error("prefsPage: could not load snap state from session storage -- exiting"),[2]);case 2:throw l=c.sent(),r.Rm.error("caught exception rendering preferences page:"),r.Rm.error(l.stack),l;case 3:return[2]}}))}))}}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var o=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}r.m=t,e=[],r.O=(t,n,a,o)=>{if(!n){var i=1/0;for(u=0;u<e.length;u++){for(var[n,a,o]=e[u],l=!0,c=0;c<n.length;c++)(!1&o||i>=o)&&Object.keys(r.O).every((e=>r.O[e](n[c])))?n.splice(c--,1):(l=!1,o<i&&(i=o));if(l){e.splice(u--,1);var s=a();void 0!==s&&(t=s)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[n,a,o]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),r.j=3,(()=>{var e={3:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var a,o,[i,l,c]=n,s=0;if(i.some((t=>0!==e[t]))){for(a in l)r.o(l,a)&&(r.m[a]=l[a]);if(c)var u=c(r)}for(t&&t(n);s<i.length;s++)o=i[s],r.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return r.O(u)},n=self.webpackChunktabli=self.webpackChunktabli||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=r.O(void 0,[0],(()=>r(6970)));a=r.O(a)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU0zRCxHQUFnQyxJQUF4Qm9ELEVBQWdCcEQsS0FBYSxDQUN0RCxJQUFJcUIsS0FBWW9DLEVBQ1pyQyxFQUFvQi9JLEVBQUVvTCxFQUFhcEMsS0FDckNELEVBQW9CN0ksRUFBRThJLEdBQVlvQyxFQUFZcEMsSUFHaEQsR0FBR3FDLEVBQVMsSUFBSTNGLEVBQVMyRixFQUFRdEMsRUFDbEMsQ0FFQSxJQURHbUMsR0FBNEJBLEVBQTJCQyxHQUNyRDVLLEVBQUkrSSxFQUFTMUMsT0FBUXJHLElBQ3pCeUssRUFBVTFCLEVBQVMvSSxHQUNoQndJLEVBQW9CL0ksRUFBRStLLEVBQWlCQyxJQUFZRCxFQUFnQkMsSUFDckVELEVBQWdCQyxHQUFTLEtBRTFCRCxFQUFnQkMsR0FBVyxFQUU1QixPQUFPakMsRUFBb0JNLEVBQUUzRCxFQUFPLEVBR2pDNkYsRUFBcUJDLEtBQXdCLGtCQUFJQSxLQUF3QixtQkFBSyxHQUNsRkQsRUFBbUJFLFFBQVFSLEVBQXFCUyxLQUFLLEtBQU0sSUFDM0RILEVBQW1CM0ssS0FBT3FLLEVBQXFCUyxLQUFLLEtBQU1ILEVBQW1CM0ssS0FBSzhLLEtBQUtILEcsS0M3Q3ZGLElBQUlJLEVBQXNCNUMsRUFBb0JNLE9BQUVILEVBQVcsQ0FBQyxJQUFJLElBQU9ILEVBQW9CLFFBQzNGNEMsRUFBc0I1QyxFQUFvQk0sRUFBRXNDLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90YWJsaS93ZWJwYWNrL3J1bnRpbWUvY2h1bmsgbG9hZGVkIiwid2VicGFjazovL3RhYmxpLy4vbm9kZV9tb2R1bGVzL3NlbXZlci9pbmRleC5qcyIsIndlYnBhY2s6Ly90YWJsaS8uL3NyYy90cy9jb21wb25lbnRzL1ByZWZlcmVuY2VzTW9kYWwudHN4Iiwid2VicGFjazovL3RhYmxpLy4vc3JjL3RzL3NhdmVkU3RhdGUudHMiLCJ3ZWJwYWNrOi8vdGFibGkvLi9zcmMvdHMvc3RhdGUudHMiLCJ3ZWJwYWNrOi8vdGFibGkvLi9zcmMvdHMvcHJlZnNQYWdlLnRzeCIsIndlYnBhY2s6Ly90YWJsaS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly90YWJsaS93ZWJwYWNrL3J1bnRpbWUvY29tcGF0IGdldCBkZWZhdWx0IGV4cG9ydCIsIndlYnBhY2s6Ly90YWJsaS93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vdGFibGkvd2VicGFjay9ydW50aW1lL2dsb2JhbCIsIndlYnBhY2s6Ly90YWJsaS93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL3RhYmxpL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vdGFibGkvd2VicGFjay9ydW50aW1lL25vZGUgbW9kdWxlIGRlY29yYXRvciIsIndlYnBhY2s6Ly90YWJsaS93ZWJwYWNrL3J1bnRpbWUvcnVudGltZUlkIiwid2VicGFjazovL3RhYmxpL3dlYnBhY2svcnVudGltZS9qc29ucCBjaHVuayBsb2FkaW5nIiwid2VicGFjazovL3RhYmxpL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZGVmZXJyZWQgPSBbXTtcbl9fd2VicGFja19yZXF1aXJlX18uTyA9IChyZXN1bHQsIGNodW5rSWRzLCBmbiwgcHJpb3JpdHkpID0+IHtcblx0aWYoY2h1bmtJZHMpIHtcblx0XHRwcmlvcml0eSA9IHByaW9yaXR5IHx8IDA7XG5cdFx0Zm9yKHZhciBpID0gZGVmZXJyZWQubGVuZ3RoOyBpID4gMCAmJiBkZWZlcnJlZFtpIC0gMV1bMl0gPiBwcmlvcml0eTsgaS0tKSBkZWZlcnJlZFtpXSA9IGRlZmVycmVkW2kgLSAxXTtcblx0XHRkZWZlcnJlZFtpXSA9IFtjaHVua0lkcywgZm4sIHByaW9yaXR5XTtcblx0XHRyZXR1cm47XG5cdH1cblx0dmFyIG5vdEZ1bGZpbGxlZCA9IEluZmluaXR5O1xuXHRmb3IgKHZhciBpID0gMDsgaSA8IGRlZmVycmVkLmxlbmd0aDsgaSsrKSB7XG5cdFx0dmFyIFtjaHVua0lkcywgZm4sIHByaW9yaXR5XSA9IGRlZmVycmVkW2ldO1xuXHRcdHZhciBmdWxmaWxsZWQgPSB0cnVlO1xuXHRcdGZvciAodmFyIGogPSAwOyBqIDwgY2h1bmtJZHMubGVuZ3RoOyBqKyspIHtcblx0XHRcdGlmICgocHJpb3JpdHkgJiAxID09PSAwIHx8IG5vdEZ1bGZpbGxlZCA+PSBwcmlvcml0eSkgJiYgT2JqZWN0LmtleXMoX193ZWJwYWNrX3JlcXVpcmVfXy5PKS5ldmVyeSgoa2V5KSA9PiAoX193ZWJwYWNrX3JlcXVpcmVfXy5PW2tleV0oY2h1bmtJZHNbal0pKSkpIHtcblx0XHRcdFx0Y2h1bmtJZHMuc3BsaWNlKGotLSwgMSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRmdWxmaWxsZWQgPSBmYWxzZTtcblx0XHRcdFx0aWYocHJpb3JpdHkgPCBub3RGdWxmaWxsZWQpIG5vdEZ1bGZpbGxlZCA9IHByaW9yaXR5O1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZihmdWxmaWxsZWQpIHtcblx0XHRcdGRlZmVycmVkLnNwbGljZShpLS0sIDEpXG5cdFx0XHR2YXIgciA9IGZuKCk7XG5cdFx0XHRpZiAociAhPT0gdW5kZWZpbmVkKSByZXN1bHQgPSByO1xuXHRcdH1cblx0fVxuXHRyZXR1cm4gcmVzdWx0O1xufTsiLCIvLyBqdXN0IHByZS1sb2FkIGFsbCB0aGUgc3R1ZmYgdGhhdCBpbmRleC5qcyBsYXppbHkgZXhwb3J0c1xuY29uc3QgaW50ZXJuYWxSZSA9IHJlcXVpcmUoJy4vaW50ZXJuYWwvcmUnKVxuY29uc3QgY29uc3RhbnRzID0gcmVxdWlyZSgnLi9pbnRlcm5hbC9jb25zdGFudHMnKVxuY29uc3QgU2VtVmVyID0gcmVxdWlyZSgnLi9jbGFzc2VzL3NlbXZlcicpXG5jb25zdCBpZGVudGlmaWVycyA9IHJlcXVpcmUoJy4vaW50ZXJuYWwvaWRlbnRpZmllcnMnKVxuY29uc3QgcGFyc2UgPSByZXF1aXJlKCcuL2Z1bmN0aW9ucy9wYXJzZScpXG5jb25zdCB2YWxpZCA9IHJlcXVpcmUoJy4vZnVuY3Rpb25zL3ZhbGlkJylcbmNvbnN0IGNsZWFuID0gcmVxdWlyZSgnLi9mdW5jdGlvbnMvY2xlYW4nKVxuY29uc3QgaW5jID0gcmVxdWlyZSgnLi9mdW5jdGlvbnMvaW5jJylcbmNvbnN0IGRpZmYgPSByZXF1aXJlKCcuL2Z1bmN0aW9ucy9kaWZmJylcbmNvbnN0IG1ham9yID0gcmVxdWlyZSgnLi9mdW5jdGlvbnMvbWFqb3InKVxuY29uc3QgbWlub3IgPSByZXF1aXJlKCcuL2Z1bmN0aW9ucy9taW5vcicpXG5jb25zdCBwYXRjaCA9IHJlcXVpcmUoJy4vZnVuY3Rpb25zL3BhdGNoJylcbmNvbnN0IHByZXJlbGVhc2UgPSByZXF1aXJlKCcuL2Z1bmN0aW9ucy9wcmVyZWxlYXNlJylcbmNvbnN0IGNvbXBhcmUgPSByZXF1aXJlKCcuL2Z1bmN0aW9ucy9jb21wYXJlJylcbmNvbnN0IHJjb21wYXJlID0gcmVxdWlyZSgnLi9mdW5jdGlvbnMvcmNvbXBhcmUnKVxuY29uc3QgY29tcGFyZUxvb3NlID0gcmVxdWlyZSgnLi9mdW5jdGlvbnMvY29tcGFyZS1sb29zZScpXG5jb25zdCBjb21wYXJlQnVpbGQgPSByZXF1aXJlKCcuL2Z1bmN0aW9ucy9jb21wYXJlLWJ1aWxkJylcbmNvbnN0IHNvcnQgPSByZXF1aXJlKCcuL2Z1bmN0aW9ucy9zb3J0JylcbmNvbnN0IHJzb3J0ID0gcmVxdWlyZSgnLi9mdW5jdGlvbnMvcnNvcnQnKVxuY29uc3QgZ3QgPSByZXF1aXJlKCcuL2Z1bmN0aW9ucy9ndCcpXG5jb25zdCBsdCA9IHJlcXVpcmUoJy4vZnVuY3Rpb25zL2x0JylcbmNvbnN0IGVxID0gcmVxdWlyZSgnLi9mdW5jdGlvbnMvZXEnKVxuY29uc3QgbmVxID0gcmVxdWlyZSgnLi9mdW5jdGlvbnMvbmVxJylcbmNvbnN0IGd0ZSA9IHJlcXVpcmUoJy4vZnVuY3Rpb25zL2d0ZScpXG5jb25zdCBsdGUgPSByZXF1aXJlKCcuL2Z1bmN0aW9ucy9sdGUnKVxuY29uc3QgY21wID0gcmVxdWlyZSgnLi9mdW5jdGlvbnMvY21wJylcbmNvbnN0IGNvZXJjZSA9IHJlcXVpcmUoJy4vZnVuY3Rpb25zL2NvZXJjZScpXG5jb25zdCBDb21wYXJhdG9yID0gcmVxdWlyZSgnLi9jbGFzc2VzL2NvbXBhcmF0b3InKVxuY29uc3QgUmFuZ2UgPSByZXF1aXJlKCcuL2NsYXNzZXMvcmFuZ2UnKVxuY29uc3Qgc2F0aXNmaWVzID0gcmVxdWlyZSgnLi9mdW5jdGlvbnMvc2F0aXNmaWVzJylcbmNvbnN0IHRvQ29tcGFyYXRvcnMgPSByZXF1aXJlKCcuL3Jhbmdlcy90by1jb21wYXJhdG9ycycpXG5jb25zdCBtYXhTYXRpc2Z5aW5nID0gcmVxdWlyZSgnLi9yYW5nZXMvbWF4LXNhdGlzZnlpbmcnKVxuY29uc3QgbWluU2F0aXNmeWluZyA9IHJlcXVpcmUoJy4vcmFuZ2VzL21pbi1zYXRpc2Z5aW5nJylcbmNvbnN0IG1pblZlcnNpb24gPSByZXF1aXJlKCcuL3Jhbmdlcy9taW4tdmVyc2lvbicpXG5jb25zdCB2YWxpZFJhbmdlID0gcmVxdWlyZSgnLi9yYW5nZXMvdmFsaWQnKVxuY29uc3Qgb3V0c2lkZSA9IHJlcXVpcmUoJy4vcmFuZ2VzL291dHNpZGUnKVxuY29uc3QgZ3RyID0gcmVxdWlyZSgnLi9yYW5nZXMvZ3RyJylcbmNvbnN0IGx0ciA9IHJlcXVpcmUoJy4vcmFuZ2VzL2x0cicpXG5jb25zdCBpbnRlcnNlY3RzID0gcmVxdWlyZSgnLi9yYW5nZXMvaW50ZXJzZWN0cycpXG5jb25zdCBzaW1wbGlmeVJhbmdlID0gcmVxdWlyZSgnLi9yYW5nZXMvc2ltcGxpZnknKVxuY29uc3Qgc3Vic2V0ID0gcmVxdWlyZSgnLi9yYW5nZXMvc3Vic2V0Jylcbm1vZHVsZS5leHBvcnRzID0ge1xuICBwYXJzZSxcbiAgdmFsaWQsXG4gIGNsZWFuLFxuICBpbmMsXG4gIGRpZmYsXG4gIG1ham9yLFxuICBtaW5vcixcbiAgcGF0Y2gsXG4gIHByZXJlbGVhc2UsXG4gIGNvbXBhcmUsXG4gIHJjb21wYXJlLFxuICBjb21wYXJlTG9vc2UsXG4gIGNvbXBhcmVCdWlsZCxcbiAgc29ydCxcbiAgcnNvcnQsXG4gIGd0LFxuICBsdCxcbiAgZXEsXG4gIG5lcSxcbiAgZ3RlLFxuICBsdGUsXG4gIGNtcCxcbiAgY29lcmNlLFxuICBDb21wYXJhdG9yLFxuICBSYW5nZSxcbiAgc2F0aXNmaWVzLFxuICB0b0NvbXBhcmF0b3JzLFxuICBtYXhTYXRpc2Z5aW5nLFxuICBtaW5TYXRpc2Z5aW5nLFxuICBtaW5WZXJzaW9uLFxuICB2YWxpZFJhbmdlLFxuICBvdXRzaWRlLFxuICBndHIsXG4gIGx0cixcbiAgaW50ZXJzZWN0cyxcbiAgc2ltcGxpZnlSYW5nZSxcbiAgc3Vic2V0LFxuICBTZW1WZXIsXG4gIHJlOiBpbnRlcm5hbFJlLnJlLFxuICBzcmM6IGludGVybmFsUmUuc3JjLFxuICB0b2tlbnM6IGludGVybmFsUmUudCxcbiAgU0VNVkVSX1NQRUNfVkVSU0lPTjogY29uc3RhbnRzLlNFTVZFUl9TUEVDX1ZFUlNJT04sXG4gIFJFTEVBU0VfVFlQRVM6IGNvbnN0YW50cy5SRUxFQVNFX1RZUEVTLFxuICBjb21wYXJlSWRlbnRpZmllcnM6IGlkZW50aWZpZXJzLmNvbXBhcmVJZGVudGlmaWVycyxcbiAgcmNvbXBhcmVJZGVudGlmaWVyczogaWRlbnRpZmllcnMucmNvbXBhcmVJZGVudGlmaWVycyxcbn1cbiIsInZhciBfX3JlYWQgPSAodGhpcyAmJiB0aGlzLl9fcmVhZCkgfHwgZnVuY3Rpb24gKG8sIG4pIHtcbiAgICB2YXIgbSA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl07XG4gICAgaWYgKCFtKSByZXR1cm4gbztcbiAgICB2YXIgaSA9IG0uY2FsbChvKSwgciwgYXIgPSBbXSwgZTtcbiAgICB0cnkge1xuICAgICAgICB3aGlsZSAoKG4gPT09IHZvaWQgMCB8fCBuLS0gPiAwKSAmJiAhKHIgPSBpLm5leHQoKSkuZG9uZSkgYXIucHVzaChyLnZhbHVlKTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7IGUgPSB7IGVycm9yOiBlcnJvciB9OyB9XG4gICAgZmluYWxseSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAociAmJiAhci5kb25lICYmIChtID0gaVtcInJldHVyblwiXSkpIG0uY2FsbChpKTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHsgaWYgKGUpIHRocm93IGUuZXJyb3I7IH1cbiAgICB9XG4gICAgcmV0dXJuIGFyO1xufTtcbmltcG9ydCB7IGxvZyB9IGZyb20gJy4uL2dsb2JhbHMnO1xuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0ICogYXMgc3R5bGVzIGZyb20gJy4vY3NzU3R5bGVzJztcbmltcG9ydCAqIGFzIENvbnN0YW50cyBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQgKiBhcyBNb2RhbCBmcm9tICcuL01vZGFsJztcbmltcG9ydCB7IHRoZW1lcyB9IGZyb20gJy4vdGhlbWVDb250ZXh0JztcbmltcG9ydCB7IGNzcywgY3ggfSBmcm9tICdAZW1vdGlvbi9jc3MnO1xuaW1wb3J0IHsgUHJlZmVyZW5jZXMgfSBmcm9tICcuLi9wcmVmZXJlbmNlcyc7XG5pbXBvcnQgeyB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IGxheW91dHMgfSBmcm9tICcuL0xheW91dENvbnRleHQnO1xuaW1wb3J0IHsgZm9udFNjYWxlRmFjdG9yVG9TaXplLCBmb250U2l6ZVRvU2NhbGVGYWN0b3IsIGZvbnRTaXplVmFscywgfSBmcm9tICcuLi9yZW5kZXJVdGlscyc7XG52YXIgU0VMRUNUX1dJRFRIID0gMTIwO1xudmFyIHRoZW1lU2VsZWN0U3R5bGUgPSBjc3Moe1xuICAgIHdpZHRoOiBTRUxFQ1RfV0lEVEgsXG4gICAgbWFyZ2luTGVmdDogNSxcbn0pO1xudmFyIGZvbnRTaXplU2VsZWN0U3R5bGUgPSBjc3Moe1xuICAgIHdpZHRoOiBTRUxFQ1RfV0lEVEgsXG4gICAgbWFyZ2luTGVmdDogNSxcbn0pO1xudmFyIHNlbGVjdExhYmVsU3R5bGUgPSBjc3Moe1xuICAgIG1hcmdpblRvcDogMCxcbiAgICBtYXJnaW5Cb3R0b206IDAsXG4gICAgbWFyZ2luTGVmdDogMCxcbiAgICBtYXJnaW5SaWdodDogNCxcbn0pO1xudmFyIGNoZWNrTGFiZWxTdHlsZSA9IGNzcyh7XG4gICAgbWFyZ2luVG9wOiAwLFxuICAgIG1hcmdpbkJvdHRvbTogMCxcbiAgICBtYXJnaW5MZWZ0OiAwLFxuICAgIG1hcmdpblJpZ2h0OiAwLFxufSk7XG52YXIgcHJlZnNDaGVja2JveCA9IGNzcyh7XG4gICAgbWFyZ2luTGVmdDogOCxcbiAgICBtYXJnaW5SaWdodDogNCxcbiAgICBtYXJnaW5Ub3A6ICdhdXRvJyxcbiAgICBtYXJnaW5Cb3R0b206ICdhdXRvJyxcbn0pO1xudmFyIHByZWZzTGFiZWxlZENoZWNrYm94ID0gY3NzKHtcbiAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgYWxpZ25Db250ZW50OiAnZmxleC1zdGFydCcsXG59KTtcbnZhciBQcmVmZXJlbmNlc01vZGFsID0gZnVuY3Rpb24gKF9hKSB7XG4gICAgdmFyIGluaXRpYWxQcmVmcyA9IF9hLmluaXRpYWxQcmVmcywgb25DbG9zZSA9IF9hLm9uQ2xvc2UsIG9uQXBwbHkgPSBfYS5vbkFwcGx5LCBvblN1Ym1pdCA9IF9hLm9uU3VibWl0O1xuICAgIGxvZy5kZWJ1ZygnUHJlZmVyZW5jZXNNb2RhbDogaW5pdGlhbFByZWZzOiAnLCBpbml0aWFsUHJlZnMpO1xuICAgIHZhciBfYiA9IF9fcmVhZCh1c2VTdGF0ZShpbml0aWFsUHJlZnMpLCAyKSwgcHJlZnMgPSBfYlswXSwgc2V0UHJlZnMgPSBfYlsxXTtcbiAgICB2YXIgaGFuZGxlS2V5RG93biA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmIChlLmtleUNvZGUgPT09IENvbnN0YW50cy5LRVlfRVNDKSB7XG4gICAgICAgICAgICAvLyBFU0Mga2V5XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBvbkNsb3NlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZS5rZXlDb2RlID09PSBDb25zdGFudHMuS0VZX0VOVEVSKSB7XG4gICAgICAgICAgICBoYW5kbGVTdWJtaXQoZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHZhciBoYW5kbGVDYW5jZWwgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIC8vIHB1dCBiYWNrIGluaXRpYWwgcHJlZnM6XG4gICAgICAgIG9uQXBwbHkoaW5pdGlhbFByZWZzKTtcbiAgICB9O1xuICAgIHZhciBoYW5kbGVBcHBseSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgb25BcHBseShwcmVmcyk7XG4gICAgfTtcbiAgICB2YXIgaGFuZGxlU3VibWl0ID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBvblN1Ym1pdChwcmVmcyk7XG4gICAgfTtcbiAgICB2YXIgdXBkYXRlUHJlZnMgPSBmdW5jdGlvbiAodXBkYXRlcykge1xuICAgICAgICBzZXRQcmVmcyhQcmVmZXJlbmNlcy51cGRhdGUocHJlZnMsIHVwZGF0ZXMpKTtcbiAgICB9O1xuICAgIHZhciBoYW5kbGVQb3BTdGFydENoYW5nZSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHVwZGF0ZVByZWZzKHsgcG9wb3V0T25TdGFydDogIXByZWZzLnBvcG91dE9uU3RhcnQgfSk7XG4gICAgfTtcbiAgICB2YXIgaGFuZGxlVGFiRGVkdXBlQ2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB1cGRhdGVQcmVmcyh7IGRlZHVwZVRhYnM6ICFwcmVmcy5kZWR1cGVUYWJzIH0pO1xuICAgIH07XG4gICAgdmFyIGhhbmRsZVJldmVydE9uT3BlbkNoYW5nZSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHVwZGF0ZVByZWZzKHsgcmV2ZXJ0T25PcGVuOiAhcHJlZnMucmV2ZXJ0T25PcGVuIH0pO1xuICAgIH07XG4gICAgdmFyIGhhbmRsZVRoZW1lQ2hhbmdlID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdXBkYXRlUHJlZnMoeyB0aGVtZTogZS50YXJnZXQudmFsdWUgfSk7XG4gICAgfTtcbiAgICB2YXIgaGFuZGxlTGF5b3V0Q2hhbmdlID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdXBkYXRlUHJlZnMoeyBsYXlvdXQ6IGUudGFyZ2V0LnZhbHVlIH0pO1xuICAgIH07XG4gICAgdmFyIGhhbmRsZUZvbnRTaXplQ2hhbmdlID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIG5leHRTY2FsZUZhY3RvciA9IGZvbnRTaXplVG9TY2FsZUZhY3RvcihOdW1iZXIucGFyc2VJbnQoZS50YXJnZXQudmFsdWUpKTtcbiAgICAgICAgdXBkYXRlUHJlZnMoeyBmb250U2NhbGVGYWN0b3I6IG5leHRTY2FsZUZhY3RvciB9KTtcbiAgICB9O1xuICAgIHZhciB0aGVtZU5hbWVzID0gT2JqZWN0LmtleXModGhlbWVzKTtcbiAgICB2YXIgdGhlbWVPcHRzID0gdGhlbWVOYW1lcy5tYXAoZnVuY3Rpb24gKG5tKSB7IHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiLCB7IGtleTogbm0sIHZhbHVlOiBubSB9LCBubSkpOyB9KTtcbiAgICB2YXIgdGhlbWVTZWxlY3QgPSAoUmVhY3QuY3JlYXRlRWxlbWVudChcInNlbGVjdFwiLCB7IGNsYXNzTmFtZTogdGhlbWVTZWxlY3RTdHlsZSwgbmFtZTogXCJ0aGVtZVwiLCB2YWx1ZTogcHJlZnMudGhlbWUsIG9uQ2hhbmdlOiBoYW5kbGVUaGVtZUNoYW5nZSB9LCB0aGVtZU9wdHMpKTtcbiAgICB2YXIgbGF5b3V0TmFtZXMgPSBPYmplY3Qua2V5cyhsYXlvdXRzKTtcbiAgICB2YXIgbGF5b3V0T3B0cyA9IGxheW91dE5hbWVzLm1hcChmdW5jdGlvbiAobm0pIHsgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIsIHsga2V5OiBubSwgdmFsdWU6IG5tIH0sIG5tKSk7IH0pO1xuICAgIHZhciBsYXlvdXRTZWxlY3QgPSAoUmVhY3QuY3JlYXRlRWxlbWVudChcInNlbGVjdFwiLCB7IGNsYXNzTmFtZTogdGhlbWVTZWxlY3RTdHlsZSwgbmFtZTogXCJsYXlvdXRcIiwgdmFsdWU6IHByZWZzLmxheW91dCwgb25DaGFuZ2U6IGhhbmRsZUxheW91dENoYW5nZSB9LCBsYXlvdXRPcHRzKSk7XG4gICAgdmFyIGN1cnJlbnRGb250U2l6ZSA9IGZvbnRTY2FsZUZhY3RvclRvU2l6ZShwcmVmcy5mb250U2NhbGVGYWN0b3IpO1xuICAgIHZhciBmb250U2l6ZU9wdHMgPSBmb250U2l6ZVZhbHMubWFwKGZ1bmN0aW9uIChzeikgeyByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJvcHRpb25cIiwgeyBrZXk6IHN6LnRvU3RyaW5nKCksIHZhbHVlOiBzeiB9LCBzei50b1N0cmluZygpKSk7IH0pO1xuICAgIHZhciBmb250U2l6ZVNlbGVjdCA9IChSZWFjdC5jcmVhdGVFbGVtZW50KFwic2VsZWN0XCIsIHsgY2xhc3NOYW1lOiBmb250U2l6ZVNlbGVjdFN0eWxlLCBuYW1lOiBcImZvbnRTaXplXCIsIHZhbHVlOiBjdXJyZW50Rm9udFNpemUsIG9uQ2hhbmdlOiBoYW5kbGVGb250U2l6ZUNoYW5nZSB9LCBmb250U2l6ZU9wdHMpKTtcbiAgICB2YXIgcmlnaHRDb2wgPSBzdHlsZXMucHJlZnNHcmlkUmlnaHRDb2w7XG4gICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KE1vZGFsLkRpYWxvZywgeyBjbGFzc05hbWU6IHN0eWxlcy5wcmVmc0RpYWxvZywgdGl0bGU6IFwiVGFibGkgUHJlZmVyZW5jZXNcIiwgb25DbG9zZTogb25DbG9zZSB9LFxuICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KE1vZGFsLkJvZHksIG51bGwsXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBzdHlsZXMubW9kYWxCb2R5Q29udGFpbmVyIH0sXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImZvcm1cIiwgeyBjbGFzc05hbWU6IHN0eWxlcy5wcmVmc0Zvcm0sIG9uU3VibWl0OiBoYW5kbGVTdWJtaXQgfSxcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogc3R5bGVzLnByZWZzR3JpZENvbnRhaW5lciB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogY3goJ2NoZWNrYm94JywgcmlnaHRDb2wsIHByZWZzTGFiZWxlZENoZWNrYm94KSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiLCB7IHR5cGU6IFwiY2hlY2tib3hcIiwgY2xhc3NOYW1lOiBwcmVmc0NoZWNrYm94LCBjaGVja2VkOiBwcmVmcy5wb3BvdXRPblN0YXJ0LCBvbkNoYW5nZTogaGFuZGxlUG9wU3RhcnRDaGFuZ2UgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImxhYmVsXCIsIHsgY2xhc3NOYW1lOiBjaGVja0xhYmVsU3R5bGUgfSwgXCJTaG93IFRhYmxpIHBvcG91dCB3aW5kb3cgYXQgc3RhcnR1cFwiKSksXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBjeCgnY2hlY2tib3gnLCByaWdodENvbCwgcHJlZnNMYWJlbGVkQ2hlY2tib3gpIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImlucHV0XCIsIHsgdHlwZTogXCJjaGVja2JveFwiLCBjbGFzc05hbWU6IHByZWZzQ2hlY2tib3gsIGNoZWNrZWQ6IHByZWZzLmRlZHVwZVRhYnMsIG9uQ2hhbmdlOiBoYW5kbGVUYWJEZWR1cGVDaGFuZ2UgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImxhYmVsXCIsIHsgY2xhc3NOYW1lOiBjaGVja0xhYmVsU3R5bGUgfSwgXCJBdXRvbWF0aWNhbGx5IGNsb3NlIGR1cGxpY2F0ZSB0YWJzXCIpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IGN4KCdjaGVja2JveCcsIHJpZ2h0Q29sLCBwcmVmc0xhYmVsZWRDaGVja2JveCkgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiwgeyB0eXBlOiBcImNoZWNrYm94XCIsIGNsYXNzTmFtZTogcHJlZnNDaGVja2JveCwgY2hlY2tlZDogcHJlZnMucmV2ZXJ0T25PcGVuLCBvbkNoYW5nZTogaGFuZGxlUmV2ZXJ0T25PcGVuQ2hhbmdlIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJsYWJlbFwiLCB7IGNsYXNzTmFtZTogY2hlY2tMYWJlbFN0eWxlIH0sIFwiT25seSByZS1vcGVuIHNhdmVkIHRhYnMgd2hlbiByZS1vcGVuaW5nIHNhdmVkIHdpbmRvd3NcIikpLFxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCBudWxsKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgbnVsbCksXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBzdHlsZXMucHJlZnNHcmlkTGFiZWwgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwibGFiZWxcIiwgeyBjbGFzc05hbWU6IHNlbGVjdExhYmVsU3R5bGUgfSwgXCJUaGVtZVwiKSksXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGVtZVNlbGVjdCxcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IHN0eWxlcy5wcmVmc0dyaWRMYWJlbCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJsYWJlbFwiLCB7IGNsYXNzTmFtZTogc2VsZWN0TGFiZWxTdHlsZSB9LCBcIkxheW91dFwiKSksXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXlvdXRTZWxlY3QsXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBzdHlsZXMucHJlZnNHcmlkTGFiZWwgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwibGFiZWxcIiwgeyBjbGFzc05hbWU6IHNlbGVjdExhYmVsU3R5bGUgfSwgXCJGb250IFNpemVcIikpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZm9udFNpemVTZWxlY3QpKSxcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiaHJcIiwgbnVsbCksXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogc3R5bGVzLmRpYWxvZ0J1dHRvblJvdyB9LFxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIsIHsgdHlwZTogXCJidXR0b25cIiwgY2xhc3NOYW1lOiBcImJ0biBidG4tZGVmYXVsdCBidG4tbGlnaHQgdGFibGktZGlhbG9nLWJ1dHRvblwiLCBvbkNsaWNrOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUNhbmNlbChlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCB0YWJJbmRleDogMCB9LCBcIkNhbmNlbFwiKSxcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiLCB7IHR5cGU6IFwiYnV0dG9uXCIsIGNsYXNzTmFtZTogXCJidG4gYnRuLWluZm8gdGFibGktZGlhbG9nLWJ1dHRvblwiLCBvbkNsaWNrOiBoYW5kbGVBcHBseSwgdGFiSW5kZXg6IDAsIG9uS2V5RG93bjogaGFuZGxlS2V5RG93biB9LCBcIkFwcGx5XCIpLFxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIsIHsgdHlwZTogXCJidXR0b25cIiwgY2xhc3NOYW1lOiBcImJ0biBidG4tcHJpbWFyeSBidG4tZGVmYXVsdCB0YWJsaS1kaWFsb2ctYnV0dG9uXCIsIG9uQ2xpY2s6IGhhbmRsZVN1Ym1pdCwgdGFiSW5kZXg6IDAsIG9uS2V5RG93bjogaGFuZGxlS2V5RG93biB9LCBcIk9LXCIpKSkpKSk7XG59O1xuZXhwb3J0IGRlZmF1bHQgUHJlZmVyZW5jZXNNb2RhbDtcbiIsInZhciBfX3JlYWQgPSAodGhpcyAmJiB0aGlzLl9fcmVhZCkgfHwgZnVuY3Rpb24gKG8sIG4pIHtcbiAgICB2YXIgbSA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl07XG4gICAgaWYgKCFtKSByZXR1cm4gbztcbiAgICB2YXIgaSA9IG0uY2FsbChvKSwgciwgYXIgPSBbXSwgZTtcbiAgICB0cnkge1xuICAgICAgICB3aGlsZSAoKG4gPT09IHZvaWQgMCB8fCBuLS0gPiAwKSAmJiAhKHIgPSBpLm5leHQoKSkuZG9uZSkgYXIucHVzaChyLnZhbHVlKTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7IGUgPSB7IGVycm9yOiBlcnJvciB9OyB9XG4gICAgZmluYWxseSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAociAmJiAhci5kb25lICYmIChtID0gaVtcInJldHVyblwiXSkpIG0uY2FsbChpKTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHsgaWYgKGUpIHRocm93IGUuZXJyb3I7IH1cbiAgICB9XG4gICAgcmV0dXJuIGFyO1xufTtcbnZhciBfX3NwcmVhZEFycmF5ID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5KSB8fCBmdW5jdGlvbiAodG8sIGZyb20sIHBhY2spIHtcbiAgICBpZiAocGFjayB8fCBhcmd1bWVudHMubGVuZ3RoID09PSAyKSBmb3IgKHZhciBpID0gMCwgbCA9IGZyb20ubGVuZ3RoLCBhcjsgaSA8IGw7IGkrKykge1xuICAgICAgICBpZiAoYXIgfHwgIShpIGluIGZyb20pKSB7XG4gICAgICAgICAgICBpZiAoIWFyKSBhciA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20sIDAsIGkpO1xuICAgICAgICAgICAgYXJbaV0gPSBmcm9tW2ldO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0by5jb25jYXQoYXIgfHwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSkpO1xufTtcbmltcG9ydCB7IGxvZyB9IGZyb20gJy4vZ2xvYmFscyc7XG5pbXBvcnQgdGhyb3R0bGUgZnJvbSAnbG9kYXNoL3Rocm90dGxlJztcbmltcG9ydCBtYXBWYWx1ZXMgZnJvbSAnbG9kYXNoL21hcFZhbHVlcyc7XG5pbXBvcnQgeyBhZGRTdGF0ZUNoYW5nZUxpc3RlbmVyLCBtdXRhYmxlR2V0IH0gZnJvbSAnb25lcmVmJztcbnZhciBfID0geyB0aHJvdHRsZTogdGhyb3R0bGUsIG1hcFZhbHVlczogbWFwVmFsdWVzIH07XG4vLyBTYXZlIHByZXZpb3VzIGJvb2ttYXJrSWRNYXAgZm9yIGVmZmljaWVudCBkaWZmXG52YXIgcHJldkJvb2ttYXJrSWRNYXAgPSBudWxsOyAvLyBsYXN0IGJvb2ttYXJrSWRNYXAgd3JpdHRlblxudmFyIGxhdGVzdEJvb2ttYXJrSWRNYXAgPSBudWxsOyAvLyBtb3N0IHJlY2VudCBib29rbWFyayBtYXBcbi8qKlxuICogZ2V0IGRpZmZzIGJldHdlZW4gb2xkIGFuZCBuZXcgdmVyc2lvbiBvZiBib29rbWFyayBpZCBtYXAuXG4gKi9cbnZhciBnZXREaWZmcyA9IGZ1bmN0aW9uIChwcmV2TWFwLCBjdXJNYXApIHtcbiAgICB2YXIgcHJldktleXMgPSBuZXcgU2V0KE9iamVjdC5rZXlzKHByZXZNYXApKTtcbiAgICB2YXIgY3VyS2V5cyA9IG5ldyBTZXQoT2JqZWN0LmtleXMoY3VyTWFwKSk7XG4gICAgLy8gZmluZCBkZWxldGVkIGtleXM6XG4gICAgdmFyIGRlbGV0ZXMgPSBuZXcgU2V0KF9fc3ByZWFkQXJyYXkoW10sIF9fcmVhZChwcmV2S2V5cyksIGZhbHNlKS5maWx0ZXIoZnVuY3Rpb24gKHgpIHsgcmV0dXJuICFjdXJLZXlzLmhhcyh4KTsgfSkpO1xuICAgIHZhciB1cGRhdGVkS2V5cyA9IE9iamVjdC5rZXlzKGN1ck1hcCkuZmlsdGVyKGZ1bmN0aW9uIChrKSB7IHJldHVybiAhZGVsZXRlcy5oYXMoaykgJiYgcHJldk1hcFtrXSAhPT0gY3VyTWFwW2tdOyB9KTtcbiAgICB2YXIgdXBkYXRlcyA9IHVwZGF0ZWRLZXlzLm1hcChmdW5jdGlvbiAoaykgeyByZXR1cm4gY3VyTWFwW2tdOyB9KTtcbiAgICByZXR1cm4geyBkZWxldGVzOiBkZWxldGVzLCB1cGRhdGVzOiB1cGRhdGVzIH07XG59O1xuLyoqXG4gKiBkZXRlcm1pbmVzIGlmIHRoZXJlIGFyZSBhbnkgZGlmZnMgYmV0d2VlbiBwcmV2TWFwIGFuZCBjdXJNYXBcbiAqL1xudmFyIGhhc0RpZmZzID0gZnVuY3Rpb24gKHByZXZNYXAsIGN1ck1hcCkge1xuICAgIHZhciBkaWZmcyA9IGdldERpZmZzKHByZXZNYXAsIGN1ck1hcCk7XG4gICAgcmV0dXJuIGRpZmZzLmRlbGV0ZXMuc2l6ZSA+IDAgfHwgZGlmZnMudXBkYXRlcy5sZW5ndGggPiAwO1xufTtcbnZhciBzYXZlZFdpbmRvd1N0YXRlVmVyc2lvbiA9IDE7XG4vLyBwZXJzaXN0IGJvb2ttYXJrSWRNYXAgdG8gbG9jYWwgc3RvcmFnZVxudmFyIHNhdmVTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBwcmV2Qm9va21hcmtJZE1hcCA9IGxhdGVzdEJvb2ttYXJrSWRNYXA7XG4gICAgLy8gbmV2ZXIgcGVyc2lzdCBhIGNocm9tZSBzZXNzaW9uIGlkIC0tIHdlJ2xsIHNldCBkdXJpbmcgc3RhcnR1cCBmcm9tIHNlc3Npb25zIEFQSVxuICAgIHZhciBzZXJCb29rbWFya0lkTWFwID0gXy5tYXBWYWx1ZXMobGF0ZXN0Qm9va21hcmtJZE1hcCwgZnVuY3Rpb24gKHR3KSB7XG4gICAgICAgIHJldHVybiB0dy5jbGVhckNocm9tZVNlc3Npb25JZCgpO1xuICAgIH0pO1xuICAgIHZhciBzYXZlZFdpbmRvd1N0YXRlID0gSlNPTi5zdHJpbmdpZnkoc2VyQm9va21hcmtJZE1hcCwgbnVsbCwgMik7XG4gICAgdmFyIHNhdmVkU3RhdGUgPSB7IHNhdmVkV2luZG93U3RhdGVWZXJzaW9uOiBzYXZlZFdpbmRvd1N0YXRlVmVyc2lvbiwgc2F2ZWRXaW5kb3dTdGF0ZTogc2F2ZWRXaW5kb3dTdGF0ZSB9O1xuICAgIGNocm9tZS5zdG9yYWdlLmxvY2FsLnNldChzYXZlZFN0YXRlLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhuZXcgRGF0ZSgpLnRvU3RyaW5nKCkgKyAnIHN1Y2Nlc2Z1bGx5IHdyb3RlIHdpbmRvdyBzdGF0ZScpO1xuICAgICAgICAvLyBsb2cuZGVidWcoJ3dpbmRvdyBzdGF0ZTogJywgc2VyQm9va21hcmtJZE1hcC50b0pTKCkpO1xuICAgIH0pO1xufTtcbi8vIEEgdGhyb3R0bGVkIHZlcnNpb24gb2Ygc2F2ZVN0YXRlIHRoYXQgd2lsbCB1cGRhdGUgb3VyIHNhdmVkXG4vLyBib29rbWFyayBzdGF0ZSBhdCBtb3N0IG9uY2UgZXZlcnkgMzAgc2VjXG52YXIgdGhyb3R0bGVkU2F2ZVN0YXRlID0gXy50aHJvdHRsZShzYXZlU3RhdGUsIDMwICogMTAwMCk7XG4vLyBTYXZlIGEgc25hcHNob3Qgb2YgdGhlIGN1cnJlbnQgc3RhdGUgdG8gc2Vzc2lvbiBzdG9yYWdlIGV2ZXJ5IDEwIHNlY29uZHNcbnZhciBsYXN0U25hcGhvdFN0YXRlID0gbnVsbDtcbmV4cG9ydCB2YXIgc2F2ZVNuYXBzaG90ID0gZnVuY3Rpb24gKHN0UmVmKSB7XG4gICAgdmFyIGFwcFN0YXRlID0gbXV0YWJsZUdldChzdFJlZik7XG4gICAgaWYgKGxhc3RTbmFwaG90U3RhdGUgPT0gbnVsbCB8fCBhcHBTdGF0ZSAhPT0gbGFzdFNuYXBob3RTdGF0ZSkge1xuICAgICAgICBsYXN0U25hcGhvdFN0YXRlID0gYXBwU3RhdGU7XG4gICAgICAgIHZhciBzbmFwID0gYXBwU3RhdGUudG9KUygpO1xuICAgICAgICB2YXIgc3RhdGVTbmFwc2hvdCA9IEpTT04uc3RyaW5naWZ5KHNuYXAsIG51bGwsIDIpO1xuICAgICAgICBjaHJvbWUuc3RvcmFnZS5zZXNzaW9uLnNldCh7IHN0YXRlU25hcHNob3Q6IHN0YXRlU25hcHNob3QgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbG9nLmRlYnVnKCdzYXZlU25hcHNob3Q6IHNhdmVkIHNuYXBzaG90Jyk7XG4gICAgICAgICAgICBsb2cuZGVidWcoJ3NhdmVTbmFwc2hvdDogc25hcHNob3QgcG9wb3V0V2luZG93SWQ6ICcsIGFwcFN0YXRlLnBvcG91dFdpbmRvd0lkKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBwcmV0dHkgbXVjaCBuZXZlciBoaXQsIHNpbmNlIGxpc3RlbmVyIG9ubHkgaW52b2tlZCB3aGVuIHN0YXRlXG4gICAgICAgIC8vIGFjdHVhbGx5IHVwZGF0ZWRcbiAgICAgICAgbG9nLmRlYnVnKCdzYXZlU25hcHNob3Q6IG5vIGNoYW5nZSBpbiBzdGF0ZSwgc2tpcHBpbmcgc25hcHNob3QnKTtcbiAgICB9XG59O1xuZXhwb3J0IHZhciBpbml0ID0gZnVuY3Rpb24gKHN0UmVmKSB7XG4gICAgdmFyIHNhdmVTdGF0ZUxpc3RlbmVyID0gZnVuY3Rpb24gKGFwcFN0YXRlKSB7XG4gICAgICAgIGxhdGVzdEJvb2ttYXJrSWRNYXAgPSBhcHBTdGF0ZS5ib29rbWFya0lkTWFwO1xuICAgICAgICBpZiAocHJldkJvb2ttYXJrSWRNYXAgPT0gbnVsbCkge1xuICAgICAgICAgICAgcHJldkJvb2ttYXJrSWRNYXAgPSBsYXRlc3RCb29rbWFya0lkTWFwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKGhhc0RpZmZzKHByZXZCb29rbWFya0lkTWFwLCBsYXRlc3RCb29rbWFya0lkTWFwKSkge1xuICAgICAgICAgICAgICAgIHRocm90dGxlZFNhdmVTdGF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICB2YXIgdGhyb3R0bGVkU2F2ZVNuYXBzaG90ID0gXy50aHJvdHRsZShmdW5jdGlvbiAoKSB7IHJldHVybiBzYXZlU25hcHNob3Qoc3RSZWYpOyB9LCAxMCAqIDEwMDApO1xuICAgIC8vIFdlIGNvbWJpbmUgb3VyIHR3byBsaXN0ZW5lcnMgdG8gd29yayBhcm91bmQgc3R1cGlkIGJ1ZyBpbiBvbmVyZWYsIHdoaWNoXG4gICAgLy8gdXNlcyAub24oKSBpbnN0ZWFkIG9mIC5hZGRMaXN0ZW5lcigpXG4gICAgdmFyIG1lcmdlZExpc3RlbmVyID0gZnVuY3Rpb24gKGFwcFN0YXRlKSB7XG4gICAgICAgIHNhdmVTdGF0ZUxpc3RlbmVyKGFwcFN0YXRlKTtcbiAgICAgICAgdGhyb3R0bGVkU2F2ZVNuYXBzaG90KCk7XG4gICAgfTtcbiAgICBhZGRTdGF0ZUNoYW5nZUxpc3RlbmVyKHN0UmVmLCBtZXJnZWRMaXN0ZW5lcik7XG59O1xuIiwiLyoqXG4gKiBCYWNrZ3JvdW5kIGhlbHBlciBwYWdlLlxuICogR2F0aGVyaW5nIGJvb2ttYXJrIGFuZCB3aW5kb3cgc3RhdGUgYW5kIHBsYWNlcyBpbiBsb2NhbCBzdG9yYWdlIHNvIHRoYXRcbiAqIHBvcHVwIHJlbmRlcmluZyB3aWxsIGJlIGFzIGZhc3QgYXMgcG9zc2libGVcbiAqL1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19nZW5lcmF0b3IgPSAodGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgYm9keSkge1xuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XG4gICAgICAgIHdoaWxlIChnICYmIChnID0gMCwgb3BbMF0gJiYgKF8gPSAwKSksIF8pIHRyeSB7XG4gICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5W1wicmV0dXJuXCJdIDogb3BbMF0gPyB5W1widGhyb3dcIl0gfHwgKCh0ID0geVtcInJldHVyblwiXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7XG4gICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07XG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTtcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XG4gICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTtcbiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfVxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcbiAgICB9XG59O1xudmFyIF9fcmVhZCA9ICh0aGlzICYmIHRoaXMuX19yZWFkKSB8fCBmdW5jdGlvbiAobywgbikge1xuICAgIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXTtcbiAgICBpZiAoIW0pIHJldHVybiBvO1xuICAgIHZhciBpID0gbS5jYWxsKG8pLCByLCBhciA9IFtdLCBlO1xuICAgIHRyeSB7XG4gICAgICAgIHdoaWxlICgobiA9PT0gdm9pZCAwIHx8IG4tLSA+IDApICYmICEociA9IGkubmV4dCgpKS5kb25lKSBhci5wdXNoKHIudmFsdWUpO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHsgZSA9IHsgZXJyb3I6IGVycm9yIH07IH1cbiAgICBmaW5hbGx5IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpW1wicmV0dXJuXCJdKSkgbS5jYWxsKGkpO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkgeyBpZiAoZSkgdGhyb3cgZS5lcnJvcjsgfVxuICAgIH1cbiAgICByZXR1cm4gYXI7XG59O1xudmFyIF9fdmFsdWVzID0gKHRoaXMgJiYgdGhpcy5fX3ZhbHVlcykgfHwgZnVuY3Rpb24obykge1xuICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7XG4gICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7XG4gICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSBcIm51bWJlclwiKSByZXR1cm4ge1xuICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwO1xuICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9O1xuICAgICAgICB9XG4gICAgfTtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyBcIk9iamVjdCBpcyBub3QgaXRlcmFibGUuXCIgOiBcIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XG59O1xuaW1wb3J0IGhhcyBmcm9tICdsb2Rhc2gvaGFzJztcbmltcG9ydCBmcm9tUGFpcnMgZnJvbSAnbG9kYXNoL2Zyb21QYWlycyc7XG5pbXBvcnQgKiBhcyBzZW12ZXIgZnJvbSAnc2VtdmVyJztcbmltcG9ydCB7IGdldExvZ2dlciwgbG9nIH0gZnJvbSAnLi9nbG9iYWxzJztcbmltcG9ydCBUYWJNYW5hZ2VyU3RhdGUgZnJvbSAnLi90YWJNYW5hZ2VyU3RhdGUnO1xuaW1wb3J0ICogYXMgdXRpbHMgZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgKiBhcyBhY3Rpb25zIGZyb20gJy4vYWN0aW9ucyc7XG5pbXBvcnQgKiBhcyBzYXZlZFN0YXRlIGZyb20gJy4vc2F2ZWRTdGF0ZSc7XG5pbXBvcnQgY2hyb21lcCBmcm9tICdjaHJvbWUtcHJvbWlzZSc7XG5pbXBvcnQgeyBUYWJXaW5kb3cgfSBmcm9tICcuL3RhYldpbmRvdyc7XG5pbXBvcnQgKiBhcyB0YWJXaW5kb3dVdGlscyBmcm9tICcuL3RhYldpbmRvd1V0aWxzJztcbmltcG9ydCB7IHVwZGF0ZSwgcmVtb3ZlU3RhdGVDaGFuZ2VMaXN0ZW5lciwgbWtSZWYsIGF3YWl0YWJsZVVwZGF0ZSwgbXV0YWJsZUdldCwgfSBmcm9tICdvbmVyZWYnO1xuaW1wb3J0IHsgUHJlZmVyZW5jZXMsIFVTRVJfUFJFRlNfS0VZIH0gZnJvbSAnLi9wcmVmZXJlbmNlcyc7XG52YXIgXyA9IHtcbiAgICBoYXM6IGhhcyxcbiAgICBmcm9tUGFpcnM6IGZyb21QYWlycyxcbn07XG52YXIgY2hyb21lRXZlbnRMb2cgPSBnZXRMb2dnZXIoJ2Nocm9tZS1ldmVudHMnKTtcbnV0aWxzLnNldExvZ0xldmVsKGNocm9tZUV2ZW50TG9nKTtcbnZhciB0YWJsaUZvbGRlclRpdGxlID0gJ1RhYmxpIFNhdmVkIFdpbmRvd3MnO1xudmFyIGFyY2hpdmVGb2xkZXJUaXRsZSA9ICdfQXJjaGl2ZSc7XG52YXIgdGFibGlGb2xkZXJJZCA9IG51bGw7XG52YXIgYXJjaGl2ZUZvbGRlcklkID0gbnVsbDtcbnZhciBpc1ZhbGlkV2luZG93Rm9sZGVyID0gZnVuY3Rpb24gKGJvb2ttYXJrTm9kZSkge1xuICAgIGlmIChfLmhhcyhib29rbWFya05vZGUsICd1cmwnKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChib29rbWFya05vZGUudGl0bGVbMF0gPT09ICdfJykge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufTtcbi8qIE9uIHN0YXJ0dXAgbG9hZCBtYW5hZ2VkIHdpbmRvd3MgZnJvbSBib29rbWFya3MgZm9sZGVyICovXG5mdW5jdGlvbiBsb2FkTWFuYWdlZFdpbmRvd3Mod2luU3RvcmUsIHRhYmxpRm9sZGVyKSB7XG4gICAgbG9nLmRlYnVnKCdsb2FkTWFuYWdlZFdpbmRvd3M6ICB0YWJsaUZvbGRlcjogJywgdGFibGlGb2xkZXIpO1xuICAgIHZhciBmb2xkZXJUYWJXaW5kb3dzID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0YWJsaUZvbGRlci5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgd2luZG93Rm9sZGVyID0gdGFibGlGb2xkZXIuY2hpbGRyZW5baV07XG4gICAgICAgIGlmIChpc1ZhbGlkV2luZG93Rm9sZGVyKHdpbmRvd0ZvbGRlcikpIHtcbiAgICAgICAgICAgIGZvbGRlclRhYldpbmRvd3MucHVzaCh0YWJXaW5kb3dVdGlscy5tYWtlRm9sZGVyVGFiV2luZG93KHdpbmRvd0ZvbGRlcikpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB3aW5TdG9yZS5yZWdpc3RlclRhYldpbmRvd3MoZm9sZGVyVGFiV2luZG93cyk7XG59XG4vKlxuICogZ2l2ZW4gYSBzcGVjaWZpYyBwYXJlbnQgRm9sZGVyIG5vZGUsIGVuc3VyZSBhIHBhcnRpY3VsYXIgY2hpbGQgZXhpc3RzLlxuICogcmV0dXJuczogUHJvbWlzZTxCb29rbWFya1RyZWVOb2RlPlxuICovXG5mdW5jdGlvbiBlbnN1cmVDaGlsZEZvbGRlcihwYXJlbnROb2RlLCBjaGlsZEZvbGRlck5hbWUpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBpLCBjaGlsZEZvbGRlciwgZm9sZGVyT2JqO1xuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICBpZiAocGFyZW50Tm9kZS5jaGlsZHJlbikge1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBwYXJlbnROb2RlLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoaWxkRm9sZGVyID0gcGFyZW50Tm9kZS5jaGlsZHJlbltpXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkRm9sZGVyLnRpdGxlLnRvTG93ZXJDYXNlKCkgPT09XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZEZvbGRlck5hbWUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXhpc3RzXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBsb2cuZGVidWcoJ2ZvdW5kIHRhcmdldCBjaGlsZCBmb2xkZXI6ICcsIGNoaWxkRm9sZGVyTmFtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBjaGlsZEZvbGRlcl07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsb2cuaW5mbygnQ2hpbGQgZm9sZGVyICcsIGNoaWxkRm9sZGVyTmFtZSwgJyBOb3QgZm91bmQsIGNyZWF0aW5nLi4uJyk7IC8vIElmIHdlIGdvdCBoZXJlLCBjaGlsZCBGb2xkZXIgZG9lc24ndCBleGlzdFxuICAgICAgICAgICAgZm9sZGVyT2JqID0ge1xuICAgICAgICAgICAgICAgIHBhcmVudElkOiBwYXJlbnROb2RlLmlkLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBjaGlsZEZvbGRlck5hbWUsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIGNocm9tZXAuYm9va21hcmtzLmNyZWF0ZShmb2xkZXJPYmopXTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG4vKipcbiAqXG4gKiBpbml0aWFsaXplIHNob3dSZWxOb3RlcyBmaWVsZCBvZiBUYWJNYW5hZ2VyU3RhdGUgYmFzZWQgb24gY29tcGFyaW5nXG4gKiByZWxOb3RlcyB2ZXJzaW9uIGZyb20gbG9jYWxTdG9yYWdlIHdpdGggdGhpcyBleHRlbnNpb24gbWFuaWZlc3RcbiAqXG4gKiBAcmV0dXJuIHtUYWJNYW5hZ2VyU3RhdGV9IHBvc3NpYmx5IHVwZGF0ZWQgVGFiTWFuYWdlclN0YXRlXG4gKi9cbmZ1bmN0aW9uIGluaXRSZWxOb3RlcyhzdCwgc3RvcmVkVmVyc2lvbikge1xuICAgIHZhciBtYW5pZmVzdCA9IGNocm9tZS5ydW50aW1lLmdldE1hbmlmZXN0KCk7IC8vICBsb2cuZGVidWcoXCJpbml0UmVsTm90ZXM6IHN0b3JlZFZlcnNpb246IFwiLCBzdG9yZWRWZXJzaW9uLCBcIiwgbWFuaWZlc3Q6IFwiLCBtYW5pZmVzdC52ZXJzaW9uKVxuICAgIHZhciBzaG93UmVsTm90ZXMgPSAhc2VtdmVyLnZhbGlkKHN0b3JlZFZlcnNpb24pIHx8XG4gICAgICAgIHNlbXZlci5ndChtYW5pZmVzdC52ZXJzaW9uLCBzdG9yZWRWZXJzaW9uKTtcbiAgICByZXR1cm4gc3Quc2V0KCdzaG93UmVsTm90ZXMnLCBzaG93UmVsTm90ZXMpO1xufVxuLyoqXG4gKiBhY3F1aXJlIG1haW4gZm9sZGVyIGFuZCBhcmNoaXZlIGZvbGRlciBhbmQgaW5pdGlhbGl6ZVxuICogd2luZG93IHN0b3JlXG4gKlxuICogcmV0dXJuczogUHJvbWlzZTxUYWJNYW5hZ2VyU3RhdGU+XG4gKi9cbnZhciBpbml0V2luU3RvcmUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgIHZhciB0cmVlLCByb290Q2hpbGRyZW4sIG90aGVyQm9va21hcmtzTm9kZSwgdGFibGlGb2xkZXIsIGFyY2hpdmVGb2xkZXIsIHN1YlRyZWVOb2RlcywgYmFzZVdpblN0b3JlLCBsb2FkZWRXaW5TdG9yZSwgaXRlbXMsIHJlbE5vdGVzU3RvcmU7XG4gICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIGNocm9tZXAuYm9va21hcmtzLmdldFRyZWUoKV07XG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgdHJlZSA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICByb290Q2hpbGRyZW4gPSB0cmVlWzBdLmNoaWxkcmVuO1xuICAgICAgICAgICAgICAgIG90aGVyQm9va21hcmtzTm9kZSA9IHJvb3RDaGlsZHJlblsxXTtcbiAgICAgICAgICAgICAgICBpZiAob3RoZXJCb29rbWFya3NOb2RlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oXCJDb3VsZCBub3QgYXR0YWNoIHRvIENocm9tZSBwcmVkZWZpbmVkICdPdGhlciBCb29rbWFya3MnIGZvbGRlclwiKTtcbiAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oJ0F0dGVtcHRpbmcgdG8gYXR0YWNoIHRvIHJvb3QgKEJvb21hcmtzIEJhcikgYXMgYSB3b3JrYXJvdW5kIGZvciBCcmF2ZSBCcm93c2VyIGlzc3VlJyk7XG4gICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCdTZWUgaHR0cHM6Ly9naXRodWIuY29tL2JyYXZlL2JyYXZlLWJyb3dzZXIvaXNzdWVzLzc2MzkgZm9yIGFkZGl0aW9uYWwgaW5mbycpO1xuICAgICAgICAgICAgICAgICAgICBvdGhlckJvb2ttYXJrc05vZGUgPSByb290Q2hpbGRyZW5bcm9vdENoaWxkcmVuLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnKFwiJ090aGVyIEJvb2ttYXJrcycgZm9sZGVyIGFjcXVpcmVkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBlbnN1cmVDaGlsZEZvbGRlcihvdGhlckJvb2ttYXJrc05vZGUsIHRhYmxpRm9sZGVyVGl0bGUpXTtcbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICB0YWJsaUZvbGRlciA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICB0YWJsaUZvbGRlcklkID0gdGFibGlGb2xkZXIuaWQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgZW5zdXJlQ2hpbGRGb2xkZXIodGFibGlGb2xkZXIsIGFyY2hpdmVGb2xkZXJUaXRsZSldO1xuICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgIGFyY2hpdmVGb2xkZXIgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgYXJjaGl2ZUZvbGRlcklkID0gYXJjaGl2ZUZvbGRlci5pZDtcbiAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBjaHJvbWVwLmJvb2ttYXJrcy5nZXRTdWJUcmVlKHRhYmxpRm9sZGVyLmlkKV07XG4gICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgc3ViVHJlZU5vZGVzID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgIGJhc2VXaW5TdG9yZSA9IFRhYk1hbmFnZXJTdGF0ZS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICBmb2xkZXJJZDogdGFibGlGb2xkZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgYXJjaGl2ZUZvbGRlcklkOiBhcmNoaXZlRm9sZGVySWQsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgbG9hZGVkV2luU3RvcmUgPSBsb2FkTWFuYWdlZFdpbmRvd3MoYmFzZVdpblN0b3JlLCBzdWJUcmVlTm9kZXNbMF0pO1xuICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZygnaW5pdFdpblN0b3JlOiBhZnRlciBsb2FkTWFuYWdlZFdpbmRvd3M6IGxvYWRlZFdpblN0b3JlOiAnLCBsb2FkZWRXaW5TdG9yZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgY2hyb21lcC5zdG9yYWdlLmxvY2FsLmdldCh7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkUmVsTm90ZXNWZXJzaW9uOiAnJyxcbiAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgIGl0ZW1zID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgIHJlbE5vdGVzU3RvcmUgPSBpbml0UmVsTm90ZXMobG9hZGVkV2luU3RvcmUsIGl0ZW1zLnJlYWRSZWxOb3Rlc1ZlcnNpb24pO1xuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCByZWxOb3Rlc1N0b3JlXTtcbiAgICAgICAgfVxuICAgIH0pO1xufSk7IH07XG5mdW5jdGlvbiBzZXR1cENvbm5lY3Rpb25MaXN0ZW5lcihzdGF0ZVJlZikge1xuICAgIGNocm9tZS5ydW50aW1lLm9uQ29ubmVjdC5hZGRMaXN0ZW5lcihmdW5jdGlvbiAocG9ydCkge1xuICAgICAgICBjaHJvbWVFdmVudExvZy5kZWJ1ZygnQ2hyb21lIEV2ZW50OiBvbkNvbm5lY3QnKTtcbiAgICAgICAgcG9ydC5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoZnVuY3Rpb24gKG1zZykge1xuICAgICAgICAgICAgY2hyb21lRXZlbnRMb2cuZGVidWcoJ0Nocm9tZSBFdmVudDogb25NZXNzYWdlICcsIG1zZyk7XG4gICAgICAgICAgICB2YXIgbGlzdGVuZXJJZCA9IG1zZy5saXN0ZW5lcklkO1xuICAgICAgICAgICAgcG9ydC5vbkRpc2Nvbm5lY3QuYWRkTGlzdGVuZXIoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNocm9tZUV2ZW50TG9nLmRlYnVnKCdDaHJvbWUgRXZlbnQ6IG9uRGlzY29ubmVjdCcpO1xuICAgICAgICAgICAgICAgIHJlbW92ZVN0YXRlQ2hhbmdlTGlzdGVuZXIoc3RhdGVSZWYsIGxpc3RlbmVySWQpO1xuICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZygnUmVtb3ZlZCB2aWV3IGxpc3RlbmVyICcsIGxpc3RlbmVySWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gc2V0dXBNZXNzYWdlTGlzdGVuZXIoc3RhdGVSZWYpIHtcbiAgICBjaHJvbWUucnVudGltZS5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoZnVuY3Rpb24gKG1zZywgc2VuZGVyLCBzZW5kUmVzcG9uc2UpIHtcbiAgICAgICAgY2hyb21lRXZlbnRMb2cuZGVidWcoJ0Nocm9tZSBFdmVudDogb25NZXNzYWdlOiAnLCBtc2cpO1xuICAgICAgICB2YXIgdHlwZSA9IG1zZy50eXBlO1xuICAgICAgICBpZiAodHlwZSA9PT0gJ2dldFRhYmxpU3RhdGUnKSB7XG4gICAgICAgICAgICB2YXIgc3QgPSBtdXRhYmxlR2V0KHN0YXRlUmVmKTtcbiAgICAgICAgICAgIHZhciBzZXJTdCA9IHN0LnRvSlMoKTtcbiAgICAgICAgICAgIGNocm9tZUV2ZW50TG9nLmRlYnVnKCdzZW5kaW5nIHN0YXRlOiAnLCBzZXJTdCk7XG4gICAgICAgICAgICBzZW5kUmVzcG9uc2Uoc2VyU3QpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG4vKipcbiAqIERvd25sb2FkIHRoZSBzcGVjaWZpZWQgb2JqZWN0IGFzIEpTT04gKGZvciB0ZXN0aW5nKVxuICovXG5mdW5jdGlvbiBkb3dubG9hZEpTT04oZHVtcE9iaiwgZmlsZW5hbWUpIHtcbiAgICB2YXIgZHVtcFN0ciA9IEpTT04uc3RyaW5naWZ5KGR1bXBPYmosIG51bGwsIDIpO1xuICAgIHZhciB3aW5CbG9iID0gbmV3IEJsb2IoW2R1bXBTdHJdLCB7XG4gICAgICAgIHR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICB9KTtcbiAgICB2YXIgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTCh3aW5CbG9iKTtcbiAgICBjaHJvbWUuZG93bmxvYWRzLmRvd25sb2FkKHtcbiAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgIGZpbGVuYW1lOiBmaWxlbmFtZSxcbiAgICB9KTtcbn1cbi8qKlxuICogZHVtcCBhbGwgd2luZG93cyAtLSB1c2VmdWwgZm9yIGNyZWF0aW5nIHBlcmZvcm1hbmNlIHRlc3RzXG4gKlxuICogTk9URTogIFJlcXVpcmVzIHRoZSBcImRvd25sb2Fkc1wiIHBlcm1pc3Npb24gaW4gdGhlIG1hbmlmZXN0IVxuICovXG5mdW5jdGlvbiBkdW1wQWxsKHdpblN0b3JlKSB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bnVzZWQtdmFyc1xuICAgIHZhciBhbGxXaW5kb3dzID0gd2luU3RvcmUuZ2V0QWxsKCk7XG4gICAgdmFyIGpzV2luZG93cyA9IGFsbFdpbmRvd3MubWFwKGZ1bmN0aW9uICh0dykgeyByZXR1cm4gdHcudG9KUygpOyB9KTtcbiAgICB2YXIgZHVtcE9iaiA9IHtcbiAgICAgICAgYWxsV2luZG93czoganNXaW5kb3dzLFxuICAgIH07XG4gICAgZG93bmxvYWRKU09OKGR1bXBPYmosICd3aW5TdG9yZVNuYXAuanNvbicpO1xufVxuZnVuY3Rpb24gZHVtcENocm9tZVdpbmRvd3MoKSB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bnVzZWQtdmFyc1xuICAgIGNocm9tZS53aW5kb3dzLmdldEFsbCh7XG4gICAgICAgIHBvcHVsYXRlOiB0cnVlLFxuICAgIH0sIGZ1bmN0aW9uIChjaHJvbWVXaW5kb3dzKSB7XG4gICAgICAgIGRvd25sb2FkSlNPTih7XG4gICAgICAgICAgICBjaHJvbWVXaW5kb3dzOiBjaHJvbWVXaW5kb3dzLFxuICAgICAgICB9LCAnY2hyb21lV2luZG93U25hcC5qc29uJyk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBvblRhYkNyZWF0ZWQoc3RhdGVSZWZfMSwgdGFiXzEpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIGFyZ3VtZW50cywgdm9pZCAwLCBmdW5jdGlvbiAoc3RhdGVSZWYsIHRhYiwgbWFya0FjdGl2ZSkge1xuICAgICAgICB2YXIgX2EsIHN0LCBfO1xuICAgICAgICBpZiAobWFya0FjdGl2ZSA9PT0gdm9pZCAwKSB7IG1hcmtBY3RpdmUgPSBmYWxzZTsgfVxuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9iKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKF9iLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRhYikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hyb21lRXZlbnRMb2cuZGVidWcoJ0Nocm9tZSBFdmVudDogdGFicy5vbkNyZWF0ZWQ6IGludm9rZWQgd2l0aCB1bmRlZmluZWQgdGFiJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2hyb21lRXZlbnRMb2cuZGVidWcoJ0Nocm9tZSBFdmVudDogdGFicy5vbkNyZWF0ZWQ6ICcsIHRhYik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGF3YWl0YWJsZVVwZGF0ZShzdGF0ZVJlZiwgZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYldpbmRvdyA9IHN0YXRlLmdldFRhYldpbmRvd0J5Q2hyb21lSWQodGFiLndpbmRvd0lkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRhYldpbmRvdykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybigndGFicy5vbkNyZWF0ZWQ6IHdpbmRvdyBpZCBub3QgZm91bmQ6ICcsIHRhYi53aW5kb3dJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbc3RhdGUsIG51bGxdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3BlbmVyVXJsID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YWIub3BlbmVyVGFiSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVudHJ5ID0gdGFiV2luZG93LmZpbmRDaHJvbWVUYWJJZCh0YWIub3BlbmVyVGFiSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW50cnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfYSA9IF9fcmVhZChlbnRyeSwgMiksIF8xID0gX2FbMF0sIG9wZW5lclRhYkl0ZW0gPSBfYVsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lclVybCA9IG9wZW5lclRhYkl0ZW0udXJsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdCA9IHN0YXRlLmhhbmRsZVRhYkNyZWF0ZWQodGFiV2luZG93LCB0YWIsIG9wZW5lclVybCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG53ID0gc3QuZ2V0VGFiV2luZG93QnlDaHJvbWVJZCh0YWIud2luZG93SWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhc3QgPSBtYXJrQWN0aXZlID8gc3QuaGFuZGxlVGFiQWN0aXZhdGVkKG53LCB0YWIuaWQpIDogc3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFthc3QsIG51bGxdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgX2EgPSBfX3JlYWQuYXBwbHkodm9pZCAwLCBbX2Iuc2VudCgpLCAyXSksIHN0ID0gX2FbMF0sIF8gPSBfYVsxXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0LnByZWZlcmVuY2VzLmRlZHVwZVRhYnMgJiYgdGFiLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBsZXQncyB0cnkgcGFzc2luZyB0YWIgYXMgY2hhbmdlSW5mbyBzaW5jZSBwcmVzdW1hYnkgdGhlXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBrZXlzIGFyZSB0aGUgc2FtZTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZHVwZVRhYihzdCwgc3RhdGVSZWYsIHRhYi5pZCwgdGFiLCB0YWIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBvblRhYlJlbW92ZWQoc3RhdGVSZWYsIHdpbmRvd0lkLCB0YWJJZCkge1xuICAgIGxvZy5kZWJ1Zygnb25UYWJSZW1vdmVkOiAnLCB3aW5kb3dJZCwgdGFiSWQpO1xuICAgIHVwZGF0ZShzdGF0ZVJlZiwgZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgIHZhciB0YWJXaW5kb3cgPSBzdGF0ZS5nZXRUYWJXaW5kb3dCeUNocm9tZUlkKHdpbmRvd0lkKTtcbiAgICAgICAgaWYgKCF0YWJXaW5kb3cpIHtcbiAgICAgICAgICAgIGxvZy5pbmZvKCd0YWJzLm9uVGFiUmVtb3ZlZDogd2luZG93IGlkIG5vdCBmb3VuZDogJywgd2luZG93SWQpO1xuICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdGF0ZS5oYW5kbGVUYWJDbG9zZWQodGFiV2luZG93LCB0YWJJZCk7XG4gICAgfSk7XG59XG52YXIgZGVkdXBlVGFiID0gZnVuY3Rpb24gKHN0LCBzdGF0ZVJlZiwgdGFiSWQsIGNoYW5nZUluZm8sIHRhYikgeyByZXR1cm4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIganNpZnlQYWlycywgdXJsLCB0YWJJdGVtLCBtYXRjaFBhaXJzLCBpc1NlbGZfMSwgZmlsdGVyZWRNYXRjaFBhaXJzLCBfYSwgb3JpZ1RhYldpbmRvdywgb3JpZ1RhYiwgdGFiV2luZG93LCBlXzE7XG4gICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYikge1xuICAgICAgICBzd2l0Y2ggKF9iLmxhYmVsKSB7XG4gICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAganNpZnlQYWlycyA9IGZ1bmN0aW9uIChwYWlycykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFpcnMubWFwKGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9iID0gX19yZWFkKF9hLCAyKSwgYSA9IF9iWzBdLCBiID0gX2JbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW2EudG9KUygpLCBiLnRvSlMoKV07XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgX2IubGFiZWwgPSAxO1xuICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgIF9iLnRyeXMucHVzaChbMSwgNSwgLCA2XSk7XG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgZ2VuZXJhbCB0YWIgZGVkdXBsaWNhdGlvbiBpcyBlbmFibGVkXG4gICAgICAgICAgICAgICAgaWYgKCFzdC5wcmVmZXJlbmNlcy5kZWR1cGVUYWJzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTsgLy8gRXhpdCBlYXJseSBpZiBnZW5lcmFsIGRlZHVwbGljYXRpb24gaXMgZGlzYWJsZWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdXJsID0gY2hhbmdlSW5mby51cmw7XG4gICAgICAgICAgICAgICAgaWYgKCEodXJsICE9IG51bGwgJiYgdXJsLmxlbmd0aCA+IDApKSByZXR1cm4gWzMgLypicmVhayovLCA0XTtcbiAgICAgICAgICAgICAgICB0YWJJdGVtID0gc3QuZ2V0VGFiSXRlbUJ5Q2hyb21lVGFiSWQodGFiSWQpO1xuICAgICAgICAgICAgICAgIC8vIElmIHVybCBtYXRjaGVzIHRhYkl0ZW0ub3BlbmVyVXJsLCB0aGlzIGlzIHVzdWFsbHkgYSB1c2VyLWluaXRpYXRlZCBEdXBsaWNhdGVcbiAgICAgICAgICAgICAgICAvLyBvcGVyYXRpb24gKHZpYSB0YWIgY29udGV4dCBtZW51KSwgc28gc2tpcCBkZS1kdXAnaW5nOlxuICAgICAgICAgICAgICAgIGlmICh0YWJJdGVtICYmXG4gICAgICAgICAgICAgICAgICAgIHRhYkl0ZW0ub3BlbiAmJlxuICAgICAgICAgICAgICAgICAgICB0YWJJdGVtLm9wZW5TdGF0ZS5vcGVuZXJVcmwgPT09IHVybCkge1xuICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcoJ2RlZHVwZVRhYjogdXNlci1pbml0aWF0ZWQgRHVwbGljYXRlIG9mICcsIHVybCwgJywgc2tpcHBpbmcuLi4nKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBtYXRjaFBhaXJzID0gc3QuZmluZFVSTCh1cmwpO1xuICAgICAgICAgICAgICAgIGlzU2VsZl8xID0gZnVuY3Rpb24gKHR3LCB0aSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHcub3BlbiAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgdHcub3BlbldpbmRvd0lkID09PSB0YWIud2luZG93SWQgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpLm9wZW4gJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpLm9wZW5TdGF0ZS5vcGVuVGFiSWQgPT09IHRhYklkO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgZmlsdGVyZWRNYXRjaFBhaXJzID0gbWF0Y2hQYWlycy5maWx0ZXIoZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfYiA9IF9fcmVhZChfYSwgMiksIHR3ID0gX2JbMF0sIHRpID0gX2JbMV07XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAhaXNTZWxmXzEodHcsIHRpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoIShmaWx0ZXJlZE1hdGNoUGFpcnMubGVuZ3RoID4gMCkpIHJldHVybiBbMyAvKmJyZWFrKi8sIDRdO1xuICAgICAgICAgICAgICAgIF9hID0gX19yZWFkKGZpbHRlcmVkTWF0Y2hQYWlyc1swXSwgMiksIG9yaWdUYWJXaW5kb3cgPSBfYVswXSwgb3JpZ1RhYiA9IF9hWzFdO1xuICAgICAgICAgICAgICAgIC8vIGlmIHdlIHdhbnRlZCB0byBwcm9ncmFtYXRpY2FsbHkgZ28gYmFjayBpbnN0ZWFkIG9mIGNsb3Npbmc6XG4gICAgICAgICAgICAgICAgLy8gKHJlcXVpcmVkIDxhbGxfdXJscz4gcGVybWlzc2lvbiBpbiBtYW5pZmVzdClcbiAgICAgICAgICAgICAgICAvLyBjb25zdCByZXZlcnRTY3JpcHQgPSB7Y29kZTogJ2hpc3RvcnkuYmFjaygpOyd9XG4gICAgICAgICAgICAgICAgLy8gYXdhaXQgY2hyb21lcC50YWJzLmV4ZWN1dGVTY3JpcHQodGFiSWQsIHJldmVydFNjcmlwdClcbiAgICAgICAgICAgICAgICBsb2cuZGVidWcoJyoqKiBkZWR1cGVUYWI6IGNsb3NpbmcgZGV0ZWN0ZWQgZHVwbGljYXRlIHRhYiAnLCB0YWJJZCk7XG4gICAgICAgICAgICAgICAgdGFiV2luZG93ID0gc3QuZ2V0VGFiV2luZG93QnlDaHJvbWVJZCh0YWIud2luZG93SWQpO1xuICAgICAgICAgICAgICAgIGlmICghdGFiV2luZG93KSByZXR1cm4gWzMgLypicmVhayovLCA0XTtcbiAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBhY3Rpb25zLmNsb3NlVGFiKHRhYldpbmRvdywgdGFiSWQsIHN0YXRlUmVmKV07XG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgX2Iuc2VudCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGFjdGlvbnMuYWN0aXZhdGVPclJlc3RvcmVUYWIob3JpZ1RhYldpbmRvdywgb3JpZ1RhYiwgMCwgc3RhdGVSZWYpXTtcbiAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICBfYi5zZW50KCk7XG4gICAgICAgICAgICAgICAgX2IubGFiZWwgPSA0O1xuICAgICAgICAgICAgY2FzZSA0OiByZXR1cm4gWzMgLypicmVhayovLCA2XTtcbiAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICBlXzEgPSBfYi5zZW50KCk7XG4gICAgICAgICAgICAgICAgbG9nLndhcm4oJ2NhdWdodCBlcnJvciBkdXJpbmcgdGFiIGRlLWR1cCAoaWdub3JpbmcuLi4pOiAnLCBlXzEpO1xuICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDZdO1xuICAgICAgICAgICAgY2FzZSA2OiByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgIH1cbiAgICB9KTtcbn0pOyB9O1xudmFyIG9uVGFiVXBkYXRlZCA9IGZ1bmN0aW9uIChzdGF0ZVJlZiwgdGFiSWQsIGNoYW5nZUluZm8sIHRhYikgeyByZXR1cm4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgX2EsIHN0LCBfO1xuICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2IpIHtcbiAgICAgICAgc3dpdGNoIChfYi5sYWJlbCkge1xuICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgIGNocm9tZUV2ZW50TG9nLmRlYnVnKCdDaHJvbWUgRXZlbnQ6IHRhYnMub25VcGRhdGVkOiAnLCB0YWJJZCwgY2hhbmdlSW5mbywgdGFiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBhd2FpdGFibGVVcGRhdGUoc3RhdGVSZWYsIGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYldpbmRvdyA9IHN0YXRlLmdldFRhYldpbmRvd0J5Q2hyb21lSWQodGFiLndpbmRvd0lkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGFiV2luZG93KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oJ3RhYnMub25VcGRhdGVkOiB3aW5kb3cgaWQgbm90IGZvdW5kOiAnLCB0YWIud2luZG93SWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbc3RhdGUsIG51bGxdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtzdGF0ZS5oYW5kbGVUYWJVcGRhdGVkKHRhYldpbmRvdywgdGFiSWQsIGNoYW5nZUluZm8pLCBudWxsXTtcbiAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgIF9hID0gX19yZWFkLmFwcGx5KHZvaWQgMCwgW19iLnNlbnQoKSwgMl0pLCBzdCA9IF9hWzBdLCBfID0gX2FbMV07XG4gICAgICAgICAgICAgICAgaWYgKHN0LnByZWZlcmVuY2VzLmRlZHVwZVRhYnMpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVkdXBlVGFiKHN0LCBzdGF0ZVJlZiwgdGFiSWQsIGNoYW5nZUluZm8sIHRhYik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgfVxuICAgIH0pO1xufSk7IH07XG52YXIgb25Cb29rbWFya0NyZWF0ZWQgPSBmdW5jdGlvbiAoc3RhdGVSZWYsIGlkLCBib29rbWFyaykge1xuICAgIGNocm9tZUV2ZW50TG9nLmRlYnVnKCdDaHJvbWUgRXZlbnQ6IGJvb21hcmtzLm9uQ3JlYXRlZDogJywgaWQsIGJvb2ttYXJrKTtcbiAgICB1cGRhdGUoc3RhdGVSZWYsIGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICB2YXIgbmV4dFN0ID0gc3RhdGU7XG4gICAgICAgIC8qIGlzIHRoaXMgYm9va21hcmsgYSBmb2xkZXI/ICovXG4gICAgICAgIGlmICghaXNWYWxpZFdpbmRvd0ZvbGRlcihib29rbWFyaykpIHtcbiAgICAgICAgICAgIC8vIE9yZGluYXJ5IChub24tZm9sZGVyKSBib29rbWFya1xuICAgICAgICAgICAgLy8gSXMgcGFyZW50IGEgVGFibGkgd2luZG93IGZvbGRlcj9cbiAgICAgICAgICAgIHZhciB0YWJXaW5kb3cgPSBzdGF0ZS5nZXRTYXZlZFdpbmRvd0J5Qm9va21hcmtJZChib29rbWFyay5wYXJlbnRJZCk7XG4gICAgICAgICAgICBpZiAodGFiV2luZG93KSB7XG4gICAgICAgICAgICAgICAgLy8gRG8gd2UgYWxyZWFkeSBoYXZlIHRoaXMgYXMgYSBzYXZlZCB0YWI/XG4gICAgICAgICAgICAgICAgdmFyIGVudHJ5ID0gdGFiV2luZG93LmZpbmRDaHJvbWVCb29rbWFya0lkKGJvb2ttYXJrLmlkKTtcbiAgICAgICAgICAgICAgICBpZiAoIWVudHJ5KSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZygnbmV3IGJvb2ttYXJrIGluIHNhdmVkIHdpbmRvdzogJywgYm9va21hcmspO1xuICAgICAgICAgICAgICAgICAgICBuZXh0U3QgPSBzdGF0ZS5oYW5kbGVCb29rbWFya0NyZWF0ZWQodGFiV2luZG93LCBib29rbWFyayk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gZm9sZGVyICh3aW5kb3cpIGJvb2ttYXJrXG4gICAgICAgICAgICAvLyBJcyB0aGlzIGEgVGFibGkgd2luZG93IGZvbGRlciAocGFyZW50IGlzIFRhYmxpIGZvbGRlcj8pXG4gICAgICAgICAgICBpZiAoYm9va21hcmsucGFyZW50SWQgPT09IHRhYmxpRm9sZGVySWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGFiV2luZG93ID0gc3RhdGUuZ2V0U2F2ZWRXaW5kb3dCeUJvb2ttYXJrSWQoYm9va21hcmsuaWQpO1xuICAgICAgICAgICAgICAgIGlmICghdGFiV2luZG93KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIG5ldyBzYXZlZCB3aW5kb3cgKGJvb2ttYXJrIGZvbGRlcikgbm90IGluIGxvY2FsIHN0YXRlXG4gICAgICAgICAgICAgICAgICAgIHZhciB0dyA9IHRhYldpbmRvd1V0aWxzLm1ha2VGb2xkZXJUYWJXaW5kb3coYm9va21hcmspO1xuICAgICAgICAgICAgICAgICAgICBuZXh0U3QgPSBzdGF0ZS5yZWdpc3RlclRhYldpbmRvdyh0dyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXh0U3Q7XG4gICAgfSk7XG59O1xudmFyIGhhbmRsZUJvb2ttYXJrVXBkYXRlID0gZnVuY3Rpb24gKHN0YXRlUmVmLCBwYXJlbnRJZCwgYm9va21hcmssIGhhbmRsZVRhYiwgaGFuZGxlVGFiV2luZG93KSB7XG4gICAgbG9nLmRlYnVnKCdoYW5kbGVCb29rbWFya1VwZGF0ZTogJywgYm9va21hcmspO1xuICAgIHVwZGF0ZShzdGF0ZVJlZiwgZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgIHZhciBuZXh0U3QgPSBzdGF0ZTtcbiAgICAgICAgLyogaXMgdGhpcyBib29rbWFyayBhIGZvbGRlcj8gKi9cbiAgICAgICAgaWYgKCFpc1ZhbGlkV2luZG93Rm9sZGVyKGJvb2ttYXJrKSkge1xuICAgICAgICAgICAgLy8gT3JkaW5hcnkgKG5vbi1mb2xkZXIpIGJvb2ttYXJrXG4gICAgICAgICAgICAvLyBJcyBwYXJlbnQgYSBUYWJsaSB3aW5kb3cgZm9sZGVyP1xuICAgICAgICAgICAgdmFyIHRhYldpbmRvdyA9IHN0YXRlLmdldFNhdmVkV2luZG93QnlCb29rbWFya0lkKHBhcmVudElkKTtcbiAgICAgICAgICAgIGlmICh0YWJXaW5kb3cpIHtcbiAgICAgICAgICAgICAgICAvLyBEbyB3ZSBhbHJlYWR5IGhhdmUgdGhpcyBhcyBhIHNhdmVkIHRhYj9cbiAgICAgICAgICAgICAgICB2YXIgZW50cnkgPSB0YWJXaW5kb3cuZmluZENocm9tZUJvb2ttYXJrSWQoYm9va21hcmsuaWQpO1xuICAgICAgICAgICAgICAgIGlmIChlbnRyeSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX2EgPSBfX3JlYWQoZW50cnksIDIpLCBpbmRleCA9IF9hWzBdLCB0YWJJdGVtID0gX2FbMV07XG4gICAgICAgICAgICAgICAgICAgIG5leHRTdCA9IGhhbmRsZVRhYihzdGF0ZSwgdGFiV2luZG93LCBpbmRleCwgdGFiSXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gZm9sZGVyICh3aW5kb3cpIGJvb2ttYXJrXG4gICAgICAgICAgICAvLyBJcyB0aGlzIGEgVGFibGkgd2luZG93IGZvbGRlciAocGFyZW50IGlzIFRhYmxpIGZvbGRlcj8pXG4gICAgICAgICAgICBpZiAocGFyZW50SWQgPT09IHRhYmxpRm9sZGVySWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGFiV2luZG93ID0gc3RhdGUuZ2V0U2F2ZWRXaW5kb3dCeUJvb2ttYXJrSWQoYm9va21hcmsuaWQpO1xuICAgICAgICAgICAgICAgIGlmICh0YWJXaW5kb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV4dFN0ID0gaGFuZGxlVGFiV2luZG93KHN0YXRlLCB0YWJXaW5kb3cpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV4dFN0O1xuICAgIH0pO1xufTtcbnZhciBvbkJvb2ttYXJrUmVtb3ZlZCA9IGZ1bmN0aW9uIChzdGF0ZVJlZiwgaWQsIHJlbW92ZUluZm8pIHtcbiAgICBjaHJvbWVFdmVudExvZy5kZWJ1ZygnQ2hyb21lIEV2ZW50OiBib29rbWFya3Mub25SZW1vdmVkOiAnLCBpZCwgcmVtb3ZlSW5mbyk7XG4gICAgaGFuZGxlQm9va21hcmtVcGRhdGUoc3RhdGVSZWYsIHJlbW92ZUluZm8ucGFyZW50SWQsIHJlbW92ZUluZm8ubm9kZSwgZnVuY3Rpb24gKHN0LCB0YWJXaW5kb3csIGluZGV4LCB0YWJJdGVtKSB7XG4gICAgICAgIHJldHVybiBzdC5oYW5kbGVUYWJVbnNhdmVkKHRhYldpbmRvdywgdGFiSXRlbSk7XG4gICAgfSwgZnVuY3Rpb24gKHN0LCB0YWJXaW5kb3cpIHsgcmV0dXJuIHN0LnVubWFuYWdlV2luZG93KHRhYldpbmRvdyk7IH0pO1xufTtcbnZhciBzYWZlVXBkYXRlV2luZG93VGl0bGUgPSBmdW5jdGlvbiAoc3QsIHRhYldpbmRvdywgdGl0bGUpIHtcbiAgICByZXR1cm4gdGl0bGUgPT0gbnVsbCA/IHN0IDogc3QudXBkYXRlU2F2ZWRXaW5kb3dUaXRsZSh0YWJXaW5kb3csIHRpdGxlKTtcbn07XG52YXIgb25Cb29rbWFya0NoYW5nZWQgPSBmdW5jdGlvbiAoc3RhdGVSZWYsIGlkLCBjaGFuZ2VJbmZvKSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgIHZhciByZXMsIGJvb2ttYXJrO1xuICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgIGNocm9tZUV2ZW50TG9nLmRlYnVnKCdDaHJvbWUgRXZlbnQ6IGJvb2ttYXJrcy5PbmNoYW5nZWQ6ICcsIGlkLCBjaGFuZ2VJbmZvKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBjaHJvbWVwLmJvb2ttYXJrcy5nZXQoaWQpXTtcbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICByZXMgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgaWYgKHJlcyAmJiByZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBib29rbWFyayA9IHJlc1swXTtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlQm9va21hcmtVcGRhdGUoc3RhdGVSZWYsIGJvb2ttYXJrLnBhcmVudElkLCBib29rbWFyaywgZnVuY3Rpb24gKHN0LCB0YWJXaW5kb3csIGluZGV4LCB0YWJJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3QuaGFuZGxlQm9va21hcmtVcGRhdGVkKHRhYldpbmRvdywgdGFiSXRlbSwgY2hhbmdlSW5mbyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChzdCwgdGFiV2luZG93KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2FmZVVwZGF0ZVdpbmRvd1RpdGxlKHN0LCB0YWJXaW5kb3csIGNoYW5nZUluZm8udGl0bGUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICB9XG4gICAgfSk7XG59KTsgfTtcbnZhciBvbkJvb2ttYXJrTW92ZWQgPSBmdW5jdGlvbiAoc3RhdGVSZWYsIGlkLCBtb3ZlSW5mbykge1xuICAgIGNocm9tZUV2ZW50TG9nLmRlYnVnKCdDaHJvbWUgRXZlbnQ6IGJvb2ttYXJrcy5vbk1vdmVkOiAnLCBpZCwgbW92ZUluZm8pO1xuICAgIGlmIChtb3ZlSW5mby5vbGRQYXJlbnRJZCA9PT0gdGFibGlGb2xkZXJJZCAmJlxuICAgICAgICBtb3ZlSW5mby5wYXJlbnRJZCA9PT0gYXJjaGl2ZUZvbGRlcklkKSB7XG4gICAgICAgIC8vIGxvb2tzIGxpa2Ugd2luZG93IHdhcyB1bm1hbmFnZWQ6XG4gICAgICAgIHVwZGF0ZShzdGF0ZVJlZiwgZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgICAgICB2YXIgbmV4dFN0ID0gc3RhdGU7XG4gICAgICAgICAgICB2YXIgdGFiV2luZG93ID0gc3RhdGUuZ2V0U2F2ZWRXaW5kb3dCeUJvb2ttYXJrSWQoaWQudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICBpZiAodGFiV2luZG93KSB7XG4gICAgICAgICAgICAgICAgbmV4dFN0ID0gc3RhdGUudW5tYW5hZ2VXaW5kb3codGFiV2luZG93KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXh0U3Q7XG4gICAgICAgIH0pO1xuICAgIH1cbn07XG4vKlxuICogZXhhbWluZSBjaGFuZ2UgZXZlbnQgZGF0YSBmb3Igc3RvcmFnZSwgYW5kIHJldHVybiBhIHN0b3JlZCBQcmVmZXJlbmNlcyB1cGRhdGUgaWYgZm91bmRcbiAqL1xuZnVuY3Rpb24gcHJlZnNTdG9yYWdlQ2hhbmdlKGNoYW5nZXMsIG5hbWVzcGFjZSkge1xuICAgIGlmIChuYW1lc3BhY2UgPT09ICdsb2NhbCcpIHtcbiAgICAgICAgdmFyIG1heWJlUHJlZnNTdHIgPSBjaGFuZ2VzW1VTRVJfUFJFRlNfS0VZXTtcbiAgICAgICAgaWYgKCFtYXliZVByZWZzU3RyKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcHJlZnNTdHIgPSBtYXliZVByZWZzU3RyLm5ld1ZhbHVlO1xuICAgICAgICBpZiAoIXByZWZzU3RyKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUHJlZmVyZW5jZXMuZGVzZXJpYWxpemUocHJlZnNTdHIpO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn1cbi8qXG4gKiBleGFtaW5lIHNlc3Npb24gY2hhbmdlIGV2ZW50IGRhdGEgZm9yIHN0YXRlU25hcHNob3QsIGFuZCByZXR1cm4gYSB0YWJNYW5hZ2VyU3RhdGUgaWYgZm91bmRcbiAqL1xuZnVuY3Rpb24gc3RhdGVTbmFwc2hvdFN0b3JhZ2VDaGFuZ2UoY2hhbmdlcywgbmFtZXNwYWNlKSB7XG4gICAgaWYgKG5hbWVzcGFjZSA9PT0gJ3Nlc3Npb24nKSB7XG4gICAgICAgIHZhciBtYXliZVN0YXRlU25hcFN0ciA9IGNoYW5nZXMuc3RhdGVTbmFwc2hvdDtcbiAgICAgICAgaWYgKCFtYXliZVN0YXRlU25hcFN0cikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHN0YXRlU25hcFN0ciA9IG1heWJlU3RhdGVTbmFwU3RyLm5ld1ZhbHVlO1xuICAgICAgICBpZiAoIXN0YXRlU25hcFN0cikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHNuYXBTdGF0ZSA9IEpTT04ucGFyc2Uoc3RhdGVTbmFwU3RyKTtcbiAgICAgICAgbG9nLmRlYnVnKCcqKiogc3RhdGVTbmFwc2hvdFN0b3JhZ2VDaGFuZ2U6IHJlYWQgZnJvbSBzZXNzaW9uIHN0b3JhZ2U6ICcsIHNuYXBTdGF0ZSk7XG4gICAgICAgIHZhciBzdCA9IFRhYk1hbmFnZXJTdGF0ZS5kZXNlcmlhbGl6ZShzbmFwU3RhdGUpO1xuICAgICAgICByZXR1cm4gc3Q7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufVxuZnVuY3Rpb24gb25TdG9yYWdlQ2hhbmdlZChzdGF0ZVJlZiwgd3JpdGVyLCBjaGFuZ2VzLCBuYW1lc3BhY2UpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBtYXliZVByZWZzO1xuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICBsb2cuZGVidWcoJ29uU3RvcmFnZUNoYW5nZWQ6ICcsIG5hbWVzcGFjZSk7XG4gICAgICAgICAgICBtYXliZVByZWZzID0gcHJlZnNTdG9yYWdlQ2hhbmdlKGNoYW5nZXMsIG5hbWVzcGFjZSk7XG4gICAgICAgICAgICBpZiAobWF5YmVQcmVmcyAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgbG9nLmRlYnVnKCdvblN0b3JhZ2VDaGFuZ2VkOiBwcmVmcyBjaGFuZ2VkOiAnLCBtYXliZVByZWZzKTtcbiAgICAgICAgICAgICAgICB1cGRhdGUoc3RhdGVSZWYsIGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGUuc2V0KCdwcmVmZXJlbmNlcycsIG1heWJlUHJlZnMpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHJlZ2lzdGVyRXZlbnRIYW5kbGVycyhzdGF0ZVJlZiwgd3JpdGVyKSB7XG4gICAgLy8gd2luZG93IGV2ZW50czpcbiAgICBjaHJvbWUud2luZG93cy5vblJlbW92ZWQuYWRkTGlzdGVuZXIoZnVuY3Rpb24gKHdpbmRvd0lkKSB7XG4gICAgICAgIGNocm9tZUV2ZW50TG9nLmRlYnVnKCdDaHJvbWUgRXZlbnQ6OiB3aW5kb3dzLm9uUmVtb3ZlZDogJywgd2luZG93SWQpO1xuICAgICAgICB1cGRhdGUoc3RhdGVSZWYsIGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICAgICAgdmFyIHN0O1xuICAgICAgICAgICAgaWYgKHdpbmRvd0lkICE9PSBjaHJvbWUud2luZG93cy5XSU5ET1dfSURfTk9ORSAmJlxuICAgICAgICAgICAgICAgIHdpbmRvd0lkID09PSBzdGF0ZS5wb3BvdXRXaW5kb3dJZCkge1xuICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZygnZGV0ZWN0ZWQgY2xvc2Ugb2YgcG9wb3V0IHdpbmRvdyBpZCAnLCB3aW5kb3dJZCwgJyAtLSBjbGVhcmluZycpO1xuICAgICAgICAgICAgICAgIHN0ID0gc3RhdGUuc2V0KCdwb3BvdXRXaW5kb3dJZCcsIGNocm9tZS53aW5kb3dzLldJTkRPV19JRF9OT05FKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciB0YWJXaW5kb3cgPSBzdGF0ZS5nZXRUYWJXaW5kb3dCeUNocm9tZUlkKHdpbmRvd0lkKTtcbiAgICAgICAgICAgICAgICBzdCA9IHRhYldpbmRvdyA/IHN0YXRlLmhhbmRsZVRhYldpbmRvd0Nsb3NlZCh0YWJXaW5kb3cpIDogc3RhdGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gc3Q7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIGNocm9tZS53aW5kb3dzLm9uQ3JlYXRlZC5hZGRMaXN0ZW5lcihmdW5jdGlvbiAoY2hyb21lV2luZG93KSB7XG4gICAgICAgIGNocm9tZUV2ZW50TG9nLmRlYnVnKCdDaHJvbWUgRXZlbnQ6OiB3aW5kb3dzLm9uQ3JlYXRlZDogJywgY2hyb21lV2luZG93KTtcbiAgICAgICAgdXBkYXRlKHN0YXRlUmVmLCBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZS5zeW5jQ2hyb21lV2luZG93KGNocm9tZVdpbmRvdyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIC8qIFRPRE86IFRoZSBDaHJvbWUgZG9jcyBhcmUgcHJldHR5IGNvbmZ1c2luZyBhbmQgc3VnZ2VzdCB0aGF0IGFuIGV4dHJhIGZpbHRlciBwYXJhbWV0ZXIgY2FuIGJlIHBhc3NlZFxuICAgICAqIGluIHRoZSBjYWxsIHRvIGFkZExpc3RlbmVyLCBidXQgdGhlIFR5cGVTY3JpcHQgYmluZGluZ3Mgc3VnZ2VzdCB0aGlzIGlzIGFuIGFyZ3VtZW50IHRvIHRoZVxuICAgICAqIGNhbGxiYWNrLCB3aGljaCBkb2Vzbid0IG1ha2UgYSB0b24gb2Ygc2Vuc2UuLi5cbiAgICAgKi9cbiAgICBjaHJvbWUud2luZG93cy5vbkZvY3VzQ2hhbmdlZC5hZGRMaXN0ZW5lcihmdW5jdGlvbiAod2luZG93SWQpIHtcbiAgICAgICAgY2hyb21lRXZlbnRMb2cuZGVidWcoJ0Nocm9tZSBFdmVudDo6IHdpbmRvd3Mub25Gb2N1c0NoYW5nZWQ6ICcsIHdpbmRvd0lkKTtcbiAgICAgICAgaWYgKHdpbmRvd0lkID09PSBjaHJvbWUud2luZG93cy5XSU5ET1dfSURfTk9ORSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHVwZGF0ZShzdGF0ZVJlZiwgZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgICAgICByZXR1cm4gc3RhdGUuc2V0Q3VycmVudFdpbmRvd0lkKHdpbmRvd0lkKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgLypcbiAgICAgICAge1xuICAgICAgICAgICAgd2luZG93VHlwZXM6IFsnbm9ybWFsJ11cbiAgICAgICAgfVxuICAgICk7XG4gICAgKi9cbiAgICAvLyB0YWIgZXZlbnRzOlxuICAgIGNocm9tZS50YWJzLm9uQ3JlYXRlZC5hZGRMaXN0ZW5lcihmdW5jdGlvbiAodGFiKSB7IHJldHVybiBvblRhYkNyZWF0ZWQoc3RhdGVSZWYsIHRhYik7IH0pO1xuICAgIGNocm9tZS50YWJzLm9uVXBkYXRlZC5hZGRMaXN0ZW5lcihmdW5jdGlvbiAodGFiSWQsIGNoYW5nZUluZm8sIHRhYikge1xuICAgICAgICByZXR1cm4gb25UYWJVcGRhdGVkKHN0YXRlUmVmLCB0YWJJZCwgY2hhbmdlSW5mbywgdGFiKTtcbiAgICB9KTtcbiAgICBjaHJvbWUudGFicy5vbkFjdGl2YXRlZC5hZGRMaXN0ZW5lcihmdW5jdGlvbiAoYWN0aXZlSW5mbykge1xuICAgICAgICBjaHJvbWVFdmVudExvZy5kZWJ1ZygnQ2hyb21lIEV2ZW50OiB0YWJzLm9uQWN0aXZhdGVkOiAnLCBhY3RpdmVJbmZvKTtcbiAgICAgICAgdXBkYXRlKHN0YXRlUmVmLCBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICAgIHZhciB0YWJXaW5kb3cgPSBzdGF0ZS5nZXRUYWJXaW5kb3dCeUNocm9tZUlkKGFjdGl2ZUluZm8ud2luZG93SWQpO1xuICAgICAgICAgICAgaWYgKCF0YWJXaW5kb3cpIHtcbiAgICAgICAgICAgICAgICBsb2cud2FybigndGFicy5vbkFjdGl2YXRlZDogd2luZG93IGlkIG5vdCBmb3VuZDogJywgYWN0aXZlSW5mby53aW5kb3dJZCwgYWN0aXZlSW5mbyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHN0ID0gdGFiV2luZG93XG4gICAgICAgICAgICAgICAgPyBzdGF0ZS5oYW5kbGVUYWJBY3RpdmF0ZWQodGFiV2luZG93LCBhY3RpdmVJbmZvLnRhYklkKVxuICAgICAgICAgICAgICAgIDogc3RhdGU7XG4gICAgICAgICAgICByZXR1cm4gc3Q7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIGNocm9tZS50YWJzLm9uUmVtb3ZlZC5hZGRMaXN0ZW5lcihmdW5jdGlvbiAodGFiSWQsIHJlbW92ZUluZm8pIHtcbiAgICAgICAgY2hyb21lRXZlbnRMb2cuZGVidWcoJ0Nocm9tZSBFdmVudDogdGFicy5vblJlbW92ZWQ6ICcsIHRhYklkLCByZW1vdmVJbmZvKTtcbiAgICAgICAgaWYgKHJlbW92ZUluZm8uaXNXaW5kb3dDbG9zaW5nKSB7XG4gICAgICAgICAgICAvLyB3aW5kb3cgY2xvc2luZywgaWdub3JlLi4uXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgb25UYWJSZW1vdmVkKHN0YXRlUmVmLCByZW1vdmVJbmZvLndpbmRvd0lkLCB0YWJJZCk7XG4gICAgfSk7XG4gICAgY2hyb21lLnRhYnMub25SZXBsYWNlZC5hZGRMaXN0ZW5lcihmdW5jdGlvbiAoYWRkZWRUYWJJZCwgcmVtb3ZlZFRhYklkKSB7XG4gICAgICAgIGNocm9tZUV2ZW50TG9nLmRlYnVnKCdDaHJvbWUgRXZlbnQ6IHRhYnMub25SZXBsYWNlZDogYWRkZWQ6ICcsIGFkZGVkVGFiSWQsICcsIHJlbW92ZWQ6ICcsIHJlbW92ZWRUYWJJZCk7XG4gICAgICAgIHVwZGF0ZShzdGF0ZVJlZiwgZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgICAgICB2YXIgdGFiV2luZG93ID0gc3RhdGUuZ2V0VGFiV2luZG93QnlDaHJvbWVUYWJJZChyZW1vdmVkVGFiSWQpO1xuICAgICAgICAgICAgaWYgKCF0YWJXaW5kb3cpIHtcbiAgICAgICAgICAgICAgICBsb2cuaW5mbygndGFicy5vblJlcGxhY2VkOiBjb3VsZCBub3QgZmluZCB3aW5kb3cgZm9yIHJlbW92ZWQgdGFiOiAnLCByZW1vdmVkVGFiSWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBuZXh0U3QgPSBzdGF0ZS5oYW5kbGVUYWJDbG9zZWQodGFiV2luZG93LCByZW1vdmVkVGFiSWQpOyAvLyBBbmQgYXJyYW5nZSBmb3IgdGhlIGFkZGVkIHRhYiB0byBiZSBhZGRlZCB0byB0aGUgd2luZG93OlxuICAgICAgICAgICAgY2hyb21lLnRhYnMuZ2V0KGFkZGVkVGFiSWQsIGZ1bmN0aW9uICh0YWIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb25UYWJDcmVhdGVkKHN0YXRlUmVmLCB0YWIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gbmV4dFN0O1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBjaHJvbWUudGFicy5vbk1vdmVkLmFkZExpc3RlbmVyKGZ1bmN0aW9uICh0YWJJZCwgbW92ZUluZm8pIHtcbiAgICAgICAgY2hyb21lRXZlbnRMb2cuZGVidWcoJ0Nocm9tZSBFdmVudDogdGFicy5vbk1vdmVkOiAnLCB0YWJJZCwgbW92ZUluZm8pOyAvLyBMZXQncyBqdXN0IHJlZnJlc2ggdGhlIHdob2xlIHdpbmRvdzpcbiAgICAgICAgYWN0aW9ucy5zeW5jQ2hyb21lV2luZG93QnlJZChtb3ZlSW5mby53aW5kb3dJZCwgc3RhdGVSZWYpO1xuICAgIH0pO1xuICAgIGNocm9tZS50YWJzLm9uRGV0YWNoZWQuYWRkTGlzdGVuZXIoZnVuY3Rpb24gKHRhYklkLCBkZXRhY2hJbmZvKSB7XG4gICAgICAgIGNocm9tZUV2ZW50TG9nLmRlYnVnKCdDaHJvbWUgRXZlbnQ6IHRhYnMub25EZXRhY2hlZDogJywgdGFiSWQsIGRldGFjaEluZm8pOyAvLyBqdXN0IGhhbmRsZSBsaWtlIHRhYiBjbG9zaW5nOlxuICAgICAgICAvLyBJIGFtIGEgbGl0dGxlIHN1cnByaXNlZCB0aGF0IHRoaXMgZG9lc24ndCBsb3NlIHNhdmVkIHN0YXRlIHdoZW4gZGV0YWNoaW5nIGFcbiAgICAgICAgLy8gc2F2ZWQgdGFiLCBidXQgaXQgcmVhbGx5IGRvZXNuJ3Qgc2VlbSB0byFcbiAgICAgICAgb25UYWJSZW1vdmVkKHN0YXRlUmVmLCBkZXRhY2hJbmZvLm9sZFdpbmRvd0lkLCB0YWJJZCk7XG4gICAgfSk7XG4gICAgY2hyb21lLnRhYnMub25BdHRhY2hlZC5hZGRMaXN0ZW5lcihmdW5jdGlvbiAodGFiSWQsIGF0dGFjaEluZm8pIHtcbiAgICAgICAgY2hyb21lRXZlbnRMb2cuZGVidWcoJ0Nocm9tZSBFdmVudDogdGFicy5vbkF0dGFjaGVkOiAnLCB0YWJJZCwgYXR0YWNoSW5mbyk7IC8vIGhhbmRsZSBsaWtlIHRhYiBjcmVhdGlvbjpcbiAgICAgICAgY2hyb21lLnRhYnMuZ2V0KHRhYklkLCBmdW5jdGlvbiAodGFiKSB7IHJldHVybiBvblRhYkNyZWF0ZWQoc3RhdGVSZWYsIHRhYiwgdHJ1ZSk7IH0pO1xuICAgIH0pO1xuICAgIGNocm9tZS5ib29rbWFya3Mub25DcmVhdGVkLmFkZExpc3RlbmVyKGZ1bmN0aW9uIChpZCwgYm9va21hcmspIHtcbiAgICAgICAgcmV0dXJuIG9uQm9va21hcmtDcmVhdGVkKHN0YXRlUmVmLCBpZCwgYm9va21hcmspO1xuICAgIH0pO1xuICAgIGNocm9tZS5ib29rbWFya3Mub25SZW1vdmVkLmFkZExpc3RlbmVyKGZ1bmN0aW9uIChpbmRleCwgYm9va21hcmspIHtcbiAgICAgICAgcmV0dXJuIG9uQm9va21hcmtSZW1vdmVkKHN0YXRlUmVmLCBpbmRleCwgYm9va21hcmspO1xuICAgIH0pO1xuICAgIGNocm9tZS5ib29rbWFya3Mub25Nb3ZlZC5hZGRMaXN0ZW5lcihmdW5jdGlvbiAoaWQsIG1vdmVJbmZvKSB7XG4gICAgICAgIHJldHVybiBvbkJvb2ttYXJrTW92ZWQoc3RhdGVSZWYsIGlkLCBtb3ZlSW5mbyk7XG4gICAgfSk7XG4gICAgY2hyb21lLmJvb2ttYXJrcy5vbkNoYW5nZWQuYWRkTGlzdGVuZXIoZnVuY3Rpb24gKGlkLCBjaGFuZ2VJbmZvKSB7XG4gICAgICAgIHJldHVybiBvbkJvb2ttYXJrQ2hhbmdlZChzdGF0ZVJlZiwgaWQsIGNoYW5nZUluZm8pO1xuICAgIH0pO1xuICAgIGNocm9tZS5zdG9yYWdlLm9uQ2hhbmdlZC5hZGRMaXN0ZW5lcihmdW5jdGlvbiAoY2hhbmdlcywgbmFtZXNwYWNlKSB7XG4gICAgICAgIHJldHVybiBvblN0b3JhZ2VDaGFuZ2VkKHN0YXRlUmVmLCB3cml0ZXIsIGNoYW5nZXMsIG5hbWVzcGFjZSk7XG4gICAgfSk7XG59XG52YXIgTUFUQ0hfVEhSRVNIT0xEID0gMC4yNTsgLy8gdHlwZSBjb25zdHJ1Y3RvciBmb3IgbWF0Y2ggaW5mbzpcbnZhciBnZXRXaW5kb3dNYXRjaEluZm8gPSBmdW5jdGlvbiAoYm1TdG9yZSwgdXJsSWRNYXAsIHcpIHtcbiAgICB2YXIgbWF0Y2hTZXRzID0gd1xuICAgICAgICAudGFicy5tYXAoZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHVybElkTWFwLmdldCh0LnVybCkgfHwgbmV3IFNldCgpOyB9KVxuICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChzZXQpIHsgcmV0dXJuIHNldC5zaXplID4gMDsgfSk7XG4gICAgdmFyIGNvdW50TWFwcyA9IG1hdGNoU2V0cy5tYXAoZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgdmFyIGNvdW50TWFwID0gbmV3IE1hcCgpO1xuICAgICAgICBzLmZvckVhY2goZnVuY3Rpb24gKHYpIHsgcmV0dXJuIGNvdW50TWFwLnNldCh2LCAoY291bnRNYXAuZ2V0KHYpIHx8IDApICsgMSk7IH0pO1xuICAgICAgICByZXR1cm4gY291bnRNYXA7XG4gICAgfSk7XG4gICAgdmFyIG1hdGNoTWFwID0gbmV3IE1hcCgpO1xuICAgIGNvdW50TWFwcy5mb3JFYWNoKGZ1bmN0aW9uIChtYXApIHtcbiAgICAgICAgbWFwLmZvckVhY2goZnVuY3Rpb24gKGNvdW50LCBpZCkge1xuICAgICAgICAgICAgbWF0Y2hNYXAuc2V0KGlkLCAobWF0Y2hNYXAuZ2V0KGlkKSB8fCAwKSArIGNvdW50KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgZnVuY3Rpb24gYWJvdmVNYXRjaFRocmVzaG9sZChtYXRjaENvdW50LCBib29rbWFya0lkKSB7XG4gICAgICAgIHZhciB0YWJDb3VudCA9IHcudGFicy5sZW5ndGg7XG4gICAgICAgIHZhciBzYXZlZFRhYldpbmRvdyA9IGJtU3RvcmUuYm9va21hcmtJZE1hcFtib29rbWFya0lkXTtcbiAgICAgICAgdmFyIHNhdmVkVXJsQ291bnQgPSBzYXZlZFRhYldpbmRvdy50YWJJdGVtcy5sZW5ndGg7XG4gICAgICAgIHZhciBtYXRjaFJhdGlvID0gbWF0Y2hDb3VudCAvIHNhdmVkVXJsQ291bnQ7XG4gICAgICAgIHJldHVybiAobWF0Y2hDb3VudCA+IDEgfHxcbiAgICAgICAgICAgIChzYXZlZFVybENvdW50ID09PSAxICYmIG1hdGNoQ291bnQgPT09IDEpIHx8XG4gICAgICAgICAgICBtYXRjaENvdW50ID09PSB0YWJDb3VudCB8fFxuICAgICAgICAgICAgbWF0Y2hSYXRpbyA+PSBNQVRDSF9USFJFU0hPTEQpO1xuICAgIH1cbiAgICB2YXIgdGhyZXNoTWFwID0gbmV3IE1hcCgpO1xuICAgIG1hdGNoTWFwLmZvckVhY2goZnVuY3Rpb24gKGNvdW50LCBpZCkge1xuICAgICAgICBpZiAoYWJvdmVNYXRjaFRocmVzaG9sZChjb3VudCwgaWQpKSB7XG4gICAgICAgICAgICB0aHJlc2hNYXAuc2V0KGlkLCBjb3VudCk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICB2YXIgYmVzdE1hdGNoID0gdXRpbHMuYmVzdE1hdGNoKHRocmVzaE1hcCk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgd2luZG93SWQ6IHcuaWQsXG4gICAgICAgIG1hdGNoZXM6IG1hdGNoTWFwLFxuICAgICAgICBiZXN0TWF0Y2g6IGJlc3RNYXRjaCxcbiAgICAgICAgdGFiQ291bnQ6IHcudGFicy5sZW5ndGgsXG4gICAgfTtcbn07XG4vKipcbiAqIEhldXJpc3RpYyBzY2FuIHRvIGZpbmQgYW55IG9wZW4gd2luZG93cyB0aGF0IHNlZW0gdG8gaGF2ZSBjb21lIGZyb20gc2F2ZWQgd2luZG93c1xuICogYW5kIHJlLWF0dGFjaCB0aGVtIG9uIGluaXRpYWwgbG9hZCBvZiB0aGUgYmFja2dyb3VuZCBwYWdlLiBNYWlubHkgdXNlZnVsIGZvclxuICogZGV2ZWxvcG1lbnQgYW5kIGZvciByZS1zdGFydGluZyBUYWJsaS5cbiAqXG4gKiBIZXVyaXN0aWNzIGhlcmUgYXJlIGltcGVyZmVjdDsgb25seSB3YXkgdG8gZ2V0IHRoaXMgdHJ1bHkgcmlnaHQgd291bGQgYmUgd2l0aCBhIHByb3BlclxuICogc2Vzc2lvbiBtYW5hZ2VtZW50IEFQSS5cbiAqXG4gKiByZXR1cm46IFByb21pc2U8VGFiTWFuYWdlclN0YXRlPlxuICpcbiAqL1xuZnVuY3Rpb24gYXR0YWNoV2luZG93TGlzdChibVN0b3JlLCB3aW5kb3dMaXN0KSB7XG4gICAgdmFyIHVybElkTWFwID0gYm1TdG9yZS5nZXRVcmxCb29rbWFya0lkTWFwKCk7XG4gICAgdmFyIHdpbmRvd01hdGNoSW5mbyA9IHdpbmRvd0xpc3RcbiAgICAgICAgLm1hcChmdW5jdGlvbiAodykgeyByZXR1cm4gZ2V0V2luZG93TWF0Y2hJbmZvKGJtU3RvcmUsIHVybElkTWFwLCB3KTsgfSlcbiAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAobWkpIHsgcmV0dXJuIG1pLmJlc3RNYXRjaCAhPT0gbnVsbDsgfSk7XG4gICAgdmFyIGJtTWF0Y2hlcyA9IG5ldyBNYXAoKTtcbiAgICB3aW5kb3dNYXRjaEluZm8uZm9yRWFjaChmdW5jdGlvbiAobWkpIHtcbiAgICAgICAgaWYgKG1pLmJlc3RNYXRjaCkge1xuICAgICAgICAgICAgaWYgKCFibU1hdGNoZXMuaGFzKG1pLmJlc3RNYXRjaCkpIHtcbiAgICAgICAgICAgICAgICBibU1hdGNoZXMuc2V0KG1pLmJlc3RNYXRjaCwgbmV3IE1hcCgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJtTWF0Y2hlc1xuICAgICAgICAgICAgICAgIC5nZXQobWkuYmVzdE1hdGNoKVxuICAgICAgICAgICAgICAgIC5zZXQobWkud2luZG93SWQsIG1pLm1hdGNoZXMuZ2V0KG1pLmJlc3RNYXRjaCkpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgdmFyIGJlc3RCTU1hdGNoZXMgPSBuZXcgTWFwKCk7XG4gICAgYm1NYXRjaGVzLmZvckVhY2goZnVuY3Rpb24gKHdpbmRvd01hdGNoZXMsIGJvb2ttYXJrSWQpIHtcbiAgICAgICAgdmFyIGJlc3RNYXRjaEZvckJvb2ttYXJrID0gdXRpbHMuYmVzdE1hdGNoKHdpbmRvd01hdGNoZXMpO1xuICAgICAgICBpZiAoYmVzdE1hdGNoRm9yQm9va21hcmsgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGJlc3RCTU1hdGNoZXMuc2V0KGJvb2ttYXJrSWQsIGJlc3RNYXRjaEZvckJvb2ttYXJrKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHZhciBjaHJvbWVXaW5NYXAgPSBuZXcgTWFwKHdpbmRvd0xpc3QubWFwKGZ1bmN0aW9uICh3KSB7IHJldHVybiBbdy5pZCwgd107IH0pKTtcbiAgICB2YXIgYXR0YWNoZWRTdG9yZSA9IGJtU3RvcmU7XG4gICAgYmVzdEJNTWF0Y2hlcy5mb3JFYWNoKGZ1bmN0aW9uICh3aW5kb3dJZCwgYm9va21hcmtJZCkge1xuICAgICAgICB2YXIgY2hyb21lV2luZG93ID0gY2hyb21lV2luTWFwLmdldCh3aW5kb3dJZCk7XG4gICAgICAgIHZhciBibVRhYldpbmRvdyA9IGJtU3RvcmUuYm9va21hcmtJZE1hcFtib29rbWFya0lkXTtcbiAgICAgICAgaWYgKGNocm9tZVdpbmRvdyAmJiBibVRhYldpbmRvdykge1xuICAgICAgICAgICAgYXR0YWNoZWRTdG9yZSA9IGF0dGFjaGVkU3RvcmUuYXR0YWNoQ2hyb21lV2luZG93KGJtVGFiV2luZG93LCBjaHJvbWVXaW5kb3cpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGF0dGFjaGVkU3RvcmU7XG59XG4vKipcbiAqIGdldCBhbGwgQ2hyb21lIHdpbmRvd3MgYW5kIGF0dGFjaCB0byBiZXN0IG1hdGNoOlxuICovXG5mdW5jdGlvbiByZWF0dGFjaFdpbmRvd3MoYm1TdG9yZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHdpbmRvd0xpc3Q7XG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIGNocm9tZXAud2luZG93cy5nZXRBbGwoe1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9wdWxhdGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIH0pXTtcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvd0xpc3QgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBhdHRhY2hXaW5kb3dMaXN0KGJtU3RvcmUsIHdpbmRvd0xpc3QpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG4vKipcbiAqIEZvciBhIG5ld2x5IGNyZWF0ZWQgd2luZG93LCBjaGVjayBpZiB3ZSBzaG91bGQgYXR0YWNoIGl0IHRvIGFuIGV4aXN0aW5nXG4gKiBjbG9zZWQsIHNhdmVkIHdpbmRvdy4gIEludGVuZGVkIHByaW1hcmlseSBmb3IgXCJPcGVuIGluIE5ldyBXaW5kb3dcIiBvblxuICogYSBzYXZlZCB0YWIuXG4gKiBOT1RFOiBUaGlzIGlzIGZ1bGx5IGZ1bmN0aW9uYWwsIGJ1dCBpcyBubyBsb25nZXIgYWN0dWFsbHkgdXNlZC5cbiAqIEFmdGVyIGJ1aWxkaW5nIHRoaXMgb3V0LCBkZWNpZGVkIGEgc2ltcGxlciBhbiBtb3JlIGZsZXhpYmxlIFVYXG4gKiBpcyB0byBhdHRhY2ggYSBzYXZlZCB3aW5kb3cgd2hlbiBzaW5nbGUtY2xpY2tpbmcgb24gYSBzYXZlZCwgY2xvc2VkIHRhYixcbiAqIGJ1dCBhbGxvdyB0aGUgXCJPcGVuIGluIE5ldyBXaW5kb3dcIiBjb250ZXh0IG1lbnUgYWN0aW9uIHRvIHJlbWFpbiBkZXRhY2hlZC5cbiAqL1xuZnVuY3Rpb24gbWF5YmVBdHRhY2hOZXdXaW5kb3coc3RSZWYsIHdpbmRvd0lkKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY2hyb21lV2luZG93XzEsIGVfMjtcbiAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgX2EudHJ5cy5wdXNoKFswLCAyLCAsIDNdKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgY2hyb21lcC53aW5kb3dzLmdldCh3aW5kb3dJZCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcHVsYXRlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvd1R5cGVzOiBbJ25vcm1hbCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgY2hyb21lV2luZG93XzEgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY2hyb21lV2luZG93XzEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCdtYXliZUF0dGFjaE5ld1dpbmRvdzogbnVsbCB3aW5kb3csIGlnbm9yaW5nLi4uLicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZShzdFJlZiwgZnVuY3Rpb24gKHN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXR0YWNoV2luZG93TGlzdChzdCwgW2Nocm9tZVdpbmRvd18xXSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCAzXTtcbiAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgIGVfMiA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oJ2NhdWdodCBlcnJvciBnZXR0aW5nIGNocm9tZSB3aW5kb3cgKGlnbm9yaW5nLi4uKTogJywgZV8yKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgM107XG4gICAgICAgICAgICAgICAgY2FzZSAzOiByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuLyoqXG4gKiBsb2FkIHdpbmRvdyBzdGF0ZSBmb3Igc2F2ZWQgd2luZG93cyBmcm9tIGxvY2FsIHN0b3JhZ2UgYW5kIGF0dGFjaCB0b1xuICogYW55IGNsb3NlZCwgc2F2ZWQgd2luZG93c1xuICovXG5leHBvcnQgZnVuY3Rpb24gcmVhZFNhdmVkU3RhdGUoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaXRlbXMsIHNhdmVkV2luZG93U3RhdGVTdHIsIHNhdmVkV2luZG93U3RhdGU7XG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIGNocm9tZXAuc3RvcmFnZS5sb2NhbC5nZXQoJ3NhdmVkV2luZG93U3RhdGUnKV07XG4gICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICBpdGVtcyA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpdGVtcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnKCdyZWFkU2F2ZWRTdGF0ZTogbm8gc2F2ZWQgd2luZG93IHN0YXRlIGZvdW5kIGluIGxvY2FsIHN0b3JhZ2UnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBudWxsXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzYXZlZFdpbmRvd1N0YXRlU3RyID0gaXRlbXMuc2F2ZWRXaW5kb3dTdGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzYXZlZFdpbmRvd1N0YXRlU3RyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcoJ3JlYWRTYXZlZFN0YXRlOiBubyBzYXZlZCB3aW5kb3cgc3RhdGUgZm91bmQgaW4gbG9jYWwgc3RvcmFnZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIG51bGxdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHNhdmVkV2luZG93U3RhdGUgPSBKU09OLnBhcnNlKHNhdmVkV2luZG93U3RhdGVTdHIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgc2F2ZWRXaW5kb3dTdGF0ZV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gbG9hZFNhdmVkU3RhdGUoYm1TdG9yZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNhdmVkV2luZG93U3RhdGUsIGNsb3NlZFdpbmRvd3NNYXAsIGNsb3NlZFdpbmRvd0lkcywgc2F2ZWRPcGVuVGFic01hcCwgY2xvc2VkV2luZG93SWRzXzEsIGNsb3NlZFdpbmRvd0lkc18xXzEsIGlkLCBzYXZlZFN0YXRlXzEsIG9wZW5UYWJJdGVtcywgY29udlRhYkl0ZW1zLCB0aUxpc3QsIGtleUNvdW50LCB1cGRCb29rbWFya01hcCwgbmV4dFN0b3JlO1xuICAgICAgICB2YXIgZV8zLCBfYTtcbiAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYikge1xuICAgICAgICAgICAgc3dpdGNoIChfYi5sYWJlbCkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIFs0IC8qeWllbGQqLywgcmVhZFNhdmVkU3RhdGUoKV07XG4gICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICBzYXZlZFdpbmRvd1N0YXRlID0gX2Iuc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXNhdmVkV2luZG93U3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBibVN0b3JlXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcoJ2xvYWRTYXZlZFN0YXRlOiByZWFkIHNhdmVkIHdpbmRvdyBzdGF0ZTogJywgc2F2ZWRXaW5kb3dTdGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZygnbG9hZFNhdmVkU3RhdGU6IGJlZm9yZSBtZXJnaW5nIHdpdGggc2F2ZWQgc3RhdGU6ICcsIGJtU3RvcmUpO1xuICAgICAgICAgICAgICAgICAgICBjbG9zZWRXaW5kb3dzTWFwID0gT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5lbnRyaWVzKGJtU3RvcmUuYm9va21hcmtJZE1hcCkuZmlsdGVyKGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9iID0gX19yZWFkKF9hLCAyKSwgXyA9IF9iWzBdLCBibVdpbiA9IF9iWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFibVdpbi5vcGVuO1xuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIGNsb3NlZFdpbmRvd0lkcyA9IE9iamVjdC5rZXlzKGNsb3NlZFdpbmRvd3NNYXApO1xuICAgICAgICAgICAgICAgICAgICBzYXZlZE9wZW5UYWJzTWFwID0ge307XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNsb3NlZFdpbmRvd0lkc18xID0gX192YWx1ZXMoY2xvc2VkV2luZG93SWRzKSwgY2xvc2VkV2luZG93SWRzXzFfMSA9IGNsb3NlZFdpbmRvd0lkc18xLm5leHQoKTsgIWNsb3NlZFdpbmRvd0lkc18xXzEuZG9uZTsgY2xvc2VkV2luZG93SWRzXzFfMSA9IGNsb3NlZFdpbmRvd0lkc18xLm5leHQoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkID0gY2xvc2VkV2luZG93SWRzXzFfMS52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlZFN0YXRlXzEgPSBzYXZlZFdpbmRvd1N0YXRlW2lkXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2F2ZWRTdGF0ZV8xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5UYWJJdGVtcyA9IHNhdmVkU3RhdGVfMS50YWJJdGVtcy5maWx0ZXIoZnVuY3Rpb24gKHRpKSB7IHJldHVybiB0aS5vcGVuOyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wZW5UYWJJdGVtcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252VGFiSXRlbXMgPSBvcGVuVGFiSXRlbXMubWFwKGZ1bmN0aW9uICh0aSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0YWJXaW5kb3dVdGlscy50YWJJdGVtRnJvbUpTKHRpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlMaXN0ID0gY29udlRhYkl0ZW1zO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZWRPcGVuVGFic01hcFtpZF0gPSB0aUxpc3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGVfM18xKSB7IGVfMyA9IHsgZXJyb3I6IGVfM18xIH07IH1cbiAgICAgICAgICAgICAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbG9zZWRXaW5kb3dJZHNfMV8xICYmICFjbG9zZWRXaW5kb3dJZHNfMV8xLmRvbmUgJiYgKF9hID0gY2xvc2VkV2luZG93SWRzXzEucmV0dXJuKSkgX2EuY2FsbChjbG9zZWRXaW5kb3dJZHNfMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMykgdGhyb3cgZV8zLmVycm9yOyB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAga2V5Q291bnQgPSBPYmplY3Qua2V5cyhzYXZlZE9wZW5UYWJzTWFwKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZygnbG9hZFNhdmVkU3RhdGU6IHJlYWQgc2F2ZWQgd2luZG93IHN0YXRlIGZvciAnLCBrZXlDb3VudCwgJyBzYXZlZCB3aW5kb3dzJyk7XG4gICAgICAgICAgICAgICAgICAgIHVwZEJvb2ttYXJrTWFwID0gT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5lbnRyaWVzKGJtU3RvcmUuYm9va21hcmtJZE1hcCkubWFwKGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9iID0gX19yZWFkKF9hLCAyKSwgYm1JZCA9IF9iWzBdLCB0YWJXaW5kb3cgPSBfYlsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzbmFwVGFicyA9IHNhdmVkT3BlblRhYnNNYXBbYm1JZF07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc25hcFRhYnMgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbYm1JZCwgdGFiV2luZG93XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiYXNlU2F2ZWRJdGVtcyA9IHRhYldpbmRvdy50YWJJdGVtc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKHRpKSB7IHJldHVybiB0aS5zYXZlZDsgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKHRhYldpbmRvd1V0aWxzLnJlc2V0U2F2ZWRJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZXJnZWRUYWJzID0gdGFiV2luZG93VXRpbHMubWVyZ2VTYXZlZE9wZW5UYWJzKGJhc2VTYXZlZEl0ZW1zLCBzbmFwVGFicyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJtSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVGFiV2luZG93LnVwZGF0ZSh0YWJXaW5kb3csIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFiSXRlbXM6IG1lcmdlZFRhYnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNuYXBzaG90OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICBuZXh0U3RvcmUgPSBibVN0b3JlLnNldCgnYm9va21hcmtJZE1hcCcsIHVwZEJvb2ttYXJrTWFwKTtcbiAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnKCdsb2FkU2F2ZWRTdGF0ZTogYWZ0ZXIgbWVyZ2luZyB3aXRoIHNhdmVkIHN0YXRlOiAnLCBuZXh0U3RvcmUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgbmV4dFN0b3JlXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBjbGVhbk9sZFBvcG91dHMoc3RhdGVSZWYpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzdCwgcG9wdXBUYWJXaW5kb3dzLCBjbG9zZVByb21pc2VzO1xuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICBzdCA9IG11dGFibGVHZXQoc3RhdGVSZWYpO1xuICAgICAgICAgICAgICAgICAgICBwb3B1cFRhYldpbmRvd3MgPSBzdFxuICAgICAgICAgICAgICAgICAgICAgICAgLmdldFRhYldpbmRvd3NCeVR5cGUoJ3BvcHVwJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKHR3KSB7IHJldHVybiB0dy5vcGVuICYmIHR3LnRpdGxlID09PSAnVGFibGknOyB9KTtcbiAgICAgICAgICAgICAgICAgICAgY2xvc2VQcm9taXNlcyA9IHBvcHVwVGFiV2luZG93cy5tYXAoZnVuY3Rpb24gKHR3KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2hyb21lcC53aW5kb3dzLnJlbW92ZSh0dy5vcGVuV2luZG93SWQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgUHJvbWlzZS5hbGwoY2xvc2VQcm9taXNlcyldO1xuICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuLypcbiAqIEZ1bGwgaW5pdGlhbGl6YXRpb24gb2YgYXBwIHN0YXRlIHN0b3JhZ2Ugd2hlbiB3ZSBkb24ndCBoYXZlIGEgc25hcHNob3RcbiAqL1xuZnVuY3Rpb24gaW5pdE5vU25hcHNob3QoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcmF3Qk1TdG9yZSwgYXR0YWNoQk1TdG9yZSwgYm1TdG9yZSwgc3RhdGVSZWY7XG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIGluaXRXaW5TdG9yZSgpXTtcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgIHJhd0JNU3RvcmUgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHJlYXR0YWNoV2luZG93cyhyYXdCTVN0b3JlKV07XG4gICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICBhdHRhY2hCTVN0b3JlID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBsb2FkU2F2ZWRTdGF0ZShhdHRhY2hCTVN0b3JlKV07XG4gICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICBibVN0b3JlID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICBzdGF0ZVJlZiA9IG1rUmVmKGJtU3RvcmUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgc3RhdGVSZWZdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiByZWFkU25hcFN0YXRlU3RyKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGl0ZW1zLCBzbmFwU3RhdGVTdHI7XG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIGNocm9tZS5zdG9yYWdlLnNlc3Npb24uZ2V0KCdzdGF0ZVNuYXBzaG90JyldO1xuICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgaXRlbXMgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZygncmVhZFNuYXBTdGF0ZVN0cjogaXRlbXM6ICcsIGl0ZW1zKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpdGVtcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIG51bGxdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHNuYXBTdGF0ZVN0ciA9IGl0ZW1zLnN0YXRlU25hcHNob3Q7XG4gICAgICAgICAgICAgICAgICAgIGlmICghc25hcFN0YXRlU3RyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgbnVsbF07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHNuYXBTdGF0ZVN0cl07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRTbmFwU3RhdGUoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc25hcFN0YXRlU3RyLCBzbmFwU3RhdGUsIHN0UmVmO1xuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcoJ2xvYWRTbmFwU3RhdGU6IGF0dGVtcHRpbmcgdG8gbG9hZCBzdGF0ZSBzbmFwc2hvdCBmcm9tIHNlc3Npb24gc3RvcmFnZS4uLjonKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgcmVhZFNuYXBTdGF0ZVN0cigpXTtcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgIHNuYXBTdGF0ZVN0ciA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzbmFwU3RhdGVTdHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBudWxsXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzbmFwU3RhdGUgPSBKU09OLnBhcnNlKHNuYXBTdGF0ZVN0cik7XG4gICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZygnbG9hZFNuYXBTdGF0ZTogcmVhZCBmcm9tIHNlc3Npb24gc3RvcmFnZTogJywgc25hcFN0YXRlKTtcbiAgICAgICAgICAgICAgICAgICAgc3RSZWYgPSBta1JlZihUYWJNYW5hZ2VyU3RhdGUuZGVzZXJpYWxpemUoc25hcFN0YXRlKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBzdFJlZl07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGluaXRTdGF0ZSh3cml0ZXIpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzbmFwU3RhdGVSZWYsIHN0YXRlUmVmLCBfYSwgc3luY2VkU3RvcmU7XG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2IpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoX2IubGFiZWwpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGZvciBleGlzdGluZyBzdGF0ZSBzbmFwc2hvdCBpbiBjaG9tZS5zdG9yYWdlLnNlc3Npb25cbiAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnKCdpbml0U3RhdGU6IGluaXRpYWxpemluZyBzdGF0ZS4uLicpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBsb2FkU25hcFN0YXRlKCldO1xuICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgc25hcFN0YXRlUmVmID0gX2Iuc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcoJ2luaXRTdGF0ZTogbG9hZGVkIHNuYXBzaG90IHN0YXRlOiAnLCBzbmFwU3RhdGVSZWYpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIShzbmFwU3RhdGVSZWYgPT0gbnVsbCkpIHJldHVybiBbMyAvKmJyZWFrKi8sIDNdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBpbml0Tm9TbmFwc2hvdCgpXTtcbiAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgIF9hID0gX2Iuc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCA0XTtcbiAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgIF9hID0gc25hcFN0YXRlUmVmO1xuICAgICAgICAgICAgICAgICAgICBfYi5sYWJlbCA9IDQ7XG4gICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICBzdGF0ZVJlZiA9IF9hO1xuICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcoJ2luaXRTdGF0ZTogYWZ0ZXIgaW5pdE5vU25hcHNob3Q6IHN0YXRlUmVmOiAnLCBtdXRhYmxlR2V0KHN0YXRlUmVmKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGFjdGlvbnMubG9hZFByZWZlcmVuY2VzKHN0YXRlUmVmKV07XG4gICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgICAgICBfYi5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGFjdGlvbnMuc3luY0Nocm9tZVdpbmRvd3Moc3RhdGVSZWYpXTtcbiAgICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgICAgIF9iLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnKCdpbml0aWFsIHN5bmMgb2YgY2hyb21lIHdpbmRvd3MgY29tcGxldGUuJyk7XG4gICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZygnYmVmb3JlIHN5bmNDdXJyZW50OiBzdGF0ZVJlZjogJywgc3RhdGVSZWYpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBhY3Rpb25zLnN5bmNDdXJyZW50KHN0YXRlUmVmKV07XG4gICAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgICAgICBzeW5jZWRTdG9yZSA9IF9iLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHdyaXRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnKCdpbml0U3RhdGU6IHdyaXRlciBtb2RlLCBzZXR0aW5nIHVwIHNhdmVkIHN0YXRlIGxpc3RlbmVyLi4uJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzYXZlZFN0YXRlLmluaXQoc3RhdGVSZWYpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJlZ2lzdGVyRXZlbnRIYW5kbGVycyhzdGF0ZVJlZiwgd3JpdGVyKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gKFRoaXMgaXMgc29tZXRoaW5nIHdlIGhhZCBpbiBwbGFjZSBmcm9tIE1hbmlmZXN0IFYyIGVyYTsgZG9lc24ndCBzZWVtXG4gICAgICAgICAgICAgICAgICAgIC8vIHRvIGJlIG5lY2Vzc2FyeSBhbnltb3JlLCBidXQgbGVhdmluZyBjb21tZW50ZWQgb3V0IGZvciBub3csIGp1c3QgaW4gY2FzZVxuICAgICAgICAgICAgICAgICAgICAvLyBJJ20gbWlzdGFrZW4pXG4gICAgICAgICAgICAgICAgICAgIC8vIEluIGNhc2Ugb2YgcmVzdGFydDogaGlkZSBhbnkgcHJldmlvdXNseSBvcGVuIHBvcG91dCB0aGF0XG4gICAgICAgICAgICAgICAgICAgIC8vIG1pZ2h0IGJlIGhhbmdpbmcgYXJvdW5kLi4uXG4gICAgICAgICAgICAgICAgICAgIC8qIGNsZWFuT2xkUG9wb3V0cyhzdGF0ZVJlZik7ICovXG4gICAgICAgICAgICAgICAgICAgIHNhdmVkU3RhdGUuc2F2ZVNuYXBzaG90KHN0YXRlUmVmKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHN0YXRlUmVmXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG4iLCJ2YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2dlbmVyYXRvciA9ICh0aGlzICYmIHRoaXMuX19nZW5lcmF0b3IpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBib2R5KSB7XG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZztcbiAgICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgXCJ0aHJvd1wiOiB2ZXJiKDEpLCBcInJldHVyblwiOiB2ZXJiKDIpIH0sIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZztcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cbiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7XG4gICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcbiAgICAgICAgd2hpbGUgKGcgJiYgKGcgPSAwLCBvcFswXSAmJiAoXyA9IDApKSwgXykgdHJ5IHtcbiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbXCJyZXR1cm5cIl0gOiBvcFswXSA/IHlbXCJ0aHJvd1wiXSB8fCAoKHQgPSB5W1wicmV0dXJuXCJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDtcbiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTtcbiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9O1xuICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xuICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9XG4gICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9O1xuICAgIH1cbn07XG5pbXBvcnQgeyBsb2cgfSBmcm9tICcuL2dsb2JhbHMnO1xuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgZW5hYmxlUGF0Y2hlcyB9IGZyb20gJ2ltbWVyJztcbmltcG9ydCBQcmVmZXJlbmNlc01vZGFsIGZyb20gJy4vY29tcG9uZW50cy9QcmVmZXJlbmNlc01vZGFsJztcbmltcG9ydCAqIGFzIGFjdGlvbnMgZnJvbSAnLi9hY3Rpb25zJztcbmltcG9ydCBDaHJvbWVQcm9taXNlIGZyb20gJ2Nocm9tZS1wcm9taXNlJztcbmltcG9ydCB7IG11dGFibGVHZXQgfSBmcm9tICdvbmVyZWYnO1xuaW1wb3J0IHsgbG9hZFNuYXBTdGF0ZSB9IGZyb20gJy4vc3RhdGUnO1xuaW1wb3J0IHsgY3JlYXRlUm9vdCB9IGZyb20gJ3JlYWN0LWRvbS9jbGllbnQnO1xudmFyIGNocm9tZXAgPSBDaHJvbWVQcm9taXNlO1xudmFyIG9uQ2xvc2UgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgIHZhciB0YWI7XG4gICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgbG9nLmRlYnVnKCdvbkNsb3NlJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgY2hyb21lcC50YWJzLmdldEN1cnJlbnQoKV07XG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgdGFiID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgIGxvZy5kZWJ1Zygnb25DbG9zZSB0YWI6ICcsIHRhYik7XG4gICAgICAgICAgICAgICAgaWYgKHRhYi5pZCkge1xuICAgICAgICAgICAgICAgICAgICBjaHJvbWUudGFicy5yZW1vdmUoW3RhYi5pZF0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgIH1cbiAgICB9KTtcbn0pOyB9O1xudmFyIG9uQXBwbHlQcmVmZXJlbmNlcyA9IGZ1bmN0aW9uIChzdGF0ZVJlZiwgbmV3UHJlZnMpIHsgcmV0dXJuIF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIGFjdGlvbnMuc2F2ZVByZWZlcmVuY2VzKG5ld1ByZWZzLCBzdGF0ZVJlZildO1xuICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgIH1cbiAgICB9KTtcbn0pOyB9O1xudmFyIG9uVXBkYXRlUHJlZmVyZW5jZXMgPSBmdW5jdGlvbiAoc3RhdGVSZWYsIG5ld1ByZWZzKSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgY2FzZSAwOiByZXR1cm4gWzQgLyp5aWVsZCovLCBvbkFwcGx5UHJlZmVyZW5jZXMoc3RhdGVSZWYsIG5ld1ByZWZzKV07XG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIG9uQ2xvc2UoKV07XG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgfVxuICAgIH0pO1xufSk7IH07XG52YXIgcmVuZGVyUHJlZnMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgIHZhciBtYXliZVN0YXRlUmVmLCBzdGF0ZVJlZl8xLCBzdCwgcGFyZW50Tm9kZSwgbW9kYWwsIGVfMTtcbiAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICBfYS50cnlzLnB1c2goWzAsIDIsICwgM10pO1xuICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGxvYWRTbmFwU3RhdGUoKV07XG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgbWF5YmVTdGF0ZVJlZiA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICBpZiAoIW1heWJlU3RhdGVSZWYpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nLmVycm9yKCdwcmVmc1BhZ2U6IGNvdWxkIG5vdCBsb2FkIHNuYXAgc3RhdGUgZnJvbSBzZXNzaW9uIHN0b3JhZ2UgLS0gZXhpdGluZycpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN0YXRlUmVmXzEgPSBtYXliZVN0YXRlUmVmO1xuICAgICAgICAgICAgICAgIHN0ID0gbXV0YWJsZUdldChzdGF0ZVJlZl8xKTtcbiAgICAgICAgICAgICAgICBwYXJlbnROb2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZWZzQ29udGVudCcpO1xuICAgICAgICAgICAgICAgIG1vZGFsID0gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoUHJlZmVyZW5jZXNNb2RhbCwgeyBvbkNsb3NlOiBvbkNsb3NlLCBpbml0aWFsUHJlZnM6IHN0LnByZWZlcmVuY2VzLCBvbkFwcGx5OiBmdW5jdGlvbiAocHJlZnMpIHsgcmV0dXJuIG9uQXBwbHlQcmVmZXJlbmNlcyhzdGF0ZVJlZl8xLCBwcmVmcyk7IH0sIG9uU3VibWl0OiBmdW5jdGlvbiAocHJlZnMpIHsgcmV0dXJuIG9uVXBkYXRlUHJlZmVyZW5jZXMoc3RhdGVSZWZfMSwgcHJlZnMpOyB9IH0pKTtcbiAgICAgICAgICAgICAgICBjcmVhdGVSb290KHBhcmVudE5vZGUpLnJlbmRlcihtb2RhbCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgM107XG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgZV8xID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgIGxvZy5lcnJvcignY2F1Z2h0IGV4Y2VwdGlvbiByZW5kZXJpbmcgcHJlZmVyZW5jZXMgcGFnZTonKTtcbiAgICAgICAgICAgICAgICBsb2cuZXJyb3IoZV8xLnN0YWNrKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBlXzE7XG4gICAgICAgICAgICBjYXNlIDM6IHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgfVxuICAgIH0pO1xufSk7IH07XG5mdW5jdGlvbiBtYWluKCkge1xuICAgIGVuYWJsZVBhdGNoZXMoKTtcbiAgICB3aW5kb3cub25sb2FkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVuZGVyUHJlZnMoKTsgfTtcbn1cbm1haW4oKTtcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0aWQ6IG1vZHVsZUlkLFxuXHRcdGxvYWRlZDogZmFsc2UsXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuXHRtb2R1bGUubG9hZGVkID0gdHJ1ZTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbi8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG5fX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBfX3dlYnBhY2tfbW9kdWxlc19fO1xuXG4iLCIvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuX193ZWJwYWNrX3JlcXVpcmVfXy5uID0gKG1vZHVsZSkgPT4ge1xuXHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cblx0XHQoKSA9PiAobW9kdWxlWydkZWZhdWx0J10pIDpcblx0XHQoKSA9PiAobW9kdWxlKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgeyBhOiBnZXR0ZXIgfSk7XG5cdHJldHVybiBnZXR0ZXI7XG59OyIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uZyA9IChmdW5jdGlvbigpIHtcblx0aWYgKHR5cGVvZiBnbG9iYWxUaGlzID09PSAnb2JqZWN0JykgcmV0dXJuIGdsb2JhbFRoaXM7XG5cdHRyeSB7XG5cdFx0cmV0dXJuIHRoaXMgfHwgbmV3IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7XG5cdH0gY2F0Y2ggKGUpIHtcblx0XHRpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcpIHJldHVybiB3aW5kb3c7XG5cdH1cbn0pKCk7IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubm1kID0gKG1vZHVsZSkgPT4ge1xuXHRtb2R1bGUucGF0aHMgPSBbXTtcblx0aWYgKCFtb2R1bGUuY2hpbGRyZW4pIG1vZHVsZS5jaGlsZHJlbiA9IFtdO1xuXHRyZXR1cm4gbW9kdWxlO1xufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLmogPSAzOyIsIi8vIG5vIGJhc2VVUklcblxuLy8gb2JqZWN0IHRvIHN0b3JlIGxvYWRlZCBhbmQgbG9hZGluZyBjaHVua3Ncbi8vIHVuZGVmaW5lZCA9IGNodW5rIG5vdCBsb2FkZWQsIG51bGwgPSBjaHVuayBwcmVsb2FkZWQvcHJlZmV0Y2hlZFxuLy8gW3Jlc29sdmUsIHJlamVjdCwgUHJvbWlzZV0gPSBjaHVuayBsb2FkaW5nLCAwID0gY2h1bmsgbG9hZGVkXG52YXIgaW5zdGFsbGVkQ2h1bmtzID0ge1xuXHQzOiAwXG59O1xuXG4vLyBubyBjaHVuayBvbiBkZW1hbmQgbG9hZGluZ1xuXG4vLyBubyBwcmVmZXRjaGluZ1xuXG4vLyBubyBwcmVsb2FkZWRcblxuLy8gbm8gSE1SXG5cbi8vIG5vIEhNUiBtYW5pZmVzdFxuXG5fX3dlYnBhY2tfcmVxdWlyZV9fLk8uaiA9IChjaHVua0lkKSA9PiAoaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID09PSAwKTtcblxuLy8gaW5zdGFsbCBhIEpTT05QIGNhbGxiYWNrIGZvciBjaHVuayBsb2FkaW5nXG52YXIgd2VicGFja0pzb25wQ2FsbGJhY2sgPSAocGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24sIGRhdGEpID0+IHtcblx0dmFyIFtjaHVua0lkcywgbW9yZU1vZHVsZXMsIHJ1bnRpbWVdID0gZGF0YTtcblx0Ly8gYWRkIFwibW9yZU1vZHVsZXNcIiB0byB0aGUgbW9kdWxlcyBvYmplY3QsXG5cdC8vIHRoZW4gZmxhZyBhbGwgXCJjaHVua0lkc1wiIGFzIGxvYWRlZCBhbmQgZmlyZSBjYWxsYmFja1xuXHR2YXIgbW9kdWxlSWQsIGNodW5rSWQsIGkgPSAwO1xuXHRpZihjaHVua0lkcy5zb21lKChpZCkgPT4gKGluc3RhbGxlZENodW5rc1tpZF0gIT09IDApKSkge1xuXHRcdGZvcihtb2R1bGVJZCBpbiBtb3JlTW9kdWxlcykge1xuXHRcdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKG1vcmVNb2R1bGVzLCBtb2R1bGVJZCkpIHtcblx0XHRcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tW21vZHVsZUlkXSA9IG1vcmVNb2R1bGVzW21vZHVsZUlkXTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYocnVudGltZSkgdmFyIHJlc3VsdCA9IHJ1bnRpbWUoX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cdH1cblx0aWYocGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24pIHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uKGRhdGEpO1xuXHRmb3IoO2kgPCBjaHVua0lkcy5sZW5ndGg7IGkrKykge1xuXHRcdGNodW5rSWQgPSBjaHVua0lkc1tpXTtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oaW5zdGFsbGVkQ2h1bmtzLCBjaHVua0lkKSAmJiBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0pIHtcblx0XHRcdGluc3RhbGxlZENodW5rc1tjaHVua0lkXVswXSgpO1xuXHRcdH1cblx0XHRpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPSAwO1xuXHR9XG5cdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fLk8ocmVzdWx0KTtcbn1cblxudmFyIGNodW5rTG9hZGluZ0dsb2JhbCA9IHNlbGZbXCJ3ZWJwYWNrQ2h1bmt0YWJsaVwiXSA9IHNlbGZbXCJ3ZWJwYWNrQ2h1bmt0YWJsaVwiXSB8fCBbXTtcbmNodW5rTG9hZGluZ0dsb2JhbC5mb3JFYWNoKHdlYnBhY2tKc29ucENhbGxiYWNrLmJpbmQobnVsbCwgMCkpO1xuY2h1bmtMb2FkaW5nR2xvYmFsLnB1c2ggPSB3ZWJwYWNrSnNvbnBDYWxsYmFjay5iaW5kKG51bGwsIGNodW5rTG9hZGluZ0dsb2JhbC5wdXNoLmJpbmQoY2h1bmtMb2FkaW5nR2xvYmFsKSk7IiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBkZXBlbmRzIG9uIG90aGVyIGxvYWRlZCBjaHVua3MgYW5kIGV4ZWN1dGlvbiBuZWVkIHRvIGJlIGRlbGF5ZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXy5PKHVuZGVmaW5lZCwgWzBdLCAoKSA9PiAoX193ZWJwYWNrX3JlcXVpcmVfXyg2OTcwKSkpXG5fX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXy5PKF9fd2VicGFja19leHBvcnRzX18pO1xuIl0sIm5hbWVzIjpbImRlZmVycmVkIiwiaW50ZXJuYWxSZSIsImNvbnN0YW50cyIsIlNlbVZlciIsImlkZW50aWZpZXJzIiwicGFyc2UiLCJ2YWxpZCIsImNsZWFuIiwiaW5jIiwiZGlmZiIsIm1ham9yIiwibWlub3IiLCJwYXRjaCIsInByZXJlbGVhc2UiLCJjb21wYXJlIiwicmNvbXBhcmUiLCJjb21wYXJlTG9vc2UiLCJjb21wYXJlQnVpbGQiLCJzb3J0IiwicnNvcnQiLCJndCIsImx0IiwiZXEiLCJuZXEiLCJndGUiLCJsdGUiLCJjbXAiLCJjb2VyY2UiLCJDb21wYXJhdG9yIiwiUmFuZ2UiLCJzYXRpc2ZpZXMiLCJ0b0NvbXBhcmF0b3JzIiwibWF4U2F0aXNmeWluZyIsIm1pblNhdGlzZnlpbmciLCJtaW5WZXJzaW9uIiwidmFsaWRSYW5nZSIsIm91dHNpZGUiLCJndHIiLCJsdHIiLCJpbnRlcnNlY3RzIiwic2ltcGxpZnlSYW5nZSIsInN1YnNldCIsIm1vZHVsZSIsImV4cG9ydHMiLCJyZSIsInNyYyIsInRva2VucyIsInQiLCJTRU1WRVJfU1BFQ19WRVJTSU9OIiwiUkVMRUFTRV9UWVBFUyIsImNvbXBhcmVJZGVudGlmaWVycyIsInJjb21wYXJlSWRlbnRpZmllcnMiLCJ0aGVtZVNlbGVjdFN0eWxlIiwid2lkdGgiLCJtYXJnaW5MZWZ0IiwiZm9udFNpemVTZWxlY3RTdHlsZSIsInNlbGVjdExhYmVsU3R5bGUiLCJtYXJnaW5Ub3AiLCJtYXJnaW5Cb3R0b20iLCJtYXJnaW5SaWdodCIsImNoZWNrTGFiZWxTdHlsZSIsInByZWZzQ2hlY2tib3giLCJwcmVmc0xhYmVsZWRDaGVja2JveCIsImRpc3BsYXkiLCJhbGlnbkNvbnRlbnQiLCJfYSIsImluaXRpYWxQcmVmcyIsIm9uQ2xvc2UiLCJvbkFwcGx5Iiwib25TdWJtaXQiLCJkZWJ1ZyIsIl9iIiwibyIsIm4iLCJtIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJyIiwiZSIsImkiLCJjYWxsIiwiYXIiLCJuZXh0IiwiZG9uZSIsInB1c2giLCJ2YWx1ZSIsImVycm9yIiwiX19yZWFkIiwidXNlU3RhdGUiLCJwcmVmcyIsInNldFByZWZzIiwiaGFuZGxlS2V5RG93biIsImtleUNvZGUiLCJwcmV2ZW50RGVmYXVsdCIsImhhbmRsZVN1Ym1pdCIsInVwZGF0ZVByZWZzIiwidXBkYXRlcyIsInVwZGF0ZSIsInRoZW1lT3B0cyIsIk9iamVjdCIsImtleXMiLCJtYXAiLCJubSIsImtleSIsInRoZW1lU2VsZWN0IiwiY2xhc3NOYW1lIiwibmFtZSIsInRoZW1lIiwib25DaGFuZ2UiLCJ0YXJnZXQiLCJsYXlvdXRPcHRzIiwibGF5b3V0U2VsZWN0IiwibGF5b3V0IiwiY3VycmVudEZvbnRTaXplIiwiZm9udFNjYWxlRmFjdG9yIiwiZm9udFNpemVPcHRzIiwic3oiLCJ0b1N0cmluZyIsImZvbnRTaXplU2VsZWN0IiwibmV4dFNjYWxlRmFjdG9yIiwiTnVtYmVyIiwicGFyc2VJbnQiLCJyaWdodENvbCIsIk1vZGFsIiwidGl0bGUiLCJjeCIsInR5cGUiLCJjaGVja2VkIiwicG9wb3V0T25TdGFydCIsImRlZHVwZVRhYnMiLCJyZXZlcnRPbk9wZW4iLCJvbkNsaWNrIiwiaGFuZGxlQ2FuY2VsIiwidGFiSW5kZXgiLCJvbktleURvd24iLCJfIiwidGhyb3R0bGUiLCJtYXBWYWx1ZXMiLCJfX2F3YWl0ZXIiLCJzZXJCb29rbWFya0lkTWFwIiwidHciLCJjbGVhckNocm9tZVNlc3Npb25JZCIsInNhdmVkU3RhdGUiLCJzYXZlZFdpbmRvd1N0YXRlVmVyc2lvbiIsInNhdmVkV2luZG93U3RhdGUiLCJKU09OIiwic3RyaW5naWZ5IiwiY2hyb21lIiwic3RvcmFnZSIsImxvY2FsIiwic2V0IiwiRGF0ZSIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwic3RlcCIsInJlamVjdGVkIiwicmVzdWx0IiwidGhlbiIsImFwcGx5IiwiX19nZW5lcmF0b3IiLCJib2R5IiwiZiIsInkiLCJnIiwibGFiZWwiLCJzZW50IiwidHJ5cyIsIm9wcyIsInZlcmIiLCJ0aGlzIiwidiIsIm9wIiwiVHlwZUVycm9yIiwicG9wIiwibGVuZ3RoIiwiY2hyb21lRXZlbnRMb2ciLCJyZWFkU25hcFN0YXRlU3RyIiwiaXRlbXMiLCJzbmFwU3RhdGVTdHIiLCJzZXNzaW9uIiwiZ2V0Iiwic3RhdGVTbmFwc2hvdCIsImxvYWRTbmFwU3RhdGUiLCJzbmFwU3RhdGUiLCJta1JlZiIsImRlc2VyaWFsaXplIiwidGFiIiwidGFicyIsImdldEN1cnJlbnQiLCJpZCIsInJlbW92ZSIsIm9uQXBwbHlQcmVmZXJlbmNlcyIsInN0YXRlUmVmIiwibmV3UHJlZnMiLCJ3aW5kb3ciLCJvbmxvYWQiLCJtYXliZVN0YXRlUmVmIiwic3RhdGVSZWZfMSIsInN0IiwicGFyZW50Tm9kZSIsIm1vZGFsIiwiZV8xIiwibXV0YWJsZUdldCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJwcmVmZXJlbmNlcyIsInJlbmRlciIsInN0YWNrIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwidW5kZWZpbmVkIiwibG9hZGVkIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsIk8iLCJjaHVua0lkcyIsImZuIiwicHJpb3JpdHkiLCJub3RGdWxmaWxsZWQiLCJJbmZpbml0eSIsImoiLCJldmVyeSIsInNwbGljZSIsImdldHRlciIsIl9fZXNNb2R1bGUiLCJkIiwiYSIsImRlZmluaXRpb24iLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnbG9iYWxUaGlzIiwiRnVuY3Rpb24iLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJ0b1N0cmluZ1RhZyIsIm5tZCIsInBhdGhzIiwiY2hpbGRyZW4iLCJpbnN0YWxsZWRDaHVua3MiLCJjaHVua0lkIiwid2VicGFja0pzb25wQ2FsbGJhY2siLCJwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbiIsImRhdGEiLCJtb3JlTW9kdWxlcyIsInJ1bnRpbWUiLCJzb21lIiwiY2h1bmtMb2FkaW5nR2xvYmFsIiwic2VsZiIsImZvckVhY2giLCJiaW5kIiwiX193ZWJwYWNrX2V4cG9ydHNfXyJdLCJzb3VyY2VSb290IjoiIn0=