import{A as ud,B as Gn,C as Rd,E as od,F as $i,G as ap,H as cn,I as zY,J as I0,K as l0,L as G0,M as PG,N as c0,O as b0,P as W0,a as Mi,e as pd,f as Re,g as OG,h as Di,i as dp,j as kY,l as oe,m as Gd,n as Zp,o as zd,p as xY,q as qi,r as _i,t as Fe,u as Fa,x as Pi,y as ep}from"../chunk-OYHXKMKY.js";import{a as t0,b as n0,d as m0,e as _2}from"../chunk-7VOA22LO.js";import{B as Z0,D as e0,E as a0,G as q2,a as IG,b as f2,c as sg,d as uc,e as RG,f as LY,g as cp,h as Bi,i as S2,j as Oi,k as D2,l as ji,m as In,n as Ki,o as ld,p as Ti,q as AZ,s as LZ,t as fi,u as ln,v as Si,x as bp,z as d0}from"../chunk-GRFOF6YN.js";import{a as oa,b as vc,c as Ui,d as el}from"../chunk-FSRPMVAS.js";var N0=vc((B3,Wp)=>{(function(){"use strict";var I="input is invalid type",G="finalize already called",l=typeof window=="object",b=l?window:{};b.JS_SHA3_NO_WINDOW&&(l=!1);var d=!l&&typeof self=="object",e=!b.JS_SHA3_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;e?b=global:d&&(b=self);for(var t=!b.JS_SHA3_NO_COMMON_JS&&typeof Wp=="object"&&Wp.exports,W=typeof define=="function"&&define.amd,n=!b.JS_SHA3_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",s="0123456789abcdef".split(""),N=[31,7936,2031616,520093696],m=[4,1024,262144,67108864],h=[1,256,65536,16777216],V=[6,1536,393216,100663296],X=[0,8,16,24],p=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],F=[224,256,384,512],a=[128,256],u=["hex","buffer","arrayBuffer","array","digest"],Q={128:168,256:136},o=b.JS_SHA3_NO_NODE_JS||!Array.isArray?function(U){return Object.prototype.toString.call(U)==="[object Array]"}:Array.isArray,y=n&&(b.JS_SHA3_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)?function(U){return typeof U=="object"&&U.buffer&&U.buffer.constructor===ArrayBuffer}:ArrayBuffer.isView,H=function(U){var k=typeof U;if(k==="string")return[U,!0];if(k!=="object"||U===null)throw new Error(I);if(n&&U.constructor===ArrayBuffer)return[new Uint8Array(U),!1];if(!o(U)&&!y(U))throw new Error(I);return[U,!1]},E=function(U){return H(U)[0].length===0},C=function(U){for(var k=[],w=0;w<U.length;++w)k[w]=U[w];return k},T=function(U,k,w){return function(r){return new L(U,k,U).update(r)[w]()}},S=function(U,k,w){return function(r,A){return new L(U,k,A).update(r)[w]()}},cI=function(U,k,w){return function(r,A,O,K){return yI["cshake"+U].update(r,A,O,K)[w]()}},hI=function(U,k,w){return function(r,A,O,K){return yI["kmac"+U].update(r,A,O,K)[w]()}},WI=function(U,k,w,r){for(var A=0;A<u.length;++A){var O=u[A];U[O]=k(w,r,O)}return U},VI=function(U,k){var w=T(U,k,"hex");return w.create=function(){return new L(U,k,U)},w.update=function(r){return w.create().update(r)},WI(w,T,U,k)},sI=function(U,k){var w=S(U,k,"hex");return w.create=function(r){return new L(U,k,r)},w.update=function(r,A){return w.create(A).update(r)},WI(w,S,U,k)},ZI=function(U,k){var w=Q[U],r=cI(U,k,"hex");return r.create=function(A,O,K){return E(O)&&E(K)?yI["shake"+U].create(A):new L(U,k,A).bytepad([O,K],w)},r.update=function(A,O,K,q){return r.create(O,K,q).update(A)},WI(r,cI,U,k)},dI=function(U,k){var w=Q[U],r=hI(U,k,"hex");return r.create=function(A,O,K){return new bI(U,k,O).bytepad(["KMAC",K],w).bytepad([A],w)},r.update=function(A,O,K,q){return r.create(A,K,q).update(O)},WI(r,hI,U,k)},pI=[{name:"keccak",padding:h,bits:F,createMethod:VI},{name:"sha3",padding:V,bits:F,createMethod:VI},{name:"shake",padding:N,bits:a,createMethod:sI},{name:"cshake",padding:m,bits:a,createMethod:ZI},{name:"kmac",padding:m,bits:a,createMethod:dI}],yI={},eI=[],HI=0;HI<pI.length;++HI)for(var YI=pI[HI],$=YI.bits,JI=0;JI<$.length;++JI){var UI=YI.name+"_"+$[JI];if(eI.push(UI),yI[UI]=YI.createMethod($[JI],YI.padding),YI.name!=="sha3"){var zI=YI.name+$[JI];eI.push(zI),yI[zI]=yI[UI]}}function L(U,k,w){this.blocks=[],this.s=[],this.padding=k,this.outputBits=w,this.reset=!0,this.finalized=!1,this.block=0,this.start=0,this.blockCount=1600-(U<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=w>>5,this.extraBytes=(w&31)>>3;for(var r=0;r<50;++r)this.s[r]=0}L.prototype.update=function(U){if(this.finalized)throw new Error(G);var k=H(U);U=k[0];for(var w=k[1],r=this.blocks,A=this.byteCount,O=U.length,K=this.blockCount,q=0,GI=this.s,tI,iI;q<O;){if(this.reset)for(this.reset=!1,r[0]=this.block,tI=1;tI<K+1;++tI)r[tI]=0;if(w)for(tI=this.start;q<O&&tI<A;++q)iI=U.charCodeAt(q),iI<128?r[tI>>2]|=iI<<X[tI++&3]:iI<2048?(r[tI>>2]|=(192|iI>>6)<<X[tI++&3],r[tI>>2]|=(128|iI&63)<<X[tI++&3]):iI<55296||iI>=57344?(r[tI>>2]|=(224|iI>>12)<<X[tI++&3],r[tI>>2]|=(128|iI>>6&63)<<X[tI++&3],r[tI>>2]|=(128|iI&63)<<X[tI++&3]):(iI=65536+((iI&1023)<<10|U.charCodeAt(++q)&1023),r[tI>>2]|=(240|iI>>18)<<X[tI++&3],r[tI>>2]|=(128|iI>>12&63)<<X[tI++&3],r[tI>>2]|=(128|iI>>6&63)<<X[tI++&3],r[tI>>2]|=(128|iI&63)<<X[tI++&3]);else for(tI=this.start;q<O&&tI<A;++q)r[tI>>2]|=U[q]<<X[tI++&3];if(this.lastByteIndex=tI,tI>=A){for(this.start=tI-A,this.block=r[K],tI=0;tI<K;++tI)GI[tI]^=r[tI];FI(GI),this.reset=!0}else this.start=tI}return this},L.prototype.encode=function(U,k){var w=U&255,r=1,A=[w];for(U=U>>8,w=U&255;w>0;)A.unshift(w),U=U>>8,w=U&255,++r;return k?A.push(r):A.unshift(r),this.update(A),A.length},L.prototype.encodeString=function(U){var k=H(U);U=k[0];var w=k[1],r=0,A=U.length;if(w)for(var O=0;O<U.length;++O){var K=U.charCodeAt(O);K<128?r+=1:K<2048?r+=2:K<55296||K>=57344?r+=3:(K=65536+((K&1023)<<10|U.charCodeAt(++O)&1023),r+=4)}else r=A;return r+=this.encode(r*8),this.update(U),r},L.prototype.bytepad=function(U,k){for(var w=this.encode(k),r=0;r<U.length;++r)w+=this.encodeString(U[r]);var A=(k-w%k)%k,O=[];return O.length=A,this.update(O),this},L.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var U=this.blocks,k=this.lastByteIndex,w=this.blockCount,r=this.s;if(U[k>>2]|=this.padding[k&3],this.lastByteIndex===this.byteCount)for(U[0]=U[w],k=1;k<w+1;++k)U[k]=0;for(U[w-1]|=2147483648,k=0;k<w;++k)r[k]^=U[k];FI(r)}},L.prototype.toString=L.prototype.hex=function(){this.finalize();for(var U=this.blockCount,k=this.s,w=this.outputBlocks,r=this.extraBytes,A=0,O=0,K="",q;O<w;){for(A=0;A<U&&O<w;++A,++O)q=k[A],K+=s[q>>4&15]+s[q&15]+s[q>>12&15]+s[q>>8&15]+s[q>>20&15]+s[q>>16&15]+s[q>>28&15]+s[q>>24&15];O%U===0&&(k=C(k),FI(k),A=0)}return r&&(q=k[A],K+=s[q>>4&15]+s[q&15],r>1&&(K+=s[q>>12&15]+s[q>>8&15]),r>2&&(K+=s[q>>20&15]+s[q>>16&15])),K},L.prototype.arrayBuffer=function(){this.finalize();var U=this.blockCount,k=this.s,w=this.outputBlocks,r=this.extraBytes,A=0,O=0,K=this.outputBits>>3,q;r?q=new ArrayBuffer(w+1<<2):q=new ArrayBuffer(K);for(var GI=new Uint32Array(q);O<w;){for(A=0;A<U&&O<w;++A,++O)GI[O]=k[A];O%U===0&&(k=C(k),FI(k))}return r&&(GI[O]=k[A],q=q.slice(0,K)),q},L.prototype.buffer=L.prototype.arrayBuffer,L.prototype.digest=L.prototype.array=function(){this.finalize();for(var U=this.blockCount,k=this.s,w=this.outputBlocks,r=this.extraBytes,A=0,O=0,K=[],q,GI;O<w;){for(A=0;A<U&&O<w;++A,++O)q=O<<2,GI=k[A],K[q]=GI&255,K[q+1]=GI>>8&255,K[q+2]=GI>>16&255,K[q+3]=GI>>24&255;O%U===0&&(k=C(k),FI(k))}return r&&(q=O<<2,GI=k[A],K[q]=GI&255,r>1&&(K[q+1]=GI>>8&255),r>2&&(K[q+2]=GI>>16&255)),K};function bI(U,k,w){L.call(this,U,k,w)}bI.prototype=new L,bI.prototype.finalize=function(){return this.encode(this.outputBits,!0),L.prototype.finalize.call(this)};var FI=function(U){var k,w,r,A,O,K,q,GI,tI,iI,B,aI,lI,QI,vI,OI,uI,wI,kI,TI,Il,nl,ol,PI,KI,jI,Wl,wl,Ol,jl,NG,Fl,Dl,XG,LG,lc,DG,Wc,EG,MG,xc,qG,sl,ul,Cl,Gc,yc,ib,xG,lb,cc,Qb,YG,Lb,sb,td,Db,qb,_b,Yb,Pb,nd,hb;for(r=0;r<48;r+=2)A=U[0]^U[10]^U[20]^U[30]^U[40],O=U[1]^U[11]^U[21]^U[31]^U[41],K=U[2]^U[12]^U[22]^U[32]^U[42],q=U[3]^U[13]^U[23]^U[33]^U[43],GI=U[4]^U[14]^U[24]^U[34]^U[44],tI=U[5]^U[15]^U[25]^U[35]^U[45],iI=U[6]^U[16]^U[26]^U[36]^U[46],B=U[7]^U[17]^U[27]^U[37]^U[47],aI=U[8]^U[18]^U[28]^U[38]^U[48],lI=U[9]^U[19]^U[29]^U[39]^U[49],k=aI^(K<<1|q>>>31),w=lI^(q<<1|K>>>31),U[0]^=k,U[1]^=w,U[10]^=k,U[11]^=w,U[20]^=k,U[21]^=w,U[30]^=k,U[31]^=w,U[40]^=k,U[41]^=w,k=A^(GI<<1|tI>>>31),w=O^(tI<<1|GI>>>31),U[2]^=k,U[3]^=w,U[12]^=k,U[13]^=w,U[22]^=k,U[23]^=w,U[32]^=k,U[33]^=w,U[42]^=k,U[43]^=w,k=K^(iI<<1|B>>>31),w=q^(B<<1|iI>>>31),U[4]^=k,U[5]^=w,U[14]^=k,U[15]^=w,U[24]^=k,U[25]^=w,U[34]^=k,U[35]^=w,U[44]^=k,U[45]^=w,k=GI^(aI<<1|lI>>>31),w=tI^(lI<<1|aI>>>31),U[6]^=k,U[7]^=w,U[16]^=k,U[17]^=w,U[26]^=k,U[27]^=w,U[36]^=k,U[37]^=w,U[46]^=k,U[47]^=w,k=iI^(A<<1|O>>>31),w=B^(O<<1|A>>>31),U[8]^=k,U[9]^=w,U[18]^=k,U[19]^=w,U[28]^=k,U[29]^=w,U[38]^=k,U[39]^=w,U[48]^=k,U[49]^=w,QI=U[0],vI=U[1],Gc=U[11]<<4|U[10]>>>28,yc=U[10]<<4|U[11]>>>28,wl=U[20]<<3|U[21]>>>29,Ol=U[21]<<3|U[20]>>>29,Yb=U[31]<<9|U[30]>>>23,Pb=U[30]<<9|U[31]>>>23,qG=U[40]<<18|U[41]>>>14,sl=U[41]<<18|U[40]>>>14,XG=U[2]<<1|U[3]>>>31,LG=U[3]<<1|U[2]>>>31,OI=U[13]<<12|U[12]>>>20,uI=U[12]<<12|U[13]>>>20,ib=U[22]<<10|U[23]>>>22,xG=U[23]<<10|U[22]>>>22,jl=U[33]<<13|U[32]>>>19,NG=U[32]<<13|U[33]>>>19,nd=U[42]<<2|U[43]>>>30,hb=U[43]<<2|U[42]>>>30,Lb=U[5]<<30|U[4]>>>2,sb=U[4]<<30|U[5]>>>2,lc=U[14]<<6|U[15]>>>26,DG=U[15]<<6|U[14]>>>26,wI=U[25]<<11|U[24]>>>21,kI=U[24]<<11|U[25]>>>21,lb=U[34]<<15|U[35]>>>17,cc=U[35]<<15|U[34]>>>17,Fl=U[45]<<29|U[44]>>>3,Dl=U[44]<<29|U[45]>>>3,PI=U[6]<<28|U[7]>>>4,KI=U[7]<<28|U[6]>>>4,td=U[17]<<23|U[16]>>>9,Db=U[16]<<23|U[17]>>>9,Wc=U[26]<<25|U[27]>>>7,EG=U[27]<<25|U[26]>>>7,TI=U[36]<<21|U[37]>>>11,Il=U[37]<<21|U[36]>>>11,Qb=U[47]<<24|U[46]>>>8,YG=U[46]<<24|U[47]>>>8,ul=U[8]<<27|U[9]>>>5,Cl=U[9]<<27|U[8]>>>5,jI=U[18]<<20|U[19]>>>12,Wl=U[19]<<20|U[18]>>>12,qb=U[29]<<7|U[28]>>>25,_b=U[28]<<7|U[29]>>>25,MG=U[38]<<8|U[39]>>>24,xc=U[39]<<8|U[38]>>>24,nl=U[48]<<14|U[49]>>>18,ol=U[49]<<14|U[48]>>>18,U[0]=QI^~OI&wI,U[1]=vI^~uI&kI,U[10]=PI^~jI&wl,U[11]=KI^~Wl&Ol,U[20]=XG^~lc&Wc,U[21]=LG^~DG&EG,U[30]=ul^~Gc&ib,U[31]=Cl^~yc&xG,U[40]=Lb^~td&qb,U[41]=sb^~Db&_b,U[2]=OI^~wI&TI,U[3]=uI^~kI&Il,U[12]=jI^~wl&jl,U[13]=Wl^~Ol&NG,U[22]=lc^~Wc&MG,U[23]=DG^~EG&xc,U[32]=Gc^~ib&lb,U[33]=yc^~xG&cc,U[42]=td^~qb&Yb,U[43]=Db^~_b&Pb,U[4]=wI^~TI&nl,U[5]=kI^~Il&ol,U[14]=wl^~jl&Fl,U[15]=Ol^~NG&Dl,U[24]=Wc^~MG&qG,U[25]=EG^~xc&sl,U[34]=ib^~lb&Qb,U[35]=xG^~cc&YG,U[44]=qb^~Yb&nd,U[45]=_b^~Pb&hb,U[6]=TI^~nl&QI,U[7]=Il^~ol&vI,U[16]=jl^~Fl&PI,U[17]=NG^~Dl&KI,U[26]=MG^~qG&XG,U[27]=xc^~sl&LG,U[36]=lb^~Qb&ul,U[37]=cc^~YG&Cl,U[46]=Yb^~nd&Lb,U[47]=Pb^~hb&sb,U[8]=nl^~QI&OI,U[9]=ol^~vI&uI,U[18]=Fl^~PI&jI,U[19]=Dl^~KI&Wl,U[28]=qG^~XG&lc,U[29]=sl^~LG&DG,U[38]=Qb^~ul&Gc,U[39]=YG^~Cl&yc,U[48]=nd^~Lb&td,U[49]=hb^~sb&Db,U[0]^=p[r],U[1]^=p[r+1]};if(t)Wp.exports=yI;else{for(HI=0;HI<eI.length;++HI)b[eI[HI]]=yI[eI[HI]];W&&define(function(){return yI})}})()});var $2=vc(P2=>{"use strict";Object.defineProperty(P2,"__esModule",{value:!0});var Xe=function(I,G){I=[I[0]>>>16,65535&I[0],I[1]>>>16,65535&I[1]],G=[G[0]>>>16,65535&G[0],G[1]>>>16,65535&G[1]];var l=[0,0,0,0];return l[3]+=I[3]+G[3],l[2]+=l[3]>>>16,l[3]&=65535,l[2]+=I[2]+G[2],l[1]+=l[2]>>>16,l[2]&=65535,l[1]+=I[1]+G[1],l[0]+=l[1]>>>16,l[1]&=65535,l[0]+=I[0]+G[0],l[0]&=65535,[l[0]<<16|l[1],l[2]<<16|l[3]]},Fd=function(I,G){I=[I[0]>>>16,65535&I[0],I[1]>>>16,65535&I[1]],G=[G[0]>>>16,65535&G[0],G[1]>>>16,65535&G[1]];var l=[0,0,0,0];return l[3]+=I[3]*G[3],l[2]+=l[3]>>>16,l[3]&=65535,l[2]+=I[2]*G[3],l[1]+=l[2]>>>16,l[2]&=65535,l[2]+=I[3]*G[2],l[1]+=l[2]>>>16,l[2]&=65535,l[1]+=I[1]*G[3],l[0]+=l[1]>>>16,l[1]&=65535,l[1]+=I[2]*G[2],l[0]+=l[1]>>>16,l[1]&=65535,l[1]+=I[3]*G[1],l[0]+=l[1]>>>16,l[1]&=65535,l[0]+=I[0]*G[3]+I[1]*G[2]+I[2]*G[1]+I[3]*G[0],l[0]&=65535,[l[0]<<16|l[1],l[2]<<16|l[3]]},bn=function(I,G){return(G%=64)===32?[I[1],I[0]]:G<32?[I[0]<<G|I[1]>>>32-G,I[1]<<G|I[0]>>>32-G]:(G-=32,[I[1]<<G|I[0]>>>32-G,I[0]<<G|I[1]>>>32-G])},cd=function(I,G){return(G%=64)===0?I:G<32?[I[0]<<G|I[1]>>>32-G,I[1]<<G]:[I[1]<<G-32,0]},Xc=function(I,G){return[I[0]^G[0],I[1]^G[1]]},s0=function(I){return I=Xc(I,[0,I[0]>>>1]),I=Fd(I,[4283543511,3981806797]),I=Xc(I,[0,I[0]>>>1]),I=Fd(I,[3301882366,444984403]),I=Xc(I,[0,I[0]>>>1])},Yg=function(I,G){G=G||0;for(var l=(I=I||"").length%16,b=I.length-l,d=[0,G],e=[0,G],t=[0,0],W=[0,0],n=[2277735313,289559509],s=[1291169091,658871167],N=0;N<b;N+=16)t=[255&I.charCodeAt(N+4)|(255&I.charCodeAt(N+5))<<8|(255&I.charCodeAt(N+6))<<16|(255&I.charCodeAt(N+7))<<24,255&I.charCodeAt(N)|(255&I.charCodeAt(N+1))<<8|(255&I.charCodeAt(N+2))<<16|(255&I.charCodeAt(N+3))<<24],W=[255&I.charCodeAt(N+12)|(255&I.charCodeAt(N+13))<<8|(255&I.charCodeAt(N+14))<<16|(255&I.charCodeAt(N+15))<<24,255&I.charCodeAt(N+8)|(255&I.charCodeAt(N+9))<<8|(255&I.charCodeAt(N+10))<<16|(255&I.charCodeAt(N+11))<<24],t=Fd(t,n),t=bn(t,31),t=Fd(t,s),d=Xc(d,t),d=bn(d,27),d=Xe(d,e),d=Xe(Fd(d,[0,5]),[0,1390208809]),W=Fd(W,s),W=bn(W,33),W=Fd(W,n),e=Xc(e,W),e=bn(e,31),e=Xe(e,d),e=Xe(Fd(e,[0,5]),[0,944331445]);switch(t=[0,0],W=[0,0],l){case 15:W=Xc(W,cd([0,I.charCodeAt(N+14)],48));case 14:W=Xc(W,cd([0,I.charCodeAt(N+13)],40));case 13:W=Xc(W,cd([0,I.charCodeAt(N+12)],32));case 12:W=Xc(W,cd([0,I.charCodeAt(N+11)],24));case 11:W=Xc(W,cd([0,I.charCodeAt(N+10)],16));case 10:W=Xc(W,cd([0,I.charCodeAt(N+9)],8));case 9:W=Xc(W,[0,I.charCodeAt(N+8)]),W=Fd(W,s),W=bn(W,33),W=Fd(W,n),e=Xc(e,W);case 8:t=Xc(t,cd([0,I.charCodeAt(N+7)],56));case 7:t=Xc(t,cd([0,I.charCodeAt(N+6)],48));case 6:t=Xc(t,cd([0,I.charCodeAt(N+5)],40));case 5:t=Xc(t,cd([0,I.charCodeAt(N+4)],32));case 4:t=Xc(t,cd([0,I.charCodeAt(N+3)],24));case 3:t=Xc(t,cd([0,I.charCodeAt(N+2)],16));case 2:t=Xc(t,cd([0,I.charCodeAt(N+1)],8));case 1:t=Xc(t,[0,I.charCodeAt(N)]),t=Fd(t,n),t=bn(t,31),t=Fd(t,s),d=Xc(d,t)}return d=Xc(d,[0,I.length]),e=Xc(e,[0,I.length]),d=Xe(d,e),e=Xe(e,d),d=s0(d),e=s0(e),d=Xe(d,e),e=Xe(e,d),("00000000"+(d[0]>>>0).toString(16)).slice(-8)+("00000000"+(d[1]>>>0).toString(16)).slice(-8)+("00000000"+(e[0]>>>0).toString(16)).slice(-8)+("00000000"+(e[1]>>>0).toString(16)).slice(-8)};P2.default=Yg});var p0=vc(IR=>{"use strict";Object.defineProperty(IR,"__esModule",{value:!0});var Y0=$2(),hg=window.crypto||window.msCrypto;function Vg(I){let G=hg.getRandomValues(new Uint8Array(I));return btoa(String.fromCharCode(...G))}var pg={DNT:"unknown",L:"en-US",D:24,PR:1,S:[1920,1200],AS:[1920,1200],TO:9999,SS:!0,LS:!0,IDB:!0,B:!1,ODB:!0,CPUC:"unknown",PK:"Win32",CFP:`canvas winding:yes~canvas fp:data:image/png;base64,${btoa(Math.random().toString())}`,FR:!1,FOS:!1,FB:!1,JSF:["Andale Mono","Arial","Arial Black","Arial Hebrew","Arial MT","Arial Narrow","Arial Rounded MT Bold","Arial Unicode MS","Bitstream Vera Sans Mono","Book Antiqua","Bookman Old Style","Calibri","Cambria","Cambria Math","Century","Century Gothic","Century Schoolbook","Comic Sans","Comic Sans MS","Consolas","Courier","Courier New","Garamond","Geneva","Georgia","Helvetica","Helvetica Neue","Impact","Lucida Bright","Lucida Calligraphy","Lucida Console","Lucida Fax","LUCIDA GRANDE","Lucida Handwriting","Lucida Sans","Lucida Sans Typewriter","Lucida Sans Unicode","Microsoft Sans Serif","Monaco","Monotype Corsiva","MS Gothic","MS Outlook","MS PGothic","MS Reference Sans Serif","MS Sans Serif","MS Serif","MYRIAD","MYRIAD PRO","Palatino","Palatino Linotype","Segoe Print","Segoe Script","Segoe UI","Segoe UI Light","Segoe UI Semibold","Segoe UI Symbol","Tahoma","Times","Times New Roman","Times New Roman PS","Trebuchet MS","Verdana","Wingdings","Wingdings 2","Wingdings 3"],P:["Chrome PDF Plugin::Portable Document Format::application/x-google-chrome-pdf~pdf","Chrome PDF Viewer::::application/pdf~pdf","Native Client::::application/x-nacl~,application/x-pnacl~"],T:[0,!1,!1],H:24,SWF:!1},h0=["af","af-ZA","ar","ar-AE","ar-BH","ar-DZ","ar-EG","ar-IQ","ar-JO","ar-KW","ar-LB","ar-LY","ar-MA","ar-OM","ar-QA","ar-SA","ar-SY","ar-TN","ar-YE","az","az-AZ","az-AZ","be","be-BY","bg","bg-BG","bs-BA","ca","ca-ES","cs","cs-CZ","cy","cy-GB","da","da-DK","de","de-AT","de-CH","de-DE","de-LI","de-LU","dv","dv-MV","el","el-GR","en","en-AU","en-BZ","en-CA","en-CB","en-GB","en-IE","en-JM","en-NZ","en-PH","en-TT","en-US","en-ZA","en-ZW","eo","es","es-AR","es-BO","es-CL","es-CO","es-CR","es-DO","es-EC","es-ES","es-ES","es-GT","es-HN","es-MX","es-NI","es-PA","es-PE","es-PR","es-PY","es-SV","es-UY","es-VE","et","et-EE","eu","eu-ES","fa","fa-IR","fi","fi-FI","fo","fo-FO","fr","fr-BE","fr-CA","fr-CH","fr-FR","fr-LU","fr-MC","gl","gl-ES","gu","gu-IN","he","he-IL","hi","hi-IN","hr","hr-BA","hr-HR","hu","hu-HU","hy","hy-AM","id","id-ID","is","is-IS","it","it-CH","it-IT","ja","ja-JP","ka","ka-GE","kk","kk-KZ","kn","kn-IN","ko","ko-KR","kok","kok-IN","ky","ky-KG","lt","lt-LT","lv","lv-LV","mi","mi-NZ","mk","mk-MK","mn","mn-MN","mr","mr-IN","ms","ms-BN","ms-MY","mt","mt-MT","nb","nb-NO","nl","nl-BE","nl-NL","nn-NO","ns","ns-ZA","pa","pa-IN","pl","pl-PL","ps","ps-AR","pt","pt-BR","pt-PT","qu","qu-BO","qu-EC","qu-PE","ro","ro-RO","ru","ru-RU","sa","sa-IN","se","se-FI","se-FI","se-FI","se-NO","se-NO","se-NO","se-SE","se-SE","se-SE","sk","sk-SK","sl","sl-SI","sq","sq-AL","sr-BA","sr-BA","sr-SP","sr-SP","sv","sv-FI","sv-SE","sw","sw-KE","syr","syr-SY","ta","ta-IN","te","te-IN","th","th-TH","tl","tl-PH","tn","tn-ZA","tr","tr-TR","tt","tt-RU","ts","uk","uk-UA","ur","ur-PK","uz","uz-UZ","uz-UZ","vi","vi-VN","xh","xh-ZA","zh","zh-CN","zh-HK","zh-MO","zh-SG","zh-TW","zu","zu-ZA"],V0=[[1920,1080],[1920,1200],[2048,1080],[2560,1440],[1366,768],[1440,900],[1536,864],[1680,1050],[1280,1024],[1280,800],[1280,720],[1600,1200],[1600,900]];function ug(){return V0[Math.floor(Math.random()*V0.length)]}function Rg(){let I={...pg};return I.DNT="unknown",I.L=h0[Math.floor(Math.random()*h0.length)],I.D=[8,24][Math.floor(Math.random()*2)],I.PR=Math.round(Math.random()*100)/100*2+.5,I.S=ug(),I.AS=I.S,I.TO=(Math.floor(Math.random()*24)-12)*60,I.SS=Math.random()>.5,I.LS=Math.random()>.5,I.IDB=Math.random()>.5,I.B=Math.random()>.5,I.ODB=Math.random()>.5,I.CPUC="unknown",I.PK="Win32",I.CFP="canvas winding:yes~canvas fp:data:image/png;base64,"+Vg(128),I.FR=!1,I.FOS=!1,I.FB=!1,I.JSF=I.JSF.filter(()=>Math.random()>.5),I.P=I.P.filter(()=>Math.random()>.5),I.T=[Math.floor(Math.random()*8),Math.random()>.5,Math.random()>.5],I.H=2**Math.floor(Math.random()*6),I.SWF=I.SWF,I}function og(I){let G=[],l=Object.keys(I);for(let b=0;b<l.length;b++)I[l[b]].join?G.push(I[l[b]].join(";")):G.push(I[l[b]]);return G.join("~~~")}function Fg(I){let G=[],l=Object.keys(I);for(let b=0;b<l.length;b++)switch(l[b]){case"CFP":G.push(`${l[b]}:${Xg(I[l[b]])}`);break;case"P":G.push(`${l[b]}:${I[l[b]].map(d=>d.split("::")[0])}`);break;default:G.push(`${l[b]}:${I[l[b]]}`);break}return G}function Xg(I){var G,l;if(!I)return"";if(Array.prototype.reduce)return I.split("").reduce(function(d,e){return d=(d<<5)-d+e.charCodeAt(0),d&d},0);if(G=0,I.length===0)return G;for(var b=0;b<I.length;b++)l=I.charCodeAt(b),G=(G<<5)-G+l,G=G&G;return G}var ig={webgl_extensions:"ANGLE_instanced_arrays;EXT_blend_minmax;EXT_color_buffer_half_float;EXT_disjoint_timer_query;EXT_float_blend;EXT_frag_depth;EXT_shader_texture_lod;EXT_texture_compression_bptc;EXT_texture_compression_rgtc;EXT_texture_filter_anisotropic;EXT_sRGB;KHR_parallel_shader_compile;OES_element_index_uint;OES_fbo_render_mipmap;OES_standard_derivatives;OES_texture_float;OES_texture_float_linear;OES_texture_half_float;OES_texture_half_float_linear;OES_vertex_array_object;WEBGL_color_buffer_float;WEBGL_compressed_texture_s3tc;WEBGL_compressed_texture_s3tc_srgb;WEBGL_debug_renderer_info;WEBGL_debug_shaders;WEBGL_depth_texture;WEBGL_draw_buffers;WEBGL_lose_context;WEBGL_multi_draw",webgl_extensions_hash:"58a5a04a5bef1a78fa88d5c5098bd237",webgl_renderer:"WebKit WebGL",webgl_vendor:"WebKit",webgl_version:"WebGL 1.0 (OpenGL ES 2.0 Chromium)",webgl_shading_language_version:"WebGL GLSL ES 1.0 (OpenGL ES GLSL ES 1.0 Chromium)",webgl_aliased_line_width_range:"[1, 1]",webgl_aliased_point_size_range:"[1, 1023]",webgl_antialiasing:"yes",webgl_bits:"8,8,24,8,8,0",webgl_max_params:"16,64,16384,4096,8192,32,8192,31,16,32,4096",webgl_max_viewport_dims:"[8192, 8192]",webgl_unmasked_vendor:"Google Inc. (Google)",webgl_unmasked_renderer:"ANGLE (Google, Vulkan 1.3.0 (SwiftShader Device (Subzero) (0x0000C0DE)), SwiftShader driver)",webgl_vsf_params:"23,127,127,23,127,127,23,127,127",webgl_vsi_params:"0,31,30,0,31,30,0,31,30",webgl_fsf_params:"23,127,127,23,127,127,23,127,127",webgl_fsi_params:"0,31,30,0,31,30,0,31,30",webgl_hash_webgl:null,user_agent_data_brands:"Chromium,Google Chrome,Not=A?Brand",user_agent_data_mobile:null,navigator_connection_downlink:null,navigator_connection_downlink_max:null,network_info_rtt:null,network_info_save_data:!1,network_info_rtt_type:null,screen_pixel_depth:24,navigator_device_memory:.5,navigator_languages:"en-US,fr-BE,fr,en-BE,en",window_inner_width:0,window_inner_height:0,window_outer_width:2195,window_outer_height:1195,browser_detection_firefox:!1,browser_detection_brave:!1,audio_codecs:'{"ogg":"probably","mp3":"probably","wav":"probably","m4a":"maybe","aac":"probably"}',video_codecs:'{"ogg":"probably","h264":"probably","webm":"probably","mpeg4v":"","mpeg4a":"","theora":""}',media_query_dark_mode:!0,headless_browser_phantom:!1,headless_browser_selenium:!1,headless_browser_nightmare_js:!1,document__referrer:"https://www.roblox.com/",window__ancestor_origins:["https://www.roblox.com"],window__tree_index:[0],window__tree_structure:"[[]]",window__location_href:"https://roblox-api.arkoselabs.com/v2/1.5.5/enforcement.fbfc14b0d793c6ef8359e0e4b4a91f67.html#476068BF-9607-4799-B53D-966BE98E2B81",client_config__sitedata_location_href:"https://www.roblox.com/arkose/iframe",client_config__surl:"https://roblox-api.arkoselabs.com",client_config__language:null,navigator_battery_charging:!0,audio_fingerprint:"124.04347527516074"};function Qg(I,G,l){let b={...ig};return b.webgl_extensions=b.webgl_extensions.split(";").filter(d=>Math.random()>.5).join(";"),b.webgl_extensions_hash=(0,Y0.default)(b.webgl_extensions,0),b.screen_pixel_depth=I.D,b.navigator_languages=I.L,b.window_outer_height=I.S[0],b.window_outer_width=I.S[1],b.window_inner_height=I.S[0],b.window_inner_width=I.S[1],b.screen_pixel_depth=I.D,b.browser_detection_firefox=!!G.match(/Firefox\/\d+/),b.browser_detection_brave=!!G.match(/Brave\/\d+/),b.media_query_dark_mode=Math.random()>.9,b.webgl_hash_webgl=(0,Y0.default)(Object.entries(b).filter(([d,e])=>d.startsWith("webgl_")&&d!="webgl_hash_webgl").map(([d,e])=>e).join(","),0),b.client_config__language=l.language||null,b.window__location_href=`${l.surl}/v2/1.5.5/enforcement.fbfc14b0d793c6ef8359e0e4b4a91f67.html#${l.pkey}`,l.site&&(b.document__referrer=l.site,b.window__ancestor_origins=[l.site],b.client_config__sitedata_location_href=l.site),b.client_config__surl=l.surl||"https://client-api.arkoselabs.com",b.audio_fingerprint=(124.04347527516074+Math.random()*.001-5e-4).toString(),Object.entries(b).map(([d,e])=>({key:d,value:e}))}IR.default={getFingerprint:Rg,prepareF:og,prepareFe:Fg,getEnhancedFingerprint:Qg}});var GR=vc(lR=>{"use strict";Object.defineProperty(lR,"__esModule",{value:!0});async function Hg(I,G){let l=new TextEncoder,b=crypto.getRandomValues(new Uint8Array(8)),d=await crypto.subtle.importKey("raw",l.encode(G),{name:"PBKDF2"},!1,["deriveBits"]),e=await crypto.subtle.deriveBits({name:"PBKDF2",salt:b,iterations:1e3,hash:"SHA-256"},d,512),t=await crypto.subtle.importKey("raw",e.slice(0,32),{name:"AES-CBC",length:256},!1,["encrypt"]),W=e.slice(32,48),n=await crypto.subtle.encrypt({name:"AES-CBC",iv:W},t,l.encode(I));return JSON.stringify({ct:Array.from(new Uint8Array(n)).map(s=>String.fromCharCode(s)).join(""),iv:Array.from(new Uint8Array(W)).map(s=>String.fromCharCode(s)).join(""),s:Array.from(b).map(s=>String.fromCharCode(s)).join("")})}async function rg(I,G){let l=new TextEncoder,b=new TextDecoder,d=JSON.parse(I),e=Array.from(d.s).map(h=>h.charCodeAt(0)),t=await crypto.subtle.importKey("raw",l.encode(G),{name:"PBKDF2"},!1,["deriveBits"]),W=await crypto.subtle.deriveBits({name:"PBKDF2",salt:new Uint8Array(e),iterations:1e3,hash:"SHA-256"},t,512),n=await crypto.subtle.importKey("raw",W.slice(0,32),{name:"AES-CBC",length:256},!1,["decrypt"]),s=Array.from(d.iv).map(h=>h.charCodeAt(0)),N=Array.from(d.ct).map(h=>h.charCodeAt(0)),m=await crypto.subtle.decrypt({name:"AES-CBC",iv:new Uint8Array(s)},n,new Uint8Array(N));return b.decode(m)}lR.default={encrypt:Hg,decrypt:rg}});var tp=vc(dR=>{"use strict";Object.defineProperty(dR,"__esModule",{value:!0});var UY=p0(),u0=$2(),wg=GR(),vg=new TextEncoder,Eg="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36",cR={v1:{3:{default:I=>I,method_1:I=>({x:I.y,y:I.x}),method_2:I=>({x:I.x,y:(I.y+I.x)*I.x}),method_3:I=>({a:I.x,b:I.y}),method_4:I=>[I.x,I.y],method_5:I=>[I.y,I.x].map(G=>Math.sqrt(G))},4:{default:I=>I}},v2:{3:{value:{alpha:I=>({x:I.x,y:(I.y+I.x)*I.x,px:I.px,py:I.py}),beta:I=>({x:I.y,y:I.x,py:I.px,px:I.py}),gamma:I=>({x:I.y+1,y:-I.x,px:I.px,py:I.py}),delta:I=>({x:I.y+.25,y:I.x+.5,px:I.px,py:I.py}),epsilon:I=>({x:I.x*.5,y:I.y*5,px:I.px,py:I.py}),zeta:I=>({x:I.x+1,y:I.y+2,px:I.px,py:I.py}),method_1:I=>({x:I.x,y:I.y,px:I.px,py:I.py}),method_2:I=>({x:I.y,y:(I.y+I.x)*I.x,px:I.px,py:I.py}),method_3:I=>({x:Math.sqrt(I.x),y:Math.sqrt(I.y),px:I.px,py:I.py})},key:{alpha:I=>[I.y,I.px,I.py,I.x],beta:I=>JSON.stringify({x:I.x,y:I.y,px:I.px,py:I.py}),gamma:I=>[I.x,I.y,I.px,I.py].join(" "),delta:I=>[1,I.x,2,I.y,3,I.px,4,I.py],epsilon:I=>({answer:{x:I.x,y:I.y,px:I.px,py:I.py}}),zeta:I=>[I.x,[I.y,[I.px,[I.py]]]],method_1:I=>({a:I.x,b:I.y,px:I.px,py:I.py}),method_2:I=>[I.x,I.y],method_3:I=>[I.y,I.x]}},4:{value:{alpha:I=>({index:String(I.index)+1-2}),beta:I=>({index:-I.index}),gamma:I=>({index:3*(3-I.index)}),delta:I=>({index:7*I.index}),epsilon:I=>({index:2*I.index}),zeta:I=>({index:I.index?100/I.index:I.index}),va:I=>({index:I.index+3}),vb:I=>({index:-I.index}),vc:I=>({index:10-I.index}),vd:I=>({index:3*I.index})},key:{alpha:I=>[Math.round(100*Math.random()),I.index,Math.round(100*Math.random())],beta:I=>({size:50-I.index,id:I.index,limit:10*I.index,req_timestamp:Date.now()}),gamma:I=>I.index,delta:I=>({index:I.index}),epsilon:I=>{let G=[],l=Math.round(5*Math.random())+1,b=Math.round(Math.random()*l);for(let d=0;d<l;d++)G.push(d===b?I.index:Math.round(10*Math.random()));return G.push(b),G},zeta:I=>Array(Math.round(5*Math.random())+1).concat(I.index),ka:I=>I.index,kb:I=>[I.index],kc:I=>({guess:I.index})}}}};function yg(I){let G=I%3*100+I%3*3+3+10+Math.floor(Math.random()*80),l=Math.floor(I/3)*100+Math.floor(I/3)*3+3+10+Math.floor(Math.random()*80);return{x:G,y:l,px:G/300,py:l/200}}function gg(I){return Object.keys(I).filter(G=>I[G]!==void 0).map(G=>`${G}=${encodeURIComponent(I[G])}`).join("&")}function bR(){return Array(32).fill(0).map(()=>"0123456789abcdef"[Math.floor(Math.random()*16)]).join("")}function Jg(){let I=new Date().getTime().toString(),G=`${I.substring(0,7)}00${I.substring(7,13)}`;return{cookie:`timestamp=${G};path=/;secure;samesite=none`,value:G}}async function Cg(I,G){let l=UY.default.getFingerprint(),b=UY.default.prepareFe(l),d=[{key:"api_type",value:"js"},{key:"p",value:1},{key:"f",value:(0,u0.default)(UY.default.prepareF(UY.default),31)},{key:"n",value:btoa(Math.round(Date.now()/1e3).toString())},{key:"wh",value:`${bR()}|${bR()}`},{key:"enhanced_fp",value:UY.default.getEnhancedFingerprint(l,I,G)},{key:"fe",value:b},{key:"ife_hash",value:(0,u0.default)(b.join(", "),38)},{key:"cs",value:1},{key:"jsbd",value:JSON.stringify({HL:4,DT:"",NWD:"false",DOTO:1,DMTO:1})}],e=new Date().getTime()/1e3,t=I+Math.round(e-e%21600),W=JSON.stringify(d),n=await wg.default.encrypt(W,t);return Lg(vg.encode(n))}function Ag(I,G="default",l,b){if(!I&&typeof G=="string")return(cR.v1[l][G||"default"]||(d=>d))(b);if(typeof G!="string"){let d=cR.v2[l],e=G.value.reduce((t,W)=>d.value[W]?d.value[W](t):W,b);return d.key[G.key](e)}else return b}function Lg(I){return btoa(String.fromCharCode.apply(null,I))}dR.default={DEFAULT_USER_AGENT:Eg,tileToLoc:yg,constructFormData:gg,getBda:Cg,apiBreakers:cR,getTimestamp:Jg,random:bR,solveBreaker:Ag}});var R0=vc(mp=>{"use strict";Object.defineProperty(mp,"__esModule",{value:!0});mp.getToken=void 0;var np=tp();async function kg(I){I={surl:"https://client-api.arkoselabs.com",data:{},...I},I.headers?Object.keys(I.headers).map(b=>b.toLowerCase()).includes("user-agent")||(I.headers["User-Agent"]=np.default.DEFAULT_USER_AGENT):I.headers={"User-Agent":np.default.DEFAULT_USER_AGENT},I.headers["Accept-Language"]="en-US,en;q=0.9",I.headers["Sec-Fetch-Site"]="same-origin",I.headers.Accept="*/*",I.headers["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8",I.headers["sec-fetch-mode"]="cors",I.site&&(I.headers.Origin=I.surl,I.headers.Referer=`${I.surl}/v2/${I.pkey}/1.5.5/enforcement.fbfc14b0d793c6ef8359e0e4b4a91f67.html`);let G=I.headers[Object.keys(I.headers).find(b=>b.toLowerCase()=="user-agent")],l=await fetch(`${I.surl}/fc/gt2/public_key/${I.pkey}`,{method:"POST",body:np.default.constructFormData({bda:await np.default.getBda(G,I),public_key:I.pkey,site:I.site?new URL(I.site).origin:void 0,userbrowser:G,capi_version:"1.5.5",capi_mode:"inline",style_theme:"default",rnd:Math.random().toString(),...Object.fromEntries(Object.keys(I.data).map(b=>["data["+b+"]",I.data[b]])),language:I.language||"en"}),headers:I.headers});if(!l.ok)throw new Error("Network response was not ok");return await l.json()}mp.getToken=kg});var eR=vc(ZR=>{"use strict";Object.defineProperty(ZR,"__esModule",{value:!0});async function xg(I,G){let l=await fetch(I,{...G}),b={};l.headers.forEach((e,t)=>{b[t]=e});let d=await l.arrayBuffer();return{headers:b,body:d}}ZR.default=xg});var F0=vc(tZ=>{"use strict";Object.defineProperty(tZ,"__esModule",{value:!0});tZ.Challenge4=tZ.Challenge3=tZ.Challenge1=tZ.Challenge=void 0;var MY=eR(),kZ=tp(),dn=GR(),Zn=class{constructor(G,l){this.wave=0,this.data=G,this.userAgent=l.userAgent,this.proxy=l.proxy,this.imgs=G.game_data.customGUI._challenge_imgs.map(async b=>(await(0,MY.default)(b,{method:"GET",path:void 0,headers:{"User-Agent":this.userAgent,Referer:this.data.tokenInfo.surl}})).body),G.game_data.customGUI.encrypted_mode&&(this.key=this.getKey())}async getImage(){let G=await this.imgs[this.wave];try{JSON.parse(G.toString()),G=Buffer.from(await dn.default.decrypt(G.toString(),await this.getKey()),"base64")}catch{}return G}async getKey(){if(this.key)return await this.key;let G=await(0,MY.default)(this.data.tokenInfo.surl,{method:"POST",path:"/fc/ekey/",headers:{"User-Agent":this.userAgent,"Content-Type":"application/x-www-form-urlencoded",Referer:this.data.tokenInfo.surl},body:kZ.default.constructFormData({session_token:this.data.session_token,game_token:this.data.challengeID})});return this.key=JSON.parse(G.body.toString()).decryption_key,this.key}get gameType(){return this.data.game_data.gameType}get variant(){return this.data.game_data.game_variant||this.data.game_data.instruction_string}get instruction(){return this.data.string_table[`${this.data.game_data.gameType}.instructions-${this.variant}`]||this.data.string_table[`${this.data.game_data.gameType}.touch_done_info${this.data.game_data.game_variant?`_${this.data.game_data.game_variant}`:""}`]}get waves(){return this.data.game_data.waves}};tZ.Challenge=Zn;var aR=class extends Zn{constructor(G,l){super(G,l),this.answerHistory=[];let b=G.game_data.customGUI._guiFontColr;this.increment=parseInt(b?b.replace("#","").substring(3):"28",16),this.increment=this.increment>113?this.increment/10:this.increment}round(G){return(Math.round(G*10)/10).toFixed(2)}async answer(G){G>=0&&G<=Math.round(360/51.4)-1?this.answerHistory.push(this.round(G*this.increment)):this.answerHistory.push(this.round(G));let l=await dn.default.encrypt(this.answerHistory.toString(),this.data.session_token),b=await(0,MY.default)(this.data.tokenInfo.surl,{method:"POST",path:"/fc/ca/",headers:{"User-Agent":this.userAgent,"Content-Type":"application/x-www-form-urlencoded",Referer:this.data.challengeURL},body:kZ.default.constructFormData({session_token:this.data.session_token,game_token:this.data.challengeID,guess:l})}),d=JSON.parse(b.body.toString());return this.key=d.decryption_key||"",this.wave++,d}};tZ.Challenge1=aR;var WR=class extends Zn{constructor(G,l){super(G,l),this.answerHistory=[]}async answer(G){o0(G>=0&&G<=5,"Tile must be between 0 and 5");let l=kZ.default.tileToLoc(G);this.answerHistory.push(kZ.default.solveBreaker(!!this.data.game_data.customGUI.is_using_api_breaker_v2,this.data.game_data.customGUI.api_breaker,3,l));let b=await dn.default.encrypt(JSON.stringify(this.answerHistory),this.data.session_token),d=await dn.default.encrypt(JSON.stringify({}),`REQUESTED${this.data.session_token}ID`),{cookie:e,value:t}=kZ.default.getTimestamp(),W=await(0,MY.default)(this.data.tokenInfo.surl,{method:"POST",path:"/fc/ca/",headers:{"User-Agent":this.userAgent,"Content-Type":"application/x-www-form-urlencoded","X-Newrelic-Timestamp":t,"X-Requested-ID":d,Cookie:e,Referer:this.data.challengeURL},body:kZ.default.constructFormData({session_token:this.data.session_token,game_token:this.data.challengeID,guess:b,analytics_tier:this.data.tokenInfo.at,sid:this.data.tokenInfo.r,bio:this.data.tokenInfo.mbio&&"eyJtYmlvIjoiMTI1MCwwLDE0NywyMDQ7MTg5NCwwLDE1MSwyMDA7MTk2MCwxLDE1MiwxOTk7MjAyOSwyLDE1MiwxOTk7MjU3NSwwLDE1NSwxOTU7MjU4NSwwLDE1NiwxOTA7MjU5NSwwLDE1OCwxODU7MjYwNCwwLDE1OSwxODA7MjYxMywwLDE2MCwxNzU7MjYyMSwwLDE2MSwxNzA7MjYzMCwwLDE2MywxNjU7MjY0MCwwLDE2NCwxNjA7MjY1MCwwLDE2NSwxNTU7MjY2NCwwLDE2NiwxNTA7MjY3NywwLDE2NiwxNDQ7MjY5NCwwLDE2NywxMzk7MjcyMCwwLDE2NywxMzM7Mjc1NCwwLDE2NywxMjc7Mjc4MywwLDE2NywxMjE7MjgxMiwwLDE2NywxMTU7Mjg0MywwLDE2NywxMDk7Mjg2MywwLDE2NywxMDM7Mjg3NSwwLDE2Niw5ODsyOTA1LDAsMTY1LDkzOzMyMzIsMCwxNjUsOTk7MzI2MiwwLDE2NSwxMDU7MzI5OSwwLDE2NCwxMTA7MzM0MCwwLDE2MSwxMTU7MzM3MiwwLDE1NywxMjA7MzM5NSwwLDE1MywxMjQ7MzQwOCwwLDE0OCwxMjc7MzQyMCwwLDE0MywxMzA7MzQyOSwwLDEzOCwxMzE7MzQ0MSwwLDEzMywxMzQ7MzQ1MCwwLDEyOCwxMzU7MzQ2MSwwLDEyMywxMzg7MzQ3NiwwLDExOCwxNDA7MzQ4OSwwLDExMywxNDI7MzUwMywwLDEwOCwxNDM7MzUxOCwwLDEwMywxNDQ7MzUzNCwwLDk4LDE0NTszNTU2LDAsOTMsMTQ2OzM2MTUsMCw4OCwxNDg7MzY2MiwwLDgzLDE1MTszNjgzLDAsNzgsMTU0OzM3MDEsMCw3MywxNTc7MzcyNSwwLDY5LDE2MTszNzkzLDEsNjgsMTYyOzM4NTEsMiw2OCwxNjI7IiwidGJpbyI6IiIsImtiaW8iOiIifQ=="})}),n=JSON.parse(W.body.toString());return this.key=n.decryption_key||"",this.wave++,n}};tZ.Challenge3=WR;var tR=class extends Zn{constructor(G,l){super(G,l),this.answerHistory=[]}async answer(G){o0(G>=0&&G<=this.data.game_data.game_difficulty-1,"Index must be between 0 and "+(this.data.game_data.game_difficulty-1)),this.answerHistory.push(kZ.default.solveBreaker(!!this.data.game_data.customGUI.is_using_api_breaker_v2,this.data.game_data.customGUI.api_breaker,4,{index:G}));let l=await dn.default.encrypt(JSON.stringify(this.answerHistory),this.data.session_token),b=await dn.default.encrypt(JSON.stringify({}),`REQUESTED${this.data.session_token}ID`),{cookie:d,value:e}=kZ.default.getTimestamp(),t=await(0,MY.default)(this.data.tokenInfo.surl,{method:"POST",path:"/fc/ca/",headers:{"User-Agent":this.userAgent,"Content-Type":"application/x-www-form-urlencoded","X-Newrelic-Timestamp":e,"X-Requested-ID":b,Cookie:d,Referer:this.data.challengeURL},body:kZ.default.constructFormData({session_token:this.data.session_token,game_token:this.data.challengeID,guess:l,analytics_tier:this.data.tokenInfo.at,sid:this.data.tokenInfo.r,bio:this.data.tokenInfo.mbio&&"eyJtYmlvIjoiMTI1MCwwLDE0NywyMDQ7MTg5NCwwLDE1MSwyMDA7MTk2MCwxLDE1MiwxOTk7MjAyOSwyLDE1MiwxOTk7MjU3NSwwLDE1NSwxOTU7MjU4NSwwLDE1NiwxOTA7MjU5NSwwLDE1OCwxODU7MjYwNCwwLDE1OSwxODA7MjYxMywwLDE2MCwxNzU7MjYyMSwwLDE2MSwxNzA7MjYzMCwwLDE2MywxNjU7MjY0MCwwLDE2NCwxNjA7MjY1MCwwLDE2NSwxNTU7MjY2NCwwLDE2NiwxNTA7MjY3NywwLDE2NiwxNDQ7MjY5NCwwLDE2NywxMzk7MjcyMCwwLDE2NywxMzM7Mjc1NCwwLDE2NywxMjc7Mjc4MywwLDE2NywxMjE7MjgxMiwwLDE2NywxMTU7Mjg0MywwLDE2NywxMDk7Mjg2MywwLDE2NywxMDM7Mjg3NSwwLDE2Niw5ODsyOTA1LDAsMTY1LDkzOzMyMzIsMCwxNjUsOTk7MzI2MiwwLDE2NSwxMDU7MzI5OSwwLDE2NCwxMTA7MzM0MCwwLDE2MSwxMTU7MzM3MiwwLDE1NywxMjA7MzM5NSwwLDE1MywxMjQ7MzQwOCwwLDE0OCwxMjc7MzQyMCwwLDE0MywxMzA7MzQyOSwwLDEzOCwxMzE7MzQ0MSwwLDEzMywxMzQ7MzQ1MCwwLDEyOCwxMzU7MzQ2MSwwLDEyMywxMzg7MzQ3NiwwLDExOCwxNDA7MzQ4OSwwLDExMywxNDI7MzUwMywwLDEwOCwxNDM7MzUxOCwwLDEwMywxNDQ7MzUzNCwwLDk4LDE0NTszNTU2LDAsOTMsMTQ2OzM2MTUsMCw4OCwxNDg7MzY2MiwwLDgzLDE1MTszNjgzLDAsNzgsMTU0OzM3MDEsMCw3MywxNTc7MzcyNSwwLDY5LDE2MTszNzkzLDEsNjgsMTYyOzM4NTEsMiw2OCwxNjI7IiwidGJpbyI6IiIsImtiaW8iOiIifQ=="})}),W=JSON.parse(t.body.toString());return this.key=W.decryption_key||"",this.wave++,W}get difficulty(){return this.data.game_data.game_difficulty}};tZ.Challenge4=tR;function o0(I,G){I||console.log(G)}});var X0=vc(Np=>{"use strict";Object.defineProperty(Np,"__esModule",{value:!0});Np.Session=void 0;var nR=F0(),zg=eR(),mR=tp(),Ug=I=>Object.fromEntries(I.split("|").map(G=>G.split("=").map(l=>decodeURIComponent(l)))),NR=class{constructor(G,l){var b;typeof G=="string"?this.token=G:this.token=G.token,this.token.startsWith("token=")||(this.token="token="+this.token),this.tokenInfo=Ug(this.token),this.tokenInfo.mbio=typeof G!="string"&&(b=G.mbio)!==null&&b!==void 0?b:!1,this.userAgent=l?.userAgent||mR.default.DEFAULT_USER_AGENT,this.proxy=l?.proxy}async getChallenge(){let G=await(0,zg.default)(this.tokenInfo.surl,{path:"/fc/gfct/",method:"POST",body:mR.default.constructFormData({sid:this.tokenInfo.r,render_type:"canvas",token:this.tokenInfo.token,analytics_tier:this.tokenInfo.at,"data%5Bstatus%5D":"init",lang:"en",apiBreakerVersion:"green"}),headers:{"User-Agent":this.userAgent,"Content-Type":"application/x-www-form-urlencoded","Accept-Language":"en-US,en;q=0.9","Sec-Fetch-Site":"same-origin",Referer:this.getEmbedUrl()}}),l=JSON.parse(G.body.toString());if(l.token=this.token,l.tokenInfo=this.tokenInfo,l.game_data.gameType==1)return new nR.Challenge1(l,{userAgent:this.userAgent});if(l.game_data.gameType==3)return new nR.Challenge3(l,{userAgent:this.userAgent});if(l.game_data.gameType==4)return new nR.Challenge4(l,{userAgent:this.userAgent});throw new Error("Unsupported game type: "+l.game_data.gameType)}getEmbedUrl(){return`${this.tokenInfo.surl}/fc/gc/?${mR.default.constructFormData(this.tokenInfo)}`}};Np.Session=NR});var Q0=vc(ie=>{"use strict";var Mg=ie&&ie.__createBinding||(Object.create?function(I,G,l,b){b===void 0&&(b=l);var d=Object.getOwnPropertyDescriptor(G,l);(!d||("get"in d?!G.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return G[l]}}),Object.defineProperty(I,b,d)}:function(I,G,l,b){b===void 0&&(b=l),I[b]=G[l]}),i0=ie&&ie.__exportStar||function(I,G){for(var l in I)l!=="default"&&!Object.prototype.hasOwnProperty.call(G,l)&&Mg(G,I,l)};Object.defineProperty(ie,"__esModule",{value:!0});i0(R0(),ie);i0(X0(),ie)});var DQ=vc(Op=>{"use strict";Op.byteLength=TC;Op.toByteArray=SC;Op.fromByteArray=_C;var NZ=[],rd=[],KC=typeof Uint8Array<"u"?Uint8Array:Array,PR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(xa=0,fQ=PR.length;xa<fQ;++xa)NZ[xa]=PR[xa],rd[PR.charCodeAt(xa)]=xa;var xa,fQ;rd[45]=62;rd[95]=63;function SQ(I){var G=I.length;if(G%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var l=I.indexOf("=");l===-1&&(l=G);var b=l===G?0:4-l%4;return[l,b]}function TC(I){var G=SQ(I),l=G[0],b=G[1];return(l+b)*3/4-b}function fC(I,G,l){return(G+l)*3/4-l}function SC(I){var G,l=SQ(I),b=l[0],d=l[1],e=new KC(fC(I,b,d)),t=0,W=d>0?b-4:b,n;for(n=0;n<W;n+=4)G=rd[I.charCodeAt(n)]<<18|rd[I.charCodeAt(n+1)]<<12|rd[I.charCodeAt(n+2)]<<6|rd[I.charCodeAt(n+3)],e[t++]=G>>16&255,e[t++]=G>>8&255,e[t++]=G&255;return d===2&&(G=rd[I.charCodeAt(n)]<<2|rd[I.charCodeAt(n+1)]>>4,e[t++]=G&255),d===1&&(G=rd[I.charCodeAt(n)]<<10|rd[I.charCodeAt(n+1)]<<4|rd[I.charCodeAt(n+2)]>>2,e[t++]=G>>8&255,e[t++]=G&255),e}function DC(I){return NZ[I>>18&63]+NZ[I>>12&63]+NZ[I>>6&63]+NZ[I&63]}function qC(I,G,l){for(var b,d=[],e=G;e<l;e+=3)b=(I[e]<<16&16711680)+(I[e+1]<<8&65280)+(I[e+2]&255),d.push(DC(b));return d.join("")}function _C(I){for(var G,l=I.length,b=l%3,d=[],e=16383,t=0,W=l-b;t<W;t+=e)d.push(qC(I,t,t+e>W?W:t+e));return b===1?(G=I[l-1],d.push(NZ[G>>2]+NZ[G<<4&63]+"==")):b===2&&(G=(I[l-2]<<8)+I[l-1],d.push(NZ[G>>10]+NZ[G>>4&63]+NZ[G<<2&63]+"=")),d.join("")}});var bo=vc((_cI,hH)=>{hH.exports=function(G){return G!=null&&G.constructor!=null&&typeof G.constructor.isBuffer=="function"&&G.constructor.isBuffer(G)}});var yH=vc((ubI,EH)=>{"use strict";var fp=Object.prototype.hasOwnProperty,vH=Object.prototype.toString,XH=Object.defineProperty,iH=Object.getOwnPropertyDescriptor,QH=function(G){return typeof Array.isArray=="function"?Array.isArray(G):vH.call(G)==="[object Array]"},HH=function(G){if(!G||vH.call(G)!=="[object Object]")return!1;var l=fp.call(G,"constructor"),b=G.constructor&&G.constructor.prototype&&fp.call(G.constructor.prototype,"isPrototypeOf");if(G.constructor&&!l&&!b)return!1;var d;for(d in G);return typeof d>"u"||fp.call(G,d)},rH=function(G,l){XH&&l.name==="__proto__"?XH(G,l.name,{enumerable:!0,configurable:!0,value:l.newValue,writable:!0}):G[l.name]=l.newValue},wH=function(G,l){if(l==="__proto__")if(fp.call(G,l)){if(iH)return iH(G,l).value}else return;return G[l]};EH.exports=function I(){var G,l,b,d,e,t,W=arguments[0],n=1,s=arguments.length,N=!1;for(typeof W=="boolean"&&(N=W,W=arguments[1]||{},n=2),(W==null||typeof W!="object"&&typeof W!="function")&&(W={});n<s;++n)if(G=arguments[n],G!=null)for(l in G)b=wH(W,l),d=wH(G,l),W!==d&&(N&&d&&(HH(d)||(e=QH(d)))?(e?(e=!1,t=b&&QH(b)?b:[]):t=b&&HH(b)?b:{},rH(W,{name:l,newValue:I(N,t,d)})):typeof d<"u"&&rH(W,{name:l,newValue:d}));return W}});var _r=vc((kWI,qr)=>{"use strict";var aL="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";qr.exports=aL});var lw=vc((xWI,Iw)=>{"use strict";var WL=_r();function Pr(){}function $r(){}$r.resetWarningCache=Pr;Iw.exports=function(){function I(b,d,e,t,W,n){if(n!==WL){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}I.isRequired=I;function G(){return I}var l={array:I,bigint:I,bool:I,func:I,number:I,object:I,string:I,symbol:I,any:I,arrayOf:G,element:I,elementType:I,instanceOf:G,node:I,objectOf:G,oneOf:G,oneOfType:G,shape:G,exact:G,checkPropTypes:$r,resetWarningCache:Pr};return l.PropTypes=l,l}});var cw=vc((MWI,Gw)=>{Gw.exports=lw()();var zWI,UWI});var nw=vc(Ic=>{"use strict";var So=Symbol.for("react.element"),Do=Symbol.for("react.portal"),Yu=Symbol.for("react.fragment"),hu=Symbol.for("react.strict_mode"),Vu=Symbol.for("react.profiler"),pu=Symbol.for("react.provider"),uu=Symbol.for("react.context"),hL=Symbol.for("react.server_context"),Ru=Symbol.for("react.forward_ref"),ou=Symbol.for("react.suspense"),Fu=Symbol.for("react.suspense_list"),Xu=Symbol.for("react.memo"),iu=Symbol.for("react.lazy"),VL=Symbol.for("react.offscreen"),tw;tw=Symbol.for("react.module.reference");function Ed(I){if(typeof I=="object"&&I!==null){var G=I.$$typeof;switch(G){case So:switch(I=I.type,I){case Yu:case Vu:case hu:case ou:case Fu:return I;default:switch(I=I&&I.$$typeof,I){case hL:case uu:case Ru:case iu:case Xu:case pu:return I;default:return G}}case Do:return G}}}Ic.ContextConsumer=uu;Ic.ContextProvider=pu;Ic.Element=So;Ic.ForwardRef=Ru;Ic.Fragment=Yu;Ic.Lazy=iu;Ic.Memo=Xu;Ic.Portal=Do;Ic.Profiler=Vu;Ic.StrictMode=hu;Ic.Suspense=ou;Ic.SuspenseList=Fu;Ic.isAsyncMode=function(){return!1};Ic.isConcurrentMode=function(){return!1};Ic.isContextConsumer=function(I){return Ed(I)===uu};Ic.isContextProvider=function(I){return Ed(I)===pu};Ic.isElement=function(I){return typeof I=="object"&&I!==null&&I.$$typeof===So};Ic.isForwardRef=function(I){return Ed(I)===Ru};Ic.isFragment=function(I){return Ed(I)===Yu};Ic.isLazy=function(I){return Ed(I)===iu};Ic.isMemo=function(I){return Ed(I)===Xu};Ic.isPortal=function(I){return Ed(I)===Do};Ic.isProfiler=function(I){return Ed(I)===Vu};Ic.isStrictMode=function(I){return Ed(I)===hu};Ic.isSuspense=function(I){return Ed(I)===ou};Ic.isSuspenseList=function(I){return Ed(I)===Fu};Ic.isValidElementType=function(I){return typeof I=="string"||typeof I=="function"||I===Yu||I===Vu||I===hu||I===ou||I===Fu||I===VL||typeof I=="object"&&I!==null&&(I.$$typeof===iu||I.$$typeof===Xu||I.$$typeof===pu||I.$$typeof===uu||I.$$typeof===Ru||I.$$typeof===tw||I.getModuleId!==void 0)};Ic.typeOf=Ed});var Nw=vc((xtI,mw)=>{"use strict";mw.exports=nw()});var Fw=vc((BtI,ow)=>{var Vw=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,pL=/\n/g,uL=/^\s*/,RL=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,oL=/^:\s*/,FL=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,XL=/^[;\s]*/,iL=/^\s+|\s+$/g,QL=`
`,pw="/",uw="*",fa="",HL="comment",rL="declaration";ow.exports=function(I,G){if(typeof I!="string")throw new TypeError("First argument must be a string");if(!I)return[];G=G||{};var l=1,b=1;function d(p){var F=p.match(pL);F&&(l+=F.length);var a=p.lastIndexOf(QL);b=~a?p.length-a:b+p.length}function e(){var p={line:l,column:b};return function(F){return F.position=new t(p),N(),F}}function t(p){this.start=p,this.end={line:l,column:b},this.source=G.source}t.prototype.content=I;var W=[];function n(p){var F=new Error(G.source+":"+l+":"+b+": "+p);if(F.reason=p,F.filename=G.source,F.line=l,F.column=b,F.source=I,G.silent)W.push(F);else throw F}function s(p){var F=p.exec(I);if(F){var a=F[0];return d(a),I=I.slice(a.length),F}}function N(){s(uL)}function m(p){var F;for(p=p||[];F=h();)F!==!1&&p.push(F);return p}function h(){var p=e();if(!(pw!=I.charAt(0)||uw!=I.charAt(1))){for(var F=2;fa!=I.charAt(F)&&(uw!=I.charAt(F)||pw!=I.charAt(F+1));)++F;if(F+=2,fa===I.charAt(F-1))return n("End of comment missing");var a=I.slice(2,F-2);return b+=2,d(a),I=I.slice(F),b+=2,p({type:HL,comment:a})}}function V(){var p=e(),F=s(RL);if(F){if(h(),!s(oL))return n("property missing ':'");var a=s(FL),u=p({type:rL,property:Rw(F[0].replace(Vw,fa)),value:a?Rw(a[0].replace(Vw,fa)):fa});return s(XL),u}}function X(){var p=[];m(p);for(var F;F=V();)F!==!1&&(p.push(F),m(p));return p}return N(),X()};function Rw(I){return I?I.replace(iL,fa):fa}});var iw=vc((OtI,qo)=>{var wL=Fw();function Xw(I,G){var l=null;if(!I||typeof I!="string")return l;for(var b,d=wL(I),e=typeof G=="function",t,W,n=0,s=d.length;n<s;n++)b=d[n],t=b.property,W=b.value,e?G(t,W,b):W&&(l||(l={}),l[t]=W);return l}qo.exports=Xw;qo.exports.default=Xw});var $v=vc((KnI,Pv)=>{function Uv(I){return I instanceof Map?I.clear=I.delete=I.set=function(){throw new Error("map is read-only")}:I instanceof Set&&(I.add=I.clear=I.delete=function(){throw new Error("set is read-only")}),Object.freeze(I),Object.getOwnPropertyNames(I).forEach(G=>{let l=I[G],b=typeof l;(b==="object"||b==="function")&&!Object.isFrozen(l)&&Uv(l)}),I}var Lu=class{constructor(G){G.data===void 0&&(G.data={}),this.data=G.data,this.isMatchIgnored=!1}ignoreMatch(){this.isMatchIgnored=!0}};function Mv(I){return I.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}function xe(I,...G){let l=Object.create(null);for(let b in I)l[b]=I[b];return G.forEach(function(b){for(let d in b)l[d]=b[d]}),l}var s4="</span>",Cv=I=>!!I.scope,Y4=(I,{prefix:G})=>{if(I.startsWith("language:"))return I.replace("language:","language-");if(I.includes(".")){let l=I.split(".");return[`${G}${l.shift()}`,...l.map((b,d)=>`${b}${"_".repeat(d+1)}`)].join(" ")}return`${G}${I}`},dF=class{constructor(G,l){this.buffer="",this.classPrefix=l.classPrefix,G.walk(this)}addText(G){this.buffer+=Mv(G)}openNode(G){if(!Cv(G))return;let l=Y4(G.scope,{prefix:this.classPrefix});this.span(l)}closeNode(G){Cv(G)&&(this.buffer+=s4)}value(){return this.buffer}span(G){this.buffer+=`<span class="${G}">`}},Av=(I={})=>{let G={children:[]};return Object.assign(G,I),G},ZF=class I{constructor(){this.rootNode=Av(),this.stack=[this.rootNode]}get top(){return this.stack[this.stack.length-1]}get root(){return this.rootNode}add(G){this.top.children.push(G)}openNode(G){let l=Av({scope:G});this.add(l),this.stack.push(l)}closeNode(){if(this.stack.length>1)return this.stack.pop()}closeAllNodes(){for(;this.closeNode(););}toJSON(){return JSON.stringify(this.rootNode,null,4)}walk(G){return this.constructor._walk(G,this.rootNode)}static _walk(G,l){return typeof l=="string"?G.addText(l):l.children&&(G.openNode(l),l.children.forEach(b=>this._walk(G,b)),G.closeNode(l)),G}static _collapse(G){typeof G!="string"&&G.children&&(G.children.every(l=>typeof l=="string")?G.children=[G.children.join("")]:G.children.forEach(l=>{I._collapse(l)}))}},eF=class extends ZF{constructor(G){super(),this.options=G}addText(G){G!==""&&this.add(G)}startScope(G){this.openNode(G)}endScope(){this.closeNode()}__addSublanguage(G,l){let b=G.root;l&&(b.scope=`language:${l}`),this.add(b)}toHTML(){return new dF(this,this.options).value()}finalize(){return this.closeAllNodes(),!0}};function sh(I){return I?typeof I=="string"?I:I.source:null}function Bv(I){return Da("(?=",I,")")}function h4(I){return Da("(?:",I,")*")}function V4(I){return Da("(?:",I,")?")}function Da(...I){return I.map(l=>sh(l)).join("")}function p4(I){let G=I[I.length-1];return typeof G=="object"&&G.constructor===Object?(I.splice(I.length-1,1),G):{}}function WF(...I){return"("+(p4(I).capture?"":"?:")+I.map(b=>sh(b)).join("|")+")"}function Ov(I){return new RegExp(I.toString()+"|").exec("").length-1}function u4(I,G){let l=I&&I.exec(G);return l&&l.index===0}var R4=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./;function tF(I,{joinWith:G}){let l=0;return I.map(b=>{l+=1;let d=l,e=sh(b),t="";for(;e.length>0;){let W=R4.exec(e);if(!W){t+=e;break}t+=e.substring(0,W.index),e=e.substring(W.index+W[0].length),W[0][0]==="\\"&&W[1]?t+="\\"+String(Number(W[1])+d):(t+=W[0],W[0]==="("&&l++)}return t}).map(b=>`(${b})`).join(G)}var o4=/\b\B/,jv="[a-zA-Z]\\w*",nF="[a-zA-Z_]\\w*",Kv="\\b\\d+(\\.\\d+)?",Tv="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",fv="\\b(0b[01]+)",F4="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",X4=(I={})=>{let G=/^#![ ]*\//;return I.binary&&(I.begin=Da(G,/.*\b/,I.binary,/\b.*/)),xe({scope:"meta",begin:G,end:/$/,relevance:0,"on:begin":(l,b)=>{l.index!==0&&b.ignoreMatch()}},I)},Yh={begin:"\\\\[\\s\\S]",relevance:0},i4={scope:"string",begin:"'",end:"'",illegal:"\\n",contains:[Yh]},Q4={scope:"string",begin:'"',end:'"',illegal:"\\n",contains:[Yh]},H4={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},xu=function(I,G,l={}){let b=xe({scope:"comment",begin:I,end:G,contains:[]},l);b.contains.push({scope:"doctag",begin:"[ ]*(?=(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):)",end:/(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):/,excludeBegin:!0,relevance:0});let d=WF("I","a","is","so","us","to","at","if","in","it","on",/[A-Za-z]+['](d|ve|re|ll|t|s|n)/,/[A-Za-z]+[-][a-z]+/,/[A-Za-z][a-z]{2,}/);return b.contains.push({begin:Da(/[ ]+/,"(",d,/[.]?[:]?([.][ ]|[ ])/,"){3}")}),b},r4=xu("//","$"),w4=xu("/\\*","\\*/"),v4=xu("#","$"),E4={scope:"number",begin:Kv,relevance:0},y4={scope:"number",begin:Tv,relevance:0},g4={scope:"number",begin:fv,relevance:0},J4={begin:/(?=\/[^/\n]*\/)/,contains:[{scope:"regexp",begin:/\//,end:/\/[gimuy]*/,illegal:/\n/,contains:[Yh,{begin:/\[/,end:/\]/,relevance:0,contains:[Yh]}]}]},C4={scope:"title",begin:jv,relevance:0},A4={scope:"title",begin:nF,relevance:0},L4={begin:"\\.\\s*"+nF,relevance:0},k4=function(I){return Object.assign(I,{"on:begin":(G,l)=>{l.data._beginMatch=G[1]},"on:end":(G,l)=>{l.data._beginMatch!==G[1]&&l.ignoreMatch()}})},Au=Object.freeze({__proto__:null,MATCH_NOTHING_RE:o4,IDENT_RE:jv,UNDERSCORE_IDENT_RE:nF,NUMBER_RE:Kv,C_NUMBER_RE:Tv,BINARY_NUMBER_RE:fv,RE_STARTERS_RE:F4,SHEBANG:X4,BACKSLASH_ESCAPE:Yh,APOS_STRING_MODE:i4,QUOTE_STRING_MODE:Q4,PHRASAL_WORDS_MODE:H4,COMMENT:xu,C_LINE_COMMENT_MODE:r4,C_BLOCK_COMMENT_MODE:w4,HASH_COMMENT_MODE:v4,NUMBER_MODE:E4,C_NUMBER_MODE:y4,BINARY_NUMBER_MODE:g4,REGEXP_MODE:J4,TITLE_MODE:C4,UNDERSCORE_TITLE_MODE:A4,METHOD_GUARD:L4,END_SAME_AS_BEGIN:k4});function x4(I,G){I.input[I.index-1]==="."&&G.ignoreMatch()}function z4(I,G){I.className!==void 0&&(I.scope=I.className,delete I.className)}function U4(I,G){G&&I.beginKeywords&&(I.begin="\\b("+I.beginKeywords.split(" ").join("|")+")(?!\\.)(?=\\b|\\s)",I.__beforeBegin=x4,I.keywords=I.keywords||I.beginKeywords,delete I.beginKeywords,I.relevance===void 0&&(I.relevance=0))}function M4(I,G){Array.isArray(I.illegal)&&(I.illegal=WF(...I.illegal))}function B4(I,G){if(I.match){if(I.begin||I.end)throw new Error("begin & end are not supported with match");I.begin=I.match,delete I.match}}function O4(I,G){I.relevance===void 0&&(I.relevance=1)}var j4=(I,G)=>{if(!I.beforeMatch)return;if(I.starts)throw new Error("beforeMatch cannot be used with starts");let l=Object.assign({},I);Object.keys(I).forEach(b=>{delete I[b]}),I.keywords=l.keywords,I.begin=Da(l.beforeMatch,Bv(l.begin)),I.starts={relevance:0,contains:[Object.assign(l,{endsParent:!0})]},I.relevance=0,delete l.beforeMatch},K4=["of","and","for","in","not","or","if","then","parent","list","value"],T4="keyword";function Sv(I,G,l=T4){let b=Object.create(null);return typeof I=="string"?d(l,I.split(" ")):Array.isArray(I)?d(l,I):Object.keys(I).forEach(function(e){Object.assign(b,Sv(I[e],G,e))}),b;function d(e,t){G&&(t=t.map(W=>W.toLowerCase())),t.forEach(function(W){let n=W.split("|");b[n[0]]=[e,f4(n[0],n[1])]})}}function f4(I,G){return G?Number(G):S4(I)?0:1}function S4(I){return K4.includes(I.toLowerCase())}var Lv={},Sa=I=>{console.error(I)},kv=(I,...G)=>{console.log(`WARN: ${I}`,...G)},jn=(I,G)=>{Lv[`${I}/${G}`]||(console.log(`Deprecated as of ${I}. ${G}`),Lv[`${I}/${G}`]=!0)},ku=new Error;function Dv(I,G,{key:l}){let b=0,d=I[l],e={},t={};for(let W=1;W<=G.length;W++)t[W+b]=d[W],e[W+b]=!0,b+=Ov(G[W-1]);I[l]=t,I[l]._emit=e,I[l]._multi=!0}function D4(I){if(Array.isArray(I.begin)){if(I.skip||I.excludeBegin||I.returnBegin)throw Sa("skip, excludeBegin, returnBegin not compatible with beginScope: {}"),ku;if(typeof I.beginScope!="object"||I.beginScope===null)throw Sa("beginScope must be object"),ku;Dv(I,I.begin,{key:"beginScope"}),I.begin=tF(I.begin,{joinWith:""})}}function q4(I){if(Array.isArray(I.end)){if(I.skip||I.excludeEnd||I.returnEnd)throw Sa("skip, excludeEnd, returnEnd not compatible with endScope: {}"),ku;if(typeof I.endScope!="object"||I.endScope===null)throw Sa("endScope must be object"),ku;Dv(I,I.end,{key:"endScope"}),I.end=tF(I.end,{joinWith:""})}}function _4(I){I.scope&&typeof I.scope=="object"&&I.scope!==null&&(I.beginScope=I.scope,delete I.scope)}function P4(I){_4(I),typeof I.beginScope=="string"&&(I.beginScope={_wrap:I.beginScope}),typeof I.endScope=="string"&&(I.endScope={_wrap:I.endScope}),D4(I),q4(I)}function $4(I){function G(t,W){return new RegExp(sh(t),"m"+(I.case_insensitive?"i":"")+(I.unicodeRegex?"u":"")+(W?"g":""))}class l{constructor(){this.matchIndexes={},this.regexes=[],this.matchAt=1,this.position=0}addRule(W,n){n.position=this.position++,this.matchIndexes[this.matchAt]=n,this.regexes.push([n,W]),this.matchAt+=Ov(W)+1}compile(){this.regexes.length===0&&(this.exec=()=>null);let W=this.regexes.map(n=>n[1]);this.matcherRe=G(tF(W,{joinWith:"|"}),!0),this.lastIndex=0}exec(W){this.matcherRe.lastIndex=this.lastIndex;let n=this.matcherRe.exec(W);if(!n)return null;let s=n.findIndex((m,h)=>h>0&&m!==void 0),N=this.matchIndexes[s];return n.splice(0,s),Object.assign(n,N)}}class b{constructor(){this.rules=[],this.multiRegexes=[],this.count=0,this.lastIndex=0,this.regexIndex=0}getMatcher(W){if(this.multiRegexes[W])return this.multiRegexes[W];let n=new l;return this.rules.slice(W).forEach(([s,N])=>n.addRule(s,N)),n.compile(),this.multiRegexes[W]=n,n}resumingScanAtSamePosition(){return this.regexIndex!==0}considerAll(){this.regexIndex=0}addRule(W,n){this.rules.push([W,n]),n.type==="begin"&&this.count++}exec(W){let n=this.getMatcher(this.regexIndex);n.lastIndex=this.lastIndex;let s=n.exec(W);if(this.resumingScanAtSamePosition()&&!(s&&s.index===this.lastIndex)){let N=this.getMatcher(0);N.lastIndex=this.lastIndex+1,s=N.exec(W)}return s&&(this.regexIndex+=s.position+1,this.regexIndex===this.count&&this.considerAll()),s}}function d(t){let W=new b;return t.contains.forEach(n=>W.addRule(n.begin,{rule:n,type:"begin"})),t.terminatorEnd&&W.addRule(t.terminatorEnd,{type:"end"}),t.illegal&&W.addRule(t.illegal,{type:"illegal"}),W}function e(t,W){let n=t;if(t.isCompiled)return n;[z4,B4,P4,j4].forEach(N=>N(t,W)),I.compilerExtensions.forEach(N=>N(t,W)),t.__beforeBegin=null,[U4,M4,O4].forEach(N=>N(t,W)),t.isCompiled=!0;let s=null;return typeof t.keywords=="object"&&t.keywords.$pattern&&(t.keywords=Object.assign({},t.keywords),s=t.keywords.$pattern,delete t.keywords.$pattern),s=s||/\w+/,t.keywords&&(t.keywords=Sv(t.keywords,I.case_insensitive)),n.keywordPatternRe=G(s,!0),W&&(t.begin||(t.begin=/\B|\b/),n.beginRe=G(n.begin),!t.end&&!t.endsWithParent&&(t.end=/\B|\b/),t.end&&(n.endRe=G(n.end)),n.terminatorEnd=sh(n.end)||"",t.endsWithParent&&W.terminatorEnd&&(n.terminatorEnd+=(t.end?"|":"")+W.terminatorEnd)),t.illegal&&(n.illegalRe=G(t.illegal)),t.contains||(t.contains=[]),t.contains=[].concat(...t.contains.map(function(N){return Ik(N==="self"?t:N)})),t.contains.forEach(function(N){e(N,n)}),t.starts&&e(t.starts,W),n.matcher=d(n),n}if(I.compilerExtensions||(I.compilerExtensions=[]),I.contains&&I.contains.includes("self"))throw new Error("ERR: contains `self` is not supported at the top-level of a language.  See documentation.");return I.classNameAliases=xe(I.classNameAliases||{}),e(I)}function qv(I){return I?I.endsWithParent||qv(I.starts):!1}function Ik(I){return I.variants&&!I.cachedVariants&&(I.cachedVariants=I.variants.map(function(G){return xe(I,{variants:null},G)})),I.cachedVariants?I.cachedVariants:qv(I)?xe(I,{starts:I.starts?xe(I.starts):null}):Object.isFrozen(I)?xe(I):I}var lk="11.8.0",aF=class extends Error{constructor(G,l){super(G),this.name="HTMLInjectionError",this.html=l}},bF=Mv,xv=xe,zv=Symbol("nomatch"),Gk=7,_v=function(I){let G=Object.create(null),l=Object.create(null),b=[],d=!0,e="Could not find the language '{}', did you forget to load/include a language module?",t={disableAutodetect:!0,name:"Plain text",contains:[]},W={ignoreUnescapedHTML:!1,throwUnescapedHTML:!1,noHighlightRe:/^(no-?highlight)$/i,languageDetectRe:/\blang(?:uage)?-([\w-]+)\b/i,classPrefix:"hljs-",cssSelector:"pre code",languages:null,__emitter:eF};function n(dI){return W.noHighlightRe.test(dI)}function s(dI){let pI=dI.className+" ";pI+=dI.parentNode?dI.parentNode.className:"";let yI=W.languageDetectRe.exec(pI);if(yI){let eI=T(yI[1]);return eI||(kv(e.replace("{}",yI[1])),kv("Falling back to no-highlight mode for this block.",dI)),eI?yI[1]:"no-highlight"}return pI.split(/\s+/).find(eI=>n(eI)||T(eI))}function N(dI,pI,yI){let eI="",HI="";typeof pI=="object"?(eI=dI,yI=pI.ignoreIllegals,HI=pI.language):(jn("10.7.0","highlight(lang, code, ...args) has been deprecated."),jn("10.7.0",`Please use highlight(code, options) instead.
https://github.com/highlightjs/highlight.js/issues/2277`),HI=dI,eI=pI),yI===void 0&&(yI=!0);let YI={code:eI,language:HI};sI("before:highlight",YI);let $=YI.result?YI.result:m(YI.language,YI.code,yI);return $.code=YI.code,sI("after:highlight",$),$}function m(dI,pI,yI,eI){let HI=Object.create(null);function YI(uI,wI){return uI.keywords[wI]}function $(){if(!tI.keywords){B.addText(aI);return}let uI=0;tI.keywordPatternRe.lastIndex=0;let wI=tI.keywordPatternRe.exec(aI),kI="";for(;wI;){kI+=aI.substring(uI,wI.index);let TI=K.case_insensitive?wI[0].toLowerCase():wI[0],Il=YI(tI,TI);if(Il){let[nl,ol]=Il;if(B.addText(kI),kI="",HI[TI]=(HI[TI]||0)+1,HI[TI]<=Gk&&(lI+=ol),nl.startsWith("_"))kI+=wI[0];else{let PI=K.classNameAliases[nl]||nl;zI(wI[0],PI)}}else kI+=wI[0];uI=tI.keywordPatternRe.lastIndex,wI=tI.keywordPatternRe.exec(aI)}kI+=aI.substring(uI),B.addText(kI)}function JI(){if(aI==="")return;let uI=null;if(typeof tI.subLanguage=="string"){if(!G[tI.subLanguage]){B.addText(aI);return}uI=m(tI.subLanguage,aI,!0,iI[tI.subLanguage]),iI[tI.subLanguage]=uI._top}else uI=V(aI,tI.subLanguage.length?tI.subLanguage:null);tI.relevance>0&&(lI+=uI.relevance),B.__addSublanguage(uI._emitter,uI.language)}function UI(){tI.subLanguage!=null?JI():$(),aI=""}function zI(uI,wI){uI!==""&&(B.startScope(wI),B.addText(uI),B.endScope())}function L(uI,wI){let kI=1,TI=wI.length-1;for(;kI<=TI;){if(!uI._emit[kI]){kI++;continue}let Il=K.classNameAliases[uI[kI]]||uI[kI],nl=wI[kI];Il?zI(nl,Il):(aI=nl,$(),aI=""),kI++}}function bI(uI,wI){return uI.scope&&typeof uI.scope=="string"&&B.openNode(K.classNameAliases[uI.scope]||uI.scope),uI.beginScope&&(uI.beginScope._wrap?(zI(aI,K.classNameAliases[uI.beginScope._wrap]||uI.beginScope._wrap),aI=""):uI.beginScope._multi&&(L(uI.beginScope,wI),aI="")),tI=Object.create(uI,{parent:{value:tI}}),tI}function FI(uI,wI,kI){let TI=u4(uI.endRe,kI);if(TI){if(uI["on:end"]){let Il=new Lu(uI);uI["on:end"](wI,Il),Il.isMatchIgnored&&(TI=!1)}if(TI){for(;uI.endsParent&&uI.parent;)uI=uI.parent;return uI}}if(uI.endsWithParent)return FI(uI.parent,wI,kI)}function U(uI){return tI.matcher.regexIndex===0?(aI+=uI[0],1):(OI=!0,0)}function k(uI){let wI=uI[0],kI=uI.rule,TI=new Lu(kI),Il=[kI.__beforeBegin,kI["on:begin"]];for(let nl of Il)if(nl&&(nl(uI,TI),TI.isMatchIgnored))return U(wI);return kI.skip?aI+=wI:(kI.excludeBegin&&(aI+=wI),UI(),!kI.returnBegin&&!kI.excludeBegin&&(aI=wI)),bI(kI,uI),kI.returnBegin?0:wI.length}function w(uI){let wI=uI[0],kI=pI.substring(uI.index),TI=FI(tI,uI,kI);if(!TI)return zv;let Il=tI;tI.endScope&&tI.endScope._wrap?(UI(),zI(wI,tI.endScope._wrap)):tI.endScope&&tI.endScope._multi?(UI(),L(tI.endScope,uI)):Il.skip?aI+=wI:(Il.returnEnd||Il.excludeEnd||(aI+=wI),UI(),Il.excludeEnd&&(aI=wI));do tI.scope&&B.closeNode(),!tI.skip&&!tI.subLanguage&&(lI+=tI.relevance),tI=tI.parent;while(tI!==TI.parent);return TI.starts&&bI(TI.starts,uI),Il.returnEnd?0:wI.length}function r(){let uI=[];for(let wI=tI;wI!==K;wI=wI.parent)wI.scope&&uI.unshift(wI.scope);uI.forEach(wI=>B.openNode(wI))}let A={};function O(uI,wI){let kI=wI&&wI[0];if(aI+=uI,kI==null)return UI(),0;if(A.type==="begin"&&wI.type==="end"&&A.index===wI.index&&kI===""){if(aI+=pI.slice(wI.index,wI.index+1),!d){let TI=new Error(`0 width match regex (${dI})`);throw TI.languageName=dI,TI.badRule=A.rule,TI}return 1}if(A=wI,wI.type==="begin")return k(wI);if(wI.type==="illegal"&&!yI){let TI=new Error('Illegal lexeme "'+kI+'" for mode "'+(tI.scope||"<unnamed>")+'"');throw TI.mode=tI,TI}else if(wI.type==="end"){let TI=w(wI);if(TI!==zv)return TI}if(wI.type==="illegal"&&kI==="")return 1;if(vI>1e5&&vI>wI.index*3)throw new Error("potential infinite loop, way more iterations than matches");return aI+=kI,kI.length}let K=T(dI);if(!K)throw Sa(e.replace("{}",dI)),new Error('Unknown language: "'+dI+'"');let q=$4(K),GI="",tI=eI||q,iI={},B=new W.__emitter(W);r();let aI="",lI=0,QI=0,vI=0,OI=!1;try{if(K.__emitTokens)K.__emitTokens(pI,B);else{for(tI.matcher.considerAll();;){vI++,OI?OI=!1:tI.matcher.considerAll(),tI.matcher.lastIndex=QI;let uI=tI.matcher.exec(pI);if(!uI)break;let wI=pI.substring(QI,uI.index),kI=O(wI,uI);QI=uI.index+kI}O(pI.substring(QI))}return B.finalize(),GI=B.toHTML(),{language:dI,value:GI,relevance:lI,illegal:!1,_emitter:B,_top:tI}}catch(uI){if(uI.message&&uI.message.includes("Illegal"))return{language:dI,value:bF(pI),illegal:!0,relevance:0,_illegalBy:{message:uI.message,index:QI,context:pI.slice(QI-100,QI+100),mode:uI.mode,resultSoFar:GI},_emitter:B};if(d)return{language:dI,value:bF(pI),illegal:!1,relevance:0,errorRaised:uI,_emitter:B,_top:tI};throw uI}}function h(dI){let pI={value:bF(dI),illegal:!1,relevance:0,_top:t,_emitter:new W.__emitter(W)};return pI._emitter.addText(dI),pI}function V(dI,pI){pI=pI||W.languages||Object.keys(G);let yI=h(dI),eI=pI.filter(T).filter(cI).map(UI=>m(UI,dI,!1));eI.unshift(yI);let HI=eI.sort((UI,zI)=>{if(UI.relevance!==zI.relevance)return zI.relevance-UI.relevance;if(UI.language&&zI.language){if(T(UI.language).supersetOf===zI.language)return 1;if(T(zI.language).supersetOf===UI.language)return-1}return 0}),[YI,$]=HI,JI=YI;return JI.secondBest=$,JI}function X(dI,pI,yI){let eI=pI&&l[pI]||yI;dI.classList.add("hljs"),dI.classList.add(`language-${eI}`)}function p(dI){let pI=null,yI=s(dI);if(n(yI))return;if(sI("before:highlightElement",{el:dI,language:yI}),dI.children.length>0&&(W.ignoreUnescapedHTML||(console.warn("One of your code blocks includes unescaped HTML. This is a potentially serious security risk."),console.warn("https://github.com/highlightjs/highlight.js/wiki/security"),console.warn("The element with unescaped HTML:"),console.warn(dI)),W.throwUnescapedHTML))throw new aF("One of your code blocks includes unescaped HTML.",dI.innerHTML);pI=dI;let eI=pI.textContent,HI=yI?N(eI,{language:yI,ignoreIllegals:!0}):V(eI);dI.innerHTML=HI.value,X(dI,yI,HI.language),dI.result={language:HI.language,re:HI.relevance,relevance:HI.relevance},HI.secondBest&&(dI.secondBest={language:HI.secondBest.language,relevance:HI.secondBest.relevance}),sI("after:highlightElement",{el:dI,result:HI,text:eI})}function F(dI){W=xv(W,dI)}let a=()=>{o(),jn("10.6.0","initHighlighting() deprecated.  Use highlightAll() now.")};function u(){o(),jn("10.6.0","initHighlightingOnLoad() deprecated.  Use highlightAll() now.")}let Q=!1;function o(){if(document.readyState==="loading"){Q=!0;return}document.querySelectorAll(W.cssSelector).forEach(p)}function y(){Q&&o()}typeof window<"u"&&window.addEventListener&&window.addEventListener("DOMContentLoaded",y,!1);function H(dI,pI){let yI=null;try{yI=pI(I)}catch(eI){if(Sa("Language definition for '{}' could not be registered.".replace("{}",dI)),d)Sa(eI);else throw eI;yI=t}yI.name||(yI.name=dI),G[dI]=yI,yI.rawDefinition=pI.bind(null,I),yI.aliases&&S(yI.aliases,{languageName:dI})}function E(dI){delete G[dI];for(let pI of Object.keys(l))l[pI]===dI&&delete l[pI]}function C(){return Object.keys(G)}function T(dI){return dI=(dI||"").toLowerCase(),G[dI]||G[l[dI]]}function S(dI,{languageName:pI}){typeof dI=="string"&&(dI=[dI]),dI.forEach(yI=>{l[yI.toLowerCase()]=pI})}function cI(dI){let pI=T(dI);return pI&&!pI.disableAutodetect}function hI(dI){dI["before:highlightBlock"]&&!dI["before:highlightElement"]&&(dI["before:highlightElement"]=pI=>{dI["before:highlightBlock"](Object.assign({block:pI.el},pI))}),dI["after:highlightBlock"]&&!dI["after:highlightElement"]&&(dI["after:highlightElement"]=pI=>{dI["after:highlightBlock"](Object.assign({block:pI.el},pI))})}function WI(dI){hI(dI),b.push(dI)}function VI(dI){let pI=b.indexOf(dI);pI!==-1&&b.splice(pI,1)}function sI(dI,pI){let yI=dI;b.forEach(function(eI){eI[yI]&&eI[yI](pI)})}function ZI(dI){return jn("10.7.0","highlightBlock will be removed entirely in v12.0"),jn("10.7.0","Please use highlightElement now."),p(dI)}Object.assign(I,{highlight:N,highlightAuto:V,highlightAll:o,highlightElement:p,highlightBlock:ZI,configure:F,initHighlighting:a,initHighlightingOnLoad:u,registerLanguage:H,unregisterLanguage:E,listLanguages:C,getLanguage:T,registerAliases:S,autoDetection:cI,inherit:xv,addPlugin:WI,removePlugin:VI}),I.debugMode=function(){d=!1},I.safeMode=function(){d=!0},I.versionString=lk,I.regex={concat:Da,lookahead:Bv,either:WF,optional:V4,anyNumberOfTimes:h4};for(let dI in Au)typeof Au[dI]=="object"&&Uv(Au[dI]);return Object.assign(I,Au),I},Kn=_v({});Kn.newInstance=()=>_v({});Pv.exports=Kn;Kn.HighlightJS=Kn;Kn.default=Kn});var lE=vc((fnI,mF)=>{(function(){var I;typeof mF<"u"?I=mF.exports=b:I=function(){return this||(0,eval)("this")}(),I.format=b,I.vsprintf=l,typeof console<"u"&&typeof console.log=="function"&&(I.printf=G);function G(){console.log(b.apply(null,arguments))}function l(d,e){return b.apply(null,[d].concat(e))}function b(d){for(var e=1,t=[].slice.call(arguments),W=0,n=d.length,s="",N,m=!1,h,V,X=!1,p,F=function(){return t[e++]},a=function(){for(var u="";/\d/.test(d[W]);)u+=d[W++],N=d[W];return u.length>0?parseInt(u):null};W<n;++W)if(N=d[W],m)switch(m=!1,N=="."?(X=!1,N=d[++W]):N=="0"&&d[W+1]=="."?(X=!0,W+=2,N=d[W]):X=!0,p=a(),N){case"b":s+=parseInt(F(),10).toString(2);break;case"c":h=F(),typeof h=="string"||h instanceof String?s+=h:s+=String.fromCharCode(parseInt(h,10));break;case"d":s+=parseInt(F(),10);break;case"f":V=String(parseFloat(F()).toFixed(p||6)),s+=X?V:V.replace(/^0/,"");break;case"j":s+=JSON.stringify(F());break;case"o":s+="0"+parseInt(F(),10).toString(8);break;case"s":s+=F();break;case"x":s+="0x"+parseInt(F(),10).toString(16);break;case"X":s+="0x"+parseInt(F(),10).toString(16).toUpperCase();break;default:s+=N;break}else N==="%"?m=!0:s+=N;return s}})()});var RF=vc((Ou,VE)=>{(function(I,G){typeof Ou=="object"&&typeof VE<"u"?G(Ou,IG()):typeof define=="function"&&define.amd?define(["exports","react"],G):(I=typeof globalThis<"u"?globalThis:I||self,G(I.ReactErrorBoundary={},I.React))})(Ou,function(I,G){"use strict";function l(m){if(m&&m.__esModule)return m;var h=Object.create(null);return m&&Object.keys(m).forEach(function(V){if(V!=="default"){var X=Object.getOwnPropertyDescriptor(m,V);Object.defineProperty(h,V,X.get?X:{enumerable:!0,get:function(){return m[V]}})}}),h.default=m,Object.freeze(h)}var b=l(G);function d(m,h){return d=Object.setPrototypeOf||function(X,p){return X.__proto__=p,X},d(m,h)}function e(m,h){m.prototype=Object.create(h.prototype),m.prototype.constructor=m,d(m,h)}var t=function(h,V){return h===void 0&&(h=[]),V===void 0&&(V=[]),h.length!==V.length||h.some(function(X,p){return!Object.is(X,V[p])})},W={error:null},n=function(m){e(h,m);function h(){for(var X,p=arguments.length,F=new Array(p),a=0;a<p;a++)F[a]=arguments[a];return X=m.call.apply(m,[this].concat(F))||this,X.state=W,X.resetErrorBoundary=function(){for(var u,Q=arguments.length,o=new Array(Q),y=0;y<Q;y++)o[y]=arguments[y];X.props.onReset==null||(u=X.props).onReset.apply(u,o),X.reset()},X}h.getDerivedStateFromError=function(p){return{error:p}};var V=h.prototype;return V.reset=function(){this.setState(W)},V.componentDidCatch=function(p,F){var a,u;(a=(u=this.props).onError)==null||a.call(u,p,F)},V.componentDidUpdate=function(p,F){var a=this.state.error,u=this.props.resetKeys;if(a!==null&&F.error!==null&&t(p.resetKeys,u)){var Q,o;(Q=(o=this.props).onResetKeysChange)==null||Q.call(o,p.resetKeys,u),this.reset()}},V.render=function(){var p=this.state.error,F=this.props,a=F.fallbackRender,u=F.FallbackComponent,Q=F.fallback;if(p!==null){var o={error:p,resetErrorBoundary:this.resetErrorBoundary};if(b.isValidElement(Q))return Q;if(typeof a=="function")return a(o);if(u)return b.createElement(u,o);throw new Error("react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop")}return this.props.children},h}(b.Component);function s(m,h){var V=function(F){return b.createElement(n,h,b.createElement(m,F))},X=m.displayName||m.name||"Unknown";return V.displayName="withErrorBoundary("+X+")",V}function N(m){var h=b.useState(null),V=h[0],X=h[1];if(m!=null)throw m;if(V!=null)throw V;return X}I.ErrorBoundary=n,I.useErrorHandler=N,I.withErrorBoundary=s,Object.defineProperty(I,"__esModule",{value:!0})})});var B1=el(sg()),m2=el(uc());var r0=el(N0());var w0=el(Q0());var H0=el(uc()),sR=class{constructor(){this.enforcement=void 0,this.enforcementReady=new Promise((G,l)=>{this.enforcementReadyResolve=G,this.enforcementReadyReject=l}),this.pendingPromises=[],window.useArkoseSetupEnforcement=this.useArkoseSetupEnforcement.bind(this),this.injectScript()}setConfigData(G){this.enforcement&&this.enforcement.setConfig({data:{blob:G}})}useArkoseSetupEnforcement(G){this.enforcement=G,G.setConfig({onCompleted:l=>{console.debug("enforcement.onCompleted",l),this.pendingPromises.forEach(b=>{b.resolve(l.token)}),this.pendingPromises=[]},onReady:()=>{console.debug("enforcement.onReady"),this.enforcementReadyResolve()},onError:l=>{console.debug("enforcement.onError",l),this.pendingPromises.forEach(b=>{b.reject(new Error("Error generating arkose token"))})},onFailed:l=>{console.debug("enforcement.onFailed",l),this.pendingPromises.forEach(b=>{b.reject(new Error("Failed to generate arkose token"))})}})}injectScript(){let G=document.createElement("script");G.src=H0.default.runtime.getURL("/js/v2/35536E1E-65B4-4D96-9D97-6ADB7EFF8147/api.js"),G.async=!0,G.defer=!0,G.setAttribute("data-callback","useArkoseSetupEnforcement"),document.body.appendChild(G)}async generate(){try{if(await Promise.race([this.enforcementReady,new Promise((G,l)=>setTimeout(()=>l(new Error("Timeout waiting for enforcement ready")),3e3))]),!this.enforcement)throw new Error("Enforcement not available");return new Promise((G,l)=>{this.pendingPromises=[{resolve:G,reject:l}],this.enforcement.run()})}catch{}}},YR=new sR;async function v0(I=0,G){if((await bp()).provider!=="web")return;let b;if(b=await Og(G),b||(b=await Bg(I)),b)return b}async function Bg(I){let G=I%2===0?"35536E1E-65B4-4D96-9D97-6ADB7EFF8147":"3D86FBBA-9D22-402A-B512-3420086BA6CC";try{return(await(0,w0.getToken)({pkey:G,surl:"https://tcr9i.chat.openai.com",data:{blob:"blob"},headers:{"User-Agent":window.navigator.userAgent},site:"https://chat.openai.com"})).token}catch(l){return console.log(l),null}}async function Og(I){try{return YR.setConfigData(I),await Promise.race([YR.generate(),new Promise((l,b)=>setTimeout(()=>b(new Error("Token generation timeout")),3e3))])}catch{return null}}function jg(){let I=performance?.memory.jsHeapSizeLimit??0;function G(l){return l[Math.floor(Math.random()*l.length)]}return[(navigator?.hardwareConcurrency??0)+(screen?.width??0)+(screen?.height??0),new Date().toString(),I,Math.random(),navigator?.userAgent,G(Array.from(document.scripts).map(l=>l.src).filter(l=>l)),Array.from(document.scripts).map(l=>l.src).filter(l=>l.match("dpl.*"))[0]??null,navigator.language,navigator.languages?.join(",")??"",Math.random(),(()=>{let l=G(Object.keys(Object.getPrototypeOf(navigator)));try{return`${l}-${navigator[l].toString()}`}catch{return`${l}`}})(),G(Object.keys(document)),G(Object.keys(window)),performance.now(),""]}function E0(I,G){return"gAAAAAB"+g0(I,G)}function y0(){return"gAAAAAC"+g0(""+Math.random(),"0")}function g0(I,G){let l=jg(),b=performance.now();for(let d=0;d<5e5;d++){l[3]=d,l[9]=Math.round(performance.now()-b);let e=JSON.stringify(l),t=btoa(String.fromCharCode(...new TextEncoder().encode(e)));if((0,r0.sha3_512)(I+t).slice(0,G.length)<=G)return t}return"wQ8Lk5FbGpA2NcR9dShT6gYjU7VxZ4D"+btoa(I)}var J0=el(IG(),1);function hR(I,G){let[l,b]=(0,J0.useState)(I),d=Re(I);return pd(()=>b(d.current),[d,b,...G]),l}var en=el(IG(),1);function C0(I,G,l){let[b,d]=(0,en.useState)(l),e=I!==void 0,t=(0,en.useRef)(e),W=(0,en.useRef)(!1),n=(0,en.useRef)(!1);return e&&!t.current&&!W.current?(W.current=!0,t.current=e,console.error("A component is changing from uncontrolled to controlled. This may be caused by the value changing from undefined to a defined value, which should not happen.")):!e&&t.current&&!n.current&&(n.current=!0,t.current=e,console.error("A component is changing from controlled to uncontrolled. This may be caused by the value changing from a defined value to undefined, which should not happen.")),[e?I:b,OG(s=>(e||d(s),G?.(s)))]}var L0=el(IG(),1);function A0(I){return[I.screenX,I.screenY]}function k0(){let I=(0,L0.useRef)([-1,-1]);return{wasMoved(G){let l=A0(G);return I.current[0]===l[0]&&I.current[1]===l[1]?!1:(I.current=l,!0)},update(G){I.current=A0(G)}}}function Kg(I){throw new Error("Unexpected object: "+I)}var vb=(I=>(I[I.First=0]="First",I[I.Previous=1]="Previous",I[I.Next=2]="Next",I[I.Last=3]="Last",I[I.Specific=4]="Specific",I[I.Nothing=5]="Nothing",I))(vb||{});function x0(I,G){let l=G.resolveItems();if(l.length<=0)return null;let b=G.resolveActiveIndex(),d=b??-1;switch(I.focus){case 0:{for(let e=0;e<l.length;++e)if(!G.resolveDisabled(l[e],e,l))return e;return b}case 1:{for(let e=d-1;e>=0;--e)if(!G.resolveDisabled(l[e],e,l))return e;return b}case 2:{for(let e=d+1;e<l.length;++e)if(!G.resolveDisabled(l[e],e,l))return e;return b}case 3:{for(let e=l.length-1;e>=0;--e)if(!G.resolveDisabled(l[e],e,l))return e;return b}case 4:{for(let e=0;e<l.length;++e)if(G.resolveId(l[e],e,l)===I.id)return e;return b}case 5:return null;default:Kg(I)}}function VR(I={},G=null,l=[]){for(let[b,d]of Object.entries(I))U0(l,z0(G,b),d);return l}function z0(I,G){return I?I+"["+G+"]":G}function U0(I,G,l){if(Array.isArray(l))for(let[b,d]of l.entries())U0(I,z0(G,b.toString()),d);else l instanceof Date?I.push([G,l.toISOString()]):typeof l=="boolean"?I.push([G,l?"1":"0"]):typeof l=="string"?I.push([G,l]):typeof l=="number"?I.push([G,`${l}`]):l==null?I.push([G,""]):VR(l,G,I)}var AG=el(IG(),1);var pR=el(IG(),1);var M0=/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g;function B0(I){var G,l;let b=(G=I.innerText)!=null?G:"",d=I.cloneNode(!0);if(!(d instanceof HTMLElement))return b;let e=!1;for(let W of d.querySelectorAll('[hidden],[aria-hidden],[role="img"]'))W.remove(),e=!0;let t=e?(l=d.innerText)!=null?l:"":b;return M0.test(t)&&(t=t.replace(M0,"")),t}function O0(I){let G=I.getAttribute("aria-label");if(typeof G=="string")return G.trim();let l=I.getAttribute("aria-labelledby");if(l){let b=l.split(" ").map(d=>{let e=document.getElementById(d);if(e){let t=e.getAttribute("aria-label");return typeof t=="string"?t.trim():B0(e).trim()}return null}).filter(Boolean);if(b.length>0)return b.join(", ")}return B0(I).trim()}function j0(I){let G=(0,pR.useRef)(""),l=(0,pR.useRef)("");return OG(()=>{let b=I.current;if(!b)return"";let d=b.innerText;if(G.current===d)return l.current;let e=O0(b).trim().toLowerCase();return G.current=d,l.current=e,e})}var Tg=(I=>(I[I.Open=0]="Open",I[I.Closed=1]="Closed",I))(Tg||{}),fg=(I=>(I[I.Single=0]="Single",I[I.Multi=1]="Multi",I))(fg||{}),Sg=(I=>(I[I.Pointer=0]="Pointer",I[I.Other=1]="Other",I))(Sg||{}),Dg=(I=>(I[I.OpenListbox=0]="OpenListbox",I[I.CloseListbox=1]="CloseListbox",I[I.GoToOption=2]="GoToOption",I[I.Search=3]="Search",I[I.ClearSearch=4]="ClearSearch",I[I.RegisterOption=5]="RegisterOption",I[I.UnregisterOption=6]="UnregisterOption",I[I.RegisterLabel=7]="RegisterLabel",I))(Dg||{});function uR(I,G=l=>l){let l=I.activeOptionIndex!==null?I.options[I.activeOptionIndex]:null,b=Fe(G(I.options.slice()),e=>e.dataRef.current.domRef.current),d=l?b.indexOf(l):null;return d===-1&&(d=null),{options:b,activeOptionIndex:d}}var qg={1(I){return I.dataRef.current.disabled||I.listboxState===1?I:{...I,activeOptionIndex:null,listboxState:1}},0(I){if(I.dataRef.current.disabled||I.listboxState===0)return I;let G=I.activeOptionIndex,{isSelected:l}=I.dataRef.current,b=I.options.findIndex(d=>l(d.dataRef.current.value));return b!==-1&&(G=b),{...I,listboxState:0,activeOptionIndex:G}},2(I,G){var l;if(I.dataRef.current.disabled||I.listboxState===1)return I;let b=uR(I),d=x0(G,{resolveItems:()=>b.options,resolveActiveIndex:()=>b.activeOptionIndex,resolveId:e=>e.id,resolveDisabled:e=>e.dataRef.current.disabled});return{...I,...b,searchQuery:"",activeOptionIndex:d,activationTrigger:(l=G.trigger)!=null?l:1}},3:(I,G)=>{if(I.dataRef.current.disabled||I.listboxState===1)return I;let l=I.searchQuery!==""?0:1,b=I.searchQuery+G.value.toLowerCase(),d=(I.activeOptionIndex!==null?I.options.slice(I.activeOptionIndex+l).concat(I.options.slice(0,I.activeOptionIndex+l)):I.options).find(t=>{var W;return!t.dataRef.current.disabled&&((W=t.dataRef.current.textValue)==null?void 0:W.startsWith(b))}),e=d?I.options.indexOf(d):-1;return e===-1||e===I.activeOptionIndex?{...I,searchQuery:b}:{...I,searchQuery:b,activeOptionIndex:e,activationTrigger:1}},4(I){return I.dataRef.current.disabled||I.listboxState===1||I.searchQuery===""?I:{...I,searchQuery:""}},5:(I,G)=>{let l={id:G.id,dataRef:G.dataRef},b=uR(I,d=>[...d,l]);return I.activeOptionIndex===null&&I.dataRef.current.isSelected(G.dataRef.current.value)&&(b.activeOptionIndex=b.options.indexOf(l)),{...I,...b}},6:(I,G)=>{let l=uR(I,b=>{let d=b.findIndex(e=>e.id===G.id);return d!==-1&&b.splice(d,1),b});return{...I,...l,activationTrigger:1}},7:(I,G)=>({...I,labelId:G.id})},RR=(0,AG.createContext)(null);RR.displayName="ListboxActionsContext";function OY(I){let G=(0,AG.useContext)(RR);if(G===null){let l=new Error(`<${I} /> is missing a parent <Listbox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(l,OY),l}return G}var oR=(0,AG.createContext)(null);oR.displayName="ListboxDataContext";function jY(I){let G=(0,AG.useContext)(oR);if(G===null){let l=new Error(`<${I} /> is missing a parent <Listbox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(l,jY),l}return G}function _g(I,G){return Gd(G.type,qg,I,G)}var Pg=AG.Fragment;function $g(I,G){let{value:l,defaultValue:b,form:d,name:e,onChange:t,by:W=(JI,UI)=>JI===UI,disabled:n=!1,horizontal:s=!1,multiple:N=!1,...m}=I,h=s?"horizontal":"vertical",V=ud(G),[X=N?[]:void 0,p]=C0(l,t,b),[F,a]=(0,AG.useReducer)(_g,{dataRef:(0,AG.createRef)(),listboxState:1,options:[],searchQuery:"",labelId:null,activeOptionIndex:null,activationTrigger:1}),u=(0,AG.useRef)({static:!1,hold:!1}),Q=(0,AG.useRef)(null),o=(0,AG.useRef)(null),y=(0,AG.useRef)(null),H=OG(typeof W=="string"?(JI,UI)=>{let zI=W;return JI?.[zI]===UI?.[zI]}:W),E=(0,AG.useCallback)(JI=>Gd(C.mode,{1:()=>X.some(UI=>H(UI,JI)),0:()=>H(X,JI)}),[X]),C=(0,AG.useMemo)(()=>({...F,value:X,disabled:n,mode:N?1:0,orientation:h,compare:H,isSelected:E,optionsPropsRef:u,labelRef:Q,buttonRef:o,optionsRef:y}),[X,n,N,F]);pd(()=>{F.dataRef.current=C},[C]),Pi([C.buttonRef,C.optionsRef],(JI,UI)=>{var zI;a({type:1}),_i(UI,qi.Loose)||(JI.preventDefault(),(zI=C.buttonRef.current)==null||zI.focus())},C.listboxState===0);let T=(0,AG.useMemo)(()=>({open:C.listboxState===0,disabled:n,value:X}),[C,n,X]),S=OG(JI=>{let UI=C.options.find(zI=>zI.id===JI);UI&&dI(UI.dataRef.current.value)}),cI=OG(()=>{if(C.activeOptionIndex!==null){let{dataRef:JI,id:UI}=C.options[C.activeOptionIndex];dI(JI.current.value),a({type:2,focus:vb.Specific,id:UI})}}),hI=OG(()=>a({type:0})),WI=OG(()=>a({type:1})),VI=OG((JI,UI,zI)=>JI===vb.Specific?a({type:2,focus:vb.Specific,id:UI,trigger:zI}):a({type:2,focus:JI,trigger:zI})),sI=OG((JI,UI)=>(a({type:5,id:JI,dataRef:UI}),()=>a({type:6,id:JI}))),ZI=OG(JI=>(a({type:7,id:JI}),()=>a({type:7,id:null}))),dI=OG(JI=>Gd(C.mode,{0(){return p?.(JI)},1(){let UI=C.value.slice(),zI=UI.findIndex(L=>H(L,JI));return zI===-1?UI.push(JI):UI.splice(zI,1),p?.(UI)}})),pI=OG(JI=>a({type:3,value:JI})),yI=OG(()=>a({type:4})),eI=(0,AG.useMemo)(()=>({onChange:dI,registerOption:sI,registerLabel:ZI,goToOption:VI,closeListbox:WI,openListbox:hI,selectActiveOption:cI,selectOption:S,search:pI,clearSearch:yI}),[]),HI={ref:V},YI=(0,AG.useRef)(null),$=kY();return(0,AG.useEffect)(()=>{YI.current&&b!==void 0&&$.addEventListener(YI.current,"reset",()=>{p?.(b)})},[YI,p]),AG.default.createElement(RR.Provider,{value:eI},AG.default.createElement(oR.Provider,{value:C},AG.default.createElement(l0,{value:Gd(C.listboxState,{0:zY.Open,1:zY.Closed})},e!=null&&X!=null&&VR({[e]:X}).map(([JI,UI],zI)=>AG.default.createElement(cn,{features:ap.Hidden,ref:zI===0?L=>{var bI;YI.current=(bI=L?.closest("form"))!=null?bI:null}:void 0,...$i({key:JI,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:d,name:JI,value:UI})})),Rd({ourProps:HI,theirProps:m,slot:T,defaultTag:Pg,name:"Listbox"}))))}var IJ="button";function lJ(I,G){var l;let b=oe(),{id:d=`headlessui-listbox-button-${b}`,...e}=I,t=jY("Listbox.Button"),W=OY("Listbox.Button"),n=ud(t.buttonRef,G),s=kY(),N=OG(F=>{switch(F.key){case PG.Space:case PG.Enter:case PG.ArrowDown:F.preventDefault(),W.openListbox(),s.nextFrame(()=>{t.value||W.goToOption(vb.First)});break;case PG.ArrowUp:F.preventDefault(),W.openListbox(),s.nextFrame(()=>{t.value||W.goToOption(vb.Last)});break}}),m=OG(F=>{switch(F.key){case PG.Space:F.preventDefault();break}}),h=OG(F=>{if(G0(F.currentTarget))return F.preventDefault();t.listboxState===0?(W.closeListbox(),s.nextFrame(()=>{var a;return(a=t.buttonRef.current)==null?void 0:a.focus({preventScroll:!0})})):(F.preventDefault(),W.openListbox())}),V=hR(()=>{if(t.labelId)return[t.labelId,d].join(" ")},[t.labelId,d]),X=(0,AG.useMemo)(()=>({open:t.listboxState===0,disabled:t.disabled,value:t.value}),[t]),p={ref:n,id:d,type:ep(I,t.buttonRef),"aria-haspopup":"listbox","aria-controls":(l=t.optionsRef.current)==null?void 0:l.id,"aria-expanded":t.listboxState===0,"aria-labelledby":V,disabled:t.disabled,onKeyDown:N,onKeyUp:m,onClick:h};return Rd({ourProps:p,theirProps:e,slot:X,defaultTag:IJ,name:"Listbox.Button"})}var GJ="label";function cJ(I,G){let l=oe(),{id:b=`headlessui-listbox-label-${l}`,...d}=I,e=jY("Listbox.Label"),t=OY("Listbox.Label"),W=ud(e.labelRef,G);pd(()=>t.registerLabel(b),[b]);let n=OG(()=>{var N;return(N=e.buttonRef.current)==null?void 0:N.focus({preventScroll:!0})}),s=(0,AG.useMemo)(()=>({open:e.listboxState===0,disabled:e.disabled}),[e]);return Rd({ourProps:{ref:W,id:b,onClick:n},theirProps:d,slot:s,defaultTag:GJ,name:"Listbox.Label"})}var bJ="ul",dJ=Gn.RenderStrategy|Gn.Static;function ZJ(I,G){var l;let b=oe(),{id:d=`headlessui-listbox-options-${b}`,...e}=I,t=jY("Listbox.Options"),W=OY("Listbox.Options"),n=ud(t.optionsRef,G),s=kY(),N=kY(),m=I0(),h=m!==null?(m&zY.Open)===zY.Open:t.listboxState===0;(0,AG.useEffect)(()=>{var a;let u=t.optionsRef.current;u&&t.listboxState===0&&u!==((a=Zp(u))==null?void 0:a.activeElement)&&u.focus({preventScroll:!0})},[t.listboxState,t.optionsRef]);let V=OG(a=>{switch(N.dispose(),a.key){case PG.Space:if(t.searchQuery!=="")return a.preventDefault(),a.stopPropagation(),W.search(a.key);case PG.Enter:if(a.preventDefault(),a.stopPropagation(),t.activeOptionIndex!==null){let{dataRef:u}=t.options[t.activeOptionIndex];W.onChange(u.current.value)}t.mode===0&&(W.closeListbox(),dp().nextFrame(()=>{var u;return(u=t.buttonRef.current)==null?void 0:u.focus({preventScroll:!0})}));break;case Gd(t.orientation,{vertical:PG.ArrowDown,horizontal:PG.ArrowRight}):return a.preventDefault(),a.stopPropagation(),W.goToOption(vb.Next);case Gd(t.orientation,{vertical:PG.ArrowUp,horizontal:PG.ArrowLeft}):return a.preventDefault(),a.stopPropagation(),W.goToOption(vb.Previous);case PG.Home:case PG.PageUp:return a.preventDefault(),a.stopPropagation(),W.goToOption(vb.First);case PG.End:case PG.PageDown:return a.preventDefault(),a.stopPropagation(),W.goToOption(vb.Last);case PG.Escape:return a.preventDefault(),a.stopPropagation(),W.closeListbox(),s.nextFrame(()=>{var u;return(u=t.buttonRef.current)==null?void 0:u.focus({preventScroll:!0})});case PG.Tab:a.preventDefault(),a.stopPropagation();break;default:a.key.length===1&&(W.search(a.key),N.setTimeout(()=>W.clearSearch(),350));break}}),X=hR(()=>{var a;return(a=t.buttonRef.current)==null?void 0:a.id},[t.buttonRef.current]),p=(0,AG.useMemo)(()=>({open:t.listboxState===0}),[t]),F={"aria-activedescendant":t.activeOptionIndex===null||(l=t.options[t.activeOptionIndex])==null?void 0:l.id,"aria-multiselectable":t.mode===1?!0:void 0,"aria-labelledby":X,"aria-orientation":t.orientation,id:d,onKeyDown:V,role:"listbox",tabIndex:0,ref:n};return Rd({ourProps:F,theirProps:e,slot:p,defaultTag:bJ,features:dJ,visible:h,name:"Listbox.Options"})}var eJ="li";function aJ(I,G){let l=oe(),{id:b=`headlessui-listbox-option-${l}`,disabled:d=!1,value:e,...t}=I,W=jY("Listbox.Option"),n=OY("Listbox.Option"),s=W.activeOptionIndex!==null?W.options[W.activeOptionIndex].id===b:!1,N=W.isSelected(e),m=(0,AG.useRef)(null),h=j0(m),V=Re({disabled:d,value:e,domRef:m,get textValue(){return h()}}),X=ud(G,m);pd(()=>{if(W.listboxState!==0||!s||W.activationTrigger===0)return;let H=dp();return H.requestAnimationFrame(()=>{var E,C;(C=(E=m.current)==null?void 0:E.scrollIntoView)==null||C.call(E,{block:"nearest"})}),H.dispose},[m,s,W.listboxState,W.activationTrigger,W.activeOptionIndex]),pd(()=>n.registerOption(b,V),[V,b]);let p=OG(H=>{if(d)return H.preventDefault();n.onChange(e),W.mode===0&&(n.closeListbox(),dp().nextFrame(()=>{var E;return(E=W.buttonRef.current)==null?void 0:E.focus({preventScroll:!0})}))}),F=OG(()=>{if(d)return n.goToOption(vb.Nothing);n.goToOption(vb.Specific,b)}),a=k0(),u=OG(H=>a.update(H)),Q=OG(H=>{a.wasMoved(H)&&(d||s||n.goToOption(vb.Specific,b,0))}),o=OG(H=>{a.wasMoved(H)&&(d||s&&n.goToOption(vb.Nothing))}),y=(0,AG.useMemo)(()=>({active:s,selected:N,disabled:d}),[s,N,d]);return Rd({ourProps:{id:b,ref:X,role:"option",tabIndex:d===!0?void 0:-1,"aria-disabled":d===!0?!0:void 0,"aria-selected":N,disabled:void 0,onClick:p,onFocus:F,onPointerEnter:u,onMouseEnter:u,onPointerMove:Q,onMouseMove:Q,onPointerLeave:o,onMouseLeave:o},theirProps:t,slot:y,defaultTag:eJ,name:"Listbox.Option"})}var WJ=od($g),tJ=od(lJ),nJ=od(cJ),mJ=od(ZJ),NJ=od(aJ),KY=Object.assign(WJ,{Button:tJ,Label:nJ,Options:mJ,Option:NJ});var Nc=el(IG(),1);var sp=el(IG(),1);function K0({onFocus:I}){let[G,l]=(0,sp.useState)(!0),b=c0();return G?sp.default.createElement(cn,{as:"button",type:"button",features:ap.Focusable,onFocus:d=>{d.preventDefault();let e,t=50;function W(){if(t--<=0){e&&cancelAnimationFrame(e);return}if(I()){if(cancelAnimationFrame(e),!b.current)return;l(!1);return}e=requestAnimationFrame(W)}e=requestAnimationFrame(W)}}):null}var Xd=el(IG(),1),T0=Xd.createContext(null);function sJ(){return{groups:new Map,get(I,G){var l;let b=this.groups.get(I);b||(b=new Map,this.groups.set(I,b));let d=(l=b.get(G))!=null?l:0;b.set(G,d+1);let e=Array.from(b.keys()).indexOf(G);function t(){let W=b.get(G);W>1?b.set(G,W-1):b.delete(G)}return[e,t]}}}function f0({children:I}){let G=Xd.useRef(sJ());return Xd.createElement(T0.Provider,{value:G},I)}function FR(I){let G=Xd.useContext(T0);if(!G)throw new Error("You must wrap your component in a <StableCollection>");let l=YJ(),[b,d]=G.current.get(I,l);return Xd.useEffect(()=>d,[]),b}function YJ(){var I,G,l;let b=(l=(G=(I=Xd.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED)==null?void 0:I.ReactCurrentOwner)==null?void 0:G.current)!=null?l:null;if(!b)return Symbol();let d=[],e=b;for(;e;)d.push(e.index),e=e.return;return"$."+d.join(".")}var hJ=(I=>(I[I.Forwards=0]="Forwards",I[I.Backwards=1]="Backwards",I))(hJ||{}),VJ=(I=>(I[I.Less=-1]="Less",I[I.Equal=0]="Equal",I[I.Greater=1]="Greater",I))(VJ||{}),pJ=(I=>(I[I.SetSelectedIndex=0]="SetSelectedIndex",I[I.RegisterTab=1]="RegisterTab",I[I.UnregisterTab=2]="UnregisterTab",I[I.RegisterPanel=3]="RegisterPanel",I[I.UnregisterPanel=4]="UnregisterPanel",I))(pJ||{}),uJ={0(I,G){var l;let b=Fe(I.tabs,N=>N.current),d=Fe(I.panels,N=>N.current),e=b.filter(N=>{var m;return!((m=N.current)!=null&&m.hasAttribute("disabled"))}),t={...I,tabs:b,panels:d};if(G.index<0||G.index>b.length-1){let N=Gd(Math.sign(G.index-I.selectedIndex),{[-1]:()=>1,0:()=>Gd(Math.sign(G.index),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0});if(e.length===0)return t;let m=Gd(N,{0:()=>b.indexOf(e[0]),1:()=>b.indexOf(e[e.length-1])});return{...t,selectedIndex:m===-1?I.selectedIndex:m}}let W=b.slice(0,G.index),n=[...b.slice(G.index),...W].find(N=>e.includes(N));if(!n)return t;let s=(l=b.indexOf(n))!=null?l:I.selectedIndex;return s===-1&&(s=I.selectedIndex),{...t,selectedIndex:s}},1(I,G){var l;if(I.tabs.includes(G.tab))return I;let b=I.tabs[I.selectedIndex],d=Fe([...I.tabs,G.tab],t=>t.current),e=(l=d.indexOf(b))!=null?l:I.selectedIndex;return e===-1&&(e=I.selectedIndex),{...I,tabs:d,selectedIndex:e}},2(I,G){return{...I,tabs:I.tabs.filter(l=>l!==G.tab)}},3(I,G){return I.panels.includes(G.panel)?I:{...I,panels:Fe([...I.panels,G.panel],l=>l.current)}},4(I,G){return{...I,panels:I.panels.filter(l=>l!==G.panel)}}},XR=(0,Nc.createContext)(null);XR.displayName="TabsDataContext";function an(I){let G=(0,Nc.useContext)(XR);if(G===null){let l=new Error(`<${I} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(l,an),l}return G}var iR=(0,Nc.createContext)(null);iR.displayName="TabsActionsContext";function QR(I){let G=(0,Nc.useContext)(iR);if(G===null){let l=new Error(`<${I} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(l,QR),l}return G}function RJ(I,G){return Gd(G.type,uJ,I,G)}var oJ=Nc.Fragment;function FJ(I,G){let{defaultIndex:l=0,vertical:b=!1,manual:d=!1,onChange:e,selectedIndex:t=null,...W}=I,n=b?"vertical":"horizontal",s=d?"manual":"auto",N=t!==null,m=ud(G),[h,V]=(0,Nc.useReducer)(RJ,{selectedIndex:t??l,tabs:[],panels:[]}),X=(0,Nc.useMemo)(()=>({selectedIndex:h.selectedIndex}),[h.selectedIndex]),p=Re(e||(()=>{})),F=Re(h.tabs),a=(0,Nc.useMemo)(()=>({orientation:n,activation:s,...h}),[n,s,h]),u=OG(C=>(V({type:1,tab:C}),()=>V({type:2,tab:C}))),Q=OG(C=>(V({type:3,panel:C}),()=>V({type:4,panel:C}))),o=OG(C=>{y.current!==C&&p.current(C),N||V({type:0,index:C})}),y=Re(N?I.selectedIndex:h.selectedIndex),H=(0,Nc.useMemo)(()=>({registerTab:u,registerPanel:Q,change:o}),[]);pd(()=>{V({type:0,index:t??l})},[t]),pd(()=>{if(y.current===void 0||h.tabs.length<=0)return;let C=Fe(h.tabs,T=>T.current);C.some((T,S)=>h.tabs[S]!==T)&&o(C.indexOf(h.tabs[y.current]))});let E={ref:m};return Nc.default.createElement(f0,null,Nc.default.createElement(iR.Provider,{value:H},Nc.default.createElement(XR.Provider,{value:a},a.tabs.length<=0&&Nc.default.createElement(K0,{onFocus:()=>{var C,T;for(let S of F.current)if(((C=S.current)==null?void 0:C.tabIndex)===0)return(T=S.current)==null||T.focus(),!0;return!1}}),Rd({ourProps:E,theirProps:W,slot:X,defaultTag:oJ,name:"Tabs"}))))}var XJ="div";function iJ(I,G){let{orientation:l,selectedIndex:b}=an("Tab.List"),d=ud(G);return Rd({ourProps:{ref:d,role:"tablist","aria-orientation":l},theirProps:I,slot:{selectedIndex:b},defaultTag:XJ,name:"Tabs.List"})}var QJ="button";function HJ(I,G){var l,b;let d=oe(),{id:e=`headlessui-tabs-tab-${d}`,...t}=I,{orientation:W,activation:n,selectedIndex:s,tabs:N,panels:m}=an("Tab"),h=QR("Tab"),V=an("Tab"),X=(0,Nc.useRef)(null),p=ud(X,G);pd(()=>h.registerTab(X),[h,X]);let F=FR("tabs"),a=N.indexOf(X);a===-1&&(a=F);let u=a===s,Q=OG(S=>{var cI;let hI=S();if(hI===xY.Success&&n==="auto"){let WI=(cI=Zp(X))==null?void 0:cI.activeElement,VI=V.tabs.findIndex(sI=>sI.current===WI);VI!==-1&&h.change(VI)}return hI}),o=OG(S=>{let cI=N.map(hI=>hI.current).filter(Boolean);if(S.key===PG.Space||S.key===PG.Enter){S.preventDefault(),S.stopPropagation(),h.change(a);return}switch(S.key){case PG.Home:case PG.PageUp:return S.preventDefault(),S.stopPropagation(),Q(()=>Fa(cI,zd.First));case PG.End:case PG.PageDown:return S.preventDefault(),S.stopPropagation(),Q(()=>Fa(cI,zd.Last))}if(Q(()=>Gd(W,{vertical(){return S.key===PG.ArrowUp?Fa(cI,zd.Previous|zd.WrapAround):S.key===PG.ArrowDown?Fa(cI,zd.Next|zd.WrapAround):xY.Error},horizontal(){return S.key===PG.ArrowLeft?Fa(cI,zd.Previous|zd.WrapAround):S.key===PG.ArrowRight?Fa(cI,zd.Next|zd.WrapAround):xY.Error}}))===xY.Success)return S.preventDefault()}),y=(0,Nc.useRef)(!1),H=OG(()=>{var S;y.current||(y.current=!0,(S=X.current)==null||S.focus({preventScroll:!0}),h.change(a),Di(()=>{y.current=!1}))}),E=OG(S=>{S.preventDefault()}),C=(0,Nc.useMemo)(()=>({selected:u}),[u]),T={ref:p,onKeyDown:o,onMouseDown:E,onClick:H,id:e,role:"tab",type:ep(I,X),"aria-controls":(b=(l=m[a])==null?void 0:l.current)==null?void 0:b.id,"aria-selected":u,tabIndex:u?0:-1};return Rd({ourProps:T,theirProps:t,slot:C,defaultTag:QJ,name:"Tabs.Tab"})}var rJ="div";function wJ(I,G){let{selectedIndex:l}=an("Tab.Panels"),b=ud(G),d=(0,Nc.useMemo)(()=>({selectedIndex:l}),[l]);return Rd({ourProps:{ref:b},theirProps:I,slot:d,defaultTag:rJ,name:"Tabs.Panels"})}var vJ="div",EJ=Gn.RenderStrategy|Gn.Static;function yJ(I,G){var l,b,d,e;let t=oe(),{id:W=`headlessui-tabs-panel-${t}`,tabIndex:n=0,...s}=I,{selectedIndex:N,tabs:m,panels:h}=an("Tab.Panel"),V=QR("Tab.Panel"),X=(0,Nc.useRef)(null),p=ud(X,G);pd(()=>V.registerPanel(X),[V,X]);let F=FR("panels"),a=h.indexOf(X);a===-1&&(a=F);let u=a===N,Q=(0,Nc.useMemo)(()=>({selected:u}),[u]),o={ref:p,id:W,role:"tabpanel","aria-labelledby":(b=(l=m[a])==null?void 0:l.current)==null?void 0:b.id,tabIndex:u?n:-1};return!u&&((d=s.unmount)==null||d)&&!((e=s.static)!=null&&e)?Nc.default.createElement(cn,{as:"span","aria-hidden":"true",...o}):Rd({ourProps:o,theirProps:s,slot:Q,defaultTag:vJ,features:EJ,visible:u,name:"Tabs.Panel"})}var gJ=od(HJ),JJ=od(FJ),CJ=od(iJ),AJ=od(wJ),LJ=od(yJ),Qe=Object.assign(gJ,{Group:JJ,List:CJ,Panels:AJ,Panel:LJ});var Wn=el(IG(),1);function kJ({title:I,titleId:G,...l},b){return Wn.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:b,"aria-labelledby":G},l),I?Wn.createElement("title",{id:G},I):null,Wn.createElement("path",{fillRule:"evenodd",d:"M2 3.75A.75.75 0 0 1 2.75 3h11.5a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 3.75ZM2 7.5a.75.75 0 0 1 .75-.75h7.508a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 7.5ZM14 7a.75.75 0 0 1 .75.75v6.59l1.95-2.1a.75.75 0 1 1 1.1 1.02l-3.25 3.5a.75.75 0 0 1-1.1 0l-3.25-3.5a.75.75 0 1 1 1.1-1.02l1.95 2.1V7.75A.75.75 0 0 1 14 7ZM2 11.25a.75.75 0 0 1 .75-.75h4.562a.75.75 0 0 1 0 1.5H2.75a.75.75 0 0 1-.75-.75Z",clipRule:"evenodd"}))}var xJ=Wn.forwardRef(kJ),HR=xJ;var tn=el(IG(),1);function zJ({title:I,titleId:G,...l},b){return tn.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:b,"aria-labelledby":G},l),I?tn.createElement("title",{id:G},I):null,tn.createElement("path",{fillRule:"evenodd",d:"M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z",clipRule:"evenodd"}))}var UJ=tn.forwardRef(zJ),rR=UJ;var nn=el(IG(),1);function MJ({title:I,titleId:G,...l},b){return nn.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:b,"aria-labelledby":G},l),I?nn.createElement("title",{id:G},I):null,nn.createElement("path",{fillRule:"evenodd",d:"M10.53 3.47a.75.75 0 0 0-1.06 0L6.22 6.72a.75.75 0 0 0 1.06 1.06L10 5.06l2.72 2.72a.75.75 0 1 0 1.06-1.06l-3.25-3.25Zm-4.31 9.81 3.25 3.25a.75.75 0 0 0 1.06 0l3.25-3.25a.75.75 0 1 0-1.06-1.06L10 14.94l-2.72-2.72a.75.75 0 0 0-1.06 1.06Z",clipRule:"evenodd"}))}var BJ=nn.forwardRef(MJ),wR=BJ;var mn=el(IG(),1);function OJ({title:I,titleId:G,...l},b){return mn.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:b,"aria-labelledby":G},l),I?mn.createElement("title",{id:G},I):null,mn.createElement("path",{fillRule:"evenodd",d:"M8.34 1.804A1 1 0 0 1 9.32 1h1.36a1 1 0 0 1 .98.804l.295 1.473c.497.144.971.342 1.416.587l1.25-.834a1 1 0 0 1 1.262.125l.962.962a1 1 0 0 1 .125 1.262l-.834 1.25c.245.445.443.919.587 1.416l1.473.294a1 1 0 0 1 .804.98v1.361a1 1 0 0 1-.804.98l-1.473.295a6.95 6.95 0 0 1-.587 1.416l.834 1.25a1 1 0 0 1-.125 1.262l-.962.962a1 1 0 0 1-1.262.125l-1.25-.834a6.953 6.953 0 0 1-1.416.587l-.294 1.473a1 1 0 0 1-.98.804H9.32a1 1 0 0 1-.98-.804l-.295-1.473a6.957 6.957 0 0 1-1.416-.587l-1.25.834a1 1 0 0 1-1.262-.125l-.962-.962a1 1 0 0 1-.125-1.262l.834-1.25a6.957 6.957 0 0 1-.587-1.416l-1.473-.294A1 1 0 0 1 1 10.68V9.32a1 1 0 0 1 .804-.98l1.473-.295c.144-.497.342-.971.587-1.416l-.834-1.25a1 1 0 0 1 .125-1.262l.962-.962A1 1 0 0 1 5.38 3.03l1.25.834a6.957 6.957 0 0 1 1.416-.587l.294-1.473ZM13 10a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z",clipRule:"evenodd"}))}var jJ=mn.forwardRef(OJ),vR=jJ;var Nn=el(IG(),1);function KJ({title:I,titleId:G,...l},b){return Nn.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:b,"aria-labelledby":G},l),I?Nn.createElement("title",{id:G},I):null,Nn.createElement("path",{d:"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"}))}var TJ=Nn.forwardRef(KJ),ER=TJ;var dX=el(q2());var fJ=function(){function I(G,l){l===void 0&&(l=[]),this._eventType=G,this._eventFunctions=l}return I.prototype.init=function(){var G=this;this._eventFunctions.forEach(function(l){typeof window<"u"&&window.addEventListener(G._eventType,l)})},I}(),S0=fJ;var Yp=function(){return Yp=Object.assign||function(I){for(var G,l=1,b=arguments.length;l<b;l++){G=arguments[l];for(var d in G)Object.prototype.hasOwnProperty.call(G,d)&&(I[d]=G[d])}return I},Yp.apply(this,arguments)},hp={alwaysOpen:!1,activeClasses:"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white",inactiveClasses:"text-gray-500 dark:text-gray-400",onOpen:function(){},onClose:function(){},onToggle:function(){}},D0=function(){function I(G,l){G===void 0&&(G=[]),l===void 0&&(l=hp),this._items=G,this._options=Yp(Yp({},hp),l),this._init()}return I.prototype._init=function(){var G=this;this._items.length&&this._items.map(function(l){l.active&&G.open(l.id),l.triggerEl.addEventListener("click",function(){G.toggle(l.id)})})},I.prototype.getItem=function(G){return this._items.filter(function(l){return l.id===G})[0]},I.prototype.open=function(G){var l,b,d=this,e=this.getItem(G);this._options.alwaysOpen||this._items.map(function(t){var W,n;t!==e&&((W=t.triggerEl.classList).remove.apply(W,d._options.activeClasses.split(" ")),(n=t.triggerEl.classList).add.apply(n,d._options.inactiveClasses.split(" ")),t.targetEl.classList.add("hidden"),t.triggerEl.setAttribute("aria-expanded","false"),t.active=!1,t.iconEl&&t.iconEl.classList.remove("rotate-180"))}),(l=e.triggerEl.classList).add.apply(l,this._options.activeClasses.split(" ")),(b=e.triggerEl.classList).remove.apply(b,this._options.inactiveClasses.split(" ")),e.triggerEl.setAttribute("aria-expanded","true"),e.targetEl.classList.remove("hidden"),e.active=!0,e.iconEl&&e.iconEl.classList.add("rotate-180"),this._options.onOpen(this,e)},I.prototype.toggle=function(G){var l=this.getItem(G);l.active?this.close(G):this.open(G),this._options.onToggle(this,l)},I.prototype.close=function(G){var l,b,d=this.getItem(G);(l=d.triggerEl.classList).remove.apply(l,this._options.activeClasses.split(" ")),(b=d.triggerEl.classList).add.apply(b,this._options.inactiveClasses.split(" ")),d.targetEl.classList.add("hidden"),d.triggerEl.setAttribute("aria-expanded","false"),d.active=!1,d.iconEl&&d.iconEl.classList.remove("rotate-180"),this._options.onClose(this,d)},I}();function sn(){document.querySelectorAll("[data-accordion]").forEach(function(I){var G=I.getAttribute("data-accordion"),l=I.getAttribute("data-active-classes"),b=I.getAttribute("data-inactive-classes"),d=[];I.querySelectorAll("[data-accordion-target]").forEach(function(e){if(e.closest("[data-accordion]")===I){var t={id:e.getAttribute("data-accordion-target"),triggerEl:e,targetEl:document.querySelector(e.getAttribute("data-accordion-target")),iconEl:e.querySelector("[data-accordion-icon]"),active:e.getAttribute("aria-expanded")==="true"};d.push(t)}}),new D0(d,{alwaysOpen:G==="open",activeClasses:l||hp.activeClasses,inactiveClasses:b||hp.inactiveClasses})})}typeof window<"u"&&(window.Accordion=D0,window.initAccordions=sn);var Vp=function(){return Vp=Object.assign||function(I){for(var G,l=1,b=arguments.length;l<b;l++){G=arguments[l];for(var d in G)Object.prototype.hasOwnProperty.call(G,d)&&(I[d]=G[d])}return I},Vp.apply(this,arguments)},q0={onCollapse:function(){},onExpand:function(){},onToggle:function(){}},_0=function(){function I(G,l,b){G===void 0&&(G=null),l===void 0&&(l=null),b===void 0&&(b=q0),this._targetEl=G,this._triggerEl=l,this._options=Vp(Vp({},q0),b),this._visible=!1,this._init()}return I.prototype._init=function(){var G=this;this._triggerEl&&(this._triggerEl.hasAttribute("aria-expanded")?this._visible=this._triggerEl.getAttribute("aria-expanded")==="true":this._visible=!this._targetEl.classList.contains("hidden"),this._triggerEl.addEventListener("click",function(){G.toggle()}))},I.prototype.collapse=function(){this._targetEl.classList.add("hidden"),this._triggerEl&&this._triggerEl.setAttribute("aria-expanded","false"),this._visible=!1,this._options.onCollapse(this)},I.prototype.expand=function(){this._targetEl.classList.remove("hidden"),this._triggerEl&&this._triggerEl.setAttribute("aria-expanded","true"),this._visible=!0,this._options.onExpand(this)},I.prototype.toggle=function(){this._visible?this.collapse():this.expand(),this._options.onToggle(this)},I}();function Yn(){document.querySelectorAll("[data-collapse-toggle]").forEach(function(I){var G=I.getAttribute("data-collapse-toggle"),l=document.getElementById(G);l?new _0(l,I):console.error('The target element with id "'.concat(G,'" does not exist. Please check the data-collapse-toggle attribute.'))})}typeof window<"u"&&(window.Collapse=_0,window.initCollapses=Yn);var Xa=function(){return Xa=Object.assign||function(I){for(var G,l=1,b=arguments.length;l<b;l++){G=arguments[l];for(var d in G)Object.prototype.hasOwnProperty.call(G,d)&&(I[d]=G[d])}return I},Xa.apply(this,arguments)},pp={defaultPosition:0,indicators:{items:[],activeClasses:"bg-white dark:bg-gray-800",inactiveClasses:"bg-white/50 dark:bg-gray-800/50 hover:bg-white dark:hover:bg-gray-800"},interval:3e3,onNext:function(){},onPrev:function(){},onChange:function(){}},P0=function(){function I(G,l){G===void 0&&(G=[]),l===void 0&&(l=pp),this._items=G,this._options=Xa(Xa(Xa({},pp),l),{indicators:Xa(Xa({},pp.indicators),l.indicators)}),this._activeItem=this.getItem(this._options.defaultPosition),this._indicators=this._options.indicators.items,this._intervalDuration=this._options.interval,this._intervalInstance=null,this._init()}return I.prototype._init=function(){var G=this;this._items.map(function(l){l.el.classList.add("absolute","inset-0","transition-transform","transform")}),this._getActiveItem()?this.slideTo(this._getActiveItem().position):this.slideTo(0),this._indicators.map(function(l,b){l.el.addEventListener("click",function(){G.slideTo(b)})})},I.prototype.getItem=function(G){return this._items[G]},I.prototype.slideTo=function(G){var l=this._items[G],b={left:l.position===0?this._items[this._items.length-1]:this._items[l.position-1],middle:l,right:l.position===this._items.length-1?this._items[0]:this._items[l.position+1]};this._rotate(b),this._setActiveItem(l),this._intervalInstance&&(this.pause(),this.cycle()),this._options.onChange(this)},I.prototype.next=function(){var G=this._getActiveItem(),l=null;G.position===this._items.length-1?l=this._items[0]:l=this._items[G.position+1],this.slideTo(l.position),this._options.onNext(this)},I.prototype.prev=function(){var G=this._getActiveItem(),l=null;G.position===0?l=this._items[this._items.length-1]:l=this._items[G.position-1],this.slideTo(l.position),this._options.onPrev(this)},I.prototype._rotate=function(G){this._items.map(function(l){l.el.classList.add("hidden")}),G.left.el.classList.remove("-translate-x-full","translate-x-full","translate-x-0","hidden","z-20"),G.left.el.classList.add("-translate-x-full","z-10"),G.middle.el.classList.remove("-translate-x-full","translate-x-full","translate-x-0","hidden","z-10"),G.middle.el.classList.add("translate-x-0","z-20"),G.right.el.classList.remove("-translate-x-full","translate-x-full","translate-x-0","hidden","z-20"),G.right.el.classList.add("translate-x-full","z-10")},I.prototype.cycle=function(){var G=this;typeof window<"u"&&(this._intervalInstance=window.setInterval(function(){G.next()},this._intervalDuration))},I.prototype.pause=function(){clearInterval(this._intervalInstance)},I.prototype._getActiveItem=function(){return this._activeItem},I.prototype._setActiveItem=function(G){var l,b,d=this;this._activeItem=G;var e=G.position;this._indicators.length&&(this._indicators.map(function(t){var W,n;t.el.setAttribute("aria-current","false"),(W=t.el.classList).remove.apply(W,d._options.indicators.activeClasses.split(" ")),(n=t.el.classList).add.apply(n,d._options.indicators.inactiveClasses.split(" "))}),(l=this._indicators[e].el.classList).add.apply(l,this._options.indicators.activeClasses.split(" ")),(b=this._indicators[e].el.classList).remove.apply(b,this._options.indicators.inactiveClasses.split(" ")),this._indicators[e].el.setAttribute("aria-current","true"))},I}();function hn(){document.querySelectorAll("[data-carousel]").forEach(function(I){var G=I.getAttribute("data-carousel-interval"),l=I.getAttribute("data-carousel")==="slide",b=[],d=0;I.querySelectorAll("[data-carousel-item]").length&&Array.from(I.querySelectorAll("[data-carousel-item]")).map(function(s,N){b.push({position:N,el:s}),s.getAttribute("data-carousel-item")==="active"&&(d=N)});var e=[];I.querySelectorAll("[data-carousel-slide-to]").length&&Array.from(I.querySelectorAll("[data-carousel-slide-to]")).map(function(s){e.push({position:parseInt(s.getAttribute("data-carousel-slide-to")),el:s})});var t=new P0(b,{defaultPosition:d,indicators:{items:e},interval:G||pp.interval});l&&t.cycle();var W=I.querySelector("[data-carousel-next]"),n=I.querySelector("[data-carousel-prev]");W&&W.addEventListener("click",function(){t.next()}),n&&n.addEventListener("click",function(){t.prev()})})}typeof window<"u"&&(window.Carousel=P0,window.initCarousels=hn);var up=function(){return up=Object.assign||function(I){for(var G,l=1,b=arguments.length;l<b;l++){G=arguments[l];for(var d in G)Object.prototype.hasOwnProperty.call(G,d)&&(I[d]=G[d])}return I},up.apply(this,arguments)},$0={transition:"transition-opacity",duration:300,timing:"ease-out",onHide:function(){}},IQ=function(){function I(G,l,b){G===void 0&&(G=null),l===void 0&&(l=null),b===void 0&&(b=$0),this._targetEl=G,this._triggerEl=l,this._options=up(up({},$0),b),this._init()}return I.prototype._init=function(){var G=this;this._triggerEl&&this._triggerEl.addEventListener("click",function(){G.hide()})},I.prototype.hide=function(){var G=this;this._targetEl.classList.add(this._options.transition,"duration-".concat(this._options.duration),this._options.timing,"opacity-0"),setTimeout(function(){G._targetEl.classList.add("hidden")},this._options.duration),this._options.onHide(this,this._targetEl)},I}();function Vn(){document.querySelectorAll("[data-dismiss-target]").forEach(function(I){var G=I.getAttribute("data-dismiss-target"),l=document.querySelector(G);l?new IQ(l,I):console.error('The dismiss element with id "'.concat(G,'" does not exist. Please check the data-dismiss-target attribute.'))})}typeof window<"u"&&(window.Dismiss=IQ,window.initDismisses=Vn);var Ac="top",$c="bottom",Sc="right",Oc="left",Rp="auto",He=[Ac,$c,Sc,Oc],xZ="start",ia="end",lQ="clippingParents",op="viewport",pn="popper",GQ="reference",yR=He.reduce(function(I,G){return I.concat([G+"-"+xZ,G+"-"+ia])},[]),Fp=[].concat(He,[Rp]).reduce(function(I,G){return I.concat([G,G+"-"+xZ,G+"-"+ia])},[]),SJ="beforeRead",DJ="read",qJ="afterRead",_J="beforeMain",PJ="main",$J="afterMain",IC="beforeWrite",lC="write",GC="afterWrite",cQ=[SJ,DJ,qJ,_J,PJ,$J,IC,lC,GC];function bb(I){return I?(I.nodeName||"").toLowerCase():null}function ic(I){if(I==null)return window;if(I.toString()!=="[object Window]"){var G=I.ownerDocument;return G&&G.defaultView||window}return I}function id(I){var G=ic(I).Element;return I instanceof G||I instanceof Element}function Ib(I){var G=ic(I).HTMLElement;return I instanceof G||I instanceof HTMLElement}function un(I){if(typeof ShadowRoot>"u")return!1;var G=ic(I).ShadowRoot;return I instanceof G||I instanceof ShadowRoot}function cC(I){var G=I.state;Object.keys(G.elements).forEach(function(l){var b=G.styles[l]||{},d=G.attributes[l]||{},e=G.elements[l];!Ib(e)||!bb(e)||(Object.assign(e.style,b),Object.keys(d).forEach(function(t){var W=d[t];W===!1?e.removeAttribute(t):e.setAttribute(t,W===!0?"":W)}))})}function bC(I){var G=I.state,l={popper:{position:G.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(G.elements.popper.style,l.popper),G.styles=l,G.elements.arrow&&Object.assign(G.elements.arrow.style,l.arrow),function(){Object.keys(G.elements).forEach(function(b){var d=G.elements[b],e=G.attributes[b]||{},t=Object.keys(G.styles.hasOwnProperty(b)?G.styles[b]:l[b]),W=t.reduce(function(n,s){return n[s]="",n},{});!Ib(d)||!bb(d)||(Object.assign(d.style,W),Object.keys(e).forEach(function(n){d.removeAttribute(n)}))})}}var bQ={name:"applyStyles",enabled:!0,phase:"write",fn:cC,effect:bC,requires:["computeStyles"]};function db(I){return I.split("-")[0]}var Ud=Math.max,Qa=Math.min,zZ=Math.round;function Rn(){var I=navigator.userAgentData;return I!=null&&I.brands&&Array.isArray(I.brands)?I.brands.map(function(G){return G.brand+"/"+G.version}).join(" "):navigator.userAgent}function TY(){return!/^((?!chrome|android).)*safari/i.test(Rn())}function Qd(I,G,l){G===void 0&&(G=!1),l===void 0&&(l=!1);var b=I.getBoundingClientRect(),d=1,e=1;G&&Ib(I)&&(d=I.offsetWidth>0&&zZ(b.width)/I.offsetWidth||1,e=I.offsetHeight>0&&zZ(b.height)/I.offsetHeight||1);var t=id(I)?ic(I):window,W=t.visualViewport,n=!TY()&&l,s=(b.left+(n&&W?W.offsetLeft:0))/d,N=(b.top+(n&&W?W.offsetTop:0))/e,m=b.width/d,h=b.height/e;return{width:m,height:h,top:N,right:s+m,bottom:N+h,left:s,x:s,y:N}}function Ha(I){var G=Qd(I),l=I.offsetWidth,b=I.offsetHeight;return Math.abs(G.width-l)<=1&&(l=G.width),Math.abs(G.height-b)<=1&&(b=G.height),{x:I.offsetLeft,y:I.offsetTop,width:l,height:b}}function fY(I,G){var l=G.getRootNode&&G.getRootNode();if(I.contains(G))return!0;if(l&&un(l)){var b=G;do{if(b&&I.isSameNode(b))return!0;b=b.parentNode||b.host}while(b)}return!1}function Eb(I){return ic(I).getComputedStyle(I)}function gR(I){return["table","td","th"].indexOf(bb(I))>=0}function nb(I){return((id(I)?I.ownerDocument:I.document)||window.document).documentElement}function UZ(I){return bb(I)==="html"?I:I.assignedSlot||I.parentNode||(un(I)?I.host:null)||nb(I)}function dQ(I){return!Ib(I)||Eb(I).position==="fixed"?null:I.offsetParent}function dC(I){var G=/firefox/i.test(Rn()),l=/Trident/i.test(Rn());if(l&&Ib(I)){var b=Eb(I);if(b.position==="fixed")return null}var d=UZ(I);for(un(d)&&(d=d.host);Ib(d)&&["html","body"].indexOf(bb(d))<0;){var e=Eb(d);if(e.transform!=="none"||e.perspective!=="none"||e.contain==="paint"||["transform","perspective"].indexOf(e.willChange)!==-1||G&&e.willChange==="filter"||G&&e.filter&&e.filter!=="none")return d;d=d.parentNode}return null}function Md(I){for(var G=ic(I),l=dQ(I);l&&gR(l)&&Eb(l).position==="static";)l=dQ(l);return l&&(bb(l)==="html"||bb(l)==="body"&&Eb(l).position==="static")?G:l||dC(I)||G}function ra(I){return["top","bottom"].indexOf(I)>=0?"x":"y"}function wa(I,G,l){return Ud(I,Qa(G,l))}function ZQ(I,G,l){var b=wa(I,G,l);return b>l?l:b}function SY(){return{top:0,right:0,bottom:0,left:0}}function DY(I){return Object.assign({},SY(),I)}function qY(I,G){return G.reduce(function(l,b){return l[b]=I,l},{})}var ZC=function(G,l){return G=typeof G=="function"?G(Object.assign({},l.rects,{placement:l.placement})):G,DY(typeof G!="number"?G:qY(G,He))};function eC(I){var G,l=I.state,b=I.name,d=I.options,e=l.elements.arrow,t=l.modifiersData.popperOffsets,W=db(l.placement),n=ra(W),s=[Oc,Sc].indexOf(W)>=0,N=s?"height":"width";if(!(!e||!t)){var m=ZC(d.padding,l),h=Ha(e),V=n==="y"?Ac:Oc,X=n==="y"?$c:Sc,p=l.rects.reference[N]+l.rects.reference[n]-t[n]-l.rects.popper[N],F=t[n]-l.rects.reference[n],a=Md(e),u=a?n==="y"?a.clientHeight||0:a.clientWidth||0:0,Q=p/2-F/2,o=m[V],y=u-h[N]-m[X],H=u/2-h[N]/2+Q,E=wa(o,H,y),C=n;l.modifiersData[b]=(G={},G[C]=E,G.centerOffset=E-H,G)}}function aC(I){var G=I.state,l=I.options,b=l.element,d=b===void 0?"[data-popper-arrow]":b;d!=null&&(typeof d=="string"&&(d=G.elements.popper.querySelector(d),!d)||fY(G.elements.popper,d)&&(G.elements.arrow=d))}var eQ={name:"arrow",enabled:!0,phase:"main",fn:eC,effect:aC,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Hd(I){return I.split("-")[1]}var WC={top:"auto",right:"auto",bottom:"auto",left:"auto"};function tC(I,G){var l=I.x,b=I.y,d=G.devicePixelRatio||1;return{x:zZ(l*d)/d||0,y:zZ(b*d)/d||0}}function aQ(I){var G,l=I.popper,b=I.popperRect,d=I.placement,e=I.variation,t=I.offsets,W=I.position,n=I.gpuAcceleration,s=I.adaptive,N=I.roundOffsets,m=I.isFixed,h=t.x,V=h===void 0?0:h,X=t.y,p=X===void 0?0:X,F=typeof N=="function"?N({x:V,y:p}):{x:V,y:p};V=F.x,p=F.y;var a=t.hasOwnProperty("x"),u=t.hasOwnProperty("y"),Q=Oc,o=Ac,y=window;if(s){var H=Md(l),E="clientHeight",C="clientWidth";if(H===ic(l)&&(H=nb(l),Eb(H).position!=="static"&&W==="absolute"&&(E="scrollHeight",C="scrollWidth")),H=H,d===Ac||(d===Oc||d===Sc)&&e===ia){o=$c;var T=m&&H===y&&y.visualViewport?y.visualViewport.height:H[E];p-=T-b.height,p*=n?1:-1}if(d===Oc||(d===Ac||d===$c)&&e===ia){Q=Sc;var S=m&&H===y&&y.visualViewport?y.visualViewport.width:H[C];V-=S-b.width,V*=n?1:-1}}var cI=Object.assign({position:W},s&&WC),hI=N===!0?tC({x:V,y:p},ic(l)):{x:V,y:p};if(V=hI.x,p=hI.y,n){var WI;return Object.assign({},cI,(WI={},WI[o]=u?"0":"",WI[Q]=a?"0":"",WI.transform=(y.devicePixelRatio||1)<=1?"translate("+V+"px, "+p+"px)":"translate3d("+V+"px, "+p+"px, 0)",WI))}return Object.assign({},cI,(G={},G[o]=u?p+"px":"",G[Q]=a?V+"px":"",G.transform="",G))}function nC(I){var G=I.state,l=I.options,b=l.gpuAcceleration,d=b===void 0?!0:b,e=l.adaptive,t=e===void 0?!0:e,W=l.roundOffsets,n=W===void 0?!0:W,s={placement:db(G.placement),variation:Hd(G.placement),popper:G.elements.popper,popperRect:G.rects.popper,gpuAcceleration:d,isFixed:G.options.strategy==="fixed"};G.modifiersData.popperOffsets!=null&&(G.styles.popper=Object.assign({},G.styles.popper,aQ(Object.assign({},s,{offsets:G.modifiersData.popperOffsets,position:G.options.strategy,adaptive:t,roundOffsets:n})))),G.modifiersData.arrow!=null&&(G.styles.arrow=Object.assign({},G.styles.arrow,aQ(Object.assign({},s,{offsets:G.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:n})))),G.attributes.popper=Object.assign({},G.attributes.popper,{"data-popper-placement":G.placement})}var WQ={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:nC,data:{}};var Xp={passive:!0};function mC(I){var G=I.state,l=I.instance,b=I.options,d=b.scroll,e=d===void 0?!0:d,t=b.resize,W=t===void 0?!0:t,n=ic(G.elements.popper),s=[].concat(G.scrollParents.reference,G.scrollParents.popper);return e&&s.forEach(function(N){N.addEventListener("scroll",l.update,Xp)}),W&&n.addEventListener("resize",l.update,Xp),function(){e&&s.forEach(function(N){N.removeEventListener("scroll",l.update,Xp)}),W&&n.removeEventListener("resize",l.update,Xp)}}var tQ={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:mC,data:{}};var NC={left:"right",right:"left",bottom:"top",top:"bottom"};function on(I){return I.replace(/left|right|bottom|top/g,function(G){return NC[G]})}var sC={start:"end",end:"start"};function ip(I){return I.replace(/start|end/g,function(G){return sC[G]})}function va(I){var G=ic(I),l=G.pageXOffset,b=G.pageYOffset;return{scrollLeft:l,scrollTop:b}}function Ea(I){return Qd(nb(I)).left+va(I).scrollLeft}function JR(I,G){var l=ic(I),b=nb(I),d=l.visualViewport,e=b.clientWidth,t=b.clientHeight,W=0,n=0;if(d){e=d.width,t=d.height;var s=TY();(s||!s&&G==="fixed")&&(W=d.offsetLeft,n=d.offsetTop)}return{width:e,height:t,x:W+Ea(I),y:n}}function CR(I){var G,l=nb(I),b=va(I),d=(G=I.ownerDocument)==null?void 0:G.body,e=Ud(l.scrollWidth,l.clientWidth,d?d.scrollWidth:0,d?d.clientWidth:0),t=Ud(l.scrollHeight,l.clientHeight,d?d.scrollHeight:0,d?d.clientHeight:0),W=-b.scrollLeft+Ea(I),n=-b.scrollTop;return Eb(d||l).direction==="rtl"&&(W+=Ud(l.clientWidth,d?d.clientWidth:0)-e),{width:e,height:t,x:W,y:n}}function ya(I){var G=Eb(I),l=G.overflow,b=G.overflowX,d=G.overflowY;return/auto|scroll|overlay|hidden/.test(l+d+b)}function Qp(I){return["html","body","#document"].indexOf(bb(I))>=0?I.ownerDocument.body:Ib(I)&&ya(I)?I:Qp(UZ(I))}function re(I,G){var l;G===void 0&&(G=[]);var b=Qp(I),d=b===((l=I.ownerDocument)==null?void 0:l.body),e=ic(b),t=d?[e].concat(e.visualViewport||[],ya(b)?b:[]):b,W=G.concat(t);return d?W:W.concat(re(UZ(t)))}function Fn(I){return Object.assign({},I,{left:I.x,top:I.y,right:I.x+I.width,bottom:I.y+I.height})}function YC(I,G){var l=Qd(I,!1,G==="fixed");return l.top=l.top+I.clientTop,l.left=l.left+I.clientLeft,l.bottom=l.top+I.clientHeight,l.right=l.left+I.clientWidth,l.width=I.clientWidth,l.height=I.clientHeight,l.x=l.left,l.y=l.top,l}function nQ(I,G,l){return G===op?Fn(JR(I,l)):id(G)?YC(G,l):Fn(CR(nb(I)))}function hC(I){var G=re(UZ(I)),l=["absolute","fixed"].indexOf(Eb(I).position)>=0,b=l&&Ib(I)?Md(I):I;return id(b)?G.filter(function(d){return id(d)&&fY(d,b)&&bb(d)!=="body"}):[]}function AR(I,G,l,b){var d=G==="clippingParents"?hC(I):[].concat(G),e=[].concat(d,[l]),t=e[0],W=e.reduce(function(n,s){var N=nQ(I,s,b);return n.top=Ud(N.top,n.top),n.right=Qa(N.right,n.right),n.bottom=Qa(N.bottom,n.bottom),n.left=Ud(N.left,n.left),n},nQ(I,t,b));return W.width=W.right-W.left,W.height=W.bottom-W.top,W.x=W.left,W.y=W.top,W}function _Y(I){var G=I.reference,l=I.element,b=I.placement,d=b?db(b):null,e=b?Hd(b):null,t=G.x+G.width/2-l.width/2,W=G.y+G.height/2-l.height/2,n;switch(d){case Ac:n={x:t,y:G.y-l.height};break;case $c:n={x:t,y:G.y+G.height};break;case Sc:n={x:G.x+G.width,y:W};break;case Oc:n={x:G.x-l.width,y:W};break;default:n={x:G.x,y:G.y}}var s=d?ra(d):null;if(s!=null){var N=s==="y"?"height":"width";switch(e){case xZ:n[s]=n[s]-(G[N]/2-l[N]/2);break;case ia:n[s]=n[s]+(G[N]/2-l[N]/2);break;default:}}return n}function Bd(I,G){G===void 0&&(G={});var l=G,b=l.placement,d=b===void 0?I.placement:b,e=l.strategy,t=e===void 0?I.strategy:e,W=l.boundary,n=W===void 0?lQ:W,s=l.rootBoundary,N=s===void 0?op:s,m=l.elementContext,h=m===void 0?pn:m,V=l.altBoundary,X=V===void 0?!1:V,p=l.padding,F=p===void 0?0:p,a=DY(typeof F!="number"?F:qY(F,He)),u=h===pn?GQ:pn,Q=I.rects.popper,o=I.elements[X?u:h],y=AR(id(o)?o:o.contextElement||nb(I.elements.popper),n,N,t),H=Qd(I.elements.reference),E=_Y({reference:H,element:Q,strategy:"absolute",placement:d}),C=Fn(Object.assign({},Q,E)),T=h===pn?C:H,S={top:y.top-T.top+a.top,bottom:T.bottom-y.bottom+a.bottom,left:y.left-T.left+a.left,right:T.right-y.right+a.right},cI=I.modifiersData.offset;if(h===pn&&cI){var hI=cI[d];Object.keys(S).forEach(function(WI){var VI=[Sc,$c].indexOf(WI)>=0?1:-1,sI=[Ac,$c].indexOf(WI)>=0?"y":"x";S[WI]+=hI[sI]*VI})}return S}function LR(I,G){G===void 0&&(G={});var l=G,b=l.placement,d=l.boundary,e=l.rootBoundary,t=l.padding,W=l.flipVariations,n=l.allowedAutoPlacements,s=n===void 0?Fp:n,N=Hd(b),m=N?W?yR:yR.filter(function(X){return Hd(X)===N}):He,h=m.filter(function(X){return s.indexOf(X)>=0});h.length===0&&(h=m);var V=h.reduce(function(X,p){return X[p]=Bd(I,{placement:p,boundary:d,rootBoundary:e,padding:t})[db(p)],X},{});return Object.keys(V).sort(function(X,p){return V[X]-V[p]})}function VC(I){if(db(I)===Rp)return[];var G=on(I);return[ip(I),G,ip(G)]}function pC(I){var G=I.state,l=I.options,b=I.name;if(!G.modifiersData[b]._skip){for(var d=l.mainAxis,e=d===void 0?!0:d,t=l.altAxis,W=t===void 0?!0:t,n=l.fallbackPlacements,s=l.padding,N=l.boundary,m=l.rootBoundary,h=l.altBoundary,V=l.flipVariations,X=V===void 0?!0:V,p=l.allowedAutoPlacements,F=G.options.placement,a=db(F),u=a===F,Q=n||(u||!X?[on(F)]:VC(F)),o=[F].concat(Q).reduce(function(JI,UI){return JI.concat(db(UI)===Rp?LR(G,{placement:UI,boundary:N,rootBoundary:m,padding:s,flipVariations:X,allowedAutoPlacements:p}):UI)},[]),y=G.rects.reference,H=G.rects.popper,E=new Map,C=!0,T=o[0],S=0;S<o.length;S++){var cI=o[S],hI=db(cI),WI=Hd(cI)===xZ,VI=[Ac,$c].indexOf(hI)>=0,sI=VI?"width":"height",ZI=Bd(G,{placement:cI,boundary:N,rootBoundary:m,altBoundary:h,padding:s}),dI=VI?WI?Sc:Oc:WI?$c:Ac;y[sI]>H[sI]&&(dI=on(dI));var pI=on(dI),yI=[];if(e&&yI.push(ZI[hI]<=0),W&&yI.push(ZI[dI]<=0,ZI[pI]<=0),yI.every(function(JI){return JI})){T=cI,C=!1;break}E.set(cI,yI)}if(C)for(var eI=X?3:1,HI=function(UI){var zI=o.find(function(L){var bI=E.get(L);if(bI)return bI.slice(0,UI).every(function(FI){return FI})});if(zI)return T=zI,"break"},YI=eI;YI>0;YI--){var $=HI(YI);if($==="break")break}G.placement!==T&&(G.modifiersData[b]._skip=!0,G.placement=T,G.reset=!0)}}var mQ={name:"flip",enabled:!0,phase:"main",fn:pC,requiresIfExists:["offset"],data:{_skip:!1}};function NQ(I,G,l){return l===void 0&&(l={x:0,y:0}),{top:I.top-G.height-l.y,right:I.right-G.width+l.x,bottom:I.bottom-G.height+l.y,left:I.left-G.width-l.x}}function sQ(I){return[Ac,Sc,$c,Oc].some(function(G){return I[G]>=0})}function uC(I){var G=I.state,l=I.name,b=G.rects.reference,d=G.rects.popper,e=G.modifiersData.preventOverflow,t=Bd(G,{elementContext:"reference"}),W=Bd(G,{altBoundary:!0}),n=NQ(t,b),s=NQ(W,d,e),N=sQ(n),m=sQ(s);G.modifiersData[l]={referenceClippingOffsets:n,popperEscapeOffsets:s,isReferenceHidden:N,hasPopperEscaped:m},G.attributes.popper=Object.assign({},G.attributes.popper,{"data-popper-reference-hidden":N,"data-popper-escaped":m})}var YQ={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:uC};function RC(I,G,l){var b=db(I),d=[Oc,Ac].indexOf(b)>=0?-1:1,e=typeof l=="function"?l(Object.assign({},G,{placement:I})):l,t=e[0],W=e[1];return t=t||0,W=(W||0)*d,[Oc,Sc].indexOf(b)>=0?{x:W,y:t}:{x:t,y:W}}function oC(I){var G=I.state,l=I.options,b=I.name,d=l.offset,e=d===void 0?[0,0]:d,t=Fp.reduce(function(N,m){return N[m]=RC(m,G.rects,e),N},{}),W=t[G.placement],n=W.x,s=W.y;G.modifiersData.popperOffsets!=null&&(G.modifiersData.popperOffsets.x+=n,G.modifiersData.popperOffsets.y+=s),G.modifiersData[b]=t}var hQ={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:oC};function FC(I){var G=I.state,l=I.name;G.modifiersData[l]=_Y({reference:G.rects.reference,element:G.rects.popper,strategy:"absolute",placement:G.placement})}var VQ={name:"popperOffsets",enabled:!0,phase:"read",fn:FC,data:{}};function kR(I){return I==="x"?"y":"x"}function XC(I){var G=I.state,l=I.options,b=I.name,d=l.mainAxis,e=d===void 0?!0:d,t=l.altAxis,W=t===void 0?!1:t,n=l.boundary,s=l.rootBoundary,N=l.altBoundary,m=l.padding,h=l.tether,V=h===void 0?!0:h,X=l.tetherOffset,p=X===void 0?0:X,F=Bd(G,{boundary:n,rootBoundary:s,padding:m,altBoundary:N}),a=db(G.placement),u=Hd(G.placement),Q=!u,o=ra(a),y=kR(o),H=G.modifiersData.popperOffsets,E=G.rects.reference,C=G.rects.popper,T=typeof p=="function"?p(Object.assign({},G.rects,{placement:G.placement})):p,S=typeof T=="number"?{mainAxis:T,altAxis:T}:Object.assign({mainAxis:0,altAxis:0},T),cI=G.modifiersData.offset?G.modifiersData.offset[G.placement]:null,hI={x:0,y:0};if(H){if(e){var WI,VI=o==="y"?Ac:Oc,sI=o==="y"?$c:Sc,ZI=o==="y"?"height":"width",dI=H[o],pI=dI+F[VI],yI=dI-F[sI],eI=V?-C[ZI]/2:0,HI=u===xZ?E[ZI]:C[ZI],YI=u===xZ?-C[ZI]:-E[ZI],$=G.elements.arrow,JI=V&&$?Ha($):{width:0,height:0},UI=G.modifiersData["arrow#persistent"]?G.modifiersData["arrow#persistent"].padding:SY(),zI=UI[VI],L=UI[sI],bI=wa(0,E[ZI],JI[ZI]),FI=Q?E[ZI]/2-eI-bI-zI-S.mainAxis:HI-bI-zI-S.mainAxis,U=Q?-E[ZI]/2+eI+bI+L+S.mainAxis:YI+bI+L+S.mainAxis,k=G.elements.arrow&&Md(G.elements.arrow),w=k?o==="y"?k.clientTop||0:k.clientLeft||0:0,r=(WI=cI?.[o])!=null?WI:0,A=dI+FI-r-w,O=dI+U-r,K=wa(V?Qa(pI,A):pI,dI,V?Ud(yI,O):yI);H[o]=K,hI[o]=K-dI}if(W){var q,GI=o==="x"?Ac:Oc,tI=o==="x"?$c:Sc,iI=H[y],B=y==="y"?"height":"width",aI=iI+F[GI],lI=iI-F[tI],QI=[Ac,Oc].indexOf(a)!==-1,vI=(q=cI?.[y])!=null?q:0,OI=QI?aI:iI-E[B]-C[B]-vI+S.altAxis,uI=QI?iI+E[B]+C[B]-vI-S.altAxis:lI,wI=V&&QI?ZQ(OI,iI,uI):wa(V?OI:aI,iI,V?uI:lI);H[y]=wI,hI[y]=wI-iI}G.modifiersData[b]=hI}}var pQ={name:"preventOverflow",enabled:!0,phase:"main",fn:XC,requiresIfExists:["offset"]};function xR(I){return{scrollLeft:I.scrollLeft,scrollTop:I.scrollTop}}function zR(I){return I===ic(I)||!Ib(I)?va(I):xR(I)}function iC(I){var G=I.getBoundingClientRect(),l=zZ(G.width)/I.offsetWidth||1,b=zZ(G.height)/I.offsetHeight||1;return l!==1||b!==1}function UR(I,G,l){l===void 0&&(l=!1);var b=Ib(G),d=Ib(G)&&iC(G),e=nb(G),t=Qd(I,d,l),W={scrollLeft:0,scrollTop:0},n={x:0,y:0};return(b||!b&&!l)&&((bb(G)!=="body"||ya(e))&&(W=zR(G)),Ib(G)?(n=Qd(G,!0),n.x+=G.clientLeft,n.y+=G.clientTop):e&&(n.x=Ea(e))),{x:t.left+W.scrollLeft-n.x,y:t.top+W.scrollTop-n.y,width:t.width,height:t.height}}function QC(I){var G=new Map,l=new Set,b=[];I.forEach(function(e){G.set(e.name,e)});function d(e){l.add(e.name);var t=[].concat(e.requires||[],e.requiresIfExists||[]);t.forEach(function(W){if(!l.has(W)){var n=G.get(W);n&&d(n)}}),b.push(e)}return I.forEach(function(e){l.has(e.name)||d(e)}),b}function MR(I){var G=QC(I);return cQ.reduce(function(l,b){return l.concat(G.filter(function(d){return d.phase===b}))},[])}function BR(I){var G;return function(){return G||(G=new Promise(function(l){Promise.resolve().then(function(){G=void 0,l(I())})})),G}}function OR(I){var G=I.reduce(function(l,b){var d=l[b.name];return l[b.name]=d?Object.assign({},d,b,{options:Object.assign({},d.options,b.options),data:Object.assign({},d.data,b.data)}):b,l},{});return Object.keys(G).map(function(l){return G[l]})}var uQ={placement:"bottom",modifiers:[],strategy:"absolute"};function RQ(){for(var I=arguments.length,G=new Array(I),l=0;l<I;l++)G[l]=arguments[l];return!G.some(function(b){return!(b&&typeof b.getBoundingClientRect=="function")})}function oQ(I){I===void 0&&(I={});var G=I,l=G.defaultModifiers,b=l===void 0?[]:l,d=G.defaultOptions,e=d===void 0?uQ:d;return function(W,n,s){s===void 0&&(s=e);var N={placement:"bottom",orderedModifiers:[],options:Object.assign({},uQ,e),modifiersData:{},elements:{reference:W,popper:n},attributes:{},styles:{}},m=[],h=!1,V={state:N,setOptions:function(a){var u=typeof a=="function"?a(N.options):a;p(),N.options=Object.assign({},e,N.options,u),N.scrollParents={reference:id(W)?re(W):W.contextElement?re(W.contextElement):[],popper:re(n)};var Q=MR(OR([].concat(b,N.options.modifiers)));return N.orderedModifiers=Q.filter(function(o){return o.enabled}),X(),V.update()},forceUpdate:function(){if(!h){var a=N.elements,u=a.reference,Q=a.popper;if(RQ(u,Q)){N.rects={reference:UR(u,Md(Q),N.options.strategy==="fixed"),popper:Ha(Q)},N.reset=!1,N.placement=N.options.placement,N.orderedModifiers.forEach(function(S){return N.modifiersData[S.name]=Object.assign({},S.data)});for(var o=0;o<N.orderedModifiers.length;o++){if(N.reset===!0){N.reset=!1,o=-1;continue}var y=N.orderedModifiers[o],H=y.fn,E=y.options,C=E===void 0?{}:E,T=y.name;typeof H=="function"&&(N=H({state:N,options:C,name:T,instance:V})||N)}}}},update:BR(function(){return new Promise(function(F){V.forceUpdate(),F(N)})}),destroy:function(){p(),h=!0}};if(!RQ(W,n))return V;V.setOptions(s).then(function(F){!h&&s.onFirstUpdate&&s.onFirstUpdate(F)});function X(){N.orderedModifiers.forEach(function(F){var a=F.name,u=F.options,Q=u===void 0?{}:u,o=F.effect;if(typeof o=="function"){var y=o({state:N,name:a,instance:V,options:Q}),H=function(){};m.push(y||H)}})}function p(){m.forEach(function(F){return F()}),m=[]}return V}}var HC=[tQ,VQ,WQ,bQ,hQ,mQ,pQ,eQ,YQ],ga=oQ({defaultModifiers:HC});var we=function(){return we=Object.assign||function(I){for(var G,l=1,b=arguments.length;l<b;l++){G=arguments[l];for(var d in G)Object.prototype.hasOwnProperty.call(G,d)&&(I[d]=G[d])}return I},we.apply(this,arguments)},Hp=function(I,G,l){if(l||arguments.length===2)for(var b=0,d=G.length,e;b<d;b++)(e||!(b in G))&&(e||(e=Array.prototype.slice.call(G,0,b)),e[b]=G[b]);return I.concat(e||Array.prototype.slice.call(G))},ve={placement:"bottom",triggerType:"click",offsetSkidding:0,offsetDistance:10,delay:300,ignoreClickOutsideClass:!1,onShow:function(){},onHide:function(){},onToggle:function(){}},FQ=function(){function I(G,l,b){G===void 0&&(G=null),l===void 0&&(l=null),b===void 0&&(b=ve),this._targetEl=G,this._triggerEl=l,this._options=we(we({},ve),b),this._popperInstance=this._createPopperInstance(),this._visible=!1,this._init()}return I.prototype._init=function(){this._triggerEl&&this._setupEventListeners()},I.prototype._setupEventListeners=function(){var G=this,l=this._getTriggerEvents();this._options.triggerType==="click"&&l.showEvents.forEach(function(b){G._triggerEl.addEventListener(b,function(){G.toggle()})}),this._options.triggerType==="hover"&&(l.showEvents.forEach(function(b){G._triggerEl.addEventListener(b,function(){b==="click"?G.toggle():setTimeout(function(){G.show()},G._options.delay)}),G._targetEl.addEventListener(b,function(){G.show()})}),l.hideEvents.forEach(function(b){G._triggerEl.addEventListener(b,function(){setTimeout(function(){G._targetEl.matches(":hover")||G.hide()},G._options.delay)}),G._targetEl.addEventListener(b,function(){setTimeout(function(){G._triggerEl.matches(":hover")||G.hide()},G._options.delay)})}))},I.prototype._createPopperInstance=function(){return ga(this._triggerEl,this._targetEl,{placement:this._options.placement,modifiers:[{name:"offset",options:{offset:[this._options.offsetSkidding,this._options.offsetDistance]}}]})},I.prototype._setupClickOutsideListener=function(){var G=this;this._clickOutsideEventListener=function(l){G._handleClickOutside(l,G._targetEl)},document.body.addEventListener("click",this._clickOutsideEventListener,!0)},I.prototype._removeClickOutsideListener=function(){document.body.removeEventListener("click",this._clickOutsideEventListener,!0)},I.prototype._handleClickOutside=function(G,l){var b=G.target,d=this._options.ignoreClickOutsideClass,e=!1;if(d){var t=document.querySelectorAll(".".concat(d));t.forEach(function(W){if(W.contains(b)){e=!0;return}})}b!==l&&!l.contains(b)&&!this._triggerEl.contains(b)&&!e&&this.isVisible()&&this.hide()},I.prototype._getTriggerEvents=function(){switch(this._options.triggerType){case"hover":return{showEvents:["mouseenter","click"],hideEvents:["mouseleave"]};case"click":return{showEvents:["click"],hideEvents:[]};case"none":return{showEvents:[],hideEvents:[]};default:return{showEvents:["click"],hideEvents:[]}}},I.prototype.toggle=function(){this.isVisible()?this.hide():this.show(),this._options.onToggle(this)},I.prototype.isVisible=function(){return this._visible},I.prototype.show=function(){this._targetEl.classList.remove("hidden"),this._targetEl.classList.add("block"),this._popperInstance.setOptions(function(G){return we(we({},G),{modifiers:Hp(Hp([],G.modifiers,!0),[{name:"eventListeners",enabled:!0}],!1)})}),this._setupClickOutsideListener(),this._popperInstance.update(),this._visible=!0,this._options.onShow(this)},I.prototype.hide=function(){this._targetEl.classList.remove("block"),this._targetEl.classList.add("hidden"),this._popperInstance.setOptions(function(G){return we(we({},G),{modifiers:Hp(Hp([],G.modifiers,!0),[{name:"eventListeners",enabled:!1}],!1)})}),this._visible=!1,this._removeClickOutsideListener(),this._options.onHide(this)},I}();function Xn(){document.querySelectorAll("[data-dropdown-toggle]").forEach(function(I){var G=I.getAttribute("data-dropdown-toggle"),l=document.getElementById(G);if(l){var b=I.getAttribute("data-dropdown-placement"),d=I.getAttribute("data-dropdown-offset-skidding"),e=I.getAttribute("data-dropdown-offset-distance"),t=I.getAttribute("data-dropdown-trigger"),W=I.getAttribute("data-dropdown-delay"),n=I.getAttribute("data-dropdown-ignore-click-outside-class");new FQ(l,I,{placement:b||ve.placement,triggerType:t||ve.triggerType,offsetSkidding:d?parseInt(d):ve.offsetSkidding,offsetDistance:e?parseInt(e):ve.offsetDistance,delay:W?parseInt(W):ve.delay,ignoreClickOutsideClass:n||ve.ignoreClickOutsideClass})}else console.error('The dropdown element with id "'.concat(G,'" does not exist. Please check the data-dropdown-toggle attribute.'))})}typeof window<"u"&&(window.Dropdown=FQ,window.initDropdowns=Xn);var wp=function(){return wp=Object.assign||function(I){for(var G,l=1,b=arguments.length;l<b;l++){G=arguments[l];for(var d in G)Object.prototype.hasOwnProperty.call(G,d)&&(I[d]=G[d])}return I},wp.apply(this,arguments)},Qn={placement:"center",backdropClasses:"bg-gray-900 bg-opacity-50 dark:bg-opacity-80 fixed inset-0 z-40",backdrop:"dynamic",closable:!0,onHide:function(){},onShow:function(){},onToggle:function(){}},jR=function(){function I(G,l){G===void 0&&(G=null),l===void 0&&(l=Qn),this._targetEl=G,this._options=wp(wp({},Qn),l),this._isHidden=!0,this._backdropEl=null,this._init()}return I.prototype._init=function(){var G=this;this._targetEl&&this._getPlacementClasses().map(function(l){G._targetEl.classList.add(l)})},I.prototype._createBackdrop=function(){var G;if(this._isHidden){var l=document.createElement("div");l.setAttribute("modal-backdrop",""),(G=l.classList).add.apply(G,this._options.backdropClasses.split(" ")),document.querySelector("body").append(l),this._backdropEl=l}},I.prototype._destroyBackdropEl=function(){this._isHidden||document.querySelector("[modal-backdrop]").remove()},I.prototype._setupModalCloseEventListeners=function(){var G=this;this._options.backdrop==="dynamic"&&(this._clickOutsideEventListener=function(l){G._handleOutsideClick(l.target)},this._targetEl.addEventListener("click",this._clickOutsideEventListener,!0)),this._keydownEventListener=function(l){l.key==="Escape"&&G.hide()},document.body.addEventListener("keydown",this._keydownEventListener,!0)},I.prototype._removeModalCloseEventListeners=function(){this._options.backdrop==="dynamic"&&this._targetEl.removeEventListener("click",this._clickOutsideEventListener,!0),document.body.removeEventListener("keydown",this._keydownEventListener,!0)},I.prototype._handleOutsideClick=function(G){(G===this._targetEl||G===this._backdropEl&&this.isVisible())&&this.hide()},I.prototype._getPlacementClasses=function(){switch(this._options.placement){case"top-left":return["justify-start","items-start"];case"top-center":return["justify-center","items-start"];case"top-right":return["justify-end","items-start"];case"center-left":return["justify-start","items-center"];case"center":return["justify-center","items-center"];case"center-right":return["justify-end","items-center"];case"bottom-left":return["justify-start","items-end"];case"bottom-center":return["justify-center","items-end"];case"bottom-right":return["justify-end","items-end"];default:return["justify-center","items-center"]}},I.prototype.toggle=function(){this._isHidden?this.show():this.hide(),this._options.onToggle(this)},I.prototype.show=function(){this.isHidden&&(this._targetEl.classList.add("flex"),this._targetEl.classList.remove("hidden"),this._targetEl.setAttribute("aria-modal","true"),this._targetEl.setAttribute("role","dialog"),this._targetEl.removeAttribute("aria-hidden"),this._createBackdrop(),this._isHidden=!1,document.body.classList.add("overflow-hidden"),this._options.closable&&this._setupModalCloseEventListeners(),this._options.onShow(this))},I.prototype.hide=function(){this.isVisible&&(this._targetEl.classList.add("hidden"),this._targetEl.classList.remove("flex"),this._targetEl.setAttribute("aria-hidden","true"),this._targetEl.removeAttribute("aria-modal"),this._targetEl.removeAttribute("role"),this._destroyBackdropEl(),this._isHidden=!0,document.body.classList.remove("overflow-hidden"),this._options.closable&&this._removeModalCloseEventListeners(),this._options.onHide(this))},I.prototype.isVisible=function(){return!this._isHidden},I.prototype.isHidden=function(){return this._isHidden},I}(),rp=function(I,G){return G.some(function(l){return l.id===I})?G.find(function(l){return l.id===I}):null};function Hn(){var I=[];document.querySelectorAll("[data-modal-target]").forEach(function(G){var l=G.getAttribute("data-modal-target"),b=document.getElementById(l);if(b){var d=b.getAttribute("data-modal-placement"),e=b.getAttribute("data-modal-backdrop");rp(l,I)||I.push({id:l,object:new jR(b,{placement:d||Qn.placement,backdrop:e||Qn.backdrop})})}else console.error("Modal with id ".concat(l," does not exist. Are you sure that the data-modal-target attribute points to the correct modal id?."))}),document.querySelectorAll("[data-modal-toggle]").forEach(function(G){var l=G.getAttribute("data-modal-toggle"),b=document.getElementById(l);if(b){var d=b.getAttribute("data-modal-placement"),e=b.getAttribute("data-modal-backdrop"),t=rp(l,I);t||(t={id:l,object:new jR(b,{placement:d||Qn.placement,backdrop:e||Qn.backdrop})},I.push(t)),G.addEventListener("click",function(){t.object.toggle()})}else console.error("Modal with id ".concat(l," does not exist. Are you sure that the data-modal-toggle attribute points to the correct modal id?"))}),document.querySelectorAll("[data-modal-show]").forEach(function(G){var l=G.getAttribute("data-modal-show"),b=document.getElementById(l);if(b){var d=rp(l,I);d?G.addEventListener("click",function(){d.object.isHidden&&d.object.show()}):console.error("Modal with id ".concat(l," has not been initialized. Please initialize it using the data-modal-target attribute."))}else console.error("Modal with id ".concat(l," does not exist. Are you sure that the data-modal-show attribute points to the correct modal id?"))}),document.querySelectorAll("[data-modal-hide]").forEach(function(G){var l=G.getAttribute("data-modal-hide"),b=document.getElementById(l);if(b){var d=rp(l,I);d?G.addEventListener("click",function(){d.object.isVisible&&d.object.hide()}):console.error("Modal with id ".concat(l," has not been initialized. Please initialize it using the data-modal-target attribute."))}else console.error("Modal with id ".concat(l," does not exist. Are you sure that the data-modal-hide attribute points to the correct modal id?"))})}typeof window<"u"&&(window.Modal=jR,window.initModals=Hn);var Ep=function(){return Ep=Object.assign||function(I){for(var G,l=1,b=arguments.length;l<b;l++){G=arguments[l];for(var d in G)Object.prototype.hasOwnProperty.call(G,d)&&(I[d]=G[d])}return I},Ep.apply(this,arguments)},Ja={placement:"left",bodyScrolling:!1,backdrop:!0,edge:!1,edgeOffset:"bottom-[60px]",backdropClasses:"bg-gray-900 bg-opacity-50 dark:bg-opacity-80 fixed inset-0 z-30",onShow:function(){},onHide:function(){},onToggle:function(){}},XQ=function(){function I(G,l){G===void 0&&(G=null),l===void 0&&(l=Ja),this._targetEl=G,this._options=Ep(Ep({},Ja),l),this._visible=!1,this._init()}return I.prototype._init=function(){var G=this;this._targetEl&&(this._targetEl.setAttribute("aria-hidden","true"),this._targetEl.classList.add("transition-transform")),this._getPlacementClasses(this._options.placement).base.map(function(l){G._targetEl.classList.add(l)}),document.addEventListener("keydown",function(l){l.key==="Escape"&&G.isVisible()&&G.hide()})},I.prototype.hide=function(){var G=this;this._options.edge?(this._getPlacementClasses(this._options.placement+"-edge").active.map(function(l){G._targetEl.classList.remove(l)}),this._getPlacementClasses(this._options.placement+"-edge").inactive.map(function(l){G._targetEl.classList.add(l)})):(this._getPlacementClasses(this._options.placement).active.map(function(l){G._targetEl.classList.remove(l)}),this._getPlacementClasses(this._options.placement).inactive.map(function(l){G._targetEl.classList.add(l)})),this._targetEl.setAttribute("aria-hidden","true"),this._targetEl.removeAttribute("aria-modal"),this._targetEl.removeAttribute("role"),this._options.bodyScrolling||document.body.classList.remove("overflow-hidden"),this._options.backdrop&&this._destroyBackdropEl(),this._visible=!1,this._options.onHide(this)},I.prototype.show=function(){var G=this;this._options.edge?(this._getPlacementClasses(this._options.placement+"-edge").active.map(function(l){G._targetEl.classList.add(l)}),this._getPlacementClasses(this._options.placement+"-edge").inactive.map(function(l){G._targetEl.classList.remove(l)})):(this._getPlacementClasses(this._options.placement).active.map(function(l){G._targetEl.classList.add(l)}),this._getPlacementClasses(this._options.placement).inactive.map(function(l){G._targetEl.classList.remove(l)})),this._targetEl.setAttribute("aria-modal","true"),this._targetEl.setAttribute("role","dialog"),this._targetEl.removeAttribute("aria-hidden"),this._options.bodyScrolling||document.body.classList.add("overflow-hidden"),this._options.backdrop&&this._createBackdrop(),this._visible=!0,this._options.onShow(this)},I.prototype.toggle=function(){this.isVisible()?this.hide():this.show()},I.prototype._createBackdrop=function(){var G,l=this;if(!this._visible){var b=document.createElement("div");b.setAttribute("drawer-backdrop",""),(G=b.classList).add.apply(G,this._options.backdropClasses.split(" ")),document.querySelector("body").append(b),b.addEventListener("click",function(){l.hide()})}},I.prototype._destroyBackdropEl=function(){this._visible&&document.querySelector("[drawer-backdrop]").remove()},I.prototype._getPlacementClasses=function(G){switch(G){case"top":return{base:["top-0","left-0","right-0"],active:["transform-none"],inactive:["-translate-y-full"]};case"right":return{base:["right-0","top-0"],active:["transform-none"],inactive:["translate-x-full"]};case"bottom":return{base:["bottom-0","left-0","right-0"],active:["transform-none"],inactive:["translate-y-full"]};case"left":return{base:["left-0","top-0"],active:["transform-none"],inactive:["-translate-x-full"]};case"bottom-edge":return{base:["left-0","top-0"],active:["transform-none"],inactive:["translate-y-full",this._options.edgeOffset]};default:return{base:["left-0","top-0"],active:["transform-none"],inactive:["-translate-x-full"]}}},I.prototype.isHidden=function(){return!this._visible},I.prototype.isVisible=function(){return this._visible},I}(),vp=function(I,G){if(G.some(function(l){return l.id===I}))return G.find(function(l){return l.id===I})};function rn(){var I=[];document.querySelectorAll("[data-drawer-target]").forEach(function(G){var l=G.getAttribute("data-drawer-target"),b=document.getElementById(l);if(b){var d=G.getAttribute("data-drawer-placement"),e=G.getAttribute("data-drawer-body-scrolling"),t=G.getAttribute("data-drawer-backdrop"),W=G.getAttribute("data-drawer-edge"),n=G.getAttribute("data-drawer-edge-offset");vp(l,I)||I.push({id:l,object:new XQ(b,{placement:d||Ja.placement,bodyScrolling:e?e==="true":Ja.bodyScrolling,backdrop:t?t==="true":Ja.backdrop,edge:W?W==="true":Ja.edge,edgeOffset:n||Ja.edgeOffset})})}else console.error("Drawer with id ".concat(l," not found. Are you sure that the data-drawer-target attribute points to the correct drawer id?"))}),document.querySelectorAll("[data-drawer-toggle]").forEach(function(G){var l=G.getAttribute("data-drawer-toggle"),b=document.getElementById(l);if(b){var d=vp(l,I);d?G.addEventListener("click",function(){d.object.toggle()}):console.error("Drawer with id ".concat(l," has not been initialized. Please initialize it using the data-drawer-target attribute."))}else console.error("Drawer with id ".concat(l," not found. Are you sure that the data-drawer-target attribute points to the correct drawer id?"))}),document.querySelectorAll("[data-drawer-dismiss], [data-drawer-hide]").forEach(function(G){var l=G.getAttribute("data-drawer-dismiss")?G.getAttribute("data-drawer-dismiss"):G.getAttribute("data-drawer-hide"),b=document.getElementById(l);if(b){var d=vp(l,I);d?G.addEventListener("click",function(){d.object.hide()}):console.error("Drawer with id ".concat(l," has not been initialized. Please initialize it using the data-drawer-target attribute."))}else console.error("Drawer with id ".concat(l," not found. Are you sure that the data-drawer-target attribute points to the correct drawer id"))}),document.querySelectorAll("[data-drawer-show]").forEach(function(G){var l=G.getAttribute("data-drawer-show"),b=document.getElementById(l);if(b){var d=vp(l,I);d?G.addEventListener("click",function(){d.object.show()}):console.error("Drawer with id ".concat(l," has not been initialized. Please initialize it using the data-drawer-target attribute."))}else console.error("Drawer with id ".concat(l," not found. Are you sure that the data-drawer-target attribute points to the correct drawer id?"))})}typeof window<"u"&&(window.Drawer=XQ,window.initDrawers=rn);var yp=function(){return yp=Object.assign||function(I){for(var G,l=1,b=arguments.length;l<b;l++){G=arguments[l];for(var d in G)Object.prototype.hasOwnProperty.call(G,d)&&(I[d]=G[d])}return I},yp.apply(this,arguments)},iQ={defaultTabId:null,activeClasses:"text-blue-600 hover:text-blue-600 dark:text-blue-500 dark:hover:text-blue-500 border-blue-600 dark:border-blue-500",inactiveClasses:"dark:border-transparent text-gray-500 hover:text-gray-600 dark:text-gray-400 border-gray-100 hover:border-gray-300 dark:border-gray-700 dark:hover:text-gray-300",onShow:function(){}},QQ=function(){function I(G,l){G===void 0&&(G=[]),l===void 0&&(l=iQ),this._items=G,this._activeTab=l?this.getTab(l.defaultTabId):null,this._options=yp(yp({},iQ),l),this._init()}return I.prototype._init=function(){var G=this;this._items.length&&(this._activeTab||this._setActiveTab(this._items[0]),this.show(this._activeTab.id,!0),this._items.map(function(l){l.triggerEl.addEventListener("click",function(){G.show(l.id)})}))},I.prototype.getActiveTab=function(){return this._activeTab},I.prototype._setActiveTab=function(G){this._activeTab=G},I.prototype.getTab=function(G){return this._items.filter(function(l){return l.id===G})[0]},I.prototype.show=function(G,l){var b,d,e=this;l===void 0&&(l=!1);var t=this.getTab(G);t===this._activeTab&&!l||(this._items.map(function(W){var n,s;W!==t&&((n=W.triggerEl.classList).remove.apply(n,e._options.activeClasses.split(" ")),(s=W.triggerEl.classList).add.apply(s,e._options.inactiveClasses.split(" ")),W.targetEl.classList.add("hidden"),W.triggerEl.setAttribute("aria-selected","false"))}),(b=t.triggerEl.classList).add.apply(b,this._options.activeClasses.split(" ")),(d=t.triggerEl.classList).remove.apply(d,this._options.inactiveClasses.split(" ")),t.triggerEl.setAttribute("aria-selected","true"),t.targetEl.classList.remove("hidden"),this._setActiveTab(t),this._options.onShow(this,t))},I}();function wn(){document.querySelectorAll("[data-tabs-toggle]").forEach(function(I){var G=[],l=null;I.querySelectorAll('[role="tab"]').forEach(function(b){var d=b.getAttribute("aria-selected")==="true",e={id:b.getAttribute("data-tabs-target"),triggerEl:b,targetEl:document.querySelector(b.getAttribute("data-tabs-target"))};G.push(e),d&&(l=e.id)}),new QQ(G,{defaultTabId:l})})}typeof window<"u"&&(window.Tabs=QQ,window.initTabs=wn);var Ee=function(){return Ee=Object.assign||function(I){for(var G,l=1,b=arguments.length;l<b;l++){G=arguments[l];for(var d in G)Object.prototype.hasOwnProperty.call(G,d)&&(I[d]=G[d])}return I},Ee.apply(this,arguments)},gp=function(I,G,l){if(l||arguments.length===2)for(var b=0,d=G.length,e;b<d;b++)(e||!(b in G))&&(e||(e=Array.prototype.slice.call(G,0,b)),e[b]=G[b]);return I.concat(e||Array.prototype.slice.call(G))},Jp={placement:"top",triggerType:"hover",onShow:function(){},onHide:function(){},onToggle:function(){}},HQ=function(){function I(G,l,b){G===void 0&&(G=null),l===void 0&&(l=null),b===void 0&&(b=Jp),this._targetEl=G,this._triggerEl=l,this._options=Ee(Ee({},Jp),b),this._popperInstance=this._createPopperInstance(),this._visible=!1,this._init()}return I.prototype._init=function(){this._triggerEl&&this._setupEventListeners()},I.prototype._setupEventListeners=function(){var G=this,l=this._getTriggerEvents();l.showEvents.forEach(function(b){G._triggerEl.addEventListener(b,function(){G.show()})}),l.hideEvents.forEach(function(b){G._triggerEl.addEventListener(b,function(){G.hide()})})},I.prototype._createPopperInstance=function(){return ga(this._triggerEl,this._targetEl,{placement:this._options.placement,modifiers:[{name:"offset",options:{offset:[0,8]}}]})},I.prototype._getTriggerEvents=function(){switch(this._options.triggerType){case"hover":return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]};case"click":return{showEvents:["click","focus"],hideEvents:["focusout","blur"]};case"none":return{showEvents:[],hideEvents:[]};default:return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]}}},I.prototype._setupKeydownListener=function(){var G=this;this._keydownEventListener=function(l){l.key==="Escape"&&G.hide()},document.body.addEventListener("keydown",this._keydownEventListener,!0)},I.prototype._removeKeydownListener=function(){document.body.removeEventListener("keydown",this._keydownEventListener,!0)},I.prototype._setupClickOutsideListener=function(){var G=this;this._clickOutsideEventListener=function(l){G._handleClickOutside(l,G._targetEl)},document.body.addEventListener("click",this._clickOutsideEventListener,!0)},I.prototype._removeClickOutsideListener=function(){document.body.removeEventListener("click",this._clickOutsideEventListener,!0)},I.prototype._handleClickOutside=function(G,l){var b=G.target;b!==l&&!l.contains(b)&&!this._triggerEl.contains(b)&&this.isVisible()&&this.hide()},I.prototype.isVisible=function(){return this._visible},I.prototype.toggle=function(){this.isVisible()?this.hide():this.show()},I.prototype.show=function(){this._targetEl.classList.remove("opacity-0","invisible"),this._targetEl.classList.add("opacity-100","visible"),this._popperInstance.setOptions(function(G){return Ee(Ee({},G),{modifiers:gp(gp([],G.modifiers,!0),[{name:"eventListeners",enabled:!0}],!1)})}),this._setupClickOutsideListener(),this._setupKeydownListener(),this._popperInstance.update(),this._visible=!0,this._options.onShow(this)},I.prototype.hide=function(){this._targetEl.classList.remove("opacity-100","visible"),this._targetEl.classList.add("opacity-0","invisible"),this._popperInstance.setOptions(function(G){return Ee(Ee({},G),{modifiers:gp(gp([],G.modifiers,!0),[{name:"eventListeners",enabled:!1}],!1)})}),this._removeClickOutsideListener(),this._removeKeydownListener(),this._visible=!1,this._options.onHide(this)},I}();function ye(){document.querySelectorAll("[data-tooltip-target]").forEach(function(I){var G=I.getAttribute("data-tooltip-target"),l=document.getElementById(G);if(l){var b=I.getAttribute("data-tooltip-trigger"),d=I.getAttribute("data-tooltip-placement");new HQ(l,I,{placement:d||Jp.placement,triggerType:b||Jp.triggerType})}else console.error('The tooltip element with id "'.concat(G,'" does not exist. Please check the data-tooltip-target attribute.'))})}typeof window<"u"&&(window.Tooltip=HQ,window.initTooltips=ye);var ge=function(){return ge=Object.assign||function(I){for(var G,l=1,b=arguments.length;l<b;l++){G=arguments[l];for(var d in G)Object.prototype.hasOwnProperty.call(G,d)&&(I[d]=G[d])}return I},ge.apply(this,arguments)},Cp=function(I,G,l){if(l||arguments.length===2)for(var b=0,d=G.length,e;b<d;b++)(e||!(b in G))&&(e||(e=Array.prototype.slice.call(G,0,b)),e[b]=G[b]);return I.concat(e||Array.prototype.slice.call(G))},PY={placement:"top",offset:10,triggerType:"hover",onShow:function(){},onHide:function(){},onToggle:function(){}},rQ=function(){function I(G,l,b){G===void 0&&(G=null),l===void 0&&(l=null),b===void 0&&(b=PY),this._targetEl=G,this._triggerEl=l,this._options=ge(ge({},PY),b),this._popperInstance=this._createPopperInstance(),this._visible=!1,this._init()}return I.prototype._init=function(){this._triggerEl&&this._setupEventListeners()},I.prototype._setupEventListeners=function(){var G=this,l=this._getTriggerEvents();l.showEvents.forEach(function(b){G._triggerEl.addEventListener(b,function(){G.show()}),G._targetEl.addEventListener(b,function(){G.show()})}),l.hideEvents.forEach(function(b){G._triggerEl.addEventListener(b,function(){setTimeout(function(){G._targetEl.matches(":hover")||G.hide()},100)}),G._targetEl.addEventListener(b,function(){setTimeout(function(){G._triggerEl.matches(":hover")||G.hide()},100)})})},I.prototype._createPopperInstance=function(){return ga(this._triggerEl,this._targetEl,{placement:this._options.placement,modifiers:[{name:"offset",options:{offset:[0,this._options.offset]}}]})},I.prototype._getTriggerEvents=function(){switch(this._options.triggerType){case"hover":return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]};case"click":return{showEvents:["click","focus"],hideEvents:["focusout","blur"]};case"none":return{showEvents:[],hideEvents:[]};default:return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]}}},I.prototype._setupKeydownListener=function(){var G=this;this._keydownEventListener=function(l){l.key==="Escape"&&G.hide()},document.body.addEventListener("keydown",this._keydownEventListener,!0)},I.prototype._removeKeydownListener=function(){document.body.removeEventListener("keydown",this._keydownEventListener,!0)},I.prototype._setupClickOutsideListener=function(){var G=this;this._clickOutsideEventListener=function(l){G._handleClickOutside(l,G._targetEl)},document.body.addEventListener("click",this._clickOutsideEventListener,!0)},I.prototype._removeClickOutsideListener=function(){document.body.removeEventListener("click",this._clickOutsideEventListener,!0)},I.prototype._handleClickOutside=function(G,l){var b=G.target;b!==l&&!l.contains(b)&&!this._triggerEl.contains(b)&&this.isVisible()&&this.hide()},I.prototype.isVisible=function(){return this._visible},I.prototype.toggle=function(){this.isVisible()?this.hide():this.show(),this._options.onToggle(this)},I.prototype.show=function(){this._targetEl.classList.remove("opacity-0","invisible"),this._targetEl.classList.add("opacity-100","visible"),this._popperInstance.setOptions(function(G){return ge(ge({},G),{modifiers:Cp(Cp([],G.modifiers,!0),[{name:"eventListeners",enabled:!0}],!1)})}),this._setupClickOutsideListener(),this._setupKeydownListener(),this._popperInstance.update(),this._visible=!0,this._options.onShow(this)},I.prototype.hide=function(){this._targetEl.classList.remove("opacity-100","visible"),this._targetEl.classList.add("opacity-0","invisible"),this._popperInstance.setOptions(function(G){return ge(ge({},G),{modifiers:Cp(Cp([],G.modifiers,!0),[{name:"eventListeners",enabled:!1}],!1)})}),this._removeClickOutsideListener(),this._removeKeydownListener(),this._visible=!1,this._options.onHide(this)},I}();function vn(){document.querySelectorAll("[data-popover-target]").forEach(function(I){var G=I.getAttribute("data-popover-target"),l=document.getElementById(G);if(l){var b=I.getAttribute("data-popover-trigger"),d=I.getAttribute("data-popover-placement"),e=I.getAttribute("data-popover-offset");new rQ(l,I,{placement:d||PY.placement,offset:e?parseInt(e):PY.offset,triggerType:b||PY.triggerType})}else console.error('The popover element with id "'.concat(G,'" does not exist. Please check the data-popover-target attribute.'))})}typeof window<"u"&&(window.Popover=rQ,window.initPopovers=vn);var Ap=function(){return Ap=Object.assign||function(I){for(var G,l=1,b=arguments.length;l<b;l++){G=arguments[l];for(var d in G)Object.prototype.hasOwnProperty.call(G,d)&&(I[d]=G[d])}return I},Ap.apply(this,arguments)},KR={triggerType:"hover",onShow:function(){},onHide:function(){},onToggle:function(){}},wQ=function(){function I(G,l,b,d){G===void 0&&(G=null),l===void 0&&(l=null),b===void 0&&(b=null),d===void 0&&(d=KR),this._parentEl=G,this._triggerEl=l,this._targetEl=b,this._options=Ap(Ap({},KR),d),this._visible=!1,this._init()}return I.prototype._init=function(){var G=this;if(this._triggerEl){var l=this._getTriggerEventTypes(this._options.triggerType);l.showEvents.forEach(function(b){G._triggerEl.addEventListener(b,function(){G.show()}),G._targetEl.addEventListener(b,function(){G.show()})}),l.hideEvents.forEach(function(b){G._parentEl.addEventListener(b,function(){G._parentEl.matches(":hover")||G.hide()})})}},I.prototype.hide=function(){this._targetEl.classList.add("hidden"),this._triggerEl&&this._triggerEl.setAttribute("aria-expanded","false"),this._visible=!1,this._options.onHide(this)},I.prototype.show=function(){this._targetEl.classList.remove("hidden"),this._triggerEl&&this._triggerEl.setAttribute("aria-expanded","true"),this._visible=!0,this._options.onShow(this)},I.prototype.toggle=function(){this._visible?this.hide():this.show()},I.prototype.isHidden=function(){return!this._visible},I.prototype.isVisible=function(){return this._visible},I.prototype._getTriggerEventTypes=function(G){switch(G){case"hover":return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]};case"click":return{showEvents:["click","focus"],hideEvents:["focusout","blur"]};case"none":return{showEvents:[],hideEvents:[]};default:return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]}}},I}();function En(){document.querySelectorAll("[data-dial-init]").forEach(function(I){var G=I.querySelector("[data-dial-toggle]");if(G){var l=G.getAttribute("data-dial-toggle"),b=document.getElementById(l);if(b){var d=G.getAttribute("data-dial-trigger");new wQ(I,G,b,{triggerType:d||KR.triggerType})}else console.error("Dial with id ".concat(l," does not exist. Are you sure that the data-dial-toggle attribute points to the correct modal id?"))}else console.error("Dial with id ".concat(I.id," does not have a trigger element. Are you sure that the data-dial-toggle attribute exists?"))})}typeof window<"u"&&(window.Dial=wQ,window.initDials=En);function vQ(){sn(),Yn(),hn(),Vn(),Xn(),Hn(),rn(),wn(),ye(),vn(),En()}typeof window<"u"&&(window.initFlowbite=vQ);var rC=new S0("load",[sn,Yn,hn,Vn,Xn,Hn,rn,wn,ye,vn,En]);rC.init();var Sd=el(IG());var zp=el(IG(),1),$Y=el(IG(),1),wC=I=>typeof I=="function",EQ=(I,G)=>wC(I)?I(G):I,vC=(()=>{let I=0;return()=>(++I).toString()})();var EC=20,Lp=new Map,yC=1e3,yQ=I=>{if(Lp.has(I))return;let G=setTimeout(()=>{Lp.delete(I),Ca({type:4,toastId:I})},yC);Lp.set(I,G)},gC=I=>{let G=Lp.get(I);G&&clearTimeout(G)},TR=(I,G)=>{switch(G.type){case 0:return{...I,toasts:[G.toast,...I.toasts].slice(0,EC)};case 1:return G.toast.id&&gC(G.toast.id),{...I,toasts:I.toasts.map(e=>e.id===G.toast.id?{...e,...G.toast}:e)};case 2:let{toast:l}=G;return I.toasts.find(e=>e.id===l.id)?TR(I,{type:1,toast:l}):TR(I,{type:0,toast:l});case 3:let{toastId:b}=G;return b?yQ(b):I.toasts.forEach(e=>{yQ(e.id)}),{...I,toasts:I.toasts.map(e=>e.id===b||b===void 0?{...e,visible:!1}:e)};case 4:return G.toastId===void 0?{...I,toasts:[]}:{...I,toasts:I.toasts.filter(e=>e.id!==G.toastId)};case 5:return{...I,pausedAt:G.time};case 6:let d=G.time-(I.pausedAt||0);return{...I,pausedAt:void 0,toasts:I.toasts.map(e=>({...e,pauseDuration:e.pauseDuration+d}))}}},kp=[],xp={toasts:[],pausedAt:void 0},Ca=I=>{xp=TR(xp,I),kp.forEach(G=>{G(xp)})},JC={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},CC=(I={})=>{let[G,l]=(0,zp.useState)(xp);(0,zp.useEffect)(()=>(kp.push(l),()=>{let d=kp.indexOf(l);d>-1&&kp.splice(d,1)}),[G]);let b=G.toasts.map(d=>{var e,t;return{...I,...I[d.type],...d,duration:d.duration||((e=I[d.type])==null?void 0:e.duration)||I?.duration||JC[d.type],style:{...I.style,...(t=I[d.type])==null?void 0:t.style,...d.style}}});return{...G,toasts:b}},AC=(I,G="blank",l)=>({createdAt:Date.now(),visible:!0,type:G,ariaProps:{role:"status","aria-live":"polite"},message:I,pauseDuration:0,...l,id:l?.id||vC()}),Ih=I=>(G,l)=>{let b=AC(G,I,l);return Ca({type:2,toast:b}),b.id},bd=(I,G)=>Ih("blank")(I,G);bd.error=Ih("error");bd.success=Ih("success");bd.loading=Ih("loading");bd.custom=Ih("custom");bd.dismiss=I=>{Ca({type:3,toastId:I})};bd.remove=I=>Ca({type:4,toastId:I});bd.promise=(I,G,l)=>{let b=bd.loading(G.loading,{...l,...l?.loading});return I.then(d=>(bd.success(EQ(G.success,d),{id:b,...l,...l?.success}),d)).catch(d=>{bd.error(EQ(G.error,d),{id:b,...l,...l?.error})}),I};var LC=(I,G)=>{Ca({type:1,toast:{id:I,height:G}})},kC=()=>{Ca({type:5,time:Date.now()})},gQ=I=>{let{toasts:G,pausedAt:l}=CC(I);(0,$Y.useEffect)(()=>{if(l)return;let e=Date.now(),t=G.map(W=>{if(W.duration===1/0)return;let n=(W.duration||0)+W.pauseDuration-(e-W.createdAt);if(n<0){W.visible&&bd.dismiss(W.id);return}return setTimeout(()=>bd.dismiss(W.id),n)});return()=>{t.forEach(W=>W&&clearTimeout(W))}},[G,l]);let b=(0,$Y.useCallback)(()=>{l&&Ca({type:6,time:Date.now()})},[l]),d=(0,$Y.useCallback)((e,t)=>{let{reverseOrder:W=!1,gutter:n=8,defaultPosition:s}=t||{},N=G.filter(V=>(V.position||s)===(e.position||s)&&V.height),m=N.findIndex(V=>V.id===e.id),h=N.filter((V,X)=>X<m&&V.visible).length;return N.filter(V=>V.visible).slice(...W?[h+1]:[0,h]).reduce((V,X)=>V+(X.height||0)+n,0)},[G]);return{toasts:G,handlers:{updateHeight:LC,startPause:kC,endPause:b,calculateOffset:d}}},yb=bd;var qc=el(uc());var zC=el(uc());var yn=el(IG()),JQ=el(uc()),xC=I=>window.parent.postMessage(I,"*");function CQ(){let[I,G]=(0,yn.useState)(!1),l=(0,yn.useRef)(null);return(0,yn.useEffect)(()=>{let b=()=>{G(!0);let e=W=>{xC({type:"DRAG_MOUSEMOVE",movementX:W.movementX,movementY:W.movementY,runtimeId:JQ.default.runtime.id})},t=()=>{G(!1),document.removeEventListener("mouseup",t),document.removeEventListener("mousemove",e)};document.addEventListener("mouseup",t),document.addEventListener("mousemove",e)},d=l.current;return d?.addEventListener("mousedown",b),()=>{d?.removeEventListener("mousemove",b)}},[]),{ref:l,isDragging:I}}function Up(I){let G=/^(https?:)?(\/\/)?((www\.|m\.)?youtube(-nocookie)?\.com\/(?:embed\/)?((watch)?\?(\w+=\w*&)*vi?=|embed\/|vi?\/|e\/)|youtu.be\/)([\w-]{10,20})/i,l=I.match(G);return l?l[9]:null}var Mp=el(q2()),Jn=el(IG());var UQ=el(uc());var AQ=el(IG()),nZ=(0,AQ.createContext)({blockReferences:!1});var pb=el(IG(),1);var LQ=Bi?I=>{I()}:pb.default.startTransition,UC=I=>{let[,G]=(0,pb.useState)({}),l=(0,pb.useRef)(!1),b=(0,pb.useRef)(I),d=(0,pb.useRef)({data:!1,error:!1,isValidating:!1}),e=(0,pb.useCallback)(t=>{let W=!1,n=b.current;for(let s in t){let N=s;n[N]!==t[N]&&(n[N]=t[N],d.current[N]&&(W=!0))}W&&!l.current&&G({})},[]);return S2(()=>(l.current=!1,()=>{l.current=!0})),[b,d.current,e]},MC=()=>(I,G,l={})=>{let{mutate:b}=In(),d=(0,pb.useRef)(I),e=(0,pb.useRef)(G),t=(0,pb.useRef)(l),W=(0,pb.useRef)(0),[n,s,N]=UC({data:LY,error:LY,isMutating:!1}),m=n.current,h=(0,pb.useCallback)(async(X,p)=>{let[F,a]=Oi(d.current);if(!e.current)throw new Error("Can\u2019t trigger the mutation: missing fetcher.");if(!F)throw new Error("Can\u2019t trigger the mutation: missing key.");let u=cp(cp({populateCache:!1,throwOnError:!0},t.current),p),Q=D2();W.current=Q,N({isMutating:!0});try{let C=await b(F,e.current(a,{arg:X}),cp(u,{throwOnError:!0}));if(W.current<=Q){var o,y;LQ(()=>N({data:C,isMutating:!1,error:void 0})),(o=(y=u).onSuccess)==null||o.call(y,C,F,u)}return C}catch(C){if(W.current<=Q){var H,E;if(LQ(()=>N({error:C,isMutating:!1})),(H=(E=u).onError)==null||H.call(E,C,F,u),u.throwOnError)throw C}}},[]),V=(0,pb.useCallback)(()=>{W.current=D2(),N({data:LY,error:LY,isMutating:!1})},[]);return S2(()=>{d.current=I,e.current=G,t.current=l}),{trigger:h,reset:V,get data(){return s.data=!0,m.data},get error(){return s.error=!0,m.error},get isMutating(){return s.isMutating=!0,m.isMutating}}},kQ=Ki(ld,MC);var gn=el(uc());function fR(){return(gn.default.i18n.getUILanguage()||navigator.language||"en").replace(/-.*/,"")}async function MZ(){let{model:I}=await gn.default.storage.local.get({model:AZ.fallbackModel}),G=I.startsWith("gpt-4");return await gn.default.storage.local.get({question:gn.default.i18n.getMessage(G?"defaultQuestionGPT4":"defaultQuestion"),systemMessage:"",selectedLanguage:fR(),provider:"web",model:I,apiKey:""})}async function xQ(I,{arg:G}){await gn.default.storage.local.set(G)}function gb(){let I=ld("settings",MZ),G=kQ("settings",xQ);return{settings:I.data,isLoading:I.isValidating||G.isMutating,error:I.error||G.error,updateSettings:G.trigger}}var mb=el(RG()),zQ=new Intl.DisplayNames([UQ.default.i18n.getUILanguage()],{type:"language"}),BC=(0,Jn.memo)(function(){let{settings:G,updateSettings:l}=gb(),{mutate:b}=In(),{setInitialGPTQueryState:d}=(0,Jn.useContext)(nZ);return(0,mb.jsx)(KY,{value:G?.selectedLanguage,onChange:async e=>{await l({selectedLanguage:e}),await b("summarizeQueryKey"),d&&d(!0)},children:({open:e})=>(0,mb.jsxs)("div",{className:"relative",children:[(0,mb.jsxs)(KY.Button,{className:"relative w-full cursor-default rounded-md border border-gray-200 bg-gray-200 py-1.5 pl-3 pr-10 text-left shadow-sm focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500 dark:border-gray-200 dark:bg-transparent sm:text-sm",children:[(0,mb.jsx)("span",{className:"block truncate",children:G?.selectedLanguage?zQ.of(G.selectedLanguage):""}),(0,mb.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,mb.jsx)(wR,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),(0,mb.jsx)(b0,{show:e,as:Jn.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,mb.jsx)(KY.Options,{className:"absolute right-0 z-10 mt-1 max-h-60 overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:Si.map(t=>(0,mb.jsx)(KY.Option,{value:t,className:({active:W})=>(0,Mp.default)(W?"bg-primary-500 text-white":"text-gray-900","relative cursor-default select-none py-2 pl-3 pr-9"),children:({selected:W,active:n})=>(0,mb.jsxs)(mb.Fragment,{children:[(0,mb.jsx)("span",{className:(0,Mp.default)(W?"font-semibold":"font-normal","block truncate"),children:zQ.of(t)}),W?(0,mb.jsx)("span",{className:(0,Mp.default)(n?"text-white":"text-primary-500","absolute inset-y-0 right-0 flex items-center pr-4"),children:(0,mb.jsx)(rR,{className:"h-5 w-5","aria-hidden":"true"})}):null]})},t))})})]})})}),MQ=BC;var Aa=el(RG());function SR(I){return(0,Aa.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 128 128",...I,children:(0,Aa.jsxs)("g",{fill:"none",fillRule:"nonzero",transform:"translate(5 5)",children:[(0,Aa.jsx)("circle",{cx:59,cy:59,r:59,fill:"#10A37F",stroke:"#10A37F",strokeWidth:9}),(0,Aa.jsx)("path",{fill:"#E5E7EB",d:"M76.397 67.004c-1.545 5.815-5.642 8.127-10.356 9.47-.464.148-.386.595-.386.595l.695 4.623s.077.373.696.298C83.66 80.2 94.714 68.047 92.78 53.285c-2.01-10.215-10.356-14.167-17.93-13.123-7.652 1.193-12.908 8.053-11.67 15.434 1.004 6.561 6.646 11.184 13.215 11.408Z"}),(0,Aa.jsx)("path",{fill:"#FFF",d:"M26.16 55.596c1.005 6.487 6.722 11.11 13.211 11.408-1.622 5.815-5.562 8.127-10.352 9.47-.464.148-.387.595-.387.595l.773 4.623s.077.373.695.298c16.534-1.79 27.736-13.943 25.65-28.705-1.93-10.215-10.198-14.167-17.846-13.123C30.254 41.355 25 48.215 26.16 55.596Z"})]})})}var DR=el(RG()),qR=({position:I})=>{let{toasts:G,handlers:l}=gQ(),{startPause:b,endPause:d}=l,e;return I==="bottom"?e=G.filter(t=>t.position?.includes("bottom")).slice(-1):e=G.filter(t=>t.position?.includes("top")),(0,DR.jsx)("div",{style:{position:"relative"},onMouseEnter:b,onMouseLeave:d,children:e.map(t=>(0,DR.jsx)("div",{style:{...t.style,marginTop:10,marginLeft:10,marginRight:10},className:OC(t.type),children:Mi(t.message,t)},t.id))})};function OC(I){switch(I){case"error":return"flex p-2 mb-2 text-red-800 border-t-4 border-red-300 bg-red-50 dark:text-red-400 dark:bg-gray-800 dark:border-red-800";case"blank":return"flex p-2 mb-2 text-yellow-800 border-t-4 border-yellow-300 bg-yellow-50 dark:text-yellow-300 dark:bg-gray-800 dark:border-yellow-800";default:return"flex p-2 mb-2 text-green-800 border-t-4 border-green-300 bg-green-50 dark:text-green-400 dark:bg-gray-800 dark:border-green-800"}}var Bu=el(IG());var pF=el(uc());var ka=el(uc()),mZ=el(RG()),La={ONE_TIME:"ONE_TIME",ERROR:"ERROR",ONCE_PER_SESSION:"ONCE_PER_SESSION"},_R=class I{constructor(){this.announcements=[];this.lastTimeSent=0}static getInstance(){return I.instance||(I.instance=new I),I.instance}addOneTimeAnnouncement(G){G.type=La.ONE_TIME,this.announcements.push(G)}async dismissAnnouncement(G,l){let b=l?"session":"local",e=((await ka.default.storage[b].get("dismissedAnnouncements")).dismissedAnnouncements||"").split(",");e.push(G),await ka.default.storage[b].set({dismissedAnnouncements:e.join(",")})}sendNotification({element:G,id:l,position:b,duration:d,style:e,type:t,toastType:W="custom"}){let n,s="-mx-1.5 -my-1.5 ml-auto inline-flex h-8 w-8 items-center justify-center rounded-lg p-1.5 focus:ring-2";switch(W){case"error":n=yb.error,s+=" bg-red-50 text-red-500 focus:ring-red-400 hover:bg-red-200 dark:bg-gray-800 dark:text-red-400 dark:hover:bg-gray-700";break;case"blank":n=yb,s+=" bg-yellow-50 text-yellow-500 focus:ring-2 focus:ring-yellow-400 hover:bg-yellow-200 dark:bg-gray-800 dark:text-yellow-300 dark:hover:bg-gray-700";break;default:n=yb.custom,s+=" bg-green-50 text-green-500 focus:ring-2 focus:ring-green-400 hover:bg-green-200 dark:bg-gray-800 dark:text-green-400 dark:hover:bg-gray-700";break}typeof G=="string"&&(G=(0,mZ.jsx)("span",{children:G})),n(N=>(0,mZ.jsxs)(mZ.Fragment,{children:[G,W!=="error"&&W!=="blank"&&(0,mZ.jsxs)("button",{type:"button",onClick:async()=>{yb.remove(N.id),l&&(t===La.ONE_TIME||t===La.ONCE_PER_SESSION)&&await this.dismissAnnouncement(l,t===La.ONCE_PER_SESSION)},className:s,"data-dismiss-target":"#alert-border-3","aria-label":"Close",children:[(0,mZ.jsx)("span",{className:"sr-only",children:"Dismiss"}),(0,mZ.jsx)("svg",{className:"h-3 w-3","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 14 14",children:(0,mZ.jsx)("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"})})]})]}),{duration:d||1/0,id:l,position:b,style:e})}sendErrorNotification({element:G,id:l,position:b,duration:d,style:e}){this.sendNotification({element:G,id:l,position:b,duration:d,style:e,toastType:"error"})}async sendSessionNotification({element:G,id:l,position:b,duration:d,style:e,toastType:t}){(await this.getDismissedIds(!0)).includes(l)||this.sendNotification({element:G,id:l,position:b,duration:d,style:e,toastType:t,type:La.ONCE_PER_SESSION})}async sendOneTimeNotification({element:G,id:l,position:b,duration:d,style:e,toastType:t}){(await this.getDismissedIds()).includes(l)||this.sendNotification({element:G,id:l,position:b,duration:d,style:e,toastType:t,type:La.ONE_TIME})}async showOneTimeAnnouncements(){if(this.announcements.length===0||Date.now()-this.lastTimeSent<3e4)return;let l=await this.getDismissedIds(),b=this.announcements.shift();b&&b.id&&b.type===La.ONE_TIME&&!l.includes(b.id)&&(this.lastTimeSent=Date.now(),this.sendNotification(b))}async getDismissedIds(G){let l=G?"session":"local",d=(await ka.default.storage[l].get("dismissedAnnouncements")).dismissedAnnouncements;return d?d.split(","):[]}async getBackgroundAnnouncementsIds(G){let l=G?"session":"local",d=(await ka.default.storage[l].get("backgroundAnnouncements")).backgroundAnnouncements;return d?d.split(","):[]}async removeBackgroundAnnouncement(G){let b=((await ka.default.storage.local.get("backgroundAnnouncements")).backgroundAnnouncements||"").split(",").filter(d=>d!==G);await ka.default.storage.local.set({backgroundAnnouncements:b.join(",")})}},jC=_R.getInstance(),Jb=jC;var Tp=el(uc());var OQ={"./node_modules/onnxruntime-web/dist/ort-wasm-simd-threaded.jsep.wasm":(I,G,l)=>{I.exports=l.p+"ort-wasm-simd-threaded.jsep.wasm"},"./node_modules/onnxruntime-web/dist/ort.bundle.min.mjs?46eb":(I,G,l)=>{I.exports=l.p+"ort.bundle.min.mjs"},"?2ce3":()=>{},"?7a2c":()=>{},"?a42a":()=>{},"?2b25":()=>{},"?569f":()=>{},"?3f59":()=>{},"?154a":()=>{},"./node_modules/@huggingface/jinja/dist/index.js":(I,G,l)=>{l.r(G),l.d(G,{Environment:()=>K,Interpreter:()=>q,Template:()=>iI,parse:()=>HI,tokenize:()=>m});var b=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",BooleanLiteral:"BooleanLiteral",NullLiteral:"NullLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Set:"Set",If:"If",For:"For",In:"In",Is:"Is",NotIn:"NotIn",Else:"Else",EndIf:"EndIf",ElseIf:"ElseIf",EndFor:"EndFor",And:"And",Or:"Or",Not:"UnaryOperator",Macro:"Macro",EndMacro:"EndMacro"}),d=Object.freeze({set:b.Set,for:b.For,in:b.In,is:b.Is,if:b.If,else:b.Else,endif:b.EndIf,elif:b.ElseIf,endfor:b.EndFor,and:b.And,or:b.Or,not:b.Not,"not in":b.NotIn,macro:b.Macro,endmacro:b.EndMacro,true:b.BooleanLiteral,false:b.BooleanLiteral,none:b.NullLiteral,True:b.BooleanLiteral,False:b.BooleanLiteral,None:b.NullLiteral}),e=class{constructor(B,aI){this.value=B,this.type=aI}};function t(B){return/\w/.test(B)}function W(B){return/[0-9]/.test(B)}var n=[["{%",b.OpenStatement],["%}",b.CloseStatement],["{{",b.OpenExpression],["}}",b.CloseExpression],["(",b.OpenParen],[")",b.CloseParen],["{",b.OpenCurlyBracket],["}",b.CloseCurlyBracket],["[",b.OpenSquareBracket],["]",b.CloseSquareBracket],[",",b.Comma],[".",b.Dot],[":",b.Colon],["|",b.Pipe],["<=",b.ComparisonBinaryOperator],[">=",b.ComparisonBinaryOperator],["==",b.ComparisonBinaryOperator],["!=",b.ComparisonBinaryOperator],["<",b.ComparisonBinaryOperator],[">",b.ComparisonBinaryOperator],["+",b.AdditiveBinaryOperator],["-",b.AdditiveBinaryOperator],["*",b.MultiplicativeBinaryOperator],["/",b.MultiplicativeBinaryOperator],["%",b.MultiplicativeBinaryOperator],["=",b.Equals]],s=new Map([["n",`
`],["t","	"],["r","\r"],["b","\b"],["f","\f"],["v","\v"],["'","'"],['"','"'],["\\","\\"]]);function N(B,aI={}){return B.endsWith(`
`)&&(B=B.slice(0,-1)),B=B.replace(/{#.*?#}/gs,"{##}"),aI.lstrip_blocks&&(B=B.replace(/^[ \t]*({[#%])/gm,"$1")),aI.trim_blocks&&(B=B.replace(/([#%]})\n/g,"$1")),B.replace(/{##}/g,"").replace(/-%}\s*/g,"%}").replace(/\s*{%-/g,"{%").replace(/-}}\s*/g,"}}").replace(/\s*{{-/g,"{{")}function m(B,aI={}){let lI=[],QI=N(B,aI),vI=0,OI=uI=>{let wI="";for(;uI(QI[vI]);){if(QI[vI]==="\\"){if(++vI,vI>=QI.length)throw new SyntaxError("Unexpected end of input");let kI=QI[vI++],TI=s.get(kI);if(TI===void 0)throw new SyntaxError(`Unexpected escaped character: ${kI}`);wI+=TI;continue}if(wI+=QI[vI++],vI>=QI.length)throw new SyntaxError("Unexpected end of input")}return wI};I:for(;vI<QI.length;){let uI=lI.at(-1)?.type;if(uI===void 0||uI===b.CloseStatement||uI===b.CloseExpression){let kI="";for(;vI<QI.length&&!(QI[vI]==="{"&&(QI[vI+1]==="%"||QI[vI+1]==="{"));)kI+=QI[vI++];if(kI.length>0){lI.push(new e(kI,b.Text));continue}}OI(kI=>/\s/.test(kI));let wI=QI[vI];if(wI==="-"||wI==="+"){let kI=lI.at(-1)?.type;if(kI===b.Text||kI===void 0)throw new SyntaxError(`Unexpected character: ${wI}`);switch(kI){case b.Identifier:case b.NumericLiteral:case b.BooleanLiteral:case b.NullLiteral:case b.StringLiteral:case b.CloseParen:case b.CloseSquareBracket:break;default:{++vI;let TI=OI(W);lI.push(new e(`${wI}${TI}`,TI.length>0?b.NumericLiteral:b.UnaryOperator));continue}}}for(let[kI,TI]of n)if(QI.slice(vI,vI+kI.length)===kI){lI.push(new e(kI,TI)),vI+=kI.length;continue I}if(wI==="'"||wI==='"'){++vI;let kI=OI(TI=>TI!==wI);lI.push(new e(kI,b.StringLiteral)),++vI;continue}if(W(wI)){let kI=OI(W);lI.push(new e(kI,b.NumericLiteral));continue}if(t(wI)){let kI=OI(t),TI=Object.hasOwn(d,kI)?d[kI]:b.Identifier;TI===b.In&&lI.at(-1)?.type===b.Not?(lI.pop(),lI.push(new e("not in",b.NotIn))):lI.push(new e(kI,TI));continue}throw new SyntaxError(`Unexpected character: ${wI}`)}return lI}var h=class{type="Statement"},V=class extends h{constructor(B){super(),this.body=B}type="Program"},X=class extends h{constructor(B,aI,lI){super(),this.test=B,this.body=aI,this.alternate=lI}type="If"},p=class extends h{constructor(B,aI,lI,QI){super(),this.loopvar=B,this.iterable=aI,this.body=lI,this.defaultBlock=QI}type="For"},F=class extends h{constructor(B,aI){super(),this.assignee=B,this.value=aI}type="Set"},a=class extends h{constructor(B,aI,lI){super(),this.name=B,this.args=aI,this.body=lI}type="Macro"},u=class extends h{type="Expression"},Q=class extends u{constructor(B,aI,lI){super(),this.object=B,this.property=aI,this.computed=lI}type="MemberExpression"},o=class extends u{constructor(B,aI){super(),this.callee=B,this.args=aI}type="CallExpression"},y=class extends u{constructor(B){super(),this.value=B}type="Identifier"},H=class extends u{constructor(B){super(),this.value=B}type="Literal"},E=class extends H{type="NumericLiteral"},C=class extends H{type="StringLiteral"},T=class extends H{type="BooleanLiteral"},S=class extends H{type="NullLiteral"},cI=class extends H{type="ArrayLiteral"},hI=class extends H{type="TupleLiteral"},WI=class extends H{type="ObjectLiteral"},VI=class extends u{constructor(B,aI,lI){super(),this.operator=B,this.left=aI,this.right=lI}type="BinaryExpression"},sI=class extends u{constructor(B,aI){super(),this.operand=B,this.filter=aI}type="FilterExpression"},ZI=class extends u{constructor(B,aI){super(),this.iterable=B,this.test=aI}type="SelectExpression"},dI=class extends u{constructor(B,aI,lI){super(),this.operand=B,this.negate=aI,this.test=lI}type="TestExpression"},pI=class extends u{constructor(B,aI){super(),this.operator=B,this.argument=aI}type="UnaryExpression"},yI=class extends u{constructor(B=void 0,aI=void 0,lI=void 0){super(),this.start=B,this.stop=aI,this.step=lI}type="SliceExpression"},eI=class extends u{constructor(B,aI){super(),this.key=B,this.value=aI}type="KeywordArgumentExpression"};function HI(B){let aI=new V([]),lI=0;function QI(sl,ul){let Cl=B[lI++];if(!Cl||Cl.type!==sl)throw new Error(`Parser Error: ${ul}. ${Cl.type} !== ${sl}.`);return Cl}function vI(){switch(B[lI].type){case b.Text:return wI();case b.OpenStatement:return kI();case b.OpenExpression:return TI();default:throw new SyntaxError(`Unexpected token type: ${B[lI].type}`)}}function OI(...sl){return lI+sl.length<=B.length&&sl.some((ul,Cl)=>ul!==B[lI+Cl].type)}function uI(...sl){return lI+sl.length<=B.length&&sl.every((ul,Cl)=>ul===B[lI+Cl].type)}function wI(){return new C(QI(b.Text,"Expected text token").value)}function kI(){QI(b.OpenStatement,"Expected opening statement token");let sl;switch(B[lI].type){case b.Set:++lI,sl=Il(),QI(b.CloseStatement,"Expected closing statement token");break;case b.If:++lI,sl=nl(),QI(b.OpenStatement,"Expected {% token"),QI(b.EndIf,"Expected endif token"),QI(b.CloseStatement,"Expected %} token");break;case b.Macro:++lI,sl=ol(),QI(b.OpenStatement,"Expected {% token"),QI(b.EndMacro,"Expected endmacro token"),QI(b.CloseStatement,"Expected %} token");break;case b.For:++lI,sl=KI(),QI(b.OpenStatement,"Expected {% token"),QI(b.EndFor,"Expected endfor token"),QI(b.CloseStatement,"Expected %} token");break;default:throw new SyntaxError(`Unknown statement type: ${B[lI].type}`)}return sl}function TI(){QI(b.OpenExpression,"Expected opening expression token");let sl=jI();return QI(b.CloseExpression,"Expected closing expression token"),sl}function Il(){let sl=jI();if(uI(b.Equals)){++lI;let ul=Il();return new F(sl,ul)}return sl}function nl(){let sl=jI();QI(b.CloseStatement,"Expected closing statement token");let ul=[],Cl=[];for(;!(B[lI]?.type===b.OpenStatement&&(B[lI+1]?.type===b.ElseIf||B[lI+1]?.type===b.Else||B[lI+1]?.type===b.EndIf));)ul.push(vI());if(B[lI]?.type===b.OpenStatement&&B[lI+1]?.type!==b.EndIf)if(++lI,uI(b.ElseIf))QI(b.ElseIf,"Expected elseif token"),Cl.push(nl());else for(QI(b.Else,"Expected else token"),QI(b.CloseStatement,"Expected closing statement token");!(B[lI]?.type===b.OpenStatement&&B[lI+1]?.type===b.EndIf);)Cl.push(vI());return new X(sl,ul,Cl)}function ol(){let sl=qG();if(sl.type!=="Identifier")throw new SyntaxError("Expected identifier following macro statement");let ul=LG();QI(b.CloseStatement,"Expected closing statement token");let Cl=[];for(;OI(b.OpenStatement,b.EndMacro);)Cl.push(vI());return new a(sl,ul,Cl)}function PI(sl=!1){let ul=sl?qG:jI,Cl=[ul()],Gc=uI(b.Comma);for(;Gc&&(++lI,Cl.push(ul()),!!uI(b.Comma)););return Gc?new hI(Cl):Cl[0]}function KI(){let sl=PI(!0);if(!(sl instanceof y||sl instanceof hI))throw new SyntaxError(`Expected identifier/tuple for the loop variable, got ${sl.type} instead`);QI(b.In,"Expected `in` keyword following loop variable");let ul=jI();QI(b.CloseStatement,"Expected closing statement token");let Cl=[];for(;OI(b.OpenStatement,b.EndFor)&&OI(b.OpenStatement,b.Else);)Cl.push(vI());let Gc=[];if(uI(b.OpenStatement,b.Else))for(++lI,++lI,QI(b.CloseStatement,"Expected closing statement token");OI(b.OpenStatement,b.EndFor);)Gc.push(vI());return new p(sl,ul,Cl,Gc)}function jI(){return Wl()}function Wl(){let sl=wl();if(uI(b.If)){++lI;let ul=wl();if(uI(b.Else)){++lI;let Cl=wl();return new X(ul,[sl],[Cl])}else return new ZI(sl,ul)}return sl}function wl(){let sl=Ol();for(;uI(b.Or);){let ul=B[lI];++lI;let Cl=Ol();sl=new VI(ul,sl,Cl)}return sl}function Ol(){let sl=jl();for(;uI(b.And);){let ul=B[lI];++lI;let Cl=jl();sl=new VI(ul,sl,Cl)}return sl}function jl(){let sl;for(;uI(b.Not);){let ul=B[lI];++lI;let Cl=jl();sl=new pI(ul,Cl)}return sl??NG()}function NG(){let sl=Fl();for(;uI(b.ComparisonBinaryOperator)||uI(b.In)||uI(b.NotIn);){let ul=B[lI];++lI;let Cl=Fl();sl=new VI(ul,sl,Cl)}return sl}function Fl(){let sl=EG();for(;uI(b.AdditiveBinaryOperator);){let ul=B[lI];++lI;let Cl=EG();sl=new VI(ul,sl,Cl)}return sl}function Dl(){let sl=Wc(qG());return uI(b.OpenParen)?XG(sl):sl}function XG(sl){let ul=new o(sl,LG());return ul=Wc(ul),uI(b.OpenParen)&&(ul=XG(ul)),ul}function LG(){QI(b.OpenParen,"Expected opening parenthesis for arguments list");let sl=lc();return QI(b.CloseParen,"Expected closing parenthesis for arguments list"),sl}function lc(){let sl=[];for(;!uI(b.CloseParen);){let ul=jI();if(uI(b.Equals)){if(++lI,!(ul instanceof y))throw new SyntaxError("Expected identifier for keyword argument");let Cl=jI();ul=new eI(ul,Cl)}sl.push(ul),uI(b.Comma)&&++lI}return sl}function DG(){let sl=[],ul=!1;for(;!uI(b.CloseSquareBracket);)uI(b.Colon)?(sl.push(void 0),++lI,ul=!0):(sl.push(jI()),uI(b.Colon)&&(++lI,ul=!0));if(sl.length===0)throw new SyntaxError("Expected at least one argument for member/slice expression");if(ul){if(sl.length>3)throw new SyntaxError("Expected 0-3 arguments for slice expression");return new yI(...sl)}return sl[0]}function Wc(sl){for(;uI(b.Dot)||uI(b.OpenSquareBracket);){let ul=B[lI];++lI;let Cl,Gc=ul.type!==b.Dot;if(Gc)Cl=DG(),QI(b.CloseSquareBracket,"Expected closing square bracket");else if(Cl=qG(),Cl.type!=="Identifier")throw new SyntaxError("Expected identifier following dot operator");sl=new Q(sl,Cl,Gc)}return sl}function EG(){let sl=MG();for(;uI(b.MultiplicativeBinaryOperator);){let ul=B[lI];++lI;let Cl=MG();sl=new VI(ul,sl,Cl)}return sl}function MG(){let sl=xc();for(;uI(b.Is);){++lI;let ul=uI(b.Not);ul&&++lI;let Cl=qG();if(Cl instanceof T?Cl=new y(Cl.value.toString()):Cl instanceof S&&(Cl=new y("none")),!(Cl instanceof y))throw new SyntaxError("Expected identifier for the test");sl=new dI(sl,ul,Cl)}return sl}function xc(){let sl=Dl();for(;uI(b.Pipe);){++lI;let ul=qG();if(!(ul instanceof y))throw new SyntaxError("Expected identifier for the filter");uI(b.OpenParen)&&(ul=XG(ul)),sl=new sI(sl,ul)}return sl}function qG(){let sl=B[lI];switch(sl.type){case b.NumericLiteral:return++lI,new E(Number(sl.value));case b.StringLiteral:return++lI,new C(sl.value);case b.BooleanLiteral:return++lI,new T(sl.value.toLowerCase()==="true");case b.NullLiteral:return++lI,new S(null);case b.Identifier:return++lI,new y(sl.value);case b.OpenParen:{++lI;let ul=PI();if(B[lI].type!==b.CloseParen)throw new SyntaxError(`Expected closing parenthesis, got ${B[lI].type} instead`);return++lI,ul}case b.OpenSquareBracket:{++lI;let ul=[];for(;!uI(b.CloseSquareBracket);)ul.push(jI()),uI(b.Comma)&&++lI;return++lI,new cI(ul)}case b.OpenCurlyBracket:{++lI;let ul=new Map;for(;!uI(b.CloseCurlyBracket);){let Cl=jI();QI(b.Colon,"Expected colon between key and value in object literal");let Gc=jI();ul.set(Cl,Gc),uI(b.Comma)&&++lI}return++lI,new WI(ul)}default:throw new SyntaxError(`Unexpected token: ${sl.type}`)}}for(;lI<B.length;)aI.body.push(vI());return aI}function YI(B,aI,lI=1){aI===void 0&&(aI=B,B=0);let QI=[];for(let vI=B;vI<aI;vI+=lI)QI.push(vI);return QI}function $(B,aI,lI,QI=1){let vI=Math.sign(QI);vI>=0?(aI=(aI??=0)<0?Math.max(B.length+aI,0):Math.min(aI,B.length),lI=(lI??=B.length)<0?Math.max(B.length+lI,0):Math.min(lI,B.length)):(aI=(aI??=B.length-1)<0?Math.max(B.length+aI,-1):Math.min(aI,B.length-1),lI=(lI??=-1)<-1?Math.max(B.length+lI,-1):Math.min(lI,B.length-1));let OI=[];for(let uI=aI;vI*uI<vI*lI;uI+=QI)OI.push(B[uI]);return OI}function JI(B){return B.replace(/\b\w/g,aI=>aI.toUpperCase())}var UI=class{type="RuntimeValue";value;builtins=new Map;constructor(B=void 0){this.value=B}__bool__(){return new bI(!!this.value)}},zI=class extends UI{type="NumericValue"},L=class extends UI{type="StringValue";builtins=new Map([["upper",new r(()=>new L(this.value.toUpperCase()))],["lower",new r(()=>new L(this.value.toLowerCase()))],["strip",new r(()=>new L(this.value.trim()))],["title",new r(()=>new L(JI(this.value)))],["length",new zI(this.value.length)],["rstrip",new r(()=>new L(this.value.trimEnd()))],["lstrip",new r(()=>new L(this.value.trimStart()))],["split",new r(B=>{let aI=B[0]??new A;if(!(aI instanceof L||aI instanceof A))throw new Error("sep argument must be a string or null");let lI=B[1]??new zI(-1);if(!(lI instanceof zI))throw new Error("maxsplit argument must be a number");let QI=[];if(aI instanceof A){let vI=this.value.trimStart();for(let{0:OI,index:uI}of vI.matchAll(/\S+/g)){if(lI.value!==-1&&QI.length>=lI.value&&uI!==void 0){QI.push(OI+vI.slice(uI+OI.length));break}QI.push(OI)}}else{if(aI.value==="")throw new Error("empty separator");QI=this.value.split(aI.value),lI.value!==-1&&QI.length>lI.value&&QI.push(QI.splice(lI.value).join(aI.value))}return new k(QI.map(vI=>new L(vI)))})]])},bI=class extends UI{type="BooleanValue"},FI=class extends UI{type="ObjectValue";__bool__(){return new bI(this.value.size>0)}builtins=new Map([["get",new r(([B,aI])=>{if(!(B instanceof L))throw new Error(`Object key must be a string: got ${B.type}`);return this.value.get(B.value)??aI??new A})],["items",new r(()=>new k(Array.from(this.value.entries()).map(([B,aI])=>new k([new L(B),aI]))))]])},U=class extends FI{type="KeywordArgumentsValue"},k=class extends UI{type="ArrayValue";builtins=new Map([["length",new zI(this.value.length)]]);__bool__(){return new bI(this.value.length>0)}},w=class extends k{type="TupleValue"},r=class extends UI{type="FunctionValue"},A=class extends UI{type="NullValue"},O=class extends UI{type="UndefinedValue"},K=class{constructor(B){this.parent=B}variables=new Map([["namespace",new r(B=>{if(B.length===0)return new FI(new Map);if(B.length!==1||!(B[0]instanceof FI))throw new Error("`namespace` expects either zero arguments or a single object argument");return B[0]})]]);tests=new Map([["boolean",B=>B.type==="BooleanValue"],["callable",B=>B instanceof r],["odd",B=>{if(B.type!=="NumericValue")throw new Error(`Cannot apply test "odd" to type: ${B.type}`);return B.value%2!==0}],["even",B=>{if(B.type!=="NumericValue")throw new Error(`Cannot apply test "even" to type: ${B.type}`);return B.value%2===0}],["false",B=>B.type==="BooleanValue"&&!B.value],["true",B=>B.type==="BooleanValue"&&B.value],["none",B=>B.type==="NullValue"],["string",B=>B.type==="StringValue"],["number",B=>B.type==="NumericValue"],["integer",B=>B.type==="NumericValue"&&Number.isInteger(B.value)],["iterable",B=>B.type==="ArrayValue"||B.type==="StringValue"],["mapping",B=>B.type==="ObjectValue"],["lower",B=>{let aI=B.value;return B.type==="StringValue"&&aI===aI.toLowerCase()}],["upper",B=>{let aI=B.value;return B.type==="StringValue"&&aI===aI.toUpperCase()}],["none",B=>B.type==="NullValue"],["defined",B=>B.type!=="UndefinedValue"],["undefined",B=>B.type==="UndefinedValue"],["equalto",(B,aI)=>B.value===aI.value],["eq",(B,aI)=>B.value===aI.value]]);set(B,aI){return this.declareVariable(B,GI(aI))}declareVariable(B,aI){if(this.variables.has(B))throw new SyntaxError(`Variable already declared: ${B}`);return this.variables.set(B,aI),aI}setVariable(B,aI){return this.variables.set(B,aI),aI}resolve(B){if(this.variables.has(B))return this;if(this.parent)return this.parent.resolve(B);throw new Error(`Unknown variable: ${B}`)}lookupVariable(B){try{return this.resolve(B).variables.get(B)??new O}catch{return new O}}},q=class{global;constructor(B){this.global=B??new K}run(B){return this.evaluate(B,this.global)}evaluateBinaryExpression(B,aI){let lI=this.evaluate(B.left,aI);switch(B.operator.value){case"and":return lI.__bool__().value?this.evaluate(B.right,aI):lI;case"or":return lI.__bool__().value?lI:this.evaluate(B.right,aI)}let QI=this.evaluate(B.right,aI);switch(B.operator.value){case"==":return new bI(lI.value==QI.value);case"!=":return new bI(lI.value!=QI.value)}if(lI instanceof O||QI instanceof O)throw new Error("Cannot perform operation on undefined values");if(lI instanceof A||QI instanceof A)throw new Error("Cannot perform operation on null values");if(lI instanceof zI&&QI instanceof zI)switch(B.operator.value){case"+":return new zI(lI.value+QI.value);case"-":return new zI(lI.value-QI.value);case"*":return new zI(lI.value*QI.value);case"/":return new zI(lI.value/QI.value);case"%":return new zI(lI.value%QI.value);case"<":return new bI(lI.value<QI.value);case">":return new bI(lI.value>QI.value);case">=":return new bI(lI.value>=QI.value);case"<=":return new bI(lI.value<=QI.value)}else if(lI instanceof k&&QI instanceof k)switch(B.operator.value){case"+":return new k(lI.value.concat(QI.value))}else if(QI instanceof k){let vI=QI.value.find(OI=>OI.value===lI.value)!==void 0;switch(B.operator.value){case"in":return new bI(vI);case"not in":return new bI(!vI)}}if(lI instanceof L||QI instanceof L)switch(B.operator.value){case"+":return new L(lI.value.toString()+QI.value.toString())}if(lI instanceof L&&QI instanceof L)switch(B.operator.value){case"in":return new bI(QI.value.includes(lI.value));case"not in":return new bI(!QI.value.includes(lI.value))}if(lI instanceof L&&QI instanceof FI)switch(B.operator.value){case"in":return new bI(QI.value.has(lI.value));case"not in":return new bI(!QI.value.has(lI.value))}throw new SyntaxError(`Unknown operator "${B.operator.value}" between ${lI.type} and ${QI.type}`)}evaluateArguments(B,aI){let lI=[],QI=new Map;for(let vI of B)if(vI.type==="KeywordArgumentExpression"){let OI=vI;QI.set(OI.key.value,this.evaluate(OI.value,aI))}else{if(QI.size>0)throw new Error("Positional arguments must come before keyword arguments");lI.push(this.evaluate(vI,aI))}return[lI,QI]}evaluateFilterExpression(B,aI){let lI=this.evaluate(B.operand,aI);if(B.filter.type==="Identifier"){let QI=B.filter;if(QI.value==="tojson")return new L(tI(lI));if(lI instanceof k)switch(QI.value){case"list":return lI;case"first":return lI.value[0];case"last":return lI.value[lI.value.length-1];case"length":return new zI(lI.value.length);case"reverse":return new k(lI.value.reverse());case"sort":return new k(lI.value.sort((vI,OI)=>{if(vI.type!==OI.type)throw new Error(`Cannot compare different types: ${vI.type} and ${OI.type}`);switch(vI.type){case"NumericValue":return vI.value-OI.value;case"StringValue":return vI.value.localeCompare(OI.value);default:throw new Error(`Cannot compare type: ${vI.type}`)}}));case"join":return new L(lI.value.map(vI=>vI.value).join(""));default:throw new Error(`Unknown ArrayValue filter: ${QI.value}`)}else if(lI instanceof L)switch(QI.value){case"length":return new zI(lI.value.length);case"upper":return new L(lI.value.toUpperCase());case"lower":return new L(lI.value.toLowerCase());case"title":return new L(JI(lI.value));case"capitalize":return new L(lI.value.charAt(0).toUpperCase()+lI.value.slice(1));case"trim":return new L(lI.value.trim());case"indent":return new L(lI.value.split(`
`).map((vI,OI)=>OI===0||vI.length===0?vI:"    "+vI).join(`
`));case"join":case"string":return lI;default:throw new Error(`Unknown StringValue filter: ${QI.value}`)}else if(lI instanceof zI)switch(QI.value){case"abs":return new zI(Math.abs(lI.value));default:throw new Error(`Unknown NumericValue filter: ${QI.value}`)}else if(lI instanceof FI)switch(QI.value){case"items":return new k(Array.from(lI.value.entries()).map(([vI,OI])=>new k([new L(vI),OI])));case"length":return new zI(lI.value.size);default:throw new Error(`Unknown ObjectValue filter: ${QI.value}`)}throw new Error(`Cannot apply filter "${QI.value}" to type: ${lI.type}`)}else if(B.filter.type==="CallExpression"){let QI=B.filter;if(QI.callee.type!=="Identifier")throw new Error(`Unknown filter: ${QI.callee.type}`);let vI=QI.callee.value;if(vI==="tojson"){let[,OI]=this.evaluateArguments(QI.args,aI),uI=OI.get("indent")??new A;if(!(uI instanceof zI||uI instanceof A))throw new Error("If set, indent must be a number");return new L(tI(lI,uI.value))}else if(vI==="join"){let OI;if(lI instanceof L)OI=Array.from(lI.value);else if(lI instanceof k)OI=lI.value.map(TI=>TI.value);else throw new Error(`Cannot apply filter "${vI}" to type: ${lI.type}`);let[uI,wI]=this.evaluateArguments(QI.args,aI),kI=uI.at(0)??wI.get("separator")??new L("");if(!(kI instanceof L))throw new Error("separator must be a string");return new L(OI.join(kI.value))}if(lI instanceof k){switch(vI){case"selectattr":case"rejectattr":{let OI=vI==="selectattr";if(lI.value.some(nl=>!(nl instanceof FI)))throw new Error(`\`${vI}\` can only be applied to array of objects`);if(QI.args.some(nl=>nl.type!=="StringLiteral"))throw new Error(`arguments of \`${vI}\` must be strings`);let[uI,wI,kI]=QI.args.map(nl=>this.evaluate(nl,aI)),TI;if(wI){let nl=aI.tests.get(wI.value);if(!nl)throw new Error(`Unknown test: ${wI.value}`);TI=nl}else TI=(...nl)=>nl[0].__bool__().value;let Il=lI.value.filter(nl=>{let ol=nl.value.get(uI.value),PI=ol?TI(ol,kI):!1;return OI?PI:!PI});return new k(Il)}case"map":{let[,OI]=this.evaluateArguments(QI.args,aI);if(OI.has("attribute")){let uI=OI.get("attribute");if(!(uI instanceof L))throw new Error("attribute must be a string");let wI=OI.get("default"),kI=lI.value.map(TI=>{if(!(TI instanceof FI))throw new Error("items in map must be an object");return TI.value.get(uI.value)??wI??new O});return new k(kI)}else throw new Error("`map` expressions without `attribute` set are not currently supported.")}}throw new Error(`Unknown ArrayValue filter: ${vI}`)}else if(lI instanceof L){switch(vI){case"indent":{let[OI,uI]=this.evaluateArguments(QI.args,aI),wI=OI.at(0)??uI.get("width")??new zI(4);if(!(wI instanceof zI))throw new Error("width must be a number");let kI=OI.at(1)??uI.get("first")??new bI(!1),TI=OI.at(2)??uI.get("blank")??new bI(!1),Il=lI.value.split(`
`),nl=" ".repeat(wI.value),ol=Il.map((PI,KI)=>!kI.value&&KI===0||!TI.value&&PI.length===0?PI:nl+PI);return new L(ol.join(`
`))}}throw new Error(`Unknown StringValue filter: ${vI}`)}else throw new Error(`Cannot apply filter "${vI}" to type: ${lI.type}`)}throw new Error(`Unknown filter: ${B.filter.type}`)}evaluateTestExpression(B,aI){let lI=this.evaluate(B.operand,aI),QI=aI.tests.get(B.test.value);if(!QI)throw new Error(`Unknown test: ${B.test.value}`);let vI=QI(lI);return new bI(B.negate?!vI:vI)}evaluateUnaryExpression(B,aI){let lI=this.evaluate(B.argument,aI);switch(B.operator.value){case"not":return new bI(!lI.value);default:throw new SyntaxError(`Unknown operator: ${B.operator.value}`)}}evalProgram(B,aI){return this.evaluateBlock(B.body,aI)}evaluateBlock(B,aI){let lI="";for(let QI of B){let vI=this.evaluate(QI,aI);vI.type!=="NullValue"&&vI.type!=="UndefinedValue"&&(lI+=vI.value)}return new L(lI)}evaluateIdentifier(B,aI){return aI.lookupVariable(B.value)}evaluateCallExpression(B,aI){let[lI,QI]=this.evaluateArguments(B.args,aI);QI.size>0&&lI.push(new U(QI));let vI=this.evaluate(B.callee,aI);if(vI.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${vI.type}`);return vI.value(lI,aI)}evaluateSliceExpression(B,aI,lI){if(!(B instanceof k||B instanceof L))throw new Error("Slice object must be an array or string");let QI=this.evaluate(aI.start,lI),vI=this.evaluate(aI.stop,lI),OI=this.evaluate(aI.step,lI);if(!(QI instanceof zI||QI instanceof O))throw new Error("Slice start must be numeric or undefined");if(!(vI instanceof zI||vI instanceof O))throw new Error("Slice stop must be numeric or undefined");if(!(OI instanceof zI||OI instanceof O))throw new Error("Slice step must be numeric or undefined");return B instanceof k?new k($(B.value,QI.value,vI.value,OI.value)):new L($(Array.from(B.value),QI.value,vI.value,OI.value).join(""))}evaluateMemberExpression(B,aI){let lI=this.evaluate(B.object,aI),QI;if(B.computed){if(B.property.type==="SliceExpression")return this.evaluateSliceExpression(lI,B.property,aI);QI=this.evaluate(B.property,aI)}else QI=new L(B.property.value);let vI;if(lI instanceof FI){if(!(QI instanceof L))throw new Error(`Cannot access property with non-string: got ${QI.type}`);vI=lI.value.get(QI.value)??lI.builtins.get(QI.value)}else if(lI instanceof k||lI instanceof L)if(QI instanceof zI)vI=lI.value.at(QI.value),lI instanceof L&&(vI=new L(lI.value.at(QI.value)));else if(QI instanceof L)vI=lI.builtins.get(QI.value);else throw new Error(`Cannot access property with non-string/non-number: got ${QI.type}`);else{if(!(QI instanceof L))throw new Error(`Cannot access property with non-string: got ${QI.type}`);vI=lI.builtins.get(QI.value)}return vI instanceof UI?vI:new O}evaluateSet(B,aI){let lI=this.evaluate(B.value,aI);if(B.assignee.type==="Identifier"){let QI=B.assignee.value;aI.setVariable(QI,lI)}else if(B.assignee.type==="MemberExpression"){let QI=B.assignee,vI=this.evaluate(QI.object,aI);if(!(vI instanceof FI))throw new Error("Cannot assign to member of non-object");if(QI.property.type!=="Identifier")throw new Error("Cannot assign to member with non-identifier property");vI.value.set(QI.property.value,lI)}else throw new Error(`Invalid LHS inside assignment expression: ${JSON.stringify(B.assignee)}`);return new A}evaluateIf(B,aI){let lI=this.evaluate(B.test,aI);return this.evaluateBlock(lI.__bool__().value?B.body:B.alternate,aI)}evaluateFor(B,aI){let lI=new K(aI),QI,vI;if(B.iterable.type==="SelectExpression"){let TI=B.iterable;vI=this.evaluate(TI.iterable,lI),QI=TI.test}else vI=this.evaluate(B.iterable,lI);if(!(vI instanceof k))throw new Error(`Expected iterable type in for loop: got ${vI.type}`);let OI=[],uI=[];for(let TI=0;TI<vI.value.length;++TI){let Il=new K(lI),nl=vI.value[TI],ol;if(B.loopvar.type==="Identifier")ol=PI=>PI.setVariable(B.loopvar.value,nl);else if(B.loopvar.type==="TupleLiteral"){let PI=B.loopvar;if(nl.type!=="ArrayValue")throw new Error(`Cannot unpack non-iterable type: ${nl.type}`);let KI=nl;if(PI.value.length!==KI.value.length)throw new Error(`Too ${PI.value.length>KI.value.length?"few":"many"} items to unpack`);ol=jI=>{for(let Wl=0;Wl<PI.value.length;++Wl){if(PI.value[Wl].type!=="Identifier")throw new Error(`Cannot unpack non-identifier type: ${PI.value[Wl].type}`);jI.setVariable(PI.value[Wl].value,KI.value[Wl])}}}else throw new Error(`Invalid loop variable(s): ${B.loopvar.type}`);QI&&(ol(Il),!this.evaluate(QI,Il).__bool__().value)||(OI.push(nl),uI.push(ol))}let wI="",kI=!0;for(let TI=0;TI<OI.length;++TI){let Il=new Map([["index",new zI(TI+1)],["index0",new zI(TI)],["revindex",new zI(OI.length-TI)],["revindex0",new zI(OI.length-TI-1)],["first",new bI(TI===0)],["last",new bI(TI===OI.length-1)],["length",new zI(OI.length)],["previtem",TI>0?OI[TI-1]:new O],["nextitem",TI<OI.length-1?OI[TI+1]:new O]]);lI.setVariable("loop",new FI(Il)),uI[TI](lI);let nl=this.evaluateBlock(B.body,lI);wI+=nl.value,kI=!1}if(kI){let TI=this.evaluateBlock(B.defaultBlock,lI);wI+=TI.value}return new L(wI)}evaluateMacro(B,aI){return aI.setVariable(B.name.value,new r((lI,QI)=>{let vI=new K(QI);lI=lI.slice();let OI;lI.at(-1)?.type==="KeywordArgumentsValue"&&(OI=lI.pop());for(let uI=0;uI<B.args.length;++uI){let wI=B.args[uI],kI=lI[uI];if(wI.type==="Identifier"){let TI=wI;if(!kI)throw new Error(`Missing positional argument: ${TI.value}`);vI.setVariable(TI.value,kI)}else if(wI.type==="KeywordArgumentExpression"){let TI=wI,Il=kI??OI?.value.get(TI.key.value)??this.evaluate(TI.value,vI);vI.setVariable(TI.key.value,Il)}else throw new Error(`Unknown argument type: ${wI.type}`)}return this.evaluateBlock(B.body,vI)})),new A}evaluate(B,aI){if(B===void 0)return new O;switch(B.type){case"Program":return this.evalProgram(B,aI);case"Set":return this.evaluateSet(B,aI);case"If":return this.evaluateIf(B,aI);case"For":return this.evaluateFor(B,aI);case"Macro":return this.evaluateMacro(B,aI);case"NumericLiteral":return new zI(Number(B.value));case"StringLiteral":return new L(B.value);case"BooleanLiteral":return new bI(B.value);case"NullLiteral":return new A(B.value);case"ArrayLiteral":return new k(B.value.map(lI=>this.evaluate(lI,aI)));case"TupleLiteral":return new w(B.value.map(lI=>this.evaluate(lI,aI)));case"ObjectLiteral":{let lI=new Map;for(let[QI,vI]of B.value){let OI=this.evaluate(QI,aI);if(!(OI instanceof L))throw new Error(`Object keys must be strings: got ${OI.type}`);lI.set(OI.value,this.evaluate(vI,aI))}return new FI(lI)}case"Identifier":return this.evaluateIdentifier(B,aI);case"CallExpression":return this.evaluateCallExpression(B,aI);case"MemberExpression":return this.evaluateMemberExpression(B,aI);case"UnaryExpression":return this.evaluateUnaryExpression(B,aI);case"BinaryExpression":return this.evaluateBinaryExpression(B,aI);case"FilterExpression":return this.evaluateFilterExpression(B,aI);case"TestExpression":return this.evaluateTestExpression(B,aI);default:throw new SyntaxError(`Unknown node type: ${B.type}`)}}};function GI(B){switch(typeof B){case"number":return new zI(B);case"string":return new L(B);case"boolean":return new bI(B);case"undefined":return new O;case"object":return B===null?new A:Array.isArray(B)?new k(B.map(GI)):new FI(new Map(Object.entries(B).map(([aI,lI])=>[aI,GI(lI)])));case"function":return new r((aI,lI)=>{let QI=B(...aI.map(vI=>vI.value))??null;return GI(QI)});default:throw new Error(`Cannot convert to runtime value: ${B}`)}}function tI(B,aI,lI){let QI=lI??0;switch(B.type){case"NullValue":case"UndefinedValue":return"null";case"NumericValue":case"StringValue":case"BooleanValue":return JSON.stringify(B.value);case"ArrayValue":case"ObjectValue":{let vI=aI?" ".repeat(aI):"",OI=`
`+vI.repeat(QI),uI=OI+vI;if(B.type==="ArrayValue"){let wI=B.value.map(kI=>tI(kI,aI,QI+1));return aI?`[${uI}${wI.join(`,${uI}`)}${OI}]`:`[${wI.join(", ")}]`}else{let wI=Array.from(B.value.entries()).map(([kI,TI])=>{let Il=`"${kI}": ${tI(TI,aI,QI+1)}`;return aI?`${uI}${Il}`:Il});return aI?`{${wI.join(",")}${OI}}`:`{${wI.join(", ")}}`}}default:throw new Error(`Cannot convert to JSON: ${B.type}`)}}var iI=class{parsed;constructor(B){let aI=m(B,{lstrip_blocks:!0,trim_blocks:!0});this.parsed=HI(aI)}render(B){let aI=new K;if(aI.set("false",!1),aI.set("true",!0),aI.set("raise_exception",vI=>{throw new Error(vI)}),aI.set("range",YI),B)for(let[vI,OI]of Object.entries(B))aI.set(vI,OI);return new q(aI).run(this.parsed).value}}},"./node_modules/onnxruntime-common/dist/esm/backend-impl.js":(I,G,l)=>{l.r(G),l.d(G,{registerBackend:()=>e,resolveBackendAndExecutionProviders:()=>W});let b=new Map,d=[],e=(n,s,N)=>{if(s&&typeof s.init=="function"&&typeof s.createInferenceSessionHandler=="function"){let m=b.get(n);if(m===void 0)b.set(n,{backend:s,priority:N});else{if(m.priority>N)return;if(m.priority===N&&m.backend!==s)throw new Error(`cannot register backend "${n}" using priority ${N}`)}if(N>=0){let h=d.indexOf(n);h!==-1&&d.splice(h,1);for(let V=0;V<d.length;V++)if(b.get(d[V]).priority<=N){d.splice(V,0,n);return}d.push(n)}return}throw new TypeError("not a valid backend")},t=async n=>{let s=b.get(n);if(!s)return"backend not found.";if(s.initialized)return s.backend;if(s.aborted)return s.error;{let N=!!s.initPromise;try{return N||(s.initPromise=s.backend.init(n)),await s.initPromise,s.initialized=!0,s.backend}catch(m){return N||(s.error=`${m}`,s.aborted=!0),s.error}finally{delete s.initPromise}}},W=async n=>{let s=n.executionProviders||[],N=s.map(F=>typeof F=="string"?F:F.name),m=N.length===0?d:N,h,V=[],X=new Set;for(let F of m){let a=await t(F);typeof a=="string"?V.push({name:F,err:a}):(h||(h=a),h===a&&X.add(F))}if(!h)throw new Error(`no available backend found. ERR: ${V.map(F=>`[${F.name}] ${F.err}`).join(", ")}`);for(let{name:F,err:a}of V)N.includes(F)&&console.warn(`removing requested execution provider "${F}" from session options because it is not available: ${a}`);let p=s.filter(F=>X.has(typeof F=="string"?F:F.name));return[h,new Proxy(n,{get:(F,a)=>a==="executionProviders"?p:Reflect.get(F,a)})]}},"./node_modules/onnxruntime-common/dist/esm/backend.js":(I,G,l)=>{l.r(G),l.d(G,{registerBackend:()=>b.registerBackend});var b=l("./node_modules/onnxruntime-common/dist/esm/backend-impl.js")},"./node_modules/onnxruntime-common/dist/esm/env-impl.js":(I,G,l)=>{l.r(G),l.d(G,{env:()=>e});var b=l("./node_modules/onnxruntime-common/dist/esm/version.js");let d="warning",e={wasm:{},webgl:{},webgpu:{},versions:{common:b.version},set logLevel(t){if(t!==void 0){if(typeof t!="string"||["verbose","info","warning","error","fatal"].indexOf(t)===-1)throw new Error(`Unsupported logging level: ${t}`);d=t}},get logLevel(){return d}};Object.defineProperty(e,"logLevel",{enumerable:!0})},"./node_modules/onnxruntime-common/dist/esm/env.js":(I,G,l)=>{l.r(G),l.d(G,{env:()=>d});var b=l("./node_modules/onnxruntime-common/dist/esm/env-impl.js");let d=b.env},"./node_modules/onnxruntime-common/dist/esm/index.js":(I,G,l)=>{l.r(G),l.d(G,{InferenceSession:()=>e.InferenceSession,TRACE:()=>s.TRACE,TRACE_FUNC_BEGIN:()=>s.TRACE_FUNC_BEGIN,TRACE_FUNC_END:()=>s.TRACE_FUNC_END,Tensor:()=>t.Tensor,TrainingSession:()=>h.TrainingSession,env:()=>d.env,registerBackend:()=>b.registerBackend});var b=l("./node_modules/onnxruntime-common/dist/esm/backend.js"),d=l("./node_modules/onnxruntime-common/dist/esm/env.js"),e=l("./node_modules/onnxruntime-common/dist/esm/inference-session.js"),t=l("./node_modules/onnxruntime-common/dist/esm/tensor.js"),W=l("./node_modules/onnxruntime-common/dist/esm/tensor-conversion.js"),n=l("./node_modules/onnxruntime-common/dist/esm/tensor-factory.js"),s=l("./node_modules/onnxruntime-common/dist/esm/trace.js"),N=l("./node_modules/onnxruntime-common/dist/esm/onnx-model.js"),m=l("./node_modules/onnxruntime-common/dist/esm/onnx-value.js"),h=l("./node_modules/onnxruntime-common/dist/esm/training-session.js")},"./node_modules/onnxruntime-common/dist/esm/inference-session-impl.js":(I,G,l)=>{l.r(G),l.d(G,{InferenceSession:()=>t});var b=l("./node_modules/onnxruntime-common/dist/esm/backend-impl.js"),d=l("./node_modules/onnxruntime-common/dist/esm/tensor.js"),e=l("./node_modules/onnxruntime-common/dist/esm/trace.js");class t{constructor(n){this.handler=n}async run(n,s,N){(0,e.TRACE_FUNC_BEGIN)();let m={},h={};if(typeof n!="object"||n===null||n instanceof d.Tensor||Array.isArray(n))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let V=!0;if(typeof s=="object"){if(s===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(s instanceof d.Tensor)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(s)){if(s.length===0)throw new TypeError("'fetches' cannot be an empty array.");V=!1;for(let F of s){if(typeof F!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(F)===-1)throw new RangeError(`'fetches' contains invalid output name: ${F}.`);m[F]=null}if(typeof N=="object"&&N!==null)h=N;else if(typeof N<"u")throw new TypeError("'options' must be an object.")}else{let F=!1,a=Object.getOwnPropertyNames(s);for(let u of this.outputNames)if(a.indexOf(u)!==-1){let Q=s[u];(Q===null||Q instanceof d.Tensor)&&(F=!0,V=!1,m[u]=Q)}if(F){if(typeof N=="object"&&N!==null)h=N;else if(typeof N<"u")throw new TypeError("'options' must be an object.")}else h=s}}else if(typeof s<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let F of this.inputNames)if(typeof n[F]>"u")throw new Error(`input '${F}' is missing in 'feeds'.`);if(V)for(let F of this.outputNames)m[F]=null;let X=await this.handler.run(n,m,h),p={};for(let F in X)if(Object.hasOwnProperty.call(X,F)){let a=X[F];a instanceof d.Tensor?p[F]=a:p[F]=new d.Tensor(a.type,a.data,a.dims)}return(0,e.TRACE_FUNC_END)(),p}async release(){return this.handler.dispose()}static async create(n,s,N,m){(0,e.TRACE_FUNC_BEGIN)();let h,V={};if(typeof n=="string"){if(h=n,typeof s=="object"&&s!==null)V=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(n instanceof Uint8Array){if(h=n,typeof s=="object"&&s!==null)V=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(n instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&n instanceof SharedArrayBuffer){let a=n,u=0,Q=n.byteLength;if(typeof s=="object"&&s!==null)V=s;else if(typeof s=="number"){if(u=s,!Number.isSafeInteger(u))throw new RangeError("'byteOffset' must be an integer.");if(u<0||u>=a.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${a.byteLength}).`);if(Q=n.byteLength-u,typeof N=="number"){if(Q=N,!Number.isSafeInteger(Q))throw new RangeError("'byteLength' must be an integer.");if(Q<=0||u+Q>a.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${a.byteLength-u}].`);if(typeof m=="object"&&m!==null)V=m;else if(typeof m<"u")throw new TypeError("'options' must be an object.")}else if(typeof N<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof s<"u")throw new TypeError("'options' must be an object.");h=new Uint8Array(a,u,Q)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[X,p]=await(0,b.resolveBackendAndExecutionProviders)(V),F=await X.createInferenceSessionHandler(h,p);return(0,e.TRACE_FUNC_END)(),new t(F)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}},"./node_modules/onnxruntime-common/dist/esm/inference-session.js":(I,G,l)=>{l.r(G),l.d(G,{InferenceSession:()=>d});var b=l("./node_modules/onnxruntime-common/dist/esm/inference-session-impl.js");let d=b.InferenceSession},"./node_modules/onnxruntime-common/dist/esm/onnx-model.js":(I,G,l)=>{l.r(G)},"./node_modules/onnxruntime-common/dist/esm/onnx-value.js":(I,G,l)=>{l.r(G)},"./node_modules/onnxruntime-common/dist/esm/tensor-conversion-impl.js":(I,G,l)=>{l.r(G),l.d(G,{tensorToDataURL:()=>b,tensorToImageData:()=>d});let b=(e,t)=>{let W=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);W.width=e.dims[3],W.height=e.dims[2];let n=W.getContext("2d");if(n!=null){let s,N;t?.tensorLayout!==void 0&&t.tensorLayout==="NHWC"?(s=e.dims[2],N=e.dims[3]):(s=e.dims[3],N=e.dims[2]);let m=t?.format!==void 0?t.format:"RGB",h=t?.norm,V,X;h===void 0||h.mean===void 0?V=[255,255,255,255]:typeof h.mean=="number"?V=[h.mean,h.mean,h.mean,h.mean]:(V=[h.mean[0],h.mean[1],h.mean[2],0],h.mean[3]!==void 0&&(V[3]=h.mean[3])),h===void 0||h.bias===void 0?X=[0,0,0,0]:typeof h.bias=="number"?X=[h.bias,h.bias,h.bias,h.bias]:(X=[h.bias[0],h.bias[1],h.bias[2],0],h.bias[3]!==void 0&&(X[3]=h.bias[3]));let p=N*s,F=0,a=p,u=p*2,Q=-1;m==="RGBA"?(F=0,a=p,u=p*2,Q=p*3):m==="RGB"?(F=0,a=p,u=p*2):m==="RBG"&&(F=0,u=p,a=p*2);for(let o=0;o<N;o++)for(let y=0;y<s;y++){let H=(e.data[F++]-X[0])*V[0],E=(e.data[a++]-X[1])*V[1],C=(e.data[u++]-X[2])*V[2],T=Q===-1?255:(e.data[Q++]-X[3])*V[3];n.fillStyle="rgba("+H+","+E+","+C+","+T+")",n.fillRect(y,o,1,1)}if("toDataURL"in W)return W.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},d=(e,t)=>{let W=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),n;if(W!=null){let s,N,m;t?.tensorLayout!==void 0&&t.tensorLayout==="NHWC"?(s=e.dims[2],N=e.dims[1],m=e.dims[3]):(s=e.dims[3],N=e.dims[2],m=e.dims[1]);let h=t!==void 0&&t.format!==void 0?t.format:"RGB",V=t?.norm,X,p;V===void 0||V.mean===void 0?X=[255,255,255,255]:typeof V.mean=="number"?X=[V.mean,V.mean,V.mean,V.mean]:(X=[V.mean[0],V.mean[1],V.mean[2],255],V.mean[3]!==void 0&&(X[3]=V.mean[3])),V===void 0||V.bias===void 0?p=[0,0,0,0]:typeof V.bias=="number"?p=[V.bias,V.bias,V.bias,V.bias]:(p=[V.bias[0],V.bias[1],V.bias[2],0],V.bias[3]!==void 0&&(p[3]=V.bias[3]));let F=N*s;if(t!==void 0&&(t.format!==void 0&&m===4&&t.format!=="RGBA"||m===3&&t.format!=="RGB"&&t.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let a=4,u=0,Q=1,o=2,y=3,H=0,E=F,C=F*2,T=-1;h==="RGBA"?(H=0,E=F,C=F*2,T=F*3):h==="RGB"?(H=0,E=F,C=F*2):h==="RBG"&&(H=0,C=F,E=F*2),n=W.createImageData(s,N);for(let S=0;S<N*s;u+=a,Q+=a,o+=a,y+=a,S++)n.data[u]=(e.data[H++]-p[0])*X[0],n.data[Q]=(e.data[E++]-p[1])*X[1],n.data[o]=(e.data[C++]-p[2])*X[2],n.data[y]=T===-1?255:(e.data[T++]-p[3])*X[3]}else throw new Error("Can not access image data");return n}},"./node_modules/onnxruntime-common/dist/esm/tensor-conversion.js":(I,G,l)=>{l.r(G)},"./node_modules/onnxruntime-common/dist/esm/tensor-factory-impl.js":(I,G,l)=>{l.r(G),l.d(G,{bufferToTensor:()=>d,tensorFromGpuBuffer:()=>W,tensorFromImage:()=>e,tensorFromMLTensor:()=>n,tensorFromPinnedBuffer:()=>s,tensorFromTexture:()=>t});var b=l("./node_modules/onnxruntime-common/dist/esm/tensor-impl.js");let d=(N,m)=>{if(N===void 0)throw new Error("Image buffer must be defined");if(m.height===void 0||m.width===void 0)throw new Error("Image height and width must be defined");if(m.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:h,width:V}=m,X=m.norm??{mean:255,bias:0},p,F;typeof X.mean=="number"?p=[X.mean,X.mean,X.mean,X.mean]:p=[X.mean[0],X.mean[1],X.mean[2],X.mean[3]??255],typeof X.bias=="number"?F=[X.bias,X.bias,X.bias,X.bias]:F=[X.bias[0],X.bias[1],X.bias[2],X.bias[3]??0];let a=m.format!==void 0?m.format:"RGBA",u=m.tensorFormat!==void 0&&m.tensorFormat!==void 0?m.tensorFormat:"RGB",Q=h*V,o=u==="RGBA"?new Float32Array(Q*4):new Float32Array(Q*3),y=4,H=0,E=1,C=2,T=3,S=0,cI=Q,hI=Q*2,WI=-1;a==="RGB"&&(y=3,H=0,E=1,C=2,T=-1),u==="RGBA"?WI=Q*3:u==="RBG"?(S=0,hI=Q,cI=Q*2):u==="BGR"&&(hI=0,cI=Q,S=Q*2);for(let sI=0;sI<Q;sI++,H+=y,C+=y,E+=y,T+=y)o[S++]=(N[H]+F[0])/p[0],o[cI++]=(N[E]+F[1])/p[1],o[hI++]=(N[C]+F[2])/p[2],WI!==-1&&T!==-1&&(o[WI++]=(N[T]+F[3])/p[3]);return u==="RGBA"?new b.Tensor("float32",o,[1,4,h,V]):new b.Tensor("float32",o,[1,3,h,V])},e=async(N,m)=>{let h=typeof HTMLImageElement<"u"&&N instanceof HTMLImageElement,V=typeof ImageData<"u"&&N instanceof ImageData,X=typeof ImageBitmap<"u"&&N instanceof ImageBitmap,p=typeof N=="string",F,a=m??{},u=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},Q=o=>typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||o instanceof OffscreenCanvas?o.getContext("2d"):null;if(h){let o=u();o.width=N.width,o.height=N.height;let y=Q(o);if(y!=null){let H=N.height,E=N.width;if(m!==void 0&&m.resizedHeight!==void 0&&m.resizedWidth!==void 0&&(H=m.resizedHeight,E=m.resizedWidth),m!==void 0){if(a=m,m.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");a.tensorFormat="RGBA",a.height=H,a.width=E}else a.tensorFormat="RGBA",a.height=H,a.width=E;y.drawImage(N,0,0),F=y.getImageData(0,0,E,H).data}else throw new Error("Can not access image data")}else if(V){let o,y;if(m!==void 0&&m.resizedWidth!==void 0&&m.resizedHeight!==void 0?(o=m.resizedHeight,y=m.resizedWidth):(o=N.height,y=N.width),m!==void 0&&(a=m),a.format="RGBA",a.height=o,a.width=y,m!==void 0){let H=u();H.width=y,H.height=o;let E=Q(H);if(E!=null)E.putImageData(N,0,0),F=E.getImageData(0,0,y,o).data;else throw new Error("Can not access image data")}else F=N.data}else if(X){if(m===void 0)throw new Error("Please provide image config with format for Imagebitmap");let o=u();o.width=N.width,o.height=N.height;let y=Q(o);if(y!=null){let H=N.height,E=N.width;return y.drawImage(N,0,0,E,H),F=y.getImageData(0,0,E,H).data,a.height=H,a.width=E,d(F,a)}else throw new Error("Can not access image data")}else{if(p)return new Promise((o,y)=>{let H=u(),E=Q(H);if(!N||!E)return y();let C=new Image;C.crossOrigin="Anonymous",C.src=N,C.onload=()=>{H.width=C.width,H.height=C.height,E.drawImage(C,0,0,H.width,H.height);let T=E.getImageData(0,0,H.width,H.height);a.height=H.height,a.width=H.width,o(d(T.data,a))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(F!==void 0)return d(F,a);throw new Error("Input data provided is not supported - aborted tensor creation")},t=(N,m)=>{let{width:h,height:V,download:X,dispose:p}=m,F=[1,V,h,4];return new b.Tensor({location:"texture",type:"float32",texture:N,dims:F,download:X,dispose:p})},W=(N,m)=>{let{dataType:h,dims:V,download:X,dispose:p}=m;return new b.Tensor({location:"gpu-buffer",type:h??"float32",gpuBuffer:N,dims:V,download:X,dispose:p})},n=(N,m)=>{let{dataType:h,dims:V,download:X,dispose:p}=m;return new b.Tensor({location:"ml-tensor",type:h??"float32",mlTensor:N,dims:V,download:X,dispose:p})},s=(N,m,h)=>new b.Tensor({location:"cpu-pinned",type:N,data:m,dims:h??[m.length]})},"./node_modules/onnxruntime-common/dist/esm/tensor-factory.js":(I,G,l)=>{l.r(G)},"./node_modules/onnxruntime-common/dist/esm/tensor-impl-type-mapping.js":(I,G,l)=>{l.r(G),l.d(G,{NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP:()=>d,NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP:()=>b,checkTypedArray:()=>t});let b=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),d=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),e=!1,t=()=>{if(!e){e=!0;let W=typeof BigInt64Array<"u"&&BigInt64Array.from,n=typeof BigUint64Array<"u"&&BigUint64Array.from,s=typeof Float16Array<"u"&&Float16Array.from;W&&(b.set("int64",BigInt64Array),d.set(BigInt64Array,"int64")),n&&(b.set("uint64",BigUint64Array),d.set(BigUint64Array,"uint64")),s?(b.set("float16",Float16Array),d.set(Float16Array,"float16")):b.set("float16",Uint16Array)}}},"./node_modules/onnxruntime-common/dist/esm/tensor-impl.js":(I,G,l)=>{l.r(G),l.d(G,{Tensor:()=>W});var b=l("./node_modules/onnxruntime-common/dist/esm/tensor-conversion-impl.js"),d=l("./node_modules/onnxruntime-common/dist/esm/tensor-factory-impl.js"),e=l("./node_modules/onnxruntime-common/dist/esm/tensor-impl-type-mapping.js"),t=l("./node_modules/onnxruntime-common/dist/esm/tensor-utils-impl.js");class W{constructor(s,N,m){(0,e.checkTypedArray)();let h,V;if(typeof s=="object"&&"location"in s)switch(this.dataLocation=s.location,h=s.type,V=s.dims,s.location){case"cpu-pinned":{let p=e.NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.get(h);if(!p)throw new TypeError(`unsupported type "${h}" to create tensor from pinned buffer`);if(!(s.data instanceof p))throw new TypeError(`buffer should be of type ${p.name}`);this.cpuData=s.data;break}case"texture":{if(h!=="float32")throw new TypeError(`unsupported type "${h}" to create tensor from texture`);this.gpuTextureData=s.texture,this.downloader=s.download,this.disposer=s.dispose;break}case"gpu-buffer":{if(h!=="float32"&&h!=="float16"&&h!=="int32"&&h!=="int64"&&h!=="uint32"&&h!=="uint8"&&h!=="bool"&&h!=="uint4"&&h!=="int4")throw new TypeError(`unsupported type "${h}" to create tensor from gpu buffer`);this.gpuBufferData=s.gpuBuffer,this.downloader=s.download,this.disposer=s.dispose;break}case"ml-tensor":{if(h!=="float32"&&h!=="float16"&&h!=="int32"&&h!=="int64"&&h!=="uint32"&&h!=="uint64"&&h!=="int8"&&h!=="uint8"&&h!=="bool")throw new TypeError(`unsupported type "${h}" to create tensor from MLTensor`);this.mlTensorData=s.mlTensor,this.downloader=s.download,this.disposer=s.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let p,F;if(typeof s=="string")if(h=s,F=m,s==="string"){if(!Array.isArray(N))throw new TypeError("A string tensor's data must be a string array.");p=N}else{let a=e.NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.get(s);if(a===void 0)throw new TypeError(`Unsupported tensor type: ${s}.`);if(Array.isArray(N)){if(s==="float16"&&a===Uint16Array||s==="uint4"||s==="int4")throw new TypeError(`Creating a ${s} tensor from number array is not supported. Please use ${a.name} as data.`);s==="uint64"||s==="int64"?p=a.from(N,BigInt):p=a.from(N)}else if(N instanceof a)p=N;else if(N instanceof Uint8ClampedArray)if(s==="uint8")p=Uint8Array.from(N);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else throw new TypeError(`A ${h} tensor's data must be type of ${a}`)}else if(F=N,Array.isArray(s)){if(s.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let a=typeof s[0];if(a==="string")h="string",p=s;else if(a==="boolean")h="bool",p=Uint8Array.from(s);else throw new TypeError(`Invalid element type of data array: ${a}.`)}else if(s instanceof Uint8ClampedArray)h="uint8",p=Uint8Array.from(s);else{let a=e.NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP.get(s.constructor);if(a===void 0)throw new TypeError(`Unsupported type for tensor data: ${s.constructor}.`);h=a,p=s}if(F===void 0)F=[p.length];else if(!Array.isArray(F))throw new TypeError("A tensor's dims must be a number array");V=F,this.cpuData=p,this.dataLocation="cpu"}let X=(0,t.calculateSize)(V);if(this.cpuData&&X!==this.cpuData.length&&!((h==="uint4"||h==="int4")&&Math.ceil(X/2)===this.cpuData.length))throw new Error(`Tensor's size(${X}) does not match data length(${this.cpuData.length}).`);this.type=h,this.dims=V,this.size=X}static async fromImage(s,N){return(0,d.tensorFromImage)(s,N)}static fromTexture(s,N){return(0,d.tensorFromTexture)(s,N)}static fromGpuBuffer(s,N){return(0,d.tensorFromGpuBuffer)(s,N)}static fromMLTensor(s,N){return(0,d.tensorFromMLTensor)(s,N)}static fromPinnedBuffer(s,N,m){return(0,d.tensorFromPinnedBuffer)(s,N,m)}toDataURL(s){return(0,b.tensorToDataURL)(this,s)}toImageData(s){return(0,b.tensorToImageData)(this,s)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(s){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let N=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=N,s&&this.disposer&&(this.disposer(),this.disposer=void 0),N}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(s){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return(0,t.tensorReshape)(this,s)}}},"./node_modules/onnxruntime-common/dist/esm/tensor-utils-impl.js":(I,G,l)=>{l.r(G),l.d(G,{calculateSize:()=>d,tensorReshape:()=>e});var b=l("./node_modules/onnxruntime-common/dist/esm/tensor-impl.js");let d=t=>{let W=1;for(let n=0;n<t.length;n++){let s=t[n];if(typeof s!="number"||!Number.isSafeInteger(s))throw new TypeError(`dims[${n}] must be an integer, got: ${s}`);if(s<0)throw new RangeError(`dims[${n}] must be a non-negative integer, got: ${s}`);W*=s}return W},e=(t,W)=>{switch(t.location){case"cpu":return new b.Tensor(t.type,t.data,W);case"cpu-pinned":return new b.Tensor({location:"cpu-pinned",data:t.data,type:t.type,dims:W});case"texture":return new b.Tensor({location:"texture",texture:t.texture,type:t.type,dims:W});case"gpu-buffer":return new b.Tensor({location:"gpu-buffer",gpuBuffer:t.gpuBuffer,type:t.type,dims:W});case"ml-tensor":return new b.Tensor({location:"ml-tensor",mlTensor:t.mlTensor,type:t.type,dims:W});default:throw new Error(`tensorReshape: tensor location ${t.location} is not supported`)}}},"./node_modules/onnxruntime-common/dist/esm/tensor.js":(I,G,l)=>{l.r(G),l.d(G,{Tensor:()=>d});var b=l("./node_modules/onnxruntime-common/dist/esm/tensor-impl.js");let d=b.Tensor},"./node_modules/onnxruntime-common/dist/esm/trace.js":(I,G,l)=>{l.r(G),l.d(G,{TRACE:()=>d,TRACE_FUNC_BEGIN:()=>t,TRACE_FUNC_END:()=>W});var b=l("./node_modules/onnxruntime-common/dist/esm/env-impl.js");let d=(n,s)=>{(typeof b.env.trace>"u"?!b.env.wasm.trace:!b.env.trace)||console.timeStamp(`${n}::ORT::${s}`)},e=(n,s)=>{let N=new Error().stack?.split(/\r\n|\r|\n/g)||[],m=!1;for(let h=0;h<N.length;h++){if(m&&!N[h].includes("TRACE_FUNC")){let V=`FUNC_${n}::${N[h].trim().split(" ")[1]}`;s&&(V+=`::${s}`),d("CPU",V);return}N[h].includes("TRACE_FUNC")&&(m=!0)}},t=n=>{(typeof b.env.trace>"u"?!b.env.wasm.trace:!b.env.trace)||e("BEGIN",n)},W=n=>{(typeof b.env.trace>"u"?!b.env.wasm.trace:!b.env.trace)||e("END",n)}},"./node_modules/onnxruntime-common/dist/esm/training-session-impl.js":(I,G,l)=>{l.r(G),l.d(G,{TrainingSession:()=>t});var b=l("./node_modules/onnxruntime-common/dist/esm/backend-impl.js"),d=l("./node_modules/onnxruntime-common/dist/esm/tensor.js");let e="Training backend could not be resolved. Make sure you're using the correct configuration & WebAssembly files.";class t{constructor(n,s,N){this.handler=n,this.hasOptimizerModel=s,this.hasEvalModel=N}get trainingInputNames(){return this.handler.inputNames}get trainingOutputNames(){return this.handler.outputNames}get evalInputNames(){if(this.hasEvalModel)return this.handler.evalInputNames;throw new Error("This training session has no evalModel loaded.")}get evalOutputNames(){if(this.hasEvalModel)return this.handler.evalOutputNames;throw new Error("This training session has no evalModel loaded.")}static async create(n,s){let N=n.evalModel||"",m=n.optimizerModel||"",h=s||{},[V,X]=await(0,b.resolveBackendAndExecutionProviders)(h);if(V.createTrainingSessionHandler){let p=await V.createTrainingSessionHandler(n.checkpointState,n.trainModel,N,m,X);return new t(p,!!n.optimizerModel,!!n.evalModel)}else throw new Error(e)}typeNarrowingForRunStep(n,s,N,m,h){let V={},X={};if(typeof N!="object"||N===null||N instanceof d.Tensor||Array.isArray(N))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let p=!0;if(typeof m=="object"){if(m===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(m instanceof d.Tensor)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(m)){if(m.length===0)throw new TypeError("'fetches' cannot be an empty array.");p=!1;for(let F of m){if(typeof F!="string")throw new TypeError("'fetches' must be a string array or an object.");if(s.indexOf(F)===-1)throw new RangeError(`'fetches' contains invalid output name: ${F}.`);V[F]=null}if(typeof h=="object"&&h!==null)X=h;else if(typeof h<"u")throw new TypeError("'options' must be an object.")}else{let F=!1,a=Object.getOwnPropertyNames(m);for(let u of s)if(a.indexOf(u)!==-1){let Q=m[u];(Q===null||Q instanceof d.Tensor)&&(F=!0,p=!1,V[u]=Q)}if(F){if(typeof h=="object"&&h!==null)X=h;else if(typeof h<"u")throw new TypeError("'options' must be an object.")}else X=m}}else if(typeof m<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let F of n)if(typeof N[F]>"u")throw new Error(`input '${F}' is missing in 'feeds'.`);if(p)for(let F of s)V[F]=null;return[V,X]}convertHandlerReturnTypeToMapOfTensors(n){let s={};for(let N in n)if(Object.hasOwnProperty.call(n,N)){let m=n[N];m instanceof d.Tensor?s[N]=m:s[N]=new d.Tensor(m.type,m.data,m.dims)}return s}async lazyResetGrad(){await this.handler.lazyResetGrad()}async runTrainStep(n,s,N){let[m,h]=this.typeNarrowingForRunStep(this.trainingInputNames,this.trainingOutputNames,n,s,N),V=await this.handler.runTrainStep(n,m,h);return this.convertHandlerReturnTypeToMapOfTensors(V)}async runOptimizerStep(n){if(this.hasOptimizerModel)await this.handler.runOptimizerStep(n||{});else throw new Error("This TrainingSession has no OptimizerModel loaded.")}async runEvalStep(n,s,N){if(this.hasEvalModel){let[m,h]=this.typeNarrowingForRunStep(this.evalInputNames,this.evalOutputNames,n,s,N),V=await this.handler.runEvalStep(n,m,h);return this.convertHandlerReturnTypeToMapOfTensors(V)}else throw new Error("This TrainingSession has no EvalModel loaded.")}async getParametersSize(n=!0){return this.handler.getParametersSize(n)}async loadParametersBuffer(n,s=!0){let N=await this.getParametersSize(s);if(n.length!==4*N)throw new Error("Size of the buffer passed into loadParametersBuffer must match the number of parameters in the model. Please use getParametersSize method to check.");return this.handler.loadParametersBuffer(n,s)}async getContiguousParameters(n=!0){return this.handler.getContiguousParameters(n)}async release(){return this.handler.dispose()}}},"./node_modules/onnxruntime-common/dist/esm/training-session.js":(I,G,l)=>{l.r(G),l.d(G,{TrainingSession:()=>d});var b=l("./node_modules/onnxruntime-common/dist/esm/training-session-impl.js");let d=b.TrainingSession},"./node_modules/onnxruntime-common/dist/esm/version.js":(I,G,l)=>{l.r(G),l.d(G,{version:()=>b});let b="1.20.1"},"./node_modules/onnxruntime-web/dist/ort.bundle.min.mjs?3a96":(I,G,l)=>{l.r(G),l.d(G,{InferenceSession:()=>tI,TRACE:()=>w,TRACE_FUNC_BEGIN:()=>A,TRACE_FUNC_END:()=>O,Tensor:()=>U,default:()=>f1,env:()=>C,registerBackend:()=>X});var b=Object.defineProperty,d=Object.getOwnPropertyDescriptor,e=Object.getOwnPropertyNames,t=Object.prototype.hasOwnProperty,W=(c=>typeof oa<"u"?oa:typeof Proxy<"u"?new Proxy(c,{get:(Z,Y)=>(typeof oa<"u"?oa:Z)[Y]}):c)(function(c){if(typeof oa<"u")return oa.apply(this,arguments);throw Error('Dynamic require of "'+c+'" is not supported')}),n=(c,Z)=>()=>(c&&(Z=c(c=0)),Z),s=(c,Z)=>{for(var Y in Z)b(c,Y,{get:Z[Y],enumerable:!0})},N=(c,Z,Y,R)=>{if(Z&&typeof Z=="object"||typeof Z=="function")for(let i of e(Z))!t.call(c,i)&&i!==Y&&b(c,i,{get:()=>Z[i],enumerable:!(R=d(Z,i))||R.enumerable});return c},m=c=>N(b({},"__esModule",{value:!0}),c),h,V,X,p,F,a=n(()=>{"use strict";h=new Map,V=[],X=(c,Z,Y)=>{if(Z&&typeof Z.init=="function"&&typeof Z.createInferenceSessionHandler=="function"){let R=h.get(c);if(R===void 0)h.set(c,{backend:Z,priority:Y});else{if(R.priority>Y)return;if(R.priority===Y&&R.backend!==Z)throw new Error(`cannot register backend "${c}" using priority ${Y}`)}if(Y>=0){let i=V.indexOf(c);i!==-1&&V.splice(i,1);for(let v=0;v<V.length;v++)if(h.get(V[v]).priority<=Y){V.splice(v,0,c);return}V.push(c)}return}throw new TypeError("not a valid backend")},p=async c=>{let Z=h.get(c);if(!Z)return"backend not found.";if(Z.initialized)return Z.backend;if(Z.aborted)return Z.error;{let Y=!!Z.initPromise;try{return Y||(Z.initPromise=Z.backend.init(c)),await Z.initPromise,Z.initialized=!0,Z.backend}catch(R){return Y||(Z.error=`${R}`,Z.aborted=!0),Z.error}finally{delete Z.initPromise}}},F=async c=>{let Z=c.executionProviders||[],Y=Z.map(j=>typeof j=="string"?j:j.name),R=Y.length===0?V:Y,i,v=[],g=new Set;for(let j of R){let f=await p(j);typeof f=="string"?v.push({name:j,err:f}):(i||(i=f),i===f&&g.add(j))}if(!i)throw new Error(`no available backend found. ERR: ${v.map(j=>`[${j.name}] ${j.err}`).join(", ")}`);for(let{name:j,err:f}of v)Y.includes(j)&&console.warn(`removing requested execution provider "${j}" from session options because it is not available: ${f}`);let M=Z.filter(j=>g.has(typeof j=="string"?j:j.name));return[i,new Proxy(c,{get:(j,f)=>f==="executionProviders"?M:Reflect.get(j,f)})]}}),u=n(()=>{"use strict";a()}),Q,o=n(()=>{"use strict";Q="1.21.0-dev.20250206-d981b153d3"}),y,H,E=n(()=>{"use strict";o(),y="warning",H={wasm:{},webgl:{},webgpu:{},versions:{common:Q},set logLevel(c){if(c!==void 0){if(typeof c!="string"||["verbose","info","warning","error","fatal"].indexOf(c)===-1)throw new Error(`Unsupported logging level: ${c}`);y=c}},get logLevel(){return y}},Object.defineProperty(H,"logLevel",{enumerable:!0})}),C,T=n(()=>{"use strict";E(),C=H}),S,cI,hI=n(()=>{"use strict";S=(c,Z)=>{let Y=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);Y.width=c.dims[3],Y.height=c.dims[2];let R=Y.getContext("2d");if(R!=null){let i,v;Z?.tensorLayout!==void 0&&Z.tensorLayout==="NHWC"?(i=c.dims[2],v=c.dims[3]):(i=c.dims[3],v=c.dims[2]);let g=Z?.format!==void 0?Z.format:"RGB",M=Z?.norm,j,f;M===void 0||M.mean===void 0?j=[255,255,255,255]:typeof M.mean=="number"?j=[M.mean,M.mean,M.mean,M.mean]:(j=[M.mean[0],M.mean[1],M.mean[2],0],M.mean[3]!==void 0&&(j[3]=M.mean[3])),M===void 0||M.bias===void 0?f=[0,0,0,0]:typeof M.bias=="number"?f=[M.bias,M.bias,M.bias,M.bias]:(f=[M.bias[0],M.bias[1],M.bias[2],0],M.bias[3]!==void 0&&(f[3]=M.bias[3]));let mI=v*i,x=0,NI=mI,rI=mI*2,oI=-1;g==="RGBA"?(x=0,NI=mI,rI=mI*2,oI=mI*3):g==="RGB"?(x=0,NI=mI,rI=mI*2):g==="RBG"&&(x=0,rI=mI,NI=mI*2);for(let XI=0;XI<v;XI++)for(let xI=0;xI<i;xI++){let LI=(c.data[x++]-f[0])*j[0],EI=(c.data[NI++]-f[1])*j[1],MI=(c.data[rI++]-f[2])*j[2],SI=oI===-1?255:(c.data[oI++]-f[3])*j[3];R.fillStyle="rgba("+LI+","+EI+","+MI+","+SI+")",R.fillRect(xI,XI,1,1)}if("toDataURL"in Y)return Y.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},cI=(c,Z)=>{let Y=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),R;if(Y!=null){let i,v,g;Z?.tensorLayout!==void 0&&Z.tensorLayout==="NHWC"?(i=c.dims[2],v=c.dims[1],g=c.dims[3]):(i=c.dims[3],v=c.dims[2],g=c.dims[1]);let M=Z!==void 0&&Z.format!==void 0?Z.format:"RGB",j=Z?.norm,f,mI;j===void 0||j.mean===void 0?f=[255,255,255,255]:typeof j.mean=="number"?f=[j.mean,j.mean,j.mean,j.mean]:(f=[j.mean[0],j.mean[1],j.mean[2],255],j.mean[3]!==void 0&&(f[3]=j.mean[3])),j===void 0||j.bias===void 0?mI=[0,0,0,0]:typeof j.bias=="number"?mI=[j.bias,j.bias,j.bias,j.bias]:(mI=[j.bias[0],j.bias[1],j.bias[2],0],j.bias[3]!==void 0&&(mI[3]=j.bias[3]));let x=v*i;if(Z!==void 0&&(Z.format!==void 0&&g===4&&Z.format!=="RGBA"||g===3&&Z.format!=="RGB"&&Z.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let NI=4,rI=0,oI=1,XI=2,xI=3,LI=0,EI=x,MI=x*2,SI=-1;M==="RGBA"?(LI=0,EI=x,MI=x*2,SI=x*3):M==="RGB"?(LI=0,EI=x,MI=x*2):M==="RBG"&&(LI=0,MI=x,EI=x*2),R=Y.createImageData(i,v);for(let qI=0;qI<v*i;rI+=NI,oI+=NI,XI+=NI,xI+=NI,qI++)R.data[rI]=(c.data[LI++]-mI[0])*f[0],R.data[oI]=(c.data[EI++]-mI[1])*f[1],R.data[XI]=(c.data[MI++]-mI[2])*f[2],R.data[xI]=SI===-1?255:(c.data[SI++]-mI[3])*f[3]}else throw new Error("Can not access image data");return R}}),WI,VI,sI,ZI,dI,pI,yI=n(()=>{"use strict";FI(),WI=(c,Z)=>{if(c===void 0)throw new Error("Image buffer must be defined");if(Z.height===void 0||Z.width===void 0)throw new Error("Image height and width must be defined");if(Z.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:Y,width:R}=Z,i=Z.norm??{mean:255,bias:0},v,g;typeof i.mean=="number"?v=[i.mean,i.mean,i.mean,i.mean]:v=[i.mean[0],i.mean[1],i.mean[2],i.mean[3]??255],typeof i.bias=="number"?g=[i.bias,i.bias,i.bias,i.bias]:g=[i.bias[0],i.bias[1],i.bias[2],i.bias[3]??0];let M=Z.format!==void 0?Z.format:"RGBA",j=Z.tensorFormat!==void 0&&Z.tensorFormat!==void 0?Z.tensorFormat:"RGB",f=Y*R,mI=j==="RGBA"?new Float32Array(f*4):new Float32Array(f*3),x=4,NI=0,rI=1,oI=2,XI=3,xI=0,LI=f,EI=f*2,MI=-1;M==="RGB"&&(x=3,NI=0,rI=1,oI=2,XI=-1),j==="RGBA"?MI=f*3:j==="RBG"?(xI=0,EI=f,LI=f*2):j==="BGR"&&(EI=0,LI=f,xI=f*2);for(let SI=0;SI<f;SI++,NI+=x,oI+=x,rI+=x,XI+=x)mI[xI++]=(c[NI]+g[0])/v[0],mI[LI++]=(c[rI]+g[1])/v[1],mI[EI++]=(c[oI]+g[2])/v[2],MI!==-1&&XI!==-1&&(mI[MI++]=(c[XI]+g[3])/v[3]);return j==="RGBA"?new bI("float32",mI,[1,4,Y,R]):new bI("float32",mI,[1,3,Y,R])},VI=async(c,Z)=>{let Y=typeof HTMLImageElement<"u"&&c instanceof HTMLImageElement,R=typeof ImageData<"u"&&c instanceof ImageData,i=typeof ImageBitmap<"u"&&c instanceof ImageBitmap,v=typeof c=="string",g,M=Z??{},j=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},f=mI=>typeof HTMLCanvasElement<"u"&&mI instanceof HTMLCanvasElement||mI instanceof OffscreenCanvas?mI.getContext("2d"):null;if(Y){let mI=j();mI.width=c.width,mI.height=c.height;let x=f(mI);if(x!=null){let NI=c.height,rI=c.width;if(Z!==void 0&&Z.resizedHeight!==void 0&&Z.resizedWidth!==void 0&&(NI=Z.resizedHeight,rI=Z.resizedWidth),Z!==void 0){if(M=Z,Z.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");M.tensorFormat="RGBA",M.height=NI,M.width=rI}else M.tensorFormat="RGBA",M.height=NI,M.width=rI;x.drawImage(c,0,0),g=x.getImageData(0,0,rI,NI).data}else throw new Error("Can not access image data")}else if(R){let mI,x;if(Z!==void 0&&Z.resizedWidth!==void 0&&Z.resizedHeight!==void 0?(mI=Z.resizedHeight,x=Z.resizedWidth):(mI=c.height,x=c.width),Z!==void 0&&(M=Z),M.format="RGBA",M.height=mI,M.width=x,Z!==void 0){let NI=j();NI.width=x,NI.height=mI;let rI=f(NI);if(rI!=null)rI.putImageData(c,0,0),g=rI.getImageData(0,0,x,mI).data;else throw new Error("Can not access image data")}else g=c.data}else if(i){if(Z===void 0)throw new Error("Please provide image config with format for Imagebitmap");let mI=j();mI.width=c.width,mI.height=c.height;let x=f(mI);if(x!=null){let NI=c.height,rI=c.width;return x.drawImage(c,0,0,rI,NI),g=x.getImageData(0,0,rI,NI).data,M.height=NI,M.width=rI,WI(g,M)}else throw new Error("Can not access image data")}else{if(v)return new Promise((mI,x)=>{let NI=j(),rI=f(NI);if(!c||!rI)return x();let oI=new Image;oI.crossOrigin="Anonymous",oI.src=c,oI.onload=()=>{NI.width=oI.width,NI.height=oI.height,rI.drawImage(oI,0,0,NI.width,NI.height);let XI=rI.getImageData(0,0,NI.width,NI.height);M.height=NI.height,M.width=NI.width,mI(WI(XI.data,M))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(g!==void 0)return WI(g,M);throw new Error("Input data provided is not supported - aborted tensor creation")},sI=(c,Z)=>{let{width:Y,height:R,download:i,dispose:v}=Z,g=[1,R,Y,4];return new bI({location:"texture",type:"float32",texture:c,dims:g,download:i,dispose:v})},ZI=(c,Z)=>{let{dataType:Y,dims:R,download:i,dispose:v}=Z;return new bI({location:"gpu-buffer",type:Y??"float32",gpuBuffer:c,dims:R,download:i,dispose:v})},dI=(c,Z)=>{let{dataType:Y,dims:R,download:i,dispose:v}=Z;return new bI({location:"ml-tensor",type:Y??"float32",mlTensor:c,dims:R,download:i,dispose:v})},pI=(c,Z,Y)=>new bI({location:"cpu-pinned",type:c,data:Z,dims:Y??[Z.length]})}),eI,HI,YI,$,JI=n(()=>{"use strict";eI=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),HI=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),YI=!1,$=()=>{if(!YI){YI=!0;let c=typeof BigInt64Array<"u"&&BigInt64Array.from,Z=typeof BigUint64Array<"u"&&BigUint64Array.from,Y=typeof Float16Array<"u"&&Float16Array.from;c&&(eI.set("int64",BigInt64Array),HI.set(BigInt64Array,"int64")),Z&&(eI.set("uint64",BigUint64Array),HI.set(BigUint64Array,"uint64")),Y?(eI.set("float16",Float16Array),HI.set(Float16Array,"float16")):eI.set("float16",Uint16Array)}}}),UI,zI,L=n(()=>{"use strict";FI(),UI=c=>{let Z=1;for(let Y=0;Y<c.length;Y++){let R=c[Y];if(typeof R!="number"||!Number.isSafeInteger(R))throw new TypeError(`dims[${Y}] must be an integer, got: ${R}`);if(R<0)throw new RangeError(`dims[${Y}] must be a non-negative integer, got: ${R}`);Z*=R}return Z},zI=(c,Z)=>{switch(c.location){case"cpu":return new bI(c.type,c.data,Z);case"cpu-pinned":return new bI({location:"cpu-pinned",data:c.data,type:c.type,dims:Z});case"texture":return new bI({location:"texture",texture:c.texture,type:c.type,dims:Z});case"gpu-buffer":return new bI({location:"gpu-buffer",gpuBuffer:c.gpuBuffer,type:c.type,dims:Z});case"ml-tensor":return new bI({location:"ml-tensor",mlTensor:c.mlTensor,type:c.type,dims:Z});default:throw new Error(`tensorReshape: tensor location ${c.location} is not supported`)}}}),bI,FI=n(()=>{"use strict";hI(),yI(),JI(),L(),bI=class{constructor(c,Z,Y){$();let R,i;if(typeof c=="object"&&"location"in c)switch(this.dataLocation=c.location,R=c.type,i=c.dims,c.location){case"cpu-pinned":{let g=eI.get(R);if(!g)throw new TypeError(`unsupported type "${R}" to create tensor from pinned buffer`);if(!(c.data instanceof g))throw new TypeError(`buffer should be of type ${g.name}`);this.cpuData=c.data;break}case"texture":{if(R!=="float32")throw new TypeError(`unsupported type "${R}" to create tensor from texture`);this.gpuTextureData=c.texture,this.downloader=c.download,this.disposer=c.dispose;break}case"gpu-buffer":{if(R!=="float32"&&R!=="float16"&&R!=="int32"&&R!=="int64"&&R!=="uint32"&&R!=="uint8"&&R!=="bool"&&R!=="uint4"&&R!=="int4")throw new TypeError(`unsupported type "${R}" to create tensor from gpu buffer`);this.gpuBufferData=c.gpuBuffer,this.downloader=c.download,this.disposer=c.dispose;break}case"ml-tensor":{if(R!=="float32"&&R!=="float16"&&R!=="int32"&&R!=="int64"&&R!=="uint32"&&R!=="uint64"&&R!=="int8"&&R!=="uint8"&&R!=="bool"&&R!=="uint4"&&R!=="int4")throw new TypeError(`unsupported type "${R}" to create tensor from MLTensor`);this.mlTensorData=c.mlTensor,this.downloader=c.download,this.disposer=c.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let g,M;if(typeof c=="string")if(R=c,M=Y,c==="string"){if(!Array.isArray(Z))throw new TypeError("A string tensor's data must be a string array.");g=Z}else{let j=eI.get(c);if(j===void 0)throw new TypeError(`Unsupported tensor type: ${c}.`);if(Array.isArray(Z)){if(c==="float16"&&j===Uint16Array||c==="uint4"||c==="int4")throw new TypeError(`Creating a ${c} tensor from number array is not supported. Please use ${j.name} as data.`);c==="uint64"||c==="int64"?g=j.from(Z,BigInt):g=j.from(Z)}else if(Z instanceof j)g=Z;else if(Z instanceof Uint8ClampedArray)if(c==="uint8")g=Uint8Array.from(Z);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else throw new TypeError(`A ${R} tensor's data must be type of ${j}`)}else if(M=Z,Array.isArray(c)){if(c.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let j=typeof c[0];if(j==="string")R="string",g=c;else if(j==="boolean")R="bool",g=Uint8Array.from(c);else throw new TypeError(`Invalid element type of data array: ${j}.`)}else if(c instanceof Uint8ClampedArray)R="uint8",g=Uint8Array.from(c);else{let j=HI.get(c.constructor);if(j===void 0)throw new TypeError(`Unsupported type for tensor data: ${c.constructor}.`);R=j,g=c}if(M===void 0)M=[g.length];else if(!Array.isArray(M))throw new TypeError("A tensor's dims must be a number array");i=M,this.cpuData=g,this.dataLocation="cpu"}let v=UI(i);if(this.cpuData&&v!==this.cpuData.length&&!((R==="uint4"||R==="int4")&&Math.ceil(v/2)===this.cpuData.length))throw new Error(`Tensor's size(${v}) does not match data length(${this.cpuData.length}).`);this.type=R,this.dims=i,this.size=v}static async fromImage(c,Z){return VI(c,Z)}static fromTexture(c,Z){return sI(c,Z)}static fromGpuBuffer(c,Z){return ZI(c,Z)}static fromMLTensor(c,Z){return dI(c,Z)}static fromPinnedBuffer(c,Z,Y){return pI(c,Z,Y)}toDataURL(c){return S(this,c)}toImageData(c){return cI(this,c)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(c){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let Z=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=Z,c&&this.disposer&&(this.disposer(),this.disposer=void 0),Z}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(c){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return zI(this,c)}}}),U,k=n(()=>{"use strict";FI(),U=bI}),w,r,A,O,K=n(()=>{"use strict";E(),w=(c,Z)=>{(typeof H.trace>"u"?!H.wasm.trace:!H.trace)||console.timeStamp(`${c}::ORT::${Z}`)},r=(c,Z)=>{let Y=new Error().stack?.split(/\r\n|\r|\n/g)||[],R=!1;for(let i=0;i<Y.length;i++){if(R&&!Y[i].includes("TRACE_FUNC")){let v=`FUNC_${c}::${Y[i].trim().split(" ")[1]}`;Z&&(v+=`::${Z}`),w("CPU",v);return}Y[i].includes("TRACE_FUNC")&&(R=!0)}},A=c=>{(typeof H.trace>"u"?!H.wasm.trace:!H.trace)||r("BEGIN",c)},O=c=>{(typeof H.trace>"u"?!H.wasm.trace:!H.trace)||r("END",c)}}),q,GI=n(()=>{"use strict";a(),k(),K(),q=class jQ{constructor(Z){this.handler=Z}async run(Z,Y,R){A();let i={},v={};if(typeof Z!="object"||Z===null||Z instanceof U||Array.isArray(Z))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let g=!0;if(typeof Y=="object"){if(Y===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(Y instanceof U)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(Y)){if(Y.length===0)throw new TypeError("'fetches' cannot be an empty array.");g=!1;for(let f of Y){if(typeof f!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(f)===-1)throw new RangeError(`'fetches' contains invalid output name: ${f}.`);i[f]=null}if(typeof R=="object"&&R!==null)v=R;else if(typeof R<"u")throw new TypeError("'options' must be an object.")}else{let f=!1,mI=Object.getOwnPropertyNames(Y);for(let x of this.outputNames)if(mI.indexOf(x)!==-1){let NI=Y[x];(NI===null||NI instanceof U)&&(f=!0,g=!1,i[x]=NI)}if(f){if(typeof R=="object"&&R!==null)v=R;else if(typeof R<"u")throw new TypeError("'options' must be an object.")}else v=Y}}else if(typeof Y<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let f of this.inputNames)if(typeof Z[f]>"u")throw new Error(`input '${f}' is missing in 'feeds'.`);if(g)for(let f of this.outputNames)i[f]=null;let M=await this.handler.run(Z,i,v),j={};for(let f in M)if(Object.hasOwnProperty.call(M,f)){let mI=M[f];mI instanceof U?j[f]=mI:j[f]=new U(mI.type,mI.data,mI.dims)}return O(),j}async release(){return this.handler.dispose()}static async create(Z,Y,R,i){A();let v,g={};if(typeof Z=="string"){if(v=Z,typeof Y=="object"&&Y!==null)g=Y;else if(typeof Y<"u")throw new TypeError("'options' must be an object.")}else if(Z instanceof Uint8Array){if(v=Z,typeof Y=="object"&&Y!==null)g=Y;else if(typeof Y<"u")throw new TypeError("'options' must be an object.")}else if(Z instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&Z instanceof SharedArrayBuffer){let mI=Z,x=0,NI=Z.byteLength;if(typeof Y=="object"&&Y!==null)g=Y;else if(typeof Y=="number"){if(x=Y,!Number.isSafeInteger(x))throw new RangeError("'byteOffset' must be an integer.");if(x<0||x>=mI.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${mI.byteLength}).`);if(NI=Z.byteLength-x,typeof R=="number"){if(NI=R,!Number.isSafeInteger(NI))throw new RangeError("'byteLength' must be an integer.");if(NI<=0||x+NI>mI.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${mI.byteLength-x}].`);if(typeof i=="object"&&i!==null)g=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(typeof R<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof Y<"u")throw new TypeError("'options' must be an object.");v=new Uint8Array(mI,x,NI)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[M,j]=await F(g),f=await M.createInferenceSessionHandler(v,j);return O(),new jQ(f)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}}),tI,iI=n(()=>{"use strict";GI(),tI=q}),B=n(()=>{"use strict"}),aI=n(()=>{"use strict"}),lI=n(()=>{"use strict"}),QI=n(()=>{"use strict"}),vI={};s(vI,{InferenceSession:()=>tI,TRACE:()=>w,TRACE_FUNC_BEGIN:()=>A,TRACE_FUNC_END:()=>O,Tensor:()=>U,env:()=>C,registerBackend:()=>X});var OI=n(()=>{"use strict";u(),T(),iI(),k(),B(),aI(),K(),lI(),QI()}),uI=n(()=>{"use strict"}),wI={};s(wI,{default:()=>Il});var kI,TI,Il,nl=n(()=>{"use strict";eX(),lb(),xc(),kI="ort-wasm-proxy-worker",TI=globalThis.self?.name===kI,TI&&(self.onmessage=c=>{let{type:Z,in:Y}=c.data;try{switch(Z){case"init-wasm":ib(Y.wasm).then(()=>{Ne(Y).then(()=>{postMessage({type:Z})},R=>{postMessage({type:Z,err:R})})},R=>{postMessage({type:Z,err:R})});break;case"init-ep":{let{epName:R,env:i}=Y;Ya(i,R).then(()=>{postMessage({type:Z})},v=>{postMessage({type:Z,err:v})});break}case"copy-from":{let{buffer:R}=Y,i=yZ(R);postMessage({type:Z,out:i});break}case"create":{let{model:R,options:i}=Y;wY(R,i).then(v=>{postMessage({type:Z,out:v})},v=>{postMessage({type:Z,err:v})});break}case"release":vY(Y),postMessage({type:Z});break;case"run":{let{sessionId:R,inputIndices:i,inputs:v,outputIndices:g,options:M}=Y;xd(R,i,v,g,new Array(g.length).fill(null),M).then(j=>{j.some(f=>f[3]!=="cpu")?postMessage({type:Z,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:Z,out:j},u2([...v,...j]))},j=>{postMessage({type:Z,err:j})});break}case"end-profiling":wb(Y),postMessage({type:Z});break;default:}}catch(R){postMessage({type:Z,err:R})}}),Il=TI?null:c=>new Worker(c??jl,{type:"module",name:kI})}),ol={};s(ol,{default:()=>jI});var PI,KI,jI,Wl=n(()=>{"use strict";KI=(PI=import.meta.url,async function(c={}){function Z(){return GG.buffer!=mG.buffer&&tb(),mG}function Y(){return GG.buffer!=mG.buffer&&tb(),cG}function R(){return GG.buffer!=mG.buffer&&tb(),pc}function i(){return GG.buffer!=mG.buffer&&tb(),Rl}function v(){return GG.buffer!=mG.buffer&&tb(),Al}function g(){return GG.buffer!=mG.buffer&&tb(),BG}function M(){return GG.buffer!=mG.buffer&&tb(),ec}function j(){return GG.buffer!=mG.buffer&&tb(),Pc}var f,mI,x=Object.assign({},c),NI=new Promise((J,D)=>{f=J,mI=D}),rI=typeof window=="object",oI=typeof importScripts=="function",XI=oI&&self.name=="em-pthread";x.mountExternalData=(J,D)=>{J.startsWith("./")&&(J=J.substring(2)),(x.Fb||(x.Fb=new Map)).set(J,D)},x.unmountExternalData=()=>{delete x.Fb};var xI=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,shared:!0}).buffer.constructor;let LI=()=>{let J=(nI,RI,gI)=>(...DI)=>{let ml=aZ,Yl=RI?.();DI=nI(...DI);let Jl=RI?.();return Yl!==Jl&&(nI=Jl,gI(Yl),RI=gI=null),aZ!=ml?new Promise((zl,Pl)=>{z2={resolve:zl,reject:Pl}}):DI},D=nI=>async(...RI)=>{try{if(x.Gb)throw Error("Session already started");let gI=x.Gb={hc:RI[0],errors:[]},DI=await nI(...RI);if(x.Gb!==gI)throw Error("Session mismatch");x.Hb?.flush();let ml=gI.errors;if(0<ml.length){let Yl=await Promise.all(ml);if(Yl=Yl.filter(Jl=>Jl),0<Yl.length)throw Error(Yl.join(`
`))}return DI}finally{x.Gb=null}};x._OrtCreateSession=J(x._OrtCreateSession,()=>x._OrtCreateSession,nI=>x._OrtCreateSession=nI),x._OrtRun=D(J(x._OrtRun,()=>x._OrtRun,nI=>x._OrtRun=nI)),x._OrtRunWithBinding=D(J(x._OrtRunWithBinding,()=>x._OrtRunWithBinding,nI=>x._OrtRunWithBinding=nI)),x._OrtBindInput=J(x._OrtBindInput,()=>x._OrtBindInput,nI=>x._OrtBindInput=nI),LI=void 0};x.jsepInit=(J,D)=>{if(LI?.(),J==="webgpu"){[x.Hb,x.Vb,x.Zb,x.Ob,x.Yb,x.kb,x.$b,x.cc,x.Wb,x.Xb,x.ac]=D;let nI=x.Hb;x.jsepRegisterBuffer=(RI,gI,DI,ml)=>nI.registerBuffer(RI,gI,DI,ml),x.jsepGetBuffer=RI=>nI.getBuffer(RI),x.jsepCreateDownloader=(RI,gI,DI)=>nI.createDownloader(RI,gI,DI),x.jsepOnCreateSession=RI=>{nI.onCreateSession(RI)},x.jsepOnReleaseSession=RI=>{nI.onReleaseSession(RI)},x.jsepOnRunStart=RI=>nI.onRunStart(RI),x.dc=(RI,gI)=>{nI.upload(RI,gI)}}else if(J==="webnn"){[x.Hb,x.bc,x.Pb,x.jsepEnsureTensor,x.ec,x.jsepDownloadTensor]=D,x.jsepReleaseTensorId=x.Pb;let nI=x.Hb;x.jsepOnRunStart=RI=>nI.onRunStart(RI),x.jsepRegisterMLContext=(RI,gI)=>{nI.registerMLContext(RI,gI)},x.jsepOnReleaseSession=RI=>{nI.onReleaseSession(RI)},x.jsepCreateMLTensorDownloader=(RI,gI)=>nI.createMLTensorDownloader(RI,gI),x.jsepRegisterMLTensor=(RI,gI,DI)=>nI.registerMLTensor(RI,gI,DI),x.jsepCreateMLContext=RI=>nI.createMLContext(RI),x.jsepRegisterMLConstant=(RI,gI,DI,ml,Yl)=>nI.registerMLConstant(RI,gI,DI,ml,Yl,x.Fb)}};var EI,MI,SI=Object.assign({},x),qI=(J,D)=>{throw D},ll="";(rI||oI)&&(oI?ll=self.location.href:typeof document<"u"&&document.currentScript&&(ll=document.currentScript.src),PI&&(ll=PI),ll=ll.startsWith("blob:")?"":ll.substr(0,ll.replace(/[?#].*/,"").lastIndexOf("/")+1),oI&&(MI=J=>{var D=new XMLHttpRequest;return D.open("GET",J,!1),D.responseType="arraybuffer",D.send(null),new Uint8Array(D.response)}),EI=(J,D,nI)=>{var RI=new XMLHttpRequest;RI.open("GET",J,!0),RI.responseType="arraybuffer",RI.onload=()=>{RI.status==200||RI.status==0&&RI.response?D(RI.response):nI()},RI.onerror=nI,RI.send(null)});var cl,pl=console.log.bind(console),Xl=console.error.bind(console),kl=pl,xl=Xl;if(Object.assign(x,SI),SI=null,XI){let J=function(D){try{var nI=D.data,RI=nI.cmd;if(RI==="load"){let gI=[];self.onmessage=DI=>gI.push(DI),self.startWorker=()=>{postMessage({cmd:"loaded"});for(let DI of gI)J(DI);self.onmessage=J};for(let DI of nI.handlers)x[DI]&&!x[DI].proxy||(x[DI]=(...ml)=>{postMessage({Nb:"callHandler",pc:DI,args:ml})},DI=="print"&&(kl=x[DI]),DI=="printErr"&&(xl=x[DI]));GG=nI.wasmMemory,tb(),il(nI.wasmModule)}else if(RI==="run"){O2(nI.pthread_ptr,0,0,1,0,0),k2(nI.pthread_ptr),_1(),yX(),VG||(wi(),VG=!0);try{P1(nI.start_routine,nI.arg)}catch(gI){if(gI!="unwind")throw gI}}else RI==="cancel"?$t()&&lp(-1):nI.target!=="setimmediate"&&(RI==="checkMailbox"?VG&&KV():RI&&(xl(`worker: received unknown command ${RI}`),xl(nI)))}catch(gI){throw vi(),gI}};var bG=J,il,VG=!1;xl=function(...D){D=D.join(" "),console.error(D)},self.alert=function(...D){postMessage({Nb:"alert",text:D.join(" "),rc:$t()})},x.instantiateWasm=(D,nI)=>new Promise(RI=>{il=gI=>{gI=new WebAssembly.Instance(gI,HX()),nI(gI),RI()}}),self.onunhandledrejection=D=>{throw D.reason||D},self.onmessage=J}x.wasmBinary&&(cl=x.wasmBinary);var GG,Bl,QG,mG,cG,pc,Rl,Al,BG,ec,ac,gZ,Pc,sc=!1;function tb(){var J=GG.buffer;x.HEAP8=mG=new Int8Array(J),x.HEAP16=pc=new Int16Array(J),x.HEAPU8=cG=new Uint8Array(J),x.HEAPU16=Rl=new Uint16Array(J),x.HEAP32=Al=new Int32Array(J),x.HEAPU32=BG=new Uint32Array(J),x.HEAPF32=ec=new Float32Array(J),x.HEAPF64=Pc=new Float64Array(J),x.HEAP64=ac=new BigInt64Array(J),x.HEAPU64=gZ=new BigUint64Array(J)}if(!XI){if(!((GG=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0})).buffer instanceof xI))throw xl("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),Error("bad memory");tb()}var OV=[],JY=[],S1=[],CY=0,i2=null,AY=null;function oX(){if(--CY==0&&(i2!==null&&(clearInterval(i2),i2=null),AY)){var J=AY;AY=null,J()}}function Ye(J){throw xl(J="Aborted("+J+")"),sc=!0,QG=1,J=new WebAssembly.RuntimeError(J+". Build with -sASSERTIONS for more info."),mI(J),J}var Q2,FX=J=>J.startsWith("data:application/octet-stream;base64,"),XX=J=>J.startsWith("file://");function iX(J){if(J==Q2&&cl)return new Uint8Array(cl);if(MI)return MI(J);throw"both async and sync fetching of the wasm failed"}function QX(J,D,nI){return function(RI){if(!cl&&(rI||oI)){if(typeof fetch=="function"&&!XX(RI))return fetch(RI,{credentials:"same-origin"}).then(gI=>{if(!gI.ok)throw`failed to load wasm binary file at '${RI}'`;return gI.arrayBuffer()}).catch(()=>iX(RI));if(EI)return new Promise((gI,DI)=>{EI(RI,ml=>gI(new Uint8Array(ml)),DI)})}return Promise.resolve().then(()=>iX(RI))}(J).then(RI=>WebAssembly.instantiate(RI,D)).then(nI,RI=>{xl(`failed to asynchronously prepare wasm: ${RI}`),Ye(RI)})}function HX(){return{a:{O:q1,Aa:D1,b:Iy,aa:AX,B:xX,qa:zX,Y:MX,_:BX,ra:OX,oa:jX,ha:KX,na:TX,L:fX,Z:SX,W:DX,pa:qX,X:_X,va:ly,F:cy,Q:by,P:Zy,E:ay,u:Wy,q:ty,G:ny,A:py,R:uy,ua:Ry,ka:oy,U:Fy,ba:Xy,H:iy,ja:k2,ta:Qy,t:Hy,Ba:ry,x:Ey,o:yy,m:Jy,c:A2,n:Cy,k:ky,w:xy,p:zy,f:Uy,s:My,l:By,e:Oy,j:jy,i:Ky,g:Ty,d:fy,ea:Sy,fa:Dy,ga:qy,ca:ni,da:mi,T:_y,h:Py,D:$y,I:Ig,M:lg,y:Gg,sa:cg,V:bg,v:si,z:dg,N:Zg,S:eg,za:ag,ya:Wg,la:Vi,ma:pi,$:E2,C:ui,K:Ri,ia:oi,J:Fi,a:GG,xa:v2,wa:Qi,r:mg}}}var H2={916868:(J,D,nI,RI,gI)=>{if(x===void 0||!x.Fb)return 1;if((J=Cc(Number(J>>>0))).startsWith("./")&&(J=J.substring(2)),!(J=x.Fb.get(J)))return 2;if(D=Number(D>>>0),nI=Number(nI>>>0),RI=Number(RI>>>0),D+nI>J.byteLength)return 3;try{let DI=J.subarray(D,D+nI);switch(gI){case 0:Y().set(DI,RI>>>0);break;case 1:x.dc(RI,DI);break;default:return 4}return 0}catch{return 4}},917583:(J,D,nI)=>{x.ec(J,Y().subarray(D>>>0,D+nI>>>0))},917646:()=>x.bc(),917687:J=>{x.Pb(J)},917723:()=>{x.Wb()},917754:()=>{x.Xb()},917783:()=>{x.ac()},917808:J=>x.Vb(J),917841:J=>x.Zb(J),917873:(J,D,nI)=>{x.Ob(Number(J),Number(D),Number(nI),!0)},917936:(J,D,nI)=>{x.Ob(Number(J),Number(D),Number(nI))},917993:()=>typeof wasmOffsetConverter<"u",918050:J=>{x.kb("Abs",J,void 0)},918101:J=>{x.kb("Neg",J,void 0)},918152:J=>{x.kb("Floor",J,void 0)},918205:J=>{x.kb("Ceil",J,void 0)},918257:J=>{x.kb("Reciprocal",J,void 0)},918315:J=>{x.kb("Sqrt",J,void 0)},918367:J=>{x.kb("Exp",J,void 0)},918418:J=>{x.kb("Erf",J,void 0)},918469:J=>{x.kb("Sigmoid",J,void 0)},918524:(J,D,nI)=>{x.kb("HardSigmoid",J,{alpha:D,beta:nI})},918603:J=>{x.kb("Log",J,void 0)},918654:J=>{x.kb("Sin",J,void 0)},918705:J=>{x.kb("Cos",J,void 0)},918756:J=>{x.kb("Tan",J,void 0)},918807:J=>{x.kb("Asin",J,void 0)},918859:J=>{x.kb("Acos",J,void 0)},918911:J=>{x.kb("Atan",J,void 0)},918963:J=>{x.kb("Sinh",J,void 0)},919015:J=>{x.kb("Cosh",J,void 0)},919067:J=>{x.kb("Asinh",J,void 0)},919120:J=>{x.kb("Acosh",J,void 0)},919173:J=>{x.kb("Atanh",J,void 0)},919226:J=>{x.kb("Tanh",J,void 0)},919278:J=>{x.kb("Not",J,void 0)},919329:(J,D,nI)=>{x.kb("Clip",J,{min:D,max:nI})},919398:J=>{x.kb("Clip",J,void 0)},919450:(J,D)=>{x.kb("Elu",J,{alpha:D})},919508:J=>{x.kb("Gelu",J,void 0)},919560:J=>{x.kb("Relu",J,void 0)},919612:(J,D)=>{x.kb("LeakyRelu",J,{alpha:D})},919676:(J,D)=>{x.kb("ThresholdedRelu",J,{alpha:D})},919746:(J,D)=>{x.kb("Cast",J,{to:D})},919804:J=>{x.kb("Add",J,void 0)},919855:J=>{x.kb("Sub",J,void 0)},919906:J=>{x.kb("Mul",J,void 0)},919957:J=>{x.kb("Div",J,void 0)},920008:J=>{x.kb("Pow",J,void 0)},920059:J=>{x.kb("Equal",J,void 0)},920112:J=>{x.kb("Greater",J,void 0)},920167:J=>{x.kb("GreaterOrEqual",J,void 0)},920229:J=>{x.kb("Less",J,void 0)},920281:J=>{x.kb("LessOrEqual",J,void 0)},920340:(J,D,nI,RI,gI)=>{x.kb("ReduceMean",J,{keepDims:!!D,noopWithEmptyAxes:!!nI,axes:RI?Array.from(v().subarray(Number(RI)>>>0,Number(gI)>>>0)):[]})},920515:(J,D,nI,RI,gI)=>{x.kb("ReduceMax",J,{keepDims:!!D,noopWithEmptyAxes:!!nI,axes:RI?Array.from(v().subarray(Number(RI)>>>0,Number(gI)>>>0)):[]})},920689:(J,D,nI,RI,gI)=>{x.kb("ReduceMin",J,{keepDims:!!D,noopWithEmptyAxes:!!nI,axes:RI?Array.from(v().subarray(Number(RI)>>>0,Number(gI)>>>0)):[]})},920863:(J,D,nI,RI,gI)=>{x.kb("ReduceProd",J,{keepDims:!!D,noopWithEmptyAxes:!!nI,axes:RI?Array.from(v().subarray(Number(RI)>>>0,Number(gI)>>>0)):[]})},921038:(J,D,nI,RI,gI)=>{x.kb("ReduceSum",J,{keepDims:!!D,noopWithEmptyAxes:!!nI,axes:RI?Array.from(v().subarray(Number(RI)>>>0,Number(gI)>>>0)):[]})},921212:(J,D,nI,RI,gI)=>{x.kb("ReduceL1",J,{keepDims:!!D,noopWithEmptyAxes:!!nI,axes:RI?Array.from(v().subarray(Number(RI)>>>0,Number(gI)>>>0)):[]})},921385:(J,D,nI,RI,gI)=>{x.kb("ReduceL2",J,{keepDims:!!D,noopWithEmptyAxes:!!nI,axes:RI?Array.from(v().subarray(Number(RI)>>>0,Number(gI)>>>0)):[]})},921558:(J,D,nI,RI,gI)=>{x.kb("ReduceLogSum",J,{keepDims:!!D,noopWithEmptyAxes:!!nI,axes:RI?Array.from(v().subarray(Number(RI)>>>0,Number(gI)>>>0)):[]})},921735:(J,D,nI,RI,gI)=>{x.kb("ReduceSumSquare",J,{keepDims:!!D,noopWithEmptyAxes:!!nI,axes:RI?Array.from(v().subarray(Number(RI)>>>0,Number(gI)>>>0)):[]})},921915:(J,D,nI,RI,gI)=>{x.kb("ReduceLogSumExp",J,{keepDims:!!D,noopWithEmptyAxes:!!nI,axes:RI?Array.from(v().subarray(Number(RI)>>>0,Number(gI)>>>0)):[]})},922095:J=>{x.kb("Where",J,void 0)},922148:(J,D,nI)=>{x.kb("Transpose",J,{perm:D?Array.from(v().subarray(Number(D)>>>0,Number(nI)>>>0)):[]})},922272:(J,D,nI,RI)=>{x.kb("DepthToSpace",J,{blocksize:D,mode:Cc(nI),format:RI?"NHWC":"NCHW"})},922405:(J,D,nI,RI)=>{x.kb("DepthToSpace",J,{blocksize:D,mode:Cc(nI),format:RI?"NHWC":"NCHW"})},922538:(J,D,nI,RI,gI,DI,ml,Yl,Jl,zl,Pl,CG,fG,al,yG)=>{x.kb("ConvTranspose",J,{format:Jl?"NHWC":"NCHW",autoPad:D,dilations:[nI],group:RI,kernelShape:[gI],pads:[DI,ml],strides:[Yl],wIsConst:()=>!!Z()[zl>>>0],outputPadding:Pl?Array.from(v().subarray(Number(Pl)>>>0,Number(CG)>>>0)):[],outputShape:fG?Array.from(v().subarray(Number(fG)>>>0,Number(al)>>>0)):[],activation:Cc(yG)})},922971:(J,D,nI,RI,gI,DI,ml,Yl,Jl,zl,Pl,CG,fG,al)=>{x.kb("ConvTranspose",J,{format:Yl?"NHWC":"NCHW",autoPad:D,dilations:Array.from(v().subarray(Number(nI)>>>0,2+(Number(nI)>>>0)>>>0)),group:RI,kernelShape:Array.from(v().subarray(Number(gI)>>>0,2+(Number(gI)>>>0)>>>0)),pads:Array.from(v().subarray(Number(DI)>>>0,4+(Number(DI)>>>0)>>>0)),strides:Array.from(v().subarray(Number(ml)>>>0,2+(Number(ml)>>>0)>>>0)),wIsConst:()=>!!Z()[Jl>>>0],outputPadding:zl?Array.from(v().subarray(Number(zl)>>>0,Number(Pl)>>>0)):[],outputShape:CG?Array.from(v().subarray(Number(CG)>>>0,Number(fG)>>>0)):[],activation:Cc(al)})},923632:(J,D,nI,RI,gI,DI,ml,Yl,Jl,zl,Pl,CG,fG,al,yG)=>{x.kb("ConvTranspose",J,{format:Jl?"NHWC":"NCHW",autoPad:D,dilations:[nI],group:RI,kernelShape:[gI],pads:[DI,ml],strides:[Yl],wIsConst:()=>!!Z()[zl>>>0],outputPadding:Pl?Array.from(v().subarray(Number(Pl)>>>0,Number(CG)>>>0)):[],outputShape:fG?Array.from(v().subarray(Number(fG)>>>0,Number(al)>>>0)):[],activation:Cc(yG)})},924065:(J,D,nI,RI,gI,DI,ml,Yl,Jl,zl,Pl,CG,fG,al)=>{x.kb("ConvTranspose",J,{format:Yl?"NHWC":"NCHW",autoPad:D,dilations:Array.from(v().subarray(Number(nI)>>>0,2+(Number(nI)>>>0)>>>0)),group:RI,kernelShape:Array.from(v().subarray(Number(gI)>>>0,2+(Number(gI)>>>0)>>>0)),pads:Array.from(v().subarray(Number(DI)>>>0,4+(Number(DI)>>>0)>>>0)),strides:Array.from(v().subarray(Number(ml)>>>0,2+(Number(ml)>>>0)>>>0)),wIsConst:()=>!!Z()[Jl>>>0],outputPadding:zl?Array.from(v().subarray(Number(zl)>>>0,Number(Pl)>>>0)):[],outputShape:CG?Array.from(v().subarray(Number(CG)>>>0,Number(fG)>>>0)):[],activation:Cc(al)})},924726:(J,D)=>{x.kb("GlobalAveragePool",J,{format:D?"NHWC":"NCHW"})},924817:(J,D,nI,RI,gI,DI,ml,Yl,Jl,zl,Pl,CG,fG,al)=>{x.kb("AveragePool",J,{format:al?"NHWC":"NCHW",auto_pad:D,ceil_mode:nI,count_include_pad:RI,storage_order:gI,dilations:DI?Array.from(v().subarray(Number(DI)>>>0,Number(ml)>>>0)):[],kernel_shape:Yl?Array.from(v().subarray(Number(Yl)>>>0,Number(Jl)>>>0)):[],pads:zl?Array.from(v().subarray(Number(zl)>>>0,Number(Pl)>>>0)):[],strides:CG?Array.from(v().subarray(Number(CG)>>>0,Number(fG)>>>0)):[]})},925296:(J,D)=>{x.kb("GlobalAveragePool",J,{format:D?"NHWC":"NCHW"})},925387:(J,D,nI,RI,gI,DI,ml,Yl,Jl,zl,Pl,CG,fG,al)=>{x.kb("AveragePool",J,{format:al?"NHWC":"NCHW",auto_pad:D,ceil_mode:nI,count_include_pad:RI,storage_order:gI,dilations:DI?Array.from(v().subarray(Number(DI)>>>0,Number(ml)>>>0)):[],kernel_shape:Yl?Array.from(v().subarray(Number(Yl)>>>0,Number(Jl)>>>0)):[],pads:zl?Array.from(v().subarray(Number(zl)>>>0,Number(Pl)>>>0)):[],strides:CG?Array.from(v().subarray(Number(CG)>>>0,Number(fG)>>>0)):[]})},925866:(J,D)=>{x.kb("GlobalMaxPool",J,{format:D?"NHWC":"NCHW"})},925953:(J,D,nI,RI,gI,DI,ml,Yl,Jl,zl,Pl,CG,fG,al)=>{x.kb("MaxPool",J,{format:al?"NHWC":"NCHW",auto_pad:D,ceil_mode:nI,count_include_pad:RI,storage_order:gI,dilations:DI?Array.from(v().subarray(Number(DI)>>>0,Number(ml)>>>0)):[],kernel_shape:Yl?Array.from(v().subarray(Number(Yl)>>>0,Number(Jl)>>>0)):[],pads:zl?Array.from(v().subarray(Number(zl)>>>0,Number(Pl)>>>0)):[],strides:CG?Array.from(v().subarray(Number(CG)>>>0,Number(fG)>>>0)):[]})},926428:(J,D)=>{x.kb("GlobalMaxPool",J,{format:D?"NHWC":"NCHW"})},926515:(J,D,nI,RI,gI,DI,ml,Yl,Jl,zl,Pl,CG,fG,al)=>{x.kb("MaxPool",J,{format:al?"NHWC":"NCHW",auto_pad:D,ceil_mode:nI,count_include_pad:RI,storage_order:gI,dilations:DI?Array.from(v().subarray(Number(DI)>>>0,Number(ml)>>>0)):[],kernel_shape:Yl?Array.from(v().subarray(Number(Yl)>>>0,Number(Jl)>>>0)):[],pads:zl?Array.from(v().subarray(Number(zl)>>>0,Number(Pl)>>>0)):[],strides:CG?Array.from(v().subarray(Number(CG)>>>0,Number(fG)>>>0)):[]})},926990:(J,D,nI,RI,gI)=>{x.kb("Gemm",J,{alpha:D,beta:nI,transA:RI,transB:gI})},927094:J=>{x.kb("MatMul",J,void 0)},927148:(J,D,nI,RI)=>{x.kb("ArgMax",J,{keepDims:!!D,selectLastIndex:!!nI,axis:RI})},927256:(J,D,nI,RI)=>{x.kb("ArgMin",J,{keepDims:!!D,selectLastIndex:!!nI,axis:RI})},927364:(J,D)=>{x.kb("Softmax",J,{axis:D})},927427:(J,D)=>{x.kb("Concat",J,{axis:D})},927487:(J,D,nI,RI,gI)=>{x.kb("Split",J,{axis:D,numOutputs:nI,splitSizes:RI?Array.from(v().subarray(Number(RI)>>>0,Number(gI)>>>0)):[]})},927643:J=>{x.kb("Expand",J,void 0)},927697:(J,D)=>{x.kb("Gather",J,{axis:Number(D)})},927768:(J,D)=>{x.kb("GatherElements",J,{axis:Number(D)})},927847:(J,D)=>{x.kb("GatherND",J,{batch_dims:Number(D)})},927926:(J,D,nI,RI,gI,DI,ml,Yl,Jl,zl,Pl)=>{x.kb("Resize",J,{antialias:D,axes:nI?Array.from(v().subarray(Number(nI)>>>0,Number(RI)>>>0)):[],coordinateTransformMode:Cc(gI),cubicCoeffA:DI,excludeOutside:ml,extrapolationValue:Yl,keepAspectRatioPolicy:Cc(Jl),mode:Cc(zl),nearestMode:Cc(Pl)})},928288:(J,D,nI,RI,gI,DI,ml)=>{x.kb("Slice",J,{starts:D?Array.from(v().subarray(Number(D)>>>0,Number(nI)>>>0)):[],ends:RI?Array.from(v().subarray(Number(RI)>>>0,Number(gI)>>>0)):[],axes:DI?Array.from(v().subarray(Number(DI)>>>0,Number(ml)>>>0)):[]})},928552:J=>{x.kb("Tile",J,void 0)},928604:(J,D,nI)=>{x.kb("InstanceNormalization",J,{epsilon:D,format:nI?"NHWC":"NCHW"})},928718:(J,D,nI)=>{x.kb("InstanceNormalization",J,{epsilon:D,format:nI?"NHWC":"NCHW"})},928832:J=>{x.kb("Range",J,void 0)},928885:(J,D)=>{x.kb("Einsum",J,{equation:Cc(D)})},928966:(J,D,nI,RI,gI)=>{x.kb("Pad",J,{mode:D,value:nI,pads:RI?Array.from(v().subarray(Number(RI)>>>0,Number(gI)>>>0)):[]})},929109:(J,D,nI,RI,gI,DI)=>{x.kb("BatchNormalization",J,{epsilon:D,momentum:nI,spatial:!!gI,trainingMode:!!RI,format:DI?"NHWC":"NCHW"})},929278:(J,D,nI,RI,gI,DI)=>{x.kb("BatchNormalization",J,{epsilon:D,momentum:nI,spatial:!!gI,trainingMode:!!RI,format:DI?"NHWC":"NCHW"})},929447:(J,D,nI)=>{x.kb("CumSum",J,{exclusive:Number(D),reverse:Number(nI)})},929544:(J,D,nI)=>{x.kb("DequantizeLinear",J,{axis:D,blockSize:nI})},929634:(J,D,nI,RI,gI)=>{x.kb("GridSample",J,{align_corners:D,mode:Cc(nI),padding_mode:Cc(RI),format:gI?"NHWC":"NCHW"})},929804:(J,D,nI,RI,gI)=>{x.kb("GridSample",J,{align_corners:D,mode:Cc(nI),padding_mode:Cc(RI),format:gI?"NHWC":"NCHW"})},929974:(J,D,nI,RI,gI,DI,ml,Yl,Jl)=>{x.kb("Attention",J,{numHeads:D,isUnidirectional:nI,maskFilterValue:RI,scale:gI,doRotary:DI,qkvHiddenSizes:ml?Array.from(v().subarray(Number(Yl)>>>0,Number(Yl)+ml>>>0)):[],pastPresentShareBuffer:!!Jl})},930246:J=>{x.kb("BiasAdd",J,void 0)},930301:J=>{x.kb("BiasSplitGelu",J,void 0)},930362:J=>{x.kb("FastGelu",J,void 0)},930418:(J,D,nI,RI,gI,DI,ml,Yl,Jl,zl,Pl,CG,fG,al,yG,wc)=>{x.kb("Conv",J,{format:CG?"NHWC":"NCHW",auto_pad:D,dilations:nI?Array.from(v().subarray(Number(nI)>>>0,Number(RI)>>>0)):[],group:gI,kernel_shape:DI?Array.from(v().subarray(Number(DI)>>>0,Number(ml)>>>0)):[],pads:Yl?Array.from(v().subarray(Number(Yl)>>>0,Number(Jl)>>>0)):[],strides:zl?Array.from(v().subarray(Number(zl)>>>0,Number(Pl)>>>0)):[],w_is_const:()=>!!Z()[Number(fG)>>>0],activation:Cc(al),activation_params:yG?Array.from(M().subarray(Number(yG)>>>0,Number(wc)>>>0)):[]})},931002:J=>{x.kb("Gelu",J,void 0)},931054:(J,D,nI,RI,gI,DI,ml,Yl,Jl)=>{x.kb("GroupQueryAttention",J,{numHeads:D,kvNumHeads:nI,scale:RI,softcap:gI,doRotary:DI,rotaryInterleaved:ml,smoothSoftmax:Yl,localWindowSize:Jl})},931271:(J,D,nI,RI)=>{x.kb("LayerNormalization",J,{axis:D,epsilon:nI,simplified:!!RI})},931382:(J,D,nI,RI)=>{x.kb("LayerNormalization",J,{axis:D,epsilon:nI,simplified:!!RI})},931493:(J,D,nI,RI,gI,DI)=>{x.kb("MatMulNBits",J,{k:D,n:nI,accuracyLevel:RI,bits:gI,blockSize:DI})},931620:(J,D,nI,RI,gI,DI)=>{x.kb("MultiHeadAttention",J,{numHeads:D,isUnidirectional:nI,maskFilterValue:RI,scale:gI,doRotary:DI})},931779:(J,D)=>{x.kb("QuickGelu",J,{alpha:D})},931843:(J,D,nI,RI,gI)=>{x.kb("RotaryEmbedding",J,{interleaved:!!D,numHeads:nI,rotaryEmbeddingDim:RI,scale:gI})},931982:(J,D,nI)=>{x.kb("SkipLayerNormalization",J,{epsilon:D,simplified:!!nI})},932084:(J,D,nI)=>{x.kb("SkipLayerNormalization",J,{epsilon:D,simplified:!!nI})},932186:(J,D,nI,RI)=>{x.kb("GatherBlockQuantized",J,{gatherAxis:D,quantizeAxis:nI,blockSize:RI})},932307:J=>{x.$b(J)},932341:(J,D)=>x.cc(Number(J),Number(D),x.Gb.hc,x.Gb.errors)};function D1(J,D,nI){return Zi(async()=>{await x.Yb(Number(J),Number(D),Number(nI))})}function q1(){return typeof wasmOffsetConverter<"u"}function r2(J){this.name="ExitStatus",this.message=`Program terminated with exit(${J})`,this.status=J}var w2=J=>{J.terminate(),J.onmessage=()=>{}},rX=J=>{he.length==0&&(JX(),gX(he[0]));var D=he.pop();if(!D)return 6;ua.push(D),ZZ[J.Bb]=D,D.Bb=J.Bb;var nI={cmd:"run",start_routine:J.ic,arg:J.Rb,pthread_ptr:J.Bb};return D.postMessage(nI,J.nc),0},pa=0,Fc=(J,D,...nI)=>{for(var RI=2*nI.length,gI=T2(),DI=K2(8*RI),ml=DI>>>3,Yl=0;Yl<nI.length;Yl++){var Jl=nI[Yl];typeof Jl=="bigint"?(ac[ml+2*Yl]=1n,ac[ml+2*Yl+1]=Jl):(ac[ml+2*Yl]=0n,j()[ml+2*Yl+1>>>0]=Jl)}return J=Ei(J,0,RI,DI,D),Gp(gI),J};function v2(J){if(XI)return Fc(0,1,J);if(QG=J,!(0<pa)){for(var D of ua)w2(D);for(D of he)w2(D);he=[],ua=[],ZZ=[],sc=!0}qI(0,new r2(J))}function wX(J){if(XI)return Fc(1,0,J);E2(J)}var E2=J=>{if(QG=J,XI)throw wX(J),"unwind";v2(J)},he=[],ua=[],vX=[],ZZ={},EX=J=>{var D=J.Bb;delete ZZ[D],he.push(J),ua.splice(ua.indexOf(J),1),J.Bb=0,j2(D)};function yX(){vX.forEach(J=>J())}var gX=J=>new Promise(D=>{J.onmessage=gI=>{var DI=(gI=gI.data).cmd;if(gI.targetThread&&gI.targetThread!=$t()){var ml=ZZ[gI.targetThread];ml?ml.postMessage(gI,gI.transferList):xl(`Internal error! Worker sent a message "${DI}" to target pthread ${gI.targetThread}, but that thread no longer exists!`)}else DI==="checkMailbox"?KV():DI==="spawnThread"?rX(gI):DI==="cleanupThread"?EX(ZZ[gI.thread]):DI==="killThread"?(gI=gI.thread,DI=ZZ[gI],delete ZZ[gI],w2(DI),j2(gI),ua.splice(ua.indexOf(DI),1),DI.Bb=0):DI==="cancelThread"?ZZ[gI.thread].postMessage({cmd:"cancel"}):DI==="loaded"?(J.loaded=!0,D(J)):DI==="alert"?alert(`Thread ${gI.threadId}: ${gI.text}`):gI.target==="setimmediate"?J.postMessage(gI):DI==="callHandler"?x[gI.handler](...gI.args):DI&&xl(`worker sent an unknown command ${DI}`)},J.onerror=gI=>{throw xl(`worker sent an error! ${gI.filename}:${gI.lineno}: ${gI.message}`),gI};var nI,RI=[];for(nI of[])x.hasOwnProperty(nI)&&RI.push(nI);J.postMessage({cmd:"load",handlers:RI,wasmMemory:GG,wasmModule:Bl})});function JX(){var J=new Worker(import.meta.url.startsWith("file:")?new URL(l("./node_modules/onnxruntime-web/dist/ort.bundle.min.mjs?46eb"),l.b):new URL(import.meta.url),{type:"module",workerData:"em-pthread",name:"em-pthread"});he.push(J)}var jV=J=>{for(;0<J.length;)J.shift()(x)},_1=()=>{var J=$t(),D=g()[J+52>>>2>>>0];J=g()[J+56>>>2>>>0],gi(D,D-J),Gp(D)},P1=(J,D)=>{pa=0,J=Ji(J,D),0<pa?QG=J:lp(J)};class $1{constructor(D){this.Kb=D-24}}function Iy(J,D,nI){var RI=new $1(J>>>=0);throw D>>>=0,nI>>>=0,g()[RI.Kb+16>>>2>>>0]=0,g()[RI.Kb+4>>>2>>>0]=D,g()[RI.Kb+8>>>2>>>0]=nI,J}function CX(J,D,nI,RI){return XI?Fc(2,1,J,D,nI,RI):AX(J,D,nI,RI)}function AX(J,D,nI,RI){if(J>>>=0,D>>>=0,nI>>>=0,RI>>>=0,xI===void 0)return xl("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var gI=[];return XI&&gI.length===0?CX(J,D,nI,RI):(J={ic:nI,Bb:J,Rb:RI,nc:gI},XI?(J.Nb="spawnThread",postMessage(J,gI),0):rX(J))}var LX=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,kX=(J,D,nI)=>{var RI=(D>>>=0)+nI;for(nI=D;J[nI]&&!(nI>=RI);)++nI;if(16<nI-D&&J.buffer&&LX)return LX.decode(J.buffer instanceof xI?J.slice(D,nI):J.subarray(D,nI));for(RI="";D<nI;){var gI=J[D++];if(128&gI){var DI=63&J[D++];if((224&gI)==192)RI+=String.fromCharCode((31&gI)<<6|DI);else{var ml=63&J[D++];65536>(gI=(240&gI)==224?(15&gI)<<12|DI<<6|ml:(7&gI)<<18|DI<<12|ml<<6|63&J[D++])?RI+=String.fromCharCode(gI):(gI-=65536,RI+=String.fromCharCode(55296|gI>>10,56320|1023&gI))}}else RI+=String.fromCharCode(gI)}return RI},Cc=(J,D)=>(J>>>=0)?kX(Y(),J,D):"";function xX(J,D,nI){return XI?Fc(3,1,J,D,nI):0}function zX(J,D){if(XI)return Fc(4,1,J,D)}var y2=J=>{for(var D=0,nI=0;nI<J.length;++nI){var RI=J.charCodeAt(nI);127>=RI?D++:2047>=RI?D+=2:55296<=RI&&57343>=RI?(D+=4,++nI):D+=3}return D},UX=(J,D,nI,RI)=>{if(!(0<RI))return 0;var gI=nI>>>=0;RI=nI+RI-1;for(var DI=0;DI<J.length;++DI){var ml=J.charCodeAt(DI);if(55296<=ml&&57343>=ml&&(ml=65536+((1023&ml)<<10)|1023&J.charCodeAt(++DI)),127>=ml){if(nI>=RI)break;D[nI++>>>0]=ml}else{if(2047>=ml){if(nI+1>=RI)break;D[nI++>>>0]=192|ml>>6}else{if(65535>=ml){if(nI+2>=RI)break;D[nI++>>>0]=224|ml>>12}else{if(nI+3>=RI)break;D[nI++>>>0]=240|ml>>18,D[nI++>>>0]=128|ml>>12&63}D[nI++>>>0]=128|ml>>6&63}D[nI++>>>0]=128|63&ml}}return D[nI>>>0]=0,nI-gI},qt=(J,D,nI)=>UX(J,Y(),D,nI);function MX(J,D){if(XI)return Fc(5,1,J,D)}function BX(J,D,nI){if(XI)return Fc(6,1,J,D,nI)}function OX(J,D,nI){return XI?Fc(7,1,J,D,nI):0}function jX(J,D){if(XI)return Fc(8,1,J,D)}function KX(J,D,nI){if(XI)return Fc(9,1,J,D,nI)}function TX(J,D,nI,RI){if(XI)return Fc(10,1,J,D,nI,RI)}function fX(J,D,nI,RI){if(XI)return Fc(11,1,J,D,nI,RI)}function SX(J,D,nI,RI){if(XI)return Fc(12,1,J,D,nI,RI)}function DX(J){if(XI)return Fc(13,1,J)}function qX(J,D){if(XI)return Fc(14,1,J,D)}function _X(J,D,nI){if(XI)return Fc(15,1,J,D,nI)}var PX,Ve,ly=()=>{Ye("")},eZ=J=>{for(var D="";Y()[J>>>0];)D+=PX[Y()[J++>>>0]];return D},g2={},J2={},Gy={};function JZ(J,D,nI={}){if(!("argPackAdvance"in D))throw new TypeError("registerType registeredInstance requires argPackAdvance");return function(RI,gI,DI={}){var ml=gI.name;if(!RI)throw new Ve(`type "${ml}" must have a positive integer typeid pointer`);if(J2.hasOwnProperty(RI)){if(DI.Tb)return;throw new Ve(`Cannot register type '${ml}' twice`)}J2[RI]=gI,delete Gy[RI],g2.hasOwnProperty(RI)&&(gI=g2[RI],delete g2[RI],gI.forEach(Yl=>Yl()))}(J,D,nI)}var $X=(J,D,nI)=>{switch(D){case 1:return nI?RI=>Z()[RI>>>0]:RI=>Y()[RI>>>0];case 2:return nI?RI=>R()[RI>>>1>>>0]:RI=>i()[RI>>>1>>>0];case 4:return nI?RI=>v()[RI>>>2>>>0]:RI=>g()[RI>>>2>>>0];case 8:return nI?RI=>ac[RI>>>3]:RI=>gZ[RI>>>3];default:throw new TypeError(`invalid integer width (${D}): ${J}`)}};function cy(J,D,nI){nI>>>=0,JZ(J>>>=0,{name:D=eZ(D>>>0),fromWireType:RI=>RI,toWireType:function(RI,gI){if(typeof gI!="bigint"&&typeof gI!="number")throw gI=gI===null?"null":(RI=typeof gI)=="object"||RI==="array"||RI==="function"?gI.toString():""+gI,new TypeError(`Cannot convert "${gI}" to ${this.name}`);return typeof gI=="number"&&(gI=BigInt(gI)),gI},argPackAdvance:pe,readValueFromPointer:$X(D,nI,D.indexOf("u")==-1),Eb:null})}var pe=8;function by(J,D,nI,RI){JZ(J>>>=0,{name:D=eZ(D>>>0),fromWireType:function(gI){return!!gI},toWireType:function(gI,DI){return DI?nI:RI},argPackAdvance:pe,readValueFromPointer:function(gI){return this.fromWireType(Y()[gI>>>0])},Eb:null})}var C2=[],CZ=[];function A2(J){9<(J>>>=0)&&--CZ[J+1]==0&&(CZ[J]=void 0,C2.push(J))}var Id=J=>{if(!J)throw new Ve("Cannot use deleted val. handle = "+J);return CZ[J]},Vd=J=>{switch(J){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let D=C2.pop()||CZ.length;return CZ[D]=J,CZ[D+1]=1,D}};function L2(J){return this.fromWireType(g()[J>>>2>>>0])}var dy={name:"emscripten::val",fromWireType:J=>{var D=Id(J);return A2(J),D},toWireType:(J,D)=>Vd(D),argPackAdvance:pe,readValueFromPointer:L2,Eb:null};function Zy(J){return JZ(J>>>0,dy)}var ey=(J,D)=>{switch(D){case 4:return function(nI){return this.fromWireType(M()[nI>>>2>>>0])};case 8:return function(nI){return this.fromWireType(j()[nI>>>3>>>0])};default:throw new TypeError(`invalid float width (${D}): ${J}`)}};function ay(J,D,nI){nI>>>=0,JZ(J>>>=0,{name:D=eZ(D>>>0),fromWireType:RI=>RI,toWireType:(RI,gI)=>gI,argPackAdvance:pe,readValueFromPointer:ey(D,nI),Eb:null})}function Wy(J,D,nI,RI,gI){if(J>>>=0,nI>>>=0,D=eZ(D>>>0),gI===-1&&(gI=4294967295),gI=Yl=>Yl,RI===0){var DI=32-8*nI;gI=Yl=>Yl<<DI>>>DI}var ml=D.includes("unsigned")?function(Yl,Jl){return Jl>>>0}:function(Yl,Jl){return Jl};JZ(J,{name:D,fromWireType:gI,toWireType:ml,argPackAdvance:pe,readValueFromPointer:$X(D,nI,RI!==0),Eb:null})}function ty(J,D,nI){function RI(DI){var ml=g()[DI>>>2>>>0];return DI=g()[DI+4>>>2>>>0],new gI(Z().buffer,DI,ml)}var gI=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][D];JZ(J>>>=0,{name:nI=eZ(nI>>>0),fromWireType:RI,argPackAdvance:pe,readValueFromPointer:RI},{Tb:!0})}function ny(J,D){J>>>=0;var nI=(D=eZ(D>>>0))==="std::string";JZ(J,{name:D,fromWireType:function(RI){var gI=g()[RI>>>2>>>0],DI=RI+4;if(nI)for(var ml=DI,Yl=0;Yl<=gI;++Yl){var Jl=DI+Yl;if(Yl==gI||Y()[Jl>>>0]==0){if(ml=Cc(ml,Jl-ml),zl===void 0)var zl=ml;else zl+="\0",zl+=ml;ml=Jl+1}}else{for(zl=Array(gI),Yl=0;Yl<gI;++Yl)zl[Yl]=String.fromCharCode(Y()[DI+Yl>>>0]);zl=zl.join("")}return WZ(RI),zl},toWireType:function(RI,gI){gI instanceof ArrayBuffer&&(gI=new Uint8Array(gI));var DI=typeof gI=="string";if(!(DI||gI instanceof Uint8Array||gI instanceof Uint8ClampedArray||gI instanceof Int8Array))throw new Ve("Cannot pass non-string to std::string");var ml=nI&&DI?y2(gI):gI.length,Yl=Ip(4+ml+1),Jl=Yl+4;if(g()[Yl>>>2>>>0]=ml,nI&&DI)qt(gI,Jl,ml+1);else if(DI)for(DI=0;DI<ml;++DI){var zl=gI.charCodeAt(DI);if(255<zl)throw WZ(Jl),new Ve("String has UTF-16 code units that do not fit in 8 bits");Y()[Jl+DI>>>0]=zl}else for(DI=0;DI<ml;++DI)Y()[Jl+DI>>>0]=gI[DI];return RI!==null&&RI.push(WZ,Yl),Yl},argPackAdvance:pe,readValueFromPointer:L2,Eb(RI){WZ(RI)}})}var Ii=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,my=(J,D)=>{for(var nI=J>>1,RI=nI+D/2;!(nI>=RI)&&i()[nI>>>0];)++nI;if(32<(nI<<=1)-J&&Ii)return Ii.decode(Y().slice(J,nI));for(nI="",RI=0;!(RI>=D/2);++RI){var gI=R()[J+2*RI>>>1>>>0];if(gI==0)break;nI+=String.fromCharCode(gI)}return nI},Ny=(J,D,nI)=>{if(nI??=2147483647,2>nI)return 0;var RI=D;nI=(nI-=2)<2*J.length?nI/2:J.length;for(var gI=0;gI<nI;++gI){var DI=J.charCodeAt(gI);R()[D>>>1>>>0]=DI,D+=2}return R()[D>>>1>>>0]=0,D-RI},sy=J=>2*J.length,Yy=(J,D)=>{for(var nI=0,RI="";!(nI>=D/4);){var gI=v()[J+4*nI>>>2>>>0];if(gI==0)break;++nI,65536<=gI?(gI-=65536,RI+=String.fromCharCode(55296|gI>>10,56320|1023&gI)):RI+=String.fromCharCode(gI)}return RI},hy=(J,D,nI)=>{if(D>>>=0,nI??=2147483647,4>nI)return 0;var RI=D;nI=RI+nI-4;for(var gI=0;gI<J.length;++gI){var DI=J.charCodeAt(gI);if(55296<=DI&&57343>=DI&&(DI=65536+((1023&DI)<<10)|1023&J.charCodeAt(++gI)),v()[D>>>2>>>0]=DI,(D+=4)+4>nI)break}return v()[D>>>2>>>0]=0,D-RI},Vy=J=>{for(var D=0,nI=0;nI<J.length;++nI){var RI=J.charCodeAt(nI);55296<=RI&&57343>=RI&&++nI,D+=4}return D};function py(J,D,nI){if(J>>>=0,D>>>=0,nI=eZ(nI>>>=0),D===2)var RI=my,gI=Ny,DI=sy,ml=Yl=>i()[Yl>>>1>>>0];else D===4&&(RI=Yy,gI=hy,DI=Vy,ml=Yl=>g()[Yl>>>2>>>0]);JZ(J,{name:nI,fromWireType:Yl=>{for(var Jl,zl=g()[Yl>>>2>>>0],Pl=Yl+4,CG=0;CG<=zl;++CG){var fG=Yl+4+CG*D;CG!=zl&&ml(fG)!=0||(Pl=RI(Pl,fG-Pl),Jl===void 0?Jl=Pl:(Jl+="\0",Jl+=Pl),Pl=fG+D)}return WZ(Yl),Jl},toWireType:(Yl,Jl)=>{if(typeof Jl!="string")throw new Ve(`Cannot pass non-string to C++ string type ${nI}`);var zl=DI(Jl),Pl=Ip(4+zl+D);return g()[Pl>>>2>>>0]=zl/D,gI(Jl,Pl+4,zl+D),Yl!==null&&Yl.push(WZ,Pl),Pl},argPackAdvance:pe,readValueFromPointer:L2,Eb(Yl){WZ(Yl)}})}function uy(J,D){JZ(J>>>=0,{Ub:!0,name:D=eZ(D>>>0),argPackAdvance:0,fromWireType:()=>{},toWireType:()=>{}})}var Ry=()=>1;function oy(J){O2(J>>>0,!oI,1,!rI,131072,!1),yX()}var li=J=>{if(!sc)try{if(J(),!(0<pa))try{XI?lp(QG):E2(QG)}catch(D){D instanceof r2||D=="unwind"||qI(0,D)}}catch(D){D instanceof r2||D=="unwind"||qI(0,D)}};function k2(J){J>>>=0,typeof Atomics.oc=="function"&&(Atomics.oc(v(),J>>>2,J).value.then(KV),J+=128,Atomics.store(v(),J>>>2,1))}var KV=()=>{var J=$t();J&&(k2(J),li(yi))};function Fy(J,D){(J>>>=0)==D>>>0?setTimeout(KV):XI?postMessage({targetThread:J,cmd:"checkMailbox"}):(J=ZZ[J])&&J.postMessage({cmd:"checkMailbox"})}var x2=[];function Xy(J,D,nI,RI,gI){for(D>>>=0,RI/=2,x2.length=RI,nI=gI>>>0>>>3,gI=0;gI<RI;gI++)x2[gI]=ac[nI+2*gI]?ac[nI+2*gI+1]:j()[nI+2*gI+1>>>0];return(D?H2[D]:Ng[J])(...x2)}function iy(J){J>>>=0,XI?postMessage({cmd:"cleanupThread",thread:J}):EX(ZZ[J])}function Qy(J){}var TV=(J,D)=>{var nI=J2[J];if(nI===void 0)throw J=ri(J),nI=eZ(J),WZ(J),new Ve(`${D} has unknown type ${nI}`);return nI},Gi=(J,D,nI)=>{var RI=[];return J=J.toWireType(RI,nI),RI.length&&(g()[D>>>2>>>0]=Vd(RI)),J};function Hy(J,D,nI){return D>>>=0,nI>>>=0,J=Id(J>>>0),D=TV(D,"emval::as"),Gi(D,nI,J)}function ry(J,D){return D>>>=0,J=Id(J>>>0),(D=TV(D,"emval::as")).toWireType(null,J)}var fV=J=>{try{J()}catch(D){Ye(D)}},ue=0,aZ=null,ci=0,SV=[],bi={},di={},wy=0,z2=null,vy=[];function Zi(J){return function(D){if(!sc){if(ue===0){var nI=!1,RI=!1;D((gI=0)=>{if(!sc&&(ci=gI,nI=!0,RI)){ue=2,fV(()=>Li(aZ)),typeof Browser<"u"&&Browser.Lb.Sb&&Browser.Lb.resume(),gI=!1;try{var DI=function(){var Jl=v()[aZ+8>>>2>>>0];return Jl=_l[di[Jl]],--pa,Jl()}()}catch(Jl){DI=Jl,gI=!0}var ml=!1;if(!aZ){var Yl=z2;Yl&&(z2=null,(gI?Yl.reject:Yl.resolve)(DI),ml=!0)}if(gI&&!ml)throw DI}}),RI=!0,nI||(ue=1,aZ=function(){var gI=Ip(65548),DI=gI+12;g()[gI>>>2>>>0]=DI,g()[gI+4>>>2>>>0]=DI+65536,DI=SV[0];var ml=bi[DI];return ml===void 0&&(ml=wy++,bi[DI]=ml,di[ml]=DI),DI=ml,v()[gI+8>>>2>>>0]=DI,gI}(),typeof Browser<"u"&&Browser.Lb.Sb&&Browser.Lb.pause(),fV(()=>Ci(aZ)))}else ue===2?(ue=0,fV(ki),WZ(aZ),aZ=null,vy.forEach(li)):Ye(`invalid state: ${ue}`);return ci}}(D=>{J().then(D)})}function Ey(J){return J>>>=0,Zi(()=>(J=Id(J)).then(Vd))}var DV=[];function yy(J,D,nI,RI){return nI>>>=0,RI>>>=0,(J=DV[J>>>0])(null,D=Id(D>>>0),nI,RI)}var gy={},qV=J=>{var D=gy[J];return D===void 0?eZ(J):D};function Jy(J,D,nI,RI,gI){return nI>>>=0,RI>>>=0,gI>>>=0,(J=DV[J>>>0])(D=Id(D>>>0),D[nI=qV(nI)],RI,gI)}var ei=()=>typeof globalThis=="object"?globalThis:Function("return this")();function Cy(J){return(J>>>=0)==0?Vd(ei()):(J=qV(J),Vd(ei()[J]))}var Ay=J=>{var D=DV.length;return DV.push(J),D},Ly=(J,D)=>{for(var nI=Array(J),RI=0;RI<J;++RI)nI[RI]=TV(g()[D+4*RI>>>2>>>0],"parameter "+RI);return nI},ai=(J,D)=>Object.defineProperty(D,"name",{value:J});function ky(J,D,nI){var RI=(D=Ly(J,D>>>0)).shift();J--;var gI=`return function (obj, func, destructorsRef, args) {
`,DI=0,ml=[];nI===0&&ml.push("obj");for(var Yl=["retType"],Jl=[RI],zl=0;zl<J;++zl)ml.push("arg"+zl),Yl.push("argType"+zl),Jl.push(D[zl]),gI+=`  var arg${zl} = argType${zl}.readValueFromPointer(args${DI?"+"+DI:""});
`,DI+=D[zl].argPackAdvance;return gI+=`  var rv = ${nI===1?"new func":"func.call"}(${ml.join(", ")});
`,RI.Ub||(Yl.push("emval_returnValue"),Jl.push(Gi),gI+=`  return emval_returnValue(retType, destructorsRef, rv);
`),Yl.push(gI+`};
`),J=function(Pl){var CG=Function;if(!(CG instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof CG} which is not a function`);var fG=ai(CG.name||"unknownFunctionName",function(){});return fG.prototype=CG.prototype,fG=new fG,(Pl=CG.apply(fG,Pl))instanceof Object?Pl:fG}(Yl)(...Jl),nI=`methodCaller<(${D.map(Pl=>Pl.name).join(", ")}) => ${RI.name}>`,Ay(ai(nI,J))}function xy(J){return J=qV(J>>>0),Vd(x[J])}function zy(J,D){return D>>>=0,J=Id(J>>>0),D=Id(D),Vd(J[D])}function Uy(J){9<(J>>>=0)&&(CZ[J+1]+=1)}function My(){return Vd([])}function By(J){J=Id(J>>>0);for(var D=Array(J.length),nI=0;nI<J.length;nI++)D[nI]=J[nI];return Vd(D)}function Oy(J){return Vd(qV(J>>>0))}function jy(){return Vd({})}function Ky(J){for(var D=Id(J>>>=0);D.length;){var nI=D.pop();D.pop()(nI)}A2(J)}function Ty(J,D,nI){D>>>=0,nI>>>=0,J=Id(J>>>0),D=Id(D),nI=Id(nI),J[D]=nI}function fy(J,D){return D>>>=0,J=(J=TV(J>>>0,"_emval_take_value")).readValueFromPointer(D),Vd(J)}function Sy(J,D){J=-9007199254740992>J||9007199254740992<J?NaN:Number(J),D>>>=0,J=new Date(1e3*J),v()[D>>>2>>>0]=J.getUTCSeconds(),v()[D+4>>>2>>>0]=J.getUTCMinutes(),v()[D+8>>>2>>>0]=J.getUTCHours(),v()[D+12>>>2>>>0]=J.getUTCDate(),v()[D+16>>>2>>>0]=J.getUTCMonth(),v()[D+20>>>2>>>0]=J.getUTCFullYear()-1900,v()[D+24>>>2>>>0]=J.getUTCDay(),J=(J.getTime()-Date.UTC(J.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,v()[D+28>>>2>>>0]=J}var _t=J=>J%4==0&&(J%100!=0||J%400==0),Wi=[0,31,60,91,121,152,182,213,244,274,305,335],ti=[0,31,59,90,120,151,181,212,243,273,304,334];function Dy(J,D){J=-9007199254740992>J||9007199254740992<J?NaN:Number(J),D>>>=0,J=new Date(1e3*J),v()[D>>>2>>>0]=J.getSeconds(),v()[D+4>>>2>>>0]=J.getMinutes(),v()[D+8>>>2>>>0]=J.getHours(),v()[D+12>>>2>>>0]=J.getDate(),v()[D+16>>>2>>>0]=J.getMonth(),v()[D+20>>>2>>>0]=J.getFullYear()-1900,v()[D+24>>>2>>>0]=J.getDay();var nI=(_t(J.getFullYear())?Wi:ti)[J.getMonth()]+J.getDate()-1|0;v()[D+28>>>2>>>0]=nI,v()[D+36>>>2>>>0]=-60*J.getTimezoneOffset(),nI=new Date(J.getFullYear(),6,1).getTimezoneOffset();var RI=new Date(J.getFullYear(),0,1).getTimezoneOffset();J=0|(nI!=RI&&J.getTimezoneOffset()==Math.min(RI,nI)),v()[D+32>>>2>>>0]=J}function qy(J){J>>>=0;var D=new Date(v()[J+20>>>2>>>0]+1900,v()[J+16>>>2>>>0],v()[J+12>>>2>>>0],v()[J+8>>>2>>>0],v()[J+4>>>2>>>0],v()[J>>>2>>>0],0),nI=v()[J+32>>>2>>>0],RI=D.getTimezoneOffset(),gI=new Date(D.getFullYear(),6,1).getTimezoneOffset(),DI=new Date(D.getFullYear(),0,1).getTimezoneOffset(),ml=Math.min(DI,gI);return 0>nI?v()[J+32>>>2>>>0]=+(gI!=DI&&ml==RI):0<nI!=(ml==RI)&&(gI=Math.max(DI,gI),D.setTime(D.getTime()+6e4*((0<nI?ml:gI)-RI))),v()[J+24>>>2>>>0]=D.getDay(),nI=(_t(D.getFullYear())?Wi:ti)[D.getMonth()]+D.getDate()-1|0,v()[J+28>>>2>>>0]=nI,v()[J>>>2>>>0]=D.getSeconds(),v()[J+4>>>2>>>0]=D.getMinutes(),v()[J+8>>>2>>>0]=D.getHours(),v()[J+12>>>2>>>0]=D.getDate(),v()[J+16>>>2>>>0]=D.getMonth(),v()[J+20>>>2>>>0]=D.getYear(),J=D.getTime(),BigInt(isNaN(J)?-1:J/1e3)}function ni(J,D,nI,RI,gI,DI,ml){return XI?Fc(16,1,J,D,nI,RI,gI,DI,ml):-52}function mi(J,D,nI,RI,gI,DI){if(XI)return Fc(17,1,J,D,nI,RI,gI,DI)}function _y(J,D,nI,RI){J>>>=0,D>>>=0,nI>>>=0,RI>>>=0;var gI=new Date().getFullYear(),DI=new Date(gI,0,1),ml=new Date(gI,6,1);gI=DI.getTimezoneOffset();var Yl=ml.getTimezoneOffset(),Jl=Math.max(gI,Yl);g()[J>>>2>>>0]=60*Jl,v()[D>>>2>>>0]=+(gI!=Yl),DI=(J=zl=>zl.toLocaleTimeString(void 0,{hour12:!1,timeZoneName:"short"}).split(" ")[1])(DI),ml=J(ml),Yl<gI?(qt(DI,nI,17),qt(ml,RI,17)):(qt(DI,RI,17),qt(ml,nI,17))}var U2=[],Ni=(J,D)=>{U2.length=0;for(var nI;nI=Y()[J++>>>0];){var RI=nI!=105;D+=(RI&=nI!=112)&&D%8?4:0,U2.push(nI==112?g()[D>>>2>>>0]:nI==106?ac[D>>>3]:nI==105?v()[D>>>2>>>0]:j()[D>>>3>>>0]),D+=RI?8:4}return U2};function Py(J,D,nI){return J>>>=0,D=Ni(D>>>0,nI>>>0),H2[J](...D)}function $y(J,D,nI){return J>>>=0,D=Ni(D>>>0,nI>>>0),H2[J](...D)}var Ig=()=>{},lg=()=>Date.now();function Gg(J,D){return xl(Cc(J>>>0,D>>>0))}var si,cg=()=>{throw pa+=1,"unwind"};function bg(){return 4294901760}si=()=>performance.timeOrigin+performance.now();var dg=()=>navigator.hardwareConcurrency;function Zg(){return Ye("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function eg(J){J>>>=0;var D=Y().length;if(J<=D||4294901760<J)return!1;for(var nI=1;4>=nI;nI*=2){var RI=D*(1+.2/nI);RI=Math.min(RI,J+100663296);var gI=Math;RI=Math.max(J,RI);I:{gI=(gI.min.call(gI,4294901760,RI+(65536-RI%65536)%65536)-GG.buffer.byteLength+65535)/65536;try{GG.grow(gI),tb();var DI=1;break I}catch{}DI=void 0}if(DI)return!0}return!1}var _V=()=>(Ye("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),Pt={},Yi=J=>{J.forEach(D=>{var nI=_V();nI&&(Pt[nI]=D)})};function ag(){var J=Error().stack.toString().split(`
`);return J[0]=="Error"&&J.shift(),Yi(J),Pt.Qb=_V(),Pt.fc=J,Pt.Qb}function Wg(J,D,nI){if(J>>>=0,D>>>=0,Pt.Qb==J)var RI=Pt.fc;else(RI=Error().stack.toString().split(`
`))[0]=="Error"&&RI.shift(),Yi(RI);for(var gI=3;RI[gI]&&_V()!=J;)++gI;for(J=0;J<nI&&RI[J+gI];++J)v()[D+4*J>>>2>>>0]=_V();return J}var M2,B2={},hi=()=>{if(!M2){var J,D={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(J in B2)B2[J]===void 0?delete D[J]:D[J]=B2[J];var nI=[];for(J in D)nI.push(`${J}=${D[J]}`);M2=nI}return M2};function Vi(J,D){if(XI)return Fc(18,1,J,D);J>>>=0,D>>>=0;var nI=0;return hi().forEach((RI,gI)=>{var DI=D+nI;for(gI=g()[J+4*gI>>>2>>>0]=DI,DI=0;DI<RI.length;++DI)Z()[gI++>>>0]=RI.charCodeAt(DI);Z()[gI>>>0]=0,nI+=RI.length+1}),0}function pi(J,D){if(XI)return Fc(19,1,J,D);J>>>=0,D>>>=0;var nI=hi();g()[J>>>2>>>0]=nI.length;var RI=0;return nI.forEach(gI=>RI+=gI.length+1),g()[D>>>2>>>0]=RI,0}function ui(J){return XI?Fc(20,1,J):52}function Ri(J,D,nI,RI){return XI?Fc(21,1,J,D,nI,RI):52}function oi(J,D,nI,RI){return XI?Fc(22,1,J,D,nI,RI):70}var tg=[null,[],[]];function Fi(J,D,nI,RI){if(XI)return Fc(23,1,J,D,nI,RI);D>>>=0,nI>>>=0,RI>>>=0;for(var gI=0,DI=0;DI<nI;DI++){var ml=g()[D>>>2>>>0],Yl=g()[D+4>>>2>>>0];D+=8;for(var Jl=0;Jl<Yl;Jl++){var zl=Y()[ml+Jl>>>0],Pl=tg[J];zl===0||zl===10?((J===1?kl:xl)(kX(Pl,0)),Pl.length=0):Pl.push(zl)}gI+=Yl}return g()[RI>>>2>>>0]=gI,0}var Xi=[31,29,31,30,31,30,31,31,30,31,30,31],ii=[31,28,31,30,31,30,31,31,30,31,30,31],ng=(J,D)=>{Z().set(J,D>>>0)};function Qi(J,D,nI,RI){function gI(al,yG,wc){for(al=typeof al=="number"?al.toString():al||"";al.length<yG;)al=wc[0]+al;return al}function DI(al,yG){return gI(al,yG,"0")}function ml(al,yG){function wc(zi){return 0>zi?-1:0<zi?1:0}var Ra;return(Ra=wc(al.getFullYear()-yG.getFullYear()))===0&&(Ra=wc(al.getMonth()-yG.getMonth()))===0&&(Ra=wc(al.getDate()-yG.getDate())),Ra}function Yl(al){switch(al.getDay()){case 0:return new Date(al.getFullYear()-1,11,29);case 1:return al;case 2:return new Date(al.getFullYear(),0,3);case 3:return new Date(al.getFullYear(),0,2);case 4:return new Date(al.getFullYear(),0,1);case 5:return new Date(al.getFullYear()-1,11,31);case 6:return new Date(al.getFullYear()-1,11,30)}}function Jl(al){var yG=al.Cb;for(al=new Date(new Date(al.Db+1900,0,1).getTime());0<yG;){var wc=al.getMonth(),Ra=(_t(al.getFullYear())?Xi:ii)[wc];if(!(yG>Ra-al.getDate())){al.setDate(al.getDate()+yG);break}yG-=Ra-al.getDate()+1,al.setDate(1),11>wc?al.setMonth(wc+1):(al.setMonth(0),al.setFullYear(al.getFullYear()+1))}return wc=new Date(al.getFullYear()+1,0,4),yG=Yl(new Date(al.getFullYear(),0,4)),wc=Yl(wc),0>=ml(yG,al)?0>=ml(wc,al)?al.getFullYear()+1:al.getFullYear():al.getFullYear()-1}J>>>=0,D>>>=0,nI>>>=0,RI>>>=0;var zl=g()[RI+40>>>2>>>0];for(var Pl in RI={lc:v()[RI>>>2>>>0],kc:v()[RI+4>>>2>>>0],Ib:v()[RI+8>>>2>>>0],Mb:v()[RI+12>>>2>>>0],Jb:v()[RI+16>>>2>>>0],Db:v()[RI+20>>>2>>>0],vb:v()[RI+24>>>2>>>0],Cb:v()[RI+28>>>2>>>0],sc:v()[RI+32>>>2>>>0],jc:v()[RI+36>>>2>>>0],mc:zl?Cc(zl):""},nI=Cc(nI),zl={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})nI=nI.replace(new RegExp(Pl,"g"),zl[Pl]);var CG="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),fG="January February March April May June July August September October November December".split(" ");for(Pl in zl={"%a":al=>CG[al.vb].substring(0,3),"%A":al=>CG[al.vb],"%b":al=>fG[al.Jb].substring(0,3),"%B":al=>fG[al.Jb],"%C":al=>DI((al.Db+1900)/100|0,2),"%d":al=>DI(al.Mb,2),"%e":al=>gI(al.Mb,2," "),"%g":al=>Jl(al).toString().substring(2),"%G":Jl,"%H":al=>DI(al.Ib,2),"%I":al=>((al=al.Ib)==0?al=12:12<al&&(al-=12),DI(al,2)),"%j":al=>{for(var yG=0,wc=0;wc<=al.Jb-1;yG+=(_t(al.Db+1900)?Xi:ii)[wc++]);return DI(al.Mb+yG,3)},"%m":al=>DI(al.Jb+1,2),"%M":al=>DI(al.kc,2),"%n":()=>`
`,"%p":al=>0<=al.Ib&&12>al.Ib?"AM":"PM","%S":al=>DI(al.lc,2),"%t":()=>"	","%u":al=>al.vb||7,"%U":al=>DI(Math.floor((al.Cb+7-al.vb)/7),2),"%V":al=>{var yG=Math.floor((al.Cb+7-(al.vb+6)%7)/7);if(2>=(al.vb+371-al.Cb-2)%7&&yG++,yG)yG==53&&((wc=(al.vb+371-al.Cb)%7)==4||wc==3&&_t(al.Db)||(yG=1));else{yG=52;var wc=(al.vb+7-al.Cb-1)%7;(wc==4||wc==5&&_t(al.Db%400-1))&&yG++}return DI(yG,2)},"%w":al=>al.vb,"%W":al=>DI(Math.floor((al.Cb+7-(al.vb+6)%7)/7),2),"%y":al=>(al.Db+1900).toString().substring(2),"%Y":al=>al.Db+1900,"%z":al=>{var yG=0<=(al=al.jc);return al=Math.abs(al)/60,(yG?"+":"-")+("0000"+(al/60*100+al%60)).slice(-4)},"%Z":al=>al.mc,"%%":()=>"%"},nI=nI.replace(/%%/g,"\0\0"),zl)nI.includes(Pl)&&(nI=nI.replace(new RegExp(Pl,"g"),zl[Pl](RI)));return Pl=function(al){var yG=Array(y2(al)+1);return UX(al,yG,0,yG.length),yG}(nI=nI.replace(/\0\0/g,"%")),Pl.length>D?0:(ng(Pl,J),Pl.length-1)}function mg(J,D,nI,RI){return Qi(J>>>0,D>>>0,nI>>>0,RI>>>0)}XI||function(){for(var J=x.numThreads-1;J--;)JX();OV.unshift(()=>{CY++,function(D){XI?D():Promise.all(he.map(gX)).then(D)}(()=>oX())})}();for(var Hi=Array(256),PV=0;256>PV;++PV)Hi[PV]=String.fromCharCode(PV);PX=Hi,Ve=x.BindingError=class extends Error{constructor(J){super(J),this.name="BindingError"}},x.InternalError=class extends Error{constructor(J){super(J),this.name="InternalError"}},CZ.push(0,1,void 0,1,null,1,!0,1,!1,1),x.count_emval_handles=()=>CZ.length/2-5-C2.length;var Ng=[v2,wX,CX,xX,zX,MX,BX,OX,jX,KX,TX,fX,SX,DX,qX,_X,ni,mi,Vi,pi,ui,Ri,oi,Fi],_l=function(){function J(nI,RI){return _l=nI.exports,_l=function(){var gI=_l,DI={};for(let[ml,Yl]of Object.entries(gI))DI[ml]=typeof Yl=="function"?(...Jl)=>{SV.push(ml);try{return Yl(...Jl)}finally{sc||(SV.pop(),aZ&&ue===1&&SV.length===0&&(ue=0,pa+=1,fV(Ai),typeof Fibers<"u"&&Fibers.tc()))}}:Yl;return DI}(),_l=function(){var gI=_l,DI=Yl=>Jl=>Yl(Jl)>>>0,ml=Yl=>()=>Yl()>>>0;return(gI=Object.assign({},gI)).Da=DI(gI.Da),gI.gb=ml(gI.gb),gI.ib=DI(gI.ib),gI.emscripten_main_runtime_thread_id=ml(gI.emscripten_main_runtime_thread_id),gI.tb=DI(gI.tb),gI.ub=ml(gI.ub),gI}(),vX.push(_l.jb),JY.unshift(_l.Ca),Bl=RI,oX(),_l}var D=HX();if(CY++,x.instantiateWasm)try{return x.instantiateWasm(D,J)}catch(nI){xl(`Module.instantiateWasm callback failed with error: ${nI}`),mI(nI)}return Q2||=x.locateFile?FX("ort-wasm-simd-threaded.jsep.wasm")?"ort-wasm-simd-threaded.jsep.wasm":x.locateFile?x.locateFile("ort-wasm-simd-threaded.jsep.wasm",ll):ll+"ort-wasm-simd-threaded.jsep.wasm":new URL(l("./node_modules/onnxruntime-web/dist/ort-wasm-simd-threaded.jsep.wasm"),l.b).href,function(nI,RI){var gI=Q2;return cl||typeof WebAssembly.instantiateStreaming!="function"||FX(gI)||XX(gI)||typeof fetch!="function"?QX(gI,nI,RI):fetch(gI,{credentials:"same-origin"}).then(DI=>WebAssembly.instantiateStreaming(DI,nI).then(RI,function(ml){return xl(`wasm streaming compile failed: ${ml}`),xl("falling back to ArrayBuffer instantiation"),QX(gI,nI,RI)}))}(D,function(nI){J(nI.instance,nI.module)}).catch(mI),{}}(),ri=J=>(ri=_l.Da)(J),wi=()=>(wi=_l.Ea)();x._OrtInit=(J,D)=>(x._OrtInit=_l.Fa)(J,D),x._OrtGetLastError=(J,D)=>(x._OrtGetLastError=_l.Ga)(J,D),x._OrtCreateSessionOptions=(J,D,nI,RI,gI,DI,ml,Yl,Jl,zl)=>(x._OrtCreateSessionOptions=_l.Ha)(J,D,nI,RI,gI,DI,ml,Yl,Jl,zl),x._OrtAppendExecutionProvider=(J,D)=>(x._OrtAppendExecutionProvider=_l.Ia)(J,D),x._OrtAddFreeDimensionOverride=(J,D,nI)=>(x._OrtAddFreeDimensionOverride=_l.Ja)(J,D,nI),x._OrtAddSessionConfigEntry=(J,D,nI)=>(x._OrtAddSessionConfigEntry=_l.Ka)(J,D,nI),x._OrtReleaseSessionOptions=J=>(x._OrtReleaseSessionOptions=_l.La)(J),x._OrtCreateSession=(J,D,nI)=>(x._OrtCreateSession=_l.Ma)(J,D,nI),x._OrtReleaseSession=J=>(x._OrtReleaseSession=_l.Na)(J),x._OrtGetInputOutputCount=(J,D,nI)=>(x._OrtGetInputOutputCount=_l.Oa)(J,D,nI),x._OrtGetInputName=(J,D)=>(x._OrtGetInputName=_l.Pa)(J,D),x._OrtGetOutputName=(J,D)=>(x._OrtGetOutputName=_l.Qa)(J,D),x._OrtFree=J=>(x._OrtFree=_l.Ra)(J),x._OrtCreateTensor=(J,D,nI,RI,gI,DI)=>(x._OrtCreateTensor=_l.Sa)(J,D,nI,RI,gI,DI),x._OrtGetTensorData=(J,D,nI,RI,gI)=>(x._OrtGetTensorData=_l.Ta)(J,D,nI,RI,gI),x._OrtReleaseTensor=J=>(x._OrtReleaseTensor=_l.Ua)(J),x._OrtCreateRunOptions=(J,D,nI,RI)=>(x._OrtCreateRunOptions=_l.Va)(J,D,nI,RI),x._OrtAddRunConfigEntry=(J,D,nI)=>(x._OrtAddRunConfigEntry=_l.Wa)(J,D,nI),x._OrtReleaseRunOptions=J=>(x._OrtReleaseRunOptions=_l.Xa)(J),x._OrtCreateBinding=J=>(x._OrtCreateBinding=_l.Ya)(J),x._OrtBindInput=(J,D,nI)=>(x._OrtBindInput=_l.Za)(J,D,nI),x._OrtBindOutput=(J,D,nI,RI)=>(x._OrtBindOutput=_l._a)(J,D,nI,RI),x._OrtClearBoundOutputs=J=>(x._OrtClearBoundOutputs=_l.$a)(J),x._OrtReleaseBinding=J=>(x._OrtReleaseBinding=_l.ab)(J),x._OrtRunWithBinding=(J,D,nI,RI,gI)=>(x._OrtRunWithBinding=_l.bb)(J,D,nI,RI,gI),x._OrtRun=(J,D,nI,RI,gI,DI,ml,Yl)=>(x._OrtRun=_l.cb)(J,D,nI,RI,gI,DI,ml,Yl),x._OrtEndProfiling=J=>(x._OrtEndProfiling=_l.db)(J),x._JsepOutput=(J,D,nI)=>(x._JsepOutput=_l.eb)(J,D,nI),x._JsepGetNodeName=J=>(x._JsepGetNodeName=_l.fb)(J);var $V,$t=()=>($t=_l.gb)(),WZ=x._free=J=>(WZ=x._free=_l.hb)(J),Ip=x._malloc=J=>(Ip=x._malloc=_l.ib)(J),O2=(J,D,nI,RI,gI,DI)=>(O2=_l.lb)(J,D,nI,RI,gI,DI),vi=()=>(vi=_l.mb)(),Ei=(J,D,nI,RI,gI)=>(Ei=_l.nb)(J,D,nI,RI,gI),j2=J=>(j2=_l.ob)(J),lp=J=>(lp=_l.pb)(J),yi=()=>(yi=_l.qb)(),gi=(J,D)=>(gi=_l.rb)(J,D),Gp=J=>(Gp=_l.sb)(J),K2=J=>(K2=_l.tb)(J),T2=()=>(T2=_l.ub)(),Ji=x.dynCall_ii=(J,D)=>(Ji=x.dynCall_ii=_l.wb)(J,D),Ci=J=>(Ci=_l.xb)(J),Ai=()=>(Ai=_l.yb)(),Li=J=>(Li=_l.zb)(J),ki=()=>(ki=_l.Ab)();function xi(){0<CY||(XI?(f(x),XI||jV(JY),startWorker(x)):(jV(OV),0<CY||$V||($V=!0,x.calledRun=!0,sc||(XI||jV(JY),f(x),XI||jV(S1)))))}return x.___start_em_js=932469,x.___stop_em_js=932715,x.stackSave=()=>T2(),x.stackRestore=J=>Gp(J),x.stackAlloc=J=>K2(J),x.setValue=function(J,D,nI="i8"){switch(nI.endsWith("*")&&(nI="*"),nI){case"i1":case"i8":Z()[J>>>0]=D;break;case"i16":R()[J>>>1>>>0]=D;break;case"i32":v()[J>>>2>>>0]=D;break;case"i64":ac[J>>>3]=BigInt(D);break;case"float":M()[J>>>2>>>0]=D;break;case"double":j()[J>>>3>>>0]=D;break;case"*":g()[J>>>2>>>0]=D;break;default:Ye(`invalid type for setValue: ${nI}`)}},x.getValue=function(J,D="i8"){switch(D.endsWith("*")&&(D="*"),D){case"i1":case"i8":return Z()[J>>>0];case"i16":return R()[J>>>1>>>0];case"i32":return v()[J>>>2>>>0];case"i64":return ac[J>>>3];case"float":return M()[J>>>2>>>0];case"double":return j()[J>>>3>>>0];case"*":return g()[J>>>2>>>0];default:Ye(`invalid type for getValue: ${D}`)}},x.UTF8ToString=Cc,x.stringToUTF8=qt,x.lengthBytesUTF8=y2,AY=function J(){$V||xi(),$V||(AY=J)},xi(),x.PTR_SIZE=4,NI}),jI=KI,globalThis.self?.name==="em-pthread"&&KI()}),wl,Ol,jl,NG,Fl,Dl,XG,LG,lc,DG,Wc,EG,MG,xc=n(()=>{"use strict";uI(),wl=typeof location>"u"?void 0:location.origin,Ol=()=>import.meta.url?.startsWith("file:")?new URL(new URL(l("./node_modules/onnxruntime-web/dist/ort.bundle.min.mjs?46eb"),l.b).href,wl).href:import.meta.url,jl=Ol(),NG=()=>{if(jl&&!jl.startsWith("blob:"))return jl.substring(0,jl.lastIndexOf("/")+1)},Fl=(c,Z)=>{try{let Y=Z??jl;return(Y?new URL(c,Y):new URL(c)).origin===wl}catch{return!1}},Dl=(c,Z)=>{let Y=Z??jl;try{return(Y?new URL(c,Y):new URL(c)).href}catch{return}},XG=(c,Z)=>`${Z??"./"}${c}`,LG=async c=>{let Z=await(await fetch(c,{credentials:"same-origin"})).blob();return URL.createObjectURL(Z)},lc=async c=>(await import(c)).default,DG=(nl(),m(wI)).default,Wc=async()=>{if(!jl)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(Fl(jl))return[void 0,DG()];let c=await LG(jl);return[c,DG(c)]},EG=(Wl(),m(ol)).default,MG=async(c,Z,Y)=>{if(!c&&!Z&&EG&&jl&&Fl(jl))return[void 0,EG];{let R="ort-wasm-simd-threaded.jsep.mjs",i=c??Dl(R,Z),v=Y&&i&&!Fl(i,Z),g=v?await LG(i):i??XG(R,Z);return[v?g:void 0,await lc(g)]}}}),qG,sl,ul,Cl,Gc,yc,ib,xG,lb=n(()=>{"use strict";xc(),sl=!1,ul=!1,Cl=!1,Gc=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},yc=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},ib=async c=>{if(sl)return Promise.resolve();if(ul)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Cl)throw new Error("previous call to 'initializeWebAssembly()' failed.");ul=!0;let Z=c.initTimeout,Y=c.numThreads;if(!yc())throw new Error("WebAssembly SIMD is not supported in the current environment.");let R=Gc();Y>1&&!R&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+Y+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),c.numThreads=Y=1);let i=c.wasmPaths,v=typeof i=="string"?i:void 0,g=i?.mjs,M=g?.href??g,j=i?.wasm,f=j?.href??j,mI=c.wasmBinary,[x,NI]=await MG(M,v,Y>1),rI=!1,oI=[];if(Z>0&&oI.push(new Promise(XI=>{setTimeout(()=>{rI=!0,XI()},Z)})),oI.push(new Promise((XI,xI)=>{let LI={numThreads:Y};if(mI)LI.wasmBinary=mI;else if(f||v)LI.locateFile=EI=>f??v+EI;else if(M&&M.indexOf("blob:")!==0)LI.locateFile=EI=>new URL(EI,M).href;else if(x){let EI=NG();EI&&(LI.locateFile=MI=>EI+MI)}NI(LI).then(EI=>{ul=!1,sl=!0,qG=EI,XI(),x&&URL.revokeObjectURL(x)},EI=>{ul=!1,Cl=!0,xI(EI)})})),await Promise.race(oI),rI)throw new Error(`WebAssembly backend initializing failed due to timeout: ${Z}ms`)},xG=()=>{if(sl&&qG)return qG;throw new Error("WebAssembly is not initialized yet.")}}),cc,Qb,YG,Lb=n(()=>{"use strict";lb(),cc=(c,Z)=>{let Y=xG(),R=Y.lengthBytesUTF8(c)+1,i=Y._malloc(R);return Y.stringToUTF8(c,i,R),Z.push(i),i},Qb=(c,Z,Y,R)=>{if(typeof c=="object"&&c!==null){if(Y.has(c))throw new Error("Circular reference in options");Y.add(c)}Object.entries(c).forEach(([i,v])=>{let g=Z?Z+i:i;if(typeof v=="object")Qb(v,g+".",Y,R);else if(typeof v=="string"||typeof v=="number")R(g,v.toString());else if(typeof v=="boolean")R(g,v?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof v}`)})},YG=c=>{let Z=xG(),Y=Z.stackSave();try{let R=Z.PTR_SIZE,i=Z.stackAlloc(2*R);Z._OrtGetLastError(i,i+R);let v=Number(Z.getValue(i,R===4?"i32":"i64")),g=Z.getValue(i+R,"*"),M=g?Z.UTF8ToString(g):"";throw new Error(`${c} ERROR_CODE: ${v}, ERROR_MESSAGE: ${M}`)}finally{Z.stackRestore(Y)}}}),sb,td=n(()=>{"use strict";lb(),Lb(),sb=c=>{let Z=xG(),Y=0,R=[],i=c||{};try{if(c?.logSeverityLevel===void 0)i.logSeverityLevel=2;else if(typeof c.logSeverityLevel!="number"||!Number.isInteger(c.logSeverityLevel)||c.logSeverityLevel<0||c.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${c.logSeverityLevel}`);if(c?.logVerbosityLevel===void 0)i.logVerbosityLevel=0;else if(typeof c.logVerbosityLevel!="number"||!Number.isInteger(c.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${c.logVerbosityLevel}`);c?.terminate===void 0&&(i.terminate=!1);let v=0;return c?.tag!==void 0&&(v=cc(c.tag,R)),Y=Z._OrtCreateRunOptions(i.logSeverityLevel,i.logVerbosityLevel,!!i.terminate,v),Y===0&&YG("Can't create run options."),c?.extra!==void 0&&Qb(c.extra,"",new WeakSet,(g,M)=>{let j=cc(g,R),f=cc(M,R);Z._OrtAddRunConfigEntry(Y,j,f)!==0&&YG(`Can't set a run config entry: ${g} - ${M}.`)}),[Y,R]}catch(v){throw Y!==0&&Z._OrtReleaseRunOptions(Y),R.forEach(g=>Z._free(g)),v}}}),Db,qb,_b,Yb,Pb,nd=n(()=>{"use strict";lb(),Lb(),Db=c=>{switch(c){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${c}`)}},qb=c=>{switch(c){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${c}`)}},_b=c=>{c.extra||(c.extra={}),c.extra.session||(c.extra.session={});let Z=c.extra.session;Z.use_ort_model_bytes_directly||(Z.use_ort_model_bytes_directly="1"),c.executionProviders&&c.executionProviders.some(Y=>(typeof Y=="string"?Y:Y.name)==="webgpu")&&(c.enableMemPattern=!1)},Yb=(c,Z,Y)=>{for(let R of Z){let i=typeof R=="string"?R:R.name;switch(i){case"webnn":if(i="WEBNN",typeof R!="string"){let g=R?.deviceType;if(g){let M=cc("deviceType",Y),j=cc(g,Y);xG()._OrtAddSessionConfigEntry(c,M,j)!==0&&YG(`Can't set a session config entry: 'deviceType' - ${g}.`)}}break;case"webgpu":if(i="JS",typeof R!="string"){let g=R;if(g?.preferredLayout){if(g.preferredLayout!=="NCHW"&&g.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${g.preferredLayout}`);let M=cc("preferredLayout",Y),j=cc(g.preferredLayout,Y);xG()._OrtAddSessionConfigEntry(c,M,j)!==0&&YG(`Can't set a session config entry: 'preferredLayout' - ${g.preferredLayout}.`)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${i}`)}let v=cc(i,Y);xG()._OrtAppendExecutionProvider(c,v)!==0&&YG(`Can't append execution provider: ${i}.`)}},Pb=c=>{let Z=xG(),Y=0,R=[],i=c||{};_b(i);try{let v=Db(i.graphOptimizationLevel??"all"),g=qb(i.executionMode??"sequential"),M=typeof i.logId=="string"?cc(i.logId,R):0,j=i.logSeverityLevel??2;if(!Number.isInteger(j)||j<0||j>4)throw new Error(`log serverity level is not valid: ${j}`);let f=i.logVerbosityLevel??0;if(!Number.isInteger(f)||f<0||f>4)throw new Error(`log verbosity level is not valid: ${f}`);let mI=typeof i.optimizedModelFilePath=="string"?cc(i.optimizedModelFilePath,R):0;if(Y=Z._OrtCreateSessionOptions(v,!!i.enableCpuMemArena,!!i.enableMemPattern,g,!!i.enableProfiling,0,M,j,f,mI),Y===0&&YG("Can't create session options."),i.executionProviders&&Yb(Y,i.executionProviders,R),i.enableGraphCapture!==void 0){if(typeof i.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${i.enableGraphCapture}`);let x=cc("enableGraphCapture",R),NI=cc(i.enableGraphCapture.toString(),R);Z._OrtAddSessionConfigEntry(Y,x,NI)!==0&&YG(`Can't set a session config entry: 'enableGraphCapture' - ${i.enableGraphCapture}.`)}if(i.freeDimensionOverrides)for(let[x,NI]of Object.entries(i.freeDimensionOverrides)){if(typeof x!="string")throw new Error(`free dimension override name must be a string: ${x}`);if(typeof NI!="number"||!Number.isInteger(NI)||NI<0)throw new Error(`free dimension override value must be a non-negative integer: ${NI}`);let rI=cc(x,R);Z._OrtAddFreeDimensionOverride(Y,rI,NI)!==0&&YG(`Can't set a free dimension override: ${x} - ${NI}.`)}return i.extra!==void 0&&Qb(i.extra,"",new WeakSet,(x,NI)=>{let rI=cc(x,R),oI=cc(NI,R);Z._OrtAddSessionConfigEntry(Y,rI,oI)!==0&&YG(`Can't set a session config entry: ${x} - ${NI}.`)}),[Y,R]}catch(v){throw Y!==0&&Z._OrtReleaseSessionOptions(Y)!==0&&YG("Can't release session options."),R.forEach(g=>Z._free(g)),v}}}),hb,kb,Vb,XZ,Dd,iZ,QZ,HZ,Sl=n(()=>{"use strict";hb=c=>{switch(c){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${c}`)}},kb=c=>{switch(c){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${c}`)}},Vb=(c,Z)=>{let Y=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][c],R=typeof Z=="number"?Z:Z.reduce((i,v)=>i*v,1);return Y>0?Math.ceil(R*Y):void 0},XZ=c=>{switch(c){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${c}`)}},Dd=c=>{switch(c){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${c}`)}},iZ=c=>c==="float32"||c==="float16"||c==="int32"||c==="int64"||c==="uint32"||c==="uint8"||c==="bool"||c==="uint4"||c==="int4",QZ=c=>c==="float32"||c==="float16"||c==="int32"||c==="int64"||c==="uint32"||c==="uint64"||c==="int8"||c==="uint8"||c==="bool"||c==="uint4"||c==="int4",HZ=c=>{switch(c){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${c}`)}}}),rZ,_Z=n(()=>{"use strict";uI(),rZ=async c=>{if(typeof c=="string"){let Z=await fetch(c);if(!Z.ok)throw new Error(`failed to load external data file: ${c}`);let Y=Z.headers.get("Content-Length"),R=Y?parseInt(Y,10):0;if(R<1073741824)return new Uint8Array(await Z.arrayBuffer());{if(!Z.body)throw new Error(`failed to load external data file: ${c}, no response body.`);let i=Z.body.getReader(),v;try{v=new ArrayBuffer(R)}catch(M){if(M instanceof RangeError){let j=Math.ceil(R/65536);v=new WebAssembly.Memory({initial:j,maximum:j}).buffer}else throw M}let g=0;for(;;){let{done:M,value:j}=await i.read();if(M)break;let f=j.byteLength;new Uint8Array(v,g,f).set(j),g+=f}return new Uint8Array(v,0,R)}}else return c instanceof Blob?new Uint8Array(await c.arrayBuffer()):c instanceof Uint8Array?c:new Uint8Array(c)}}),PZ,$Z,Jd,Ie,wZ,le,gG,$I=n(()=>{"use strict";Sl(),PZ=["V","I","W","E","F"],$Z=(c,Z)=>{console.log(`[${PZ[c]},${new Date().toISOString()}]${Z}`)},wZ=(c,Z)=>{Jd=c,Ie=Z},le=(c,Z)=>{let Y=Dd(c),R=Dd(Jd);Y>=R&&$Z(Y,typeof Z=="function"?Z():Z)},gG=(...c)=>{Ie&&le(...c)}}),II,AI=n(()=>{"use strict";Sl(),II=(c,Z)=>new(XZ(Z))(c)}),BI=n(()=>{"use strict"}),fI,bl,Nl,vl,yl,El,Hl,rG,dG,bc=n(()=>{"use strict";$I(),BI(),fI=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),bl=[],Nl=c=>Math.ceil(Number(c)/16)*16,vl=c=>{for(let Z=0;Z<bl.length;Z++){let Y=bl[Z];if(c<=Y)return Y}return Math.ceil(c/16)*16},yl=1,El=()=>yl++,Hl=async(c,Z,Y,R)=>{let i=Nl(Y),v=c.device.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let g=c.getCommandEncoder();c.endComputePass(),g.copyBufferToBuffer(Z,0,v,0,i),c.flush(),await v.mapAsync(GPUMapMode.READ);let M=v.getMappedRange();if(R){let j=R();return j.set(new Uint8Array(M,0,Y)),j}else return new Uint8Array(M.slice(0,Y))}finally{v.destroy()}},rG=class{constructor(c){this.backend=c,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[Z]of fI)bl.push(Z),this.freeBuffers.set(Z,[]),this.freeUniformBuffers.set(Z,[]);this.sessionCount=0}upload(c,Z){let Y=Z.buffer,R=Z.byteOffset,i=Z.byteLength,v=Nl(i),g=this.storageCache.get(c);if(!g)throw new Error("gpu data for uploading does not exist");if(Number(g.originalSize)!==i)throw new Error(`inconsistent data size. gpu data size=${g.originalSize}, data size=${i}`);let M=this.backend.device.createBuffer({mappedAtCreation:!0,size:v,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),j=M.getMappedRange();new Uint8Array(j).set(new Uint8Array(Y,R,i)),M.unmap();let f=this.backend.device.createCommandEncoder();f.copyBufferToBuffer(M,0,g.gpuData.buffer,0,v),this.backend.device.queue.submit([f.finish()]),M.destroy(),gG("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${c})`)}memcpy(c,Z){let Y=this.storageCache.get(c);if(!Y)throw new Error("source gpu data for memcpy does not exist");let R=this.storageCache.get(Z);if(!R)throw new Error("destination gpu data for memcpy does not exist");if(Y.originalSize!==R.originalSize)throw new Error("inconsistent source and destination gpu data size");let i=Nl(Y.originalSize),v=this.backend.getCommandEncoder();this.backend.endComputePass(),v.copyBufferToBuffer(Y.gpuData.buffer,0,R.gpuData.buffer,0,i)}registerExternalBuffer(c,Z,Y){let R;if(Y){if(R=Y[0],c===Y[1])return gG("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${Z}) => id=${R}, buffer is the same, skip.`),R;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else R=El();return this.storageCache.set(R,{gpuData:{id:R,type:0,buffer:c},originalSize:Z}),gG("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${Z}) => id=${R}, registered.`),R}unregisterExternalBuffer(c){c!==void 0&&(this.storageCache.delete(c),gG("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${c}`))}create(c,Z=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let Y=vl(c),R,i=(Z&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,v=(Z&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(i||v){let M=(i?this.freeBuffers:this.freeUniformBuffers).get(Y);M?M.length>0?R=M.pop():R=this.backend.device.createBuffer({size:Y,usage:Z}):R=this.backend.device.createBuffer({size:Y,usage:Z})}else R=this.backend.device.createBuffer({size:Y,usage:Z});let g={id:El(),type:0,buffer:R};return this.storageCache.set(g.id,{gpuData:g,originalSize:Number(c)}),gG("verbose",()=>`[WebGPU] GpuDataManager.create(size=${c}) => id=${g.id}`),g}get(c){return this.storageCache.get(c)?.gpuData}release(c){let Z=typeof c=="bigint"?Number(c):c,Y=this.storageCache.get(Z);if(!Y){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return gG("verbose",()=>`[WebGPU] GpuDataManager.release(id=${Z}), gpuDataId=${Y.gpuData.id}`),this.storageCache.delete(Z),this.buffersPending.push(Y.gpuData.buffer),Y.originalSize}async download(c,Z){let Y=this.storageCache.get(Number(c));if(!Y)throw new Error("data does not exist");await Hl(this.backend,Y.gpuData.buffer,Y.originalSize,Z)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let c of this.buffersPending){let Z=fI.get(c.size);if((c.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let Y=this.freeBuffers.get(c.size)||[];Z===void 0||Y.length>=Z?c.destroy():Y.push(c)}else if((c.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let Y=this.freeUniformBuffers.get(c.size)||[];Z===void 0||Y.length>=Z?c.destroy():Y.push(c)}else c.destroy()}this.buffersPending=[]}else{let c=this.capturedPendingBuffers.get(this.backend.currentSessionId);c||(c=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,c));for(let Z of this.buffersPending)c.push(Z);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(c=>{c.forEach(Z=>{Z.destroy()})}),this.freeUniformBuffers.forEach(c=>{c.forEach(Z=>{Z.destroy()})}),this.storageCache.forEach(c=>{c.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(c=>{c.forEach(Z=>{Z.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(c){let Z=this.capturedPendingBuffers.get(c);Z&&(Z.forEach(Y=>{Y.destroy()}),this.capturedPendingBuffers.delete(c)),this.sessionCount-=1,this.sessionCount===0&&(gG("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(Y=>{Y.gpuData.buffer.destroy()}),this.storageCache=new Map)}},dG=(...c)=>new rG(...c)}),zc,lG,vG=n(()=>{"use strict";zc=class{constructor(c){Object.assign(this,c)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(c=>`${this[c]}`).join(";")),this.key}},lG=c=>new zc(c)}),Uc,_c,dl,Tc,md,tc,Mc,Kl=n(()=>{"use strict";Uc=class{static calcMatMulShape(c,Z){return c[1]!==Z[0]?void 0:[c[0],Z[1]]}},_c=class{static calcShape(c,Z,Y=!1){let R=c.length,i=Z.length;if(R===0)return Z;if(i===0)return c;let v=Math.max(c.length,Z.length),g=new Array(v);if(Y){if(R<2||i<2)return;let M=Uc.calcMatMulShape([c[R-2],c[R-1]],[Z[i-2],Z[i-1]]);if(M===void 0)return;[g[v-2],g[v-1]]=M}for(let M=Y?3:1;M<=v;M++){let j=R-M<0?1:c[R-M],f=i-M<0?1:Z[i-M];if(j!==f&&j>1&&f>1)return;let mI=Math.max(j,f);if(j&&f)g[v-M]=Math.max(j,f);else{if(mI>1)return;g[v-M]=0}}return g}static isValidBroadcast(c,Z){let Y=c.length,R=Z.length;if(Y>R)return!1;for(let i=1;i<=Y;i++)if(c[Y-i]!==1&&c[Y-i]!==Z[R-i])return!1;return!0}},dl=class Bp{static size(Z){return Bp.getSizeFromDimensionRange(Z,0,Z.length)}static convertShape(Z,Y=4){let R=Z.length;if(R===0)return[];let i=new Array(R),v=R-1;for(;v>=0;){if(Z[v]%Y===0){i[v]=Z[v]/Y;break}if(Y%Z[v]!==0)throw new Error("cannot convert shape");i[v]=1,Y/=Z[v],v--}for(v--;v>=0;v--)i[v]=Z[v];return i}static sizeFromDimension(Z,Y){if(Y<0||Y>Z.length)throw new Error(`invalid dimension of ${Y} for sizeFromDimension as Tensor has ${Z.length} dimensions.`);return Bp.getSizeFromDimensionRange(Z,Y,Z.length)}static sizeToDimension(Z,Y){if(Y<0||Y>Z.length)throw new Error(`invalid dimension of ${Y} for sizeToDimension as Tensor has ${Z.length} dimensions.`);return Bp.getSizeFromDimensionRange(Z,0,Y)}static getSizeFromDimensionRange(Z,Y,R){let i=1;for(let v=Y;v<R;v++){if(Z[v]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");i*=Number(Z[v])}return i}static computeStrides(Z){let Y=Z.length;if(Y===0)return[];if(Y===1)return[1];let R=new Array(Y);R[Y-1]=1,R[Y-2]=Z[Y-1];for(let i=Y-3;i>=0;--i)R[i]=R[i+1]*Z[i+1];return R}static normalizeAxis(Z,Y){if(Z<-Y&&Z>=Y)throw new Error("unsupported axis for this operation.");return Z<0?Z+Y:Z}static normalizeAxes(Z,Y){return Z.map(R=>this.normalizeAxis(R,Y??Z.length))}static sortBasedOnPerm(Z,Y){return Y?Y.map(R=>Z[R]):Z.slice().reverse()}static padShape(Z,Y){let R=Z.length;return Z.map((i,v)=>i+Y[v]+Y[v+R])}static areEqual(Z,Y){return Z.length!==Y.length?!1:Z.every((R,i)=>R===Y[i])}},Tc=class lh{static adjustPoolAttributes(Z,Y,R,i,v,g){if(!Z&&R.length!==Y.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(Z)for(let M=0;M<Y.length-2;M++)M>=R.length?R.push(Y[M+2]):R[M]=Y[M+2];for(let M=0;M<R.length;M++)if(M<i.length){if(i[M]<0)throw new Error("strides should be greater than or equal to 1")}else i.push(1);for(let M=0;M<R.length;M++)if(M<v.length){if(v[M]<0)throw new Error("dilations should be greater than or equal to 1")}else v.push(1);for(let M=0;M<R.length*2;M++)if(M<g.length){if(g[M]<0)throw new Error("pad should be greater than or equal to 1")}else g.push(0);for(let M=0;M<R.length;M++){if(R[M]<=0)throw new Error("kernel shapes need to be greater than 0");if(g[M]>=R[M]||g[M+R.length]>=R[M])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(Z,Y,R,i,v,g,M){if(M){if(v.length!==2*(Z.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(Y.length!==Z.length-2)throw new Error("length of strides should be the length of data dimensions");if(i.length!==Z.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let j=0;j<Z.length-2;j++)lh.adjustPadAndReturnShape(Z[j+(g?1:2)],Y[j],R[j],i[j],v,j,j+Z.length-2,M)}}static computePoolOutputShape(Z,Y,R,i,v,g,M){if(Y.length<=0)throw new Error("input shape must be of size greater than 0");let j=[Y[0],Y[1]];return lh.computeShapeHelper(Z,Y,j,R,i,v,g,M),j}static computeConvOutputShape(Z,Y,R,i,v,g,M){if(Z.length<=0||Y.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let j=[Z[0],Y[0]];return lh.computeShapeHelper(!1,Z,j,R,i,v,g,M),j}static computeShapeHelper(Z,Y,R,i,v,g,M,j){if(Z)for(let f=0;f<Y.length-2;f++)R.push(1);else for(let f=0;f<Y.length-2;f++)R.push(lh.adjustPadAndReturnShape(Y[f+2],i[f],v[f],g[f],M,f,f+Y.length-2,j))}static adjustPadAndReturnShape(Z,Y,R,i,v,g,M,j){let f=R*(i-1)+1;if(j&&j!=="NOTSET")switch(j){case"VALID":return v[g]=0,v[M]=0,Math.floor((Z-f)/Y+1);case"SAME_LOWER":case"SAME_UPPER":if(R!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let mI=((Z+Y-1)/Y-1)*Y+i-Z;return v[g]=Math.floor(j==="SAME_LOWER"?(mI+1)/2:mI/2),v[M]=mI-v[g],Math.floor((Z+mI-i)/Y+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((Z+v[g]+v[M]-f)/Y+1)}},md=class{static getShapeOfGemmResult(c,Z,Y,R,i){if(c.length!==2||Y.length!==2)throw new Error("shape need to be of size 2");let v,g,M;Z?(v=c[1],g=c[0]):(v=c[0],g=c[1]);let j=-1;if(R?(M=Y[0],j=1):(M=Y[1],j=0),Y[j]!==g)throw new Error("dimension mismatch");if(v<=0||M<=0||g<=0)throw new Error("invalid shape specified");if(i&&!_c.isValidBroadcast(i,[v,M]))throw new Error("gemm: invalid bias shape for broadcast");return[v,M,g]}},tc=-34028234663852886e22,Mc=34028234663852886e22}),ab,xb,kG,nc,gl,ZG,Rc,mc,gc,Ll,qd,tl,Ul,bm,ZW,dm,Zm,aG=n(()=>{"use strict";Sl(),Kl(),ab=64,xb=(c,Z)=>{if(Z===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(c)){case 10:return Z>1?`vec${Z}<f16>`:"f16";case 1:return Z>1?`vec${Z}<f32>`:"f32";case 6:return Z>1?`vec${Z}<i32>`:"i32";case 12:return Z>1?`vec${Z}<u32>`:"u32";case 7:if(Z>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(Z>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(Z!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${c}`)}},kG=(c,Z=1)=>{let Y=xb(c,Z);return typeof Y=="string"?Y:Y[0]},nc=(c,Z=1)=>{let Y=xb(c,Z);return typeof Y=="string"?Y:Y[1]},gl=(...c)=>{let Z=[];return c.forEach(Y=>{Y.length!==0&&Z.push({type:12,data:Y},{type:12,data:dl.computeStrides(Y)})}),Z},ZG=c=>c%4===0?4:c%2===0?2:1,Rc=(c="f32",Z,Y="0")=>!Z||Z===1?`${c}(${Y})`:`vec${Z}<${c}>(${Y})`,mc=(c,Z,Y)=>c==="f32"?Y:Z===1?`f32(${Y})`:`vec${Z}<f32>(${Y})`,gc=(c,Z)=>Z===4?`(${c}.x + ${c}.y + ${c}.z + ${c}.w)`:Z===2?`(${c}.x + ${c}.y)`:Z===3?`(${c}.x + ${c}.y + ${c}.z)`:c,Ll=(c,Z,Y,R)=>c.startsWith("uniforms.")&&Y>4?typeof Z=="string"?R==="f16"?`${c}[(${Z}) / 8][(${Z}) % 8 / 4][(${Z}) % 8 % 4]`:`${c}[(${Z}) / 4][(${Z}) % 4]`:R==="f16"?`${c}[${Math.floor(Z/8)}][${Math.floor(Z%8/4)}][${Z%8%4}]`:`${c}[${Math.floor(Z/4)}][${Z%4}]`:Y>1?`${c}[${Z}]`:c,qd=(c,Z,Y,R,i)=>{let v=typeof Y=="number",g=v?Y:Y.length,M=[...new Array(g).keys()],j=g<2?"u32":g<=4?`vec${g}<u32>`:`array<u32, ${g}>`,f=xb(Z,i),mI=typeof f=="string"?f:f[1],x=typeof f=="string"?f:f[0],NI={indices:j,value:mI,storage:x,tensor:Z},rI=Rl=>typeof Rl=="string"?Rl:`${Rl}u`,oI={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},XI=v?"uniforms.":"",xI=`${XI}${c}_shape`,LI=`${XI}${c}_strides`,EI="";for(let Rl=0;Rl<g-1;Rl++)EI+=`
    let dim${Rl} = current / ${Ll(LI,Rl,g)};
    let rest${Rl} = current % ${Ll(LI,Rl,g)};
    indices[${Rl}] = dim${Rl};
    current = rest${Rl};
    `;EI+=`indices[${g-1}] = current;`;let MI=g<2?"":`
  fn o2i_${c}(offset: u32) -> ${NI.indices} {
    var indices: ${NI.indices};
    var current = offset;
    ${EI}
    return indices;
  }`,SI=Rl=>(oI.offsetToIndices=!0,g<2?Rl:`o2i_${c}(${Rl})`),qI=[];if(g>=2)for(let Rl=g-1;Rl>=0;Rl--)qI.push(`${Ll(LI,Rl,g)} * (indices[${Rl}])`);let ll=g<2?"":`
  fn i2o_${c}(indices: ${NI.indices}) -> u32 {
    return ${qI.join("+")};
  }`,cl=Rl=>(oI.indicesToOffset=!0,g<2?Rl:`i2o_${c}(${Rl})`),pl=(...Rl)=>g===0?"0u":`${NI.indices}(${Rl.map(rI).join(",")})`,Xl=(Rl,Al)=>g<2?`${Rl}`:`${Ll(Rl,Al,g)}`,kl=(Rl,Al,BG)=>g<2?`${Rl}=${BG};`:`${Ll(Rl,Al,g)}=${BG};`,xl={},bG=(Rl,Al)=>{oI.broadcastedIndicesToOffset=!0;let BG=`${Al.name}broadcastedIndicesTo${c}Offset`;if(BG in xl)return`${BG}(${Rl})`;let ec=[];for(let ac=g-1;ac>=0;ac--){let gZ=Al.indicesGet("outputIndices",ac+Al.rank-g);ec.push(`${Xl(LI,ac)} * (${gZ} % ${Xl(xI,ac)})`)}return xl[BG]=`fn ${BG}(outputIndices: ${Al.type.indices}) -> u32 {
             return ${ec.length>0?ec.join("+"):"0u"};
           }`,`${BG}(${Rl})`},il=(Rl,Al)=>(()=>{if(NI.storage===NI.value)return`${c}[${Rl}]=${Al};`;if(NI.storage==="vec2<u32>"&&NI.value==="i32")return`${c}[${Rl}]=vec2<u32>(u32(${Al}), select(0u, 0xFFFFFFFFu, ${Al} < 0));`;if(NI.storage==="vec2<u32>"&&NI.value==="u32")return`${c}[${Rl}]=vec2<u32>(u32(${Al}), 0u);`;if(NI.storage==="u32"&&NI.value==="vec4<bool>")return`${c}[${Rl}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${Al}));`;throw new Error(`not supported combination of storage type ${NI.storage} and value type ${NI.value} yet`)})(),VG=Rl=>(()=>{if(NI.storage===NI.value)return`${c}[${Rl}]`;if(NI.storage==="vec2<u32>"&&NI.value==="i32")return`i32(${c}[${Rl}].x)`;if(NI.storage==="vec2<u32>"&&NI.value==="u32")return`u32(${c}[${Rl}].x)`;if(NI.storage==="u32"&&NI.value==="vec4<bool>")return`vec4<bool>(bool(${c}[${Rl}] & 0xFFu), bool(${c}[${Rl}] & 0xFF00u), bool(${c}[${Rl}] & 0xFF0000u), bool(${c}[${Rl}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${NI.storage} and value type ${NI.value} yet`)})(),GG=g<2?"":`
  fn get_${c}ByIndices(indices: ${NI.indices}) -> ${mI} {
    return ${VG(`i2o_${c}(indices)`)};
  }`,Bl=g<2?"":(()=>{let Rl=M.map(BG=>`d${BG}: u32`).join(", "),Al=M.map(BG=>`d${BG}`).join(", ");return`
  fn get_${c}(${Rl}) -> ${mI} {
    return get_${c}ByIndices(${pl(Al)});
  }`})(),QG=(...Rl)=>{if(Rl.length!==g)throw new Error(`indices length must be ${g}`);let Al=Rl.map(rI).join(",");return g===0?VG("0u"):g===1?VG(Al[0]):(oI.get=!0,oI.getByIndices=!0,oI.indicesToOffset=!0,`get_${c}(${Al})`)},mG=Rl=>g<2?VG(Rl):(oI.getByIndices=!0,oI.indicesToOffset=!0,`get_${c}ByIndices(${Rl})`),cG=g<2?"":`
  fn set_${c}ByIndices(indices: ${NI.indices}, value: ${mI}) {
    ${il(`i2o_${c}(indices)`,"value")}
  }`,pc=g<2?"":(()=>{let Rl=M.map(BG=>`d${BG}: u32`).join(", "),Al=M.map(BG=>`d${BG}`).join(", ");return`
  fn set_${c}(${Rl}, value: ${mI}) {
    set_${c}ByIndices(${pl(Al)}, value);
  }`})();return{impl:()=>{let Rl=[],Al=!1;return oI.offsetToIndices&&(Rl.push(MI),Al=!0),oI.indicesToOffset&&(Rl.push(ll),Al=!0),oI.broadcastedIndicesToOffset&&(Object.values(xl).forEach(BG=>Rl.push(BG)),Al=!0),oI.set&&(Rl.push(pc),Al=!0),oI.setByIndices&&(Rl.push(cG),Al=!0),oI.get&&(Rl.push(Bl),Al=!0),oI.getByIndices&&(Rl.push(GG),Al=!0),!v&&Al&&Rl.unshift(`const ${xI} = ${NI.indices}(${Y.join(",")});`,`const ${LI} = ${NI.indices}(${dl.computeStrides(Y).join(",")});`),Rl.join(`
`)},type:NI,offsetToIndices:SI,indicesToOffset:cl,broadcastedIndicesToOffset:bG,indices:pl,indicesGet:Xl,indicesSet:kl,set:(...Rl)=>{if(Rl.length!==g+1)throw new Error(`indices length must be ${g}`);let Al=Rl[g];if(typeof Al!="string")throw new Error("value must be string");let BG=Rl.slice(0,g).map(rI).join(",");return g===0?il("0u",Al):g===1?il(BG[0],Al):(oI.set=!0,oI.setByIndices=!0,oI.indicesToOffset=!0,`set_${c}(${BG}, ${Al})`)},setByOffset:il,setByIndices:(Rl,Al)=>g<2?il(Rl,Al):(oI.setByIndices=!0,oI.indicesToOffset=!0,`set_${c}ByIndices(${Rl}, ${Al});`),get:QG,getByOffset:VG,getByIndices:mG,usage:R,name:c,strides:LI,shape:xI,rank:g}},tl=(c,Z,Y,R=1)=>qd(c,Z,Y,"input",R),Ul=(c,Z,Y,R=1)=>qd(c,Z,Y,"output",R),bm=(c,Z,Y)=>qd(c,Z,Y,"atomicOutput",1),ZW=(c,Z,Y,R=1)=>qd(c,Z,Y,"internal",R),dm=class{constructor(c,Z){this.normalizedDispatchGroup=c,this.limits=Z,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(c){return`if (global_idx >= ${typeof c=="number"?`${c}u`:c}) { return; }`}mainStart(c=ab){let Z=typeof c=="number"?c:c[0],Y=typeof c=="number"?1:c[1],R=typeof c=="number"?1:c[2];if(Z>this.limits.maxComputeWorkgroupSizeX||Y>this.limits.maxComputeWorkgroupSizeY||R>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${Z}, ${Y}, ${R}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(Z*Y*R>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${Z}, ${Y}, ${R}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let i=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,v=i?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,g=i?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${Z*Y*R}u + local_idx;`;return`@compute @workgroup_size(${Z}, ${Y}, ${R})
  fn main(${v}) {
    ${g}
  `}appendVariableUniforms(c){c.rank!==0&&(c.shape.startsWith("uniforms.")&&this.uniforms.push({name:c.shape.replace("uniforms.",""),type:"u32",length:c.rank}),c.strides.startsWith("uniforms.")&&this.uniforms.push({name:c.strides.replace("uniforms.",""),type:"u32",length:c.rank}))}declareVariable(c,Z){if(c.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(c),this.appendVariableUniforms(c);let Y=c.usage==="input"?"read":"read_write",R=c.usage==="atomicOutput"?"atomic<i32>":c.type.storage;return`@group(0) @binding(${Z}) var<storage, ${Y}> ${c.name}: array<${R}>;`}declareVariables(...c){return c.map(Z=>this.declareVariable(Z,this.variableIndex++)).join(`
`)}registerInternalVariable(c){if(c.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(c),this.appendVariableUniforms(c)}registerInternalVariables(...c){return c.forEach(Z=>this.registerInternalVariable(Z)),this}registerUniform(c,Z,Y=1){return this.uniforms.push({name:c,type:Z,length:Y}),this}registerUniforms(c){return this.uniforms=this.uniforms.concat(c),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let c=[];for(let{name:Z,type:Y,length:R}of this.uniforms)if(R&&R>4)Y==="f16"?c.push(`@align(16) ${Z}:array<mat2x4<${Y}>, ${Math.ceil(R/8)}>`):c.push(`${Z}:array<vec4<${Y}>, ${Math.ceil(R/4)}>`);else{let i=R==null||R===1?Y:`vec${R}<${Y}>`;c.push(`${Z}:${i}`)}return`
      struct Uniforms { ${c.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(c=>c.impl()).join(`
`)+this.internalVariables.map(c=>c.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let c=Z=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(Z)];return this.uniforms.map(Z=>[c(Z.type),Z.length??1])}},Zm=(c,Z)=>new dm(c,Z)}),em,eW,aW,am,Wm,WW,Hb,tm,tW,Cd=n(()=>{"use strict";Sl(),Kl(),vG(),aG(),em=(c,Z)=>{if(!c||c.length!==1)throw new Error("Transpose requires 1 input.");if(Z.length!==0&&Z.length!==c[0].dims.length)throw new Error(`perm size ${Z.length} does not match input rank ${c[0].dims.length}`)},eW=(c,Z)=>Z.length!==0?Z:[...new Array(c).keys()].reverse(),aW=(c,Z)=>dl.sortBasedOnPerm(c,eW(c.length,Z)),am=(c,Z,Y,R)=>{let i=`fn perm(i: ${R.type.indices}) -> ${Y.type.indices} {
    var a: ${Y.type.indices};`;for(let v=0;v<Z;++v)i+=`a[${c[v]}]=i[${v}];`;return i+="return a;}"},Wm=(c,Z)=>{let Y=[],R=[];for(let i=0;i<c.length;++i)c[i]!==1&&Y.push(c[i]),c[Z[i]]!==1&&R.push(Z[i]);return{newShape:Y,newPerm:R}},WW=(c,Z)=>{let Y=0;for(let R=0;R<c.length;++R)if(Z[c[R]]!==1){if(c[R]<Y)return!1;Y=c[R]}return!0},Hb=(c,Z)=>{let Y=c.dataType,R=c.dims.length,i=eW(R,Z),v=aW(c.dims,i),g=c.dims,M=v,j=R<2||WW(i,c.dims),f;if(j)return f=oI=>{let XI=tl("input",Y,g,4),xI=Ul("output",Y,M,4);return`
  ${oI.registerUniform("output_size","u32").declareVariables(XI,xI)}
  ${oI.mainStart()}
    ${oI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let oI=dl.size(v);return{outputs:[{dims:v,dataType:c.dataType}],dispatchGroup:{x:Math.ceil(oI/64/4)},programUniforms:[{type:12,data:Math.ceil(oI/4)}]}},getShaderSource:f};let{newShape:mI,newPerm:x}=Wm(c.dims,i),NI=dl.areEqual(x,[2,3,1]),rI=dl.areEqual(x,[3,1,2]);if(mI.length===2||NI||rI){g=NI?[mI[0],mI[1]*mI[2]]:rI?[mI[0]*mI[1],mI[2]]:mI,M=[g[1],g[0]];let oI=16;return f=XI=>{let xI=tl("a",Y,g.length),LI=Ul("output",Y,M.length);return`
  ${XI.registerUniform("output_size","u32").declareVariables(xI,LI)}
  var<workgroup> tile : array<array<${LI.type.value}, ${oI+1}>, ${oI}>;
  ${XI.mainStart([oI,oI,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${oI} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${oI}u + local_id.x;
    let input_row = workgroup_id_x * ${oI}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${xI.getByIndices(`${xI.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${oI}u + local_id.x;
    let output_row = workgroup_id_y * ${oI}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${LI.setByIndices(`${LI.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let XI=dl.size(v);return{outputs:[{dims:v,dataType:c.dataType}],dispatchGroup:{x:Math.ceil(M[1]/oI),y:Math.ceil(M[0]/oI)},programUniforms:[{type:12,data:XI},...gl(g,M)]}},getShaderSource:f}}return f=oI=>{let XI=tl("a",Y,g.length),xI=Ul("output",Y,M.length);return`
  ${oI.registerUniform("output_size","u32").declareVariables(XI,xI)}

  ${am(i,R,XI,xI)}

  ${oI.mainStart()}
    ${oI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${xI.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${xI.setByOffset("global_idx",XI.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${Z}`,inputDependencies:["rank"]},getRunData:()=>{let oI=dl.size(v);return{outputs:[{dims:v,dataType:c.dataType}],dispatchGroup:{x:Math.ceil(oI/64)},programUniforms:[{type:12,data:oI},...gl(g,M)]}},getShaderSource:f}},tm=(c,Z)=>{em(c.inputs,Z.perm),c.compute(Hb(c.inputs[0],Z.perm))},tW=c=>lG({perm:c.perm})}),Oe,nm,mm,Nm,sm,Ym,hm,Vm,nW,pm,rb,_d,um,Eh,Rm,yh,om,mW,Fm,Xm,im,gh=n(()=>{"use strict";Sl(),Kl(),aG(),Te(),Cd(),Oe={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},nm={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},mm={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},Nm={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},sm=(c,Z)=>{let Y=[];for(let R=Z-c;R<Z;++R)Y.push(R);return Y},Ym=(c,Z)=>{let Y=[],R=c.length;for(let v=0;v<R;v++)Z.indexOf(v)===-1&&Y.push(c[v]);let i=Z.map(v=>c[v]);return[Y,i]},hm=(c,Z)=>{let Y=c.length+Z.length,R=[],i=0;for(let v=0;v<Y;v++)Z.indexOf(v)===-1?R.push(c[i++]):R.push(1);return R},Vm=(c,Z)=>{for(let Y=0;Y<c.length;++Y)if(c[c.length-Y-1]!==Z-1-Y)return!1;return!0},nW=(c,Z)=>{let Y=[];if(!Vm(c,Z)){for(let R=0;R<Z;++R)c.indexOf(R)===-1&&Y.push(R);c.forEach(R=>Y.push(R))}return Y},pm=(c,Z,Y,R,i,v,g)=>{let M=Y[0].dims,j=dl.size(v),f=dl.size(g),mI=tl("_A",Y[0].dataType,M),x=Ul("output",i,v),NI=64;j===1&&(NI=256);let rI=`
          var<workgroup> aBestValues : array<f32, ${NI}>;
       `,oI=XI=>`
        ${XI.registerUniform("reduceSize","u32").declareVariables(mI,x)}
        ${rI}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${XI.mainStart(NI)}

          let outputIndex = global_idx / ${NI};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${mm[R]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${NI}) {
           let candidate = f32(${mI.getByOffset("offset + k")});
           bestValue = ${Oe[R]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${NI}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${nm[R]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${x.setByOffset("outputIndex",`${R==="mean"?`${x.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${x.type.storage}(${Nm[R]})`}`)};
         }
        }`;return{name:c,shaderCache:{hint:`${Z};${NI}`,inputDependencies:["type"]},getShaderSource:oI,getRunData:()=>({outputs:[{dims:v,dataType:i}],dispatchGroup:{x:j},programUniforms:[{type:12,data:f}]})}},rb=(c,Z,Y,R)=>{let i=c.inputs.length===1?Y:NW(c.inputs,Y),v=i.axes;v.length===0&&!i.noopWithEmptyAxes&&(v=c.inputs[0].dims.map((rI,oI)=>oI));let g=dl.normalizeAxes(v,c.inputs[0].dims.length),M=g,j=c.inputs[0],f=nW(M,c.inputs[0].dims.length);f.length>0&&(j=c.compute(Hb(c.inputs[0],f),{inputs:[0],outputs:[-1]})[0],M=sm(M.length,j.dims.length));let[mI,x]=Ym(j.dims,M),NI=mI;i.keepDims&&(NI=hm(mI,g)),c.compute(pm(Z,i.cacheKey,[j],R,c.inputs[0].dataType,NI,x),{inputs:[j]})},_d=(c,Z)=>{rb(c,"ReduceMeanShared",Z,"mean")},um=(c,Z)=>{rb(c,"ReduceL1Shared",Z,"l1")},Eh=(c,Z)=>{rb(c,"ReduceL2Shared",Z,"l2")},Rm=(c,Z)=>{rb(c,"ReduceLogSumExpShared",Z,"logSumExp")},yh=(c,Z)=>{rb(c,"ReduceMaxShared",Z,"max")},om=(c,Z)=>{rb(c,"ReduceMinShared",Z,"min")},mW=(c,Z)=>{rb(c,"ReduceProdShared",Z,"prod")},Fm=(c,Z)=>{rb(c,"ReduceSumShared",Z,"sum")},Xm=(c,Z)=>{rb(c,"ReduceSumSquareShared",Z,"sumSquare")},im=(c,Z)=>{rb(c,"ReduceLogSumShared",Z,"logSum")}}),zb,je,Ke,NW,Ub,sW,Qm,Hm,YW,rm,wm,hW,vm,Em,VW,Mb,ym,pW,gm,Jm,uW,Cm,Am,RW,Lm,km,Te=n(()=>{"use strict";Sl(),Kl(),vG(),aG(),gh(),zb=c=>{if(!c||c.length===0||c.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(c.length===2&&c[1].dims.length!==1)throw new Error("Invalid axes input dims.")},je=c=>["","",`var value = ${c.getByIndices("input_indices")};`,""],Ke=(c,Z,Y,R,i,v,g=!1,M=!1)=>{let j=[],f=Y[0].dims,mI=f.length,x=dl.normalizeAxes(i,mI),NI=!M&&x.length===0;f.forEach((XI,xI)=>{NI||x.indexOf(xI)>=0?g&&j.push(1):j.push(XI)});let rI=j.length,oI=dl.size(j);return{name:c,shaderCache:Z,getShaderSource:XI=>{let xI=[],LI=tl("_A",Y[0].dataType,mI),EI=Ul("output",v,rI),MI=R(LI,EI,x),SI=MI[2];for(let qI=0,ll=0;qI<mI;qI++)NI||x.indexOf(qI)>=0?(g&&ll++,SI=`for(var j${qI}: u32 = 0; j${qI} < ${f[qI]}; j${qI}++) {
                  ${MI[2].includes("last_index")?`let last_index = j${qI};`:""}
                  ${LI.indicesSet("input_indices",qI,`j${qI}`)}
                  ${SI}
                }`):(xI.push(`${LI.indicesSet("input_indices",qI,EI.indicesGet("output_indices",ll))};`),ll++);return`

        ${XI.registerUniform("output_size","u32").declareVariables(LI,EI)}

        ${XI.mainStart()}
          ${XI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${LI.type.indices};
          let output_indices = ${EI.offsetToIndices("global_idx")};

          ${xI.join(`
`)}
          ${MI[0]}       // init ops for reduce max/min
          ${MI[1]}
          ${SI}
          ${MI[3]}
          ${MI.length===4?EI.setByOffset("global_idx","value"):MI.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:j,dataType:v}],dispatchGroup:{x:Math.ceil(oI/64)},programUniforms:[{type:12,data:oI},...gl(f,j)]})}},NW=(c,Z)=>{let Y=[];return c[1].dims[0]>0&&c[1].getBigInt64Array().forEach(R=>Y.push(Number(R))),lG({axes:Y,keepDims:Z.keepDims,noopWithEmptyAxes:Z.noopWithEmptyAxes})},Ub=(c,Z,Y,R)=>{let i=c.inputs,v=i.length===1?Y:NW(i,Y);c.compute(Ke(Z,{hint:v.cacheKey,inputDependencies:["rank"]},[i[0]],v.noopWithEmptyAxes&&v.axes.length===0?je:R,v.axes,i[0].dataType,v.keepDims,v.noopWithEmptyAxes),{inputs:[0]})},sW=(c,Z)=>{zb(c.inputs),Ub(c,"ReduceLogSum",Z,(Y,R)=>[`var value = ${R.type.storage}(0);`,"",`value += ${Y.getByIndices("input_indices")};`,"value = log(value);"])},Qm=(c,Z)=>{zb(c.inputs),Ub(c,"ReduceL1",Z,(Y,R)=>[`var value = ${R.type.storage}(0);`,"",`value += abs(${Y.getByIndices("input_indices")});`,""])},Hm=(c,Z)=>{zb(c.inputs),Ub(c,"ReduceL2",Z,(Y,R)=>[`var t = ${R.type.value}(0); var value = ${R.type.value}(0);`,"",`t = ${Y.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},YW=(c,Z)=>{zb(c.inputs),Ub(c,"ReduceLogSumExp",Z,(Y,R)=>[`var value = ${R.type.storage}(0);`,"",`value += exp(${Y.getByIndices("input_indices")});`,"value = log(value);"])},rm=(c,Z)=>{zb(c.inputs),Ub(c,"ReduceMax",Z,(Y,R,i)=>{let v=[];for(let g=0;g<Y.rank;g++)(i.indexOf(g)>=0||i.length===0)&&v.push(Y.indicesSet("input_indices",g,0));return[`${v.join(`
`)}`,`var value = ${Y.getByIndices("input_indices")};`,`value = max(value, ${Y.getByIndices("input_indices")});`,""]})},wm=(c,Z)=>{zb(c.inputs),Ub(c,"ReduceMean",Z,(Y,R,i)=>{let v=1;for(let g=0;g<Y.rank;g++)(i.indexOf(g)>=0||i.length===0)&&(v*=c.inputs[0].dims[g]);return["var sum = f32(0);","",`sum += f32(${Y.getByIndices("input_indices")});`,`let value = ${R.type.value}(sum / ${v});`]})},hW=(c,Z)=>{zb(c.inputs),Ub(c,"ReduceMin",Z,(Y,R,i)=>{let v=[];for(let g=0;g<Y.rank;g++)(i.indexOf(g)>=0||i.length===0)&&v.push(`input_indices[${g}] = 0;`);return[`${v.join(`
`)}`,`var value = ${Y.getByIndices("input_indices")};`,`value = min(value, ${Y.getByIndices("input_indices")});`,""]})},vm=(c,Z)=>{zb(c.inputs),Ub(c,"ReduceProd",Z,(Y,R)=>[`var value = ${R.type.storage}(1);`,"",`value *= ${Y.getByIndices("input_indices")};`,""])},Em=(c,Z)=>{zb(c.inputs),Ub(c,"ReduceSum",Z,(Y,R)=>[`var value = ${R.type.storage}(0);`,"",`value += ${Y.getByIndices("input_indices")};`,""])},VW=(c,Z)=>{zb(c.inputs),Ub(c,"ReduceSumSquare",Z,(Y,R)=>[`var t = ${R.type.value}(0); var value = ${R.type.value}(0);`,"",`t = ${Y.getByIndices("input_indices")}; value += t * t;`,""])},Mb=(c,Z,Y)=>{if(Z.length===0)return Y;let R=1,i=1;for(let v=0;v<Z.length;v++)Z.indexOf(v)===-1?R*=c[v]:i*=c[v];return i<32&&R>1024},ym=(c,Z)=>{Mb(c.inputs[0].dims,Z.axes,Z.noopWithEmptyAxes)?wm(c,Z):_d(c,Z)},pW=(c,Z)=>{Mb(c.inputs[0].dims,Z.axes,Z.noopWithEmptyAxes)?Qm(c,Z):um(c,Z)},gm=(c,Z)=>{Mb(c.inputs[0].dims,Z.axes,Z.noopWithEmptyAxes)?Hm(c,Z):Eh(c,Z)},Jm=(c,Z)=>{Mb(c.inputs[0].dims,Z.axes,Z.noopWithEmptyAxes)?YW(c,Z):Rm(c,Z)},uW=(c,Z)=>{Mb(c.inputs[0].dims,Z.axes,Z.noopWithEmptyAxes)?rm(c,Z):yh(c,Z)},Cm=(c,Z)=>{Mb(c.inputs[0].dims,Z.axes,Z.noopWithEmptyAxes)?hW(c,Z):om(c,Z)},Am=(c,Z)=>{Mb(c.inputs[0].dims,Z.axes,Z.noopWithEmptyAxes)?vm(c,Z):mW(c,Z)},RW=(c,Z)=>{Mb(c.inputs[0].dims,Z.axes,Z.noopWithEmptyAxes)?Em(c,Z):Fm(c,Z)},Lm=(c,Z)=>{Mb(c.inputs[0].dims,Z.axes,Z.noopWithEmptyAxes)?VW(c,Z):Xm(c,Z)},km=(c,Z)=>{Mb(c.inputs[0].dims,Z.axes,Z.noopWithEmptyAxes)?sW(c,Z):im(c,Z)}}),oW,xm,FW,XW,Jh=n(()=>{"use strict";Sl(),vG(),Te(),oW=c=>{if(!c||c.length===0||c.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(c[0].dataType!==1)throw new Error("Invalid input type.")},xm=(c,Z)=>{oW(c.inputs);let Y=(R,i,v)=>{let g=[];for(let M=0;M<R.rank;M++)(v.indexOf(M)>=0||v.length===0)&&g.push(`input_indices[${M}] = 0;`);return[`${g.join(`
`)}`,`var value = ${R.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${R.getByIndices("input_indices")} ${Z.selectLastIndex>0?"<=":"<"} value) {
         value = ${R.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",i.setByOffset("global_idx","best_index")]};c.compute(Ke("ArgMin",{hint:Z.cacheKey,inputDependencies:["rank"]},[c.inputs[0]],Y,[Z.axis],7,Z.keepDims),{inputs:[0]})},FW=(c,Z)=>{oW(c.inputs);let Y=(R,i,v)=>{let g=[];for(let M=0;M<R.rank;M++)(v.indexOf(M)>=0||v.length===0)&&g.push(`input_indices[${M}] = 0;`);return[`${g.join(`
`)}`,`var value = ${R.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${R.getByIndices("input_indices")} ${Z.selectLastIndex>0?">=":">"} value) {
         value = ${R.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",i.setByOffset("global_idx","best_index")]};c.compute(Ke("argMax",{hint:Z.cacheKey,inputDependencies:["rank"]},[c.inputs[0]],Y,[Z.axis],7,Z.keepDims),{inputs:[0]})},XW=c=>lG(c)}),iW,fe,zm,QW,Um,Ge,HW,Mm,rW=n(()=>{"use strict";Sl(),Kl(),BI(),aG(),iW=(c,Z)=>{let Y=c[0],R=c[1],i=c[2],v=c[3],g=c[4],M=c[5];if(g&&M)throw new Error("Attention cannot have both past and attention_bias");if(Y.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let j=Y.dims[0],f=Y.dims[1],mI=Y.dims[2];if(i.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(R.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(R.dims[0]!==mI)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(i.dims[0]!==R.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let x=i.dims[0]/3,NI=x,rI=NI;if(Z.qkvHiddenSizes.length>0){if(Z.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let MI of Z.qkvHiddenSizes)if(MI%Z.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");x=Z.qkvHiddenSizes[0],NI=Z.qkvHiddenSizes[1],rI=Z.qkvHiddenSizes[2]}let oI=f;if(x!==NI)throw new Error("qkv_hidden_sizes first element should be same as the second");if(i.dims[0]!==x+NI+rI)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let XI=0;if(g){if(NI!==rI)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(g.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(g.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(g.dims[1]!==j)throw new Error('Input "past" second dimension must be batch_size');if(g.dims[2]!==Z.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(g.dims[4]!==NI/Z.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');Z.pastPresentShareBuffer||(XI=g.dims[3])}let xI=oI+XI,LI=-1,EI=0;if(v)throw new Error("Mask not supported");if(g)throw new Error("past is not supported");if(M){if(M.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(M.dims[0]!==j||M.dims[1]!==Z.numHeads||M.dims[2]!==f||M.dims[3]!==xI)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:j,sequenceLength:f,pastSequenceLength:XI,kvSequenceLength:oI,totalSequenceLength:xI,maxSequenceLength:LI,inputHiddenSize:mI,hiddenSize:x,vHiddenSize:rI,headSize:Math.floor(x/Z.numHeads),vHeadSize:Math.floor(rI/Z.numHeads),numHeads:Z.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:Z.maskFilterValue,maskType:EI,scale:Z.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},fe=(c,Z,Y)=>Z&&c?`
      let total_sequence_length_input = u32(${Z.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${c?.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${Y?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,zm=(c,Z,Y,R,i,v,g,M)=>{let j=ZG(g?1:v),f=64,mI=v/j;mI<f&&(f=32);let x=Math.ceil(v/j/f),NI=[{type:12,data:Z},{type:12,data:Y},{type:12,data:R},{type:12,data:i},{type:12,data:mI},{type:12,data:x}],rI=kG(c.dataType,j),oI=nc(1,j),XI=["type"];g&&XI.push("type"),M&&XI.push("type");let xI=LI=>{let EI=Ul("x",c.dataType,c.dims,j),MI=[EI],SI=g?tl("seq_lens",g.dataType,g.dims):void 0;SI&&MI.push(SI);let qI=M?tl("total_sequence_length_input",M.dataType,M.dims):void 0;qI&&MI.push(qI);let ll=nc(c.dataType),cl=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${f}>;
  var<workgroup> thread_sum: array<f32, ${f}>;
  ${LI.registerUniforms(cl).declareVariables(...MI)}
  ${LI.mainStart([f,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${fe(SI,qI,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${f}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${g?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${oI}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${oI}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(j){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${j}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${f}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${oI}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${oI}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(j){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${j}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${f}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${EI.type.value}(${ll}(1.0) / ${ll}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${oI}(x[offset + i]);
        x[offset + i] = ${EI.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${g?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${EI.type.value}(${ll}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${f};${rI};${j}`,inputDependencies:XI},getShaderSource:xI,getRunData:()=>({outputs:[],dispatchGroup:{x:Math.ceil(v/f),y:i,z:Z*Y},programUniforms:NI})}},QW=(c,Z,Y,R,i,v,g,M,j)=>{let f=g+v.kvSequenceLength,mI=[v.batchSize,v.numHeads,v.sequenceLength,f],x=c>1&&R,NI=v.kvNumHeads?v.kvNumHeads:v.numHeads,rI=x?[v.batchSize,NI,f,v.headSize]:void 0,oI=v.nReps?v.nReps:1,XI=v.scale===0?1/Math.sqrt(v.headSize):v.scale,xI=ZG(v.headSize),LI=v.headSize/xI,EI=12,MI={x:Math.ceil(f/EI),y:Math.ceil(v.sequenceLength/EI),z:v.batchSize*v.numHeads},SI=[{type:12,data:v.sequenceLength},{type:12,data:LI},{type:12,data:f},{type:12,data:v.numHeads},{type:12,data:v.headSize},{type:1,data:XI},{type:12,data:g},{type:12,data:v.kvSequenceLength},{type:12,data:oI}],qI=x&&R&&dl.size(R.dims)>0,ll=["type","type"];qI&&ll.push("type"),i&&ll.push("type"),M&&ll.push("type"),j&&ll.push("type");let cl=[{dims:mI,dataType:Z.dataType,gpuDataType:0}];x&&cl.push({dims:rI,dataType:Z.dataType,gpuDataType:0});let pl=Xl=>{let kl=tl("q",Z.dataType,Z.dims,xI),xl=tl("key",Y.dataType,Y.dims,xI),bG=[kl,xl];if(qI){let cG=tl("past_key",R.dataType,R.dims,xI);bG.push(cG)}i&&bG.push(tl("attention_bias",i.dataType,i.dims));let il=M?tl("seq_lens",M.dataType,M.dims):void 0;il&&bG.push(il);let VG=j?tl("total_sequence_length_input",j.dataType,j.dims):void 0;VG&&bG.push(VG);let GG=Ul("output",Z.dataType,mI),Bl=[GG];x&&Bl.push(Ul("present_key",Z.dataType,rI,xI));let QG=nc(1,xI),mG=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${EI}u;

  var<workgroup> tileQ: array<${kl.type.storage}, ${EI*EI}>;
  var<workgroup> tileK: array<${kl.type.storage}, ${EI*EI}>;
  ${Xl.registerUniforms(mG).declareVariables(...bG,...Bl)}
  ${Xl.mainStart([EI,EI,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${oI===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${oI===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${fe(il,VG,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${qI&&x?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${x?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${QG}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${qI&&x?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${x?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${QG}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(xI){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${xI}`)}})()};
        output[outputIdx] = ${GG.type.value} (sum * uniforms.alpha) + ${i?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${xI};${i!==void 0};${R!==void 0};${c}`,inputDependencies:ll},getRunData:()=>({outputs:cl,dispatchGroup:MI,programUniforms:SI}),getShaderSource:pl}},Um=(c,Z,Y,R,i,v,g=void 0,M=void 0)=>{let j=v+i.kvSequenceLength,f=i.nReps?i.nReps:1,mI=i.vHiddenSize*f,x=c>1&&R,NI=i.kvNumHeads?i.kvNumHeads:i.numHeads,rI=x?[i.batchSize,NI,j,i.headSize]:void 0,oI=[i.batchSize,i.sequenceLength,mI],XI=12,xI={x:Math.ceil(i.vHeadSize/XI),y:Math.ceil(i.sequenceLength/XI),z:i.batchSize*i.numHeads},LI=[{type:12,data:i.sequenceLength},{type:12,data:j},{type:12,data:i.vHeadSize},{type:12,data:i.numHeads},{type:12,data:i.headSize},{type:12,data:mI},{type:12,data:v},{type:12,data:i.kvSequenceLength},{type:12,data:f}],EI=x&&R&&dl.size(R.dims)>0,MI=["type","type"];EI&&MI.push("type"),g&&MI.push("type"),M&&MI.push("type");let SI=[{dims:oI,dataType:Z.dataType,gpuDataType:0}];x&&SI.push({dims:rI,dataType:Z.dataType,gpuDataType:0});let qI=ll=>{let cl=tl("probs",Z.dataType,Z.dims),pl=tl("v",Y.dataType,Y.dims),Xl=[cl,pl];EI&&Xl.push(tl("past_value",R.dataType,R.dims));let kl=g?tl("seq_lens",g.dataType,g.dims):void 0;g&&Xl.push(kl);let xl=M?tl("total_sequence_length_input",M.dataType,M.dims):void 0;M&&Xl.push(xl);let bG=[Ul("output",Z.dataType,oI)];x&&bG.push(Ul("present_value",Z.dataType,rI));let il=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${XI}u;
  var<workgroup> tileQ: array<${cl.type.value}, ${XI*XI}>;
  var<workgroup> tileV: array<${cl.type.value}, ${XI*XI}>;
  ${ll.registerUniforms(il).declareVariables(...Xl,...bG)}
  ${ll.mainStart([XI,XI,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${f===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${f===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${fe(kl,xl,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${EI&&x?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${x?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${cl.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${EI&&x?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${x?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${R!==void 0};${c}`,inputDependencies:MI},getRunData:()=>({outputs:SI,dispatchGroup:xI,programUniforms:LI}),getShaderSource:qI}},Ge=(c,Z,Y,R,i,v,g,M,j,f,mI=void 0,x=void 0)=>{let NI=Math.min(c.outputCount,1+(g?1:0)+(M?1:0)),rI=NI>1?f.pastSequenceLength:0,oI=rI+f.kvSequenceLength,XI=j&&dl.size(j.dims)>0?j:void 0,xI=[Z,Y];NI>1&&g&&dl.size(g.dims)>0&&xI.push(g),XI&&xI.push(XI),mI&&xI.push(mI),x&&xI.push(x);let LI=c.compute(QW(NI,Z,Y,g,XI,f,rI,mI,x),{inputs:xI,outputs:NI>1?[-1,1]:[-1]})[0];c.compute(zm(LI,f.batchSize,f.numHeads,rI,f.sequenceLength,oI,mI,x),{inputs:mI&&x?[LI,mI,x]:[LI],outputs:[]});let EI=[LI,R];NI>1&&M&&dl.size(M.dims)>0&&EI.push(M),mI&&EI.push(mI),x&&EI.push(x),c.compute(Um(NI,LI,R,M,f,rI,mI,x),{inputs:EI,outputs:NI>1?[0,2]:[0]})},HW=(c,Z)=>{let Y=[Z.batchSize,Z.numHeads,Z.sequenceLength,Z.headSize],R=Z.sequenceLength,i=Z.inputHiddenSize,v=Z.headSize,g=12,M={x:Math.ceil(Z.headSize/g),y:Math.ceil(Z.sequenceLength/g),z:Z.batchSize*Z.numHeads},j=[c.inputs[0],c.inputs[1],c.inputs[2]],f=[{type:12,data:R},{type:12,data:i},{type:12,data:v},{type:12,data:Z.numHeads},{type:12,data:Z.headSize},{type:12,data:Z.hiddenSize},{type:12,data:Z.hiddenSize+Z.hiddenSize+Z.vHiddenSize}],mI=x=>{let NI=Ul("output_q",j[0].dataType,Y),rI=Ul("output_k",j[0].dataType,Y),oI=Ul("output_v",j[0].dataType,Y),XI=tl("input",j[0].dataType,j[0].dims),xI=tl("weight",j[1].dataType,j[1].dims),LI=tl("bias",j[2].dataType,j[2].dims),EI=XI.type.storage,MI=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${g}u;
  var<workgroup> tileInput: array<${EI}, ${g*g}>;
  var<workgroup> tileWeightQ: array<${EI}, ${g*g}>;
  var<workgroup> tileWeightK: array<${EI}, ${g*g}>;
  var<workgroup> tileWeightV: array<${EI}, ${g*g}>;
  ${x.registerUniforms(MI).declareVariables(XI,xI,LI,NI,rI,oI)}
  ${x.mainStart([g,g,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${EI}(0);
    var valueK = ${EI}(0);
    var valueV = ${EI}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return c.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:Y,dataType:c.inputs[0].dataType,gpuDataType:0},{dims:Y,dataType:c.inputs[0].dataType,gpuDataType:0},{dims:Y,dataType:c.inputs[0].dataType,gpuDataType:0}],dispatchGroup:M,programUniforms:f}),getShaderSource:mI},{inputs:j,outputs:[-1,-1,-1]})},Mm=(c,Z)=>{let Y=iW(c.inputs,Z),[R,i,v]=HW(c,Y);return Ge(c,R,i,v,c.inputs[4],void 0,void 0,void 0,c.inputs[5],Y)}}),wW,Bm,Om,vW,Ch=n(()=>{"use strict";OI(),Sl(),Kl(),vG(),aG(),wW=(c,Z)=>{if(!c||c.length!==5)throw new Error("BatchNormalization requires 5 inputs");let Y=(R,i,v)=>{let g=i.length;if(g!==R.length)throw new Error(`${v}: num dimensions != ${g}`);i.forEach((M,j)=>{if(M!==R[j])throw new Error(`${v}: dim[${j}] do not match`)})};if(c[0].dims.length>1){let R=Z.format==="NHWC"?Z.spatial?c[0].dims.slice(-1):c[0].dims.slice(-1).concat(c[0].dims.slice(1,c[0].dims.length-1)):c[0].dims.slice(1,Z.spatial?2:void 0);Y(c[1].dims,R,"Invalid input scale"),Y(c[2].dims,R,"Invalid input B"),Y(c[3].dims,R,"Invalid input mean"),Y(c[4].dims,R,"Invalid input var")}else Y(c[1].dims,[1],"Invalid input scale"),Y(c[2].dims,[1],"Invalid input B"),Y(c[3].dims,[1],"Invalid input mean"),Y(c[4].dims,[1],"Invalid input var")},Bm=(c,Z)=>{let{epsilon:Y,spatial:R,format:i}=Z,v=c[0].dims,g=R?ZG(v[v.length-1]):1,M=i==="NHWC"&&v.length>1?g:1,j=dl.size(v)/g,f=R,mI=f?v.length:v,x=tl("x",c[0].dataType,c[0].dims,g),NI=tl("scale",c[1].dataType,c[1].dims,M),rI=tl("bias",c[2].dataType,c[2].dims,M),oI=tl("inputMean",c[3].dataType,c[3].dims,M),XI=tl("inputVar",c[4].dataType,c[4].dims,M),xI=Ul("y",c[0].dataType,mI,g),LI=()=>{let MI="";if(R)MI=`let cOffset = ${v.length===1?"0u":i==="NHWC"?`outputIndices[${v.length-1}] / ${g}`:"outputIndices[1]"};`;else if(i==="NCHW")MI=`
            ${xI.indicesSet("outputIndices","0","0")}
            let cOffset = ${xI.indicesToOffset("outputIndices")};`;else{MI=`var cIndices = ${NI.type.indices}(0);
                       cIndices[0] = outputIndices[${v.length-1}];`;for(let SI=1;SI<NI.rank;SI++)MI+=`cIndices[${SI}] = outputIndices[${SI}];`;MI+=`let cOffset = ${NI.indicesToOffset("cIndices")};`}return MI},EI=MI=>`
  const epsilon = ${Y};
  ${MI.registerUniform("outputSize","u32").declareVariables(x,NI,rI,oI,XI,xI)}
  ${MI.mainStart()}
  ${MI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${xI.offsetToIndices(`global_idx * ${g}`)};
    ${LI()}
    let scale = ${NI.getByOffset("cOffset")};
    let bias = ${rI.getByOffset("cOffset")};
    let inputMean = ${oI.getByOffset("cOffset")};
    let inputVar = ${XI.getByOffset("cOffset")};
    let x = ${x.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${xI.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${Z.epsilon}_${Z.format}_${R}_${g}`,inputDependencies:f?["rank","type","type","type","type"]:void 0},getShaderSource:EI,getRunData:()=>({outputs:[{dims:c[0].dims,dataType:c[0].dataType}],dispatchGroup:{x:Math.ceil(j/64)},programUniforms:f?[{type:12,data:j},...gl(v)]:[{type:12,data:j}]})}},Om=c=>lG(c),vW=(c,Z)=>{let{inputs:Y,outputCount:R}=c,i=Om({...Z,outputCount:R});if(C.webgpu.validateInputContent&&wW(Y,i),Z.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");c.compute(Bm(Y,i))}}),jm,EW,Km,Ah=n(()=>{"use strict";Kl(),aG(),jm=c=>{if(c[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(c[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(c[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(c[0].dims[2]!==c[1].dims[0])throw new Error("last dimension of input and bias are not the same")},EW=c=>{let Z=c[0].dims,Y=c[0].dims[2],R=dl.size(Z)/4,i=c[0].dataType,v=tl("input",i,Z,4),g=tl("bias",i,[Y],4),M=tl("residual",i,Z,4),j=Ul("output",i,Z,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:Z,dataType:c[0].dataType}],dispatchGroup:{x:Math.ceil(R/64)}}),getShaderSource:f=>`
  const channels = ${Y}u / 4;
  ${f.declareVariables(v,g,M,j)}

  ${f.mainStart()}
    ${f.guardAgainstOutOfBoundsWorkgroupSizes(R)}
    let value = ${v.getByOffset("global_idx")}
      + ${g.getByOffset("global_idx % channels")} + ${M.getByOffset("global_idx")};
    ${j.setByOffset("global_idx","value")}
  }`}},Km=c=>{jm(c.inputs),c.compute(EW(c.inputs))}}),yW,JG,Tm,gW,fm,Sm,JW,Dm,qm,CW,_m,Pm,AW,$m,IN,LW,ce,lN,Se,GN,kW,cN,bN,xW,dN,ZN,zW,eN,aN,UW,WN,tN,MW,nN,mN,De,NN,BW,qe,sN,YN,hN,VN,OW,pN,jW=n(()=>{"use strict";Sl(),Kl(),vG(),aG(),yW=(c,Z,Y,R,i,v,g)=>{let M=Math.ceil(Z/4),j="";typeof i=="string"?j=`${i}(a)`:j=i("a");let f=tl("inputData",Y,[M],4),mI=Ul("outputData",R,[M],4),x=[{name:"vec_size",type:"u32"}];return g&&x.push(...g),`
      ${c.registerUniforms(x).declareVariables(f,mI)}

  ${v??""}

  ${c.mainStart()}
    ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${f.getByOffset("global_idx")};
    ${mI.setByOffset("global_idx",j)}
  }`},JG=(c,Z,Y,R,i,v=c.dataType,g,M)=>{let j=[{type:12,data:Math.ceil(dl.size(c.dims)/4)}];return g&&j.push(...g),{name:Z,shaderCache:{hint:i,inputDependencies:["type"]},getShaderSource:f=>yW(f,dl.size(c.dims),c.dataType,v,Y,R,M),getRunData:f=>({outputs:[{dims:c.dims,dataType:v}],dispatchGroup:{x:Math.ceil(dl.size(f[0].dims)/64/4)},programUniforms:j})}},Tm=c=>{c.compute(JG(c.inputs[0],"Abs","abs"))},gW=c=>{c.compute(JG(c.inputs[0],"Acos","acos"))},fm=c=>{c.compute(JG(c.inputs[0],"Acosh","acosh"))},Sm=c=>{c.compute(JG(c.inputs[0],"Asin","asin"))},JW=c=>{c.compute(JG(c.inputs[0],"Asinh","asinh"))},Dm=c=>{c.compute(JG(c.inputs[0],"Atan","atan"))},qm=c=>{c.compute(JG(c.inputs[0],"Atanh","atanh"))},CW=c=>lG(c),_m=(c,Z)=>{let Y;switch(Z.to){case 10:Y="vec4<f16>";break;case 1:Y="vec4<f32>";break;case 12:Y="vec4<u32>";break;case 6:Y="vec4<i32>";break;case 9:Y="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${Z.to}`)}c.compute(JG(c.inputs[0],"Cast",Y,void 0,Z.cacheKey,Z.to))},Pm=c=>{let Z,Y,R=c.length>=2&&c[1].data!==0,i=c.length>=3&&c[2].data!==0;switch(c[0].dataType){case 1:Z=R?c[1].getFloat32Array()[0]:-34028234663852886e22,Y=i?c[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:Z=R?c[1].getUint16Array()[0]:64511,Y=i?c[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return lG({min:Z,max:Y})},AW=(c,Z)=>{let Y=Z||Pm(c.inputs),R=nc(c.inputs[0].dataType);c.compute(JG(c.inputs[0],"Clip",i=>`clamp(${i}, vec4<${R}>(uniforms.min), vec4<${R}>(uniforms.max))`,void 0,Y.cacheKey,void 0,[{type:c.inputs[0].dataType,data:Y.min},{type:c.inputs[0].dataType,data:Y.max}],[{name:"min",type:R},{name:"max",type:R}]),{inputs:[0]})},$m=c=>{c.compute(JG(c.inputs[0],"Ceil","ceil"))},IN=c=>{c.compute(JG(c.inputs[0],"Cos","cos"))},LW=c=>{c.compute(JG(c.inputs[0],"Cosh","cosh"))},ce=c=>lG(c),lN=(c,Z)=>{let Y=nc(c.inputs[0].dataType);c.compute(JG(c.inputs[0],"Elu",R=>`elu_vf32(${R})`,`
  const elu_alpha_ = ${Y}(${Z.alpha});

  fn elu_f32(a: ${Y}) -> ${Y} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${Y}>) -> vec4<${Y}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,Z.cacheKey))},Se=(c="f32")=>`
const r0: ${c} = 0.3275911;
const r1: ${c} = 0.254829592;
const r2: ${c} = -0.284496736;
const r3: ${c} = 1.421413741;
const r4: ${c} = -1.453152027;
const r5: ${c} = 1.061405429;

fn erf_vf32(v: vec4<${c}>) -> vec4<${c}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,GN=c=>{let Z=nc(c.inputs[0].dataType);c.compute(JG(c.inputs[0],"Erf",Y=>`erf_vf32(${Y})`,Se(Z)))},kW=c=>{c.compute(JG(c.inputs[0],"Exp","exp"))},cN=c=>{c.compute(JG(c.inputs[0],"Floor","floor"))},bN=c=>{let Z=nc(c.inputs[0].dataType);c.compute(JG(c.inputs[0],"Gelu",Y=>`0.5 * ${Y} * (1.0 + erf_vf32(${Y} * 0.7071067811865475))`,Se(Z)))},xW=(c,Z)=>{let Y=nc(c.inputs[0].dataType);c.compute(JG(c.inputs[0],"LeakyRelu",R=>`select(leaky_relu_alpha_ * ${R}, ${R}, ${R} >= vec4<${Y}>(0.0))`,`const leaky_relu_alpha_ = ${Y}(${Z.alpha});`,Z.cacheKey))},dN=c=>{c.compute(JG(c.inputs[0],"Not",Z=>`!${Z}`))},ZN=c=>{c.compute(JG(c.inputs[0],"Neg",Z=>`-${Z}`))},zW=c=>{c.compute(JG(c.inputs[0],"Reciprocal",Z=>`1.0/${Z}`))},eN=c=>{let Z=nc(c.inputs[0].dataType);c.compute(JG(c.inputs[0],"Relu",Y=>`select(vec4<${Z}>(0.0), ${Y}, ${Y} > vec4<${Z}>(0.0))`))},aN=c=>{c.compute(JG(c.inputs[0],"Sigmoid",Z=>`(1.0 / (1.0 + exp(-${Z})))`))},UW=c=>lG(c),WN=(c,Z)=>{let Y=nc(c.inputs[0].dataType);c.compute(JG(c.inputs[0],"HardSigmoid",R=>`max(vec4<${Y}>(0.0), min(vec4<${Y}>(1.0), ${Z.alpha} * ${R} + vec4<${Y}>(${Z.beta})))`,void 0,Z.cacheKey))},tN=c=>{c.compute(JG(c.inputs[0],"Sin","sin"))},MW=c=>{c.compute(JG(c.inputs[0],"Sinh","sinh"))},nN=c=>{c.compute(JG(c.inputs[0],"Sqrt","sqrt"))},mN=c=>{c.compute(JG(c.inputs[0],"Tan","tan"))},De=c=>`sign(${c}) * (1 - exp(-2 * abs(${c}))) / (1 + exp(-2 * abs(${c})))`,NN=c=>{c.compute(JG(c.inputs[0],"Tanh",De))},BW=(c="f32")=>`
const fast_gelu_a: ${c} = 0.5;
const fast_gelu_b: ${c} = 0.7978845608028654;
const fast_gelu_c: ${c} = 0.035677408136300125;

fn tanh_v(v: vec4<${c}>) -> vec4<${c}> {
  return ${De("v")};
}
`,qe=c=>`(fast_gelu_a + fast_gelu_a * tanh_v(${c} * (fast_gelu_c * ${c} * ${c} + fast_gelu_b))) * ${c}`,sN=c=>{let Z=nc(c.inputs[0].dataType);c.compute(JG(c.inputs[0],"FastGelu",qe,BW(Z),void 0,c.inputs[0].dataType))},YN=(c,Z)=>{let Y=nc(c.inputs[0].dataType);return c.compute(JG(c.inputs[0],"ThresholdedRelu",R=>`select(vec4<${Y}>(0.0), ${R}, ${R} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${Y}>(${Z.alpha});`,Z.cacheKey)),0},hN=c=>{c.compute(JG(c.inputs[0],"Log","log"))},VN=(c,Z)=>`
const alpha = vec4<${c}>(${Z});
const one = ${c}(1.0);
const zero = ${c}(0.0);

fn quick_gelu_impl(x: vec4<${c}>) -> vec4<${c}> {
  let v = x *alpha;
  var x1 : vec4<${c}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,OW=c=>`quick_gelu_impl(${c})`,pN=(c,Z)=>{let Y=nc(c.inputs[0].dataType);c.compute(JG(c.inputs[0],"QuickGelu",OW,VN(Y,Z.alpha),Z.cacheKey,c.inputs[0].dataType))}}),uN,RN,KW,Lh=n(()=>{"use strict";Kl(),aG(),jW(),uN=c=>{if(c[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(c[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(c[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(c[0].dims[2]!==c[1].dims[0])throw new Error("last dimension of input and bias are not the same")},RN=c=>{let Z=c[0].dims.slice();Z[2]=Z[2]/2;let Y=tl("input",c[0].dataType,c[0].dims,4),R=tl("bias",c[0].dataType,[c[0].dims[2]],4),i=Ul("output",c[0].dataType,Z,4),v=dl.size(Z)/4,g=kG(c[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:Z,dataType:c[0].dataType}],dispatchGroup:{x:Math.ceil(v/64)}}),getShaderSource:M=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${c[0].dims[2]/4/2}u;

  ${M.declareVariables(Y,R,i)}

  ${Se(g)}

  ${M.mainStart()}
    ${M.guardAgainstOutOfBoundsWorkgroupSizes(v)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${i.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},KW=c=>{uN(c.inputs),c.compute(RN(c.inputs))}}),oN,FN,Bb,TW,XN,iN,QN,HN,fW,rN,wN,SW,vN,kh=n(()=>{"use strict";Sl(),Kl(),aG(),oN=(c,Z,Y,R,i,v,g,M,j,f,mI,x)=>{let NI,rI;typeof M=="string"?NI=rI=(EI,MI)=>`${M}((${EI}),(${MI}))`:typeof M=="function"?NI=rI=M:(NI=M.scalar,rI=M.vector);let oI=Ul("outputData",mI,R.length,4),XI=tl("aData",j,Z.length,4),xI=tl("bData",f,Y.length,4),LI;if(i)if(v){let EI=dl.size(Z)===1,MI=dl.size(Y)===1,SI=Z.length>0&&Z[Z.length-1]%4===0,qI=Y.length>0&&Y[Y.length-1]%4===0;EI||MI?LI=oI.setByOffset("global_idx",rI(EI?`${XI.type.value}(${XI.getByOffset("0")}.x)`:XI.getByOffset("global_idx"),MI?`${xI.type.value}(${xI.getByOffset("0")}.x)`:xI.getByOffset("global_idx"))):LI=`
            let outputIndices = ${oI.offsetToIndices("global_idx * 4u")};
            let offsetA = ${XI.broadcastedIndicesToOffset("outputIndices",oI)};
            let offsetB = ${xI.broadcastedIndicesToOffset("outputIndices",oI)};
            ${oI.setByOffset("global_idx",rI(g||SI?XI.getByOffset("offsetA / 4u"):`${XI.type.value}(${XI.getByOffset("offsetA / 4u")}[offsetA % 4u])`,g||qI?xI.getByOffset("offsetB / 4u"):`${xI.type.value}(${xI.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else LI=oI.setByOffset("global_idx",rI(XI.getByOffset("global_idx"),xI.getByOffset("global_idx")));else{if(!v)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let EI=(MI,SI,qI="")=>{let ll=`aData[indexA${SI}][componentA${SI}]`,cl=`bData[indexB${SI}][componentB${SI}]`;return`
            let outputIndices${SI} = ${oI.offsetToIndices(`global_idx * 4u + ${SI}u`)};
            let offsetA${SI} = ${XI.broadcastedIndicesToOffset(`outputIndices${SI}`,oI)};
            let offsetB${SI} = ${xI.broadcastedIndicesToOffset(`outputIndices${SI}`,oI)};
            let indexA${SI} = offsetA${SI} / 4u;
            let indexB${SI} = offsetB${SI} / 4u;
            let componentA${SI} = offsetA${SI} % 4u;
            let componentB${SI} = offsetB${SI} % 4u;
            ${MI}[${SI}] = ${qI}(${NI(ll,cl)});
          `};mI===9?LI=`
            var data = vec4<u32>(0);
            ${EI("data",0,"u32")}
            ${EI("data",1,"u32")}
            ${EI("data",2,"u32")}
            ${EI("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:LI=`
            ${EI("outputData[global_idx]",0)}
            ${EI("outputData[global_idx]",1)}
            ${EI("outputData[global_idx]",2)}
            ${EI("outputData[global_idx]",3)}
          `}return`
        ${c.registerUniform("vec_size","u32").declareVariables(XI,xI,oI)}

        ${x??""}

        ${c.mainStart()}
        ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${LI}
      }`},FN=(c,Z,Y,R,i,v,g=Y.dataType)=>{let M=Y.dims.map(XI=>Number(XI)??1),j=R.dims.map(XI=>Number(XI)??1),f=!dl.areEqual(M,j),mI=M,x=dl.size(M),NI=!1,rI=!1,oI=[f];if(f){let XI=_c.calcShape(M,j,!1);if(!XI)throw new Error("Can't perform binary op on the given tensors");mI=XI.slice(),x=dl.size(mI);let xI=dl.size(M)===1,LI=dl.size(j)===1,EI=M.length>0&&M[M.length-1]%4===0,MI=j.length>0&&j[j.length-1]%4===0;oI.push(xI),oI.push(LI),oI.push(EI),oI.push(MI);let SI=1;for(let qI=1;qI<mI.length;qI++){let ll=M[M.length-qI],cl=j[j.length-qI];if(ll===cl)SI*=ll;else break}SI%4===0?(rI=!0,NI=!0):(xI||LI||EI||MI)&&(NI=!0)}else NI=!0;return oI.push(NI),{name:c,shaderCache:{hint:Z+oI.map(XI=>XI.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:XI=>oN(XI,M,j,mI,NI,f,rI,i,Y.dataType,R.dataType,g,v),getRunData:()=>({outputs:[{dims:mI,dataType:g}],dispatchGroup:{x:Math.ceil(x/64/4)},programUniforms:[{type:12,data:Math.ceil(dl.size(mI)/4)},...gl(M,j,mI)]})}},Bb=(c,Z,Y,R,i,v)=>{c.compute(FN(Z,i??"",c.inputs[0],c.inputs[1],Y,R,v))},TW=c=>{Bb(c,"Add",(Z,Y)=>`${Z}+${Y}`)},XN=c=>{Bb(c,"Div",(Z,Y)=>`${Z}/${Y}`)},iN=c=>{Bb(c,"Equal",{scalar:(Z,Y)=>`u32(${Z}==${Y})`,vector:(Z,Y)=>`vec4<u32>(${Z}==${Y})`},void 0,void 0,9)},QN=c=>{Bb(c,"Mul",(Z,Y)=>`${Z}*${Y}`)},HN=c=>{let Z=tl("input",c.inputs[0].dataType,c.inputs[0].dims).type.value;Bb(c,"Pow",{scalar:(Y,R)=>`pow_custom(${Y},${R})`,vector:(Y,R)=>`pow_vector_custom(${Y},${R})`},`
    fn pow_custom(a : ${Z}, b : ${Z}) -> ${Z} {
      if (b == ${Z}(0.0)) {
        return ${Z}(1.0);
      } else if (a < ${Z}(0.0) && f32(b) != floor(f32(b))) {
        return ${Z}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${Z}(1.0), round(f32(abs(b) % ${Z}(2.0))) != 1.0) * ${Z}(${Z==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${Z}>, b : vec4<${Z}>) -> vec4<${Z}> {
      // TODO: implement vectorized pow
      return vec4<${Z}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},fW=c=>{Bb(c,"Sub",(Z,Y)=>`${Z}-${Y}`)},rN=c=>{Bb(c,"Greater",{scalar:(Z,Y)=>`u32(${Z}>${Y})`,vector:(Z,Y)=>`vec4<u32>(${Z}>${Y})`},void 0,void 0,9)},wN=c=>{Bb(c,"Less",{scalar:(Z,Y)=>`u32(${Z}<${Y})`,vector:(Z,Y)=>`vec4<u32>(${Z}<${Y})`},void 0,void 0,9)},SW=c=>{Bb(c,"GreaterOrEqual",{scalar:(Z,Y)=>`u32(${Z}>=${Y})`,vector:(Z,Y)=>`vec4<u32>(${Z}>=${Y})`},void 0,void 0,9)},vN=c=>{Bb(c,"LessOrEqual",{scalar:(Z,Y)=>`u32(${Z}<=${Y})`,vector:(Z,Y)=>`vec4<u32>(${Z}<=${Y})`},void 0,void 0,9)}}),DW,EN,yN,qW,gN,JN,CN=n(()=>{"use strict";Sl(),Kl(),vG(),aG(),DW=(c,Z)=>{if(!c||c.length<1)throw new Error("too few inputs");let Y=0,R=c[Y],i=R.dataType,v=R.dims.length;c.forEach((g,M)=>{if(M!==Y){if(g.dataType!==i)throw new Error("input tensors should be one type");if(g.dims.length!==v)throw new Error("input tensors should have the same shape");g.dims.forEach((j,f)=>{if(f!==Z&&j!==R.dims[f])throw new Error("non concat dimensions must match")})}})},EN=(c,Z)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${c}u>(${Z});
    for (var i: u32 = 0u; i < ${c}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${c}u;
  }`,yN=(c,Z)=>{let Y=c.length,R=[];for(let i=0;i<Y;++i){let v=Z.setByOffset("global_idx",c[i].getByIndices("indices"));Y===1?R.push(v):i===0?R.push(`if (inputIndex == ${i}u) { ${v} }`):i===Y-1?R.push(`else { ${v} }`):R.push(`else if (inputIndex == ${i}) { ${v} }`)}return R.join(`
`)},qW=(c,Z,Y,R)=>{let i=dl.size(Y),v=new Array(c.length),g=new Array(c.length),M=0,j=[],f=[],mI=[{type:12,data:i}];for(let XI=0;XI<c.length;++XI)M+=c[XI].dims[Z],v[XI]=M,f.push(c[XI].dims.length),g[XI]=tl(`input${XI}`,R,f[XI]),j.push("rank"),mI.push({type:12,data:v[XI]});for(let XI=0;XI<c.length;++XI)mI.push(...gl(c[XI].dims));mI.push(...gl(Y));let x=Ul("output",R,Y.length),NI=x.indicesGet("indices",Z),rI=Array.from(Array(v.length).keys()).map(XI=>`uniforms.sizeInConcatAxis${XI}`).join(","),oI=XI=>`

  ${(()=>{XI.registerUniform("outputSize","u32");for(let xI=0;xI<c.length;xI++)XI.registerUniform(`sizeInConcatAxis${xI}`,"u32");return XI.declareVariables(...g,x)})()}

  ${EN(v.length,rI)}

  ${XI.mainStart()}
    ${XI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${x.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${NI});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${v.length}u>(${rI});
      ${NI} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${yN(g,x)}
  }`;return{name:"Concat",shaderCache:{hint:`${Z}`,inputDependencies:j},getRunData:()=>({outputs:[{dims:Y,dataType:R}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:mI}),getShaderSource:oI}},gN=(c,Z)=>{let Y=c.inputs,R=Y[0].dims,i=dl.normalizeAxis(Z.axis,R.length);DW(Y,i);let v=R.slice();v[i]=Y.reduce((M,j)=>M+(j.dims.length>i?j.dims[i]:0),0);let g=Y.filter(M=>dl.size(M.dims)>0);c.compute(qW(g,i,v,Y[0].dataType),{inputs:g})},JN=c=>lG({axis:c.axis})}),Pd,$d,Nd,_W,IZ=n(()=>{"use strict";Sl(),Kl(),Pd=(c,Z,Y="f32")=>{switch(c.activation){case"Relu":return`value = max(value, ${Z}(0.0));`;case"Sigmoid":return`value = (${Z}(1.0) / (${Z}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${Z}(${Y}(uniforms.clip_min)), ${Z}(${Y}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${Z}(0.0), min(${Z}(1.0), ${Y}(uniforms.alpha) * value + ${Y}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${Y}(uniforms.alpha) * value, value, value >= ${Z}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${c.activation}`)}},$d=(c,Z)=>{c.activation==="Clip"?Z.push({type:1,data:c.clipMax},{type:1,data:c.clipMin}):c.activation==="HardSigmoid"?Z.push({type:1,data:c.alpha},{type:1,data:c.beta}):c.activation==="LeakyRelu"&&Z.push({type:1,data:c.alpha})},Nd=(c,Z)=>{c.activation==="Clip"?Z.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):c.activation==="HardSigmoid"?Z.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):c.activation==="LeakyRelu"&&Z.push({name:"alpha",type:"f32"})},_W=c=>{let Z=c?.activation||"";if(Z==="HardSigmoid"){let[Y,R]=c?.activation_params||[.2,.5];return{activation:Z,alpha:Y,beta:R}}else if(Z==="Clip"){let[Y,R]=c?.activation_params||[tc,Mc];return{activation:Z,clipMax:R,clipMin:Y}}else if(Z==="LeakyRelu"){let[Y]=c?.activation_params||[.01];return{activation:Z,alpha:Y}}return{activation:Z}}}),Jc,PW,$W=n(()=>{"use strict";Jc=(c,Z)=>{switch(c){case 1:return Z;case 2:return`vec2<${Z}>`;case 3:return`vec3<${Z}>`;case 4:return`vec4<${Z}>`;default:throw new Error(`${c}-component is not supported.`)}},PW=c=>`
      ${c?"value = value + getBiasByOutputCoords(coords);":""}
      `}),It,xh=n(()=>{"use strict";It=c=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${c}.x), i32(${c}.y), i32(${c}.z), 1));
}
`}),be,lt,_e=n(()=>{"use strict";Sl(),Kl(),aG(),IZ(),be=(c,Z,Y,R,i)=>{let v=R-Y;return`
      ${Array.from({length:Y}).map((g,M)=>`
      if (${Ll(Z.shape,M,Z.rank)} != 1) {
        ${Z.indicesSet(c,M,Ll(i,M+v,R))}
      } else {
        ${Z.indicesSet(c,M,0)}
      }`).join("")}
`},lt=(c,Z,Y,R,i=!1,v)=>{let g=c[0].dims,M=c[1].dims,j=g[g.length-2],f=M[M.length-1],mI=g[g.length-1],x=ZG(f),NI=ZG(mI),rI=ZG(j),oI=dl.size(Y)/x/rI,XI=c.length>2,xI=R?R.slice(0,-2):Y.slice(0,-2),LI=[dl.size(xI),j,f],EI=[{type:12,data:oI},{type:12,data:j},{type:12,data:f},{type:12,data:mI}];$d(Z,EI),EI.push(...gl(xI,g,M)),XI&&EI.push(...gl(c[2].dims)),EI.push(...gl(LI));let MI=SI=>{let qI=ZW("batch_dims",c[0].dataType,xI.length),ll=tl("a",c[0].dataType,g.length,NI),cl=tl("b",c[1].dataType,M.length,x),pl=Ul("output",c[0].dataType,LI.length,x),Xl=kG(pl.type.tensor),kl=Pd(Z,pl.type.value,Xl),xl=[ll,cl],bG="";if(XI){let GG=i?x:1;xl.push(tl("bias",c[2].dataType,c[2].dims.length,GG)),bG=`${i?`value += bias[col / ${GG}];`:`value += ${pl.type.value}(bias[row + i]);`}`}let il=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];Nd(Z,il);let VG=()=>{let GG=`var a_data: ${ll.type.value};`;for(let Bl=0;Bl<NI;Bl++)GG+=`
              let b_data${Bl} = b[(b_offset + (k + ${Bl}) * uniforms.N + col) / ${x}];`;for(let Bl=0;Bl<rI;Bl++){GG+=`a_data = a[(a_offset + (row + ${Bl}) * uniforms.K + k) / ${NI}];`;for(let QG=0;QG<NI;QG++)GG+=`
            values[${Bl}] = fma(${cl.type.value}(a_data${NI===1?"":`[${QG}]`}), b_data${QG}, values[${Bl}]);
`}return GG};return`
  ${SI.registerUniforms(il).registerInternalVariables(qI).declareVariables(...xl,pl)}
  ${SI.mainStart()}
    ${SI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${x})) * ${x};
    var index1 = global_idx / (uniforms.N / ${x});
    let stride1 = uniforms.M / ${rI};
    let row = (index1 % stride1) * ${rI};
    let batch = index1 / stride1;

    ${Y.length===2?"":`let batch_indices = ${qI.offsetToIndices("batch")};`}

    var a_indices: ${ll.type.indices};
    ${be("a_indices",ll,ll.rank-2,qI.rank,"batch_indices")}
    ${ll.indicesSet("a_indices",ll.rank-2,0)}
    ${ll.indicesSet("a_indices",ll.rank-1,0)}
    let a_offset = ${ll.indicesToOffset("a_indices")};

    var b_indices: ${cl.type.indices};
    ${be("b_indices",cl,cl.rank-2,qI.rank,"batch_indices")}
    ${cl.indicesSet("b_indices",cl.rank-2,0)}
    ${cl.indicesSet("b_indices",cl.rank-1,0)}
    let b_offset = ${cl.indicesToOffset("b_indices")};
    var values: array<${pl.type.value}, ${rI}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${NI}) {
      ${VG()}
    }
    for (var i = 0u; i < ${rI}u; i++) {
      var value = values[i];
      ${bG}
      ${kl}
      let cur_indices = ${pl.type.indices}(batch, row + i, col);
      let offset = ${pl.indicesToOffset("cur_indices")};
      ${pl.setByOffset(`offset / ${x}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${Z.activation};${x};${NI};${rI};${i}`,inputDependencies:XI?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:v?v(Y):Y,dataType:c[0].dataType}],dispatchGroup:{x:Math.ceil(oI/64)},programUniforms:EI}),getShaderSource:MI}}}),AN,LN,Gt,Pe,kN,ct,bt,$e,dt=n(()=>{"use strict";Sl(),Kl(),aG(),IZ(),_e(),$W(),AN=(c,Z)=>c?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${Z?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${Z?", batchIndices":""});
        `,LN=(c,Z)=>c?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${Z===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${Z===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${Z===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,Gt=(c,Z,Y="f32",R,i=!1,v=32,g=!1,M=32)=>{let j=Z[1]*c[1],f=Z[0]*c[0],mI=i?j:v,x=i?v:j,NI=mI/Z[0],rI=v/Z[1];if(!((i&&NI===4&&c[1]===4||!i&&(NI===3||NI===4))&&mI%Z[0]===0&&v%Z[1]===0&&c[0]===4))throw new Error(`If transposeA ${i} is true, innerElementSize ${NI} and workPerThread[1] ${c[1]} must be 4.
      Otherwise, innerElementSize ${NI} must be 3 or 4.
  tileAWidth ${mI} must be divisible by workgroupSize[0]${Z[0]}. tileInner ${v} must be divisible by workgroupSize[1] ${Z[1]}. colPerThread ${c[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${NI}<${Y}>, ${mI/NI}>, ${x}>;
var<workgroup> mm_Bsub: array<array<vec4<${Y}>, ${f/c[0]}>, ${v}>;

const rowPerThread = ${c[1]};
const colPerThread = ${c[0]};
const innerElementSize = ${NI};
const tileInner = ${v};

@compute @workgroup_size(${Z[0]}, ${Z[1]}, ${Z[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${g?"0":"i32(globalId.z)"};
  ${R?`let batchIndices = ${R.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${j};

  let num_tiles = ${g?`${Math.ceil(M/v)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${g?`i32(globalId.z) * ${M}`:"0"};

  var acc: array<vec4<${Y}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${rI};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${AN(i,R)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${rI}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${R?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${NI===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${LN(i,NI)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},Pe=(c,Z)=>c?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${Z?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${Z?", batchIndices":""});
            `,kN=c=>c?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",ct=(c,Z,Y="f32",R,i=!1,v=32,g=!1,M=32,j=!1)=>{let f=c[1]*Z[1],mI=c[0]*Z[0],x=i?f:v,NI=i?v:f;if(!(NI%Z[1]===0&&x%Z[0]===0&&v%Z[1]===0))throw new Error(`tileAHight ${NI} must be divisible by workgroupSize[1]${Z[1]}, tileAWidth ${x} must be divisible by workgroupSize[0]${Z[0]}, tileInner ${v} must be divisible by workgroupSize[1]${Z[1]}`);let rI=NI/Z[1],oI=x/Z[0],XI=v/Z[1],xI=j?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${f};
    let globalColStart = i32(workgroupId.x) * ${mI};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${NI}; inputRow = inputRow + ${Z[1]}) {
        for (var inputCol = localCol; inputCol < ${x}; inputCol = inputCol + ${Z[0]}) {
          ${Pe(i,R)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${v}; inputRow = inputRow + ${Z[1]}) {
            for (var inputCol = localCol; inputCol < ${mI}; inputCol = inputCol + ${Z[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${R?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${Y}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${Z[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${i?`mm_Asub[k][localRow + innerRow * ${Z[1]}];`:`mm_Asub[localRow + innerRow * ${Z[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${Z[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${Z[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${f};

let tileRowA = i32(localId.y) * ${rI};
let tileColA = i32(localId.x) * ${oI};
let tileRowB = i32(localId.y) * ${XI};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${rI}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${oI}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${Pe(i,R)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${XI}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${R?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${Y}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${kN(i)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${Y}, ${x}>, ${NI}>;
  var<workgroup> mm_Bsub : array<array<${Y}, ${mI}>, ${v}>;
  const rowPerThread = ${c[1]};
  const colPerThread = ${c[0]};
  const tileInner = ${v};

@compute @workgroup_size(${Z[0]}, ${Z[1]}, ${Z[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${g?"0":"i32(globalId.z)"};
    ${R?`let batchIndices = ${R.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${g?`${Math.ceil(M/v)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${g?`i32(globalId.z) * ${M}`:"0"};

    var acc : array<array<${Y}, colPerThread>, rowPerThread>;
    ${xI}
  }
`},bt=(c,Z,Y,R,i=!1)=>{let[v,g,M,j]=R,f=kG(R[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${v.type.indices}) -> ${Jc(c,f)} {
      var value = ${Jc(c,f)}(0.0);
      let col = colIn * ${c};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${g.type.indices};
        ${be("aIndices",g,g.rank-2,v.rank,"batchIndices")}
        ${g.indicesSet("aIndices",g.rank-2,"u32(row)")}
        ${g.indicesSet("aIndices",g.rank-1,"u32(colIn)")}
        value = ${g.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${v.type.indices}) -> ${Jc(c,f)} {
      var value = ${Jc(c,f)}(0.0);
      let col = colIn * ${c};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${M.type.indices};
        ${be("bIndices",M,M.rank-2,v.rank,"batchIndices")}
        ${M.indicesSet("bIndices",M.rank-2,"u32(row)")}
        ${M.indicesSet("bIndices",M.rank-1,"u32(colIn)")}
        value = ${M.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${Jc(c,f)}) {
      let col = colIn * ${c};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${Z?`value = value + ${i?"bias[colIn]":`${Jc(c,f)}(bias[row])`};`:""}
        ${Y}
        ${j.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},$e=(c,Z,Y,R,i=!1,v)=>{let g=c[0].dims,M=c[1].dims,j=g.slice(0,-2),f=M.slice(0,-2),mI=R?R.slice(0,-2):Y.slice(0,-2),x=dl.size(mI),NI=g[g.length-2],rI=g[g.length-1],oI=M[M.length-1],XI=rI%4===0&&oI%4===0,xI=NI<=8?[4,1,1]:[4,4,1],LI=[8,8,1],EI=[Math.ceil(oI/LI[0]/xI[0]),Math.ceil(NI/LI[1]/xI[1]),Math.ceil(x/LI[2]/xI[2])],MI=XI?4:1,SI=[...j,NI,rI/MI],qI=SI.length,ll=[...f,rI,oI/MI],cl=ll.length,pl=[x,NI,oI/MI],Xl=[{type:6,data:NI},{type:6,data:oI},{type:6,data:rI}];$d(Z,Xl),Xl.push(...gl(mI,SI,ll));let kl=["rank","rank"],xl=c.length>2;xl&&(Xl.push(...gl(c[2].dims)),kl.push("rank")),Xl.push(...gl(pl));let bG=il=>{let VG=mI.length,GG=ZW("batchDims",c[0].dataType,VG,1),Bl=kG(c[0].dataType),QG=tl("a",c[0].dataType,qI,MI),mG=tl("b",c[1].dataType,cl,MI),cG=Ul("result",c[0].dataType,pl.length,MI),pc=[QG,mG];if(xl){let ac=i?MI:1;pc.push(tl("bias",c[2].dataType,c[2].dims.length,ac))}let Rl=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];Nd(Z,Rl);let Al=kG(cG.type.tensor),BG=Pd(Z,cG.type.value,Al),ec=bt(MI,xl,BG,[GG,QG,mG,cG],i);return`
  ${il.registerUniforms(Rl).registerInternalVariables(GG).declareVariables(...pc,cG)}
  ${ec}
  ${XI?Gt(xI,LI,Bl,GG):ct(xI,LI,Bl,GG)}
                   `};return{name:"MatMul",shaderCache:{hint:`${xI};${Z.activation};${XI};${i}`,inputDependencies:kl},getRunData:()=>({outputs:[{dims:v?v(Y):Y,dataType:c[0].dataType}],dispatchGroup:{x:EI[0],y:EI[1],z:EI[2]},programUniforms:Xl}),getShaderSource:bG}}}),Zt,xN,zh=n(()=>{"use strict";Sl(),$I(),aG(),IZ(),$W(),xh(),dt(),Zt=(c,Z,Y,R,i=!1,v,g=4,M=4,j=4,f="f32")=>{let mI=Xl=>{switch(Xl){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${f}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${Xl} is not supported.`)}},x=Xl=>{switch(Xl){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${Xl} is not supported.`)}},NI=c?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,rI=c?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,oI=c?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",XI=c?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",xI=c?"row":"col",LI=c?"col":"row",EI=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${c?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${xI} / outWidth;
    let outCol = ${xI} % outWidth;

    let WRow = ${LI} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${LI} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${LI} % inChannels;
    var resData = ${Jc(g,f)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${oI} && xCol >= 0 && xCol < ${XI}) {
      ${NI}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${mI(g)}
    }
    return resData;`,MI=c?Z&&R?`
    let col = colIn * ${g};
    ${EI}`:`
    let col = colIn * ${g};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${EI}
    }
    return ${Jc(g,f)}(0.0);`:R&&Y?`
    let col = colIn * ${g};
    ${EI}`:`
    let col = colIn * ${g};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${EI}
    }
    return ${Jc(g,f)}(0.0);`,SI=c?R&&Y?x(M):`
    let col = colIn * ${M};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${x(M)}
    }
    return ${Jc(M,f)}(0.0);`:`
    let col = colIn * ${M};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${x(M)}
    }
    return ${Jc(M,f)}(0.0);`,qI=Jc(j,f),ll=Jc(c?g:M,f),cl=Jc(c?M:g,f),pl=Pd(v,qI,f);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${ll} {
      ${c?MI:SI}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${cl} {
      ${c?SI:MI}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${qI}) {
      let col = colIn * ${j};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${c?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${rI}
      ${PW(i)}
      ${pl}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},xN=(c,Z,Y,R,i,v,g,M,j)=>{let f=Z.format==="NHWC",mI=f?c[0].dims[3]:c[0].dims[1],x=Y[0],NI=f?Y[2]:Y[3],rI=f?Y[1]:Y[2],oI=f?Y[3]:Y[1],XI=f&&(mI%4===0||mI%3===0)&&oI%4===0,xI=f?oI:NI*rI,LI=f?NI*rI:oI,EI=[8,8,1],MI=R<=8?[4,1,1]:[4,4,1],SI=[Math.ceil(xI/EI[0]/MI[0]),Math.ceil(LI/EI[1]/MI[1]),Math.ceil(x/EI[2]/MI[2])];gG("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${SI}`);let qI=XI?f&&mI%4!==0?3:4:1,ll=EI[1]*MI[1],cl=EI[0]*MI[0],pl=Math.max(EI[0]*qI,EI[1]),Xl=R%ll===0,kl=i%cl===0,xl=v%pl===0,bG=XI?[qI,4,4]:[1,1,1],il=[{type:6,data:R},{type:6,data:i},{type:6,data:v},{type:6,data:[Z.pads[0],Z.pads[1]]},{type:6,data:Z.strides},{type:6,data:Z.dilations}];$d(Z,il),il.push(...gl(c[0].dims,c[1].dims));let VG=["rank","rank"];g&&(il.push(...gl(c[2].dims)),VG.push("rank")),il.push(...gl(Y));let GG=Bl=>{let QG=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];Nd(Z,QG);let mG=XI?4:1,cG=kG(c[0].dataType),pc=`
      fn setOutputAtIndex(flatIndex : i32, value : ${XI?`vec4<${cG}>`:cG}) {
        result[flatIndex] = ${XI?`vec4<${cG}>`:cG}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${XI?`vec4<${cG}>`:cG}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${XI?"/ 4":""}, value);
      }`,Rl=tl("x",c[0].dataType,c[0].dims.length,qI===3?1:qI),Al=tl("w",c[1].dataType,c[1].dims.length,mG),BG=[Rl,Al],ec=Ul("result",c[0].dataType,Y.length,mG);if(g){let ac=tl("bias",c[2].dataType,c[2].dims.length,mG);BG.push(ac),pc+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${XI?`vec4<${cG}>`:cG} {
          return bias[coords.${f?"w":"y"}${XI?"/ 4":""}];
        }`}return`
        ${It("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${Bl.registerUniforms(QG).declareVariables(...BG,ec)}
        ${pc}
        ${Zt(f,Xl,kl,xl,g,Z,bG[0],bG[1],bG[2],cG)}
        ${XI?Gt(MI,EI,cG,void 0,!f,pl):ct(MI,EI,cG,void 0,!f,pl,!1,void 0,M)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${Z.cacheKey};${qI};${XI};${Xl};${kl};${xl};${ll};${cl};${pl}`,inputDependencies:VG},getRunData:()=>({outputs:[{dims:j?j(Y):Y,dataType:c[0].dataType}],dispatchGroup:{x:SI[0],y:SI[1],z:SI[2]},programUniforms:il}),getShaderSource:GG}}}),et,at,de,Wt,tt,zN,nt,UN,Uh=n(()=>{"use strict";Sl(),$I(),Kl(),aG(),IZ(),$W(),et=c=>{let Z=1;for(let Y=0;Y<c.length;Y++)Z*=c[Y];return Z},at=c=>typeof c=="number"?[c,c,c]:c,de=(c,Z)=>Z<=1?c:c+(c-1)*(Z-1),Wt=(c,Z,Y,R=1)=>{let i=de(Z,R);return Math.floor((c[0]*(Y-1)-Y+i)/2)},tt=(c,Z,Y,R,i)=>{i==null&&(i=Wt(c,Z[0],R[0]));let v=[0,0,0,Y];for(let g=0;g<3;g++)c[g]+2*i>=Z[g]&&(v[g]=Math.trunc((c[g]-Z[g]+2*i)/R[g]+1));return v},zN=(c,Z,Y,R,i,v,g,M,j,f)=>{let mI,x,NI,rI;if(c==="VALID"&&(c=0),typeof c=="number"){mI={top:c,bottom:c,left:c,right:c,front:c,back:c};let oI=tt([Z,Y,R,1],[M,j,f],1,[i,v,g],c);x=oI[0],NI=oI[1],rI=oI[2]}else if(Array.isArray(c)){if(!c.every((XI,xI,LI)=>XI===LI[0]))throw Error(`Unsupported padding parameter: ${c}`);mI={top:c[0],bottom:c[1],left:c[2],right:c[3],front:c[4],back:c[5]};let oI=tt([Z,Y,R,1],[M,j,f],1,[i,v,g],c[0]);x=oI[0],NI=oI[1],rI=oI[2]}else if(c==="SAME_UPPER"){x=Math.ceil(Z/i),NI=Math.ceil(Y/v),rI=Math.ceil(R/g);let oI=(x-1)*i+M-Z,XI=(NI-1)*v+j-Y,xI=(rI-1)*g+f-R,LI=Math.floor(oI/2),EI=oI-LI,MI=Math.floor(XI/2),SI=XI-MI,qI=Math.floor(xI/2),ll=xI-qI;mI={top:MI,bottom:SI,left:qI,right:ll,front:LI,back:EI}}else throw Error(`Unknown padding parameter: ${c}`);return{padInfo:mI,outDepth:x,outHeight:NI,outWidth:rI}},nt=(c,Z,Y,R,i,v=!1,g="channelsLast")=>{let M,j,f,mI,x;if(g==="channelsLast")[M,j,f,mI,x]=c;else if(g==="channelsFirst")[M,x,j,f,mI]=c;else throw new Error(`Unknown dataFormat ${g}`);let[NI,,rI,oI,XI]=Z,[xI,LI,EI]=at(Y),[MI,SI,qI]=at(R),ll=de(rI,MI),cl=de(oI,SI),pl=de(XI,qI),{padInfo:Xl,outDepth:kl,outHeight:xl,outWidth:bG}=zN(i,j,f,mI,xI,LI,EI,ll,cl,pl),il=v?NI*x:NI,VG=[0,0,0,0,0];return g==="channelsFirst"?VG=[M,il,kl,xl,bG]:g==="channelsLast"&&(VG=[M,kl,xl,bG,il]),{batchSize:M,dataFormat:g,inDepth:j,inHeight:f,inWidth:mI,inChannels:x,outDepth:kl,outHeight:xl,outWidth:bG,outChannels:il,padInfo:Xl,strideDepth:xI,strideHeight:LI,strideWidth:EI,filterDepth:rI,filterHeight:oI,filterWidth:XI,effectiveFilterDepth:ll,effectiveFilterHeight:cl,effectiveFilterWidth:pl,dilationDepth:MI,dilationHeight:SI,dilationWidth:qI,inShape:c,outShape:VG,filterShape:Z}},UN=(c,Z,Y,R,i,v)=>{let g=v==="channelsLast",M=g?c[0].dims[3]:c[0].dims[1],j=!1,f=[64,1,1],mI={x:Y.map((EI,MI)=>MI)},x=[Math.ceil(et(mI.x.map(EI=>Y[EI]))/f[0]),1,1];gG("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${x}`);let NI=j?g&&M%4!==0?3:4:1,rI=dl.size(Y),oI=[{type:12,data:rI},{type:12,data:R},{type:12,data:i},{type:12,data:Z.strides},{type:12,data:Z.dilations}];$d(Z,oI),oI.push(...gl(c[0].dims,c[1].dims));let XI=["rank","rank"],xI=c.length===3;xI&&(oI.push(...gl(c[2].dims)),XI.push("rank")),oI.push(...gl(Y));let LI=EI=>{let MI=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:R.length},{name:"pads",type:"u32",length:i.length},{name:"strides",type:"u32",length:Z.strides.length},{name:"dilations",type:"u32",length:Z.dilations.length}];Nd(Z,MI);let SI=j?4:1,qI=kG(c[0].dataType),ll=tl("x",c[0].dataType,c[0].dims.length,NI===3?1:NI),cl=tl("W",c[1].dataType,c[1].dims.length,SI),pl=[ll,cl],Xl=Ul("result",c[0].dataType,Y.length,SI),kl="";if(xI){let il=tl("bias",c[2].dataType,c[2].dims.length,SI);pl.push(il),kl+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${j?`vec4<${qI}>`:qI} {
          return bias[${g?Ll("coords",4,5):Ll("coords",1,5)}${j?"/ 4":""}];
        }`}let xl=Jc(NI,qI),bG=Pd(Z,xl,qI);return`
            ${kl}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${ll.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${cl.getByIndices("aIndices")};
            }
          ${EI.registerUniforms(MI).declareVariables(...pl,Xl)}
          ${EI.mainStart()}
          ${EI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${Xl.offsetToIndices("global_idx")};
              let batch = ${Ll("coords",0,ll.rank)};
              let d2 = ${g?Ll("coords",ll.rank-1,ll.rank):Ll("coords",1,ll.rank)};
              let xFRCCorner = vec3<u32>(${g?Ll("coords",1,ll.rank):Ll("coords",2,ll.rank)},
              ${g?Ll("coords",2,ll.rank):Ll("coords",3,ll.rank)},
              ${g?Ll("coords",3,ll.rank):Ll("coords",4,ll.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${g?Ll("uniforms.x_shape",1,ll.rank):Ll("uniforms.x_shape",2,ll.rank)};
              let xShapeZ = ${g?Ll("uniforms.x_shape",2,ll.rank):Ll("uniforms.x_shape",3,ll.rank)};
              let xShapeW = ${g?Ll("uniforms.x_shape",3,ll.rank):Ll("uniforms.x_shape",4,ll.rank)};
              let xShapeU = ${g?Ll("uniforms.x_shape",4,ll.rank):Ll("uniforms.x_shape",1,ll.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${g?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${g?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${g?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${g?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${xI?"value = value + getBiasByOutputCoords(coords)":""};
              ${bG}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${Z.cacheKey};${g};${NI};${xI}`,inputDependencies:XI},getRunData:()=>({outputs:[{dims:Y,dataType:c[0].dataType}],dispatchGroup:{x:x[0],y:x[1],z:x[2]},programUniforms:oI}),getShaderSource:LI}}}),MN,BN,mt=n(()=>{"use strict";Sl(),Kl(),aG(),IZ(),MN=(c,Z,Y,R)=>{let i=c.length>2,v=i?"value += b[output_channel];":"",g=c[0].dims,M=c[1].dims,j=Z.format==="NHWC",f=j?Y[3]:Y[1],mI=f/Z.group,x=j&&mI>=4?ZG(f):1,NI=dl.size(Y)/x,rI=[{type:12,data:NI},{type:12,data:Z.dilations},{type:12,data:[Z.strides[0],Z.strides[1]]},{type:12,data:[Z.pads[0],Z.pads[1]]},{type:12,data:mI}];$d(Z,rI),rI.push(...gl(g,[M[0],M[1],M[2],M[3]/x]));let oI=i?["rank","rank","rank"]:["rank","rank"];rI.push(...gl([Y[0],Y[1],Y[2],Y[3]/x]));let XI=xI=>{let LI=Ul("output",c[0].dataType,Y.length,x),EI=kG(LI.type.tensor),MI=Pd(Z,LI.type.value,EI),SI=tl("x",c[0].dataType,g.length),qI=tl("w",c[1].dataType,M.length,x),ll=[SI,qI];i&&ll.push(tl("b",c[2].dataType,c[2].dims,x));let cl=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:Z.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];Nd(Z,cl);let pl=j?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${SI.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${qI.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${SI.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${qI.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${xI.registerUniforms(cl).declareVariables(...ll,LI)}

  ${xI.mainStart()}
    ${xI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${LI.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${j?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${j?1:2}], outputIndices[${j?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${x} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${j?2:1}];

    var value: ${LI.type.value} = ${LI.type.value}(0);
    ${pl}
    ${v}
    ${MI}
    ${LI.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${Z.cacheKey}_${x}`,inputDependencies:oI},getRunData:()=>({outputs:[{dims:R?R(Y):Y,dataType:c[0].dataType}],dispatchGroup:{x:Math.ceil(NI/64)},programUniforms:rI}),getShaderSource:XI}},BN=(c,Z,Y,R)=>{let i=c.length>2,v=ZG(Y[3]),g=ZG(Y[2]),M=dl.size(Y)/v/g,j=[c[0].dims[0],c[0].dims[1],c[0].dims[2],c[0].dims[3]/v],f=[c[1].dims[0],c[1].dims[1],c[1].dims[2],c[1].dims[3]/v],mI=[Y[0],Y[1],Y[2],Y[3]/v],x=[{type:12,data:M},{type:6,data:[Z.strides[0],Z.strides[1]]},{type:6,data:[Z.pads[0],Z.pads[1]]}];$d(Z,x),x.push(...gl(j,f,mI));let NI=(g-1)*Z.strides[1]+f[1],rI=oI=>{let XI=Ul("output",c[0].dataType,mI.length,v),xI=kG(XI.type.tensor),LI=Pd(Z,XI.type.value,xI),EI=tl("x",c[0].dataType,j.length,v),MI=tl("w",c[1].dataType,f.length,v),SI=[EI,MI];i&&SI.push(tl("b",c[2].dataType,c[2].dims,v));let qI=i?"value += b[output_channel];":"",ll=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return Nd(Z,ll),`
  ${oI.registerUniforms(ll).declareVariables(...SI,XI)}
  ${oI.mainStart()}
    ${oI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${g}u;
    let col = (index1 % width1) * ${g}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${EI.type.value}, ${NI}>;
    var values: array<${XI.type.value}, ${g}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${f[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${NI}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${EI.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${EI.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${f[1]}; w_width++) {
          let w_val = ${MI.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${g}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${g}u; i++) {
      var value = values[i];
      ${qI}
      ${LI}
      ${XI.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${Z.cacheKey};${v};${g};${NI};${f[0]};${f[1]}`,inputDependencies:i?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:R?R(Y):Y,dataType:c[0].dataType}],dispatchGroup:{x:Math.ceil(M/64)},programUniforms:x}),getShaderSource:rI}}}),ON,Ia,jN,la,Nt,Ga,KN,TN,ca,Mh=n(()=>{"use strict";Kl(),zh(),Uh(),dt(),mt(),IZ(),_e(),Cd(),ON=(c,Z,Y,R,i,v)=>{let g=c[0],M=c.slice(v?1:2,v?3:4),j=M.length,f=Z[0],mI=Z.slice(2).map((NI,rI)=>NI+(NI-1)*(Y[rI]-1)),x=M.map((NI,rI)=>NI+R[rI]+R[rI+j]).map((NI,rI)=>Math.floor((NI-mI[rI]+i[rI])/i[rI]));return x.splice(0,0,g),x.splice(v?3:1,0,f),x},Ia=[2,3,1,0],jN=(c,Z)=>{if(!c||c.length!==2&&c.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(c[0].dims.length>5)throw new Error("greater than 5D is not supported");if(c[0].dims.length!==c[1].dims.length)throw new Error("filter does not have same dimension as input");let Y=c[0].dims[Z.format==="NHWC"?c[0].dims.length-1:1],R=c[1].dims[1]*Z.group;if(Y!==R)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(c.length===3&&(c[2].dims.length!==1||c[1].dims[0]!==c[2].dims[0]))throw new Error("invalid bias");let i=c[0].dims.length-2;if(Z.dilations.length!==i)throw new Error(`dilations should be ${i}D`);if(Z.strides.length!==i)throw new Error(`strides should be ${i}D`);if(Z.pads.length!==i*2)throw new Error(`pads should be ${i*2}D`);if(Z.kernelShape.length!==0&&Z.kernelShape.length!==c[1].dims.length-2)throw new Error("invalid kernel shape")},la=(c,Z)=>{let Y=c.kernelShape.slice();Y.length<Z[1].dims.length-2&&Y.push(...Array(Z[1].dims.length-2-Y.length).fill(0));for(let v=2;v<Z[1].dims.length;++v)Y[v-2]===0&&(Y[v-2]=Z[1].dims[v]);let R=c.pads.slice();Tc.adjustPadsBasedOnAutoPad(Z[0].dims,c.strides,c.dilations,Y,R,c.format==="NHWC",c.autoPad);let i=Object.assign({},c);return Object.assign(i,{kernelShape:Y,pads:R}),i},Nt=c=>{let Z=_W(c),Y=c.format,R=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][c.auto_pad],i=c.dilations,v=c.group,g=c.kernel_shape,M=c.pads,j=c.strides,f=c.w_is_const();return{autoPad:R,format:Y,dilations:i,group:v,kernelShape:g,pads:M,strides:j,wIsConst:f,...Z,cacheKey:`${c.format};${Z.activation};`}},Ga=(c,Z,Y,R)=>{let i=Y.format==="NHWC",v=ON(Z[0].dims,Z[1].dims,Y.dilations,Y.pads,Y.strides,i);if(Y.group!==1){let ll=[Z[0]];if(i){let cl=c.kernelCustomData.wT??c.compute(Hb(Z[1],Ia),{inputs:[1],outputs:[Y.wIsConst?-2:-1]})[0];Y.wIsConst&&!c.kernelCustomData.wT&&(c.kernelCustomData.wT=cl),ll.push(cl)}else ll.push(Z[1]);Z.length===3&&ll.push(Z[2]),!c.adapterInfo.isArchitecture("ampere")&&i&&Z[1].dims[0]===Y.group&&Z[1].dims[1]===1&&Y.dilations[0]===1&&Y.dilations[1]===1?c.compute(BN(ll,Y,v,R),{inputs:ll}):c.compute(MN(ll,Y,v,R),{inputs:ll});return}let g=Z.length===3,M=Z[0].dims[i?1:2],j=Z[0].dims[i?2:3],f=Z[0].dims[i?3:1],mI=Z[1].dims[2],x=Z[1].dims[3],NI=v[i?1:2],rI=v[i?2:3],oI=v[i?3:1],XI=i&&mI===M&&x===j&&Y.pads[0]===0&&Y.pads[1]===0;if(XI||mI===1&&x===1&&Y.dilations[0]===1&&Y.dilations[1]===1&&Y.strides[0]===1&&Y.strides[1]===1&&Y.pads[0]===0&&Y.pads[1]===0){let ll=v[0],cl,pl,Xl,kl=[];if(i){let il=c.kernelCustomData.wT??c.compute(Hb(Z[1],Ia),{inputs:[1],outputs:[Y.wIsConst?-2:-1]})[0];if(Y.wIsConst&&!c.kernelCustomData.wT&&(c.kernelCustomData.wT=il),XI){let VG=M*j*f;cl=Z[0].reshape([1,ll,VG]),pl=il.reshape([1,VG,oI]),Xl=[1,ll,oI]}else cl=Z[0].reshape([ll,M*j,f]),pl=il.reshape([1,f,oI]),Xl=[ll,NI*rI,oI];kl.push(cl),kl.push(pl)}else cl=Z[0].reshape([ll,f,M*j]),pl=Z[1].reshape([1,oI,f]),Xl=[ll,oI,NI*rI],kl.push(pl),kl.push(cl);g&&kl.push(Z[2]);let xl=Xl[2],bG=kl[0].dims[kl[0].dims.length-1];xl<8&&bG<8?c.compute(lt(kl,Y,v,Xl,i,R),{inputs:kl}):c.compute($e(kl,Y,v,Xl,i,R),{inputs:kl});return}let xI=!0,LI=c.kernelCustomData.wT??c.compute(Hb(Z[1],Ia),{inputs:[1],outputs:[Y.wIsConst?-2:-1]})[0];Y.wIsConst&&!c.kernelCustomData.wT&&(c.kernelCustomData.wT=LI);let EI=[Z[0],LI];g&&EI.push(Z[2]);let MI=i?NI*rI:oI,SI=i?oI:NI*rI,qI=mI*x*f;c.compute(xN(EI,Y,v,MI,SI,qI,g,xI,R),{inputs:EI})},KN=(c,Z)=>{let Y=Z.format==="NHWC",R=[c.inputs[0].reshape(Y?[c.inputs[0].dims[0],1,c.inputs[0].dims[1],c.inputs[0].dims[2]]:[c.inputs[0].dims[0],c.inputs[0].dims[1],1,c.inputs[0].dims[2]]),c.inputs[1].reshape([c.inputs[1].dims[0],c.inputs[1].dims[1],1,c.inputs[1].dims[2]])];c.inputs.length===3&&R.push(c.inputs[2]);let i=[0,Z.pads[0],0,Z.pads[1]],v=[1].concat(Z.strides),g=[1].concat(Z.dilations),M=[1].concat(Z.kernelShape),j=la({...Z,pads:i,strides:v,dilations:g,kernelShape:M},R);Ga(c,R,j,f=>Y?[f[0],f[2],f[3]]:[f[0],f[1],f[3]])},TN=(c,Z,Y)=>{let R=Y.format==="NHWC"?"channelsLast":"channelsFirst",i=la(Y,Z),v=Y.autoPad==="NOTSET"?Y.pads:Y.autoPad,g=nt(Z[0].dims,Z[1].dims,Y.strides,Y.dilations,v,!1,R);c.compute(UN(Z,i,g.outShape,[g.filterDepth,g.filterHeight,g.filterWidth],[g.padInfo.front,g.padInfo.top,g.padInfo.left],R))},ca=(c,Z)=>{if(jN(c.inputs,Z),c.inputs[0].dims.length===3)KN(c,Z);else if(c.inputs[0].dims.length===5)TN(c,c.inputs,Z);else{let Y=la(Z,c.inputs);Ga(c,c.inputs,Y)}}}),fN,Bh=n(()=>{"use strict";Sl(),$I(),Kl(),aG(),fN=(c,Z,Y)=>{let R=c.length>2,i=Z.outputShape,v=Z.format==="NHWC",g=Z.group,M=c[1].dims,j=M[2]/g,f=M[3],mI=v?ZG(j):1,x=v?ZG(f):1,NI=v?f===1?mI:x:1,rI=dl.size(i)/x,oI=[Math.ceil(rI/64),1,1];gG("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${oI}`);let XI=["rank","rank"],xI=[Z.strides[0],Z.strides[1]],LI=[Z.kernelShape[v?1:2],Z.kernelShape[v?2:3]],EI=[Z.dilations[0],Z.dilations[1]],MI=[LI[0]+(Z.dilations[0]<=1?0:(Z.kernelShape[v?1:2]-1)*(Z.dilations[0]-1)),LI[1]+(Z.dilations[1]<=1?0:(Z.kernelShape[v?2:3]-1)*(Z.dilations[1]-1))],SI=[MI[0]-1-Math.floor((Z.pads[0]+Z.pads[2])/2),MI[1]-1-Math.floor((Z.pads[1]+Z.pads[3])/2)],qI=[{type:12,data:rI},{type:12,data:xI},{type:12,data:LI},{type:12,data:EI},{type:12,data:MI},{type:6,data:SI},{type:12,data:j},{type:12,data:f},...gl(c[0].dims,c[1].dims)];R&&(qI.push(...gl(c[2].dims)),XI.push("rank")),qI.push(...gl(i));let ll=cl=>{let pl=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:xI.length},{name:"filter_dims",type:"u32",length:LI.length},{name:"dilations",type:"u32",length:LI.length},{name:"effective_filter_dims",type:"u32",length:MI.length},{name:"pads",type:"i32",length:SI.length},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],Xl=kG(c[0].dataType),kl=v?1:2,xl=v?2:3,bG=v?3:1,il=tl("W",c[1].dataType,c[1].dims.length,NI),VG=tl("Dy",c[0].dataType,c[0].dims.length,mI),GG=[VG,il];R&&GG.push(tl("bias",c[2].dataType,[i[bG]].length,x));let Bl=Ul("result",c[0].dataType,i.length,x),QG=()=>{let cG="";if(mI===1)cG+=`
        let w_offset = ${il.indicesToOffset(`${il.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
        let wValue = ${il.getByOffset(`w_offset / ${NI}`)};
        dotProd = dotProd + xValue * wValue;`;else if(f===1)cG+=`
          let wValue = ${il.getByOffset(`${il.indicesToOffset(`${il.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)} / ${NI}`)};
          dotProd = dotProd + dot(xValue, wValue);`;else for(let pc=0;pc<mI;pc++)cG+=`
            let wValue${pc} = ${il.getByOffset(`${il.indicesToOffset(`${il.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${pc}, wOutChannel)`)} / ${NI}`)};
            dotProd = dotProd + xValue[${pc}] * wValue${pc};`;return cG},mG=`
            let outputIndices = ${Bl.offsetToIndices(`global_idx * ${x}`)};
            let batch = ${Bl.indicesGet("outputIndices",0)};
            let d1 = ${Bl.indicesGet("outputIndices",bG)};
            let r = ${Bl.indicesGet("outputIndices",kl)};
            let c = ${Bl.indicesGet("outputIndices",xl)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${Bl.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${Xl}(dyRCorner) + ${Xl}(wR)) / ${Xl}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${Xl}(uniforms.Dy_shape[${kl}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }

              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${Xl}(dyCCorner) + ${Xl}(wC)) / ${Xl}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${Xl}(uniforms.Dy_shape[${xl}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group; d2 = d2 + ${mI}) {
                  let xValue = ${v?VG.getByOffset(`${VG.indicesToOffset(`${VG.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${mI}`):VG.get("batch","inputChannel","idyR","idyC")};
                  ${QG()}
                  inputChannel = inputChannel + ${mI};
                }
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${R?` + bias[d1 / ${x}]`:""};
            ${Bl.setByOffset("global_idx","value")};
          `;return`
    ${cl.registerUniforms(pl).declareVariables(...GG,Bl)}
      ${cl.mainStart()}
      ${cl.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${mG}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${Z.cacheKey};${mI}${NI}${x}${f===1}`,inputDependencies:XI},getRunData:()=>({dispatchGroup:{x:oI[0],y:oI[1],z:oI[2]},outputs:[{dims:Y?Y(i):i,dataType:c[0].dataType}],programUniforms:qI}),getShaderSource:ll}}}),SN,st,DN,Yt,ht,qN,Vt,pt,_N,Oh=n(()=>{"use strict";Bh(),IZ(),Cd(),SN=(c,Z,Y,R,i,v)=>(c-1)*Z+Y+(R-1)*i+1-v,st=(c,Z,Y,R,i)=>{let v=Math.floor(c/2);Z==="SAME_UPPER"?(Y[R]=v,Y[i]=c-v):Z==="SAME_LOWER"&&(Y[R]=c-v,Y[i]=v)},DN=(c,Z,Y,R,i,v,g,M,j,f)=>{let mI=c.length-2,x=f.length===0;j.length<mI&&j.push(...Array(mI-j.length).fill(0));let NI=c[0],rI=Z[M?3:1]*i;for(let oI=0,XI=c.length-mI-(M?1:0);oI<mI;++oI,++XI){let xI=c[XI],LI=x?xI*g[oI]:f[oI],EI=SN(xI,g[oI],v[oI],Z[XI],Y[oI],LI);st(EI,R,v,oI,oI+mI),x&&f.push(g[oI]*(xI-1)+j[oI]+(Z[XI]-1)*Y[oI]+1-v[oI]-v[oI+mI])}f.splice(0,0,NI),f.splice(M?3:1,0,rI)},Yt=(c,Z)=>{let Y=c.kernelShape.slice();if(c.kernelShape.length===0||c.kernelShape.reduce((x,NI)=>x*NI,1)===0){Y.length=0;for(let x=2;x<Z[1].dims.length;++x)Y.push(Z[1].dims[x])}let R=c.format==="NHWC";Y.splice(0,0,Z[1].dims[0]),Y.splice(R?3:1,0,Z[1].dims[1]);let i=c.pads.slice(),v=c.outputShape.slice(),g=c.outputPadding.slice(),M=Z[0].dims,j=c.dilations.slice();if(j.reduce((x,NI)=>x+NI,0)===0){let x=Z[0].dims.length-2;j=new Array(x).fill(1)}let f=c.strides.slice();if(f.reduce((x,NI)=>x+NI,0)===0){let x=Z[0].dims.length-2;f=new Array(x).fill(1)}DN(M,Y,j,c.autoPad,c.group,i,f,R,g,v);let mI=Object.assign({},c);return Object.assign(mI,{kernelShape:Y,pads:i,outputPadding:g,outputShape:v,dilations:j,strides:f}),mI},ht=c=>{let Z=_W(c),Y=c.format,R=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof c.autoPad>"u"?0:c.autoPad],i=c.dilations,v=c.group,g=c.kernelShape,M=c.pads,j=c.strides,f=c.wIsConst(),mI=c.outputPadding,x=c.outputShape;return{autoPad:R,format:Y,dilations:i,group:v,kernelShape:g,outputPadding:mI,outputShape:x,pads:M,strides:j,wIsConst:f,...Z,cacheKey:`${c.format};${Z.activation};`}},qN=(c,Z)=>{if(!c||c.length!==2&&c.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(c[0].dims.length!==4&&c[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(c[0].dims.length!==c[1].dims.length)throw new Error("filter does not have same dimension as input");let Y=c[0].dims[Z.format==="NHWC"?c[0].dims.length-1:1],R=c[1].dims[0];if(Y!==R)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let i=c[1].dims[1]*Z.group;if(c.length===3&&(c[2].dims.length!==1||c[2].dims[0]!==i))throw new Error("invalid bias");let v=c[0].dims.length-2;if(Z.dilations.reduce((g,M)=>g+M,0)>0&&Z.dilations.length!==v)throw new Error(`dilations should be ${v}D`);if(Z.strides.reduce((g,M)=>g+M,0)>0&&Z.strides.length!==v)throw new Error(`strides should be ${v}D`);if(Z.pads.reduce((g,M)=>g+M,0)>0&&Z.pads.length!==v*2)throw new Error(`pads should be ${v*2}D`);if(Z.outputPadding.length!==v&&Z.outputPadding.length!==0)throw new Error(`output_padding should be ${v}D`);if(Z.kernelShape.reduce((g,M)=>g+M,0)>0&&Z.kernelShape.length!==0&&Z.kernelShape.length!==c[1].dims.length-2)throw new Error("invalid kernel shape");if(Z.outputShape.length!==0&&Z.outputShape.length!==c[0].dims.length-2)throw new Error("invalid output shape")},Vt=(c,Z,Y,R)=>{let i=c.kernelCustomData.wT??c.compute(Hb(Z[1],[2,3,0,1]),{inputs:[1],outputs:[Y.wIsConst?-2:-1]})[0];Y.wIsConst&&!c.kernelCustomData.wT&&(c.kernelCustomData.wT=i);let v=[Z[0],i];Z.length===3&&v.push(Z[2]),c.compute(fN(v,Y,R),{inputs:v})},pt=(c,Z)=>{let Y=Z.format==="NHWC",R=[c.inputs[0].reshape(Y?[c.inputs[0].dims[0],1,c.inputs[0].dims[1],c.inputs[0].dims[2]]:[c.inputs[0].dims[0],c.inputs[0].dims[1],1,c.inputs[0].dims[2]]),c.inputs[1].reshape([c.inputs[1].dims[0],c.inputs[1].dims[1],1,c.inputs[1].dims[2]])];c.inputs.length===3&&R.push(c.inputs[2]);let i=Z.kernelShape;(i.length===0||i[0]===0)&&(i=[c.inputs[1].dims[2]]);let v=Z.dilations;(v.length===0||v[0]===0)&&(v=[1]);let g=Z.strides;(g.length===0||g[0]===0)&&(g=[1]);let M=Z.pads;M.length===0&&(M=[0,0]),M=[0,M[0],0,M[1]],g=[1].concat(g),v=[1].concat(v),i=[1].concat(i);let j=Z.outputPadding;j=[0].concat(j);let f=Yt({...Z,pads:M,strides:g,dilations:v,kernelShape:i,outputPadding:j},R);Vt(c,R,f,mI=>Y?[mI[0],mI[2],mI[3]]:[mI[0],mI[1],mI[3]])},_N=(c,Z)=>{if(qN(c.inputs,Z),c.inputs[0].dims.length===3)pt(c,Z);else{let Y=Yt(Z,c.inputs);Vt(c,c.inputs,Y)}}}),ut,PN,$N,jh=n(()=>{"use strict";Sl(),Kl(),vG(),aG(),ut=(c,Z,Y,R)=>{let i=dl.size(Z),v=Z.length,g=tl("input",c,v),M=Ul("output",c,v),j=Y.dataType===6?Y.getInt32Array()[0]:Number(Y.getBigInt64Array()[0]),f=dl.normalizeAxis(j,v),mI=x=>{let NI=` i32(${g.indicesGet("inputIndices","uniforms.axis")}) `,rI=Ll("uniforms.input_shape","uniforms.axis",v),oI=R.reverse?NI+(R.exclusive?" + 1":""):"0",XI=R.reverse?rI:NI+(R.exclusive?"":" + 1");return`
                ${x.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(g,M)}
                ${x.mainStart()}
                  ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${M.offsetToIndices("global_idx")};
                  var sum = ${M.type.value}(0);
                  let first : i32 = ${oI};
                  let last : i32 = ${XI};
                  for (var i : i32 = first; i < last; i++) {
                    ${g.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${g.getByIndices("inputIndices")};
                  }
                  ${M.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:R.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:Z,dataType:c}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:[{type:12,data:i},{type:12,data:f},...gl(Z,Z)]}),getShaderSource:mI}},PN=(c,Z)=>{let Y=c.inputs[0].dims,R=c.inputs[0].dataType,i=c.inputs[1];c.compute(ut(R,Y,i,Z),{inputs:[0]})},$N=c=>{let Z=c.exclusive===1,Y=c.reverse===1;return lG({exclusive:Z,reverse:Y})}}),Is,Rt,ls,Gs,cs,Kh=n(()=>{"use strict";Sl(),Kl(),vG(),aG(),Is=c=>{if(!c||c.length!==1)throw new Error("DepthToSpace requires 1 input.");if(c[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},Rt=(c,Z,Y,R)=>{let i=[];i.push(`fn perm(i: ${R.type.indices}) -> ${Y.type.indices} {
    var a: ${Y.type.indices};`);for(let v=0;v<Z;++v)i.push(Y.indicesSet("a",c[v],`i[${v}]`));return i.push("return a;}"),i.join(`
`)},ls=(c,Z)=>{let Y,R,i,v,g,M,j=Z.format==="NHWC",f=Z.blocksize,mI=Z.mode==="DCR";j?([Y,R,i,v]=c.dims,g=mI?[Y,R,i,f,f,v/f**2]:[Y,R,i,v/f**2,f,f],M=mI?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([Y,R,i,v]=[c.dims[0],c.dims[2],c.dims[3],c.dims[1]],g=mI?[Y,f,f,v/f**2,R,i]:[Y,v/f**2,f,f,R,i],M=mI?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let x=c.reshape(g),NI=x.dims.length,rI=c.dataType,oI=tl("a",rI,NI),XI=Ul("output",rI,NI),xI=LI=>`
  ${LI.registerUniform("output_size","u32").declareVariables(oI,XI)}

  ${Rt(M,NI,oI,XI)}

  ${LI.mainStart()}
    ${LI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${XI.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${XI.setByOffset("global_idx",oI.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${c.dims};${Z.blocksize};${Z.mode}`,inputDependencies:["rank"]},getRunData:LI=>{let EI=j?[Y,R*f,i*f,v/f**2]:[Y,v/f**2,R*f,i*f],MI=dl.size(EI),SI=x.dims,qI=dl.sortBasedOnPerm(SI,M);return{outputs:[{dims:EI,dataType:LI[0].dataType}],dispatchGroup:{x:Math.ceil(MI/64)},programUniforms:[{type:12,data:MI},...gl(SI,qI)]}},getShaderSource:xI}},Gs=(c,Z)=>{Is(c.inputs),c.compute(ls(c.inputs[0],Z))},cs=c=>lG({blocksize:c.blocksize,mode:c.mode,format:c.format})}),ba,Ze,da,bs,ds,ot,Zs,Ft,Ad,es,as,Th=n(()=>{"use strict";Sl(),Kl(),vG(),aG(),ba="[a-zA-Z]|\\.\\.\\.",Ze="("+ba+")+",da="^"+Ze+"$",bs="("+Ze+",)*"+Ze,ds="^"+bs+"$",ot=class{constructor(c=-1){this.symbolToIndices=new Map,this.inputIndex=c}addSymbol(c,Z){let Y=this.symbolToIndices.get(c);Y===void 0?Y=[Z]:Y.push(Z),this.symbolToIndices.set(c,Y)}},Zs=class{constructor(c,Z){this.equation=Z,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[Y,R]=Z.includes("->")?Z.split("->",2):[Z,""];if(!Y.match(RegExp(ds)))throw new Error("Invalid LHS term");if(Y.split(",").forEach((i,v)=>{let g=c[v].dims.slice();if(!i.match(RegExp(da)))throw new Error("Invalid LHS term");let M=this.processTerm(i,!0,g,v);this.lhs.push(M)}),R==="")R+=[...this.symbolToInfo.entries()].filter(([i,v])=>v.count===1||i==="...").map(([i])=>i).join("");else if(!R.match(RegExp(Ze)))throw new Error("Invalid RHS");R.match(RegExp(ba,"g"))?.forEach(i=>{if(i==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let v=this.symbolToInfo.get(i);if(v===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(v.dimValue)}}),this.rhs=this.processTerm(R,!1,this.outputDims)}addSymbol(c,Z,Y){let R=this.symbolToInfo.get(c);if(R!==void 0){if(R.dimValue!==Z&&R.count!==1)throw new Error("Dimension mismatch");R.count++,R.inputIndices.push(Y)}else R={count:1,dimValue:Z,inputIndices:[Y]};this.symbolToInfo.set(c,R)}processTerm(c,Z,Y,R=-1){let i=Y.length,v=!1,g=[],M=0;if(!c.match(RegExp(da))&&!Z&&c!=="")throw new Error("Invalid LHS term");let j=c.match(RegExp(ba,"g")),f=new ot(R);return j?.forEach((mI,x)=>{if(mI==="..."){if(v)throw new Error("Only one ellipsis is allowed per input term");v=!0;let NI=i-j.length+1;if(NI<0)throw new Error("Ellipsis out of bounds");if(g=Y.slice(M,M+NI),this.hasEllipsis){if(this.ellipsisDims.length!==g.length||this.ellipsisDims.toString()!==g.toString())throw new Error("Ellipsis dimensions mismatch")}else if(Z)this.hasEllipsis=!0,this.ellipsisDims=g;else throw new Error("Ellipsis must be specified in the LHS");for(let rI=0;rI<g.length;rI++){let oI=String.fromCharCode(48+rI);f.addSymbol(oI,x+rI),this.addSymbol(oI,Y[M++],R)}}else f.addSymbol(mI,x+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(mI,Y[M++],R)}),f}},Ft=c=>c+"_max",Ad=(c,Z,Y,R)=>{let i=c.map(f=>f.length).map((f,mI)=>tl(`input${mI}`,Z,f)),v=dl.size(R),g=Ul("output",Z,R.length),M=[...Y.symbolToInfo.keys()].filter(f=>!Y.rhs.symbolToIndices.has(f)),j=f=>{let mI=[],x="var prod = 1.0;",NI="var sum = 0.0;",rI="sum += prod;",oI=[],XI=[],xI=[],LI=[],EI=Y.symbolToInfo.size===Y.rhs.symbolToIndices.size;Y.symbolToInfo.forEach((SI,qI)=>{if(Y.rhs.symbolToIndices.has(qI)){let ll=Y.rhs.symbolToIndices.get(qI)?.[0];ll!==void 0&&Y.lhs.forEach((cl,pl)=>{if(SI.inputIndices.includes(pl)){let Xl=cl.symbolToIndices.get(qI);if(Xl===void 0)throw new Error("Invalid symbol error");Xl.forEach(kl=>{mI.push(`${i[pl].indicesSet(`input${pl}Indices`,kl,g.indicesGet("outputIndices",ll))}`)})}})}else Y.lhs.forEach((ll,cl)=>{if(SI.inputIndices.includes(cl)){let pl=ll.symbolToIndices.get(qI);if(pl===void 0)throw new Error("Invalid symbol error");pl.forEach(Xl=>{oI.push(`${i[cl].indicesSet(`input${cl}Indices`,Xl,`${qI}`)}`)}),LI.push(`prod *= ${i[cl].getByIndices(`input${cl}Indices`)};`)}}),XI.push(`for(var ${qI}: u32 = 0; ${qI} < uniforms.${Ft(qI)}; ${qI}++) {`),xI.push("}")});let MI=EI?[...mI,`let sum = ${i.map((SI,qI)=>SI.getByIndices(`input${qI}Indices`)).join(" * ")};`]:[...mI,NI,...XI,...oI,x,...LI,rI,...xI];return`
            ${f.registerUniforms(M.map(SI=>({name:`${Ft(SI)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...i,g)}

            ${f.mainStart()}
            ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${g.offsetToIndices("global_idx")};
            ${i.map((SI,qI)=>`var input${qI}Indices: ${i[qI].type.indices};`).join(`
`)}
            ${MI.join(`
`)};
            ${g.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:Y.equation,inputDependencies:c.map(()=>"rank")},getRunData:()=>{let f=M.filter(x=>Y.symbolToInfo.has(x)).map(x=>({type:12,data:Y.symbolToInfo.get(x)?.dimValue||0}));f.push({type:12,data:v});let mI=c.map((x,NI)=>[...gl(x)]).reduce((x,NI)=>x.concat(NI),f);return mI.push(...gl(R)),{outputs:[{dims:R,dataType:Z}],dispatchGroup:{x:Math.ceil(v/64)},programUniforms:mI}},getShaderSource:j}},es=(c,Z)=>{let Y=new Zs(c.inputs,Z.equation),R=Y.outputDims,i=c.inputs.map((v,g)=>v.dims);c.compute(Ad(i,c.inputs[0].dataType,Y,R))},as=c=>{let Z=c.equation.replace(/\s+/g,"");return lG({equation:Z})}}),Ws,Za,ts,ns,ms,fh=n(()=>{"use strict";Sl(),Kl(),aG(),Ws=c=>{if(!c||c.length!==2)throw new Error("Expand requires 2 input.");let Z=c[0].dims,Y=Array.from(c[1].getBigInt64Array(),Number),R=Y.length<Z.length?0:Y.length-Z.length,i=Z.length<Y.length?0:Z.length-Y.length;for(;R<Y.length&&i<Z.length;++R,++i)if(Y[R]!==Z[i]&&Y[R]!==1&&Z[i]!==1)throw new Error("Expand requires shape to be broadcastable to input")},Za=(c,Z)=>{let Y=c.length-Z.length,R=[];for(let i=0;i<Y;++i)R.push(c[i]);for(let i=0;i<Z.length;++i)R.push(Z[i]===1?c[i+Y]:Z[i]);return R},ts=(c,Z)=>c.length>Z.length?Za(c,Z):Za(Z,c),ns=c=>{let Z=c[0].dims,Y=Array.from(c[1].getBigInt64Array(),Number),R=ts(Z,Y),i=c[0].dataType,v=i===9||dl.size(Z)===1,g=i===9||Z.length>0&&Z[Z.length-1]%4===0?4:1,M=v||R.length>0&&R[R.length-1]%4===0?4:1,j=Math.ceil(dl.size(R)/M),f=x=>{let NI=tl("input",i,Z.length,g),rI=Ul("output",i,R.length,M),oI;if(i===9){let XI=(xI,LI,EI="")=>`
          let outputIndices${LI} = ${rI.offsetToIndices(`outputOffset + ${LI}u`)};
          let offset${LI} = ${NI.broadcastedIndicesToOffset(`outputIndices${LI}`,rI)};
          let index${LI} = offset${LI} / 4u;
          let component${LI} = offset${LI} % 4u;
          ${xI}[${LI}] = ${EI}(${NI.getByOffset(`index${LI}`)}[component${LI}]);
        `;oI=`
        let outputOffset = global_idx * ${M};
        var data = vec4<u32>(0);
        ${XI("data",0,"u32")}
        ${XI("data",1,"u32")}
        ${XI("data",2,"u32")}
        ${XI("data",3,"u32")}
        ${rI.setByOffset("global_idx","data")}
      }`}else oI=`
        let outputIndices = ${rI.offsetToIndices(`global_idx * ${M}`)};
        let inputOffset = ${NI.broadcastedIndicesToOffset("outputIndices",rI)};
        let data = ${rI.type.value}(${NI.getByOffset(`inputOffset / ${g}`)});
        ${rI.setByOffset("global_idx","data")}
      }`;return`
    ${x.registerUniform("vec_size","u32").declareVariables(NI,rI)}
    ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${oI}`},mI=[{type:12,data:j},...gl(Z,R)];return{name:"Expand",shaderCache:{hint:`${R.length};${g}${M}`,inputDependencies:["rank"]},getShaderSource:f,getRunData:()=>({outputs:[{dims:R,dataType:c[0].dataType}],dispatchGroup:{x:Math.ceil(j/64)},programUniforms:mI})}},ms=c=>{Ws(c.inputs),c.compute(ns(c.inputs),{inputs:[0]})}}),ea,Ns,Sh=n(()=>{"use strict";Sl(),Kl(),aG(),jW(),ea=c=>{let Z=c[0].dataType,Y=dl.size(c[0].dims),R=dl.size(c[1].dims),i=R%4===0,v=g=>{let M=tl("x",Z,[1],4),j=tl("bias",Z,[1],4),f=Ul("y",Z,[1],4),mI=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],x=rI=>`
      let bias${rI}_offset: u32 = (global_idx * 4 + ${rI}) % uniforms.bias_size;
      let bias${rI} = ${j.getByOffset(`bias${rI}_offset / 4`)}[bias${rI}_offset % 4];`,NI=i?`
      let bias = ${j.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${x(0)}${x(1)}${x(2)}${x(3)}
      let bias = ${M.type.value}(bias0, bias1, bias2, bias3);`;return`${g.registerUniforms(mI).declareVariables(M,j,f)}

    ${BW(nc(Z))}

    ${g.mainStart(ab)}
      ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${M.getByOffset("global_idx")};
      ${NI}
      let x_in = x + bias;
      ${f.setByOffset("global_idx",qe("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${i}`,inputDependencies:["type","type"]},getShaderSource:v,getRunData:g=>({outputs:[{dims:g[0].dims,dataType:g[0].dataType}],programUniforms:[{type:12,data:Math.ceil(Y/4)},{type:12,data:R}],dispatchGroup:{x:Math.ceil(Y/ab/4)}})}},Ns=c=>{c.inputs.length<2||dl.size(c.inputs[1].dims)===0?sN(c):c.compute(ea(c.inputs))}}),ss,ee,Ys,hs,Dh=n(()=>{"use strict";Sl(),Kl(),vG(),aG(),ss=c=>{if(!c||c.length!==2)throw new Error("Gather requires 2 inputs.")},ee=(c,Z)=>{let Y=c[0].dims,R=c[1].dims,i=Y.length,v=dl.normalizeAxis(Z.axis,i),g=Y.slice(0);g.splice(v,1,...R);let M=Y[v],j=c[0].dataType===9?4:1,f=Math.ceil(dl.size(g)/j),mI=[{type:12,data:f},{type:6,data:M},{type:12,data:v},...gl(c[0].dims,c[1].dims,g)],x=NI=>{let rI=tl("data",c[0].dataType,c[0].dims.length,j),oI=tl("inputIndices",c[1].dataType,c[1].dims.length),XI=Ul("output",c[0].dataType,g.length,j),xI=EI=>{let MI=R.length,SI=`var indicesIndices${EI}  = ${oI.type.indices}(0);`;for(let qI=0;qI<MI;qI++)SI+=`${MI>1?`indicesIndices${EI}[${qI}]`:`indicesIndices${EI}`} = ${g.length>1?`outputIndices${EI}[uniforms.axis + ${qI}]`:`outputIndices${EI}`};`;SI+=`
          var idx${EI} = ${oI.getByIndices(`indicesIndices${EI}`)};
          if (idx${EI} < 0) {
            idx${EI} = idx${EI} + uniforms.axisDimLimit;
          }
          var dataIndices${EI} : ${rI.type.indices};
        `;for(let qI=0,ll=0;qI<i;qI++)qI===v?(SI+=`${i>1?`dataIndices${EI}[${qI}]`:`dataIndices${EI}`} = u32(idx${EI});`,ll+=MI):(SI+=`${i>1?`dataIndices${EI}[${qI}]`:`dataIndices${EI}`} = ${g.length>1?`outputIndices${EI}[${ll}]`:`outputIndices${EI}`};`,ll++);return SI},LI;if(c[0].dataType===9){let EI=(MI,SI,qI="")=>`
          let outputIndices${SI} = ${XI.offsetToIndices(`outputOffset + ${SI}u`)};
          ${xI(SI)};
          let offset${SI} = ${rI.indicesToOffset(`dataIndices${SI}`)};
          let index${SI} = offset${SI} / 4u;
          let component${SI} = offset${SI} % 4u;
          ${MI}[${SI}] = ${qI}(${rI.getByOffset(`index${SI}`)}[component${SI}]);
        `;LI=`
        let outputOffset = global_idx * ${j};
        var value = vec4<u32>(0);
        ${EI("value",0,"u32")}
        ${EI("value",1,"u32")}
        ${EI("value",2,"u32")}
        ${EI("value",3,"u32")}
        ${XI.setByOffset("global_idx","value")}
      `}else LI=`
      let outputIndices = ${XI.offsetToIndices("global_idx")};
      ${xI("")};
      let value = ${rI.getByIndices("dataIndices")};
      ${XI.setByOffset("global_idx","value")};
      `;return`
      ${NI.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(rI,oI,XI)}
      ${NI.mainStart()}
        ${NI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${LI}
      }`};return{name:"Gather",shaderCache:{hint:Z.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:g,dataType:c[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:mI}),getShaderSource:x}},Ys=c=>lG({axis:c.axis}),hs=(c,Z)=>{let Y=c.inputs;ss(Y),c.compute(ee(c.inputs,Z))}}),Vs,aa,ps,qh=n(()=>{"use strict";Sl(),Kl(),aG(),Vs=(c,Z,Y,R,i,v,g,M,j)=>{let f=[{type:12,data:v},{type:12,data:R},{type:12,data:i},{type:12,data:Y},{type:12,data:g},{type:12,data:M},{type:12,data:j}],mI=[v];f.push(...gl(Z.dims,mI));let x=NI=>{let rI=tl("indices_data",Z.dataType,Z.dims.length),oI=Ul("input_slice_offsets_data",12,1,1),XI=[rI,oI],xI=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:i.length},{name:"sizes_from_slice_dims_data",type:"u32",length:Y.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${NI.registerUniforms(xI).declareVariables(...XI)}
  ${NI.mainStart()}
    ${NI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${i.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${Y.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return c.compute({name:"computeSliceOffsets",shaderCache:{hint:`${i.length}_${Y.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:mI,dataType:c.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(v/64)},programUniforms:f}),getShaderSource:x},{inputs:[Z],outputs:[-1]})[0]},aa=(c,Z)=>{let Y=c.inputs,R=Y[0].dims,i=Y[0].dataType,v=Y[1].dims,g=v[v.length-1],M=dl.sizeToDimension(v,v.length-1),j=dl.sizeFromDimension(R,Z.batchDims+g),f=dl.sizeToDimension(R,Z.batchDims),mI=dl.sizeFromDimension(R,Z.batchDims),x=M/f,NI=new Array(g),rI=j;for(let SI=0;SI<g;++SI)NI[g-1-SI]=rI,rI*=R[Z.batchDims+g-1-SI];let oI=Vs(c,Y[1],NI,Z.batchDims,R,M,x,mI,g),XI=Z.batchDims+g;if(XI>R.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let xI=v.slice(0,-1).concat(R.slice(XI)),LI=dl.size(xI),EI=[{type:12,data:LI},{type:12,data:j},...gl(Y[0].dims,oI.dims,xI)],MI=SI=>{let qI=tl("data",Y[0].dataType,Y[0].dims.length),ll=tl("slice_offsets",12,oI.dims.length),cl=Ul("output",Y[0].dataType,xI.length);return`
          ${SI.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(qI,ll,cl)}
            ${SI.mainStart()}
            ${SI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};c.compute({name:"GatherND",shaderCache:{hint:Z.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:xI,dataType:i}],dispatchGroup:{x:Math.ceil(LI/64)},programUniforms:EI}),getShaderSource:MI},{inputs:[Y[0],oI]})},ps=c=>({batchDims:c.batch_dims,cacheKey:""})}),us,_h,Rs,os,Ph=n(()=>{"use strict";Sl(),Kl(),vG(),aG(),us=(c,Z)=>{if(c.length<3||c.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let Y=dl.normalizeAxis(Z.quantizeAxis,c[0].dims.length),R=Z.blockSize,i=c[0],v=c[2],g=c.length===4?c[3]:void 0;if(v.dims.length!==i.dims.length||!i.dims.map((M,j)=>j===Y?Math.ceil(M/R)===v.dims[j]:M===v.dims[j]).reduce((M,j)=>M&&j,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(g){if(g.dataType!==i.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(g.dims.length!==v.dims.length||!g.dims.map((M,j)=>M===v.dims[j]).reduce((M,j)=>M&&j,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},_h=(c,Z)=>{let Y=c[0].dims,R=c[1].dims,i=Y.length,v=dl.normalizeAxis(Z.gatherAxis,i),g=dl.normalizeAxis(Z.quantizeAxis,i),M=Y.slice(0);M.splice(v,1,...R);let j=dl.size(M),f=c[2].dataType,mI=c[0].dataType===22,x=[{type:12,data:j},{type:12,data:g},{type:12,data:v},{type:12,data:Z.blockSize},...gl(...c.map((rI,oI)=>rI.dims),M)],NI=rI=>{let oI=tl("data",c[0].dataType,c[0].dims.length),XI=tl("inputIndices",c[1].dataType,c[1].dims.length),xI=tl("scales",c[2].dataType,c[2].dims.length),LI=c.length>3?tl("zeroPoint",c[3].dataType,c[3].dims.length):void 0,EI=Ul("output",f,M.length),MI=[oI,XI,xI];LI&&MI.push(LI);let SI=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${rI.registerUniforms(SI).declareVariables(...MI,EI)}
        ${rI.mainStart()}
        let output_indices = ${EI.offsetToIndices("global_idx")};
        var indices_indices = ${XI.type.indices}(0);
        ${R.length>1?`
          for (var i: u32 = 0; i < ${R.length}; i++) {
            let index = ${EI.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${XI.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${EI.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${oI.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${EI.indicesGet("output_indices","i")};
          ${oI.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${XI.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${Y[v]};
        }
        ${oI.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${M.length}; i++) {
          let index = ${EI.indicesGet("output_indices",`i + ${R.length} - 1`)};
          ${oI.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${oI.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${oI.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${mI?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${xI.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${xI.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${xI.getByIndices("scale_indices")};
        ${LI?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${LI.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${LI.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${mI?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${nc(f)}(quantized_data - zero_point) * scale;
        ${EI.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${Z.cacheKey};${c.filter((rI,oI)=>oI!==1).map(rI=>rI.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:c.length},(rI,oI)=>"rank")},getRunData:()=>({outputs:[{dims:M,dataType:f}],dispatchGroup:{x:Math.ceil(j/64)},programUniforms:x}),getShaderSource:NI}},Rs=(c,Z)=>{let Y=c.inputs;us(Y,Z),c.compute(_h(c.inputs,Z))},os=c=>lG({blockSize:c.blockSize,gatherAxis:c.gatherAxis,quantizeAxis:c.quantizeAxis})}),vZ,Fs,Xs,is,$h=n(()=>{"use strict";Sl(),Kl(),vG(),aG(),vZ=c=>{if(!c||c.length!==2)throw new Error("GatherElements requires 2 inputs.");if(c[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(c[0].dims.length!==c[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},Fs=(c,Z)=>{let Y=c[0].dims,R=c[0].dataType,i=Y.length,v=c[1].dims,g=c[1].dataType,M=dl.normalizeAxis(Z.axis,i),j=Y[M],f=v.slice(0),mI=dl.size(f),x=tl("input",R,i),NI=tl("indicesInput",g,v.length),rI=Ul("output",R,f.length),oI=[{type:12,data:mI},{type:6,data:j},{type:12,data:M}];return oI.push(...gl(Y,v,f)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:f,dataType:c[0].dataType}],dispatchGroup:{x:Math.ceil(mI/64)},programUniforms:oI}),getShaderSource:XI=>`
      ${XI.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(x,NI,rI)}
      ${XI.mainStart()}
      ${XI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${rI.offsetToIndices("global_idx")};

      var idx = ${NI.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${x.type.indices}(outputIndices);
      ${x.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${x.getByIndices("inputIndices")};

      ${rI.setByOffset("global_idx","value")};
  }`}},Xs=c=>lG({axis:c.axis}),is=(c,Z)=>{let Y=c.inputs;vZ(Y),c.compute(Fs(c.inputs,Z))}}),Qs,Hs,rs,Wa,N2=n(()=>{"use strict";Sl(),Kl(),aG(),Qs=c=>{if(!c)throw new Error("Input is missing");if(c.length<2||c.length>3)throw new Error("Invaid input number.");if(c.length===3&&c[2].dims.length>2)throw new Error("Invalid input shape of C");if(c[0].dataType!==c[1].dataType||c.length===3&&c[0].dataType!==c[2].dataType)throw new Error("Input types are mismatched")},Hs=(c,Z)=>{let Y=c[0].dims.slice(),R=c[1].dims.slice(),[i,v,g]=md.getShapeOfGemmResult(Y,Z.transA,R,Z.transB,c.length===3?c[2].dims:void 0),M=[i,v];if(!M)throw new Error("Can't use gemm on the given tensors");let j=16,f=Math.ceil(v/j),mI=Math.ceil(i/j),x=!0,NI=dl.size(M),rI=[{type:12,data:x?f:NI},{type:12,data:i},{type:12,data:v},{type:12,data:g},{type:1,data:Z.alpha},{type:1,data:Z.beta}],oI=["type","type"];c.length===3&&(rI.push(...gl(c[2].dims)),oI.push("rank")),rI.push(...gl(M));let XI=LI=>{let EI="";Z.transA&&Z.transB?EI="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":Z.transA&&!Z.transB?EI="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!Z.transA&&Z.transB?EI="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!Z.transA&&!Z.transB&&(EI="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let MI=Z.alpha===1?"":"value *= uniforms.alpha;",SI=tl("a",c[0].dataType,c[0].dims),qI=tl("b",c[1].dataType,c[1].dims),ll=SI.type.value,cl=null,pl=[SI,qI];c.length===3&&(cl=tl("c",c[2].dataType,c[2].dims.length),pl.push(cl));let Xl=Ul("output",c[0].dataType,M.length);pl.push(Xl);let kl=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${LI.registerUniforms(kl).declareVariables(...pl)}

  ${LI.mainStart()}
    ${LI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${ll}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${EI}
    }

    ${MI}
    ${cl!=null?`let cOffset = ${cl.broadcastedIndicesToOffset("vec2(m, n)",Xl)}; value += ${ll}(uniforms.beta) * ${cl.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},xI=LI=>{let EI=tl("a",c[0].dataType,c[0].dims),MI=tl("b",c[1].dataType,c[1].dims),SI=null,qI=[EI,MI];c.length===3&&(SI=tl("c",c[2].dataType,c[2].dims.length),qI.push(SI));let ll=Ul("output",c[0].dataType,M.length);qI.push(ll);let cl=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],pl="",Xl="";Z.transA&&Z.transB?(Xl=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${EI.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${MI.type.value}(0);
      }
      `,pl="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):Z.transA&&!Z.transB?(Xl=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${EI.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${MI.type.value}(0);
      }
      `,pl="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!Z.transA&&Z.transB?(Xl=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${EI.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${MI.type.value}(0);
      }
      `,pl="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!Z.transA&&!Z.transB&&(Xl=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${EI.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${MI.type.value}(0);
      }
      `,pl="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let kl=Z.alpha===1?"":"value *= uniforms.alpha;";return`
  ${LI.registerUniforms(cl).declareVariables(...qI)}
  var<workgroup> tile_a: array<array<${EI.type.storage}, ${j}>, ${j}>;
  var<workgroup> tile_b: array<array<${MI.type.storage}, ${j}>, ${j}>;
  ${LI.mainStart([j,j,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${j};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${j};
    let num_tiles = (uniforms.K - 1) / ${j} + 1;
    var k_start = 0u;
    var value = ${ll.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${Xl}
      k_start = k_start + ${j};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${j}; k++) {
        ${pl}
      }
      workgroupBarrier();
    }

    ${kl}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${SI!=null?`let cOffset = ${SI.broadcastedIndicesToOffset("vec2(m, n)",ll)}; value += ${ll.type.value}(uniforms.beta) * ${SI.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return x?{name:"GemmShared",shaderCache:{hint:`${Z.cacheKey}`,inputDependencies:oI},getRunData:()=>({outputs:[{dims:M,dataType:c[0].dataType}],dispatchGroup:{x:f*mI},programUniforms:rI}),getShaderSource:xI}:{name:"Gemm",shaderCache:{hint:`${Z.cacheKey}`,inputDependencies:oI},getRunData:()=>({outputs:[{dims:M,dataType:c[0].dataType}],dispatchGroup:{x:Math.ceil(NI/64)},programUniforms:rI}),getShaderSource:XI}},rs=c=>{let Z=c.transA,Y=c.transB,R=c.alpha,i=c.beta;return{transA:Z,transB:Y,alpha:R,beta:i,cacheKey:`${c.transA};${c.transB};${c.alpha===1}`}},Wa=(c,Z)=>{Qs(c.inputs),c.compute(Hs(c.inputs,Z))}}),$b,sd,lZ,GZ,ws,Xt,vs,Es,it,ys,gs,Qt,Js,Cs,Ht=n(()=>{"use strict";Sl(),Kl(),vG(),aG(),[$b,sd,lZ,GZ]=[0,1,2,3],ws=c=>{if(c[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(c[0].dims.length!==c[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(c[0].dims.length-2!==c[1].dims[c[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${c[0].dims.length-2}`);if(c[0].dims[0]!==c[1].dims[0])throw new Error("grid batch size must match input batch size")},Xt=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,vs=c=>`
  fn gs_bicubic_interpolate(p: mat4x4<${c}>, x: f32, y: f32) -> ${c} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${c}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,Es=c=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${c.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,it=c=>`
  ${c.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,ys=(c,Z,Y)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${Z} {
     var pixel = ${Z}(0);
     var indices = vec4<u32>(0);
     indices[${$b}] = batch;
     indices[${sd}] = channel;`+(()=>{switch(Y.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${lZ}] = u32(r);
            indices[${GZ}] = u32(c);
          }
        `;case"border":return`
          indices[${lZ}] = u32(clamp(r, 0, H - 1));
          indices[${GZ}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${lZ}] = gs_reflect(r, border[1], border[3]);
          indices[${GZ}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${Y.paddingMode} is not supported`)}})()+`
    return ${c.getByIndices("indices")};
  }
`,gs=(c,Z,Y)=>(()=>{switch(Y.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${$b}], indices[${sd}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${$b}], indices[${sd}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${$b}], indices[${sd}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${$b}], indices[${sd}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${$b}], indices[${sd}], border);

          let dx2 = ${Z}(f32(x2) - x);
          let dx1 = ${Z}(x - f32(x1));
          let dy2 = ${Z}(f32(y2) - y);
          let dy1 = ${Z}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${Z}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${$b}], indices[${sd}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${Y.mode} is not supported`)}})()+`${c.setByOffset("global_idx","result")}`,Qt=(c,Z)=>{let Y=tl("x",c[0].dataType,c[0].dims.length),R=[c[1].dims[0],c[1].dims[1],c[1].dims[2]],i=tl("grid",c[1].dataType,R.length,2),v=[c[0].dims[0],c[0].dims[1],c[1].dims[1],c[1].dims[2]];Z.format==="NHWC"&&(v=[c[0].dims[0],c[1].dims[1],c[1].dims[2],c[0].dims[3]],[$b,sd,lZ,GZ]=[0,3,1,2]);let g=Ul("output",c[0].dataType,v.length),M=Y.type.value,j=dl.size(v),f=[{type:12,data:j},...gl(c[0].dims,R,v)],mI=x=>`
  ${x.registerUniform("output_size","u32").declareVariables(Y,i,g)}
  ${Xt}
  ${vs(M)}
  ${Es(Z)}
  ${it(Z)}
  ${ys(Y,M,Z)}

  ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${lZ}]);
      let W_in = i32(uniforms.x_shape[${GZ}]);

      ${Z.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${g.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${$b}], indices[${lZ}], indices[${GZ}]);
      let nxy = ${i.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${gs(g,M,Z)}
  }`;return{name:"GridSample",shaderCache:{hint:`${Z.cacheKey}`,inputDependencies:["type","type"]},getRunData:x=>{let NI=dl.size(v);return{outputs:[{dims:v,dataType:x[0].dataType}],dispatchGroup:{x:Math.ceil(NI/64)},programUniforms:f}},getShaderSource:mI}},Js=(c,Z)=>{ws(c.inputs),c.compute(Qt(c.inputs,Z))},Cs=c=>lG({alignCorners:c.align_corners,mode:c.mode,paddingMode:c.padding_mode,format:c.format})}),Gb,As,Ls,rt,wt,cZ,IV,ks=n(()=>{"use strict";Sl(),Kl(),vG(),BI(),rW(),aG(),Cd(),Gb=(c,Z)=>c.length>Z&&c[Z].dims.length>0?c[Z]:void 0,As=(c,Z)=>{let Y=c[0],R=Gb(c,1),i=Gb(c,2),v=Gb(c,3),g=Gb(c,4),M=Gb(c,5),j=Gb(c,6),f=Gb(c,7);if(Y.dims.length!==3&&Y.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let mI=Y.dims[0],x=Y.dims[1],NI=Y.dims.length===3?Y.dims[2]:Z.numHeads*Y.dims[4],rI=x,oI=0,XI=0,xI=Math.floor(NI/Z.numHeads);if(j&&f&&dl.size(j.dims)&&dl.size(f.dims)){if(j.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(j.dims[0]!==mI||j.dims[1]!==Z.numHeads||j.dims[3]!==xI)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(f.dims[0]!==mI||f.dims[1]!==Z.numHeads||f.dims[3]!==xI)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(j.dims[2]!==f.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(f.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');oI=j.dims[2],XI=j.dims[2]}else if(j&&dl.size(j.dims)||f&&dl.size(f.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let LI;if(R&&dl.size(R.dims)>0){if(Y.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(R.dims.length<3||R.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(Y.dims[0]!==R.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(R.dims.length===3){if(R.dims[2]!==Y.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');LI=2,rI=R.dims[1]}else if(R.dims.length===5){if(R.dims[2]!==Z.numHeads||R.dims[3]!==2||R.dims[4]!==xI)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(i)throw new Error('Expect "value" be none when "key" has packed kv format.');LI=5,rI=R.dims[1]}else{if(R.dims[1]!==Z.numHeads||R.dims[3]!==xI)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');LI=0,rI=R.dims[2]}}else{if(Y.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(Y.dims[2]!==Z.numHeads||Y.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');LI=3}if(v&&dl.size(v.dims)>0){if(v.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(R&&R.dims.length===5&&R.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let EI=oI+rI,MI=0;if(g&&dl.size(g.dims)>0){MI=8;let cl=g.dims;throw cl.length===1?cl[0]===mI?MI=1:cl[0]===3*mI+2&&(MI=3):cl.length===2&&cl[0]===mI&&cl[1]===EI&&(MI=5),MI===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let SI=!1,qI=NI;if(i&&dl.size(i.dims)>0){if(i.dims.length!==3&&i.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(Y.dims[0]!==i.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(i.dims.length===3){if(rI!==i.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');qI=i.dims[2]}else{if(rI!==i.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');qI=i.dims[1]*i.dims[3],SI=!0}}let ll=!1;if(g&&dl.size(g.dims)>0)throw new Error("Key padding mask is not supported");if(M&&dl.size(M.dims)>0){if(M.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(M.dims[0]!==mI||M.dims[1]!==Z.numHeads||M.dims[2]!==x||M.dims[3]!==EI)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:mI,sequenceLength:x,pastSequenceLength:oI,kvSequenceLength:rI,totalSequenceLength:EI,maxSequenceLength:XI,inputHiddenSize:0,hiddenSize:NI,vHiddenSize:qI,headSize:xI,vHeadSize:Math.floor(qI/Z.numHeads),numHeads:Z.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:Z.maskFilterValue,maskType:MI,scale:Z.scale,broadcastResPosBias:ll,passPastInKv:SI,qkvFormat:LI}},Ls=c=>lG({...c}),rt=lG({perm:[0,2,1,3]}),wt=(c,Z,Y,R,i,v,g)=>{let M=[R,i,v],j=dl.size(M),f=[{type:12,data:j},{type:12,data:g},{type:12,data:v}],mI=x=>{let NI=Ul("qkv_with_bias",Z.dataType,M),rI=tl("qkv",Z.dataType,M),oI=tl("bias",Y.dataType,M),XI=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${x.registerUniforms(XI).declareVariables(rI,oI,NI)}
  ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return c.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:M,dataType:Z.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(j/64)},programUniforms:f}),getShaderSource:mI},{inputs:[Z,Y],outputs:[-1]})[0]},cZ=(c,Z,Y,R,i,v,g,M)=>{let j=v;if(g&&dl.size(g.dims)>0){if(R===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return j=wt(c,v,g,Z,R,Y*i,M),j=j.reshape([Z,R,Y,i]),Y===1||R===1?j:c.compute(Hb(j,rt.perm),{inputs:[j],outputs:[-1]})[0]}else return v.dims.length===3&&(j=v.reshape([Z,R,Y,i])),Y===1||R===1?j:c.compute(Hb(j,rt.perm),{inputs:[j],outputs:[-1]})[0]},IV=(c,Z)=>{let Y=As(c.inputs,Z),R=c.inputs[0],i=Gb(c.inputs,1),v=Gb(c.inputs,2),g=Gb(c.inputs,3),M=Gb(c.inputs,4),j=Gb(c.inputs,5),f=Gb(c.inputs,6),mI=Gb(c.inputs,7);if(R.dims.length===5)throw new Error("Packed QKV is not implemented");if(i?.dims.length===5)throw new Error("Packed KV is not implemented");let x=i&&v&&i.dims.length===4&&v.dims.length===4,NI=cZ(c,Y.batchSize,Y.numHeads,Y.sequenceLength,Y.headSize,R,g,0);if(x)return Ge(c,NI,i,v,M,void 0,f,mI,j,Y);if(!i||!v)throw new Error("key and value must be provided");let rI=cZ(c,Y.batchSize,Y.numHeads,Y.kvSequenceLength,Y.headSize,i,g,Y.hiddenSize),oI=cZ(c,Y.batchSize,Y.numHeads,Y.kvSequenceLength,Y.vHeadSize,v,g,2*Y.hiddenSize);Ge(c,NI,rI,oI,M,void 0,f,mI,j,Y)}}),xs,vt,zs,Us,ta,Ms,Bs,Et=n(()=>{"use strict";Sl(),Kl(),vG(),aG(),xs=c=>{if(!c||c.length<1)throw new Error("too few inputs")},vt=(c,Z)=>{let Y=[],R=Z.numOutputs;return c[1].dims[0]>0&&(c[1].getBigInt64Array().forEach(i=>Y.push(Number(i))),R=Y.length),lG({numOutputs:R,axis:Z.axis,splitSizes:Y})},zs=c=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${c}u; i += 1u ) {
    if (index < ${Ll("uniforms.size_in_split_axis","i",c)}) {
        return i;
    }
    }
    return ${c}u;
}`,Us=c=>{let Z=c.length,Y=[];for(let R=0;R<Z;++R){let i=c[R].setByIndices("indices","input[global_idx]");Z===1?Y.push(i):R===0?Y.push(`if (output_number == ${R}u) { ${i} }`):R===Z-1?Y.push(`else { ${i} }`):Y.push(`else if (output_number == ${R}) { ${i} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${c[0].type.indices}, global_idx: u32) {
        ${Y.join(`
`)}
      }`},ta=(c,Z)=>{let Y=c[0].dims,R=dl.size(Y),i=c[0].dataType,v=dl.normalizeAxis(Z.axis,Y.length),g=new Array(Z.numOutputs),M=tl("input",i,Y.length),j=new Array(Z.numOutputs),f=[],mI=[],x=0,NI=[{type:12,data:R}];for(let oI=0;oI<Z.numOutputs;oI++){x+=Z.splitSizes[oI],j[oI]=x;let XI=Y.slice();XI[v]=Z.splitSizes[oI],mI.push(XI),g[oI]=Ul(`output${oI}`,i,XI.length),f.push({dims:mI[oI],dataType:c[0].dataType})}NI.push({type:12,data:j},...gl(Y,...mI));let rI=oI=>`
  ${oI.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",j.length).declareVariables(M,...g)}
  ${zs(j.length)}
  ${Us(g)}

  ${oI.mainStart()}
    ${oI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${M.offsetToIndices("global_idx")};
    var index = ${M.indicesGet("indices",v)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${Ll("uniforms.size_in_split_axis","output_number - 1u",j.length)};
      ${M.indicesSet("indices",v,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:Z.cacheKey,inputDependencies:["rank"]},getShaderSource:rI,getRunData:()=>({outputs:f,dispatchGroup:{x:Math.ceil(R/64)},programUniforms:NI})}},Ms=(c,Z)=>{xs(c.inputs);let Y=c.inputs.length===1?Z:vt(c.inputs,Z);c.compute(ta(c.inputs,Y),{inputs:[0]})},Bs=c=>{let Z=c.axis,Y=c.splitSizes,R=c.numOutputs<0?Y.length:c.numOutputs;if(R!==Y.length)throw new Error("numOutputs and splitSizes lengh must be equal");return lG({axis:Z,numOutputs:R,splitSizes:Y})}}),lV,GV,na,yt,cV=n(()=>{"use strict";vG(),rW(),ks(),Et(),Cd(),lV=(c,Z)=>{if(Z.doRotary)throw new Error("GroupQuerryAttention do_rotary attribute is not supported");if(Z.doRotary&&c.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let Y=c[0],R=c[1],i=c[2],v=c[3],g=c[4];if(Z.localWindowSize!==-1)throw new Error("Local attention is not supported");if(Z.softcap!==0)throw new Error("Softcap is not supported");if(Z.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(Z.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(Y.dims.length!==3&&Y.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let M=!1,j=Y.dims[0],f=Y.dims[1],mI=Y.dims.length===3?M?Y.dims[2]/3:Y.dims[2]:Z.numHeads*Y.dims[4],x=f,NI=0,rI=!R||R.dims.length===0,oI=Math.floor(rI?mI/(Z.numHeads+2*Z.kvNumHeads):mI/Z.numHeads);rI&&(mI=oI*Z.numHeads);let XI=v&&v.dims.length!==0,xI=g&&g.dims.length!==0;if(XI&&v.dims.length===4&&v.dims[0]===j&&v.dims[1]!==Z.kvNumHeads&&v.dims[2]===Z.kvNumHeads&&v.dims[3]===oI)throw new Error("BSNH pastKey/pastValue is not supported");if(XI&&xI){if(v.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(g.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');NI=v.dims[2]}else if(XI||xI)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let LI=1;if(R&&R.dims.length>0){if(Y.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(R.dims.length<3||R.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(Y.dims[0]!==R.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(R.dims.length===3){if(Y.dims[2]%R.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');x=R.dims[1]}else if(R.dims.length===5){if(R.dims[2]!==Z.numHeads||R.dims[3]!==2||R.dims[4]!==oI)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(i)throw new Error('Expect "value" be none when "key" has packed kv format.');x=R.dims[1]}else{if(R.dims[1]!==Z.numHeads||R.dims[3]!==oI)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');x=R.dims[2]}}else{if(Y.dims.length!==3&&Y.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(Y.dims.length===5&&(Y.dims[2]!==Z.numHeads||Y.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');LI=3}let EI=0,MI=!1,SI=Z.kvNumHeads?oI*Z.kvNumHeads:mI;if(i&&i.dims.length>0){if(i.dims.length!==3&&i.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(Y.dims[0]!==i.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(i.dims.length===3){if(x!==i.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');SI=i.dims[2]}else{if(x!==i.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');SI=i.dims[1]*i.dims[3],MI=!0}}let qI=c.length>4?c[5]:void 0;if(qI&&qI.dims.length!==1&&qI.dims[0]!==j)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:j,sequenceLength:f,pastSequenceLength:NI,kvSequenceLength:x,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:mI,vHiddenSize:SI,headSize:oI,vHeadSize:Math.floor(SI/Z.kvNumHeads),numHeads:Z.numHeads,kvNumHeads:Z.kvNumHeads,nReps:Z.numHeads/Z.kvNumHeads,pastPresentShareBuffer:!1,maskType:EI,scale:Z.scale,broadcastResPosBias:!1,passPastInKv:MI,qkvFormat:LI}},GV=lG({perm:[0,2,1,3]}),na=(c,Z,Y)=>{let R=Z,i=Y.kvNumHeads;return Z.dims.length===3&&Y.kvSequenceLength!==0&&(R=Z.reshape([Y.batchSize,Y.kvSequenceLength,i,Y.headSize]),R=c.compute(Hb(R,GV.perm),{inputs:[R],outputs:[-1]})[0]),R},yt=(c,Z)=>{let Y=lV(c.inputs,Z);if(c.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(c.inputs[1]?.dims.length===5)throw new Error("Packed KV is not implemented");let R=c.inputs[0],i=c.inputs[1]&&c.inputs[1].dims.length>0?c.inputs[1]:void 0,v=c.inputs[2]&&c.inputs[2].dims.length>0?c.inputs[2]:void 0,g=c.inputs[3]&&c.inputs[3].dims.length!==0?c.inputs[3]:void 0,M=c.inputs[4]&&c.inputs[4].dims.length!==0?c.inputs[4]:void 0,j=c.inputs.length>4?c.inputs[5]:void 0,f=c.inputs.length>5?c.inputs[6]:void 0,mI=Y.kvNumHeads?Y.kvNumHeads:Y.numHeads,x=lG({axis:2,numOutputs:3,splitSizes:[Y.numHeads*Y.headSize,mI*Y.headSize,mI*Y.headSize]}),[NI,rI,oI]=!i&&!v?c.compute(ta([R],x),{inputs:[R],outputs:[-1,-1,-1]}):[R,i,v],XI=cZ(c,Y.batchSize,Y.numHeads,Y.sequenceLength,Y.headSize,NI,void 0,0);Ge(c,XI,na(c,rI,Y),na(c,oI,Y),void 0,void 0,g,M,void 0,Y,j,f)}}),gt,Jt,Os,js,Ks=n(()=>{"use strict";Sl(),Kl(),Cd(),aG(),gt=(c,Z,Y,R,i,v,g,M)=>{let j=ZG(v),f=j===1?"f32":`vec${j}f`,mI=j===1?"vec2f":`mat2x${j}f`,x=i*g,NI=64;x===1&&(NI=256);let rI=[i,g,v/j],oI=[i,g,2],XI=["rank","type","type"],xI=[];xI.push(...gl(rI,oI));let LI=EI=>{let MI=tl("x",Z.dataType,3,j),SI=tl("scale",Y.dataType,Y.dims),qI=tl("bias",R.dataType,R.dims),ll=Ul("output",1,3,2),cl=[MI,SI,qI,ll];return`
  var<workgroup> workgroup_shared : array<${mI}, ${NI}>;
  const workgroup_size = ${NI}u;
  ${EI.declareVariables(...cl)}
  ${EI.mainStart(NI)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${f}(0);
    var squared_sum = ${f}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${f}(${MI.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${mI}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${gc("workgroup_shared[0][0]",j)} / f32(hight * ${j});
      let squared_sum_final = ${gc("workgroup_shared[0][1]",j)} / f32(hight * ${j});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${M}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return c.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${j};${M};${NI}`,inputDependencies:XI},getRunData:()=>({outputs:[{dims:oI,dataType:1}],dispatchGroup:{x},programUniforms:xI}),getShaderSource:LI},{inputs:[Z,Y,R],outputs:[-1]})[0]},Jt=(c,Z,Y)=>{let R=Z[0].dims,i=R,v=2,g=R[0],M=R[1],j=dl.sizeFromDimension(R,v),f=ZG(j),mI=dl.size(i)/f,x=gt(c,Z[0],Z[1],Z[2],g,j,M,Y.epsilon),NI=[g,M,j/f],rI=[g,M],oI=["type","none"],XI=xI=>{let LI=tl("x",Z[0].dataType,NI.length,f),EI=tl("scale_shift",1,rI.length,2),MI=Ul("output",Z[0].dataType,NI.length,f),SI=[LI,EI,MI];return`
  ${xI.registerUniform("output_size","u32").declareVariables(...SI)}
  ${xI.mainStart()}
  ${xI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${MI.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${EI.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${LI.getByOffset("global_idx")} * ${MI.type.value}(scale_shift.x) + ${MI.type.value}(scale_shift.y);
      ${MI.setByOffset("global_idx","value")};
  }`};c.compute({name:"InstanceNormalization",shaderCache:{hint:`${f}`,inputDependencies:oI},getRunData:()=>({outputs:[{dims:i,dataType:Z[0].dataType}],dispatchGroup:{x:Math.ceil(mI/64)},programUniforms:[{type:12,data:mI},...gl(NI,rI,NI)]}),getShaderSource:XI},{inputs:[Z[0],x]})},Os=(c,Z,Y)=>{let R=Z[0].dims,i=R,v=R[0],g=R[R.length-1],M=dl.sizeFromDimension(R,1)/g,j=ZG(g),f=dl.size(i)/j,mI=[{type:12,data:M},{type:12,data:Math.floor(g/j)}],x=["type","type"],NI=!1,rI=[0,R.length-1];for(let LI=0;LI<R.length-2;LI++)NI=NI||R[LI+1]!==1,rI.push(LI+1);NI=NI&&R[R.length-1]!==1;let oI=NI?c.compute(Hb(c.inputs[0],rI),{inputs:[c.inputs[0]],outputs:[-1]})[0]:c.inputs[0].reshape(Array.from({length:R.length},(LI,EI)=>R[rI[EI]])),XI=gt(c,oI,Z[1],Z[2],v,M,g,Y.epsilon),xI=LI=>{let EI=kG(Z[0].dataType),MI=j===1?"vec2f":`mat${j}x2f`,SI=cl=>{let pl=cl===0?"x":"y",Xl=j===1?"f32":`vec${j}f`;switch(j){case 1:return`${EI}(${Xl}(scale.${pl}))`;case 2:return`vec2<${EI}>(${Xl}(scale[0].${pl}, scale[1].${pl}))`;case 4:return`vec4<${EI}>(${Xl}(scale[0].${pl}, scale[1].${pl}, scale[2].${pl}, scale[3].${pl}))`;default:throw new Error(`Not supported compoents ${j}`)}},qI=tl("input",Z[0].dataType,Z[0].dims,j),ll=Ul("output",Z[0].dataType,i,j);return`
  @group(0) @binding(0) var<storage, read> input : array<${qI.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${MI}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${ll.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${LI.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${SI(0)}, ${SI(1)});
  }`};c.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${j}`,inputDependencies:x},getRunData:()=>({outputs:[{dims:i,dataType:Z[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:mI}),getShaderSource:xI},{inputs:[Z[0],XI]})},js=(c,Z)=>{Z.format==="NHWC"?Os(c,c.inputs,Z):Jt(c,c.inputs,Z)}}),Ts,fs,Ct,bV=n(()=>{"use strict";Sl(),Kl(),aG(),Ts=c=>{if(!c||c.length<2)throw new Error("layerNorm requires at least 2 inputs.")},fs=(c,Z,Y)=>{let R=Z.simplified,i=c[0].dims,v=c[1],g=!R&&c[2],M=i,j=dl.normalizeAxis(Z.axis,i.length),f=dl.sizeToDimension(i,j),mI=dl.sizeFromDimension(i,j),x=dl.size(v.dims),NI=g?dl.size(g.dims):0;if(x!==mI||g&&NI!==mI)throw new Error(`Size of X.shape()[axis:] == ${mI}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${x} and bias size of ${NI}`);let rI=[];for(let qI=0;qI<i.length;++qI)qI<j?rI.push(i[qI]):rI.push(1);let oI=ZG(mI),XI=["type","type"],xI=[{type:12,data:f},{type:1,data:mI},{type:12,data:Math.floor(mI/oI)},{type:1,data:Z.epsilon}];g&&XI.push("type");let LI=Y>1,EI=Y>2,MI=qI=>{let ll=kG(c[0].dataType),cl=[tl("x",c[0].dataType,c[0].dims,oI),tl("scale",v.dataType,v.dims,oI)];g&&cl.push(tl("bias",g.dataType,g.dims,oI)),cl.push(Ul("output",c[0].dataType,M,oI)),LI&&cl.push(Ul("mean_data_output",1,rI)),EI&&cl.push(Ul("inv_std_output",1,rI));let pl=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${qI.registerUniforms(pl).declareVariables(...cl)}
  ${qI.mainStart()}
    ${qI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${Rc("f32",oI)};
    var mean_square_vector = ${Rc("f32",oI)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${mc(ll,oI,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${gc("mean_vector",oI)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${gc("mean_square_vector",oI)} / uniforms.norm_size ${R?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${mc(ll,oI,"x[j + offset]")};
      let f32scale = ${mc(ll,oI,"scale[j]")};
      output[j + offset] = ${cl[0].type.value}((f32input ${R?"":"- mean"}) * inv_std_dev * f32scale
        ${g?`+ ${mc(ll,oI,"bias[j]")}`:""}
      );
    }

    ${LI?"mean_data_output[global_idx] = mean":""};
    ${EI?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},SI=[{dims:M,dataType:c[0].dataType}];return LI&&SI.push({dims:rI,dataType:1}),EI&&SI.push({dims:rI,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${oI};${Y};${R}`,inputDependencies:XI},getRunData:()=>({outputs:SI,dispatchGroup:{x:Math.ceil(f/64)},programUniforms:xI}),getShaderSource:MI}},Ct=(c,Z)=>{Ts(c.inputs),c.compute(fs(c.inputs,Z,c.outputCount))}}),Ss,Ds,dV=n(()=>{"use strict";Kl(),_e(),dt(),Ss=c=>{if(!c||c.length!==2)throw new Error("MatMul requires 2 inputs.");if(c[0].dims[c[0].dims.length-1]!==c[1].dims[c[1].dims.length-2])throw new Error("shared dimension does not match.")},Ds=c=>{Ss(c.inputs);let Z=_c.calcShape(c.inputs[0].dims,c.inputs[1].dims,!0);if(!Z)throw new Error("Can't use matmul on the given tensors");let Y=Z[Z.length-1],R=c.inputs[0].dims[c.inputs[0].dims.length-1];if(Y<8&&R<8)c.compute(lt(c.inputs,{activation:""},Z));else{let i=Z[Z.length-2],v=dl.size(c.inputs[0].dims.slice(0,-2)),g=dl.size(c.inputs[1].dims.slice(0,-2));if(v!==1&&i===1&&g===1){let M=c.inputs[0].reshape([1,v,R]),j=c.inputs[1].reshape([1,R,Y]),f=[1,v,Y],mI=[M,j];c.compute($e(mI,{activation:""},Z,f),{inputs:mI})}else c.compute($e(c.inputs,{activation:""},Z))}}}),qs,_s,Ps,$s,IY,lY=n(()=>{"use strict";Sl(),Kl(),vG(),aG(),qs=(c,Z)=>{if(c.length<3||c.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let Y=c[0],R=Y.dims.length;if(Y.dims[R-1]!==Z.k)throw new Error("The last dim of input shape does not match the k value");let i=Math.floor((Z.k+Z.blockSize-1)/Z.blockSize),v=Z.blockSize/8*Z.bits,g=c[1];if(!dl.areEqual(g.dims,[Z.n,i,v]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let M=c[2].dims;if(dl.size(M)!==Z.n*i)throw new Error("scales input size error.");if(c.length===4){let j=c[3].dims,f=Z.bits>4?Z.n*i:Z.n*Math.floor((i+1)/2);if(dl.size(j)!==f)throw new Error("zeroPoints input size error.")}},_s=(c,Z)=>{let Y=c[0].dims,R=Y.length,i=Y[R-2],v=Z.k,g=Z.n,M=Y.slice(0,R-2),j=dl.size(M),f=c[1].dims[2]/4,mI=c[0].dataType,x=ZG(Z.k),NI=ZG(f),rI=ZG(g),oI=M.concat([i,g]),XI=i>1&&g/rI%2===0?2:1,xI=dl.size(oI)/rI/XI,LI=64,EI=[],MI=[j,i,v/x],SI=dl.convertShape(c[1].dims).slice();SI.splice(-1,1,f/NI),EI.push(...gl(MI)),EI.push(...gl(SI)),EI.push(...gl(c[2].dims)),c.length===4&&EI.push(...gl(dl.convertShape(c[3].dims)));let qI=[j,i,g/rI];EI.push(...gl(qI));let ll=cl=>{let pl=MI.length,Xl=tl("a",c[0].dataType,pl,x),kl=tl("b",12,SI.length,NI),xl=tl("scales",c[2].dataType,c[2].dims.length),bG=[Xl,kl,xl],il=c.length===4?tl("zero_points",12,c[3].dims.length):void 0;il&&bG.push(il);let VG=qI.length,GG=Ul("output",c[0].dataType,VG,rI),Bl=kG(c[0].dataType),QG=(()=>{switch(x){case 1:return`array<${Bl}, 8>`;case 2:return`mat4x2<${Bl}>`;case 4:return`mat2x4<${Bl}>`;default:throw new Error(`${x}-component is not supported.`)}})(),mG=()=>{let Rl=`
          // reuse a data
            var input_offset = ${Xl.indicesToOffset(`${Xl.type.indices}(batch, row, word_offset)`)};
            var a_data: ${QG};
            for (var j: u32 = 0; j < ${8/x}; j++) {
              a_data[j] = ${Xl.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let Al=0;Al<rI*XI;Al++)Rl+=`
            b_value = ${NI===1?`b${Al}_data`:`b${Al}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${QG}(${Array.from({length:4},(BG,ec)=>`${Bl}(b_value_lower[${ec}]), ${Bl}(b_value_upper[${ec}])`).join(", ")});
            b_dequantized_values = ${x===1?`${QG}(${Array.from({length:8},(BG,ec)=>`(b_quantized_values[${ec}] - ${il?`zero_point${Al}`:"zero_point"}) * scale${Al}`).join(", ")});`:`(b_quantized_values - ${QG}(${Array(8).fill(`${il?`zero_point${Al}`:"zero_point"}`).join(",")})) * scale${Al};`};
            workgroup_shared[local_id.x * ${XI} + ${Math.floor(Al/rI)}]${rI>1?`[${Al%rI}]`:""} += ${Array.from({length:8/x},(BG,ec)=>`${x===1?`a_data[${ec}] * b_dequantized_values[${ec}]`:`dot(a_data[${ec}], b_dequantized_values[${ec}])`}`).join(" + ")};
          `;return Rl},cG=()=>{let Rl=`
            var col_index = col * ${rI};
            ${il?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${Bl}(8);`}
            `;for(let Al=0;Al<rI*XI;Al++)Rl+=`
            let scale${Al} = ${xl.getByOffset("col_index * nBlocksPerCol + block")};
            ${il?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${il.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${Al} = ${Bl}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return Rl},pc=()=>{let Rl=`col_index = col * ${rI};`;for(let Al=0;Al<rI*XI;Al++)Rl+=`
            let b${Al}_data = ${kl.getByIndices(`${kl.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return Rl+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${QG};
            var b_dequantized_values: ${QG};`,Rl};return`
        var<workgroup> workgroup_shared: array<${GG.type.value}, ${XI*LI}>;
        ${cl.declareVariables(...bG,GG)}
        ${cl.mainStart([LI,1,1])}
          let output_indices = ${GG.offsetToIndices(`(global_idx / ${LI}) * ${XI}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${LI}) {
            //process one block
            var word_offset: u32 = block * ${Z.blockSize/x};
            ${cG()}
            for (var word: u32 = 0; word < ${f}; word += ${NI}) {
              ${pc()}
              for (var i: u32 = 0; i < ${NI}; i++) {
                ${mG()}
                word_offset += ${8/x};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${XI}) {
            var output_value: ${GG.type.value} = ${GG.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${LI}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${XI};
            }
            ${GG.setByIndices(`${GG.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${Z.blockSize};${Z.bits};${x};${NI};${rI};${XI};${LI}`,inputDependencies:Array(c.length).fill("rank")},getRunData:()=>({outputs:[{dims:oI,dataType:mI}],dispatchGroup:{x:xI},programUniforms:EI}),getShaderSource:ll}},Ps=(c,Z)=>{let Y=c[0].dims,R=Y.length,i=Y[R-2],v=Z.k,g=Z.n,M=Y.slice(0,R-2),j=dl.size(M),f=c[1].dims[2]/4,mI=c[0].dataType,x=ZG(Z.k),NI=ZG(f),rI=M.concat([i,g]),oI=128,XI=g%8===0?8:g%4===0?4:1,xI=oI/XI,LI=xI*NI*8,EI=LI/x,MI=LI/Z.blockSize,SI=dl.size(rI)/XI,qI=[],ll=[j,i,v/x],cl=dl.convertShape(c[1].dims).slice();cl.splice(-1,1,f/NI),qI.push(...gl(ll)),qI.push(...gl(cl)),qI.push(...gl(c[2].dims)),c.length===4&&qI.push(...gl(dl.convertShape(c[3].dims)));let pl=[j,i,g];qI.push(...gl(pl));let Xl=kl=>{let xl=ll.length,bG=tl("a",c[0].dataType,xl,x),il=tl("b",12,cl.length,NI),VG=tl("scales",c[2].dataType,c[2].dims.length),GG=[bG,il,VG],Bl=c.length===4?tl("zero_points",12,c[3].dims.length):void 0;Bl&&GG.push(Bl);let QG=pl.length,mG=Ul("output",c[0].dataType,QG),cG=kG(c[0].dataType),pc=()=>{switch(x){case 1:return`
          let a_data0 = vec4<${cG}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${cG}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${cG}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${cG}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${x}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${bG.type.value}, ${EI}>;
        var<workgroup> inter_results: array<array<${mG.type.value}, ${xI}>, ${XI}>;
        ${kl.declareVariables(...GG,mG)}
        ${kl.mainStart([xI,XI,1])}
          let output_indices = ${mG.offsetToIndices(`workgroup_index * ${XI}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${MI} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${EI};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${EI}; a_offset += ${oI})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${bG.getByIndices(`${bG.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${bG.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${MI} + local_id.x;
            ${Bl?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${Bl.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${cG}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${cG}(8);`}
            let scale = ${VG.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${il.getByIndices(`${il.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${Z.blockSize/x};
            for (var i: u32 = 0; i < ${NI}; i++) {
              ${pc()}
              let b_value = ${NI===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${cG}>(${Array.from({length:4},(Rl,Al)=>`${cG}(b_value_lower[${Al}]), ${cG}(b_value_upper[${Al}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${cG}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(Rl,Al)=>`${`dot(a_data${Al}, b_dequantized_values[${Al}])`}`).join(" + ")};
              word_offset += ${8/x};
            }
            workgroupBarrier();
          }

          if (local_idx < ${XI}) {
            var output_value: ${mG.type.value} = ${mG.type.value}(0);
            for (var b = 0u; b < ${xI}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${mG.setByIndices(`${mG.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${Z.blockSize};${x};${NI};${xI};${XI}`,inputDependencies:Array(c.length).fill("rank")},getRunData:()=>({outputs:[{dims:rI,dataType:mI}],dispatchGroup:{x:SI},programUniforms:qI}),getShaderSource:Xl}},$s=(c,Z)=>{qs(c.inputs,Z),Z.blockSize===32&&c.adapterInfo.isVendor("intel")&&c.adapterInfo.isArchitecture("gen-12lp")?c.compute(Ps(c.inputs,Z)):c.compute(_s(c.inputs,Z))},IY=c=>lG(c)}),GY,cY,At,bY,dY,jG,ZV,eV,aV,ZY=n(()=>{"use strict";Sl(),Kl(),aG(),GY=c=>{if(!c||c.length<1)throw new Error("Too few inputs");if(c[0].dataType!==1&&c[0].dataType!==10)throw new Error("Input type must be float or float16.");if(c.length>=2){let Z=c[0].dims.length*2===c[1].dims[0];if(c.length===4&&(Z=c[3].dims[0]*2===c[1].dims[0]),!Z)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},cY=(c,Z,Y)=>{let R="";for(let i=Z-1;i>=0;--i)R+=`
            k = i32(${c.indicesGet("indices",i)}) - ${Ll("uniforms.pads",i,Y)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${Ll("uniforms.x_shape",i,Z)})) {
              break;
            }
            offset += k * i32(${Ll("uniforms.x_strides",i,Z)});
        `;return`
          value = ${c.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${R}
            value = x[offset];
          }
      `},At=(c,Z,Y)=>{let R="";for(let i=Z-1;i>=0;--i)R+=`
                k = i32(${c.indicesGet("indices",i)}) - ${Ll("uniforms.pads",i,Y)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${Ll("uniforms.x_shape",i,Z)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${Ll("uniforms.x_shape",i,Z)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${Ll("uniforms.x_strides",i,Z)});
            `;return`
              var offset = 0;
              var k = 0;
              ${R}
              value = x[offset];
          `},bY=(c,Z,Y)=>{let R="";for(let i=Z-1;i>=0;--i)R+=`
                k = i32(${c.indicesGet("indices",i)}) - ${Ll("uniforms.pads",i,Y)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${Ll("uniforms.x_shape",i,Z)})) {
                  k = i32(${Ll("uniforms.x_shape",i,Z)}) - 1;
                }
                offset += k * i32(${Ll("uniforms.x_strides",i,Z)});
            `;return`
              var offset = 0;
              var k = 0;
              ${R}
              value = x[offset];
          `},dY=(c,Z,Y)=>{let R="";for(let i=Z-1;i>=0;--i)R+=`
                k = i32(${c.indicesGet("indices",i)}) - ${Ll("uniforms.pads",i,Y)};
                if (k < 0)  {
                  k += i32(${Ll("uniforms.x_shape",i,Z)}]);
                }
                if (k >= i32(${Ll("uniforms.x_shape",i,Z)})) {
                  k -= i32(${Ll("uniforms.x_shape",i,Z)});
                }
                offset += k * i32(${Ll("uniforms.x_strides",i,Z)});
            `;return`
              var offset = 0;
              var k = 0;
              ${R}
              value = x[offset];
          `},jG=(c,Z,Y)=>{switch(Y.mode){case 0:return cY(c,Z,Y.pads.length);case 1:return At(c,Z,Y.pads.length);case 2:return bY(c,Z,Y.pads.length);case 3:return dY(c,Z,Y.pads.length);default:throw new Error("Invalid mode")}},ZV=(c,Z)=>{let Y=dl.padShape(c[0].dims.slice(),Z.pads),R=c[0].dims,i=dl.size(Y),v=[{type:12,data:i},{type:6,data:Z.pads}],g=c.length>=3&&c[2].data;Z.mode===0&&v.push({type:g?c[2].dataType:1,data:Z.value}),v.push(...gl(c[0].dims,Y));let M=["rank"],j=f=>{let mI=Ul("output",c[0].dataType,Y.length),x=tl("x",c[0].dataType,R.length),NI=x.type.value,rI=jG(mI,R.length,Z),oI=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:Z.pads.length}];return Z.mode===0&&oI.push({name:"constant_value",type:g?NI:"f32"}),`
            ${f.registerUniforms(oI).declareVariables(x,mI)}
            ${f.mainStart()}
            ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${mI.offsetToIndices("global_idx")};

            var value = ${NI}(0);
            ${rI}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${Z.mode}${g}`,inputDependencies:M},getRunData:()=>({outputs:[{dims:Y,dataType:c[0].dataType}],dispatchGroup:{x:Math.ceil(dl.size(Y)/64)},programUniforms:v}),getShaderSource:j}},eV=(c,Z)=>{if(c.length>1){let Y=c[1].getBigInt64Array(),R=c.length>=3&&c[2].data?c[2].dataType===10?c[2].getUint16Array()[0]:c[2].getFloat32Array()[0]:0,i=c[0].dims.length,v=new Int32Array(2*i).fill(0);if(c.length>=4){let M=c[3].getBigInt64Array();for(let j=0;j<M.length;j++)v[Number(M[j])]=Number(Y[j]),v[Number(M[j])+i]=Number(Y[j+M.length])}else Y.forEach((M,j)=>v[Number(j)]=Number(M));let g=[];return v.forEach(M=>g.push(M)),{mode:Z.mode,value:R,pads:g}}else return Z},aV=(c,Z)=>{GY(c.inputs);let Y=eV(c.inputs,Z);c.compute(ZV(c.inputs,Y),{inputs:[0]})}}),ae,Lt,kt,xt,ma,zt,WV,Ut,Mt,Bt,tV,eY,aY,WY,Ot,tY,nY,mY,NY,nV=n(()=>{"use strict";OI(),Sl(),Kl(),aG(),ae=c=>{if(C.webgpu.validateInputContent&&(!c||c.length!==1))throw new Error("Pool ops requires 1 input.")},Lt=(c,Z,Y)=>{let R=Z.format==="NHWC",i=c.dims.slice();R&&i.splice(1,0,i.pop());let v=Object.hasOwnProperty.call(Z,"dilations"),g=Z.kernelShape.slice(),M=Z.strides.slice(),j=v?Z.dilations.slice():[],f=Z.pads.slice();Tc.adjustPoolAttributes(Y,i,g,M,j,f);let mI=Tc.computePoolOutputShape(Y,i,M,j,g,f,Z.autoPad),x=Object.assign({},Z);v?Object.assign(x,{kernelShape:g,strides:M,pads:f,dilations:j,cacheKey:Z.cacheKey}):Object.assign(x,{kernelShape:g,strides:M,pads:f,cacheKey:Z.cacheKey});let NI=mI.slice();return NI.push(NI.splice(1,1)[0]),[x,R?NI:mI]},kt=(c,Z)=>{let Y=Z.format==="NHWC",R=dl.size(c),i=dl.size(Z.kernelShape),v=[{type:12,data:R},{type:12,data:i}],g=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(Z.kernelShape.length<=2){let M=Z.kernelShape[Z.kernelShape.length-1],j=Z.strides[Z.strides.length-1],f=Z.pads[Z.pads.length/2-1],mI=Z.pads[Z.pads.length-1],x=!!(f+mI);v.push({type:12,data:M},{type:12,data:j},{type:12,data:f},{type:12,data:mI}),g.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let NI=!1;if(Z.kernelShape.length===2){let rI=Z.kernelShape[Z.kernelShape.length-2],oI=Z.strides[Z.strides.length-2],XI=Z.pads[Z.pads.length/2-2],xI=Z.pads[Z.pads.length-2];NI=!!(XI+xI),v.push({type:12,data:rI},{type:12,data:oI},{type:12,data:XI},{type:12,data:xI}),g.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[v,g,!0,x,NI]}else{if(Y)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let M=dl.computeStrides(Z.kernelShape);v.push({type:12,data:M},{type:12,data:Z.pads},{type:12,data:Z.strides}),g.push({name:"kernelStrides",type:"u32",length:M.length},{name:"pads",type:"u32",length:Z.pads.length},{name:"strides",type:"u32",length:Z.strides.length});let j=Z.pads.reduce((f,mI)=>f+mI);return[v,g,!!j,!1,!1]}},xt=(c,Z,Y,R,i,v,g,M,j,f,mI,x)=>{let NI=i.format==="NHWC",rI=Z.type.value,oI=Ul("output",Z.type.tensor,R);if(i.kernelShape.length<=2){let XI="",xI="",LI="",EI=Y-(NI?2:1);if(mI?XI=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${EI}] = indices[${EI}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${EI}] < 0 || xIndices[${EI}]
                      >= uniforms.x_shape[${EI}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${Z.indicesToOffset("xIndices")}];
                  ${v}
                }`:XI=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${EI}] = indices[${EI}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${Z.indicesToOffset("xIndices")}];
                  ${v}
                }`,i.kernelShape.length===2){let MI=Y-(NI?3:2);x?xI=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${MI}] = indices[${MI}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${MI}] < 0 || xIndices[${MI}] >= uniforms.x_shape[${MI}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:xI=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${MI}] = indices[${MI}] * uniforms.sh - uniforms.phStart + j;
                `,LI=`
              }
            `}return`
            ${c.registerUniforms(j).declareVariables(Z,oI)}

            ${c.mainStart()}
              ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${oI.offsetToIndices("global_idx")};
              var xIndices = ${oI.offsetToIndices("global_idx")};

              var value = ${rI}(${M});
              var pad = 0;
              ${xI}
              ${XI}
              ${LI}
              ${g}

              output[global_idx] = value;
            }`}else{if(NI)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let XI=i.kernelShape.length,xI=i.pads.length,LI="";return f?LI=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${Z.indicesToOffset("xIndices")}];
                ${v}
              }`:LI=`
              }
              let x_val = x[${Z.indicesToOffset("xIndices")}];
              ${v}
            `,`
            ${c.registerUniforms(j).declareVariables(Z,oI)}

            ${c.mainStart()}
              ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${oI.offsetToIndices("global_idx")};
              var xIndices = ${oI.offsetToIndices("global_idx")};

              var offsets: array<u32, ${XI}>;

              var value = ${rI}(${M});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${XI-1}u; j++) {
                  offsets[j] = offset / ${Ll("uniforms.kernelStrides","j",XI)};
                  offset -= offsets[j] * ${Ll("uniforms.kernelStrides","j",XI)};
                }
                offsets[${XI-1}] = offset;

                isPad = false;
                for (var j = ${Y-XI}u; j < ${Y}u; j++) {
                  xIndices[j] = indices[j] * ${Ll("uniforms.strides",`j - ${Y-XI}u`,XI)}
                    + offsets[j - ${Y-XI}u] - ${Ll("uniforms.pads","j - 2u",xI)};
                  ${LI}
              }
              ${g}

              output[global_idx] = value;
            }`}},ma=c=>`${c.format};${c.ceilMode};${c.autoPad};${c.kernelShape.length}`,zt=c=>`${ma(c)};${c.countIncludePad}`,WV=c=>`${ma(c)};${c.storageOrder};${c.dilations}`,Ut=c=>({format:c.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][c.auto_pad],ceilMode:c.ceil_mode,kernelShape:c.kernel_shape,strides:c.strides,pads:c.pads}),Mt=(c,Z,Y,R)=>{let[i,v]=Lt(Z,R,Y),g=tl("x",Z.dataType,Z.dims.length),M=g.type.value,j="value += x_val;",f="";i.countIncludePad?f+=`value /= ${M}(uniforms.kernelSize);`:f+=`value /= ${M}(i32(uniforms.kernelSize) - pad);`;let[mI,x,NI,rI,oI]=kt(v,i);mI.push(...gl(Z.dims,v));let XI=["rank"];return{name:c,shaderCache:{hint:`${R.cacheKey};${NI};${rI};${oI}`,inputDependencies:XI},getRunData:()=>({outputs:[{dims:v,dataType:Z.dataType}],dispatchGroup:{x:Math.ceil(dl.size(v)/64)},programUniforms:mI}),getShaderSource:xI=>xt(xI,g,Z.dims.length,v.length,i,j,f,0,x,NI,rI,oI)}},Bt=c=>{let Z=c.count_include_pad!==0,Y=Ut(c);if(Y.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let R={countIncludePad:Z,...Y,cacheKey:""};return{...R,cacheKey:zt(R)}},tV=(c,Z)=>{ae(c.inputs),c.compute(Mt("AveragePool",c.inputs[0],!1,Z))},eY={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},aY=c=>{let Z=c.format;return{format:Z,...eY,cacheKey:Z}},WY=(c,Z)=>{ae(c.inputs),c.compute(Mt("GlobalAveragePool",c.inputs[0],!0,Z))},Ot=(c,Z,Y,R)=>{let[i,v]=Lt(Z,R,Y),g=`
      value = max(x_val, value);
    `,M="",j=tl("x",Z.dataType,Z.dims.length),f=["rank"],[mI,x,NI,rI,oI]=kt(v,i);return mI.push(...gl(Z.dims,v)),{name:c,shaderCache:{hint:`${R.cacheKey};${NI};${rI};${oI}`,inputDependencies:f},getRunData:()=>({outputs:[{dims:v,dataType:Z.dataType}],dispatchGroup:{x:Math.ceil(dl.size(v)/64)},programUniforms:mI}),getShaderSource:XI=>xt(XI,j,Z.dims.length,v.length,i,g,M,Z.dataType===10?-65504:-1e5,x,NI,rI,oI)}},tY=(c,Z)=>{ae(c.inputs),c.compute(Ot("MaxPool",c.inputs[0],!1,Z))},nY=c=>{let Z=c.storage_order,Y=c.dilations,R=Ut(c);if(Z!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(R.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let i={storageOrder:Z,dilations:Y,...R,cacheKey:""};return{...i,cacheKey:WV(i)}},mY=c=>{let Z=c.format;return{format:Z,...eY,cacheKey:Z}},NY=(c,Z)=>{ae(c.inputs),c.compute(Ot("GlobalMaxPool",c.inputs[0],!0,Z))}}),sY,YY,hY,VY,s2=n(()=>{"use strict";Sl(),Kl(),vG(),aG(),sY=(c,Z)=>{if(c.length<2||c.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(c.length===3&&c[1].dims===c[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(c.length===3&&c[0].dataType!==c[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(c[0].dataType===6&&c.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(c[1].dims.length!==0&&c[1].dims.length!==1&&c[1].dims.length!==c[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(c.length>2){if(c[0].dataType!==c[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(c[1].dims.length!==c[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!c[1].dims.map((Y,R)=>Y===c[2].dims[R]).reduce((Y,R)=>Y&&R,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(Z.blockSize>0){if(c[1].dims.length===0||c[1].dims.length===1&&c[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!c[1].dims.map((i,v)=>v===Z.axis||i===c[0].dims[v]).reduce((i,v)=>i&&v,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(c[1].dims.length!==c[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let Y=c[0].dims[Z.axis],R=c[1].dims[Z.axis];if(Z.blockSize<Math.ceil(Y/R)||Z.blockSize>Math.ceil(Y/(R-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},YY=(c,Z)=>{let Y=dl.normalizeAxis(Z.axis,c[0].dims.length),R=c[0].dataType,i=R===3,v=c[0].dims,g=c[1].dataType,M=dl.size(v),j=R===3||R===2,f=j?[Math.ceil(dl.size(c[0].dims)/4)]:c[0].dims,mI=c[1].dims,x=c.length>2?c[2]:void 0,NI=x?j?[Math.ceil(dl.size(x.dims)/4)]:x.dims:void 0,rI=mI.length===0||mI.length===1&&mI[0]===1,oI=rI===!1&&mI.length===1,XI=ZG(M),xI=rI&&(!j||XI===4),LI=xI?XI:1,EI=xI&&!j?XI:1,MI=tl("input",j?12:R,f.length,EI),SI=tl("scale",g,mI.length),qI=x?tl("zero_point",j?12:R,NI.length):void 0,ll=Ul("output",g,v.length,LI),cl=[MI,SI];qI&&cl.push(qI);let pl=[f,mI];x&&pl.push(NI);let Xl=[{type:12,data:M/LI},{type:12,data:Y},{type:12,data:Z.blockSize},...gl(...pl,v)],kl=xl=>{let bG=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${xl.registerUniforms(bG).declareVariables(...cl,ll)}
      ${xl.mainStart()}
          ${xl.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${ll.offsetToIndices("global_idx")};

          // Set input x
          ${j?`
            let input = ${MI.getByOffset("global_idx / 4")};
            let x_vec = ${i?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${LI===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${MI.getByOffset("global_idx")};`};

          // Set scale input
          ${rI?`let scale_value= ${SI.getByOffset("0")}`:oI?`
            let scale_index = ${ll.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${SI.getByOffset("scale_index")};`:`
            var scale_indices: ${SI.type.indices} = output_indices;
            let index = ${SI.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${SI.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${SI.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${qI?rI?j?`
                let zero_point_input = ${qI.getByOffset("0")};
                let zero_point_vec =  ${i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${qI.getByOffset("0")}`:oI?j?`
                let zero_point_index = ${ll.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${qI.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${ll.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${qI.getByOffset("zero_point_index")};`:j?`
                let zero_point_offset = ${SI.indicesToOffset("scale_indices")};
                let zero_point_input = ${qI.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${qI.getByIndices("scale_indices")};`:`let zero_point_value = ${j?i?"i32":"u32":MI.type.value}(0);`};
      // Compute and write output
      ${ll.setByOffset("global_idx",`${ll.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:Z.cacheKey,inputDependencies:qI?["rank","rank","rank"]:["rank","rank"]},getShaderSource:kl,getRunData:()=>({outputs:[{dims:v,dataType:g}],dispatchGroup:{x:Math.ceil(M/LI/64),y:1,z:1},programUniforms:Xl})}},hY=(c,Z)=>{sY(c.inputs,Z),c.compute(YY(c.inputs,Z))},VY=c=>lG({axis:c.axis,blockSize:c.blockSize})}),pY,uY,RY,mV=n(()=>{"use strict";OI(),Sl(),aG(),pY=(c,Z,Y)=>{let R=c===Z,i=c<Z&&Y<0,v=c>Z&&Y>0;if(R||i||v)throw new Error("Range these inputs' contents are invalid.")},uY=(c,Z,Y,R)=>{let i=Math.abs(Math.ceil((Z-c)/Y)),v=[i],g=i,M=[{type:12,data:g},{type:R,data:c},{type:R,data:Y},...gl(v)],j=f=>{let mI=Ul("output",R,v.length),x=mI.type.value,NI=[{name:"outputSize",type:"u32"},{name:"start",type:x},{name:"delta",type:x}];return`
        ${f.registerUniforms(NI).declareVariables(mI)}
        ${f.mainStart()}
        ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${x}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${R}`},getShaderSource:j,getRunData:()=>({outputs:[{dims:v,dataType:R}],dispatchGroup:{x:Math.ceil(g/64)},programUniforms:M})}},RY=c=>{let Z=0,Y=0,R=0;c.inputs[0].dataType===6?(Z=c.inputs[0].getInt32Array()[0],Y=c.inputs[1].getInt32Array()[0],R=c.inputs[2].getInt32Array()[0]):c.inputs[0].dataType===1&&(Z=c.inputs[0].getFloat32Array()[0],Y=c.inputs[1].getFloat32Array()[0],R=c.inputs[2].getFloat32Array()[0]),C.webgpu.validateInputContent&&pY(Z,Y,R),c.compute(uY(Z,Y,R,c.inputs[0].dataType),{inputs:[]})}}),oY,FY,NV,sV,Y2=n(()=>{"use strict";Sl(),Kl(),vG(),aG(),oY=(c,Z,Y,R)=>{if(c!=="none"&&R!=="i32"&&R!=="u32"&&R!=="f32")throw new Error(`Input ${R} is not supported with reduction ${c}.`);let i=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,v=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${Z}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(c){case"none":return`${Z}=${Y};`;case"add":return R==="i32"||R==="u32"?`atomicAdd(&${Z}, bitcast<${R}>(${Y}));`:`
              ${i}bitcast<${R}>(oldValue) + (${Y})${v}`;case"max":return R==="i32"||R==="u32"?`atomicMax(&${Z}, bitcast<${R}>(${Y}));`:`
                ${i}max(bitcast<f32>(oldValue), (${Y}))${v}`;case"min":return R==="i32"||R==="u32"?`atomicMin(&${Z}, bitcast<${R}>(${Y}));`:`${i}min(bitcast<${R}>(oldValue), (${Y}))${v}`;case"mul":return`${i}(bitcast<${R}>(oldValue) * (${Y}))${v}`;default:throw new Error(`Reduction ${c} is not supported.`)}},FY=(c,Z)=>{let Y=c[0].dims,R=c[1].dims,i=Y,v=1,g=Math.ceil(dl.size(R)/v),M=R[R.length-1],j=dl.sizeFromDimension(Y,M),f=[{type:12,data:g},{type:12,data:M},{type:12,data:j},...gl(c[1].dims,c[2].dims,i)],mI=x=>{let NI=tl("indices",c[1].dataType,c[1].dims.length),rI=tl("updates",c[2].dataType,c[2].dims.length,v),oI=Z.reduction!=="none"&&Z.reduction!==""?bm("output",c[0].dataType,i.length):Ul("output",c[0].dataType,i.length,v);return`
      ${x.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(NI,rI,oI)}
      ${x.mainStart()}
        ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var data_offset = 0u;
  let indices_start = uniforms.last_index_dimension * global_idx;
  let indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${c[0].dims.length===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[i - indices_start];
    let dim_value = uniforms.output_shape[i - indices_start + uniforms.last_index_dimension];`}
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));
  }

  for (var i = 0u; i < uniforms.num_updates_elements; i++) {
    let value = updates[uniforms.num_updates_elements * global_idx + i];
    ${oY(Z.reduction,"output[data_offset + i]","value",oI.type.value)}
  }

      }`};return{name:"ScatterND",shaderCache:{hint:`${Z.cacheKey}_${Z.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:i,dataType:c[0].dataType}],dispatchGroup:{x:Math.ceil(g/64)},programUniforms:f}),getShaderSource:mI}},NV=c=>lG({reduction:c.reduction}),sV=(c,Z)=>{c.compute(FY(c.inputs,Z),{inputs:[c.inputs[1],c.inputs[2]],outputs:[]})}}),YV,hV,VV,XY,pV,uV,RV,oV,FV,XV,iV,QV,iY,HV,rV,wV,vV,EV,yV,gV,h2=n(()=>{"use strict";Sl(),Kl(),vG(),aG(),YV=(c,Z)=>{if(c.every(Y=>Y>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),c.length>0){if(Z.mode==="linear"){if(!(c.length===2||c.length===3||c.length===4&&c[0]===1&&c[1]===1||c.length===4&&c[0]===1&&c[3]===1||c.length===5&&c[0]===1&&c[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(Z.mode==="cubic"&&!(c.length===2||c.length===4&&c[0]===1&&c[1]===1||c.length===4&&c[0]===1&&c[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},hV=(c,Z,Y)=>{Z.every(i=>i>=0&&i<Y||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let R=new Array(Y).fill(1);return Z.forEach((i,v)=>R[i]=c[v]),R},VV=(c,Z,Y,R,i,v)=>{let[g,M,j]=Y>10?[1,2,3]:[-1,c.length>1?1:-1,-1],f=c[0].dims.length;if(g>0&&c.length>g&&c[g].dims.length>0)c[g].getFloat32Array().forEach(mI=>v.push(mI));else if(Z.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(M>0&&c.length>M&&c[M].dims.length===1&&c[M].dims[0]>0){if(c[M].getFloat32Array().forEach(mI=>R.push(mI)),R.length!==0&&R.length!==f&&Y>=18&&R.length!==Z.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");YV(R,Z),Z.axes.length>0&&hV(R,Z.axes,f).forEach((mI,x)=>R[x]=mI)}if(j>0&&c.length>j&&c[j].dims.length===1&&c[j].dims[0]>0&&(c[j].getBigInt64Array().forEach(mI=>i.push(Number(mI))),i.length!==0&&i.length!==f&&Y>=18&&i.length!==Z.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(Z.axes.length>0){if(R.length!==0&&R.length!==Z.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(i.length!==0&&i.length!==Z.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof R<"u"&&typeof i<"u"&&R.length>0&&i.length>f)throw new Error("Resize requires only of scales or sizes to be specified")},XY=(c,Z,Y,R)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${c}) * (${Z});
  let whole = ${R}(big / (${Y}));
  let fract = ${R}(big % (${Y})) / ${R}(${Y});
  return whole + fract;
`,pV=(c,Z)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${Z} { `+(()=>{switch(c){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${Z}(xResized) / ${Z}(xScale);
          } else {
            ${XY("xResized","lengthOriginal","lengthResized",Z)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${Z}(xResized) + 0.5) / ${Z}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${Z}(xResized) + 0.5) / ${Z}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${XY("xResized","lengthOriginal - 1","lengthResized - 1",Z)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${Z}(roiStart) * ${Z}(lengthOriginal - 1) +
                        (${Z}(xResized) * ${Z}(roiEnd - roiStart) * ${Z}(lengthOriginal - 1)) /
                        ${Z}(lengthResized - 1);
                  } else {
                    return 0.5 * ${Z}(roiStart + roiEnd) * ${Z}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${Z}xScale * ${Z}(lengthResized);
                  const adjustment = ${Z}(lengthResized) / outputWidth;
                  const center = ${Z}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${Z}(xResized) + 0.5) / ${Z}(xScale)) - 0.5;`;case"half_pixel":return`return ((${Z}(xResized) + 0.5) / ${Z}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${c} is not supported`)}})()+"}",uV=(c,Z,Y)=>`fn getNearestPixelFromOriginal(xOriginal: ${Y}, isDownSample: bool) -> ${Y} {`+(()=>{switch(c){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(Z<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${c} is not supported`)}})()+"}",RV=(c,Z,Y)=>{let R=new Array(Y).fill(0).concat(new Array(Y).fill(1)),i=c.length===0?R:c.slice();return Z.length>0?(Z.forEach((v,g)=>{R[v]=i[g],R[g+Y]=i[Z.length+g]}),R):i},oV=(c,Z,Y,R)=>{let i=[];if(Y.length>0)if(R.length>0){if(c.forEach(v=>i.push(v)),Math.max(...R)>c.length)throw new Error("axes is out of bound");R.forEach((v,g)=>i[v]=Y[g])}else Y.forEach(v=>i.push(v));else{if(Z.length===0)throw new Error("Resize requires either scales or sizes.");i=c.map((v,g)=>Math.round(v*Z[g]))}return i},FV=(c,Z,Y)=>{let R=(()=>{switch(Y.keepAspectRatioPolicy){case"not_larger":return Y.axes.length>0?Math.min(...Y.axes.map(v=>Z[v]),Number.MAX_VALUE):Math.min(...Z,Number.MAX_VALUE);case"not_smaller":return Y.axes.length>0?Math.max(...Y.axes.map(v=>Z[v]),Number.MIN_VALUE):Math.max(...Z,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${Y.keepAspectRatioPolicy} is not supported`)}})();Z.fill(1,0,Z.length);let i=c.slice();return Y.axes.length>0?(Y.axes.forEach(v=>Z[v]=R),Y.axes.forEach(v=>i[v]=Math.round(c[v]*Z[v]))):(Z.fill(R,0,Z.length),i.forEach((v,g)=>i[g]=Math.round(v*Z[g]))),i},XV=(c,Z,Y,R,i)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${c.type.indices}) -> array<${c.type.value}, ${Y.length}> {
      var original_indices: array<${c.type.value}, ${Y.length}>;
      for (var i:u32 = 0; i < ${Y.length}; i++) {
        var output_index = ${c.indicesGet("output_indices","i")};
        var scale = ${Ll("uniforms.scales","i",R)};
        var roi_low = ${Ll("uniforms.roi","i",i)};
        var roi_hi = ${Ll("uniforms.roi",`i + ${Z.length}`,i)};
        if (scale == 1.0) {
          original_indices[i] = ${c.type.value}(output_index);
        } else {
          var input_shape_i = ${Ll("uniforms.input_shape","i",Z.length)};
          var output_shape_i = ${Ll("uniforms.output_shape","i",Y.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,iV=(c,Z,Y,R,i,v,g)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${Z.type.indices}) -> ${c.type.indices} {
      var input_indices: ${c.type.indices};
      for (var i:u32 = 0; i < ${R.length}; i++) {
        var output_index = ${Z.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${Ll("uniforms.scales","i",i)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${Ll("uniforms.roi","i",v)};
          var roi_hi = ${Ll("uniforms.roi",`i + ${Y.length}`,v)};
          var input_shape_i = ${Ll("uniforms.input_shape","i",Y.length)};
          var output_shape_i = ${Ll("uniforms.output_shape","i",R.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${g} || (original_idx >= 0 && original_idx < ${Z.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${Z.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${c.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,QV=(c,Z)=>`
    fn checkInputIndices(input_indices: ${c.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${Z.length}; i++) {
        var input_index = ${c.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${Ll("uniforms.input_shape","i",Z.length)}) {
          return false;
        }
      }
      return true;
    }`,iY=(c,Z,Y,R)=>c.rank>R?`
    ${c.indicesSet("input_indices",Z,"channel")};
    ${c.indicesSet("input_indices",Y,"batch")};
`:"",HV=(c,Z,Y,R,i)=>{let[v,g,M,j]=Y.length===2?[-1,0,1,-1]:[0,2,3,1],f=c.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${f} {
      var input_indices: ${c.type.indices};
      ${c.indicesSet("input_indices",g,`max(0, min(row, ${Y[g]} - 1))`)};
      ${c.indicesSet("input_indices",M,`max(0, min(col, ${Y[M]} - 1))`)};
      ${iY(c,j,v,2)}
      return ${c.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${Z.type.indices}) -> ${f} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${f} = originalIndices[${g}];
      var col:${f} = originalIndices[${M}];
      ${R?`if (row < 0 || row > (${Y[g]} - 1) || col < 0 || col > (${Y[M]} - 1)) {
        return ${i};
      }`:""};
      row = max(0, min(row, ${Y[g]} - 1));
      col = max(0, min(col, ${Y[M]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${Y.length>2?`u32(originalIndices[${j}])`:"0"};
      var batch: u32 =  ${Y.length>2?`u32(originalIndices[${v}])`:"0"};
      var x11: ${f} = getInputValue(batch, channel, row1, col1);
      var x12: ${f} = getInputValue(batch, channel, row1, col2);
      var x21: ${f} = getInputValue(batch, channel, row2, col1);
      var x22: ${f} = getInputValue(batch, channel, row2, col2);
      var dx1: ${f} = abs(row - ${f}(row1));
      var dx2: ${f} = abs(${f}(row2) - row);
      var dy1: ${f} = abs(col - ${f}(col1));
      var dy2: ${f} = abs(${f}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},rV=(c,Z,Y,R,i,v,g,M,j,f)=>{let mI=Y.length===2,x=!0,[NI,rI]=mI?[0,1]:x?[2,3]:[1,2],oI=c.type.value,XI=xI=>{let LI=xI===NI?"row":"col";return`
      fn ${LI}CubicInterpolation(input_indices: ${c.type.indices}, output_indices: ${Z.type.indices}) -> ${oI} {
        var output_index = ${Z.indicesGet("output_indices",xI)};
        var originalIdx: ${oI} = getOriginalCoordinateFromResizedCoordinate(output_index, ${i[xI]},
        ${R[xI]}, ${Y[xI]}, ${v[xI]}, ${v[xI]} + ${Y.length});
        var fractOriginalIdx: ${oI} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${M} && (originalIdx < 0 || originalIdx > (${Y[xI]} - 1))) {
          return ${j};
        }
        var data: array<${oI}, 4> = array<${oI}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${LI}: ${oI} = originalIdx + ${oI}(i);
          if (${LI} < 0 || ${LI} >= ${Y[xI]}) {
            ${f?`coefs[i + 1] = 0.0;
                        continue;`:M?`return ${j};`:`${LI} = max(0, min(${LI}, ${Y[xI]} - 1));`};
          }
        var input_indices_copy: ${c.type.indices} = input_indices;
          ${c.indicesSet("input_indices_copy",xI,`u32(${LI})`)};
          data[i + 1] = ${xI===NI?c.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${XI(NI)};
    ${XI(rI)};
  fn getCubicInterpolationCoefs(s: ${oI}) -> array<${oI}, 4> {
    var absS = abs(s);
    var coeffs: array<${oI}, 4> = array<${oI}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${oI} = 1.0 - absS;
    var twoMinusAbsS: ${oI} = 2.0 - absS;
    var onePlusAbsS: ${oI} = 1.0 + absS;
    coeffs[0] = ((${g} * onePlusAbsS - 5 * ${g}) * onePlusAbsS + 8 * ${g}) * onePlusAbsS - 4 * ${g};
    coeffs[1] = ((${g} + 2) * absS - (${g} + 3)) * absS * absS + 1;
    coeffs[2] = ((${g} + 2) * oneMinusAbsS - (${g} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${g} * twoMinusAbsS - 5 * ${g}) * twoMinusAbsS + 8 * ${g}) * twoMinusAbsS - 4 * ${g};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${oI}, 4>, coefs: array<${oI}, 4>) -> ${oI} {
    var coefsSum: ${oI} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${Z.type.indices}) -> ${oI} {
    var input_indices: ${c.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},wV=(c,Z,Y,R,i)=>{let[v,g,M,j,f]=Y.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],mI=c.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${mI} {
      var input_indices: ${c.type.indices};
      ${c.indicesSet("input_indices",g,`max(0, min(depth, ${Y[g]} - 1))`)};
      ${c.indicesSet("input_indices",M,`max(0, min(height, ${Y[M]} - 1))`)};
      ${c.indicesSet("input_indices",j,`max(0, min(width, ${Y[j]} - 1))`)};
      ${iY(c,f,v,3)}
      return ${c.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${Z.type.indices}) -> ${mI} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${mI} = originalIndices[${g}];
      var height:${mI} = originalIndices[${M}];
      var width:${mI} = originalIndices[${j}];
      ${R?`if (depth < 0 || depth > (${Y[g]} - 1) || height < 0 || height > (${Y[M]} - 1) || width < 0 || (width > ${Y[j]} - 1)) {
      return ${i};
        }`:""};

    depth = max(0, min(depth, ${Y[g]} - 1));
      height = max(0, min(height, ${Y[M]} - 1));
      width = max(0, min(width, ${Y[j]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${Y.length>3?`u32(originalIndices[${f}])`:"0"};
      var batch: u32 =  ${Y.length>3?`u32(originalIndices[${v}])`:"0"};

      var x111: ${mI} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${mI} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${mI} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${mI} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${mI} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${mI} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${mI} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${mI} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${mI} = abs(depth - ${mI}(depth1));
      var dx2: ${mI} = abs(${mI}(depth2) - depth);
      var dy1: ${mI} = abs(height - ${mI}(height1));
      var dy2: ${mI} = abs(${mI}(height2) - height);
      var dz1: ${mI} = abs(width - ${mI}(width1));
      var dz2: ${mI} = abs(${mI}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},vV=(c,Z,Y,R,i,v)=>{let g=c.dims,M=RV(v,Z.axes,g.length),j=oV(g,R,i,Z.axes),f=R.slice();R.length===0&&(f=g.map((EI,MI)=>EI===0?1:j[MI]/EI),Z.keepAspectRatioPolicy!=="stretch"&&(j=FV(g,f,Z)));let mI=Ul("output",c.dataType,j.length),x=tl("input",c.dataType,g.length),NI=dl.size(j),rI=g.length===j.length&&g.every((EI,MI)=>EI===j[MI]),oI=Z.coordinateTransformMode==="tf_crop_and_resize",XI=Z.extrapolationValue,xI=x.type.value,LI=EI=>`
      ${rI?"":`
      ${pV(Z.coordinateTransformMode,xI)};
      ${(()=>{switch(Z.mode){case"nearest":return`
              ${QV(x,g)};
              ${uV(Z.nearestMode,Y,xI)};
              ${iV(x,mI,g,j,f.length,M.length,oI)};
              `;case"linear":return`
              ${XV(mI,g,j,f.length,M.length)};
              ${(()=>{if(g.length===2||g.length===4)return`${HV(x,mI,g,oI,XI)}`;if(g.length===3||g.length===5)return`${wV(x,mI,g,oI,XI)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(g.length===2||g.length===4)return`${rV(x,mI,g,j,f,M,Z.cubicCoeffA,oI,Z.extrapolationValue,Z.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${EI.registerUniform("output_size","u32").registerUniform("scales","f32",f.length).registerUniform("roi","f32",M.length).declareVariables(x,mI)}
      ${EI.mainStart()}
        ${EI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${rI?"output[global_idx] = input[global_idx];":`
        let output_indices = ${mI.offsetToIndices("global_idx")};
        var input_indices: ${x.type.indices};
        ${(()=>{switch(Z.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${x.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${Z.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${g.length===2||g.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${Z.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${Z.cacheKey}|${Y}|${f.length>0?Z.mode==="cubic"?f:f.length:""}|${i.length>0?i:""}|${M.length>0?M:""}|${rI}|${Z.mode==="nearest"?g.length:g}`,inputDependencies:["rank"]},getShaderSource:LI,getRunData:()=>({outputs:[{dims:j,dataType:c.dataType}],dispatchGroup:{x:Math.ceil(NI/64)},programUniforms:[{type:12,data:NI},{type:1,data:f},{type:1,data:M},...gl(g,j)]})}},EV=c=>{let Z=c.customDataBuffer;return new Uint32Array(Z,Z.byteOffset,1)[0]},yV=(c,Z)=>{let Y=[],R=[],i=[],v=EV(c);if(Z.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");VV(c.inputs,Z,v,Y,R,i),c.compute(vV(c.inputs[0],Z,v,Y,R,i),{inputs:[0]})},gV=c=>{let Z=c.antialias,Y=c.axes,R=c.coordinateTransformMode,i=c.cubicCoeffA,v=c.excludeOutside!==0,g=c.extrapolationValue,M=c.keepAspectRatioPolicy,j=c.mode,f=c.nearestMode===""?"simple":c.nearestMode;return lG({antialias:Z,axes:Y,coordinateTransformMode:R,cubicCoeffA:i,excludeOutside:v,extrapolationValue:g,keepAspectRatioPolicy:M,mode:j,nearestMode:f})}}),JV,CV,AV,V2=n(()=>{"use strict";Sl(),Kl(),vG(),aG(),JV=(c,Z)=>{let[Y,R,i,v]=c,{numHeads:g,rotaryEmbeddingDim:M}=Z;if(Y.dims.length!==3&&Y.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${Y.dims.length}`);if(!dl.areEqual(R.dims,[])&&!dl.areEqual(R.dims,[1])&&R.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${R.dims.length}`);if(i.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${i.dims.length}`);if(v.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${v.dims.length}`);if(!dl.areEqual(i.dims,v.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(M>0&&g===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let j=Y.dims[0],f=Y.dims[Y.dims.length-2],mI=i.dims[0],x=dl.sizeFromDimension(Y.dims,1)/f,NI=M===0?i.dims[1]*2:x/g;if(M>NI)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(R.dims.length===2){if(j!==R.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${R.dims[0]}`);if(f!==R.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${R.dims[1]}`)}if(NI/2!==i.dims[1]&&M/2!==i.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${i.dims[1]}`);if(f>mI)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},CV=(c,Z)=>{let{interleaved:Y,numHeads:R,rotaryEmbeddingDim:i,scale:v}=Z,g=c[0].dims[0],M=dl.sizeFromDimension(c[0].dims,1),j=c[0].dims[c[0].dims.length-2],f=M/j,mI=c[2].dims[1],x=i===0?mI*2:f/R,NI=new Array(g,j,f/x,x-mI),rI=dl.computeStrides(NI),oI=[{type:1,data:v},{type:12,data:NI},{type:12,data:rI},...c[0].dims.length===3?new Array({type:12,data:[M,f,x,1]}):[],...c[0].dims.length===4?new Array({type:12,data:[M,x,j*x,1]}):[],...gl(c[0].dims,c[1].dims,c[2].dims,c[3].dims,c[0].dims)],XI=xI=>{let LI=tl("input",c[0].dataType,c[0].dims.length),EI=tl("position_ids",c[1].dataType,c[1].dims.length),MI=tl("cos_cache",c[2].dataType,c[2].dims.length),SI=tl("sin_cache",c[3].dataType,c[3].dims.length),qI=Ul("output",c[0].dataType,c[0].dims.length);return xI.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:NI.length},{name:"global_strides",type:"u32",length:rI.length},{name:"input_output_strides",type:"u32",length:rI.length}]),`
        ${xI.declareVariables(LI,EI,MI,SI,qI)}

        ${xI.mainStart(ab)}
          let half_rotary_emb_dim = uniforms.${MI.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${xI.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${EI.broadcastedIndicesToOffset("bsnh.xy",Ul("",EI.type.tensor,2))};
            let position_id =
                u32(${EI.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${Y});
            let j = i + select(half_rotary_emb_dim, 1, ${Y});
            let re = ${LI.getByOffset("i")} * ${MI.get("position_id","bsnh[3]")} -
                ${LI.getByOffset("j")} * ${SI.get("position_id","bsnh[3]")};
            ${qI.setByOffset("i","re")}
            let im = ${LI.getByOffset("i")} * ${SI.get("position_id","bsnh[3]")} +
                ${LI.getByOffset("j")} * ${MI.get("position_id","bsnh[3]")};
            ${qI.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${qI.setByOffset("k",LI.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:lG({interleaved:Y}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:XI,getRunData:()=>({outputs:[{dims:c[0].dims,dataType:c[0].dataType}],dispatchGroup:{x:Math.ceil(dl.size(NI)/ab)},programUniforms:oI})}},AV=(c,Z)=>{JV(c.inputs,Z),c.compute(CV(c.inputs,Z))}}),LV,kV,xV,WG=n(()=>{"use strict";Sl(),Kl(),aG(),LV=c=>{if(!c||c.length<3)throw new Error("layerNorm requires at least 3 inputs.");let Z=c[0],Y=c[1],R=c[2];if(Z.dataType!==Y.dataType||Z.dataType!==R.dataType)throw new Error("All inputs must have the same data type");if(Z.dims.length!==3&&Z.dims.length!==2)throw new Error("Input must be 2D or 3D");if(Y.dims.length!==3&&Y.dims.length!==2)throw new Error("Skip must be 2D or 3D");let i=Z.dims[Z.dims.length-1],v=Z.dims[Z.dims.length-2];if(Y.dims[Y.dims.length-1]!==i)throw new Error("Skip must have the same hidden size as input");if(Y.dims[Y.dims.length-2]!==v)throw new Error("Skip must have the same sequence length as input");if(R.dims.length!==1)throw new Error("Gamma must be 1D");if(R.dims[R.dims.length-1]!==i)throw new Error("Gamma must have the same hidden size as input");if(c.length>3){let g=c[3];if(g.dims.length!==1)throw new Error("Beta must be 1D");if(g.dims[g.dims.length-1]!==i)throw new Error("Beta must have the same hidden size as input")}if(c.length>4){let g=c[4];if(g.dims.length!==1)throw new Error("Bias must be 1D");if(g.dims[g.dims.length-1]!==i)throw new Error("Bias must have the same hidden size as input")}},kV=(c,Z,Y,R)=>{let i=Z.simplified,v=c[0].dims,g=dl.size(v),M=v,j=g,f=v.slice(-1)[0],mI=R?v.slice(0,-1).concat(1):[],x=!i&&c.length>3,NI=c.length>4,rI=R&&Y>1,oI=R&&Y>2,XI=Y>3,xI=64,LI=ZG(f),EI=[{type:12,data:j},{type:12,data:LI},{type:12,data:f},{type:1,data:Z.epsilon}],MI=qI=>{let ll=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],cl=[tl("x",c[0].dataType,c[0].dims,LI),tl("skip",c[1].dataType,c[1].dims,LI),tl("gamma",c[2].dataType,c[2].dims,LI)];x&&cl.push(tl("beta",c[3].dataType,c[3].dims,LI)),NI&&cl.push(tl("bias",c[4].dataType,c[4].dims,LI)),cl.push(Ul("output",c[0].dataType,M,LI)),rI&&cl.push(Ul("mean_output",1,mI)),oI&&cl.push(Ul("inv_std_output",1,mI)),XI&&cl.push(Ul("input_skip_bias_sum",c[0].dataType,M,LI));let pl=kG(c[0].dataType),Xl=kG(1,LI);return`

      ${qI.registerUniforms(ll).declareVariables(...cl)}
      var<workgroup> sum_shared : array<${Xl}, ${xI}>;
      var<workgroup> sum_squared_shared : array<${Xl}, ${xI}>;

      ${qI.mainStart([xI,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${xI};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${xI};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${xI-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${NI?"bias[offset1d + i]":pl+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${XI?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${mc(pl,LI,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${xI};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${gc("sum",LI)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${gc("square_sum",LI)} / f32(uniforms.hidden_size) ${i?"":"- mean * mean"} + uniforms.epsilon);
        ${rI?"mean_output[global_idx] = mean;":""}
        ${oI?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${i?"":`- ${pl}(mean)`}) *
            ${pl}(inv_std_dev) * gamma[offset1d + i]
            ${x?"+ beta[offset1d + i]":""};
        }
      }`},SI=[{dims:M,dataType:c[0].dataType}];return Y>1&&SI.push({dims:mI,dataType:1}),Y>2&&SI.push({dims:mI,dataType:1}),Y>3&&SI.push({dims:v,dataType:c[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${LI};${rI};${oI};${XI}`,inputDependencies:c.map((qI,ll)=>"type")},getShaderSource:MI,getRunData:()=>({outputs:SI,dispatchGroup:{x:Math.ceil(j/f)},programUniforms:EI})}},xV=(c,Z)=>{LV(c.inputs);let Y=[0];c.outputCount>1&&Y.push(-3),c.outputCount>2&&Y.push(-3),c.outputCount>3&&Y.push(3),c.compute(kV(c.inputs,Z,c.outputCount,!1),{outputs:Y})}}),QY,hc,Bc,fc,bZ,zV,HY,rY,P=n(()=>{"use strict";Sl(),Kl(),vG(),aG(),QY=(c,Z)=>{if(!c||c.length<1)throw new Error("too few inputs");if(Z.axes.length!==0){if(Z.axes.length!==Z.starts.length||Z.axes.length!==Z.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(Z.starts.length!==Z.ends.length)throw new Error("starts and ends must have the same length");c.slice(1).forEach((Y,R)=>{if(c[R+1].dataType!==6&&c[R+1].dataType!==7)throw new Error(`Input ${R} must be an array of int32 or int64`)})},hc=(c,Z)=>{let Y=[];if(c.length>Z)if(c[Z].dataType===7)c[Z].getBigInt64Array().forEach(R=>Y.push(Number(R)));else if(c[Z].dataType===6)c[Z].getInt32Array().forEach(R=>Y.push(Number(R)));else throw new Error(`Input ${Z} must be an array of int32 or int64`);return Y},Bc=(c,Z)=>{if(c.length>1){let Y=hc(c,1),R=hc(c,2),i=hc(c,3);return i.length===0&&(i=[...Array(c[0].dims.length).keys()]),lG({starts:Y,ends:R,axes:i})}else return Z},fc=(c,Z,Y,R,i)=>{let v=c;return c<0&&(v+=Y[R[Z]]),i[Z]<0?Math.max(0,Math.min(v,Y[R[Z]]-1)):Math.max(0,Math.min(v,Y[R[Z]]))},bZ=(c,Z,Y)=>`fn calculateInputIndices(output_indices: ${Z.type.indices}) -> ${c.type.indices} {
          var input_indices: ${c.type.indices};
          var carry = 0u;
          for (var i = ${Y.length}; i >= 0; i--) {
            let input_shape_i = ${Ll("uniforms.input_shape","i",Y.length)};
            let steps_i = ${Ll("uniforms.steps","i",Y.length)};
            let signs_i = ${Ll("uniforms.signs","i",Y.length)};
            let starts_i = ${Ll("uniforms.starts","i",Y.length)};
            var output_index = ${Z.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${c.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,zV=(c,Z)=>{let Y=c[0].dims,R=dl.size(Y),i=Z.axes.length>0?dl.normalizeAxes(Z.axes,Y.length):[...Array(Y.length).keys()],v=hc(c,4);v.forEach(LI=>LI!==0||(()=>{throw new Error("step cannot be 0")})),v.length===0&&(v=Array(i.length).fill(1));let g=Z.starts.map((LI,EI)=>fc(LI,EI,Y,i,v)),M=Z.ends.map((LI,EI)=>fc(LI,EI,Y,i,v));if(i.length!==g.length||i.length!==M.length)throw new Error("start, ends and axes should have the same number of elements");if(i.length!==Y.length)for(let LI=0;LI<Y.length;++LI)i.includes(LI)||(g.splice(LI,0,0),M.splice(LI,0,Y[LI]),v.splice(LI,0,1));let j=v.map(LI=>Math.sign(LI));v.forEach((LI,EI,MI)=>{if(LI<0){let SI=(M[EI]-g[EI])/LI,qI=g[EI],ll=qI+SI*v[EI];g[EI]=ll,M[EI]=qI,MI[EI]=-LI}});let f=Y.slice(0);i.forEach((LI,EI)=>{f[LI]=Math.ceil((M[LI]-g[LI])/v[LI])});let mI={dims:f,dataType:c[0].dataType},x=Ul("output",c[0].dataType,f.length),NI=tl("input",c[0].dataType,c[0].dims.length),rI=dl.size(f),oI=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:g.length},{name:"signs",type:"i32",length:j.length},{name:"steps",type:"u32",length:v.length}],XI=[{type:12,data:rI},{type:12,data:g},{type:6,data:j},{type:12,data:v},...gl(c[0].dims,f)],xI=LI=>`
      ${LI.registerUniforms(oI).declareVariables(NI,x)}
        ${bZ(NI,x,Y)}
        ${LI.mainStart()}
          ${LI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${x.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${x.setByOffset("global_idx",NI.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${j.length}_${g.length}_${v.length}`,inputDependencies:["rank"]},getShaderSource:xI,getRunData:()=>({outputs:[mI],dispatchGroup:{x:Math.ceil(R/64)},programUniforms:XI})}},HY=(c,Z)=>{QY(c.inputs,Z);let Y=Bc(c.inputs,Z);c.compute(zV(c.inputs,Y),{inputs:[0]})},rY=c=>{let Z=c.starts,Y=c.ends,R=c.axes;return lG({starts:Z,ends:Y,axes:R})}}),_,CI,_I,Gl,Zl=n(()=>{"use strict";Sl(),Kl(),vG(),Cd(),aG(),_=c=>{if(!c||c.length!==1)throw new Error("Softmax op requires 1 input.")},CI=(c,Z)=>{let Y=c.inputs[0],R=Y.dims,i=dl.size(R),v=R.length,g=dl.normalizeAxis(Z.axis,v),M=g<R.length-1,j,f=[];M?(f=Array.from({length:v},(cl,pl)=>pl),f[g]=v-1,f[v-1]=g,j=c.compute(Hb(Y,f),{inputs:[Y],outputs:[-1]})[0]):j=Y;let mI=j.dims,x=mI[v-1],NI=i/x,rI=ZG(x),oI=x/rI,XI=64;NI===1&&(XI=256);let xI=(cl,pl)=>pl===4?`max(max(${cl}.x, ${cl}.y), max(${cl}.z, ${cl}.w))`:pl===2?`max(${cl}.x, ${cl}.y)`:pl===3?`max(max(${cl}.x, ${cl}.y), ${cl}.z)`:cl,LI=tl("x",j.dataType,j.dims,rI),EI=Ul("result",j.dataType,j.dims,rI),MI=LI.type.value,SI=kG(j.dataType)==="f32"?`var threadMax = ${MI}(-3.402823e+38f);`:`var threadMax = ${MI}(-65504.0h);`,qI=cl=>`
      var<workgroup> rowMaxShared : ${MI};
      var<workgroup> rowSumShared : ${MI};
      var<workgroup> threadShared : array<${MI}, ${XI}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${MI} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${MI}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${cl.registerUniform("packedCols","i32").declareVariables(LI,EI)}
      ${cl.mainStart(XI)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${XI};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${SI}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${MI}(${xI("threadShared[0]",rI)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${MI}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${MI}(${gc("threadShared[0]",rI)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          let value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          setValue(row, col, row_stride, value);
        }
      }`,ll=c.compute({name:"Softmax",shaderCache:{hint:`${rI};${XI}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:mI,dataType:j.dataType}],dispatchGroup:{x:NI},programUniforms:[{type:6,data:oI}]}),getShaderSource:qI},{inputs:[j],outputs:[M?-1:0]})[0];M&&c.compute(Hb(ll,f),{inputs:[ll]})},_I=(c,Z)=>{_(c.inputs),CI(c,Z)},Gl=c=>lG({axis:c.axis})}),hl,Vl,rl,Ml,hG,tG=n(()=>{"use strict";Sl(),Kl(),aG(),hl=c=>Array.from(c.getBigInt64Array(),Number),Vl=c=>{if(!c||c.length!==2)throw new Error("Tile requires 2 inputs.");if(c[0].dataType!==1&&c[0].dataType!==10&&c[0].dataType!==6&&c[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(c[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(c[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(hl(c[1]).length!==c[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},rl=(c,Z)=>{let Y=[];for(let R=0;R<c.length;++R)Y.push(c[R]*Z[R]);return Y},Ml=(c,Z)=>{let Y=c[0].dims,R=Z??hl(c[1]),i=rl(Y,R),v=dl.size(i),g=c[0].dataType,M=tl("input",g,Y.length),j=Ul("output",g,i.length),f=mI=>`
      const inputShape = ${M.indices(...Y)};
      ${mI.registerUniform("output_size","u32").declareVariables(M,j)}
      ${mI.mainStart()}
      ${mI.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${j.offsetToIndices("global_idx")};
      var input_indices: ${M.type.indices};
      for (var i = 0; i < ${Y.length}; i++) {
        let input_dim_i = ${M.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${j.indicesGet("output_indices","i")}  % input_dim_i;

        ${M.indicesSet("input_indices","i","input_dim_value")}
      }
      ${j.setByOffset("global_idx",M.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${R}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:i,dataType:c[0].dataType}],dispatchGroup:{x:Math.ceil(v/64)},programUniforms:[{type:12,data:v},...gl(c[0].dims,i)]}),getShaderSource:f}},hG=c=>{Vl(c.inputs),c.compute(Ml(c.inputs),{inputs:[0]})}}),ql,fl,dc,nG=n(()=>{"use strict";Sl(),Kl(),aG(),ql=(c,Z,Y,R,i)=>{let v=Ul("output_data",i,Y.length,4),g=tl("a_data",Z[1].dataType,Z[1].dims.length,4),M=tl("b_data",Z[2].dataType,Z[2].dims.length,4),j=tl("c_data",Z[0].dataType,Z[0].dims.length,4),f,mI=(x,NI,rI)=>`select(${NI}, ${x}, ${rI})`;if(!R)f=v.setByOffset("global_idx",mI(g.getByOffset("global_idx"),M.getByOffset("global_idx"),j.getByOffset("global_idx")));else{let x=(NI,rI,oI="")=>{let XI=`a_data[index_a${rI}][component_a${rI}]`,xI=`b_data[index_b${rI}][component_b${rI}]`,LI=`bool(c_data[index_c${rI}] & (0xffu << (component_c${rI} * 8)))`;return`
            let output_indices${rI} = ${v.offsetToIndices(`global_idx * 4u + ${rI}u`)};
            let offset_a${rI} = ${g.broadcastedIndicesToOffset(`output_indices${rI}`,v)};
            let offset_b${rI} = ${M.broadcastedIndicesToOffset(`output_indices${rI}`,v)};
            let offset_c${rI} = ${j.broadcastedIndicesToOffset(`output_indices${rI}`,v)};
            let index_a${rI} = offset_a${rI} / 4u;
            let index_b${rI} = offset_b${rI} / 4u;
            let index_c${rI} = offset_c${rI} / 4u;
            let component_a${rI} = offset_a${rI} % 4u;
            let component_b${rI} = offset_b${rI} % 4u;
            let component_c${rI} = offset_c${rI} % 4u;
            ${NI}[${rI}] = ${oI}(${mI(XI,xI,LI)});
          `};i===9?f=`
            var data = vec4<u32>(0);
            ${x("data",0,"u32")}
            ${x("data",1,"u32")}
            ${x("data",2,"u32")}
            ${x("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:f=`
            ${x("output_data[global_idx]",0)}
            ${x("output_data[global_idx]",1)}
            ${x("output_data[global_idx]",2)}
            ${x("output_data[global_idx]",3)}
          `}return`
        ${c.registerUniform("vec_size","u32").declareVariables(j,g,M,v)}
        ${c.mainStart()}
        ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${f}
      }`},fl=c=>{let Z=c[1].dims,Y=c[2].dims,R=c[0].dims,i=c[1].dataType,v=!(dl.areEqual(Z,Y)&&dl.areEqual(Y,R)),g=Z,M=dl.size(Z);if(v){let f=_c.calcShape(_c.calcShape(Z,Y,!1),R,!1);if(!f)throw new Error("Can't perform where op on the given tensors");g=f,M=dl.size(g)}let j=Math.ceil(M/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:f=>ql(f,c,g,v,i),getRunData:()=>({outputs:[{dims:g,dataType:i}],dispatchGroup:{x:Math.ceil(M/64/4)},programUniforms:[{type:12,data:j},...gl(R,Z,Y,g)]})}},dc=c=>{c.compute(fl(c.inputs))}}),eG,KG=n(()=>{"use strict";Jh(),rW(),Ch(),Ah(),Lh(),kh(),CN(),Mh(),Oh(),jh(),Kh(),Th(),fh(),Sh(),Dh(),qh(),Ph(),$h(),N2(),Ht(),cV(),Ks(),bV(),dV(),lY(),ks(),ZY(),nV(),s2(),mV(),Y2(),Te(),h2(),V2(),WG(),P(),Zl(),Et(),tG(),Cd(),jW(),nG(),eG=new Map([["Abs",[Tm]],["Acos",[gW]],["Acosh",[fm]],["Add",[TW]],["ArgMax",[FW,XW]],["ArgMin",[xm,XW]],["Asin",[Sm]],["Asinh",[JW]],["Atan",[Dm]],["Atanh",[qm]],["Attention",[Mm]],["AveragePool",[tV,Bt]],["BatchNormalization",[vW]],["BiasAdd",[Km]],["BiasSplitGelu",[KW]],["Cast",[_m,CW]],["Ceil",[$m]],["Clip",[AW]],["Concat",[gN,JN]],["Conv",[ca,Nt]],["ConvTranspose",[_N,ht]],["Cos",[IN]],["Cosh",[LW]],["CumSum",[PN,$N]],["DepthToSpace",[Gs,cs]],["DequantizeLinear",[hY,VY]],["Div",[XN]],["Einsum",[es,as]],["Elu",[lN,ce]],["Equal",[iN]],["Erf",[GN]],["Exp",[kW]],["Expand",[ms]],["FastGelu",[Ns]],["Floor",[cN]],["FusedConv",[ca,Nt]],["Gather",[hs,Ys]],["GatherElements",[is,Xs]],["GatherBlockQuantized",[Rs,os]],["GatherND",[aa,ps]],["Gelu",[bN]],["Gemm",[Wa,rs]],["GlobalAveragePool",[WY,aY]],["GlobalMaxPool",[NY,mY]],["Greater",[rN]],["GreaterOrEqual",[SW]],["GridSample",[Js,Cs]],["GroupQueryAttention",[yt]],["HardSigmoid",[WN,UW]],["InstanceNormalization",[js]],["LayerNormalization",[Ct]],["LeakyRelu",[xW,ce]],["Less",[wN]],["LessOrEqual",[vN]],["Log",[hN]],["MatMul",[Ds]],["MatMulNBits",[$s,IY]],["MaxPool",[tY,nY]],["Mul",[QN]],["MultiHeadAttention",[IV,Ls]],["Neg",[ZN]],["Not",[dN]],["Pad",[aV]],["Pow",[HN]],["QuickGelu",[pN,ce]],["Range",[RY]],["Reciprocal",[zW]],["ReduceMin",[Cm]],["ReduceMean",[ym]],["ReduceMax",[uW]],["ReduceSum",[RW]],["ReduceProd",[Am]],["ReduceL1",[pW]],["ReduceL2",[gm]],["ReduceLogSum",[km]],["ReduceLogSumExp",[Jm]],["ReduceSumSquare",[Lm]],["Relu",[eN]],["Resize",[yV,gV]],["RotaryEmbedding",[AV]],["ScatterND",[sV,NV]],["Sigmoid",[aN]],["Sin",[tN]],["Sinh",[MW]],["Slice",[HY,rY]],["SkipLayerNormalization",[xV]],["Split",[Ms,Bs]],["Sqrt",[nN]],["Softmax",[_I,Gl]],["Sub",[fW]],["Tan",[mN]],["Tanh",[NN]],["ThresholdedRelu",[YN,ce]],["Tile",[hG]],["Transpose",[tm,tW]],["Where",[dc]]])}),_G,iG=n(()=>{"use strict";OI(),$I(),aG(),_G=class{constructor(c){this.backend=c,this.repo=new Map,this.attributesBound=!1}getArtifact(c){return this.repo.get(c)}setArtifact(c,Z){this.repo.set(c,Z)}run(c,Z,Y,R,i){A(c.programInfo.name);let v=this.backend.device,g=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let M=[];for(let f of Z)M.push({binding:M.length,resource:{buffer:f.buffer}});for(let f of Y)M.push({binding:M.length,resource:{buffer:f.buffer}});i&&M.push({binding:M.length,resource:i});let j=v.createBindGroup({layout:c.computePipeline.getBindGroupLayout(0),entries:M,label:c.programInfo.name});if(this.backend.sessionStatus==="capturing"){let f={kernelId:this.backend.currentKernelId,computePipeline:c.computePipeline,bindGroup:j,dispatchGroup:R};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(f)}g.setPipeline(c.computePipeline),g.setBindGroup(0,j),g.dispatchWorkgroups(...R),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),O(c.programInfo.name)}dispose(){}build(c,Z){A(c.name);let Y=this.backend.device,R=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"},{feature:"subgroups-f16",extension:"subgroups_f16"}].forEach(f=>{Y.features.has(f.feature)&&R.push(`enable ${f.extension};`)});let i=Zm(Z,this.backend.device.limits),v=c.getShaderSource(i),g=`${R.join(`
`)}
${i.additionalImplementations}
${v}`,M=Y.createShaderModule({code:g,label:c.name});gG("verbose",()=>`[WebGPU] ${c.name} shader code: ${g}`);let j=Y.createComputePipeline({compute:{module:M,entryPoint:"main"},layout:"auto",label:c.name});return O(c.name),{programInfo:c,computePipeline:j,uniformVariablesInfo:i.variablesInfo}}normalizeDispatchGroupSize(c){let Z=typeof c=="number"?c:c.x,Y=typeof c=="number"?1:c.y||1,R=typeof c=="number"?1:c.z||1,i=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(Z<=i&&Y<=i&&R<=i)return[Z,Y,R];let v=Z*Y*R,g=Math.ceil(Math.sqrt(v));if(g>i){if(g=Math.ceil(Math.cbrt(v)),g>i)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[g,g,g]}else return[g,g,1]}}}),Qc,Hc,Vc,rc,cb,Ob=n(()=>{"use strict";OI(),Sl(),$I(),AI(),bc(),KG(),iG(),Qc=(c,Z)=>{if(Z.length!==c.length)throw new Error(`inputDependencies length ${Z.length} is not equal to inputTensors length ${c.length}.`);let Y=[];for(let R=0;R<c.length;++R){let i=c[R].dataType;switch(Z[R]){case"none":{Y.push("");break}case"type":{Y.push(`${i}`);break}case"rank":{let v=c[R].dims.length;Y.push(`${i};${v}`);break}case"dims":{let v=c[R].dims.join(",");Y.push(`${i};${v}`);break}default:throw new Error(`unsupported input dependency: ${Z[R]}`)}}return Y.join("|")},Hc=(c,Z,Y)=>{let R=c.name;return c.shaderCache?.hint&&(R+="["+c.shaderCache.hint+"]"),R+=":"+Y+`:${Qc(Z,c.shaderCache?.inputDependencies??new Array(Z.length).fill("dims"))}`,R},Vc=class{constructor(c){c&&(this.architecture=c.architecture,this.vendor=c.vendor)}isArchitecture(c){return this.architecture===c}isVendor(c){return this.vendor===c}},rc=class{constructor(c){this.subgroupsSupported=c.features.has("subgroups"),this.subgroupsF16Supported=c.features.has("subgroups");let Z=c.limits;!this.subgroupsSupported||!Z.minSubgroupSize||!Z.maxSubgroupSize?this.subgroupSizeRange=void 0:this.subgroupSizeRange=[Z.minSubgroupSize,Z.maxSubgroupSize]}},cb=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let c=this.kernelCustomData.get(this.currentKernelId);return c||(c={},this.kernelCustomData.set(this.currentKernelId,c)),c}async initialize(c,Z){this.env=c;let Y=[],R={requiredLimits:{maxComputeWorkgroupStorageSize:Z.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:Z.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:Z.limits.maxStorageBufferBindingSize,maxBufferSize:Z.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:Z.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:Z.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:Z.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:Z.limits.maxComputeWorkgroupSizeZ},requiredFeatures:Y},i=v=>Z.features.has(v)&&Y.push(v)&&!0;i("chromium-experimental-timestamp-query-inside-passes")||i("timestamp-query"),i("shader-f16"),i("subgroups")&&i("subgroups-f16"),this.device=await Z.requestDevice(R),this.deviceInfo=new rc(this.device),this.adapterInfo=new Vc(Z.info||await Z.requestAdapterInfo()),this.gpuDataManager=dG(this),this.programManager=new _G(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,wZ(c.logLevel,!!c.debug),this.device.onuncapturederror=v=>{v.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${v.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:Z,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let c=this.getCommandEncoder(),Z={};this.queryType==="at-passes"&&(Z.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=c.beginComputePass(Z)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;A(),this.endComputePass();let c;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),c=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(c,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,c,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&c.mapAsync(GPUMapMode.READ).then(()=>{let Z=new BigUint64Array(c.getMappedRange()),Y=this.pendingQueries.get(c);for(let R=0;R<Z.length/2;R++){let i=Y[R],v=i.kernelId,g=this.kernels.get(v),M=g.kernelType,j=g.kernelName,f=i.programName,mI=i.inputTensorViews,x=i.outputTensorViews,NI=Z[R*2],rI=Z[R*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=NI);let oI=Number(NI-this.queryTimeBase),XI=Number(rI-this.queryTimeBase);if(!Number.isSafeInteger(oI)||!Number.isSafeInteger(XI))throw new RangeError("incorrect timestamp range");if(this.env.webgpu.profiling?.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:mI.map(xI=>({dims:xI.dims,dataType:kb(xI.dataType)})),outputsMetadata:x.map(xI=>({dims:xI.dims,dataType:kb(xI.dataType)})),kernelId:v,kernelType:M,kernelName:j,programName:f,startTime:oI,endTime:XI});else{let xI="";mI.forEach((EI,MI)=>{xI+=`input[${MI}]: [${EI.dims}] | ${kb(EI.dataType)}, `});let LI="";x.forEach((EI,MI)=>{LI+=`output[${MI}]: [${EI.dims}] | ${kb(EI.dataType)}, `}),console.log(`[profiling] kernel "${v}|${M}|${j}|${f}" ${xI}${LI}execution time: ${XI-oI} ns`)}w("GPU",`${f}::${NI}::${rI}`)}c.unmap(),this.pendingQueries.delete(c)}),O()}run(c,Z,Y,R,i,v){A(c.name);let g=[];for(let EI=0;EI<Z.length;++EI){let MI=Z[EI].data;if(MI===0)continue;let SI=this.gpuDataManager.get(MI);if(!SI)throw new Error(`no GPU data for input: ${MI}`);g.push(SI)}let{outputs:M,dispatchGroup:j,programUniforms:f}=c.getRunData(Z),mI=Y.length===0?M.map((EI,MI)=>MI):Y;if(mI.length!==M.length)throw new Error(`Output size ${mI.length} must be equal to ${M.length}.`);let x=[],NI=[];for(let EI=0;EI<M.length;++EI){if(!Number.isInteger(mI[EI])||mI[EI]<-3||mI[EI]>=v)throw new Error(`Invalid output index: ${mI[EI]}`);if(mI[EI]===-3)continue;let MI=mI[EI]===-1,SI=mI[EI]===-2,qI=MI||SI?i(M[EI].dataType,M[EI].dims):R(mI[EI],M[EI].dataType,M[EI].dims);if(x.push(qI),qI.data===0)continue;let ll=this.gpuDataManager.get(qI.data);if(!ll)throw new Error(`no GPU data for output: ${qI.data}`);if(MI&&this.temporaryData.push(ll),SI){let cl=this.kernelPersistentData.get(this.currentKernelId);cl||(cl=[],this.kernelPersistentData.set(this.currentKernelId,cl)),cl.push(ll)}NI.push(ll)}if(g.length!==Z.length||NI.length!==x.length){if(NI.length===0)return O(c.name),x;throw new Error(`Program ${c.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let rI;if(f){let EI=0,MI=[];f.forEach(cl=>{let pl=typeof cl.data=="number"?[cl.data]:cl.data;if(pl.length===0)return;let Xl=cl.type===10?2:4,kl,xl;cl.type===10?(xl=pl.length>4?16:pl.length>2?8:pl.length*Xl,kl=pl.length>4?16:Xl*pl.length):(xl=pl.length<=2?pl.length*Xl:16,kl=16),EI=Math.ceil(EI/xl)*xl,MI.push(EI);let bG=cl.type===10?8:4;EI+=pl.length>4?Math.ceil(pl.length/bG)*kl:pl.length*Xl});let SI=16;EI=Math.ceil(EI/SI)*SI;let qI=new ArrayBuffer(EI);f.forEach((cl,pl)=>{let Xl=MI[pl],kl=typeof cl.data=="number"?[cl.data]:cl.data;if(cl.type===6)new Int32Array(qI,Xl,kl.length).set(kl);else if(cl.type===12)new Uint32Array(qI,Xl,kl.length).set(kl);else if(cl.type===10)new Uint16Array(qI,Xl,kl.length).set(kl);else if(cl.type===1)new Float32Array(qI,Xl,kl.length).set(kl);else throw new Error(`Unsupported uniform type: ${kb(cl.type)}`)});let ll=this.gpuDataManager.create(EI,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(ll.buffer,0,qI,0,EI),this.gpuDataManager.release(ll.id),rI={offset:0,size:EI,buffer:ll.buffer}}let oI=this.programManager.normalizeDispatchGroupSize(j),XI=oI[1]===1&&oI[2]===1,xI=Hc(c,Z,XI),LI=this.programManager.getArtifact(xI);if(LI||(LI=this.programManager.build(c,oI),this.programManager.setArtifact(xI,LI),gG("info",()=>`[artifact] key: ${xI}, programName: ${c.name}`)),f&&LI.uniformVariablesInfo){if(f.length!==LI.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${LI.uniformVariablesInfo.length}, got ${f.length} in program "${LI.programInfo.name}".`);for(let EI=0;EI<f.length;EI++){let MI=f[EI],SI=MI.type,qI=typeof MI.data=="number"?1:MI.data.length,[ll,cl]=LI.uniformVariablesInfo[EI];if(SI!==ll||qI!==cl)throw new Error(`Uniform variable ${EI} mismatch: expect type ${ll} with size ${cl}, got type ${SI} with size ${qI} in program "${LI.programInfo.name}".`)}}if(gG("info",()=>`[ProgramManager] run "${c.name}" (key=${xI}) with ${oI[0]}x${oI[1]}x${oI[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let EI={kernelId:this.currentKernelId,programName:LI.programInfo.name,inputTensorViews:Z,outputTensorViews:x};this.pendingKernels.push(EI),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(EI)}return this.programManager.run(LI,g,NI,oI,rI),O(c.name),x}upload(c,Z){this.gpuDataManager.upload(c,Z)}memcpy(c,Z){this.gpuDataManager.memcpy(c,Z)}async download(c,Z){await this.gpuDataManager.download(c,Z)}alloc(c){return this.gpuDataManager.create(c).id}free(c){return this.gpuDataManager.release(c)}createKernel(c,Z,Y,R){let i=eG.get(c);if(!i)throw new Error(`kernel not implemented: ${c}`);let v={kernelType:c,kernelName:R,kernelEntry:i[0],attributes:[i[1],Y]};this.kernels.set(Z,v)}releaseKernel(c){let Z=this.kernelPersistentData.get(c);if(Z){for(let Y of Z)this.gpuDataManager.release(Y.id);this.kernelPersistentData.delete(c)}this.kernelCustomData.delete(c),this.kernels.delete(c)}computeKernel(c,Z,Y){let R=this.kernels.get(c);if(!R)throw new Error(`kernel not created: ${c}`);let i=R.kernelType,v=R.kernelName,g=R.kernelEntry,M=R.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${i}] ${v}" is not allowed to be called recursively`);this.currentKernelId=c,M[0]&&(M[1]=M[0](M[1]),M[0]=void 0),gG("info",()=>`[WebGPU] Start to run kernel "[${i}] ${v}"...`);let j=this.env.debug;this.temporaryData=[];try{return j&&this.device.pushErrorScope("validation"),g(Z,M[1]),0}catch(f){return Y.push(Promise.resolve(`[WebGPU] Kernel "[${i}] ${v}" failed. ${f}`)),1}finally{j&&Y.push(this.device.popErrorScope().then(f=>f?`GPU validation error for kernel "[${i}] ${v}": ${f.message}`:null));for(let f of this.temporaryData)this.gpuDataManager.release(f.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(c,Z,Y,R){let i=this.sessionExternalDataMapping.get(c);i||(i=new Map,this.sessionExternalDataMapping.set(c,i));let v=i.get(Z),g=this.gpuDataManager.registerExternalBuffer(Y,R,v);return i.set(Z,[g,Y]),g}unregisterBuffers(c){let Z=this.sessionExternalDataMapping.get(c);Z&&(Z.forEach(Y=>this.gpuDataManager.unregisterExternalBuffer(Y[0])),this.sessionExternalDataMapping.delete(c))}getBuffer(c){let Z=this.gpuDataManager.get(c);if(!Z)throw new Error(`no GPU data for buffer: ${c}`);return Z.buffer}createDownloader(c,Z,Y){return async()=>{let R=await Hl(this,c,Z);return II(R.buffer,Y)}}writeTimestamp(c){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,c)}setQueryType(){this.queryType="none",(this.env.webgpu.profiling?.mode==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){gG("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){gG("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){gG("info","replay"),this.sessionStatus="replaying";let c=this.capturedCommandList.get(this.currentSessionId),Z=this.capturedPendingKernels.get(this.currentSessionId),Y=c.length;this.pendingKernels=[];for(let R=0;R<Y;R++){let i=this.getComputePassEncoder(),v=c[R];this.writeTimestamp(this.pendingDispatchNumber*2),i.setPipeline(v.computePipeline),i.setBindGroup(0,v.bindGroup),i.dispatchWorkgroups(...v.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(Z[R]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(c){this.unregisterBuffers(c),this.capturedCommandList.has(c)&&this.capturedCommandList.delete(c),this.capturedPendingKernels.has(c)&&this.capturedPendingKernels.delete(c),this.gpuDataManager.onReleaseSession(c)}onRunStart(c){this.currentSessionId=c,this.setQueryType()}}}),jt,Wb,Yd,EZ,Na,We,te,UV,Zc=n(()=>{"use strict";$I(),jt=1,Wb=()=>jt++,Yd=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),EZ=(c,Z)=>{let Y=Yd.get(c);if(!Y)throw new Error("Unsupported data type.");return Z.length>0?Math.ceil(Z.reduce((R,i)=>R*i)*Y/8):0},Na=class{constructor(c){this.sessionId=c.sessionId,this.mlContext=c.context,this.mlTensor=c.tensor,this.dataType=c.dataType,this.tensorShape=c.shape}get tensor(){return this.mlTensor}get type(){return this.dataType}get shape(){return this.tensorShape}get byteLength(){return EZ(this.dataType,this.tensorShape)}destroy(){gG("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(c){this.mlContext.writeTensor(this.mlTensor,c)}async read(c){return c?this.mlContext.readTensor(this.mlTensor,c):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(c,Z,Y){return this.mlContext===c&&this.dataType===Z&&this.tensorShape.length===Y.length&&this.tensorShape.every((R,i)=>R===Y[i])}},We=class{constructor(c,Z){this.tensorManager=c,this.wrapper=Z}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(c,Z,Y,R){if(this.wrapper){if(this.wrapper.canReuseTensor(c,Z,Y))return this.wrapper.tensor;if(R){if(this.wrapper.byteLength!==EZ(Z,Y))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let i=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(Z,Y,i,!0,!0),R&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(c){if(this.wrapper)if(c.byteLength===this.wrapper.byteLength){this.wrapper.write(c);return}else gG("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor();this.activeUpload?this.activeUpload.set(c):this.activeUpload=new Uint8Array(c)}async download(c){if(this.activeUpload)if(c){c instanceof ArrayBuffer?new Uint8Array(c).set(this.activeUpload):new Uint8Array(c.buffer,c.byteOffset,c.byteLength).set(this.activeUpload);return}else return this.activeUpload.buffer;if(!this.wrapper)throw new Error("Tensor has not been created.");return c?this.wrapper.read(c):this.wrapper.read()}},te=class{constructor(c){this.backend=c,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}reserveTensorId(){let c=Wb();return this.tensorTrackersById.set(c,new We(this)),c}releaseTensorId(c){let Z=this.tensorTrackersById.get(c);Z&&(this.tensorTrackersById.delete(c),Z.tensorWrapper&&this.releaseTensor(Z.tensorWrapper))}async ensureTensor(c,Z,Y,R){gG("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${c}, dataType: ${Z}, shape: ${Y}, copyOld: ${R}}`);let i=this.tensorTrackersById.get(c);if(!i)throw new Error("Tensor not found.");return i.ensureTensor(this.backend.currentContext,Z,Y,R)}upload(c,Z){let Y=this.tensorTrackersById.get(c);if(!Y)throw new Error("Tensor not found.");Y.upload(Z)}async download(c,Z){gG("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${c}, dstBuffer: ${Z?.byteLength}}`);let Y=this.tensorTrackersById.get(c);if(!Y)throw new Error("Tensor not found.");return Y.download(Z)}releaseTensorsForSession(c){for(let Z of this.freeTensors)Z.sessionId===c&&Z.destroy();this.freeTensors=this.freeTensors.filter(Z=>Z.sessionId!==c)}registerTensor(c,Z,Y,R){let i=Wb(),v=new Na({sessionId:this.backend.currentSessionId,context:c,tensor:Z,dataType:Y,shape:R});return this.tensorTrackersById.set(i,new We(this,v)),this.externalTensors.add(v),i}async getCachedTensor(c,Z,Y,R,i){let v=this.backend.currentSessionId,g=this.backend.currentContext;for(let[j,f]of this.freeTensors.entries())if(f.canReuseTensor(g,c,Z)){gG("verbose",()=>`[WebNN] Reusing tensor {dataType: ${c}, shape: ${Z}}`);let mI=this.freeTensors.splice(j,1)[0];return mI.sessionId=v,mI}gG("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${c}, shape: ${Z}}`);let M=await g.createTensor({dataType:c,shape:Z,dimensions:Z,usage:Y,writable:R,readable:i});return new Na({sessionId:v,context:g,tensor:M,dataType:c,shape:Z})}releaseTensor(c){this.externalTensors.has(c)&&this.externalTensors.delete(c),this.freeTensors.push(c)}},UV=(...c)=>new te(...c)}),oc,Ld,dZ,ne=n(()=>{"use strict";Sl(),lb(),AI(),Zc(),$I(),oc=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),Ld=(c,Z)=>{if(c===Z)return!0;if(c===void 0||Z===void 0)return!1;let Y=Object.keys(c).sort(),R=Object.keys(Z).sort();return Y.length===R.length&&Y.every((i,v)=>i===R[v]&&c[i]===Z[i])},dZ=class{constructor(c){this.tensorManager=UV(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],wZ(c.logLevel,!!c.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(c){this.activeSessionId=c}async createMLContext(c){if(c instanceof GPUDevice){let Y=this.mlContextCache.findIndex(R=>R.gpuDevice===c);if(Y!==-1)return this.mlContextCache[Y].mlContext;{let R=await navigator.ml.createContext(c);return this.mlContextCache.push({gpuDevice:c,mlContext:R}),R}}else if(c===void 0){let Y=this.mlContextCache.findIndex(R=>R.options===void 0&&R.gpuDevice===void 0);if(Y!==-1)return this.mlContextCache[Y].mlContext;{let R=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:R}),R}}let Z=this.mlContextCache.findIndex(Y=>Ld(Y.options,c));if(Z!==-1)return this.mlContextCache[Z].mlContext;{let Y=await navigator.ml.createContext(c);return this.mlContextCache.push({options:c,mlContext:Y}),Y}}get currentContext(){let c=this.getMLContext(this.currentSessionId);if(!c)throw new Error(`No MLContext found for session ${this.currentSessionId}`);return c}registerMLContext(c,Z){this.mlContextBySessionId.set(c,Z);let Y=this.sessionIdsByMLContext.get(Z);Y||(Y=new Set,this.sessionIdsByMLContext.set(Z,Y)),Y.add(c)}onReleaseSession(c){let Z=this.mlContextBySessionId.get(c);if(!Z)return;this.tensorManager.releaseTensorsForSession(c),this.mlContextBySessionId.delete(c);let Y=this.sessionIdsByMLContext.get(Z);if(Y.delete(c),Y.size===0){this.sessionIdsByMLContext.delete(Z);let R=this.mlContextCache.findIndex(i=>i.mlContext===Z);R!==-1&&this.mlContextCache.splice(R,1)}}getMLContext(c){return this.mlContextBySessionId.get(c)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(c){gG("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${c}}`),this.tensorManager.releaseTensorId(c)}async ensureTensor(c,Z,Y,R){let i=oc.get(Z);if(!i)throw new Error(`Unsupported ONNX data type: ${Z}`);return this.tensorManager.ensureTensor(c,i,Y,R)}uploadTensor(c,Z){if(!xG().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");gG("verbose",()=>`[WebNN] uploadTensor {tensorId: ${c}, data: ${Z.byteLength}}`),this.tensorManager.upload(c,Z)}async downloadTensor(c,Z){return this.tensorManager.download(c,Z)}createMLTensorDownloader(c,Z){return async()=>{let Y=await this.tensorManager.download(c);return II(Y,Z)}}registerMLTensor(c,Z,Y){let R=oc.get(Z);if(!R)throw new Error(`Unsupported ONNX data type: ${Z}`);let i=this.tensorManager.registerTensor(this.currentContext,c,R,Y);return gG("verbose",()=>`[WebNN] registerMLTensor {tensor: ${c}, dataType: ${R}, dimensions: ${Y}} -> {tensorId: ${i}}`),i}registerMLConstant(c,Z,Y,R,i,v){if(!v)throw new Error("External mounted files are not available.");let g=c;c.startsWith("./")&&(g=c.substring(2));let M=v.get(g);if(!M)throw new Error(`File with name ${g} not found in preloaded files.`);if(Z+Y>M.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let j=M.slice(Z,Z+Y).buffer,f;switch(i.dataType){case"float32":f=new Float32Array(j);break;case"float16":f=new Uint16Array(j);break;case"int32":f=new Int32Array(j);break;case"uint32":f=new Uint32Array(j);break;case"int64":f=new BigInt64Array(j);break;case"uint64":f=new BigUint64Array(j);break;case"int8":f=new Int8Array(j);break;case"int4":case"uint4":case"uint8":f=new Uint8Array(j);break;default:throw new Error(`Unsupported data type: ${i.dataType} in creating WebNN Constant from external data.`)}return gG("verbose",()=>`[WebNN] registerMLConstant {dataType: ${i.dataType}, shape: ${i.shape}}}`),R.constant(i,f)}flush(){}}}),sa={};s(sa,{init:()=>Tt});var me,Kt,Tt,p2=n(()=>{"use strict";Sl(),Ob(),$I(),Kl(),ne(),me=class KQ{constructor(Z,Y,R,i){this.module=Z,this.dataType=Y,this.data=R,this.dims=i}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let Z=dl.size(this.dims);return Z===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,Z)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let Z=dl.size(this.dims);return Z===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,Z)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let Z=dl.size(this.dims);return Z===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,Z)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let Z=dl.size(this.dims);return Z===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,Z)}reshape(Z){if(dl.size(Z)!==dl.size(this.dims))throw new Error("Invalid new shape");return new KQ(this.module,this.dataType,this.data,Z)}},Kt=class{constructor(c,Z,Y){this.module=c,this.backend=Z,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=Z.adapterInfo,this.deviceInfo=Z.deviceInfo;let R=c.PTR_SIZE,i=Y/c.PTR_SIZE,v=R===4?"i32":"i64";this.opKernelContext=Number(c.getValue(R*i++,v));let g=Number(c.getValue(R*i++,v));this.outputCount=Number(c.getValue(R*i++,v)),this.customDataOffset=Number(c.getValue(R*i++,"*")),this.customDataSize=Number(c.getValue(R*i++,v));let M=[];for(let j=0;j<g;j++){let f=Number(c.getValue(R*i++,v)),mI=Number(c.getValue(R*i++,"*")),x=Number(c.getValue(R*i++,v)),NI=[];for(let rI=0;rI<x;rI++)NI.push(Number(c.getValue(R*i++,v)));M.push(new me(c,f,mI,NI))}this.inputs=M}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(c,Z){let Y=Z?.inputs?.map(g=>typeof g=="number"?this.inputs[g]:g)??this.inputs,R=Z?.outputs??[],i=(g,M,j)=>new me(this.module,M,this.output(g,j),j),v=(g,M)=>{let j=Vb(g,M);if(!j)throw new Error(`Unsupported data type: ${g}`);let f=j>0?this.backend.gpuDataManager.create(j).id:0;return new me(this.module,g,f,M)};return this.backend.run(c,Y,R,i,v,this.outputCount)}output(c,Z){let Y=this.module.stackSave();try{let R=this.module.PTR_SIZE,i=R===4?"i32":"i64",v=this.module.stackAlloc((1+Z.length)*R);this.module.setValue(v,Z.length,i);for(let g=0;g<Z.length;g++)this.module.setValue(v+R*(g+1),Z[g],i);return this.module._JsepOutput(this.opKernelContext,c,v)}catch(R){throw new Error(`Failed to generate kernel's output[${c}] with dims [${Z}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${R}`)}finally{this.module.stackRestore(Y)}}},Tt=async(c,Z,Y,R)=>{let i=Z.jsepInit;if(!i)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(c==="webgpu"){let v=new cb;await v.initialize(Y,R),i("webgpu",[v,g=>v.alloc(Number(g)),g=>v.free(g),(g,M,j,f=!1)=>{if(f)gG("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(g)}, dst=${Number(M)}, size=${Number(j)}`),v.memcpy(Number(g),Number(M));else{gG("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(g)}, gpuDataId=${Number(M)}, size=${Number(j)}`);let mI=Z.HEAPU8.subarray(Number(g>>>0),Number(g>>>0)+Number(j));v.upload(Number(M),mI)}},async(g,M,j)=>{gG("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${g}, dataOffset=${M}, size=${j}`),await v.download(Number(g),()=>Z.HEAPU8.subarray(Number(M)>>>0,Number(M+j)>>>0))},(g,M,j)=>v.createKernel(g,Number(M),j,Z.UTF8ToString(Z._JsepGetNodeName(Number(M)))),g=>v.releaseKernel(g),(g,M,j,f)=>{gG("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${j}, kernel=${g}, contextDataOffset=${M}`);let mI=new Kt(Z,v,Number(M));return v.computeKernel(Number(g),mI,f)},()=>v.captureBegin(),()=>v.captureEnd(),()=>v.replay()])}else{let v=new dZ(Y);i("webnn",[v,()=>v.reserveTensorId(),g=>v.releaseTensorId(g),async(g,M,j,f)=>v.ensureTensor(g,M,j,f),(g,M)=>{v.uploadTensor(g,M)},async(g,M)=>v.downloadTensor(g,M)])}}}),ft,Ne,Ya,kd,St,yZ,wY,vY,EY,xd,wb,u2,eX=n(()=>{"use strict";td(),nd(),Sl(),lb(),Lb(),_Z(),ft=(c,Z)=>{xG()._OrtInit(c,Z)!==0&&YG("Can't initialize onnxruntime.")},Ne=async c=>{ft(c.wasm.numThreads,Dd(c.logLevel))},Ya=async(c,Z)=>{{let Y=(p2(),m(sa)).init;if(Z==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");let R=c.webgpu.adapter;if(R){if(typeof R.limits!="object"||typeof R.features!="object"||typeof R.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let i=c.webgpu.powerPreference;if(i!==void 0&&i!=="low-power"&&i!=="high-performance")throw new Error(`Invalid powerPreference setting: "${i}"`);let v=c.webgpu.forceFallbackAdapter;if(v!==void 0&&typeof v!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${v}"`);if(R=await navigator.gpu.requestAdapter({powerPreference:i,forceFallbackAdapter:v}),!R)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}await Y("webgpu",xG(),c,R)}if(Z==="webnn"){if(typeof navigator>"u"||!navigator.ml)throw new Error("WebNN is not supported in current environment");await Y("webnn",xG(),c)}}},kd=new Map,St=c=>{let Z=xG(),Y=Z.stackSave();try{let R=Z.PTR_SIZE,i=Z.stackAlloc(2*R);Z._OrtGetInputOutputCount(c,i,i+R)!==0&&YG("Can't get session input/output count.");let v=R===4?"i32":"i64";return[Number(Z.getValue(i,v)),Number(Z.getValue(i+R,v))]}finally{Z.stackRestore(Y)}},yZ=c=>{let Z=xG(),Y=Z._malloc(c.byteLength);if(Y===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${c.byteLength}.`);return Z.HEAPU8.set(c,Y),[Y,c.byteLength]},wY=async(c,Z)=>{let Y,R,i=xG();Array.isArray(c)?[Y,R]=c:c.buffer===i.HEAPU8.buffer?[Y,R]=[c.byteOffset,c.byteLength]:[Y,R]=yZ(c);let v=0,g=0,M=0,j=[],f=[],mI=[];try{if([g,j]=Pb(Z),Z?.externalData&&i.mountExternalData){let EI=[];for(let MI of Z.externalData){let SI=typeof MI=="string"?MI:MI.path;EI.push(rZ(typeof MI=="string"?MI:MI.data).then(qI=>{i.mountExternalData(SI,qI)}))}await Promise.all(EI)}for(let EI of Z?.executionProviders??[])if((typeof EI=="string"?EI:EI.name)==="webnn"){if(i.shouldTransferToMLTensor=!1,typeof EI!="string"){let MI=EI,SI=MI?.context,qI=MI?.gpuDevice,ll=MI?.deviceType,cl=MI?.powerPreference;SI?i.currentContext=SI:qI?i.currentContext=await i.jsepCreateMLContext(qI):i.currentContext=await i.jsepCreateMLContext({deviceType:ll,powerPreference:cl})}else i.currentContext=await i.jsepCreateMLContext();break}v=await i._OrtCreateSession(Y,R,g),v===0&&YG("Can't create a session."),i.jsepOnCreateSession?.(),i.currentContext&&(i.jsepRegisterMLContext(v,i.currentContext),i.currentContext=void 0,i.shouldTransferToMLTensor=!0);let[x,NI]=St(v),rI=!!Z?.enableGraphCapture,oI=[],XI=[],xI=[];for(let EI=0;EI<x;EI++){let MI=i._OrtGetInputName(v,EI);MI===0&&YG("Can't get an input name."),f.push(MI),oI.push(i.UTF8ToString(MI))}for(let EI=0;EI<NI;EI++){let MI=i._OrtGetOutputName(v,EI);MI===0&&YG("Can't get an output name."),mI.push(MI);let SI=i.UTF8ToString(MI);XI.push(SI);{if(rI&&Z?.preferredOutputLocation===void 0){xI.push("gpu-buffer");continue}let qI=typeof Z?.preferredOutputLocation=="string"?Z.preferredOutputLocation:Z?.preferredOutputLocation?.[SI]??"cpu";if(qI!=="cpu"&&qI!=="cpu-pinned"&&qI!=="gpu-buffer"&&qI!=="ml-tensor")throw new Error(`Not supported preferred output location: ${qI}.`);if(rI&&qI!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${qI}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);xI.push(qI)}}let LI=null;return xI.some(EI=>EI==="gpu-buffer"||EI==="ml-tensor")&&(M=i._OrtCreateBinding(v),M===0&&YG("Can't create IO binding."),LI={handle:M,outputPreferredLocations:xI,outputPreferredLocationsEncoded:xI.map(EI=>HZ(EI))}),kd.set(v,[v,f,mI,LI,rI,!1]),[v,oI,XI]}catch(x){throw f.forEach(NI=>i._OrtFree(NI)),mI.forEach(NI=>i._OrtFree(NI)),M!==0&&i._OrtReleaseBinding(M)!==0&&YG("Can't release IO binding."),v!==0&&i._OrtReleaseSession(v)!==0&&YG("Can't release session."),x}finally{i._free(Y),g!==0&&i._OrtReleaseSessionOptions(g)!==0&&YG("Can't release session options."),j.forEach(x=>i._free(x)),i.unmountExternalData?.()}},vY=c=>{let Z=xG(),Y=kd.get(c);if(!Y)throw new Error(`cannot release session. invalid session id: ${c}`);let[R,i,v,g,M]=Y;g&&(M&&Z._OrtClearBoundOutputs(g.handle)!==0&&YG("Can't clear bound outputs."),Z._OrtReleaseBinding(g.handle)!==0&&YG("Can't release IO binding.")),Z.jsepOnReleaseSession?.(c),i.forEach(j=>Z._OrtFree(j)),v.forEach(j=>Z._OrtFree(j)),Z._OrtReleaseSession(R)!==0&&YG("Can't release session."),kd.delete(c)},EY=(c,Z,Y,R,i,v=!1)=>{if(!c){Z.push(0);return}let g=xG(),M=g.PTR_SIZE,j=c[0],f=c[1],mI=c[3],x,NI;if(j==="string"&&(mI==="gpu-buffer"||mI==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(v&&mI!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${i} when enableGraphCapture is true.`);if(mI==="gpu-buffer"){let XI=c[2].gpuBuffer;NI=Vb(hb(j),f);let xI=g.jsepRegisterBuffer;if(!xI)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');x=xI(R,i,XI,NI)}else if(mI==="ml-tensor"){let XI=c[2].mlTensor;NI=Vb(hb(j),f);let xI=g.jsepRegisterMLTensor;if(!xI)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');x=xI(XI,hb(j),f)}else{let XI=c[2];if(Array.isArray(XI)){NI=M*XI.length,x=g._malloc(NI),Y.push(x);for(let xI=0;xI<XI.length;xI++){if(typeof XI[xI]!="string")throw new TypeError(`tensor data at index ${xI} is not a string`);g.setValue(x+xI*M,cc(XI[xI],Y),"*")}}else NI=XI.byteLength,x=g._malloc(NI),Y.push(x),g.HEAPU8.set(new Uint8Array(XI.buffer,XI.byteOffset,NI),x)}let rI=g.stackSave(),oI=g.stackAlloc(4*f.length);try{f.forEach((xI,LI)=>g.setValue(oI+LI*M,xI,M===4?"i32":"i64"));let XI=g._OrtCreateTensor(hb(j),x,NI,oI,f.length,HZ(mI));XI===0&&YG(`Can't create tensor for input/output. session=${R}, index=${i}.`),Z.push(XI)}finally{g.stackRestore(rI)}},xd=async(c,Z,Y,R,i,v)=>{let g=xG(),M=g.PTR_SIZE,j=kd.get(c);if(!j)throw new Error(`cannot run inference. invalid session id: ${c}`);let f=j[0],mI=j[1],x=j[2],NI=j[3],rI=j[4],oI=j[5],XI=Z.length,xI=R.length,LI=0,EI=[],MI=[],SI=[],qI=[],ll=g.stackSave(),cl=g.stackAlloc(XI*M),pl=g.stackAlloc(XI*M),Xl=g.stackAlloc(xI*M),kl=g.stackAlloc(xI*M);try{g.jsepOnRunStart?.(f),[LI,EI]=sb(v);for(let il=0;il<XI;il++)EY(Y[il],MI,qI,c,Z[il],rI);for(let il=0;il<xI;il++)EY(i[il],SI,qI,c,XI+R[il],rI);for(let il=0;il<XI;il++)g.setValue(cl+il*M,MI[il],"*"),g.setValue(pl+il*M,mI[Z[il]],"*");for(let il=0;il<xI;il++)g.setValue(Xl+il*M,SI[il],"*"),g.setValue(kl+il*M,x[R[il]],"*");if(NI&&!oI){let{handle:il,outputPreferredLocations:VG,outputPreferredLocationsEncoded:GG}=NI;if(mI.length!==XI)throw new Error(`input count from feeds (${XI}) is expected to be always equal to model's input count (${mI.length}).`);for(let Bl=0;Bl<XI;Bl++){let QG=Z[Bl];await g._OrtBindInput(il,mI[QG],MI[Bl])!==0&&YG(`Can't bind input[${Bl}] for session=${c}.`)}for(let Bl=0;Bl<xI;Bl++){let QG=R[Bl];i[Bl]?.[3]?g._OrtBindOutput(il,x[QG],SI[Bl],0)!==0&&YG(`Can't bind pre-allocated output[${Bl}] for session=${c}.`):g._OrtBindOutput(il,x[QG],0,GG[QG])!==0&&YG(`Can't bind output[${Bl}] to ${VG[Bl]} for session=${c}.`)}kd.set(c,[f,mI,x,NI,rI,!0])}let xl;NI?xl=await g._OrtRunWithBinding(f,NI.handle,xI,Xl,LI):xl=await g._OrtRun(f,pl,cl,XI,kl,xI,Xl,LI),xl!==0&&YG("failed to call OrtRun().");let bG=[];for(let il=0;il<xI;il++){let VG=Number(g.getValue(Xl+il*M,"*"));if(VG===SI[il]){bG.push(i[il]);continue}let GG=g.stackSave(),Bl=g.stackAlloc(4*M),QG=!1,mG,cG=0;try{g._OrtGetTensorData(VG,Bl,Bl+M,Bl+2*M,Bl+3*M)!==0&&YG(`Can't access output tensor data on index ${il}.`);let pc=M===4?"i32":"i64",Rl=Number(g.getValue(Bl,pc));cG=g.getValue(Bl+M,"*");let Al=g.getValue(Bl+M*2,"*"),BG=Number(g.getValue(Bl+M*3,pc)),ec=[];for(let Pc=0;Pc<BG;Pc++)ec.push(Number(g.getValue(Al+Pc*M,pc)));g._OrtFree(Al)!==0&&YG("Can't free memory for tensor dims.");let ac=ec.reduce((Pc,sc)=>Pc*sc,1);mG=kb(Rl);let gZ=NI?.outputPreferredLocations[R[il]];if(mG==="string"){if(gZ==="gpu-buffer"||gZ==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let Pc=[];for(let sc=0;sc<ac;sc++){let tb=g.getValue(cG+sc*M,"*"),OV=g.getValue(cG+(sc+1)*M,"*"),JY=sc===ac-1?void 0:OV-tb;Pc.push(g.UTF8ToString(tb,JY))}bG.push([mG,ec,Pc,"cpu"])}else if(gZ==="gpu-buffer"&&ac>0){let Pc=g.jsepGetBuffer;if(!Pc)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let sc=Pc(cG),tb=Vb(Rl,ac);if(tb===void 0||!iZ(mG))throw new Error(`Unsupported data type: ${mG}`);QG=!0,bG.push([mG,ec,{gpuBuffer:sc,download:g.jsepCreateDownloader(sc,tb,mG),dispose:()=>{g._OrtReleaseTensor(VG)!==0&&YG("Can't release tensor.")}},"gpu-buffer"])}else if(gZ==="ml-tensor"&&ac>0){let Pc=g.jsepEnsureTensor;if(!Pc)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(Vb(Rl,ac)===void 0||!QZ(mG))throw new Error(`Unsupported data type: ${mG}`);let sc=await Pc(cG,Rl,ec,!1);QG=!0,bG.push([mG,ec,{mlTensor:sc,download:g.jsepCreateMLTensorDownloader(cG,mG),dispose:()=>{g.jsepReleaseTensorId(cG),g._OrtReleaseTensor(VG)}},"ml-tensor"])}else{let Pc=XZ(mG),sc=new Pc(ac);new Uint8Array(sc.buffer,sc.byteOffset,sc.byteLength).set(g.HEAPU8.subarray(cG,cG+sc.byteLength)),bG.push([mG,ec,sc,"cpu"])}}finally{g.stackRestore(GG),mG==="string"&&cG&&g._free(cG),QG||g._OrtReleaseTensor(VG)}}return NI&&!rI&&(g._OrtClearBoundOutputs(NI.handle)!==0&&YG("Can't clear bound outputs."),kd.set(c,[f,mI,x,NI,rI,!1])),bG}finally{g.stackRestore(ll),MI.forEach(xl=>g._OrtReleaseTensor(xl)),SI.forEach(xl=>g._OrtReleaseTensor(xl)),qI.forEach(xl=>g._free(xl)),LI!==0&&g._OrtReleaseRunOptions(LI),EI.forEach(xl=>g._free(xl))}},wb=c=>{let Z=xG(),Y=kd.get(c);if(!Y)throw new Error("invalid session id");let R=Y[0],i=Z._OrtEndProfiling(R);i===0&&YG("Can't get an profile file name."),Z._OrtFree(i)},u2=c=>{let Z=[];for(let Y of c){let R=Y[2];!Array.isArray(R)&&"buffer"in R&&Z.push(R.buffer)}return Z}}),se,hd,Dt,yY,gY,MV,R2,BV,ha,Va,aX,WX,tX,nX,mX,NX,sX,YX,hX=n(()=>{"use strict";OI(),eX(),lb(),xc(),se=()=>!!C.wasm.proxy&&typeof document<"u",Dt=!1,yY=!1,gY=!1,BV=new Map,ha=(c,Z)=>{let Y=BV.get(c);Y?Y.push(Z):BV.set(c,[Z])},Va=()=>{if(Dt||!yY||gY||!hd)throw new Error("worker not ready")},aX=c=>{switch(c.data.type){case"init-wasm":Dt=!1,c.data.err?(gY=!0,R2[1](c.data.err)):(yY=!0,R2[0]()),MV&&(URL.revokeObjectURL(MV),MV=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let Z=BV.get(c.data.type);c.data.err?Z.shift()[1](c.data.err):Z.shift()[0](c.data.out);break}default:}},WX=async()=>{if(!yY){if(Dt)throw new Error("multiple calls to 'initWasm()' detected.");if(gY)throw new Error("previous call to 'initWasm()' failed.");if(Dt=!0,se())return new Promise((c,Z)=>{hd?.terminate(),Wc().then(([Y,R])=>{try{hd=R,hd.onerror=v=>Z(v),hd.onmessage=aX,R2=[c,Z];let i={type:"init-wasm",in:C};!i.in.wasm.wasmPaths&&(Y||import.meta.url?.startsWith("file:"))&&(i.in.wasm.wasmPaths={wasm:new URL(l("./node_modules/onnxruntime-web/dist/ort-wasm-simd-threaded.jsep.wasm"),l.b).href}),hd.postMessage(i),MV=Y}catch(i){Z(i)}},Z)});try{await ib(C.wasm),await Ne(C),yY=!0}catch(c){throw gY=!0,c}finally{Dt=!1}}},tX=async c=>{if(se())return Va(),new Promise((Z,Y)=>{ha("init-ep",[Z,Y]);let R={type:"init-ep",in:{epName:c,env:C}};hd.postMessage(R)});await Ya(C,c)},nX=async c=>se()?(Va(),new Promise((Z,Y)=>{ha("copy-from",[Z,Y]);let R={type:"copy-from",in:{buffer:c}};hd.postMessage(R,[c.buffer])})):yZ(c),mX=async(c,Z)=>{if(se()){if(Z?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return Va(),new Promise((Y,R)=>{ha("create",[Y,R]);let i={type:"create",in:{model:c,options:{...Z}}},v=[];c instanceof Uint8Array&&v.push(c.buffer),hd.postMessage(i,v)})}else return wY(c,Z)},NX=async c=>{if(se())return Va(),new Promise((Z,Y)=>{ha("release",[Z,Y]);let R={type:"release",in:c};hd.postMessage(R)});vY(c)},sX=async(c,Z,Y,R,i,v)=>{if(se()){if(Y.some(g=>g[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(i.some(g=>g))throw new Error("pre-allocated output tensor is not supported for proxy.");return Va(),new Promise((g,M)=>{ha("run",[g,M]);let j=Y,f={type:"run",in:{sessionId:c,inputIndices:Z,inputs:j,outputIndices:R,options:v}};hd.postMessage(f,u2(j))})}else return xd(c,Z,Y,R,i,v)},YX=async c=>{if(se())return Va(),new Promise((Z,Y)=>{ha("end-profiling",[Z,Y]);let R={type:"end-profiling",in:c};hd.postMessage(R)});wb(c)}}),o2,VX,pX,j1=n(()=>{"use strict";OI(),hX(),Sl(),uI(),_Z(),o2=(c,Z)=>{switch(c.location){case"cpu":return[c.type,c.dims,c.data,"cpu"];case"gpu-buffer":return[c.type,c.dims,{gpuBuffer:c.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[c.type,c.dims,{mlTensor:c.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${c.location} for ${Z()}`)}},VX=c=>{switch(c[3]){case"cpu":return new U(c[0],c[2],c[1]);case"gpu-buffer":{let Z=c[0];if(!iZ(Z))throw new Error(`not supported data type: ${Z} for deserializing GPU tensor`);let{gpuBuffer:Y,download:R,dispose:i}=c[2];return U.fromGpuBuffer(Y,{dataType:Z,dims:c[1],download:R,dispose:i})}case"ml-tensor":{let Z=c[0];if(!QZ(Z))throw new Error(`not supported data type: ${Z} for deserializing MLTensor tensor`);let{mlTensor:Y,download:R,dispose:i}=c[2];return U.fromMLTensor(Y,{dataType:Z,dims:c[1],download:R,dispose:i})}default:throw new Error(`invalid data location: ${c[3]}`)}},pX=class{async fetchModelAndCopyToWasmMemory(c){return nX(await rZ(c))}async loadModel(c,Z){A();let Y;typeof c=="string"?Y=await this.fetchModelAndCopyToWasmMemory(c):Y=c,[this.sessionId,this.inputNames,this.outputNames]=await mX(Y,Z),O()}async dispose(){return NX(this.sessionId)}async run(c,Z,Y){A();let R=[],i=[];Object.entries(c).forEach(x=>{let NI=x[0],rI=x[1],oI=this.inputNames.indexOf(NI);if(oI===-1)throw new Error(`invalid input '${NI}'`);R.push(rI),i.push(oI)});let v=[],g=[];Object.entries(Z).forEach(x=>{let NI=x[0],rI=x[1],oI=this.outputNames.indexOf(NI);if(oI===-1)throw new Error(`invalid output '${NI}'`);v.push(rI),g.push(oI)});let M=R.map((x,NI)=>o2(x,()=>`input "${this.inputNames[i[NI]]}"`)),j=v.map((x,NI)=>x?o2(x,()=>`output "${this.outputNames[g[NI]]}"`):null),f=await sX(this.sessionId,i,M,g,j,Y),mI={};for(let x=0;x<f.length;x++)mI[this.outputNames[g[x]]]=v[x]??VX(f[x]);return O(),mI}startProfiling(){}endProfiling(){YX(this.sessionId)}}}),uX={};s(uX,{OnnxruntimeWebAssemblyBackend:()=>X2,initializeFlags:()=>F2,wasmBackend:()=>RX});var F2,X2,RX,K1=n(()=>{"use strict";OI(),hX(),j1(),F2=()=>{if((typeof C.wasm.initTimeout!="number"||C.wasm.initTimeout<0)&&(C.wasm.initTimeout=0),C.wasm.simd===!1&&console.warn('Deprecated property "env.wasm.simd" is set to false. non-SIMD build is no longer provided, and this setting will be ignored.'),typeof C.wasm.proxy!="boolean"&&(C.wasm.proxy=!1),typeof C.wasm.trace!="boolean"&&(C.wasm.trace=!1),typeof C.wasm.numThreads!="number"||!Number.isInteger(C.wasm.numThreads)||C.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)C.wasm.numThreads=1;else{let c=typeof navigator>"u"?W("node:os").cpus().length:navigator.hardwareConcurrency;C.wasm.numThreads=Math.min(4,Math.ceil((c||1)/2))}},X2=class{async init(c){F2(),await WX(),await tX(c)}async createInferenceSessionHandler(c,Z){let Y=new pX;return await Y.loadModel(c,Z),Promise.resolve(Y)}},RX=new X2});OI(),OI(),OI();var T1="1.21.0-dev.20250206-d981b153d3",f1=vI;{let c=(K1(),m(uX)).wasmBackend;X("webgpu",c,5),X("webnn",c,5),X("cpu",c,10),X("wasm",c,10)}Object.defineProperty(C.versions,"web",{value:T1,enumerable:!0});},"./src/backends/onnx.js":(I,G,l)=>{var b;l.r(G),l.d(G,{Tensor:()=>W.Tensor,createInferenceSession:()=>F,deviceToExecutionProviders:()=>X,isONNXProxy:()=>Q,isONNXTensor:()=>a});var d=l("./src/env.js"),e=l("?2ce3"),t=l("./node_modules/onnxruntime-web/dist/ort.bundle.min.mjs?3a96"),W=l("./node_modules/onnxruntime-common/dist/esm/index.js");let n=Object.freeze({auto:null,gpu:null,cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:{name:"webnn",deviceType:"cpu"},"webnn-npu":{name:"webnn",deviceType:"npu"},"webnn-gpu":{name:"webnn",deviceType:"gpu"},"webnn-cpu":{name:"webnn",deviceType:"cpu"}}),s=[],N,m,h=Symbol.for("onnxruntime");if(h in globalThis)m=globalThis[h];else if(d.apis.IS_NODE_ENV){switch(m=e??(b||(b=l.t(e,2))),process.platform){case"win32":s.push("dml");break;case"linux":process.arch==="x64"&&s.push("cuda");break;case"darwin":break}s.push("cpu"),N=["cpu"]}else m=t,d.apis.IS_WEBNN_AVAILABLE&&s.push("webnn-npu","webnn-gpu","webnn-cpu","webnn"),d.apis.IS_WEBGPU_AVAILABLE&&s.push("webgpu"),s.push("wasm"),N=["wasm"];let V=m.InferenceSession;function X(o=null){if(!o)return N;switch(o){case"auto":return s;case"gpu":return s.filter(y=>["webgpu","cuda","dml","webnn-gpu"].includes(y))}if(s.includes(o))return[n[o]??o];throw new Error(`Unsupported device: "${o}". Should be one of: ${s.join(", ")}.`)}let p=null;async function F(o,y,H){p&&await p;let E=V.create(o,y);p??=E;let C=await E;return C.config=H,C}function a(o){return o instanceof m.Tensor}let u=m?.env;u?.wasm&&(u.wasm.wasmPaths=`https://cdn.jsdelivr.net/npm/@huggingface/transformers@${d.env.version}/dist/`,u.wasm.proxy=!1,(typeof crossOriginIsolated>"u"||!crossOriginIsolated)&&(u.wasm.numThreads=1)),u?.webgpu&&(u.webgpu.powerPreference="high-performance");function Q(){return u?.wasm?.proxy}d.env.backends.onnx=u},"./src/base/feature_extraction_utils.js":(I,G,l)=>{l.r(G),l.d(G,{FeatureExtractor:()=>t,validate_audio_inputs:()=>W});var b=l("./src/utils/constants.js"),d=l("./src/utils/generic.js"),e=l("./src/utils/hub.js");class t extends d.Callable{constructor(s){super(),this.config=s}static async from_pretrained(s,N){let m=await(0,e.getModelJSON)(s,b.FEATURE_EXTRACTOR_NAME,!0,N);return new this(m)}}function W(n,s){if(!(n instanceof Float32Array||n instanceof Float64Array))throw new Error(`${s} expects input to be a Float32Array or a Float64Array, but got ${n?.constructor?.name??typeof n} instead. If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`)}},"./src/base/image_processors_utils.js":(I,G,l)=>{l.r(G),l.d(G,{ImageProcessor:()=>y,center_to_corners_format:()=>h,post_process_instance_segmentation:()=>o,post_process_object_detection:()=>V,post_process_panoptic_segmentation:()=>Q,post_process_semantic_segmentation:()=>X});var b=l("./src/utils/generic.js"),d=l("./src/utils/tensor.js"),e=l("./src/utils/maths.js"),t=l("./src/utils/image.js"),W=l("./src/utils/core.js"),n=l("./src/utils/hub.js"),s=l("./src/utils/constants.js");function N(H,E,C=0,T=null){let S=H/E,cI=(0,e.bankers_round)(S)*E;return T!==null&&cI>T&&(cI=Math.floor(S)*E),cI<C&&(cI=Math.ceil(S)*E),cI}function m([H,E],C){return[Math.max(Math.floor(H/C),1)*C,Math.max(Math.floor(E/C),1)*C]}function h([H,E,C,T]){return[H-C/2,E-T/2,H+C/2,E+T/2]}function V(H,E=.5,C=null,T=!1){let S=H.logits,cI=H.pred_boxes,[hI,WI,VI]=S.dims;if(C!==null&&C.length!==hI)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let sI=[];for(let ZI=0;ZI<hI;++ZI){let dI=C!==null?C[ZI]:null,pI={boxes:[],classes:[],scores:[]},yI=S[ZI],eI=cI[ZI];for(let HI=0;HI<WI;++HI){let YI=yI[HI],$=[],JI;if(T){JI=YI.sigmoid().data;for(let UI=0;UI<JI.length;++UI)JI[UI]>E&&$.push(UI)}else{let UI=(0,e.max)(YI.data)[1];if(UI===VI-1||(JI=(0,e.softmax)(YI.data),JI[UI]<E))continue;$.push(UI)}for(let UI of $){let zI=eI[HI].data;zI=h(zI),dI!==null&&(zI=zI.map((L,bI)=>L*dI[(bI+1)%2])),pI.boxes.push(zI),pI.classes.push(UI),pI.scores.push(JI[UI])}}sI.push(pI)}return sI}function X(H,E=null){let C=H.logits,T=C.dims[0];if(E!==null&&E.length!==T)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let S=[];for(let cI=0;cI<T;++cI){let hI=E!==null?E[cI]:null,WI=C[cI];hI!==null&&(WI=(0,d.interpolate)(WI,hI,"bilinear",!1));let[VI,sI]=hI??WI.dims.slice(-2),ZI=new d.Tensor("int32",new Int32Array(VI*sI),[VI,sI]),dI=WI[0].data,pI=ZI.data;for(let HI=1;HI<WI.dims[0];++HI){let YI=WI[HI].data;for(let $=0;$<YI.length;++$)YI[$]>dI[$]&&(dI[$]=YI[$],pI[$]=HI)}let yI=new Array(WI.dims[0]);for(let HI=0;HI<pI.length;++HI){let YI=pI[HI];yI[YI]=YI}let eI=yI.filter(HI=>HI!==void 0);S.push({segmentation:ZI,labels:eI})}return S}function p(H,E,C,T){let S=[],cI=[],hI=[];for(let WI=0;WI<H.dims[0];++WI){let VI=H[WI],sI=E[WI],ZI=(0,e.max)(VI.data)[1];if(ZI===T)continue;let pI=(0,e.softmax)(VI.data)[ZI];pI>C&&(S.push(sI),cI.push(pI),hI.push(ZI))}return[S,cI,hI]}function F(H,E,C,T=.5,S=.8){let cI=[],hI=0,WI=0,VI=E[C].data;for(let ZI=0;ZI<H.length;++ZI)H[ZI]===C&&(cI.push(ZI),++hI),VI[ZI]>=T&&++WI;let sI=hI>0&&WI>0;return sI&&(sI=hI/WI>S),[sI,cI]}function a(H,E,C,T,S,cI=null,hI=null){let[WI,VI]=hI??H[0].dims,sI=new d.Tensor("int32",new Int32Array(WI*VI),[WI,VI]),ZI=[];if(hI!==null)for(let HI=0;HI<H.length;++HI)H[HI]=(0,d.interpolate)(H[HI],hI,"bilinear",!1);let dI=new Int32Array(H[0].data.length),pI=new Float32Array(H[0].data.length);for(let HI=0;HI<H.length;++HI){let YI=E[HI],$=H[HI].data;for(let JI=0;JI<$.length;++JI)$[JI]*=YI,$[JI]>pI[JI]&&(dI[JI]=HI,pI[JI]=$[JI])}let yI=0,eI=sI.data;for(let HI=0;HI<C.length;++HI){let YI=C[HI],[$,JI]=F(dI,H,HI,T,S);if($){++yI;for(let UI of JI)eI[UI]=yI;ZI.push({id:yI,label_id:YI,score:E[HI]})}}return[sI,ZI]}function u(H,E,C=28,T=3136,S=1003520){if(H<C||E<C)throw new Error(`height:${H} or width:${E} must be larger than factor:${C}`);if(Math.max(H,E)/Math.min(H,E)>200)throw new Error(`absolute aspect ratio must be smaller than 200, got ${Math.max(H,E)/Math.min(H,E)}`);let cI=Math.round(H/C)*C,hI=Math.round(E/C)*C;if(cI*hI>S){let WI=Math.sqrt(H*E/S);cI=Math.floor(H/WI/C)*C,hI=Math.floor(E/WI/C)*C}else if(cI*hI<T){let WI=Math.sqrt(T/(H*E));cI=Math.ceil(H*WI/C)*C,hI=Math.ceil(E*WI/C)*C}return[cI,hI]}function Q(H,E=.5,C=.5,T=.8,S=null,cI=null){S===null&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),S=new Set);let hI=H.class_queries_logits??H.logits,VI=(H.masks_queries_logits??H.pred_masks).sigmoid(),[sI,ZI,dI]=hI.dims;if(dI-=1,cI!==null&&cI.length!==sI)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let pI=[];for(let yI=0;yI<sI;++yI){let eI=cI!==null?cI[yI]:null,HI=hI[yI],YI=VI[yI],[$,JI,UI]=p(HI,YI,E,dI);if(UI.length===0){let[bI,FI]=eI??YI.dims.slice(-2),U=new d.Tensor("int32",new Int32Array(bI*FI).fill(-1),[bI,FI]);pI.push({segmentation:U,segments_info:[]});continue}let[zI,L]=a($,JI,UI,C,T,S,eI);pI.push({segmentation:zI,segments_info:L})}return pI}function o(H,E=.5,C=null){throw new Error("`post_process_instance_segmentation` is not yet implemented.")}class y extends b.Callable{constructor(E){super(),this.image_mean=E.image_mean??E.mean,this.image_std=E.image_std??E.std,this.resample=E.resample??2,this.do_rescale=E.do_rescale??!0,this.rescale_factor=E.rescale_factor??.00392156862745098,this.do_normalize=E.do_normalize,this.do_thumbnail=E.do_thumbnail,this.size=E.size??E.image_size,this.do_resize=E.do_resize??this.size!==void 0,this.size_divisibility=E.size_divisibility??E.size_divisor,this.do_center_crop=E.do_center_crop,this.crop_size=E.crop_size,this.do_convert_rgb=E.do_convert_rgb??!0,this.do_crop_margin=E.do_crop_margin,this.pad_size=E.pad_size,this.do_pad=E.do_pad,this.do_pad&&!this.pad_size&&this.size&&this.size.width!==void 0&&this.size.height!==void 0&&(this.pad_size=this.size),this.do_flip_channel_order=E.do_flip_channel_order??!1,this.config=E}async thumbnail(E,C,T=2){let S=E.height,cI=E.width,hI=C.height,WI=C.width,VI=Math.min(S,hI),sI=Math.min(cI,WI);return VI===S&&sI===cI?E:(S>cI?sI=Math.floor(cI*VI/S):cI>S&&(VI=Math.floor(S*sI/cI)),await E.resize(sI,VI,{resample:T}))}async crop_margin(E,C=200){let T=E.clone().grayscale(),S=(0,e.min)(T.data)[0],hI=(0,e.max)(T.data)[0]-S;if(hI===0)return E;let WI=C/255,VI=T.width,sI=T.height,ZI=0,dI=0,pI=T.data;for(let yI=0;yI<T.height;++yI){let eI=yI*T.width;for(let HI=0;HI<T.width;++HI)(pI[eI+HI]-S)/hI<WI&&(VI=Math.min(VI,HI),sI=Math.min(sI,yI),ZI=Math.max(ZI,HI),dI=Math.max(dI,yI))}return E=await E.crop([VI,sI,ZI,dI]),E}pad_image(E,C,T,{mode:S="constant",center:cI=!1,constant_values:hI=0}={}){let[WI,VI,sI]=C,ZI,dI;if(typeof T=="number"?(ZI=T,dI=T):T==="square"?ZI=dI=Math.max(WI,VI):(ZI=T.width,dI=T.height),ZI!==VI||dI!==WI){let pI=new Float32Array(ZI*dI*sI);if(Array.isArray(hI))for(let HI=0;HI<pI.length;++HI)pI[HI]=hI[HI%sI];else hI!==0&&pI.fill(hI);let[yI,eI]=cI?[Math.floor((ZI-VI)/2),Math.floor((dI-WI)/2)]:[0,0];for(let HI=0;HI<WI;++HI){let YI=(HI+eI)*ZI,$=HI*VI;for(let JI=0;JI<VI;++JI){let UI=(YI+JI+yI)*sI,zI=($+JI)*sI;for(let L=0;L<sI;++L)pI[UI+L]=E[zI+L]}}if(S==="symmetric"){if(cI)throw new Error("`center` padding is not supported when `mode` is set to `symmetric`.");let HI=WI-1,YI=VI-1;for(let $=0;$<dI;++$){let JI=$*ZI,UI=(0,W.calculateReflectOffset)($,HI)*VI;for(let zI=0;zI<ZI;++zI){if($<WI&&zI<VI)continue;let L=(JI+zI)*sI,bI=(UI+(0,W.calculateReflectOffset)(zI,YI))*sI;for(let FI=0;FI<sI;++FI)pI[L+FI]=E[bI+FI]}}}E=pI,C=[dI,ZI,sI]}return[E,C]}rescale(E){for(let C=0;C<E.length;++C)E[C]=this.rescale_factor*E[C]}get_resize_output_image_size(E,C){let[T,S]=E.size,cI,hI;if(this.do_thumbnail){let{height:WI,width:VI}=C;cI=Math.min(WI,VI)}else Number.isInteger(C)?(cI=C,hI=this.config.max_size??cI):C!==void 0&&(cI=C.shortest_edge,hI=C.longest_edge);if(cI!==void 0||hI!==void 0){let WI=cI===void 0?1:Math.max(cI/T,cI/S),VI=T*WI,sI=S*WI,ZI=hI===void 0?1:Math.min(hI/VI,hI/sI),dI=Math.floor(Number((VI*ZI).toFixed(2))),pI=Math.floor(Number((sI*ZI).toFixed(2)));return this.size_divisibility!==void 0&&([dI,pI]=m([dI,pI],this.size_divisibility)),[dI,pI]}else if(C!==void 0&&C.width!==void 0&&C.height!==void 0){let WI=C.width,VI=C.height;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let sI=VI/S,ZI=WI/T;Math.abs(1-ZI)<Math.abs(1-sI)?sI=ZI:ZI=sI,VI=N(sI*S,this.config.ensure_multiple_of),WI=N(ZI*T,this.config.ensure_multiple_of)}return[WI,VI]}else{if(this.size_divisibility!==void 0)return m([T,S],this.size_divisibility);if(C.min_pixels!==void 0&&C.max_pixels!==void 0){let{min_pixels:WI,max_pixels:VI}=C,sI=this.config.patch_size*this.config.merge_size;return u(S,T,sI,WI,VI)}else throw new Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(C)}`)}}async resize(E){let[C,T]=this.get_resize_output_image_size(E,this.size);return await E.resize(C,T,{resample:this.resample})}async preprocess(E,{do_normalize:C=null,do_pad:T=null,do_convert_rgb:S=null,do_convert_grayscale:cI=null,do_flip_channel_order:hI=null}={}){this.do_crop_margin&&(E=await this.crop_margin(E));let[WI,VI]=E.size;if(S??this.do_convert_rgb?E=E.rgb():cI&&(E=E.grayscale()),this.do_resize&&(E=await this.resize(E)),this.do_thumbnail&&(E=await this.thumbnail(E,this.size,this.resample)),this.do_center_crop){let yI,eI;Number.isInteger(this.crop_size)?(yI=this.crop_size,eI=this.crop_size):(yI=this.crop_size.width,eI=this.crop_size.height),E=await E.center_crop(yI,eI)}let sI=[E.height,E.width],ZI=Float32Array.from(E.data),dI=[E.height,E.width,E.channels];if(this.do_rescale&&this.rescale(ZI),C??this.do_normalize){let yI=this.image_mean;Array.isArray(this.image_mean)||(yI=new Array(E.channels).fill(yI));let eI=this.image_std;if(Array.isArray(this.image_std)||(eI=new Array(E.channels).fill(yI)),yI.length!==E.channels||eI.length!==E.channels)throw new Error(`When set to arrays, the length of \`image_mean\` (${yI.length}) and \`image_std\` (${eI.length}) must match the number of channels in the image (${E.channels}).`);for(let HI=0;HI<ZI.length;HI+=E.channels)for(let YI=0;YI<E.channels;++YI)ZI[HI+YI]=(ZI[HI+YI]-yI[YI])/eI[YI]}if(T??this.do_pad){if(this.pad_size)[ZI,dI]=this.pad_image(ZI,[E.height,E.width,E.channels],this.pad_size);else if(this.size_divisibility){let[yI,eI]=m([dI[1],dI[0]],this.size_divisibility);[ZI,dI]=this.pad_image(ZI,dI,{width:yI,height:eI})}}if(hI??this.do_flip_channel_order){if(dI[2]!==3)throw new Error("Flipping channel order is only supported for RGB images.");for(let yI=0;yI<ZI.length;yI+=3){let eI=ZI[yI];ZI[yI]=ZI[yI+2],ZI[yI+2]=eI}}let pI=new d.Tensor("float32",ZI,dI).permute(2,0,1);return{original_size:[VI,WI],reshaped_input_size:sI,pixel_values:pI}}async _call(E,...C){Array.isArray(E)||(E=[E]);let T=await Promise.all(E.map(cI=>this.preprocess(cI)));return{pixel_values:(0,d.stack)(T.map(cI=>cI.pixel_values),0),original_sizes:T.map(cI=>cI.original_size),reshaped_input_sizes:T.map(cI=>cI.reshaped_input_size)}}static async from_pretrained(E,C){let T=await(0,n.getModelJSON)(E,s.IMAGE_PROCESSOR_NAME,!0,C);return new this(T)}}},"./src/base/processing_utils.js":(I,G,l)=>{l.r(G),l.d(G,{Processor:()=>t});var b=l("./src/utils/constants.js"),d=l("./src/utils/generic.js"),e=l("./src/utils/hub.js");class t extends d.Callable{static classes=["image_processor_class","tokenizer_class","feature_extractor_class"];static uses_processor_config=!1;constructor(n,s){super(),this.config=n,this.components=s}get image_processor(){return this.components.image_processor}get tokenizer(){return this.components.tokenizer}get feature_extractor(){return this.components.feature_extractor}apply_chat_template(n,s={}){if(!this.tokenizer)throw new Error("Unable to apply chat template without a tokenizer.");return this.tokenizer.apply_chat_template(n,{tokenize:!1,...s})}batch_decode(...n){if(!this.tokenizer)throw new Error("Unable to decode without a tokenizer.");return this.tokenizer.batch_decode(...n)}decode(...n){if(!this.tokenizer)throw new Error("Unable to decode without a tokenizer.");return this.tokenizer.decode(...n)}async _call(n,...s){for(let N of[this.image_processor,this.feature_extractor,this.tokenizer])if(N)return N(n,...s);throw new Error("No image processor, feature extractor, or tokenizer found.")}static async from_pretrained(n,s){let[N,m]=await Promise.all([this.uses_processor_config?(0,e.getModelJSON)(n,b.PROCESSOR_NAME,!0,s):{},Promise.all(this.classes.filter(h=>h in this).map(async h=>{let V=await this[h].from_pretrained(n,s);return[h.replace(/_class$/,""),V]})).then(Object.fromEntries)]);return new this(N,m)}}},"./src/configs.js":(I,G,l)=>{l.r(G),l.d(G,{AutoConfig:()=>s,PretrainedConfig:()=>n,getKeyValueShapes:()=>W});var b=l("./src/utils/core.js"),d=l("./src/utils/hub.js");async function e(N,m){return await(0,d.getModelJSON)(N,"config.json",!0,m)}function t(N){let m={},h={};switch(N.model_type){case"llava":case"paligemma":case"florence2":case"llava_onevision":case"idefics3":h=t(N.text_config);break;case"moondream1":h=t(N.phi_config);break;case"musicgen":h=t(N.decoder);break;case"multi_modality":h=t(N.language_config);break;case"gpt2":case"gptj":case"jais":case"codegen":case"gpt_bigcode":m.num_heads="n_head",m.num_layers="n_layer",m.hidden_size="n_embd";break;case"gpt_neox":case"stablelm":case"opt":case"falcon":m.num_heads="num_attention_heads",m.num_layers="num_hidden_layers",m.hidden_size="hidden_size";break;case"llama":case"olmo":case"olmo2":case"mobilellm":case"granite":case"cohere":case"mistral":case"starcoder2":case"qwen2":case"qwen2_vl":case"phi":case"phi3":case"phi3_v":m.num_heads="num_key_value_heads",m.num_layers="num_hidden_layers",m.hidden_size="hidden_size",m.num_attention_heads="num_attention_heads";break;case"gemma":case"gemma2":case"glm":case"helium":m.num_heads="num_key_value_heads",m.num_layers="num_hidden_layers",m.dim_kv="head_dim";break;case"openelm":m.num_heads="num_kv_heads",m.num_layers="num_transformer_layers",m.dim_kv="head_dim";break;case"gpt_neo":case"donut-swin":m.num_heads="num_heads",m.num_layers="num_layers",m.hidden_size="hidden_size";break;case"bloom":m.num_heads="n_head",m.num_layers="n_layer",m.hidden_size="hidden_size";break;case"mpt":m.num_heads="n_heads",m.num_layers="n_layers",m.hidden_size="d_model";break;case"exaone":m.num_heads="num_key_value_heads",m.num_layers="num_layers",m.dim_kv="head_dim",m.num_attention_heads="num_attention_heads";break;case"t5":case"mt5":case"longt5":m.num_decoder_layers="num_decoder_layers",m.num_decoder_heads="num_heads",m.decoder_dim_kv="d_kv",m.num_encoder_layers="num_layers",m.num_encoder_heads="num_heads",m.encoder_dim_kv="d_kv";break;case"bart":case"mbart":case"marian":case"whisper":case"m2m_100":case"blenderbot":case"blenderbot-small":case"florence2_language":m.num_decoder_layers="decoder_layers",m.num_decoder_heads="decoder_attention_heads",m.decoder_hidden_size="d_model",m.num_encoder_layers="encoder_layers",m.num_encoder_heads="encoder_attention_heads",m.encoder_hidden_size="d_model";break;case"speecht5":m.num_decoder_layers="decoder_layers",m.num_decoder_heads="decoder_attention_heads",m.decoder_hidden_size="hidden_size",m.num_encoder_layers="encoder_layers",m.num_encoder_heads="encoder_attention_heads",m.encoder_hidden_size="hidden_size";break;case"trocr":m.num_encoder_layers=m.num_decoder_layers="decoder_layers",m.num_encoder_heads=m.num_decoder_heads="decoder_attention_heads",m.encoder_hidden_size=m.decoder_hidden_size="d_model";break;case"musicgen_decoder":m.num_encoder_layers=m.num_decoder_layers="num_hidden_layers",m.num_encoder_heads=m.num_decoder_heads="num_attention_heads",m.encoder_hidden_size=m.decoder_hidden_size="hidden_size";break;case"moonshine":m.num_decoder_layers="decoder_num_hidden_layers",m.num_decoder_heads="decoder_num_key_value_heads",m.num_encoder_layers="encoder_num_hidden_layers",m.num_encoder_heads="encoder_num_key_value_heads",m.encoder_hidden_size=m.decoder_hidden_size="hidden_size";break;case"vision-encoder-decoder":let X=t(N.decoder),p="num_decoder_layers"in X,F=(0,b.pick)(N,["model_type","is_encoder_decoder"]);return p?(F.num_decoder_layers=X.num_decoder_layers,F.num_decoder_heads=X.num_decoder_heads,F.decoder_hidden_size=X.decoder_hidden_size,F.num_encoder_layers=X.num_encoder_layers,F.num_encoder_heads=X.num_encoder_heads,F.encoder_hidden_size=X.encoder_hidden_size):(F.num_layers=X.num_layers,F.num_heads=X.num_heads,F.hidden_size=X.hidden_size),F}let V={...h,...(0,b.pick)(N,["model_type","multi_query","is_encoder_decoder"])};for(let X in m)V[X]=N[m[X]];return V}function W(N,{prefix:m="past_key_values",batch_size:h=1}={}){let V={},X=N.normalized_config;if(X.is_encoder_decoder&&"num_encoder_heads"in X&&"num_decoder_heads"in X){let p=X.encoder_dim_kv??X.encoder_hidden_size/X.num_encoder_heads,F=X.decoder_dim_kv??X.decoder_hidden_size/X.num_decoder_heads,a=[h,X.num_encoder_heads,0,p],u=[h,X.num_decoder_heads,0,F];for(let Q=0;Q<X.num_decoder_layers;++Q)V[`${m}.${Q}.encoder.key`]=a,V[`${m}.${Q}.encoder.value`]=a,V[`${m}.${Q}.decoder.key`]=u,V[`${m}.${Q}.decoder.value`]=u}else{let p=X.num_heads,F=X.num_layers,a=X.dim_kv??X.hidden_size/(X.num_attention_heads??p);if(X.model_type==="falcon"){let u=[h*p,0,a];for(let Q=0;Q<F;++Q)V[`${m}.${Q}.key`]=u,V[`${m}.${Q}.value`]=u}else if(X.multi_query){let u=[h*p,0,2*a];for(let Q=0;Q<F;++Q)V[`${m}.${Q}.key_value`]=u}else if(X.model_type==="bloom"){let u=[h*p,a,0],Q=[h*p,0,a];for(let o=0;o<F;++o)V[`${m}.${o}.key`]=u,V[`${m}.${o}.value`]=Q}else if(X.model_type==="openelm")for(let u=0;u<F;++u){let Q=[h,p[u],0,a];V[`${m}.${u}.key`]=Q,V[`${m}.${u}.value`]=Q}else{let u=[h,p,0,a];for(let Q=0;Q<F;++Q)V[`${m}.${Q}.key`]=u,V[`${m}.${Q}.value`]=u}}return V}class n{model_type=null;is_encoder_decoder=!1;max_position_embeddings;"transformers.js_config";constructor(m){Object.assign(this,m),this.normalized_config=t(this)}static async from_pretrained(m,{progress_callback:h=null,config:V=null,cache_dir:X=null,local_files_only:p=!1,revision:F="main"}={}){V&&!(V instanceof n)&&(V=new n(V));let a=V??await e(m,{progress_callback:h,config:V,cache_dir:X,local_files_only:p,revision:F});return new this(a)}}class s{static async from_pretrained(...m){return n.from_pretrained(...m)}}},"./src/env.js":(I,G,l)=>{l.r(G),l.d(G,{apis:()=>F,env:()=>H});var b=l("?569f"),d=l("?3f59"),e=l("?154a");let t="3.3.3",W=typeof window<"u"&&typeof window.document<"u",n=typeof self<"u"&&self.constructor?.name==="DedicatedWorkerGlobalScope",s=typeof self<"u"&&"caches"in self,N=typeof navigator<"u"&&"gpu"in navigator,m=typeof navigator<"u"&&"ml"in navigator,h=typeof process<"u",V=h&&process?.release?.name==="node",X=!E(b),p=!E(d),F=Object.freeze({IS_BROWSER_ENV:W,IS_WEBWORKER_ENV:n,IS_WEB_CACHE_AVAILABLE:s,IS_WEBGPU_AVAILABLE:N,IS_WEBNN_AVAILABLE:m,IS_PROCESS_AVAILABLE:h,IS_NODE_ENV:V,IS_FS_AVAILABLE:X,IS_PATH_AVAILABLE:p}),a=X&&p,u="./";if(a){let C=Object(import.meta).url;C?u=d.dirname(d.dirname(e.fileURLToPath(C))):typeof __dirname<"u"&&(u=d.dirname(__dirname))}let Q=a?d.join(u,"/.cache/"):null,o="/models/",y=a?d.join(u,o):o,H={version:t,backends:{onnx:{}},allowRemoteModels:!0,remoteHost:"https://huggingface.co/",remotePathTemplate:"{model}/resolve/{revision}/",allowLocalModels:!(W||n),localModelPath:y,useFS:X,useBrowserCache:s,useFSCache:X,cacheDir:Q,useCustomCache:!1,customCache:null};function E(C){return Object.keys(C).length===0}},"./src/generation/configuration_utils.js":(I,G,l)=>{l.r(G),l.d(G,{GenerationConfig:()=>d});var b=l("./src/utils/core.js");class d{max_length=20;max_new_tokens=null;min_length=0;min_new_tokens=null;early_stopping=!1;max_time=null;do_sample=!1;num_beams=1;num_beam_groups=1;penalty_alpha=null;use_cache=!0;temperature=1;top_k=50;top_p=1;typical_p=1;epsilon_cutoff=0;eta_cutoff=0;diversity_penalty=0;repetition_penalty=1;encoder_repetition_penalty=1;length_penalty=1;no_repeat_ngram_size=0;bad_words_ids=null;force_words_ids=null;renormalize_logits=!1;constraints=null;forced_bos_token_id=null;forced_eos_token_id=null;remove_invalid_values=!1;exponential_decay_length_penalty=null;suppress_tokens=null;streamer=null;begin_suppress_tokens=null;forced_decoder_ids=null;guidance_scale=null;num_return_sequences=1;output_attentions=!1;output_hidden_states=!1;output_scores=!1;return_dict_in_generate=!1;pad_token_id=null;bos_token_id=null;eos_token_id=null;encoder_no_repeat_ngram_size=0;decoder_start_token_id=null;generation_kwargs={};constructor(t){Object.assign(this,(0,b.pick)(t,Object.getOwnPropertyNames(this)))}}},"./src/generation/logits_process.js":(I,G,l)=>{l.r(G),l.d(G,{ClassifierFreeGuidanceLogitsProcessor:()=>u,ForcedBOSTokenLogitsProcessor:()=>s,ForcedEOSTokenLogitsProcessor:()=>N,LogitsProcessor:()=>t,LogitsProcessorList:()=>n,LogitsWarper:()=>W,MinLengthLogitsProcessor:()=>p,MinNewTokensLengthLogitsProcessor:()=>F,NoBadWordsLogitsProcessor:()=>a,NoRepeatNGramLogitsProcessor:()=>V,RepetitionPenaltyLogitsProcessor:()=>X,SuppressTokensAtBeginLogitsProcessor:()=>m,TemperatureLogitsWarper:()=>Q,TopKLogitsWarper:()=>y,TopPLogitsWarper:()=>o,WhisperTimeStampLogitsProcessor:()=>h});var b=l("./src/utils/generic.js"),d=l("./src/utils/tensor.js"),e=l("./src/utils/maths.js");class t extends b.Callable{_call(E,C){throw Error("`_call` should be implemented in a subclass")}}class W extends b.Callable{_call(E,C){throw Error("`_call` should be implemented in a subclass")}}class n extends b.Callable{constructor(){super(),this.processors=[]}push(E){this.processors.push(E)}extend(E){this.processors.push(...E)}_call(E,C){let T=C;for(let S of this.processors)T=S(E,T);return T}[Symbol.iterator](){return this.processors.values()}}class s extends t{constructor(E){super(),this.bos_token_id=E}_call(E,C){for(let T=0;T<E.length;++T)if(E[T].length===1){let S=C[T].data;S.fill(-1/0),S[this.bos_token_id]=0}return C}}class N extends t{constructor(E,C){super(),this.max_length=E,this.eos_token_id=Array.isArray(C)?C:[C]}_call(E,C){for(let T=0;T<E.length;++T)if(E[T].length===this.max_length-1){let S=C[T].data;S.fill(-1/0);for(let cI of this.eos_token_id)S[cI]=0}return C}}class m extends t{constructor(E,C){super(),this.begin_suppress_tokens=E,this.begin_index=C}_call(E,C){for(let T=0;T<E.length;++T)if(E[T].length===this.begin_index){let S=C[T].data;for(let cI of this.begin_suppress_tokens)S[cI]=-1/0}return C}}class h extends t{constructor(E,C){super(),this.eos_token_id=Array.isArray(E.eos_token_id)?E.eos_token_id[0]:E.eos_token_id,this.no_timestamps_token_id=E.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=C.length,C.at(-1)===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=E.max_initial_timestamp_index}_call(E,C){for(let T=0;T<E.length;++T){let S=C[T].data;if(S[this.no_timestamps_token_id]=-1/0,E[T].length===this.begin_index-1){S.fill(-1/0),S[this.timestamp_begin]=0;continue}let cI=E[T].slice(this.begin_index),hI=cI.length>=1&&cI[cI.length-1]>=this.timestamp_begin,WI=cI.length<2||cI[cI.length-2]>=this.timestamp_begin;if(hI&&(WI?S.subarray(this.timestamp_begin).fill(-1/0):S.subarray(0,this.eos_token_id).fill(-1/0)),E[T].length===this.begin_index&&this.max_initial_timestamp_index!==null){let dI=this.timestamp_begin+this.max_initial_timestamp_index;S.subarray(dI+1).fill(-1/0)}let VI=(0,e.log_softmax)(S),sI=Math.log(VI.subarray(this.timestamp_begin).map(Math.exp).reduce((dI,pI)=>dI+pI)),ZI=(0,e.max)(VI.subarray(0,this.timestamp_begin))[0];sI>ZI&&S.subarray(0,this.timestamp_begin).fill(-1/0)}return C}}class V extends t{constructor(E){super(),this.no_repeat_ngram_size=E}getNgrams(E){let C=E.length,T=[];for(let cI=0;cI<C+1-this.no_repeat_ngram_size;++cI){let hI=[];for(let WI=0;WI<this.no_repeat_ngram_size;++WI)hI.push(E[cI+WI]);T.push(hI.map(Number))}let S=new Map;for(let cI of T){let hI=cI.slice(0,cI.length-1),WI=JSON.stringify(hI),VI=S.get(WI)??[];VI.push(cI[cI.length-1]),S.set(WI,VI)}return S}getGeneratedNgrams(E,C){let T=C.slice(C.length+1-this.no_repeat_ngram_size,C.length);return E.get(JSON.stringify(T.map(Number)))??[]}calcBannedNgramTokens(E){let C=[];if(E.length+1<this.no_repeat_ngram_size)return C;{let T=this.getNgrams(E);return this.getGeneratedNgrams(T,E)}}_call(E,C){for(let T=0;T<E.length;++T){let S=C[T].data,cI=this.calcBannedNgramTokens(E[T]);for(let hI of cI)S[hI]=-1/0}return C}}class X extends t{constructor(E){super(),this.penalty=E}_call(E,C){for(let T=0;T<E.length;++T){let S=C[T].data;for(let cI of new Set(E[T])){let hI=Number(cI);S[hI]<0?S[hI]*=this.penalty:S[hI]/=this.penalty}}return C}}class p extends t{constructor(E,C){super(),this.min_length=E,this.eos_token_id=Array.isArray(C)?C:[C]}_call(E,C){for(let T=0;T<E.length;++T)if(E[T].length<this.min_length){let S=C[T].data;for(let cI of this.eos_token_id)S[cI]=-1/0}return C}}class F extends t{constructor(E,C,T){super(),this.prompt_length_to_skip=E,this.min_new_tokens=C,this.eos_token_id=Array.isArray(T)?T:[T]}_call(E,C){for(let T=0;T<E.length;++T)if(E[T].length-this.prompt_length_to_skip<this.min_new_tokens){let cI=C[T].data;for(let hI of this.eos_token_id)cI[hI]=-1/0}return C}}class a extends t{constructor(E,C){super(),this.bad_words_ids=E,this.eos_token_id=Array.isArray(C)?C:[C]}_call(E,C){for(let T=0;T<E.length;++T){let S=C[T].data,cI=E[T];for(let hI of this.bad_words_ids){let WI=!0;for(let VI=1;VI<=hI.length-1&&hI.length<cI.length;++VI)if(hI.at(-VI-1)!=cI.at(-VI)){WI=!1;break}WI&&(S[hI.at(-1)]=-1/0)}}return C}}class u extends t{constructor(E){if(super(),E<=1)throw new Error(`Require guidance scale >1 to use the classifier free guidance processor, got guidance scale ${E}.`);this.guidance_scale=E}_call(E,C){if(C.dims[0]!==2*E.length)throw new Error(`Logits should have twice the batch size of the input ids, the first half of batches corresponding to the conditional inputs, and the second half of batches corresponding to the unconditional inputs. Got batch size ${C.dims[0]} for the logits and ${E.length} for the input ids.`);let T=E.length,S=C.slice([0,T],null),cI=C.slice([T,C.dims[0]],null);for(let hI=0;hI<cI.data.length;++hI)cI.data[hI]+=(S.data[hI]-cI.data[hI])*this.guidance_scale;return cI}}class Q extends W{constructor(E){if(super(),typeof E!="number"||E<=0){let C=`\`temperature\` (=${E}) must be a strictly positive float, otherwise your next token scores will be invalid.`;E===0&&(C+=" If you're looking for greedy decoding strategies, set `do_sample=false`.")}this.temperature=E}_call(E,C){let T=C.data;for(let S=0;S<T.length;++S)T[S]/=this.temperature;return C}}class o extends W{constructor(E,{filter_value:C=-1/0,min_tokens_to_keep:T=1}={}){if(super(),E<0||E>1)throw new Error(`\`top_p\` must be a float > 0 and < 1, but is ${E}`);if(!Number.isInteger(T)||T<1)throw new Error(`\`min_tokens_to_keep\` must be a positive integer, but is ${T}`);this.top_p=E,this.filter_value=C,this.min_tokens_to_keep=T}}class y extends W{constructor(E,{filter_value:C=-1/0,min_tokens_to_keep:T=1}={}){if(super(),!Number.isInteger(E)||E<0)throw new Error(`\`top_k\` must be a positive integer, but is ${E}`);this.top_k=Math.max(E,T),this.filter_value=C}}},"./src/generation/logits_sampler.js":(I,G,l)=>{l.r(G),l.d(G,{LogitsSampler:()=>W});var b=l("./src/utils/generic.js"),d=l("./src/utils/tensor.js"),e=l("./src/utils/maths.js"),t=l("./src/generation/configuration_utils.js");class W extends b.Callable{constructor(h){super(),this.generation_config=h}async _call(h){return this.sample(h)}async sample(h){throw Error("sample should be implemented in subclasses.")}getLogits(h,V){let X=h.dims.at(-1),p=h.data;if(V===-1)p=p.slice(-X);else{let F=V*X;p=p.slice(F,F+X)}return p}randomSelect(h){let V=0;for(let p=0;p<h.length;++p)V+=h[p];let X=Math.random()*V;for(let p=0;p<h.length;++p)if(X-=h[p],X<=0)return p;return 0}static getSampler(h){if(h.do_sample)return new s(h);if(h.num_beams>1)return new N(h);if(h.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${h.num_return_sequences}.`);return new n(h)}}class n extends W{async sample(h){let V=(0,e.max)(h.data)[1];return[[BigInt(V),0]]}}class s extends W{async sample(h){let V=h.dims.at(-1);this.generation_config.top_k>0&&(V=Math.min(this.generation_config.top_k,V));let[X,p]=await(0,d.topk)(h,V),F=(0,e.softmax)(X.data);return Array.from({length:this.generation_config.num_beams},()=>{let a=this.randomSelect(F);return[p.data[a],Math.log(F[a])]})}}class N extends W{async sample(h){let V=h.dims.at(-1);this.generation_config.top_k>0&&(V=Math.min(this.generation_config.top_k,V));let[X,p]=await(0,d.topk)(h,V),F=(0,e.softmax)(X.data);return Array.from({length:this.generation_config.num_beams},(a,u)=>[p.data[u],Math.log(F[u])])}}},"./src/generation/stopping_criteria.js":(I,G,l)=>{l.r(G),l.d(G,{EosTokenCriteria:()=>W,InterruptableStoppingCriteria:()=>n,MaxLengthCriteria:()=>t,StoppingCriteria:()=>d,StoppingCriteriaList:()=>e});var b=l("./src/utils/generic.js");class d extends b.Callable{_call(N,m){throw Error("StoppingCriteria needs to be subclassed")}}class e extends b.Callable{constructor(){super(),this.criteria=[]}push(N){this.criteria.push(N)}extend(N){N instanceof e?N=N.criteria:N instanceof d&&(N=[N]),this.criteria.push(...N)}_call(N,m){let h=new Array(N.length).fill(!1);for(let V of this.criteria){let X=V(N,m);for(let p=0;p<h.length;++p)h[p]||=X[p]}return h}[Symbol.iterator](){return this.criteria.values()}}class t extends d{constructor(N,m=null){super(),this.max_length=N,this.max_position_embeddings=m}_call(N){return N.map(m=>m.length>=this.max_length)}}class W extends d{constructor(N){super(),Array.isArray(N)||(N=[N]),this.eos_token_id=N}_call(N,m){return N.map(h=>{let V=h.at(-1);return this.eos_token_id.some(X=>V==X)})}}class n extends d{constructor(){super(),this.interrupted=!1}interrupt(){this.interrupted=!0}reset(){this.interrupted=!1}_call(N,m){return new Array(N.length).fill(this.interrupted)}}},"./src/generation/streamers.js":(I,G,l)=>{l.r(G),l.d(G,{BaseStreamer:()=>t,TextStreamer:()=>n,WhisperTextStreamer:()=>s});var b=l("./src/utils/core.js"),d=l("./src/tokenizers.js"),e=l("./src/env.js");class t{put(m){throw Error("Not implemented")}end(){throw Error("Not implemented")}}let W=e.apis.IS_PROCESS_AVAILABLE?N=>process.stdout.write(N):N=>console.log(N);class n extends t{constructor(m,{skip_prompt:h=!1,callback_function:V=null,token_callback_function:X=null,skip_special_tokens:p=!0,decode_kwargs:F={},...a}={}){super(),this.tokenizer=m,this.skip_prompt=h,this.callback_function=V??W,this.token_callback_function=X,this.decode_kwargs={skip_special_tokens:p,...F,...a},this.token_cache=[],this.print_len=0,this.next_tokens_are_prompt=!0}put(m){if(m.length>1)throw Error("TextStreamer only supports batch size of 1");if(this.skip_prompt&&this.next_tokens_are_prompt){this.next_tokens_are_prompt=!1;return}let h=m[0];this.token_callback_function?.(h),this.token_cache=(0,b.mergeArrays)(this.token_cache,h);let V=this.tokenizer.decode(this.token_cache,this.decode_kwargs),X;V.endsWith(`
`)?(X=V.slice(this.print_len),this.token_cache=[],this.print_len=0):V.length>0&&(0,d.is_chinese_char)(V.charCodeAt(V.length-1))?(X=V.slice(this.print_len),this.print_len+=X.length):(X=V.slice(this.print_len,V.lastIndexOf(" ")+1),this.print_len+=X.length),this.on_finalized_text(X,!1)}end(){let m;this.token_cache.length>0?(m=this.tokenizer.decode(this.token_cache,this.decode_kwargs).slice(this.print_len),this.token_cache=[],this.print_len=0):m="",this.next_tokens_are_prompt=!0,this.on_finalized_text(m,!0)}on_finalized_text(m,h){m.length>0&&this.callback_function?.(m),h&&this.callback_function===W&&e.apis.IS_PROCESS_AVAILABLE&&this.callback_function?.(`
`)}}class s extends n{constructor(m,{skip_prompt:h=!1,callback_function:V=null,token_callback_function:X=null,on_chunk_start:p=null,on_chunk_end:F=null,on_finalize:a=null,time_precision:u=.02,skip_special_tokens:Q=!0,decode_kwargs:o={}}={}){super(m,{skip_prompt:h,skip_special_tokens:Q,callback_function:V,token_callback_function:X,decode_kwargs:o}),this.timestamp_begin=m.timestamp_begin,this.on_chunk_start=p,this.on_chunk_end=F,this.on_finalize=a,this.time_precision=u,this.waiting_for_timestamp=!1}put(m){if(m.length>1)throw Error("WhisperTextStreamer only supports batch size of 1");let h=m[0];if(h.length===1){let V=Number(h[0])-this.timestamp_begin;if(V>=0){let X=V*this.time_precision;this.waiting_for_timestamp?this.on_chunk_end?.(X):this.on_chunk_start?.(X),this.waiting_for_timestamp=!this.waiting_for_timestamp,m=[[]]}}return super.put(m)}end(){super.end(),this.on_finalize?.()}}},"./src/models.js":(I,G,l)=>{l.r(G),l.d(G,{ASTForAudioClassification:()=>eW,ASTModel:()=>em,ASTPreTrainedModel:()=>aG,AlbertForMaskedLM:()=>gG,AlbertForQuestionAnswering:()=>le,AlbertForSequenceClassification:()=>wZ,AlbertModel:()=>Ie,AlbertPreTrainedModel:()=>Jd,AutoModel:()=>sV,AutoModelForAudioClassification:()=>EV,AutoModelForAudioFrameClassification:()=>gV,AutoModelForCTC:()=>vV,AutoModelForCausalLM:()=>uV,AutoModelForDepthEstimation:()=>AV,AutoModelForDocumentQuestionAnswering:()=>h2,AutoModelForImageClassification:()=>XV,AutoModelForImageFeatureExtraction:()=>kV,AutoModelForImageMatting:()=>JV,AutoModelForImageSegmentation:()=>iV,AutoModelForImageToImage:()=>CV,AutoModelForMaskGeneration:()=>wV,AutoModelForMaskedLM:()=>RV,AutoModelForNormalEstimation:()=>V2,AutoModelForObjectDetection:()=>HV,AutoModelForPoseEstimation:()=>LV,AutoModelForQuestionAnswering:()=>oV,AutoModelForSemanticSegmentation:()=>QV,AutoModelForSeq2SeqLM:()=>hV,AutoModelForSequenceClassification:()=>Y2,AutoModelForSpeechSeq2Seq:()=>VV,AutoModelForTextToSpectrogram:()=>XY,AutoModelForTextToWaveform:()=>pV,AutoModelForTokenClassification:()=>YV,AutoModelForUniversalSegmentation:()=>iY,AutoModelForVision2Seq:()=>FV,AutoModelForXVector:()=>yV,AutoModelForZeroShotObjectDetection:()=>rV,BartForConditionalGeneration:()=>rG,BartForSequenceClassification:()=>dG,BartModel:()=>Hl,BartPretrainedModel:()=>El,BaseModelOutput:()=>FI,BeitForImageClassification:()=>$d,BeitModel:()=>Pd,BeitPreTrainedModel:()=>CN,BertForMaskedLM:()=>w,BertForQuestionAnswering:()=>O,BertForSequenceClassification:()=>r,BertForTokenClassification:()=>A,BertModel:()=>k,BertPreTrainedModel:()=>U,BlenderbotForConditionalGeneration:()=>Tc,BlenderbotModel:()=>dl,BlenderbotPreTrainedModel:()=>_c,BlenderbotSmallForConditionalGeneration:()=>Mc,BlenderbotSmallModel:()=>tc,BlenderbotSmallPreTrainedModel:()=>md,BloomForCausalLM:()=>aN,BloomModel:()=>eN,BloomPreTrainedModel:()=>zW,CLIPModel:()=>um,CLIPPreTrainedModel:()=>_d,CLIPSegForImageSegmentation:()=>Hm,CLIPSegModel:()=>Qm,CLIPSegPreTrainedModel:()=>sW,CLIPTextModel:()=>Eh,CLIPTextModelWithProjection:()=>Rm,CLIPVisionModel:()=>yh,CLIPVisionModelWithProjection:()=>om,CamembertForMaskedLM:()=>Dl,CamembertForQuestionAnswering:()=>lc,CamembertForSequenceClassification:()=>XG,CamembertForTokenClassification:()=>LG,CamembertModel:()=>Fl,CamembertPreTrainedModel:()=>NG,CausalLMOutput:()=>bZ,CausalLMOutputWithPast:()=>zV,ChineseCLIPModel:()=>zb,ChineseCLIPPreTrainedModel:()=>gh,ClapAudioModelWithProjection:()=>Ls,ClapModel:()=>Gb,ClapPreTrainedModel:()=>Ht,ClapTextModelWithProjection:()=>As,CodeGenForCausalLM:()=>xm,CodeGenModel:()=>oW,CodeGenPreTrainedModel:()=>Te,CohereForCausalLM:()=>Sm,CohereModel:()=>fm,CoherePreTrainedModel:()=>gW,ConvBertForMaskedLM:()=>Il,ConvBertForQuestionAnswering:()=>PI,ConvBertForSequenceClassification:()=>nl,ConvBertForTokenClassification:()=>ol,ConvBertModel:()=>TI,ConvBertPreTrainedModel:()=>kI,ConvNextForImageClassification:()=>Yt,ConvNextModel:()=>DN,ConvNextPreTrainedModel:()=>st,ConvNextV2ForImageClassification:()=>Vt,ConvNextV2Model:()=>qN,ConvNextV2PreTrainedModel:()=>ht,DPTForDepthEstimation:()=>Uh,DPTModel:()=>UN,DPTPreTrainedModel:()=>nt,DebertaForMaskedLM:()=>EG,DebertaForQuestionAnswering:()=>qG,DebertaForSequenceClassification:()=>MG,DebertaForTokenClassification:()=>xc,DebertaModel:()=>Wc,DebertaPreTrainedModel:()=>DG,DebertaV2ForMaskedLM:()=>Cl,DebertaV2ForQuestionAnswering:()=>ib,DebertaV2ForSequenceClassification:()=>Gc,DebertaV2ForTokenClassification:()=>yc,DebertaV2Model:()=>ul,DebertaV2PreTrainedModel:()=>sl,DecisionTransformerModel:()=>dV,DecisionTransformerPreTrainedModel:()=>Ds,DeiTForImageClassification:()=>ct,DeiTModel:()=>kN,DeiTPreTrainedModel:()=>Pe,DepthAnythingForDepthEstimation:()=>BN,DepthAnythingPreTrainedModel:()=>MN,DepthProForDepthEstimation:()=>Nt,DepthProPreTrainedModel:()=>la,DetrForObjectDetection:()=>IZ,DetrForSegmentation:()=>Jc,DetrModel:()=>_W,DetrObjectDetectionOutput:()=>PW,DetrPreTrainedModel:()=>Nd,DetrSegmentationOutput:()=>$W,Dinov2ForImageClassification:()=>Oh,Dinov2Model:()=>_N,Dinov2PreTrainedModel:()=>pt,Dinov2WithRegistersForImageClassification:()=>$N,Dinov2WithRegistersModel:()=>PN,Dinov2WithRegistersPreTrainedModel:()=>ut,DistilBertForMaskedLM:()=>Lb,DistilBertForQuestionAnswering:()=>YG,DistilBertForSequenceClassification:()=>cc,DistilBertForTokenClassification:()=>Qb,DistilBertModel:()=>lb,DistilBertPreTrainedModel:()=>xG,DonutSwinModel:()=>SN,DonutSwinPreTrainedModel:()=>Bh,EfficientNetForImageClassification:()=>Bs,EfficientNetModel:()=>Ms,EfficientNetPreTrainedModel:()=>ta,ElectraForMaskedLM:()=>Wl,ElectraForQuestionAnswering:()=>jl,ElectraForSequenceClassification:()=>wl,ElectraForTokenClassification:()=>Ol,ElectraModel:()=>jI,ElectraPreTrainedModel:()=>KI,EsmForMaskedLM:()=>Db,EsmForSequenceClassification:()=>qb,EsmForTokenClassification:()=>_b,EsmModel:()=>td,EsmPreTrainedModel:()=>sb,ExaoneForCausalLM:()=>rW,ExaoneModel:()=>Mm,ExaonePreTrainedModel:()=>HW,FalconForCausalLM:()=>Cs,FalconModel:()=>Js,FalconPreTrainedModel:()=>Qt,FastViTForImageClassification:()=>iN,FastViTModel:()=>XN,FastViTPreTrainedModel:()=>TW,Florence2ForConditionalGeneration:()=>sm,Florence2PreTrainedModel:()=>Nm,GLPNForDepthEstimation:()=>fN,GLPNModel:()=>Mh,GLPNPreTrainedModel:()=>ca,GPT2LMHeadModel:()=>wm,GPT2Model:()=>rm,GPT2PreTrainedModel:()=>YW,GPTBigCodeForCausalLM:()=>km,GPTBigCodeModel:()=>Lm,GPTBigCodePreTrainedModel:()=>RW,GPTJForCausalLM:()=>Am,GPTJModel:()=>Cm,GPTJPreTrainedModel:()=>uW,GPTNeoForCausalLM:()=>ym,GPTNeoModel:()=>Mb,GPTNeoPreTrainedModel:()=>VW,GPTNeoXForCausalLM:()=>Jm,GPTNeoXModel:()=>gm,GPTNeoXPreTrainedModel:()=>pW,Gemma2ForCausalLM:()=>Pm,Gemma2Model:()=>_m,Gemma2PreTrainedModel:()=>CW,GemmaForCausalLM:()=>qm,GemmaModel:()=>Dm,GemmaPreTrainedModel:()=>JW,GlmForCausalLM:()=>Ge,GlmModel:()=>Um,GlmPreTrainedModel:()=>QW,GraniteForCausalLM:()=>Tm,GraniteModel:()=>JG,GranitePreTrainedModel:()=>yW,GroundingDinoForObjectDetection:()=>Is,GroundingDinoPreTrainedModel:()=>jh,GroupViTModel:()=>Bb,GroupViTPreTrainedModel:()=>FN,HeliumForCausalLM:()=>zm,HeliumModel:()=>fe,HeliumPreTrainedModel:()=>iW,HieraForImageClassification:()=>dt,HieraModel:()=>$e,HieraPreTrainedModel:()=>bt,HubertForCTC:()=>os,HubertForSequenceClassification:()=>Ph,HubertModel:()=>Rs,HubertPreTrainedModel:()=>_h,IJepaForImageClassification:()=>YN,IJepaModel:()=>sN,IJepaPreTrainedModel:()=>qe,Idefics3ForConditionalGeneration:()=>nW,Idefics3PreTrainedModel:()=>Vm,ImageMattingOutput:()=>HY,JAISLMHeadModel:()=>Em,JAISModel:()=>vm,JAISPreTrainedModel:()=>hW,JinaCLIPModel:()=>Ke,JinaCLIPPreTrainedModel:()=>je,JinaCLIPTextModel:()=>NW,JinaCLIPVisionModel:()=>Ub,LlamaForCausalLM:()=>Jh,LlamaModel:()=>XW,LlamaPreTrainedModel:()=>FW,LlavaForConditionalGeneration:()=>Oe,LlavaOnevisionForConditionalGeneration:()=>nm,LlavaPreTrainedModel:()=>Cd,LongT5ForConditionalGeneration:()=>bl,LongT5Model:()=>fI,LongT5PreTrainedModel:()=>BI,M2M100ForConditionalGeneration:()=>Ft,M2M100Model:()=>Zs,M2M100PreTrainedModel:()=>ot,MBartForCausalLM:()=>Uc,MBartForConditionalGeneration:()=>lG,MBartForSequenceClassification:()=>vG,MBartModel:()=>zc,MBartPreTrainedModel:()=>bc,MPNetForMaskedLM:()=>Dd,MPNetForQuestionAnswering:()=>HZ,MPNetForSequenceClassification:()=>iZ,MPNetForTokenClassification:()=>QZ,MPNetModel:()=>XZ,MPNetPreTrainedModel:()=>Vb,MT5ForConditionalGeneration:()=>yl,MT5Model:()=>vl,MT5PreTrainedModel:()=>Nl,MarianMTModel:()=>ds,MarianModel:()=>bs,MarianPreTrainedModel:()=>da,MaskFormerForInstanceSegmentation:()=>TN,MaskFormerModel:()=>KN,MaskFormerPreTrainedModel:()=>Ga,MaskedLMOutput:()=>Bc,MgpstrForSceneTextRecognition:()=>IY,MgpstrModelOutput:()=>Ps,MgpstrPreTrainedModel:()=>$s,MistralForCausalLM:()=>Es,MistralModel:()=>vs,MistralPreTrainedModel:()=>Xt,MobileBertForMaskedLM:()=>nd,MobileBertForQuestionAnswering:()=>kb,MobileBertForSequenceClassification:()=>hb,MobileBertModel:()=>Pb,MobileBertPreTrainedModel:()=>Yb,MobileLLMForCausalLM:()=>Om,MobileLLMModel:()=>Bm,MobileLLMPreTrainedModel:()=>wW,MobileNetV1ForImageClassification:()=>gt,MobileNetV1Model:()=>cV,MobileNetV1PreTrainedModel:()=>yt,MobileNetV2ForImageClassification:()=>js,MobileNetV2Model:()=>Os,MobileNetV2PreTrainedModel:()=>Jt,MobileNetV3ForImageClassification:()=>fs,MobileNetV3Model:()=>Ts,MobileNetV3PreTrainedModel:()=>Ks,MobileNetV4ForImageClassification:()=>Ss,MobileNetV4Model:()=>bV,MobileNetV4PreTrainedModel:()=>Ct,MobileViTForImageClassification:()=>wN,MobileViTModel:()=>rN,MobileViTPreTrainedModel:()=>fW,MobileViTV2ForImageClassification:()=>kh,MobileViTV2Model:()=>vN,MobileViTV2PreTrainedModel:()=>SW,ModelOutput:()=>bI,ModernBertForMaskedLM:()=>GI,ModernBertForSequenceClassification:()=>tI,ModernBertForTokenClassification:()=>iI,ModernBertModel:()=>q,ModernBertPreTrainedModel:()=>K,Moondream1ForConditionalGeneration:()=>mm,MoonshineForConditionalGeneration:()=>tm,MoonshineModel:()=>Hb,MoonshinePreTrainedModel:()=>WW,MptForCausalLM:()=>tN,MptModel:()=>WN,MptPreTrainedModel:()=>UW,MultiModalityCausalLM:()=>_s,MultiModalityPreTrainedModel:()=>qs,MusicgenForCausalLM:()=>GV,MusicgenForConditionalGeneration:()=>na,MusicgenModel:()=>lV,MusicgenPreTrainedModel:()=>Et,NomicBertModel:()=>aI,NomicBertPreTrainedModel:()=>B,OPTForCausalLM:()=>mN,OPTModel:()=>nN,OPTPreTrainedModel:()=>MW,Olmo2ForCausalLM:()=>Ah,Olmo2Model:()=>Km,Olmo2PreTrainedModel:()=>EW,OlmoForCausalLM:()=>jm,OlmoModel:()=>Ch,OlmoPreTrainedModel:()=>vW,OpenELMForCausalLM:()=>IN,OpenELMModel:()=>$m,OpenELMPreTrainedModel:()=>AW,OwlViTForObjectDetection:()=>yN,OwlViTModel:()=>EN,OwlViTPreTrainedModel:()=>DW,Owlv2ForObjectDetection:()=>JN,Owlv2Model:()=>gN,Owlv2PreTrainedModel:()=>qW,PaliGemmaForConditionalGeneration:()=>hm,PaliGemmaPreTrainedModel:()=>Ym,PatchTSMixerForPrediction:()=>dY,PatchTSMixerModel:()=>bY,PatchTSMixerPreTrainedModel:()=>At,PatchTSTForPrediction:()=>cY,PatchTSTModel:()=>GY,PatchTSTPreTrainedModel:()=>lY,Phi3ForCausalLM:()=>ZN,Phi3Model:()=>dN,Phi3PreTrainedModel:()=>xW,Phi3VForCausalLM:()=>rb,Phi3VPreTrainedModel:()=>pm,PhiForCausalLM:()=>bN,PhiModel:()=>cN,PhiPreTrainedModel:()=>kW,PreTrainedModel:()=>L,PretrainedMixin:()=>jG,PvtForImageClassification:()=>jW,PvtModel:()=>pN,PvtPreTrainedModel:()=>OW,PyAnnoteForAudioFrameClassification:()=>ns,PyAnnoteModel:()=>ts,PyAnnotePreTrainedModel:()=>Za,QuestionAnsweringModelOutput:()=>fc,Qwen2ForCausalLM:()=>lN,Qwen2Model:()=>ce,Qwen2PreTrainedModel:()=>LW,Qwen2VLForConditionalGeneration:()=>GN,Qwen2VLPreTrainedModel:()=>Se,RTDetrForObjectDetection:()=>be,RTDetrModel:()=>xh,RTDetrObjectDetectionOutput:()=>lt,RTDetrPreTrainedModel:()=>It,ResNetForImageClassification:()=>zh,ResNetModel:()=>xN,ResNetPreTrainedModel:()=>Zt,RoFormerForMaskedLM:()=>vI,RoFormerForQuestionAnswering:()=>wI,RoFormerForSequenceClassification:()=>OI,RoFormerForTokenClassification:()=>uI,RoFormerModel:()=>QI,RoFormerPreTrainedModel:()=>lI,RobertaForMaskedLM:()=>xb,RobertaForQuestionAnswering:()=>gl,RobertaForSequenceClassification:()=>kG,RobertaForTokenClassification:()=>nc,RobertaModel:()=>ab,RobertaPreTrainedModel:()=>Kl,SamImageSegmentationOutput:()=>Ze,SamModel:()=>ba,SamPreTrainedModel:()=>Kh,SapiensForDepthEstimation:()=>Ia,SapiensForNormalEstimation:()=>jN,SapiensForSemanticSegmentation:()=>ON,SapiensPreTrainedModel:()=>mt,SegformerForImageClassification:()=>ks,SegformerForSemanticSegmentation:()=>xs,SegformerModel:()=>IV,SegformerPreTrainedModel:()=>cZ,Seq2SeqLMOutput:()=>xV,SequenceClassifierOutput:()=>WG,SiglipModel:()=>Fm,SiglipPreTrainedModel:()=>mW,SiglipTextModel:()=>Xm,SiglipVisionModel:()=>im,SpeechT5ForSpeechToText:()=>$b,SpeechT5ForTextToSpeech:()=>sd,SpeechT5HifiGan:()=>lZ,SpeechT5Model:()=>N2,SpeechT5PreTrainedModel:()=>Wa,SqueezeBertForMaskedLM:()=>_Z,SqueezeBertForQuestionAnswering:()=>$Z,SqueezeBertForSequenceClassification:()=>PZ,SqueezeBertModel:()=>rZ,SqueezeBertPreTrainedModel:()=>Sl,StableLmForCausalLM:()=>Us,StableLmModel:()=>zs,StableLmPreTrainedModel:()=>vt,Starcoder2ForCausalLM:()=>gs,Starcoder2Model:()=>ys,Starcoder2PreTrainedModel:()=>it,StyleTextToSpeech2Model:()=>rs,StyleTextToSpeech2PreTrainedModel:()=>Hs,Swin2SRForImageSuperResolution:()=>zN,Swin2SRModel:()=>tt,Swin2SRPreTrainedModel:()=>Wt,SwinForImageClassification:()=>de,SwinModel:()=>at,SwinPreTrainedModel:()=>et,T5ForConditionalGeneration:()=>AI,T5Model:()=>II,T5PreTrainedModel:()=>$I,TableTransformerForObjectDetection:()=>LN,TableTransformerModel:()=>AN,TableTransformerObjectDetectionOutput:()=>Gt,TableTransformerPreTrainedModel:()=>_e,TokenClassifierOutput:()=>hc,TrOCRForCausalLM:()=>ws,TrOCRPreTrainedModel:()=>GZ,UniSpeechForCTC:()=>Sh,UniSpeechForSequenceClassification:()=>ss,UniSpeechModel:()=>Ns,UniSpeechPreTrainedModel:()=>ea,UniSpeechSatForAudioFrameClassification:()=>Vs,UniSpeechSatForCTC:()=>hs,UniSpeechSatForSequenceClassification:()=>Dh,UniSpeechSatModel:()=>Ys,UniSpeechSatPreTrainedModel:()=>ee,ViTForImageClassification:()=>BW,ViTMAEModel:()=>RN,ViTMAEPreTrainedModel:()=>uN,ViTMSNForImageClassification:()=>oN,ViTMSNModel:()=>Lh,ViTMSNPreTrainedModel:()=>KW,ViTModel:()=>NN,ViTPreTrainedModel:()=>De,VisionEncoderDecoderModel:()=>tW,VitMatteForImageMatting:()=>HN,VitMattePreTrainedModel:()=>QN,VitPoseForPoseEstimation:()=>VN,VitPosePreTrainedModel:()=>hN,VitsModel:()=>wt,VitsModelOutput:()=>rY,VitsPreTrainedModel:()=>rt,Wav2Vec2BertForCTC:()=>qh,Wav2Vec2BertForSequenceClassification:()=>us,Wav2Vec2BertModel:()=>ps,Wav2Vec2BertPreTrainedModel:()=>aa,Wav2Vec2ForAudioFrameClassification:()=>Ws,Wav2Vec2ForCTC:()=>as,Wav2Vec2ForSequenceClassification:()=>Th,Wav2Vec2Model:()=>es,Wav2Vec2PreTrainedModel:()=>Ad,WavLMForAudioFrameClassification:()=>Qs,WavLMForCTC:()=>Xs,WavLMForSequenceClassification:()=>is,WavLMForXVector:()=>$h,WavLMModel:()=>Fs,WavLMPreTrainedModel:()=>vZ,WeSpeakerResNetModel:()=>fh,WeSpeakerResNetPreTrainedModel:()=>ms,WhisperForConditionalGeneration:()=>Wm,WhisperModel:()=>am,WhisperPreTrainedModel:()=>aW,XLMForQuestionAnswering:()=>qd,XLMForSequenceClassification:()=>gc,XLMForTokenClassification:()=>Ll,XLMModel:()=>Rc,XLMPreTrainedModel:()=>ZG,XLMRobertaForMaskedLM:()=>bm,XLMRobertaForQuestionAnswering:()=>Zm,XLMRobertaForSequenceClassification:()=>ZW,XLMRobertaForTokenClassification:()=>dm,XLMRobertaModel:()=>Ul,XLMRobertaPreTrainedModel:()=>tl,XLMWithLMHeadModel:()=>mc,XVectorOutput:()=>QY,YolosForObjectDetection:()=>Gs,YolosModel:()=>ls,YolosObjectDetectionOutput:()=>cs,YolosPreTrainedModel:()=>Rt});var b=l("./src/configs.js"),d=l("./src/backends/onnx.js"),e=l("./src/utils/dtypes.js"),t=l("./src/utils/generic.js"),W=l("./src/utils/core.js"),n=l("./src/utils/hub.js"),s=l("./src/utils/constants.js"),N=l("./src/generation/logits_process.js"),m=l("./src/generation/configuration_utils.js"),h=l("./src/utils/tensor.js"),V=l("./src/utils/image.js"),X=l("./src/utils/maths.js"),p=l("./src/generation/stopping_criteria.js"),F=l("./src/generation/logits_sampler.js"),a=l("./src/env.js"),u=l("./src/models/whisper/generation_whisper.js"),Q=l("./src/models/whisper/common_whisper.js");let o={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5,ImageTextToText:6,Musicgen:7,MultiModality:8,Phi3V:9},y=new Map,H=new Map,E=new Map;async function C(P,_,CI){let _I=CI.config?.["transformers.js_config"]??{},Gl=CI.device??_I.device;Gl&&typeof Gl!="string"&&(Gl.hasOwnProperty(_)?Gl=Gl[_]:(console.warn(`device not specified for "${_}". Using the default device.`),Gl=null));let Zl=Gl??(a.apis.IS_NODE_ENV?"cpu":"wasm"),hl=(0,d.deviceToExecutionProviders)(Zl),Vl=CI.dtype??_I.dtype;if(typeof Vl!="string"&&(Vl&&Vl.hasOwnProperty(_)?Vl=Vl[_]:(Vl=e.DEFAULT_DEVICE_DTYPE_MAPPING[Zl]??e.DATA_TYPES.fp32,console.warn(`dtype not specified for "${_}". Using the default dtype (${Vl}) for this device (${Zl}).`))),Vl===e.DATA_TYPES.auto){let iG=_I.dtype;typeof iG!="string"&&(iG=iG[_]),iG&&iG!==e.DATA_TYPES.auto&&e.DATA_TYPES.hasOwnProperty(iG)?Vl=iG:Vl=e.DEFAULT_DEVICE_DTYPE_MAPPING[Zl]??e.DATA_TYPES.fp32}let rl=Vl;if(e.DEFAULT_DTYPE_SUFFIX_MAPPING.hasOwnProperty(rl)){if(rl===e.DATA_TYPES.fp16&&Zl==="webgpu"&&!await(0,e.isWebGpuFp16Supported)())throw new Error(`The device (${Zl}) does not support fp16.`)}else throw new Error(`Invalid dtype: ${rl}. Should be one of: ${Object.keys(e.DATA_TYPES).join(", ")}`);let Ml=_I.kv_cache_dtype?typeof _I.kv_cache_dtype=="string"?_I.kv_cache_dtype:_I.kv_cache_dtype[rl]??"float32":void 0;if(Ml&&!["float32","float16"].includes(Ml))throw new Error(`Invalid kv_cache_dtype: ${Ml}. Should be one of: float32, float16`);let hG={dtype:rl,kv_cache_dtype:Ml},tG=e.DEFAULT_DTYPE_SUFFIX_MAPPING[rl],ql=`${CI.subfolder??""}/${_}${tG}.onnx`,fl={...CI.session_options};fl.executionProviders??=hl;let dc=_I.free_dimension_overrides;dc?fl.freeDimensionOverrides??=dc:Zl.startsWith("webnn")&&!fl.freeDimensionOverrides&&console.warn('WebNN does not currently support dynamic shapes and requires `free_dimension_overrides` to be set in config.json as a field within "transformers.js_config". When `free_dimension_overrides` is not set, you may experience significant performance degradation.');let nG=(0,n.getModelFile)(P,ql,!0,CI),eG=CI.use_external_data_format??_I.use_external_data_format,KG=[];if(eG&&(eG===!0||typeof eG=="object"&&eG.hasOwnProperty(_)&&eG[_]===!0)){if(a.apis.IS_NODE_ENV)throw new Error("External data format is not yet supported in Node.js");let iG=`${_}${tG}.onnx_data`,Qc=`${CI.subfolder??""}/${iG}`;KG.push(new Promise(async(Hc,Vc)=>{let rc=await(0,n.getModelFile)(P,Qc,!0,CI);Hc({path:iG,data:rc})}))}else fl.externalData!==void 0&&(KG=fl.externalData.map(async iG=>{if(typeof iG.data=="string"){let Qc=await(0,n.getModelFile)(P,iG.data,!0,CI);return{...iG,data:Qc}}return iG}));if(KG.length>0&&(fl.externalData=await Promise.all(KG)),Zl==="webgpu"){let iG=(0,b.getKeyValueShapes)(CI.config,{prefix:"present"});if(Object.keys(iG).length>0&&!(0,d.isONNXProxy)()){let Qc={};for(let Hc in iG)Qc[Hc]="gpu-buffer";fl.preferredOutputLocation=Qc}}return{buffer:await nG,session_options:fl,session_config:hG}}async function T(P,_,CI){return Object.fromEntries(await Promise.all(Object.keys(_).map(async _I=>{let{buffer:Gl,session_options:Zl,session_config:hl}=await C(P,_[_I],CI),Vl=await(0,d.createInferenceSession)(Gl,Zl,hl);return[_I,Vl]})))}async function S(P,_,CI){return Object.fromEntries(await Promise.all(Object.keys(_).map(async _I=>{let Gl=await(0,n.getModelJSON)(P,_[_I],!1,CI);return[_I,Gl]})))}function cI(P,_){let CI=Object.create(null),_I=[];for(let hl of P.inputNames){let Vl=_[hl];if(!(Vl instanceof h.Tensor)){_I.push(hl);continue}CI[hl]=(0,d.isONNXProxy)()?Vl.clone():Vl}if(_I.length>0)throw new Error(`An error occurred during model execution: "Missing the following inputs: ${_I.join(", ")}.`);let Gl=Object.keys(_).length,Zl=P.inputNames.length;if(Gl>Zl){let hl=Object.keys(_).filter(Vl=>!P.inputNames.includes(Vl));console.warn(`WARNING: Too many inputs were provided (${Gl} > ${Zl}). The following inputs will be ignored: "${hl.join(", ")}".`)}return CI}async function hI(P,_){let CI=cI(P,_);try{let _I=Object.fromEntries(Object.entries(CI).map(([Zl,hl])=>[Zl,hl.ort_tensor])),Gl=await P.run(_I);return Gl=WI(Gl),Gl}catch(_I){let Gl=Object.fromEntries(Object.entries(CI).map(([Zl,{type:hl,dims:Vl,data:rl}])=>[Zl,{type:hl,dims:Vl,data:rl}]));throw console.error(`An error occurred during model execution: "${_I}".`),console.error("Inputs given to model:",Gl),_I}}function WI(P){for(let _ in P)(0,d.isONNXTensor)(P[_])?P[_]=new h.Tensor(P[_]):typeof P[_]=="object"&&WI(P[_]);return P}function VI(P){if(P instanceof h.Tensor)return P;if(P.length===0)throw Error("items must be non-empty");if(Array.isArray(P[0])){if(P.some(_=>_.length!==P[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' and/or 'truncation=True' to have batched tensors with the same length.");return new h.Tensor("int64",BigInt64Array.from(P.flat().map(_=>BigInt(_))),[P.length,P[0].length])}else return new h.Tensor("int64",BigInt64Array.from(P.map(_=>BigInt(_))),[1,P.length])}function sI(P){return new h.Tensor("bool",[P],[1])}async function ZI(P,_){let{encoder_outputs:CI,input_ids:_I,decoder_input_ids:Gl,...Zl}=_;if(!CI){let Vl=(0,W.pick)(_,P.sessions.model.inputNames);CI=(await dI(P,Vl)).last_hidden_state}return Zl.input_ids=Gl,Zl.encoder_hidden_states=CI,P.sessions.decoder_model_merged.inputNames.includes("encoder_attention_mask")&&(Zl.encoder_attention_mask=_.attention_mask),await pI(P,Zl,!0)}async function dI(P,_){let CI=P.sessions.model,_I=(0,W.pick)(_,CI.inputNames);if(CI.inputNames.includes("inputs_embeds")&&!_I.inputs_embeds){if(!_.input_ids)throw new Error("Both `input_ids` and `inputs_embeds` are missing in the model inputs.");_I.inputs_embeds=await P.encode_text({input_ids:_.input_ids})}if(CI.inputNames.includes("token_type_ids")&&!_I.token_type_ids){if(!_I.input_ids)throw new Error("Both `input_ids` and `token_type_ids` are missing in the model inputs.");_I.token_type_ids=(0,h.zeros_like)(_I.input_ids)}if(CI.inputNames.includes("pixel_mask")&&!_I.pixel_mask){if(!_I.pixel_values)throw new Error("Both `pixel_values` and `pixel_mask` are missing in the model inputs.");let Gl=_I.pixel_values.dims;_I.pixel_mask=(0,h.ones)([Gl[0],Gl[2],Gl[3]])}return await hI(CI,_I)}async function pI(P,_,CI=!1){let _I=P.sessions[CI?"decoder_model_merged":"model"],{past_key_values:Gl,...Zl}=_;if(_I.inputNames.includes("use_cache_branch")&&(Zl.use_cache_branch=sI(!!Gl)),_I.inputNames.includes("position_ids")&&Zl.attention_mask&&!Zl.position_ids){let Vl=P.config.model_type==="paligemma"?1:0;Zl.position_ids=YI(Zl,Gl,Vl)}P.addPastKeyValues(Zl,Gl);let hl=(0,W.pick)(Zl,_I.inputNames);return await hI(_I,hl)}function yI({image_token_id:P,inputs_embeds:_,image_features:CI,input_ids:_I,attention_mask:Gl}){let Zl=_I.tolist().map(Ml=>Ml.reduce((hG,tG,ql)=>(tG==P&&hG.push(ql),hG),[])),hl=Zl.reduce((Ml,hG)=>Ml+hG.length,0),Vl=CI.dims[0];if(hl!==Vl)throw new Error(`Image features and image tokens do not match: tokens: ${hl}, features ${Vl}`);let rl=0;for(let Ml=0;Ml<Zl.length;++Ml){let hG=Zl[Ml],tG=_[Ml];for(let ql=0;ql<hG.length;++ql)tG[hG[ql]].data.set(CI[rl++].data)}return{inputs_embeds:_,attention_mask:Gl}}async function eI(P,{input_ids:_=null,attention_mask:CI=null,pixel_values:_I=null,position_ids:Gl=null,inputs_embeds:Zl=null,past_key_values:hl=null,generation_config:Vl=null,logits_processor:rl=null,...Ml}){if(!Zl){if(Zl=await P.encode_text({input_ids:_,...Ml}),_I&&_.dims[1]!==1){let tG=await P.encode_image({pixel_values:_I,...Ml});({inputs_embeds:Zl,attention_mask:CI}=P._merge_input_ids_with_image_features({image_features:tG,inputs_embeds:Zl,input_ids:_,attention_mask:CI}))}else if(hl&&_I&&_.dims[1]===1){let tG=_.dims[1],ql=Object.values(hl)[0].dims.at(-2);CI=(0,h.cat)([(0,h.ones)([_.dims[0],ql]),CI.slice(null,[CI.dims[1]-tG,CI.dims[1]])],1)}}if(!Gl&&P.config.model_type==="qwen2_vl"){let{image_grid_thw:tG,video_grid_thw:ql}=Ml;[Gl]=P.get_rope_index(_,tG,ql,CI)}return await pI(P,{inputs_embeds:Zl,past_key_values:hl,attention_mask:CI,position_ids:Gl,generation_config:Vl,logits_processor:rl},!0)}function HI(P,_=0){let[CI,_I]=P.dims,Gl=P.data,Zl=new BigInt64Array(Gl.length);for(let hl=0;hl<CI;++hl){let Vl=hl*_I,rl=BigInt(_);for(let Ml=0;Ml<_I;++Ml){let hG=Vl+Ml;Gl[hG]===0n?Zl[hG]=BigInt(1):(Zl[hG]=rl,rl+=Gl[hG])}}return{data:Zl,dims:P.dims}}function YI(P,_=null,CI=0){let{input_ids:_I,inputs_embeds:Gl,attention_mask:Zl}=P,{data:hl,dims:Vl}=HI(Zl,CI),rl=new h.Tensor("int64",hl,Vl);if(_){let Ml=-(_I??Gl).dims.at(1);rl=rl.slice(null,[Ml,null])}return rl}function $(P,_,CI,_I){if(CI.past_key_values){let Gl=Object.values(CI.past_key_values)[0].dims.at(-2),{input_ids:Zl,attention_mask:hl}=CI;if(!(hl&&hl.dims[1]>Zl.dims[1])){if(Gl<Zl.dims[1])CI.input_ids=Zl.slice(null,[Gl,null]);else if(P.config.image_token_index!=null&&Zl.data.some(Vl=>Vl==P.config.image_token_index)){let Vl=P.config.num_image_tokens;if(!Vl)throw new Error("`num_image_tokens` is missing in the model configuration.");let rl=Zl.dims[1]-(Gl-Vl);CI.input_ids=Zl.slice(null,[-rl,null]),CI.attention_mask=(0,h.ones)([1,Gl+rl])}}}return CI}function JI(P,_,CI,_I){return CI.past_key_values&&(_=_.map(Gl=>[Gl.at(-1)])),{...CI,decoder_input_ids:VI(_)}}function UI(P,..._){return P.config.is_encoder_decoder?JI(P,..._):$(P,..._)}function zI(P,_,CI,_I){let Gl=!!CI.past_key_values;return _I.guidance_scale!==null&&_I.guidance_scale>1&&(Gl?CI.input_ids=(0,h.cat)([CI.input_ids,CI.input_ids],0):(CI.input_ids=(0,h.cat)([CI.input_ids,(0,h.full_like)(CI.input_ids,BigInt(_I.pad_token_id))],0),CI.attention_mask=(0,h.cat)([CI.attention_mask,(0,h.full_like)(CI.attention_mask,0n)],0))),(Gl||!CI.pixel_values)&&(CI.pixel_values=(0,h.full)([0,0,3,384,384],1)),Gl&&(CI.images_seq_mask=new h.Tensor("bool",new Array(1).fill(!0).fill(!1,0,1),[1,1]),CI.images_emb_mask=new h.Tensor("bool",new Array(0).fill(!1),[1,1,0])),CI}class L extends t.Callable{main_input_name="input_ids";forward_params=["input_ids","attention_mask"];constructor(_,CI,_I){super(),this.config=_,this.sessions=CI,this.configs=_I;let Gl=E.get(this.constructor),Zl=y.get(Gl);switch(this.can_generate=!1,this._forward=null,this._prepare_inputs_for_generation=null,Zl){case o.DecoderOnly:this.can_generate=!0,this._forward=pI,this._prepare_inputs_for_generation=$;break;case o.Seq2Seq:case o.Vision2Seq:case o.Musicgen:this.can_generate=!0,this._forward=ZI,this._prepare_inputs_for_generation=JI;break;case o.EncoderDecoder:this._forward=ZI;break;case o.ImageTextToText:this.can_generate=!0,this._forward=eI,this._prepare_inputs_for_generation=UI;break;case o.Phi3V:this.can_generate=!0,this._prepare_inputs_for_generation=UI;break;case o.MultiModality:this.can_generate=!0,this._prepare_inputs_for_generation=zI;break;default:this._forward=dI;break}this.can_generate&&this.forward_params.push("past_key_values"),this.custom_config=this.config["transformers.js_config"]??{}}async dispose(){let _=[];for(let CI of Object.values(this.sessions))CI?.handler?.dispose&&_.push(CI.handler.dispose());return await Promise.all(_)}static async from_pretrained(_,{progress_callback:CI=null,config:_I=null,cache_dir:Gl=null,local_files_only:Zl=!1,revision:hl="main",model_file_name:Vl=null,subfolder:rl="onnx",device:Ml=null,dtype:hG=null,use_external_data_format:tG=null,session_options:ql={}}={}){let fl={progress_callback:CI,config:_I,cache_dir:Gl,local_files_only:Zl,revision:hl,model_file_name:Vl,subfolder:rl,device:Ml,dtype:hG,use_external_data_format:tG,session_options:ql},dc=E.get(this),nG=y.get(dc);_I=fl.config=await b.AutoConfig.from_pretrained(_,fl);let eG;if(nG===o.DecoderOnly)eG=await Promise.all([T(_,{model:fl.model_file_name??"model"},fl),S(_,{generation_config:"generation_config.json"},fl)]);else if(nG===o.Seq2Seq||nG===o.Vision2Seq)eG=await Promise.all([T(_,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},fl),S(_,{generation_config:"generation_config.json"},fl)]);else if(nG===o.MaskGeneration)eG=await Promise.all([T(_,{model:"vision_encoder",prompt_encoder_mask_decoder:"prompt_encoder_mask_decoder"},fl)]);else if(nG===o.EncoderDecoder)eG=await Promise.all([T(_,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},fl)]);else if(nG===o.ImageTextToText){let KG={embed_tokens:"embed_tokens",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"};_I.is_encoder_decoder&&(KG.model="encoder_model"),eG=await Promise.all([T(_,KG,fl),S(_,{generation_config:"generation_config.json"},fl)])}else if(nG===o.Musicgen)eG=await Promise.all([T(_,{model:"text_encoder",decoder_model_merged:"decoder_model_merged",encodec_decode:"encodec_decode"},fl),S(_,{generation_config:"generation_config.json"},fl)]);else if(nG===o.MultiModality)eG=await Promise.all([T(_,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"language_model",lm_head:"lm_head",gen_head:"gen_head",gen_img_embeds:"gen_img_embeds",image_decode:"image_decode"},fl),S(_,{generation_config:"generation_config.json"},fl)]);else if(nG===o.Phi3V)eG=await Promise.all([T(_,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"model",vision_encoder:"vision_encoder"},fl),S(_,{generation_config:"generation_config.json"},fl)]);else{if(nG!==o.EncoderOnly){let KG=dc??_I?.model_type;KG!=="custom"&&console.warn(`Model type for '${KG}' not found, assuming encoder-only architecture. Please report this at ${s.GITHUB_ISSUE_URL}.`)}eG=await Promise.all([T(_,{model:fl.model_file_name??"model"},fl)])}return new this(_I,...eG)}async _call(_){return await this.forward(_)}async forward(_){return await this._forward(this,_)}get generation_config(){return this.configs?.generation_config??null}_get_logits_warper(_){let CI=new N.LogitsProcessorList;return _.temperature!==null&&_.temperature!==1&&CI.push(new N.TemperatureLogitsWarper(_.temperature)),_.top_k!==null&&_.top_k!==0&&CI.push(new N.TopKLogitsWarper(_.top_k)),_.top_p!==null&&_.top_p<1&&CI.push(new N.TopPLogitsWarper(_.top_p)),CI}_get_logits_processor(_,CI,_I=null){let Gl=new N.LogitsProcessorList;if(_.repetition_penalty!==null&&_.repetition_penalty!==1&&Gl.push(new N.RepetitionPenaltyLogitsProcessor(_.repetition_penalty)),_.no_repeat_ngram_size!==null&&_.no_repeat_ngram_size>0&&Gl.push(new N.NoRepeatNGramLogitsProcessor(_.no_repeat_ngram_size)),_.bad_words_ids!==null&&Gl.push(new N.NoBadWordsLogitsProcessor(_.bad_words_ids,_.eos_token_id)),_.min_length!==null&&_.eos_token_id!==null&&_.min_length>0&&Gl.push(new N.MinLengthLogitsProcessor(_.min_length,_.eos_token_id)),_.min_new_tokens!==null&&_.eos_token_id!==null&&_.min_new_tokens>0&&Gl.push(new N.MinNewTokensLengthLogitsProcessor(CI,_.min_new_tokens,_.eos_token_id)),_.forced_bos_token_id!==null&&Gl.push(new N.ForcedBOSTokenLogitsProcessor(_.forced_bos_token_id)),_.forced_eos_token_id!==null&&Gl.push(new N.ForcedEOSTokenLogitsProcessor(_.max_length,_.forced_eos_token_id)),_.begin_suppress_tokens!==null){let Zl=CI>1||_.forced_bos_token_id===null?CI:CI+1;Gl.push(new N.SuppressTokensAtBeginLogitsProcessor(_.begin_suppress_tokens,Zl))}return _.guidance_scale!==null&&_.guidance_scale>1&&Gl.push(new N.ClassifierFreeGuidanceLogitsProcessor(_.guidance_scale)),_I!==null&&Gl.extend(_I),Gl}_prepare_generation_config(_,CI,_I=m.GenerationConfig){let Gl={...this.config};for(let hl of["decoder","generator","text_config"])hl in Gl&&Object.assign(Gl,Gl[hl]);let Zl=new _I(Gl);return Object.assign(Zl,this.generation_config??{}),_&&Object.assign(Zl,_),CI&&Object.assign(Zl,(0,W.pick)(CI,Object.getOwnPropertyNames(Zl))),Zl}_get_stopping_criteria(_,CI=null){let _I=new p.StoppingCriteriaList;return _.max_length!==null&&_I.push(new p.MaxLengthCriteria(_.max_length,this.config.max_position_embeddings??null)),_.eos_token_id!==null&&_I.push(new p.EosTokenCriteria(_.eos_token_id)),CI&&_I.extend(CI),_I}_validate_model_class(){if(!this.can_generate){let _=[zt,Bt,ma,ZY],CI=E.get(this.constructor),_I=new Set,Gl=this.config.model_type;for(let hl of _){let Vl=hl.get(Gl);Vl&&_I.add(Vl[0])}let Zl=`The current model class (${CI}) is not compatible with \`.generate()\`, as it doesn't have a language model head.`;throw _I.size>0&&(Zl+=` Please use the following class instead: ${[..._I].join(", ")}`),Error(Zl)}}prepare_inputs_for_generation(..._){return this._prepare_inputs_for_generation(this,..._)}_update_model_kwargs_for_generation({generated_input_ids:_,outputs:CI,model_inputs:_I,is_encoder_decoder:Gl}){return _I.past_key_values=this.getPastKeyValues(CI,_I.past_key_values),_I.input_ids=new h.Tensor("int64",_.flat(),[_.length,1]),Gl?"decoder_attention_mask"in _I:_I.attention_mask=(0,h.cat)([_I.attention_mask,(0,h.ones)([_I.attention_mask.dims[0],1])],1),_I.position_ids=null,_I}_prepare_model_inputs({inputs:_,bos_token_id:CI,model_kwargs:_I}){let Gl=(0,W.pick)(_I,this.forward_params),Zl=this.main_input_name;if(Zl in Gl){if(_)throw new Error("`inputs`: {inputs}` were passed alongside {input_name} which is not allowed. Make sure to either pass {inputs} or {input_name}=...")}else Gl[Zl]=_;return{inputs_tensor:Gl[Zl],model_inputs:Gl,model_input_name:Zl}}async _prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:_,model_inputs:CI,model_input_name:_I,generation_config:Gl}){if(this.sessions.model.inputNames.includes("inputs_embeds")&&!CI.inputs_embeds&&"_prepare_inputs_embeds"in this){let{input_ids:hl,pixel_values:Vl,attention_mask:rl,...Ml}=CI,hG=await this._prepare_inputs_embeds(CI);CI={...Ml,...(0,W.pick)(hG,["inputs_embeds","attention_mask"])}}let{last_hidden_state:Zl}=await dI(this,CI);if(Gl.guidance_scale!==null&&Gl.guidance_scale>1)Zl=(0,h.cat)([Zl,(0,h.full_like)(Zl,0)],0),"attention_mask"in CI&&(CI.attention_mask=(0,h.cat)([CI.attention_mask,(0,h.zeros_like)(CI.attention_mask)],0));else if(CI.decoder_input_ids){let hl=VI(CI.decoder_input_ids).dims[0];if(hl!==Zl.dims[0]){if(Zl.dims[0]!==1)throw new Error(`The encoder outputs have a different batch size (${Zl.dims[0]}) than the decoder inputs (${hl}).`);Zl=(0,h.cat)(Array.from({length:hl},()=>Zl),0)}}return CI.encoder_outputs=Zl,CI}_prepare_decoder_input_ids_for_generation({batch_size:_,model_input_name:CI,model_kwargs:_I,decoder_start_token_id:Gl,bos_token_id:Zl,generation_config:hl}){let{decoder_input_ids:Vl,...rl}=_I;if(!(Vl instanceof h.Tensor)){if(Vl)Array.isArray(Vl[0])||(Vl=Array.from({length:_},()=>Vl));else if(Gl??=Zl,this.config.model_type==="musicgen")Vl=Array.from({length:_*this.config.decoder.num_codebooks},()=>[Gl]);else if(Array.isArray(Gl)){if(Gl.length!==_)throw new Error(`\`decoder_start_token_id\` expcted to have length ${_} but got ${Gl.length}`);Vl=Gl}else Vl=Array.from({length:_},()=>[Gl]);Vl=VI(Vl)}return _I.decoder_attention_mask=(0,h.ones_like)(Vl),{input_ids:Vl,model_inputs:rl}}async generate({inputs:_=null,generation_config:CI=null,logits_processor:_I=null,stopping_criteria:Gl=null,streamer:Zl=null,...hl}){this._validate_model_class(),CI=this._prepare_generation_config(CI,hl);let{inputs_tensor:Vl,model_inputs:rl,model_input_name:Ml}=this._prepare_model_inputs({inputs:_,model_kwargs:hl}),hG=this.config.is_encoder_decoder;hG&&("encoder_outputs"in rl||(rl=await this._prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:Vl,model_inputs:rl,model_input_name:Ml,generation_config:CI})));let tG;hG?{input_ids:tG,model_inputs:rl}=this._prepare_decoder_input_ids_for_generation({batch_size:rl[Ml].dims.at(0),model_input_name:Ml,model_kwargs:rl,decoder_start_token_id:CI.decoder_start_token_id,bos_token_id:CI.bos_token_id,generation_config:CI}):tG=rl[Ml];let ql=tG.dims.at(-1);CI.max_new_tokens!==null&&(CI.max_length=ql+CI.max_new_tokens);let fl=this._get_logits_processor(CI,ql,_I),dc=this._get_stopping_criteria(CI,Gl),nG=rl[Ml].dims.at(0),eG=F.LogitsSampler.getSampler(CI),KG=new Array(nG).fill(0),_G=tG.tolist();Zl&&Zl.put(_G);let iG,Qc={};for(;;){if(rl=this.prepare_inputs_for_generation(_G,rl,CI),iG=await this.forward(rl),CI.output_attentions&&CI.return_dict_in_generate){let Wb=this.getAttentions(iG);for(let Yd in Wb)Yd in Qc||(Qc[Yd]=[]),Qc[Yd].push(Wb[Yd])}let rc=iG.logits.slice(null,-1,null),cb=fl(_G,rc),Ob=[];for(let Wb=0;Wb<cb.dims.at(0);++Wb){let Yd=cb[Wb],EZ=await eG(Yd);for(let[Na,We]of EZ){let te=BigInt(Na);KG[Wb]+=We,_G[Wb].push(te),Ob.push([te]);break}}if(Zl&&Zl.put(Ob),dc(_G).every(Wb=>Wb))break;rl=this._update_model_kwargs_for_generation({generated_input_ids:Ob,outputs:iG,model_inputs:rl,is_encoder_decoder:hG})}Zl&&Zl.end();let Hc=this.getPastKeyValues(iG,rl.past_key_values,!0),Vc=new h.Tensor("int64",_G.flat(),[_G.length,_G[0].length]);if(CI.return_dict_in_generate)return{sequences:Vc,past_key_values:Hc,...Qc};for(let rc of Object.values(iG))rc.location==="gpu-buffer"&&rc.dispose();return Vc}getPastKeyValues(_,CI,_I=!1){let Gl=Object.create(null);for(let Zl in _)if(Zl.startsWith("present")){let hl=Zl.replace("present","past_key_values"),Vl=Zl.includes("encoder");if(Vl&&CI?Gl[hl]=CI[hl]:Gl[hl]=_[Zl],CI&&(!Vl||_I)){let rl=CI[hl];rl.location==="gpu-buffer"&&rl.dispose()}}return Gl}getAttentions(_){let CI={};for(let _I of["cross_attentions","encoder_attentions","decoder_attentions"])for(let Gl in _)Gl.startsWith(_I)&&(_I in CI||(CI[_I]=[]),CI[_I].push(_[Gl]));return CI}addPastKeyValues(_,CI){if(CI)Object.assign(_,CI);else{let Gl=(this.sessions.decoder_model_merged??this.sessions.model)?.config?.kv_cache_dtype??"float32",Zl=Gl==="float16"?new Uint16Array:[],hl=(_[this.main_input_name]??_.attention_mask)?.dims?.[0]??1,Vl=(0,b.getKeyValueShapes)(this.config,{batch_size:hl});for(let rl in Vl)_[rl]=new h.Tensor(Gl,Zl,Vl[rl])}}async encode_image({pixel_values:_}){let CI=(await hI(this.sessions.vision_encoder,{pixel_values:_})).image_features;return this.config.num_image_tokens||(console.warn(`The number of image tokens was not set in the model configuration. Setting it to the number of features detected by the vision encoder (${CI.dims[1]}).`),this.config.num_image_tokens=CI.dims[1]),CI}async encode_text({input_ids:_}){return(await hI(this.sessions.embed_tokens,{input_ids:_})).inputs_embeds}}class bI{}class FI extends bI{constructor({last_hidden_state:_,hidden_states:CI=null,attentions:_I=null}){super(),this.last_hidden_state=_,this.hidden_states=CI,this.attentions=_I}}class U extends L{}class k extends U{}class w extends U{async _call(_){return new Bc(await super._call(_))}}class r extends U{async _call(_){return new WG(await super._call(_))}}class A extends U{async _call(_){return new hc(await super._call(_))}}class O extends U{async _call(_){return new fc(await super._call(_))}}class K extends L{}class q extends K{}class GI extends K{async _call(_){return new Bc(await super._call(_))}}class tI extends K{async _call(_){return new WG(await super._call(_))}}class iI extends K{async _call(_){return new hc(await super._call(_))}}class B extends L{}class aI extends B{}class lI extends L{}class QI extends lI{}class vI extends lI{async _call(_){return new Bc(await super._call(_))}}class OI extends lI{async _call(_){return new WG(await super._call(_))}}class uI extends lI{async _call(_){return new hc(await super._call(_))}}class wI extends lI{async _call(_){return new fc(await super._call(_))}}class kI extends L{}class TI extends kI{}class Il extends kI{async _call(_){return new Bc(await super._call(_))}}class nl extends kI{async _call(_){return new WG(await super._call(_))}}class ol extends kI{async _call(_){return new hc(await super._call(_))}}class PI extends kI{async _call(_){return new fc(await super._call(_))}}class KI extends L{}class jI extends KI{}class Wl extends KI{async _call(_){return new Bc(await super._call(_))}}class wl extends KI{async _call(_){return new WG(await super._call(_))}}class Ol extends KI{async _call(_){return new hc(await super._call(_))}}class jl extends KI{async _call(_){return new fc(await super._call(_))}}class NG extends L{}class Fl extends NG{}class Dl extends NG{async _call(_){return new Bc(await super._call(_))}}class XG extends NG{async _call(_){return new WG(await super._call(_))}}class LG extends NG{async _call(_){return new hc(await super._call(_))}}class lc extends NG{async _call(_){return new fc(await super._call(_))}}class DG extends L{}class Wc extends DG{}class EG extends DG{async _call(_){return new Bc(await super._call(_))}}class MG extends DG{async _call(_){return new WG(await super._call(_))}}class xc extends DG{async _call(_){return new hc(await super._call(_))}}class qG extends DG{async _call(_){return new fc(await super._call(_))}}class sl extends L{}class ul extends sl{}class Cl extends sl{async _call(_){return new Bc(await super._call(_))}}class Gc extends sl{async _call(_){return new WG(await super._call(_))}}class yc extends sl{async _call(_){return new hc(await super._call(_))}}class ib extends sl{async _call(_){return new fc(await super._call(_))}}class xG extends L{}class lb extends xG{}class cc extends xG{async _call(_){return new WG(await super._call(_))}}class Qb extends xG{async _call(_){return new hc(await super._call(_))}}class YG extends xG{async _call(_){return new fc(await super._call(_))}}class Lb extends xG{async _call(_){return new Bc(await super._call(_))}}class sb extends L{}class td extends sb{}class Db extends sb{async _call(_){return new Bc(await super._call(_))}}class qb extends sb{async _call(_){return new WG(await super._call(_))}}class _b extends sb{async _call(_){return new hc(await super._call(_))}}class Yb extends L{}class Pb extends Yb{}class nd extends Yb{async _call(_){return new Bc(await super._call(_))}}class hb extends Yb{async _call(_){return new WG(await super._call(_))}}class kb extends Yb{async _call(_){return new fc(await super._call(_))}}class Vb extends L{}class XZ extends Vb{}class Dd extends Vb{async _call(_){return new Bc(await super._call(_))}}class iZ extends Vb{async _call(_){return new WG(await super._call(_))}}class QZ extends Vb{async _call(_){return new hc(await super._call(_))}}class HZ extends Vb{async _call(_){return new fc(await super._call(_))}}class Sl extends L{}class rZ extends Sl{}class _Z extends Sl{async _call(_){return new Bc(await super._call(_))}}class PZ extends Sl{async _call(_){return new WG(await super._call(_))}}class $Z extends Sl{async _call(_){return new fc(await super._call(_))}}class Jd extends L{}class Ie extends Jd{}class wZ extends Jd{async _call(_){return new WG(await super._call(_))}}class le extends Jd{async _call(_){return new fc(await super._call(_))}}class gG extends Jd{async _call(_){return new Bc(await super._call(_))}}class $I extends L{forward_params=["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"]}class II extends $I{}class AI extends $I{}class BI extends L{}class fI extends BI{}class bl extends BI{}class Nl extends L{}class vl extends Nl{}class yl extends Nl{}class El extends L{}class Hl extends El{}class rG extends El{}class dG extends El{async _call(_){return new WG(await super._call(_))}}class bc extends L{}class zc extends bc{}class lG extends bc{}class vG extends bc{async _call(_){return new WG(await super._call(_))}}class Uc extends bc{}class _c extends L{}class dl extends _c{}class Tc extends _c{}class md extends L{}class tc extends md{}class Mc extends md{}class Kl extends L{}class ab extends Kl{}class xb extends Kl{async _call(_){return new Bc(await super._call(_))}}class kG extends Kl{async _call(_){return new WG(await super._call(_))}}class nc extends Kl{async _call(_){return new hc(await super._call(_))}}class gl extends Kl{async _call(_){return new fc(await super._call(_))}}class ZG extends L{}class Rc extends ZG{}class mc extends ZG{async _call(_){return new Bc(await super._call(_))}}class gc extends ZG{async _call(_){return new WG(await super._call(_))}}class Ll extends ZG{async _call(_){return new hc(await super._call(_))}}class qd extends ZG{async _call(_){return new fc(await super._call(_))}}class tl extends L{}class Ul extends tl{}class bm extends tl{async _call(_){return new Bc(await super._call(_))}}class ZW extends tl{async _call(_){return new WG(await super._call(_))}}class dm extends tl{async _call(_){return new hc(await super._call(_))}}class Zm extends tl{async _call(_){return new fc(await super._call(_))}}class aG extends L{}class em extends aG{}class eW extends aG{}class aW extends L{requires_attention_mask=!1;main_input_name="input_features";forward_params=["input_features","attention_mask","decoder_input_ids","decoder_attention_mask","past_key_values"]}class am extends aW{}class Wm extends aW{_prepare_generation_config(_,CI){return super._prepare_generation_config(_,CI,u.WhisperGenerationConfig)}_retrieve_init_tokens(_){let CI=[_.decoder_start_token_id],_I=_.language,Gl=_.task;if(_.is_multilingual){_I||(console.warn("No language specified - defaulting to English (en)."),_I="en");let hl=`<|${(0,Q.whisper_language_to_code)(_I)}|>`;CI.push(_.lang_to_id[hl]),CI.push(_.task_to_id[Gl??"transcribe"])}else if(_I||Gl)throw new Error("Cannot specify `task` or `language` for an English-only model. If the model is intended to be multilingual, pass `is_multilingual=true` to generate, or update the generation config.");return!_.return_timestamps&&_.no_timestamps_token_id&&CI.at(-1)!==_.no_timestamps_token_id?CI.push(_.no_timestamps_token_id):_.return_timestamps&&CI.at(-1)===_.no_timestamps_token_id&&(console.warn("<|notimestamps|> prompt token is removed from generation_config since `return_timestamps` is set to `true`."),CI.pop()),CI.filter(Zl=>Zl!=null)}async generate({inputs:_=null,generation_config:CI=null,logits_processor:_I=null,stopping_criteria:Gl=null,...Zl}){CI=this._prepare_generation_config(CI,Zl);let hl=Zl.decoder_input_ids??this._retrieve_init_tokens(CI);if(CI.return_timestamps&&(_I??=new N.LogitsProcessorList,_I.push(new N.WhisperTimeStampLogitsProcessor(CI,hl))),CI.begin_suppress_tokens&&(_I??=new N.LogitsProcessorList,_I.push(new N.SuppressTokensAtBeginLogitsProcessor(CI.begin_suppress_tokens,hl.length))),CI.return_token_timestamps){if(!CI.alignment_heads)throw new Error("Model generation config has no `alignment_heads`, token-level timestamps not available. See https://gist.github.com/hollance/42e32852f24243b748ae6bc1f985b13a on how to add this property to the generation config.");CI.task==="translate"&&console.warn("Token-level timestamps may not be reliable for task 'translate'."),CI.output_attentions=!0,CI.return_dict_in_generate=!0}let Vl=await super.generate({inputs:_,generation_config:CI,logits_processor:_I,decoder_input_ids:hl,...Zl});return CI.return_token_timestamps&&(Vl.token_timestamps=this._extract_token_timestamps(Vl,CI.alignment_heads,CI.num_frames)),Vl}_extract_token_timestamps(_,CI,_I=null,Gl=.02){if(!_.cross_attentions)throw new Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");_I==null&&console.warn("`num_frames` has not been set, meaning the entire audio will be analyzed. This may lead to inaccurate token-level timestamps for short audios (< 30 seconds).");let Zl=this.config.median_filter_width;Zl===void 0&&(console.warn("Model config has no `median_filter_width`, using default value of 7."),Zl=7);let hl=_.cross_attentions,Vl=Array.from({length:this.config.decoder_layers},(nG,eG)=>(0,h.cat)(hl.map(KG=>KG[eG]),2)),rl=(0,h.stack)(CI.map(([nG,eG])=>{if(nG>=Vl.length)throw new Error(`Layer index ${nG} is out of bounds for cross attentions (length ${Vl.length}).`);return _I?Vl[nG].slice(null,eG,null,[0,_I]):Vl[nG].slice(null,eG)})).transpose(1,0,2,3),[Ml,hG]=(0,h.std_mean)(rl,-2,0,!0),tG=rl.clone();for(let nG=0;nG<tG.dims[0];++nG){let eG=tG[nG];for(let KG=0;KG<eG.dims[0];++KG){let _G=eG[KG],iG=Ml[nG][KG][0].data,Qc=hG[nG][KG][0].data;for(let Hc=0;Hc<_G.dims[0];++Hc){let Vc=_G[Hc].data;for(let rc=0;rc<Vc.length;++rc)Vc[rc]=(Vc[rc]-Qc[rc])/iG[rc];Vc.set((0,X.medianFilter)(Vc,Zl))}}}let ql=[(0,h.mean)(tG,1)],fl=_.sequences.dims,dc=new h.Tensor("float32",new Float32Array(fl[0]*fl[1]),fl);for(let nG=0;nG<fl[0];++nG){let eG=ql[nG].neg().squeeze_(0),[KG,_G]=(0,X.dynamic_time_warping)(eG.tolist()),iG=Array.from({length:KG.length-1},(Vc,rc)=>KG[rc+1]-KG[rc]),Qc=(0,W.mergeArrays)([1],iG).map(Vc=>!!Vc),Hc=[];for(let Vc=0;Vc<Qc.length;++Vc)Qc[Vc]&&Hc.push(_G[Vc]*Gl);dc[nG].data.set(Hc,1)}return dc}}class WW extends L{requires_attention_mask=!1;main_input_name="input_values";forward_params=["input_values","decoder_input_ids","past_key_values"]}class Hb extends WW{}class tm extends WW{}class tW extends L{main_input_name="pixel_values";forward_params=["pixel_values","decoder_input_ids","encoder_hidden_states","past_key_values"]}class Cd extends L{forward_params=["input_ids","attention_mask","pixel_values","position_ids","past_key_values"]}class Oe extends Cd{_merge_input_ids_with_image_features({inputs_embeds:_,image_features:CI,input_ids:_I,attention_mask:Gl}){let Zl=this.config.image_token_index,Vl=_I.tolist().map(ql=>ql.findIndex(fl=>fl==Zl)),rl=Vl.every(ql=>ql===-1),Ml=Vl.every(ql=>ql!==-1);if(!rl&&!Ml)throw new Error("Every input should contain either 0 or 1 image token.");if(rl)return{inputs_embeds:_,attention_mask:Gl};let hG=[],tG=[];for(let ql=0;ql<Vl.length;++ql){let fl=Vl[ql],dc=_[ql],nG=CI[ql],eG=Gl[ql];hG.push((0,h.cat)([dc.slice([0,fl]),nG,dc.slice([fl+1,dc.dims[0]])],0)),tG.push((0,h.cat)([eG.slice([0,fl]),(0,h.ones)([nG.dims[0]]),eG.slice([fl+1,eG.dims[0]])],0))}return{inputs_embeds:(0,h.stack)(hG,0),attention_mask:(0,h.stack)(tG,0)}}}class nm extends Oe{}class mm extends Oe{}class Nm extends L{forward_params=["input_ids","inputs_embeds","attention_mask","pixel_values","encoder_outputs","decoder_input_ids","decoder_inputs_embeds","decoder_attention_mask","past_key_values"];main_input_name="inputs_embeds"}class sm extends Nm{_merge_input_ids_with_image_features({inputs_embeds:_,image_features:CI,input_ids:_I,attention_mask:Gl}){return{inputs_embeds:(0,h.cat)([CI,_],1),attention_mask:(0,h.cat)([(0,h.ones)(CI.dims.slice(0,2)),Gl],1)}}async _prepare_inputs_embeds({input_ids:_,pixel_values:CI,inputs_embeds:_I,attention_mask:Gl}){if(!_&&!CI)throw new Error("Either `input_ids` or `pixel_values` should be provided.");let Zl,hl;return _&&(Zl=await this.encode_text({input_ids:_})),CI&&(hl=await this.encode_image({pixel_values:CI})),Zl&&hl?{inputs_embeds:_I,attention_mask:Gl}=this._merge_input_ids_with_image_features({inputs_embeds:Zl,image_features:hl,input_ids:_,attention_mask:Gl}):_I=Zl||hl,{inputs_embeds:_I,attention_mask:Gl}}async forward({input_ids:_,pixel_values:CI,attention_mask:_I,decoder_input_ids:Gl,decoder_attention_mask:Zl,encoder_outputs:hl,past_key_values:Vl,inputs_embeds:rl,decoder_inputs_embeds:Ml}){if(rl||({inputs_embeds:rl,attention_mask:_I}=await this._prepare_inputs_embeds({input_ids:_,pixel_values:CI,inputs_embeds:rl,attention_mask:_I})),!hl){let{last_hidden_state:ql}=await dI(this,{inputs_embeds:rl,attention_mask:_I});hl=ql}if(!Ml){if(!Gl)throw new Error("Either `decoder_input_ids` or `decoder_inputs_embeds` should be provided.");Ml=await this.encode_text({input_ids:Gl})}return await pI(this,{inputs_embeds:Ml,attention_mask:Zl,encoder_attention_mask:_I,encoder_hidden_states:hl,past_key_values:Vl},!0)}}class Ym extends L{forward_params=["input_ids","attention_mask","pixel_values","position_ids","past_key_values"]}class hm extends Ym{_merge_input_ids_with_image_features(_){let CI=_.image_features.dims.at(-1),_I=_.image_features.view(-1,CI);return yI({image_token_id:this.config.image_token_index,..._,image_features:_I})}}class Vm extends L{forward_params=["input_ids","attention_mask","pixel_values","pixel_attention_mask","position_ids","past_key_values"]}class nW extends Vm{async encode_image({pixel_values:_,pixel_attention_mask:CI}){return(await hI(this.sessions.vision_encoder,{pixel_values:_,pixel_attention_mask:CI})).image_features}_merge_input_ids_with_image_features(_){let CI=_.image_features.dims.at(-1),_I=_.image_features.view(-1,CI);return yI({image_token_id:this.config.image_token_id,..._,image_features:_I})}}class pm extends L{forward_params=["input_ids","inputs_embeds","attention_mask","position_ids","pixel_values","image_sizes","past_key_values"]}class rb extends pm{async forward({input_ids:_=null,attention_mask:CI=null,pixel_values:_I=null,image_sizes:Gl=null,position_ids:Zl=null,inputs_embeds:hl=null,past_key_values:Vl=null,generation_config:rl=null,logits_processor:Ml=null,...hG}){if(!hl){let ql;if(_I&&_.dims[1]!==1){if(!Gl)throw new Error("`image_sizes` must be provided when `pixel_values` is provided.");({image_features:ql}=await hI(this.sessions.vision_encoder,{pixel_values:_I,image_sizes:Gl}))}else{let fl=this.config.normalized_config.hidden_size;ql=new h.Tensor("float32",[],[0,fl])}({inputs_embeds:hl}=await hI(this.sessions.prepare_inputs_embeds,{input_ids:_,image_features:ql}))}return await pI(this,{inputs_embeds:hl,past_key_values:Vl,attention_mask:CI,position_ids:Zl,generation_config:rl,logits_processor:Ml},!1)}}class _d extends L{}class um extends _d{}class Eh extends _d{static async from_pretrained(_,CI={}){return super.from_pretrained(_,{...CI,model_file_name:CI.model_file_name??"text_model"})}}class Rm extends _d{static async from_pretrained(_,CI={}){return super.from_pretrained(_,{...CI,model_file_name:CI.model_file_name??"text_model"})}}class yh extends _d{static async from_pretrained(_,CI={}){return super.from_pretrained(_,{...CI,model_file_name:CI.model_file_name??"vision_model"})}}class om extends _d{static async from_pretrained(_,CI={}){return super.from_pretrained(_,{...CI,model_file_name:CI.model_file_name??"vision_model"})}}class mW extends L{}class Fm extends mW{}class Xm extends mW{static async from_pretrained(_,CI={}){return super.from_pretrained(_,{...CI,model_file_name:CI.model_file_name??"text_model"})}}class im extends _d{static async from_pretrained(_,CI={}){return super.from_pretrained(_,{...CI,model_file_name:CI.model_file_name??"vision_model"})}}class gh extends L{}class zb extends gh{}class je extends L{}class Ke extends je{async forward(_){let CI=!_.input_ids,_I=!_.pixel_values;if(CI&&_I)throw new Error("Either `input_ids` or `pixel_values` should be provided.");if(CI&&(_.input_ids=(0,h.ones)([_.pixel_values.dims[0],1])),_I){let{image_size:Ml}=this.config.vision_config;_.pixel_values=(0,h.full)([0,3,Ml,Ml],0)}let{text_embeddings:Gl,image_embeddings:Zl,l2norm_text_embeddings:hl,l2norm_image_embeddings:Vl}=await super.forward(_),rl={};return CI||(rl.text_embeddings=Gl,rl.l2norm_text_embeddings=hl),_I||(rl.image_embeddings=Zl,rl.l2norm_image_embeddings=Vl),rl}}class NW extends je{static async from_pretrained(_,CI={}){return super.from_pretrained(_,{...CI,model_file_name:CI.model_file_name??"text_model"})}}class Ub extends je{static async from_pretrained(_,CI={}){return super.from_pretrained(_,{...CI,model_file_name:CI.model_file_name??"vision_model"})}}class sW extends L{}class Qm extends sW{}class Hm extends sW{}class YW extends L{}class rm extends YW{}class wm extends YW{}class hW extends L{}class vm extends hW{}class Em extends hW{}class VW extends L{}class Mb extends VW{}class ym extends VW{}class pW extends L{}class gm extends pW{}class Jm extends pW{}class uW extends L{}class Cm extends uW{}class Am extends uW{}class RW extends L{}class Lm extends RW{}class km extends RW{}class Te extends L{}class oW extends Te{}class xm extends Te{}class FW extends L{}class XW extends FW{}class Jh extends FW{}class iW extends L{}class fe extends iW{}class zm extends iW{}class QW extends L{}class Um extends QW{}class Ge extends QW{}class HW extends L{}class Mm extends HW{}class rW extends HW{}class wW extends L{}class Bm extends wW{}class Om extends wW{}class vW extends L{}class Ch extends vW{}class jm extends vW{}class EW extends L{}class Km extends EW{}class Ah extends EW{}class yW extends L{}class JG extends yW{}class Tm extends yW{}class gW extends L{}class fm extends gW{}class Sm extends gW{}class JW extends L{}class Dm extends JW{}class qm extends JW{}class CW extends L{}class _m extends CW{}class Pm extends CW{}class AW extends L{}class $m extends AW{}class IN extends AW{}class LW extends L{}class ce extends LW{}class lN extends LW{}class Se extends L{forward_params=["input_ids","attention_mask","position_ids","past_key_values","pixel_values","image_grid_thw"]}class GN extends Se{get_rope_index(_,CI,_I,Gl){let{vision_config:Zl,image_token_id:hl,video_token_id:Vl,vision_start_token_id:rl}=this.config,Ml=Zl.spatial_merge_size??2,hG=[];if(CI||_I){let tG=_.tolist();Gl||(Gl=(0,h.ones_like)(_));let ql=Gl.tolist(),fl=Array.from({length:3},_G=>Array.from({length:_.dims[0]},iG=>Array.from({length:_.dims[1]},Qc=>1))),dc=CI?CI.tolist():[],nG=_I?_I.tolist():[],eG=0,KG=0;for(let _G=0;_G<tG.length;++_G){let iG=tG[_G].filter((Zc,oc)=>ql[_G][oc]==1),Hc=iG.reduce((Zc,oc,Ld)=>(oc==rl&&Zc.push(Ld),Zc),[]).map(Zc=>iG[Zc+1]),Vc=Hc.filter(Zc=>Zc==hl).length,rc=Hc.filter(Zc=>Zc==Vl).length,cb=[],Ob=0,jt=Vc,Wb=rc;for(let Zc=0;Zc<Hc.length;++Zc){let oc=iG.findIndex((xd,wb)=>wb>Ob&&xd==hl),Ld=iG.findIndex((xd,wb)=>wb>Ob&&xd==Vl),dZ=jt>0&&oc!==-1?oc:iG.length+1,ne=Wb>0&&Ld!==-1?Ld:iG.length+1,sa,me,Kt,Tt;dZ<ne?([me,Kt,Tt]=dc[eG],++eG,--jt,sa=dZ):([me,Kt,Tt]=nG[KG],++KG,--Wb,sa=ne);let[p2,ft,Ne]=[Number(me),Math.floor(Number(Kt)/Ml),Math.floor(Number(Tt)/Ml)],Ya=sa-Ob,kd=cb.length>0?(0,X.max)(cb.at(-1))[0]+1:0;cb.push(Array.from({length:3*Ya},(xd,wb)=>kd+wb%Ya));let St=Ya+kd,yZ=p2*ft*Ne,wY=Array.from({length:yZ},(xd,wb)=>St+Math.floor(wb/(ft*Ne))),vY=Array.from({length:yZ},(xd,wb)=>St+Math.floor(wb/Ne)%ft),EY=Array.from({length:yZ},(xd,wb)=>St+wb%Ne);cb.push([wY,vY,EY].flat()),Ob=sa+yZ}if(Ob<iG.length){let Zc=cb.length>0?(0,X.max)(cb.at(-1))[0]+1:0,oc=iG.length-Ob;cb.push(Array.from({length:3*oc},(Ld,dZ)=>Zc+dZ%oc))}let Yd=cb.reduce((Zc,oc)=>Zc+oc.length,0),EZ=new Array(Yd),Na=0;for(let Zc=0;Zc<3;++Zc)for(let oc=0;oc<cb.length;++oc){let Ld=cb[oc],dZ=Ld.length/3;for(let ne=Zc*dZ;ne<(Zc+1)*dZ;++ne)EZ[Na++]=Ld[ne]}let We=0,te=ql[_G];for(let Zc=0;Zc<te.length;++Zc)if(te[Zc]==1){for(let oc=0;oc<3;++oc)fl[oc][_G][Zc]=EZ[oc*Yd/3+We];++We}let UV=(0,X.max)(EZ)[0];hG.push(UV+1-tG[_G].length)}return[new h.Tensor("int64",fl.flat(1/0),[3,_.dims[0],_.dims[1]]),new h.Tensor("int64",hG,[hG.length,1])]}else if(Gl){let{data:tG,dims:ql}=HI(Gl),fl=BigInt64Array.from({length:3*tG.length},(nG,eG)=>tG[eG%tG.length]),dc=Array.from({length:ql[0]},(nG,eG)=>(0,X.max)(tG.subarray(ql[1]*eG,ql[1]*(eG+1)))[0]+1n+BigInt(ql[1]));return[new h.Tensor("int64",fl,[3,...ql]),new h.Tensor("int64",dc,[dc.length,1])]}else{let[tG,ql]=_.dims,fl=BigInt64Array.from({length:3*tG*ql},(dc,nG)=>BigInt(Math.floor(nG%ql/tG)));return[new h.Tensor("int64",fl,[3,..._.dims]),(0,h.zeros)([tG,1])]}}async encode_image({pixel_values:_,image_grid_thw:CI}){return(await hI(this.sessions.vision_encoder,{pixel_values:_,grid_thw:CI})).image_features}_merge_input_ids_with_image_features(_){return yI({image_token_id:this.config.image_token_id,..._})}prepare_inputs_for_generation(_,CI,_I){if(CI.attention_mask&&!CI.position_ids)if(!CI.past_key_values)[CI.position_ids,CI.rope_deltas]=this.get_rope_index(CI.input_ids,CI.image_grid_thw,CI.video_grid_thw,CI.attention_mask);else{CI.pixel_values=null;let Gl=BigInt(Object.values(CI.past_key_values)[0].dims.at(-2)),Zl=CI.rope_deltas.map(hl=>Gl+hl);CI.position_ids=(0,h.stack)([Zl,Zl,Zl],0)}return CI}}class kW extends L{}class cN extends kW{}class bN extends kW{}class xW extends L{}class dN extends xW{}class ZN extends xW{}class zW extends L{}class eN extends zW{}class aN extends zW{}class UW extends L{}class WN extends UW{}class tN extends UW{}class MW extends L{}class nN extends MW{}class mN extends MW{}class De extends L{}class NN extends De{}class BW extends De{async _call(_){return new WG(await super._call(_))}}class qe extends L{}class sN extends qe{}class YN extends qe{async _call(_){return new WG(await super._call(_))}}class hN extends L{}class VN extends hN{}class OW extends L{}class pN extends OW{}class jW extends OW{async _call(_){return new WG(await super._call(_))}}class uN extends L{}class RN extends uN{}class KW extends L{}class Lh extends KW{}class oN extends KW{async _call(_){return new WG(await super._call(_))}}class FN extends L{}class Bb extends FN{}class TW extends L{}class XN extends TW{}class iN extends TW{async _call(_){return new WG(await super._call(_))}}class QN extends L{}class HN extends QN{async _call(_){return new HY(await super._call(_))}}class fW extends L{}class rN extends fW{}class wN extends fW{async _call(_){return new WG(await super._call(_))}}class SW extends L{}class vN extends SW{}class kh extends SW{async _call(_){return new WG(await super._call(_))}}class DW extends L{}class EN extends DW{}class yN extends DW{}class qW extends L{}class gN extends qW{}class JN extends qW{}class CN extends L{}class Pd extends CN{}class $d extends CN{async _call(_){return new WG(await super._call(_))}}class Nd extends L{}class _W extends Nd{}class IZ extends Nd{async _call(_){return new PW(await super._call(_))}}class Jc extends Nd{async _call(_){return new $W(await super._call(_))}}class PW extends bI{constructor({logits:_,pred_boxes:CI}){super(),this.logits=_,this.pred_boxes=CI}}class $W extends bI{constructor({logits:_,pred_boxes:CI,pred_masks:_I}){super(),this.logits=_,this.pred_boxes=CI,this.pred_masks=_I}}class It extends L{}class xh extends It{}class be extends It{async _call(_){return new lt(await super._call(_))}}class lt extends bI{constructor({logits:_,pred_boxes:CI}){super(),this.logits=_,this.pred_boxes=CI}}class _e extends L{}class AN extends _e{}class LN extends _e{async _call(_){return new Gt(await super._call(_))}}class Gt extends PW{}class Pe extends L{}class kN extends Pe{}class ct extends Pe{async _call(_){return new WG(await super._call(_))}}class bt extends L{}class $e extends bt{}class dt extends bt{async _call(_){return new WG(await super._call(_))}}class Zt extends L{}class xN extends Zt{}class zh extends Zt{async _call(_){return new WG(await super._call(_))}}class et extends L{}class at extends et{}class de extends et{async _call(_){return new WG(await super._call(_))}}class Wt extends L{}class tt extends Wt{}class zN extends Wt{}class nt extends L{}class UN extends nt{}class Uh extends nt{}class MN extends L{}class BN extends MN{}class mt extends L{}class ON extends mt{}class Ia extends mt{}class jN extends mt{}class la extends L{}class Nt extends la{}class Ga extends L{}class KN extends Ga{}class TN extends Ga{}class ca extends L{}class Mh extends ca{}class fN extends ca{}class Bh extends L{}class SN extends Bh{}class st extends L{}class DN extends st{}class Yt extends st{async _call(_){return new WG(await super._call(_))}}class ht extends L{}class qN extends ht{}class Vt extends ht{async _call(_){return new WG(await super._call(_))}}class pt extends L{}class _N extends pt{}class Oh extends pt{async _call(_){return new WG(await super._call(_))}}class ut extends L{}class PN extends ut{}class $N extends ut{async _call(_){return new WG(await super._call(_))}}class jh extends L{}class Is extends jh{}class Rt extends L{}class ls extends Rt{}class Gs extends Rt{async _call(_){return new cs(await super._call(_))}}class cs extends bI{constructor({logits:_,pred_boxes:CI}){super(),this.logits=_,this.pred_boxes=CI}}class Kh extends L{}class ba extends Kh{async get_image_embeddings({pixel_values:_}){return await dI(this,{pixel_values:_})}async forward(_){if((!_.image_embeddings||!_.image_positional_embeddings)&&(_={..._,...await this.get_image_embeddings(_)}),!_.input_labels&&_.input_points){let _I=_.input_points.dims.slice(0,-1),Gl=_I.reduce((Zl,hl)=>Zl*hl,1);_.input_labels=new h.Tensor("int64",new BigInt64Array(Gl).fill(1n),_I)}let CI={image_embeddings:_.image_embeddings,image_positional_embeddings:_.image_positional_embeddings};return _.input_points&&(CI.input_points=_.input_points),_.input_labels&&(CI.input_labels=_.input_labels),_.input_boxes&&(CI.input_boxes=_.input_boxes),await hI(this.sessions.prompt_encoder_mask_decoder,CI)}async _call(_){return new Ze(await super._call(_))}}class Ze extends bI{constructor({iou_scores:_,pred_masks:CI}){super(),this.iou_scores=_,this.pred_masks=CI}}class da extends L{}class bs extends da{}class ds extends da{}class ot extends L{}class Zs extends ot{}class Ft extends ot{}class Ad extends L{}class es extends Ad{}class as extends Ad{async _call(_){return new bZ(await super._call(_))}}class Th extends Ad{async _call(_){return new WG(await super._call(_))}}class Ws extends Ad{async _call(_){return new hc(await super._call(_))}}class Za extends L{}class ts extends Za{}class ns extends Za{async _call(_){return new hc(await super._call(_))}}class ms extends L{}class fh extends ms{}class ea extends L{}class Ns extends ea{}class Sh extends ea{async _call(_){return new bZ(await super._call(_))}}class ss extends ea{async _call(_){return new WG(await super._call(_))}}class ee extends L{}class Ys extends ee{}class hs extends ee{async _call(_){return new bZ(await super._call(_))}}class Dh extends ee{async _call(_){return new WG(await super._call(_))}}class Vs extends ee{async _call(_){return new hc(await super._call(_))}}class aa extends L{}class ps extends aa{}class qh extends aa{async _call(_){return new bZ(await super._call(_))}}class us extends aa{async _call(_){return new WG(await super._call(_))}}class _h extends L{}class Rs extends Ad{}class os extends Ad{async _call(_){return new bZ(await super._call(_))}}class Ph extends Ad{async _call(_){return new WG(await super._call(_))}}class vZ extends L{}class Fs extends vZ{}class Xs extends vZ{async _call(_){return new bZ(await super._call(_))}}class is extends vZ{async _call(_){return new WG(await super._call(_))}}class $h extends vZ{async _call(_){return new QY(await super._call(_))}}class Qs extends vZ{async _call(_){return new hc(await super._call(_))}}class Hs extends L{}class rs extends Hs{}class Wa extends L{}class N2 extends Wa{}class $b extends Wa{}class sd extends Wa{async generate_speech(_,CI,{threshold:_I=.5,minlenratio:Gl=0,maxlenratio:Zl=20,vocoder:hl=null}={}){let Vl={input_ids:_},{encoder_outputs:rl,encoder_attention_mask:Ml}=await dI(this,Vl),hG=rl.dims[1]/this.config.reduction_factor,tG=Math.floor(hG*Zl),ql=Math.floor(hG*Gl),fl=this.config.num_mel_bins,dc=[],nG=null,eG=null,KG=0;for(;;){++KG;let Qc=sI(!!eG),Hc;eG?Hc=eG.output_sequence_out:Hc=new h.Tensor("float32",new Float32Array(fl),[1,1,fl]);let Vc={use_cache_branch:Qc,output_sequence:Hc,encoder_attention_mask:Ml,speaker_embeddings:CI,encoder_hidden_states:rl};this.addPastKeyValues(Vc,nG),eG=await hI(this.sessions.decoder_model_merged,Vc),nG=this.getPastKeyValues(eG,nG);let{prob:rc,spectrum:cb}=eG;if(dc.push(cb),KG>=ql&&(Array.from(rc.data).filter(Ob=>Ob>=_I).length>0||KG>=tG))break}let _G=(0,h.cat)(dc),{waveform:iG}=await hI(hl.sessions.model,{spectrogram:_G});return{spectrogram:_G,waveform:iG}}}class lZ extends L{main_input_name="spectrogram"}class GZ extends L{}class ws extends GZ{}class Xt extends L{}class vs extends Xt{}class Es extends Xt{}class it extends L{}class ys extends it{}class gs extends it{}class Qt extends L{}class Js extends Qt{}class Cs extends Qt{}class Ht extends L{}class Gb extends Ht{}class As extends Ht{static async from_pretrained(_,CI={}){return super.from_pretrained(_,{...CI,model_file_name:CI.model_file_name??"text_model"})}}class Ls extends Ht{static async from_pretrained(_,CI={}){return super.from_pretrained(_,{...CI,model_file_name:CI.model_file_name??"audio_model"})}}class rt extends L{}class wt extends rt{async _call(_){return new rY(await super._call(_))}}class cZ extends L{}class IV extends cZ{}class ks extends cZ{}class xs extends cZ{}class vt extends L{}class zs extends vt{}class Us extends vt{}class ta extends L{}class Ms extends ta{}class Bs extends ta{async _call(_){return new WG(await super._call(_))}}class Et extends L{}class lV extends Et{}class GV extends Et{}class na extends L{forward_params=["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"];_apply_and_filter_by_delay_pattern_mask(_){let[CI,_I]=_.dims,Gl=this.config.decoder.num_codebooks,Zl=_I-Gl,hl=0;for(let Ml=0;Ml<_.size;++Ml){if(_.data[Ml]===this.config.decoder.pad_token_id)continue;let hG=Ml%_I,tG=Math.floor(Ml/_I)%Gl,ql=hG-tG;ql>0&&ql<=Zl&&(_.data[hl++]=_.data[Ml])}let Vl=Math.floor(CI/Gl),rl=hl/(Vl*Gl);return new h.Tensor(_.type,_.data.slice(0,hl),[Vl,Gl,rl])}prepare_inputs_for_generation(_,CI,_I){let Gl=structuredClone(_);for(let hl=0;hl<Gl.length;++hl)for(let Vl=0;Vl<Gl[hl].length;++Vl)hl%this.config.decoder.num_codebooks>=Vl&&(Gl[hl][Vl]=BigInt(this.config.decoder.pad_token_id));return _I.guidance_scale!==null&&_I.guidance_scale>1&&(Gl=Gl.concat(Gl)),super.prepare_inputs_for_generation(Gl,CI,_I)}async generate(_){let CI=await super.generate(_),_I=this._apply_and_filter_by_delay_pattern_mask(CI).unsqueeze_(0),{audio_values:Gl}=await hI(this.sessions.encodec_decode,{audio_codes:_I});return Gl}}class yt extends L{}class cV extends yt{}class gt extends yt{async _call(_){return new WG(await super._call(_))}}class Jt extends L{}class Os extends Jt{}class js extends Jt{async _call(_){return new WG(await super._call(_))}}class Ks extends L{}class Ts extends Ks{}class fs extends Ks{async _call(_){return new WG(await super._call(_))}}class Ct extends L{}class bV extends Ct{}class Ss extends Ct{async _call(_){return new WG(await super._call(_))}}class Ds extends L{}class dV extends Ds{}class qs extends L{}class _s extends qs{forward_params=["input_ids","pixel_values","images_seq_mask","images_emb_mask","attention_mask","position_ids","past_key_values"];constructor(..._){super(..._),this._generation_mode="text"}async forward(_){let CI=this._generation_mode??"text",_I;if(CI==="text"||!_.past_key_values){let rl=this.sessions.prepare_inputs_embeds,Ml=(0,W.pick)(_,rl.inputNames);_I=await hI(rl,Ml)}else{let rl=this.sessions.gen_img_embeds,Ml=(0,W.pick)({image_ids:_.input_ids},rl.inputNames);_I=await hI(rl,Ml)}let Gl={..._,..._I},Zl=await pI(this,Gl),hl=this.sessions[CI==="text"?"lm_head":"gen_head"];if(!hl)throw new Error(`Unable to find "${hl}" generation head`);let Vl=await hI(hl,(0,W.pick)(Zl,hl.inputNames));return{..._I,...Zl,...Vl}}async generate(_){return this._generation_mode="text",super.generate(_)}async generate_images(_){this._generation_mode="image";let CI=(_.inputs??_[this.main_input_name]).dims[1],Gl=(await super.generate(_)).slice(null,[CI,null]),Zl=this.sessions.image_decode,{decoded_image:hl}=await hI(Zl,{generated_tokens:Gl}),Vl=hl.add_(1).mul_(255/2).clamp_(0,255).to("uint8"),rl=[];for(let Ml of Vl){let hG=V.RawImage.fromTensor(Ml);rl.push(hG)}return rl}}class Ps extends bI{constructor({char_logits:_,bpe_logits:CI,wp_logits:_I}){super(),this.char_logits=_,this.bpe_logits=CI,this.wp_logits=_I}get logits(){return[this.char_logits,this.bpe_logits,this.wp_logits]}}class $s extends L{}class IY extends $s{async _call(_){return new Ps(await super._call(_))}}class lY extends L{}class GY extends lY{}class cY extends lY{}class At extends L{}class bY extends At{}class dY extends At{}class jG{static MODEL_CLASS_MAPPINGS=null;static BASE_IF_FAIL=!1;static async from_pretrained(_,{progress_callback:CI=null,config:_I=null,cache_dir:Gl=null,local_files_only:Zl=!1,revision:hl="main",model_file_name:Vl=null,subfolder:rl="onnx",device:Ml=null,dtype:hG=null,use_external_data_format:tG=null,session_options:ql={}}={}){let fl={progress_callback:CI,config:_I,cache_dir:Gl,local_files_only:Zl,revision:hl,model_file_name:Vl,subfolder:rl,device:Ml,dtype:hG,use_external_data_format:tG,session_options:ql};if(fl.config=await b.AutoConfig.from_pretrained(_,fl),!this.MODEL_CLASS_MAPPINGS)throw new Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);for(let dc of this.MODEL_CLASS_MAPPINGS){let nG=dc.get(fl.config.model_type);if(nG)return await nG[1].from_pretrained(_,fl)}if(this.BASE_IF_FAIL)return console.warn(`Unknown model class "${fl.config.model_type}", attempting to construct from base class.`),await L.from_pretrained(_,fl);throw Error(`Unsupported model type: ${fl.config.model_type}`)}}let ZV=new Map([["bert",["BertModel",k]],["modernbert",["ModernBertModel",q]],["nomic_bert",["NomicBertModel",aI]],["roformer",["RoFormerModel",QI]],["electra",["ElectraModel",jI]],["esm",["EsmModel",td]],["convbert",["ConvBertModel",TI]],["camembert",["CamembertModel",Fl]],["deberta",["DebertaModel",Wc]],["deberta-v2",["DebertaV2Model",ul]],["mpnet",["MPNetModel",XZ]],["albert",["AlbertModel",Ie]],["distilbert",["DistilBertModel",lb]],["roberta",["RobertaModel",ab]],["xlm",["XLMModel",Rc]],["xlm-roberta",["XLMRobertaModel",Ul]],["clap",["ClapModel",Gb]],["clip",["CLIPModel",um]],["clipseg",["CLIPSegModel",Qm]],["chinese_clip",["ChineseCLIPModel",zb]],["siglip",["SiglipModel",Fm]],["jina_clip",["JinaCLIPModel",Ke]],["mobilebert",["MobileBertModel",Pb]],["squeezebert",["SqueezeBertModel",rZ]],["wav2vec2",["Wav2Vec2Model",es]],["wav2vec2-bert",["Wav2Vec2BertModel",ps]],["unispeech",["UniSpeechModel",Ns]],["unispeech-sat",["UniSpeechSatModel",Ys]],["hubert",["HubertModel",Rs]],["wavlm",["WavLMModel",Fs]],["audio-spectrogram-transformer",["ASTModel",em]],["vits",["VitsModel",wt]],["pyannote",["PyAnnoteModel",ts]],["wespeaker-resnet",["WeSpeakerResNetModel",fh]],["detr",["DetrModel",_W]],["rt_detr",["RTDetrModel",xh]],["table-transformer",["TableTransformerModel",AN]],["vit",["ViTModel",NN]],["ijepa",["IJepaModel",sN]],["pvt",["PvtModel",pN]],["vit_msn",["ViTMSNModel",Lh]],["vit_mae",["ViTMAEModel",RN]],["groupvit",["GroupViTModel",Bb]],["fastvit",["FastViTModel",XN]],["mobilevit",["MobileViTModel",rN]],["mobilevitv2",["MobileViTV2Model",vN]],["owlvit",["OwlViTModel",EN]],["owlv2",["Owlv2Model",gN]],["beit",["BeitModel",Pd]],["deit",["DeiTModel",kN]],["hiera",["HieraModel",$e]],["convnext",["ConvNextModel",DN]],["convnextv2",["ConvNextV2Model",qN]],["dinov2",["Dinov2Model",_N]],["dinov2_with_registers",["Dinov2WithRegistersModel",PN]],["resnet",["ResNetModel",xN]],["swin",["SwinModel",at]],["swin2sr",["Swin2SRModel",tt]],["donut-swin",["DonutSwinModel",SN]],["yolos",["YolosModel",ls]],["dpt",["DPTModel",UN]],["glpn",["GLPNModel",Mh]],["hifigan",["SpeechT5HifiGan",lZ]],["efficientnet",["EfficientNetModel",Ms]],["decision_transformer",["DecisionTransformerModel",dV]],["patchtst",["PatchTSTForPrediction",GY]],["patchtsmixer",["PatchTSMixerForPrediction",bY]],["mobilenet_v1",["MobileNetV1Model",cV]],["mobilenet_v2",["MobileNetV2Model",Os]],["mobilenet_v3",["MobileNetV3Model",Ts]],["mobilenet_v4",["MobileNetV4Model",bV]],["maskformer",["MaskFormerModel",KN]],["mgp-str",["MgpstrForSceneTextRecognition",IY]],["style_text_to_speech_2",["StyleTextToSpeech2Model",rs]]]),eV=new Map([["t5",["T5Model",II]],["longt5",["LongT5Model",fI]],["mt5",["MT5Model",vl]],["bart",["BartModel",Hl]],["mbart",["MBartModel",zc]],["marian",["MarianModel",bs]],["whisper",["WhisperModel",am]],["m2m_100",["M2M100Model",Zs]],["blenderbot",["BlenderbotModel",dl]],["blenderbot-small",["BlenderbotSmallModel",tc]]]),aV=new Map([["bloom",["BloomModel",eN]],["jais",["JAISModel",vm]],["gpt2",["GPT2Model",rm]],["gptj",["GPTJModel",Cm]],["gpt_bigcode",["GPTBigCodeModel",Lm]],["gpt_neo",["GPTNeoModel",Mb]],["gpt_neox",["GPTNeoXModel",gm]],["codegen",["CodeGenModel",oW]],["llama",["LlamaModel",XW]],["exaone",["ExaoneModel",Mm]],["olmo",["OlmoModel",Ch]],["olmo2",["Olmo2Model",Km]],["mobilellm",["MobileLLMModel",Bm]],["granite",["GraniteModel",JG]],["cohere",["CohereModel",fm]],["gemma",["GemmaModel",Dm]],["gemma2",["Gemma2Model",_m]],["helium",["HeliumModel",fe]],["glm",["GlmModel",Um]],["openelm",["OpenELMModel",$m]],["qwen2",["Qwen2Model",ce]],["phi",["PhiModel",cN]],["phi3",["Phi3Model",dN]],["mpt",["MptModel",WN]],["opt",["OPTModel",nN]],["mistral",["MistralModel",vs]],["starcoder2",["Starcoder2Model",ys]],["falcon",["FalconModel",Js]],["stablelm",["StableLmModel",zs]]]),ZY=new Map([["speecht5",["SpeechT5ForSpeechToText",$b]],["whisper",["WhisperForConditionalGeneration",Wm]],["moonshine",["MoonshineForConditionalGeneration",tm]]]),ae=new Map([["speecht5",["SpeechT5ForTextToSpeech",sd]]]),Lt=new Map([["vits",["VitsModel",wt]],["musicgen",["MusicgenForConditionalGeneration",na]]]),kt=new Map([["bert",["BertForSequenceClassification",r]],["modernbert",["ModernBertForSequenceClassification",tI]],["roformer",["RoFormerForSequenceClassification",OI]],["electra",["ElectraForSequenceClassification",wl]],["esm",["EsmForSequenceClassification",qb]],["convbert",["ConvBertForSequenceClassification",nl]],["camembert",["CamembertForSequenceClassification",XG]],["deberta",["DebertaForSequenceClassification",MG]],["deberta-v2",["DebertaV2ForSequenceClassification",Gc]],["mpnet",["MPNetForSequenceClassification",iZ]],["albert",["AlbertForSequenceClassification",wZ]],["distilbert",["DistilBertForSequenceClassification",cc]],["roberta",["RobertaForSequenceClassification",kG]],["xlm",["XLMForSequenceClassification",gc]],["xlm-roberta",["XLMRobertaForSequenceClassification",ZW]],["bart",["BartForSequenceClassification",dG]],["mbart",["MBartForSequenceClassification",vG]],["mobilebert",["MobileBertForSequenceClassification",hb]],["squeezebert",["SqueezeBertForSequenceClassification",PZ]]]),xt=new Map([["bert",["BertForTokenClassification",A]],["modernbert",["ModernBertForTokenClassification",iI]],["roformer",["RoFormerForTokenClassification",uI]],["electra",["ElectraForTokenClassification",Ol]],["esm",["EsmForTokenClassification",_b]],["convbert",["ConvBertForTokenClassification",ol]],["camembert",["CamembertForTokenClassification",LG]],["deberta",["DebertaForTokenClassification",xc]],["deberta-v2",["DebertaV2ForTokenClassification",yc]],["mpnet",["MPNetForTokenClassification",QZ]],["distilbert",["DistilBertForTokenClassification",Qb]],["roberta",["RobertaForTokenClassification",nc]],["xlm",["XLMForTokenClassification",Ll]],["xlm-roberta",["XLMRobertaForTokenClassification",dm]]]),ma=new Map([["t5",["T5ForConditionalGeneration",AI]],["longt5",["LongT5ForConditionalGeneration",bl]],["mt5",["MT5ForConditionalGeneration",yl]],["bart",["BartForConditionalGeneration",rG]],["mbart",["MBartForConditionalGeneration",lG]],["marian",["MarianMTModel",ds]],["m2m_100",["M2M100ForConditionalGeneration",Ft]],["blenderbot",["BlenderbotForConditionalGeneration",Tc]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",Mc]]]),zt=new Map([["bloom",["BloomForCausalLM",aN]],["gpt2",["GPT2LMHeadModel",wm]],["jais",["JAISLMHeadModel",Em]],["gptj",["GPTJForCausalLM",Am]],["gpt_bigcode",["GPTBigCodeForCausalLM",km]],["gpt_neo",["GPTNeoForCausalLM",ym]],["gpt_neox",["GPTNeoXForCausalLM",Jm]],["codegen",["CodeGenForCausalLM",xm]],["llama",["LlamaForCausalLM",Jh]],["exaone",["ExaoneForCausalLM",rW]],["olmo",["OlmoForCausalLM",jm]],["olmo2",["Olmo2ForCausalLM",Ah]],["mobilellm",["MobileLLMForCausalLM",Om]],["granite",["GraniteForCausalLM",Tm]],["cohere",["CohereForCausalLM",Sm]],["gemma",["GemmaForCausalLM",qm]],["gemma2",["Gemma2ForCausalLM",Pm]],["helium",["HeliumForCausalLM",zm]],["glm",["GlmForCausalLM",Ge]],["openelm",["OpenELMForCausalLM",IN]],["qwen2",["Qwen2ForCausalLM",lN]],["phi",["PhiForCausalLM",bN]],["phi3",["Phi3ForCausalLM",ZN]],["mpt",["MptForCausalLM",tN]],["opt",["OPTForCausalLM",mN]],["mbart",["MBartForCausalLM",Uc]],["mistral",["MistralForCausalLM",Es]],["starcoder2",["Starcoder2ForCausalLM",gs]],["falcon",["FalconForCausalLM",Cs]],["trocr",["TrOCRForCausalLM",ws]],["stablelm",["StableLmForCausalLM",Us]],["phi3_v",["Phi3VForCausalLM",rb]]]),WV=new Map([["multi_modality",["MultiModalityCausalLM",_s]]]),Ut=new Map([["bert",["BertForMaskedLM",w]],["modernbert",["ModernBertForMaskedLM",GI]],["roformer",["RoFormerForMaskedLM",vI]],["electra",["ElectraForMaskedLM",Wl]],["esm",["EsmForMaskedLM",Db]],["convbert",["ConvBertForMaskedLM",Il]],["camembert",["CamembertForMaskedLM",Dl]],["deberta",["DebertaForMaskedLM",EG]],["deberta-v2",["DebertaV2ForMaskedLM",Cl]],["mpnet",["MPNetForMaskedLM",Dd]],["albert",["AlbertForMaskedLM",gG]],["distilbert",["DistilBertForMaskedLM",Lb]],["roberta",["RobertaForMaskedLM",xb]],["xlm",["XLMWithLMHeadModel",mc]],["xlm-roberta",["XLMRobertaForMaskedLM",bm]],["mobilebert",["MobileBertForMaskedLM",nd]],["squeezebert",["SqueezeBertForMaskedLM",_Z]]]),Mt=new Map([["bert",["BertForQuestionAnswering",O]],["roformer",["RoFormerForQuestionAnswering",wI]],["electra",["ElectraForQuestionAnswering",jl]],["convbert",["ConvBertForQuestionAnswering",PI]],["camembert",["CamembertForQuestionAnswering",lc]],["deberta",["DebertaForQuestionAnswering",qG]],["deberta-v2",["DebertaV2ForQuestionAnswering",ib]],["mpnet",["MPNetForQuestionAnswering",HZ]],["albert",["AlbertForQuestionAnswering",le]],["distilbert",["DistilBertForQuestionAnswering",YG]],["roberta",["RobertaForQuestionAnswering",gl]],["xlm",["XLMForQuestionAnswering",qd]],["xlm-roberta",["XLMRobertaForQuestionAnswering",Zm]],["mobilebert",["MobileBertForQuestionAnswering",kb]],["squeezebert",["SqueezeBertForQuestionAnswering",$Z]]]),Bt=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",tW]],["idefics3",["Idefics3ForConditionalGeneration",nW]]]),tV=new Map([["llava",["LlavaForConditionalGeneration",Oe]],["llava_onevision",["LlavaOnevisionForConditionalGeneration",nm]],["moondream1",["Moondream1ForConditionalGeneration",mm]],["florence2",["Florence2ForConditionalGeneration",sm]],["qwen2-vl",["Qwen2VLForConditionalGeneration",GN]],["idefics3",["Idefics3ForConditionalGeneration",nW]],["paligemma",["PaliGemmaForConditionalGeneration",hm]]]),eY=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",tW]]]),aY=new Map([["vit",["ViTForImageClassification",BW]],["ijepa",["IJepaForImageClassification",YN]],["pvt",["PvtForImageClassification",jW]],["vit_msn",["ViTMSNForImageClassification",oN]],["fastvit",["FastViTForImageClassification",iN]],["mobilevit",["MobileViTForImageClassification",wN]],["mobilevitv2",["MobileViTV2ForImageClassification",kh]],["beit",["BeitForImageClassification",$d]],["deit",["DeiTForImageClassification",ct]],["hiera",["HieraForImageClassification",dt]],["convnext",["ConvNextForImageClassification",Yt]],["convnextv2",["ConvNextV2ForImageClassification",Vt]],["dinov2",["Dinov2ForImageClassification",Oh]],["dinov2_with_registers",["Dinov2WithRegistersForImageClassification",$N]],["resnet",["ResNetForImageClassification",zh]],["swin",["SwinForImageClassification",de]],["segformer",["SegformerForImageClassification",ks]],["efficientnet",["EfficientNetForImageClassification",Bs]],["mobilenet_v1",["MobileNetV1ForImageClassification",gt]],["mobilenet_v2",["MobileNetV2ForImageClassification",js]],["mobilenet_v3",["MobileNetV3ForImageClassification",fs]],["mobilenet_v4",["MobileNetV4ForImageClassification",Ss]]]),WY=new Map([["detr",["DetrForObjectDetection",IZ]],["rt_detr",["RTDetrForObjectDetection",be]],["table-transformer",["TableTransformerForObjectDetection",LN]],["yolos",["YolosForObjectDetection",Gs]]]),Ot=new Map([["owlvit",["OwlViTForObjectDetection",yN]],["owlv2",["Owlv2ForObjectDetection",JN]],["grounding-dino",["GroundingDinoForObjectDetection",Is]]]),tY=new Map([["detr",["DetrForSegmentation",Jc]],["clipseg",["CLIPSegForImageSegmentation",Hm]]]),nY=new Map([["segformer",["SegformerForSemanticSegmentation",xs]],["sapiens",["SapiensForSemanticSegmentation",ON]]]),mY=new Map([["detr",["DetrForSegmentation",Jc]],["maskformer",["MaskFormerForInstanceSegmentation",TN]]]),NY=new Map([["sam",["SamModel",ba]]]),nV=new Map([["wav2vec2",["Wav2Vec2ForCTC",as]],["wav2vec2-bert",["Wav2Vec2BertForCTC",qh]],["unispeech",["UniSpeechForCTC",Sh]],["unispeech-sat",["UniSpeechSatForCTC",hs]],["wavlm",["WavLMForCTC",Xs]],["hubert",["HubertForCTC",os]]]),sY=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",Th]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",us]],["unispeech",["UniSpeechForSequenceClassification",ss]],["unispeech-sat",["UniSpeechSatForSequenceClassification",Dh]],["wavlm",["WavLMForSequenceClassification",is]],["hubert",["HubertForSequenceClassification",Ph]],["audio-spectrogram-transformer",["ASTForAudioClassification",eW]]]),YY=new Map([["wavlm",["WavLMForXVector",$h]]]),hY=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",Vs]],["wavlm",["WavLMForAudioFrameClassification",Qs]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",Ws]],["pyannote",["PyAnnoteForAudioFrameClassification",ns]]]),VY=new Map([["vitmatte",["VitMatteForImageMatting",HN]]]),s2=new Map([["patchtst",["PatchTSTForPrediction",cY]],["patchtsmixer",["PatchTSMixerForPrediction",dY]]]),pY=new Map([["swin2sr",["Swin2SRForImageSuperResolution",zN]]]),uY=new Map([["dpt",["DPTForDepthEstimation",Uh]],["depth_anything",["DepthAnythingForDepthEstimation",BN]],["glpn",["GLPNForDepthEstimation",fN]],["sapiens",["SapiensForDepthEstimation",Ia]],["depth_pro",["DepthProForDepthEstimation",Nt]]]),RY=new Map([["sapiens",["SapiensForNormalEstimation",jN]]]),mV=new Map([["vitpose",["VitPoseForPoseEstimation",VN]]]),oY=new Map([["clip",["CLIPVisionModelWithProjection",om]],["siglip",["SiglipVisionModel",im]],["jina_clip",["JinaCLIPVisionModel",Ub]]]),FY=[[ZV,o.EncoderOnly],[eV,o.EncoderDecoder],[aV,o.DecoderOnly],[kt,o.EncoderOnly],[xt,o.EncoderOnly],[ma,o.Seq2Seq],[ZY,o.Seq2Seq],[zt,o.DecoderOnly],[WV,o.MultiModality],[Ut,o.EncoderOnly],[Mt,o.EncoderOnly],[Bt,o.Vision2Seq],[tV,o.ImageTextToText],[aY,o.EncoderOnly],[tY,o.EncoderOnly],[mY,o.EncoderOnly],[nY,o.EncoderOnly],[VY,o.EncoderOnly],[s2,o.EncoderOnly],[pY,o.EncoderOnly],[uY,o.EncoderOnly],[RY,o.EncoderOnly],[mV,o.EncoderOnly],[WY,o.EncoderOnly],[Ot,o.EncoderOnly],[NY,o.MaskGeneration],[nV,o.EncoderOnly],[sY,o.EncoderOnly],[ae,o.Seq2Seq],[Lt,o.EncoderOnly],[YY,o.EncoderOnly],[hY,o.EncoderOnly],[oY,o.EncoderOnly]];for(let[P,_]of FY)for(let[CI,_I]of P.values())y.set(CI,_),E.set(_I,CI),H.set(CI,_I);let NV=[["MusicgenForConditionalGeneration",na,o.Musicgen],["Phi3VForCausalLM",rb,o.Phi3V],["CLIPTextModelWithProjection",Rm,o.EncoderOnly],["SiglipTextModel",Xm,o.EncoderOnly],["JinaCLIPTextModel",NW,o.EncoderOnly],["ClapTextModelWithProjection",As,o.EncoderOnly],["ClapAudioModelWithProjection",Ls,o.EncoderOnly]];for(let[P,_,CI]of NV)y.set(P,CI),E.set(_,P),H.set(P,_);class sV extends jG{static MODEL_CLASS_MAPPINGS=FY.map(_=>_[0]);static BASE_IF_FAIL=!0}class Y2 extends jG{static MODEL_CLASS_MAPPINGS=[kt]}class YV extends jG{static MODEL_CLASS_MAPPINGS=[xt]}class hV extends jG{static MODEL_CLASS_MAPPINGS=[ma]}class VV extends jG{static MODEL_CLASS_MAPPINGS=[ZY]}class XY extends jG{static MODEL_CLASS_MAPPINGS=[ae]}class pV extends jG{static MODEL_CLASS_MAPPINGS=[Lt]}class uV extends jG{static MODEL_CLASS_MAPPINGS=[zt]}class RV extends jG{static MODEL_CLASS_MAPPINGS=[Ut]}class oV extends jG{static MODEL_CLASS_MAPPINGS=[Mt]}class FV extends jG{static MODEL_CLASS_MAPPINGS=[Bt]}class XV extends jG{static MODEL_CLASS_MAPPINGS=[aY]}class iV extends jG{static MODEL_CLASS_MAPPINGS=[tY]}class QV extends jG{static MODEL_CLASS_MAPPINGS=[nY]}class iY extends jG{static MODEL_CLASS_MAPPINGS=[mY]}class HV extends jG{static MODEL_CLASS_MAPPINGS=[WY]}class rV extends jG{static MODEL_CLASS_MAPPINGS=[Ot]}class wV extends jG{static MODEL_CLASS_MAPPINGS=[NY]}class vV extends jG{static MODEL_CLASS_MAPPINGS=[nV]}class EV extends jG{static MODEL_CLASS_MAPPINGS=[sY]}class yV extends jG{static MODEL_CLASS_MAPPINGS=[YY]}class gV extends jG{static MODEL_CLASS_MAPPINGS=[hY]}class h2 extends jG{static MODEL_CLASS_MAPPINGS=[eY]}class JV extends jG{static MODEL_CLASS_MAPPINGS=[VY]}class CV extends jG{static MODEL_CLASS_MAPPINGS=[pY]}class AV extends jG{static MODEL_CLASS_MAPPINGS=[uY]}class V2 extends jG{static MODEL_CLASS_MAPPINGS=[RY]}class LV extends jG{static MODEL_CLASS_MAPPINGS=[mV]}class kV extends jG{static MODEL_CLASS_MAPPINGS=[oY]}class xV extends bI{constructor({logits:_,past_key_values:CI,encoder_outputs:_I,decoder_attentions:Gl=null,cross_attentions:Zl=null}){super(),this.logits=_,this.past_key_values=CI,this.encoder_outputs=_I,this.decoder_attentions=Gl,this.cross_attentions=Zl}}class WG extends bI{constructor({logits:_,...CI}){super(),this.logits=_;let _I=Object.values(CI);_I.length>0&&(this.attentions=_I)}}class QY extends bI{constructor({logits:_,embeddings:CI}){super(),this.logits=_,this.embeddings=CI}}class hc extends bI{constructor({logits:_}){super(),this.logits=_}}class Bc extends bI{constructor({logits:_}){super(),this.logits=_}}class fc extends bI{constructor({start_logits:_,end_logits:CI}){super(),this.start_logits=_,this.end_logits=CI}}class bZ extends bI{constructor({logits:_}){super(),this.logits=_}}class zV extends bI{constructor({logits:_,past_key_values:CI}){super(),this.logits=_,this.past_key_values=CI}}class HY extends bI{constructor({alphas:_}){super(),this.alphas=_}}class rY extends bI{constructor({waveform:_,spectrogram:CI}){super(),this.waveform=_,this.spectrogram=CI}}},"./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js":(I,G,l)=>{l.r(G),l.d(G,{ASTFeatureExtractor:()=>t});var b=l("./src/base/feature_extraction_utils.js"),d=l("./src/utils/tensor.js"),e=l("./src/utils/audio.js");class t extends b.FeatureExtractor{constructor(n){super(n);let s=this.config.sampling_rate,N=(0,e.mel_filter_bank)(256,this.config.num_mel_bins,20,Math.floor(s/2),s,null,"kaldi",!0);for(let m=0;m<N.length;++m)N[m].push(0);this.mel_filters=N,this.window=(0,e.window_function)(400,"hann",{periodic:!1}),this.mean=this.config.mean,this.std=this.config.std}async _extract_fbank_features(n,s){return(0,e.spectrogram)(n,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:s,transpose:!0})}async _call(n){(0,b.validate_audio_inputs)(n,"ASTFeatureExtractor");let s=await this._extract_fbank_features(n,this.config.max_length);if(this.config.do_normalize){let N=this.std*2,m=s.data;for(let h=0;h<m.length;++h)m[h]=(m[h]-this.mean)/N}return{input_values:s.unsqueeze_(0)}}}},"./src/models/auto/feature_extraction_auto.js":(I,G,l)=>{l.r(G),l.d(G,{AutoFeatureExtractor:()=>W});var b=l("./src/utils/constants.js"),d=l("./src/utils/hub.js"),e=l("./src/base/feature_extraction_utils.js"),t=l("./src/models/feature_extractors.js");class W{static async from_pretrained(s,N={}){let m=await(0,d.getModelJSON)(s,b.FEATURE_EXTRACTOR_NAME,!0,N),h=m.feature_extractor_type,V=t[h];if(!V)throw new Error(`Unknown feature_extractor_type: '${h}'. Please report this at ${b.GITHUB_ISSUE_URL}.`);return new V(m)}}},"./src/models/auto/image_processing_auto.js":(I,G,l)=>{l.r(G),l.d(G,{AutoImageProcessor:()=>W});var b=l("./src/utils/constants.js"),d=l("./src/utils/hub.js"),e=l("./src/base/image_processors_utils.js"),t=l("./src/models/image_processors.js");class W{static async from_pretrained(s,N={}){let m=await(0,d.getModelJSON)(s,b.IMAGE_PROCESSOR_NAME,!0,N),h=m.image_processor_type??m.feature_extractor_type,V=t[h];return V||(h!==void 0&&console.warn(`Image processor type '${h}' not found, assuming base ImageProcessor. Please report this at ${b.GITHUB_ISSUE_URL}.`),V=e.ImageProcessor),new V(m)}}},"./src/models/auto/processing_auto.js":(I,G,l)=>{l.r(G),l.d(G,{AutoProcessor:()=>s});var b=l("./src/utils/constants.js"),d=l("./src/utils/hub.js"),e=l("./src/base/processing_utils.js"),t=l("./src/models/processors.js"),W=l("./src/models/image_processors.js"),n=l("./src/models/feature_extractors.js");class s{static async from_pretrained(m,h={}){let V=await(0,d.getModelJSON)(m,b.IMAGE_PROCESSOR_NAME,!0,h),{image_processor_type:X,feature_extractor_type:p,processor_class:F}=V;if(F&&t[F])return t[F].from_pretrained(m,h);if(!X&&!p)throw new Error("No `image_processor_type` or `feature_extractor_type` found in the config.");let a={};if(X){let Q=W[X];if(!Q)throw new Error(`Unknown image_processor_type: '${X}'.`);a.image_processor=new Q(V)}if(p){let Q=W[p];if(Q)a.image_processor=new Q(V);else{let o=n[p];if(!o)throw new Error(`Unknown feature_extractor_type: '${p}'.`);a.feature_extractor=new o(V)}}let u={};return new e.Processor(u,a)}}},"./src/models/beit/image_processing_beit.js":(I,G,l)=>{l.r(G),l.d(G,{BeitFeatureExtractor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{}},"./src/models/bit/image_processing_bit.js":(I,G,l)=>{l.r(G),l.d(G,{BitImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{}},"./src/models/chinese_clip/image_processing_chinese_clip.js":(I,G,l)=>{l.r(G),l.d(G,{ChineseCLIPFeatureExtractor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{}},"./src/models/clap/feature_extraction_clap.js":(I,G,l)=>{l.r(G),l.d(G,{ClapFeatureExtractor:()=>t});var b=l("./src/base/feature_extraction_utils.js"),d=l("./src/utils/tensor.js"),e=l("./src/utils/audio.js");class t extends b.FeatureExtractor{constructor(n){super(n),this.mel_filters=(0,e.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=(0,e.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=(0,e.window_function)(this.config.fft_window_size,"hann")}async _get_input_mel(n,s,N,m){let h,V=!1,X=n.length-s;if(X>0)if(N==="rand_trunc"){V=!0;let p=Math.floor(Math.random()*(X+1));n=n.subarray(p,p+s),h=await this._extract_fbank_features(n,this.mel_filters_slaney,this.config.nb_max_samples)}else throw new Error(`Truncation strategy "${N}" not implemented`);else{if(X<0){let p=new Float64Array(s);if(p.set(n),m==="repeat")for(let F=n.length;F<s;F+=n.length)p.set(n.subarray(0,Math.min(n.length,s-F)),F);else if(m==="repeatpad")for(let F=n.length;F<-X;F+=n.length)p.set(n,F);n=p}if(N==="fusion")throw new Error(`Truncation strategy "${N}" not implemented`);h=await this._extract_fbank_features(n,this.mel_filters_slaney,this.config.nb_max_samples)}return h.unsqueeze_(0)}async _extract_fbank_features(n,s,N=null){return(0,e.spectrogram)(n,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:s,log_mel:"dB",max_num_frames:N,do_pad:!1,transpose:!0})}async _call(n,{max_length:s=null}={}){return(0,b.validate_audio_inputs)(n,"ClapFeatureExtractor"),{input_features:(await this._get_input_mel(n,s??this.config.nb_max_samples,this.config.truncation,this.config.padding)).unsqueeze_(0)}}}},"./src/models/clip/image_processing_clip.js":(I,G,l)=>{l.r(G),l.d(G,{CLIPFeatureExtractor:()=>e,CLIPImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{}class e extends d{}},"./src/models/convnext/image_processing_convnext.js":(I,G,l)=>{l.r(G),l.d(G,{ConvNextFeatureExtractor:()=>e,ConvNextImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{constructor(W){super(W),this.crop_pct=this.config.crop_pct??.875}async resize(W){let n=this.size?.shortest_edge;if(n===void 0)throw new Error("Size dictionary must contain 'shortest_edge' key.");if(n<384){let s=Math.floor(n/this.crop_pct),[N,m]=this.get_resize_output_image_size(W,{shortest_edge:s});W=await W.resize(N,m,{resample:this.resample}),W=await W.center_crop(n,n)}else W=await W.resize(n,n,{resample:this.resample});return W}}class e extends d{}},"./src/models/deit/image_processing_deit.js":(I,G,l)=>{l.r(G),l.d(G,{DeiTFeatureExtractor:()=>e,DeiTImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{}class e extends d{}},"./src/models/detr/image_processing_detr.js":(I,G,l)=>{l.r(G),l.d(G,{DetrFeatureExtractor:()=>t,DetrImageProcessor:()=>e});var b=l("./src/base/image_processors_utils.js"),d=l("./src/utils/tensor.js");class e extends b.ImageProcessor{async _call(n){let s=await super._call(n),N=[s.pixel_values.dims[0],64,64],m=(0,d.full)(N,1n);return{...s,pixel_mask:m}}post_process_object_detection(...n){return(0,b.post_process_object_detection)(...n)}post_process_panoptic_segmentation(...n){return(0,b.post_process_panoptic_segmentation)(...n)}post_process_instance_segmentation(...n){return(0,b.post_process_instance_segmentation)(...n)}}class t extends e{}},"./src/models/donut/image_processing_donut.js":(I,G,l)=>{l.r(G),l.d(G,{DonutFeatureExtractor:()=>e,DonutImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{pad_image(W,n,s,N={}){let[m,h,V]=n,X=this.image_mean;Array.isArray(this.image_mean)||(X=new Array(V).fill(X));let p=this.image_std;Array.isArray(p)||(p=new Array(V).fill(X));let F=X.map((a,u)=>-a/p[u]);return super.pad_image(W,n,s,{center:!0,constant_values:F,...N})}}class e extends d{}},"./src/models/dpt/image_processing_dpt.js":(I,G,l)=>{l.r(G),l.d(G,{DPTFeatureExtractor:()=>e,DPTImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{}class e extends d{}},"./src/models/efficientnet/image_processing_efficientnet.js":(I,G,l)=>{l.r(G),l.d(G,{EfficientNetImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{constructor(t){super(t),this.include_top=this.config.include_top??!0,this.include_top&&(this.image_std=this.image_std.map(W=>W*W))}}},"./src/models/feature_extractors.js":(I,G,l)=>{l.r(G),l.d(G,{ASTFeatureExtractor:()=>b.ASTFeatureExtractor,ClapFeatureExtractor:()=>d.ClapFeatureExtractor,ImageFeatureExtractor:()=>h.ImageProcessor,MoonshineFeatureExtractor:()=>e.MoonshineFeatureExtractor,PyAnnoteFeatureExtractor:()=>t.PyAnnoteFeatureExtractor,SeamlessM4TFeatureExtractor:()=>W.SeamlessM4TFeatureExtractor,SpeechT5FeatureExtractor:()=>n.SpeechT5FeatureExtractor,Wav2Vec2FeatureExtractor:()=>s.Wav2Vec2FeatureExtractor,WeSpeakerFeatureExtractor:()=>N.WeSpeakerFeatureExtractor,WhisperFeatureExtractor:()=>m.WhisperFeatureExtractor});var b=l("./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js"),d=l("./src/models/clap/feature_extraction_clap.js"),e=l("./src/models/moonshine/feature_extraction_moonshine.js"),t=l("./src/models/pyannote/feature_extraction_pyannote.js"),W=l("./src/models/seamless_m4t/feature_extraction_seamless_m4t.js"),n=l("./src/models/speecht5/feature_extraction_speecht5.js"),s=l("./src/models/wav2vec2/feature_extraction_wav2vec2.js"),N=l("./src/models/wespeaker/feature_extraction_wespeaker.js"),m=l("./src/models/whisper/feature_extraction_whisper.js"),h=l("./src/base/image_processors_utils.js")},"./src/models/florence2/processing_florence2.js":(I,G,l)=>{l.r(G),l.d(G,{Florence2Processor:()=>t});var b=l("./src/base/processing_utils.js"),d=l("./src/models/auto/image_processing_auto.js"),e=l("./src/tokenizers.js");class t extends b.Processor{static tokenizer_class=e.AutoTokenizer;static image_processor_class=d.AutoImageProcessor;constructor(n,s){super(n,s);let{tasks_answer_post_processing_type:N,task_prompts_without_inputs:m,task_prompts_with_input:h}=this.image_processor.config;this.tasks_answer_post_processing_type=new Map(Object.entries(N??{})),this.task_prompts_without_inputs=new Map(Object.entries(m??{})),this.task_prompts_with_input=new Map(Object.entries(h??{})),this.regexes={quad_boxes:/(.+?)<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm,bboxes:/([^<]+)?<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm},this.size_per_bin=1e3}construct_prompts(n){typeof n=="string"&&(n=[n]);let s=[];for(let N of n)if(this.task_prompts_without_inputs.has(N))s.push(this.task_prompts_without_inputs.get(N));else{for(let[m,h]of this.task_prompts_with_input)if(N.includes(m)){s.push(h.replaceAll("{input}",N).replaceAll(m,""));break}s.length!==n.length&&s.push(N)}return s}post_process_generation(n,s,N){let m=this.tasks_answer_post_processing_type.get(s)??"pure_text";n=n.replaceAll("<s>","").replaceAll("</s>","");let h;switch(m){case"pure_text":h=n;break;case"description_with_bboxes":case"bboxes":case"phrase_grounding":case"ocr":let V=m==="ocr"?"quad_boxes":"bboxes",X=n.matchAll(this.regexes[V]),p=[],F=[];for(let[a,u,...Q]of X)p.push(u?u.trim():p.at(-1)??""),F.push(Q.map((o,y)=>(Number(o)+.5)/this.size_per_bin*N[y%2]));h={labels:p,[V]:F};break;default:throw new Error(`Task "${s}" (of type "${m}") not yet implemented.`)}return{[s]:h}}async _call(n,s=null,N={}){if(!n&&!s)throw new Error("Either text or images must be provided");let m=await this.image_processor(n,N),h=s?this.tokenizer(s,N):{};return{...m,...h}}}},"./src/models/glpn/image_processing_glpn.js":(I,G,l)=>{l.r(G),l.d(G,{GLPNFeatureExtractor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{}},"./src/models/grounding_dino/image_processing_grounding_dino.js":(I,G,l)=>{l.r(G),l.d(G,{GroundingDinoImageProcessor:()=>e});var b=l("./src/base/image_processors_utils.js"),d=l("./src/utils/tensor.js");class e extends b.ImageProcessor{async _call(W){let n=await super._call(W),s=n.pixel_values.dims,N=(0,d.ones)([s[0],s[2],s[3]]);return{...n,pixel_mask:N}}}},"./src/models/grounding_dino/processing_grounding_dino.js":(I,G,l)=>{l.r(G),l.d(G,{GroundingDinoProcessor:()=>n});var b=l("./src/base/processing_utils.js"),d=l("./src/models/auto/image_processing_auto.js"),e=l("./src/tokenizers.js"),t=l("./src/base/image_processors_utils.js");function W(s,N){let h=s.dims.at(-1)-1,V=s.tolist();V.fill(!1,0,1),V.fill(!1,h);let X=N.tolist();return V.map((p,F)=>p?F:null).filter(p=>p!==null).map(p=>X[p])}class n extends b.Processor{static tokenizer_class=e.AutoTokenizer;static image_processor_class=d.AutoImageProcessor;async _call(N,m,h={}){let V=N?await this.image_processor(N,h):{};return{...m?this.tokenizer(m,h):{},...V}}post_process_grounded_object_detection(N,m,{box_threshold:h=.25,text_threshold:V=.25,target_sizes:X=null}={}){let{logits:p,pred_boxes:F}=N,a=p.dims[0];if(X!==null&&X.length!==a)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let u=p.dims.at(1),Q=p.sigmoid(),o=Q.max(-1).tolist(),y=F.tolist().map(E=>E.map(C=>(0,t.center_to_corners_format)(C))),H=[];for(let E=0;E<a;++E){let C=X!==null?X[E]:null;C!==null&&(y[E]=y[E].map(WI=>WI.map((VI,sI)=>VI*C[(sI+1)%2])));let T=o[E],S=[],cI=[],hI=[];for(let WI=0;WI<u;++WI){let VI=T[WI];if(VI<=h)continue;let sI=y[E][WI],ZI=Q[E][WI];S.push(VI),hI.push(sI);let dI=W(ZI.gt(V),m[E]);cI.push(dI)}H.push({scores:S,boxes:hI,labels:this.batch_decode(cI)})}return H}}},"./src/models/idefics3/image_processing_idefics3.js":(I,G,l)=>{l.r(G),l.d(G,{Idefics3ImageProcessor:()=>e});var b=l("./src/base/image_processors_utils.js"),d=l("./src/utils/tensor.js");class e extends b.ImageProcessor{constructor(W){super(W),this.do_image_splitting=W.do_image_splitting??!0,this.max_image_size=W.max_image_size}get_resize_for_vision_encoder(W,n){let[s,N]=W.dims.slice(-2),m=N/s;return N>=s?(N=Math.ceil(N/n)*n,s=Math.floor(N/m),s=Math.ceil(s/n)*n):(s=Math.ceil(s/n)*n,N=Math.floor(s*m),N=Math.ceil(N/n)*n),{height:s,width:N}}async _call(W,{do_image_splitting:n=null,return_row_col_info:s=!1}={}){let N;if(!Array.isArray(W))N=[[W]];else{if(W.length===0||!W[0])throw new Error("No images provided.");Array.isArray(W[0])?N=W:N=[W]}let m=[],h=[],V=[],X=[],p=[];for(let E of N){let C=await Promise.all(E.map(cI=>this.preprocess(cI)));X.push(...C.map(cI=>cI.original_size)),p.push(...C.map(cI=>cI.reshaped_input_size)),C.forEach(cI=>cI.pixel_values.unsqueeze_(0));let{longest_edge:T}=this.max_image_size,S;if(n??this.do_image_splitting){let cI=new Array(C.length),hI=new Array(C.length);S=await Promise.all(C.map(async(WI,VI)=>{let sI=this.get_resize_for_vision_encoder(WI.pixel_values,T),ZI=await(0,d.interpolate_4d)(WI.pixel_values,{size:[sI.height,sI.width]}),{frames:dI,num_splits_h:pI,num_splits_w:yI}=await this.split_image(ZI,this.max_image_size);return cI[VI]=pI,hI[VI]=yI,(0,d.cat)(dI,0)})),h.push(cI),V.push(hI)}else{let cI=[T,T];S=await Promise.all(C.map(hI=>(0,d.interpolate_4d)(hI.pixel_values,{size:cI}))),h.push(new Array(C.length).fill(0)),V.push(new Array(C.length).fill(0))}m.push((0,d.cat)(S,0))}let F=m.length,[a,u,Q,o]=m[0].dims,y,H;if(F===1)y=m[0].unsqueeze_(0),H=(0,d.full)([F,a,Q,o],!0);else{let E=Math.max(...m.map(S=>S.dims.at(0)));H=(0,d.full)([F,E,Q,o],!0);let C=H.data,T=E*Q*o;for(let S=0;S<F;++S){let cI=m[S].dims[0];if(cI<E){m[S]=(0,d.cat)([m[S],(0,d.full)([E-cI,u,Q,o],0)],0);let hI=S*T+cI*Q*o,WI=(S+1)*T;C.fill(!1,hI,WI)}}y=(0,d.stack)(m,0)}return{pixel_values:y,pixel_attention_mask:H,original_sizes:X,reshaped_input_sizes:p,...s?{rows:h,cols:V}:{}}}async split_image(W,{longest_edge:n}){let s=n,N=n,m=[],[h,V]=W.dims.slice(-2),X=0,p=0;if(h>s||V>N){X=Math.ceil(h/s),p=Math.ceil(V/N);let F=Math.ceil(h/X),a=Math.ceil(V/p);for(let o=0;o<X;++o)for(let y=0;y<p;++y){let H,E,C,T;o===X-1?(E=h-F,T=h):(E=o*F,T=(o+1)*F),y===p-1?(H=V-a,C=V):(H=y*a,C=(y+1)*a);let S=[E,H],cI=[T,C],hI=await(0,d.slice)(W,S,cI,[2,3]);m.push(hI)}let u=s,Q=N;(h!==u||V!==Q)&&(W=await(0,d.interpolate_4d)(W,{size:[u,Q]}))}return m.push(W),{frames:m,num_splits_h:X,num_splits_w:p}}}},"./src/models/idefics3/processing_idefics3.js":(I,G,l)=>{l.r(G),l.d(G,{Idefics3Processor:()=>m});var b=l("./src/base/processing_utils.js"),d=l("./src/models/auto/image_processing_auto.js"),e=l("./src/tokenizers.js"),t=l("./src/utils/image.js"),W=l("./src/utils/core.js");function n(h,V,X,p,F,a){let u="";for(let Q=0;Q<V;++Q){for(let o=0;o<X;++o)u+=p+`<row_${Q+1}_col_${o+1}>`+F.repeat(h);u+=`
`}return u+=`
${p}${a}`+F.repeat(h)+`${p}`,u}function s(h,V,X,p){return`${V}${p}`+X.repeat(h)+`${V}`}function N(h,V,X,p,F,a){return h===0&&V===0?s(X,p,F,a):n(X,h,V,p,F,a)}class m extends b.Processor{static image_processor_class=d.AutoImageProcessor;static tokenizer_class=e.AutoTokenizer;static uses_processor_config=!0;fake_image_token="<fake_token_around_image>";image_token="<image>";global_img_token="<global-img>";async _call(V,X=null,p={}){p.return_row_col_info??=!0;let F;X&&(F=await this.image_processor(X,p)),Array.isArray(V)||(V=[V]);let a=F.rows??[new Array(V.length).fill(0)],u=F.cols??[new Array(V.length).fill(0)],Q=this.config.image_seq_len,o=[],y=[];for(let E=0;E<V.length;++E){let C=V[E],T=a[E],S=u[E];o.push((0,W.count)(C,this.image_token));let cI=T.map((VI,sI)=>N(VI,S[sI],Q,this.fake_image_token,this.image_token,this.global_img_token)),hI=C.split(this.image_token);if(hI.length===0)throw new Error("The image token should be present in the text.");let WI=hI[0];for(let VI=0;VI<cI.length;++VI)WI+=cI[VI]+hI[VI+1];y.push(WI)}return{...this.tokenizer(y),...F}}}},"./src/models/image_processors.js":(I,G,l)=>{l.r(G),l.d(G,{BeitFeatureExtractor:()=>b.BeitFeatureExtractor,BitImageProcessor:()=>d.BitImageProcessor,CLIPFeatureExtractor:()=>t.CLIPFeatureExtractor,CLIPImageProcessor:()=>t.CLIPImageProcessor,ChineseCLIPFeatureExtractor:()=>e.ChineseCLIPFeatureExtractor,ConvNextFeatureExtractor:()=>W.ConvNextFeatureExtractor,ConvNextImageProcessor:()=>W.ConvNextImageProcessor,DPTFeatureExtractor:()=>m.DPTFeatureExtractor,DPTImageProcessor:()=>m.DPTImageProcessor,DeiTFeatureExtractor:()=>n.DeiTFeatureExtractor,DeiTImageProcessor:()=>n.DeiTImageProcessor,DetrFeatureExtractor:()=>s.DetrFeatureExtractor,DetrImageProcessor:()=>s.DetrImageProcessor,DonutFeatureExtractor:()=>N.DonutFeatureExtractor,DonutImageProcessor:()=>N.DonutImageProcessor,EfficientNetImageProcessor:()=>h.EfficientNetImageProcessor,GLPNFeatureExtractor:()=>V.GLPNFeatureExtractor,GroundingDinoImageProcessor:()=>X.GroundingDinoImageProcessor,Idefics3ImageProcessor:()=>p.Idefics3ImageProcessor,JinaCLIPImageProcessor:()=>a.JinaCLIPImageProcessor,LlavaOnevisionImageProcessor:()=>u.LlavaOnevisionImageProcessor,Mask2FormerImageProcessor:()=>Q.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>o.MaskFormerFeatureExtractor,MaskFormerImageProcessor:()=>o.MaskFormerImageProcessor,MobileNetV1FeatureExtractor:()=>y.MobileNetV1FeatureExtractor,MobileNetV1ImageProcessor:()=>y.MobileNetV1ImageProcessor,MobileNetV2FeatureExtractor:()=>H.MobileNetV2FeatureExtractor,MobileNetV2ImageProcessor:()=>H.MobileNetV2ImageProcessor,MobileNetV3FeatureExtractor:()=>E.MobileNetV3FeatureExtractor,MobileNetV3ImageProcessor:()=>E.MobileNetV3ImageProcessor,MobileNetV4FeatureExtractor:()=>C.MobileNetV4FeatureExtractor,MobileNetV4ImageProcessor:()=>C.MobileNetV4ImageProcessor,MobileViTFeatureExtractor:()=>T.MobileViTFeatureExtractor,MobileViTImageProcessor:()=>T.MobileViTImageProcessor,NougatImageProcessor:()=>S.NougatImageProcessor,OwlViTFeatureExtractor:()=>hI.OwlViTFeatureExtractor,OwlViTImageProcessor:()=>hI.OwlViTImageProcessor,Owlv2ImageProcessor:()=>cI.Owlv2ImageProcessor,Phi3VImageProcessor:()=>WI.Phi3VImageProcessor,PvtImageProcessor:()=>VI.PvtImageProcessor,Qwen2VLImageProcessor:()=>sI.Qwen2VLImageProcessor,RTDetrImageProcessor:()=>ZI.RTDetrImageProcessor,SamImageProcessor:()=>dI.SamImageProcessor,SegformerFeatureExtractor:()=>pI.SegformerFeatureExtractor,SegformerImageProcessor:()=>pI.SegformerImageProcessor,SiglipImageProcessor:()=>yI.SiglipImageProcessor,Swin2SRImageProcessor:()=>eI.Swin2SRImageProcessor,VLMImageProcessor:()=>F.VLMImageProcessor,ViTFeatureExtractor:()=>HI.ViTFeatureExtractor,ViTImageProcessor:()=>HI.ViTImageProcessor,VitMatteImageProcessor:()=>YI.VitMatteImageProcessor,VitPoseImageProcessor:()=>$.VitPoseImageProcessor,YolosFeatureExtractor:()=>JI.YolosFeatureExtractor,YolosImageProcessor:()=>JI.YolosImageProcessor});var b=l("./src/models/beit/image_processing_beit.js"),d=l("./src/models/bit/image_processing_bit.js"),e=l("./src/models/chinese_clip/image_processing_chinese_clip.js"),t=l("./src/models/clip/image_processing_clip.js"),W=l("./src/models/convnext/image_processing_convnext.js"),n=l("./src/models/deit/image_processing_deit.js"),s=l("./src/models/detr/image_processing_detr.js"),N=l("./src/models/donut/image_processing_donut.js"),m=l("./src/models/dpt/image_processing_dpt.js"),h=l("./src/models/efficientnet/image_processing_efficientnet.js"),V=l("./src/models/glpn/image_processing_glpn.js"),X=l("./src/models/grounding_dino/image_processing_grounding_dino.js"),p=l("./src/models/idefics3/image_processing_idefics3.js"),F=l("./src/models/janus/image_processing_janus.js"),a=l("./src/models/jina_clip/image_processing_jina_clip.js"),u=l("./src/models/llava_onevision/image_processing_llava_onevision.js"),Q=l("./src/models/mask2former/image_processing_mask2former.js"),o=l("./src/models/maskformer/image_processing_maskformer.js"),y=l("./src/models/mobilenet_v1/image_processing_mobilenet_v1.js"),H=l("./src/models/mobilenet_v2/image_processing_mobilenet_v2.js"),E=l("./src/models/mobilenet_v3/image_processing_mobilenet_v3.js"),C=l("./src/models/mobilenet_v4/image_processing_mobilenet_v4.js"),T=l("./src/models/mobilevit/image_processing_mobilevit.js"),S=l("./src/models/nougat/image_processing_nougat.js"),cI=l("./src/models/owlv2/image_processing_owlv2.js"),hI=l("./src/models/owlvit/image_processing_owlvit.js"),WI=l("./src/models/phi3_v/image_processing_phi3_v.js"),VI=l("./src/models/pvt/image_processing_pvt.js"),sI=l("./src/models/qwen2_vl/image_processing_qwen2_vl.js"),ZI=l("./src/models/rt_detr/image_processing_rt_detr.js"),dI=l("./src/models/sam/image_processing_sam.js"),pI=l("./src/models/segformer/image_processing_segformer.js"),yI=l("./src/models/siglip/image_processing_siglip.js"),eI=l("./src/models/swin2sr/image_processing_swin2sr.js"),HI=l("./src/models/vit/image_processing_vit.js"),YI=l("./src/models/vitmatte/image_processing_vitmatte.js"),$=l("./src/models/vitpose/image_processing_vitpose.js"),JI=l("./src/models/yolos/image_processing_yolos.js")},"./src/models/janus/image_processing_janus.js":(I,G,l)=>{l.r(G),l.d(G,{VLMImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{constructor(t){super({do_pad:!0,pad_size:{width:t.image_size,height:t.image_size},...t}),this.constant_values=this.config.background_color.map(W=>W*this.rescale_factor)}pad_image(t,W,n,s){return super.pad_image(t,W,n,{constant_values:this.constant_values,center:!0,...s})}}},"./src/models/janus/processing_janus.js":(I,G,l)=>{l.r(G),l.d(G,{VLChatProcessor:()=>s});var b=l("./src/base/processing_utils.js"),d=l("./src/models/auto/image_processing_auto.js"),e=l("./src/tokenizers.js"),t=l("./src/utils/core.js"),W=l("./src/utils/tensor.js"),n=l("./src/utils/image.js");class s extends b.Processor{static image_processor_class=d.AutoImageProcessor;static tokenizer_class=e.AutoTokenizer;static uses_processor_config=!0;constructor(m,h){super(m,h),this.image_tag=this.config.image_tag,this.image_start_tag=this.config.image_start_tag,this.image_end_tag=this.config.image_end_tag,this.num_image_tokens=this.config.num_image_tokens}async _call(m,{images:h=null,chat_template:V="default"}={}){h?Array.isArray(h)||(h=[h]):h=await Promise.all(m.filter(S=>S.images).flatMap(S=>S.images).map(S=>n.RawImage.read(S)));let X=this.tokenizer,p=X.apply_chat_template(m,{tokenize:!1,add_generation_prompt:!0,chat_template:V}),F=S=>X.encode(S,{add_special_tokens:!1}),a=p.split(this.image_tag),u=a.length-1;if(h.length!==u)throw new Error(`Number of images provided (${h.length}) does not match number of "${this.image_tag}" image tags (${u})`);let[Q,o,y]=X.model.convert_tokens_to_ids([this.image_tag,this.image_start_tag,this.image_end_tag]),H=F(a[0]),E=new Array(H.length).fill(!1);for(let S=1;S<a.length;++S){let cI=new Array(this.num_image_tokens).fill(Q),hI=F(a[S]);H=(0,t.mergeArrays)(H,[o],cI,[y],hI);let WI=new Array(this.num_image_tokens).fill(!0);E=(0,t.mergeArrays)(E,[!1],WI,[!1],new Array(hI.length).fill(!1))}let C=[1,H.length],T={input_ids:new W.Tensor("int64",H,C),attention_mask:new W.Tensor("int64",new Array(H.length).fill(1),C),images_seq_mask:new W.Tensor("bool",E,C),images_emb_mask:new W.Tensor("bool",new Array(u*this.num_image_tokens).fill(!0),[1,u,this.num_image_tokens])};if(h&&h.length>0){let S=await this.image_processor(h);return S.pixel_values.unsqueeze_(0),{...T,...S}}return T}}},"./src/models/jina_clip/image_processing_jina_clip.js":(I,G,l)=>{l.r(G),l.d(G,{JinaCLIPImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{constructor(t){let{resize_mode:W,fill_color:n,interpolation:s,size:N,...m}=t,h=W==="squash"?{width:N,height:N}:W==="shortest"?{shortest_edge:N}:{longest_edge:N},V=s==="bicubic"?3:2;super({...m,size:h,resample:V,do_center_crop:!0,crop_size:N,do_normalize:!0})}}},"./src/models/jina_clip/processing_jina_clip.js":(I,G,l)=>{l.r(G),l.d(G,{JinaCLIPProcessor:()=>t});var b=l("./src/base/processing_utils.js"),d=l("./src/models/auto/image_processing_auto.js"),e=l("./src/tokenizers.js");class t extends b.Processor{static tokenizer_class=e.AutoTokenizer;static image_processor_class=d.AutoImageProcessor;async _call(n=null,s=null,N={}){if(!n&&!s)throw new Error("Either text or images must be provided");let m=n?this.tokenizer(n,N):{},h=s?await this.image_processor(s,N):{};return{...m,...h}}}},"./src/models/llava_onevision/image_processing_llava_onevision.js":(I,G,l)=>{l.r(G),l.d(G,{LlavaOnevisionImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{}},"./src/models/mask2former/image_processing_mask2former.js":(I,G,l)=>{l.r(G),l.d(G,{Mask2FormerImageProcessor:()=>d});var b=l("./src/models/maskformer/image_processing_maskformer.js");class d extends b.MaskFormerImageProcessor{}},"./src/models/maskformer/image_processing_maskformer.js":(I,G,l)=>{l.r(G),l.d(G,{MaskFormerFeatureExtractor:()=>e,MaskFormerImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{post_process_panoptic_segmentation(...W){return(0,b.post_process_panoptic_segmentation)(...W)}post_process_instance_segmentation(...W){return(0,b.post_process_instance_segmentation)(...W)}}class e extends d{}},"./src/models/mgp_str/processing_mgp_str.js":(I,G,l)=>{l.r(G),l.d(G,{MgpstrProcessor:()=>n});var b=l("./src/base/processing_utils.js"),d=l("./src/models/auto/image_processing_auto.js"),e=l("./src/tokenizers.js"),t=l("./src/utils/maths.js");let W={char:["char_decode",1],bpe:["bpe_decode",2],wp:["wp_decode",102]};class n extends b.Processor{static tokenizer_class=e.AutoTokenizer;static image_processor_class=d.AutoImageProcessor;get char_tokenizer(){return this.components.char_tokenizer}get bpe_tokenizer(){return this.components.bpe_tokenizer}get wp_tokenizer(){return this.components.wp_tokenizer}_decode_helper(N,m){if(!W.hasOwnProperty(m))throw new Error(`Format ${m} is not supported.`);let[h,V]=W[m],X=this[h].bind(this),[p,F]=N.dims,a=[],u=[],Q=N.tolist();for(let y=0;y<p;++y){let H=Q[y],E=[],C=[];for(let S=1;S<F;++S){let[cI,hI]=(0,t.max)((0,t.softmax)(H[S]));if(C.push(cI),hI==V)break;E.push(hI)}let T=C.length>0?C.reduce((S,cI)=>S*cI,1):0;u.push(E),a.push(T)}return[X(u),a]}char_decode(N){return this.char_tokenizer.batch_decode(N).map(m=>m.replaceAll(" ",""))}bpe_decode(N){return this.bpe_tokenizer.batch_decode(N)}wp_decode(N){return this.wp_tokenizer.batch_decode(N).map(m=>m.replaceAll(" ",""))}batch_decode([N,m,h]){let[V,X]=this._decode_helper(N,"char"),[p,F]=this._decode_helper(m,"bpe"),[a,u]=this._decode_helper(h,"wp"),Q=[],o=[];for(let y=0;y<V.length;++y){let[H,E]=(0,t.max)([X[y],F[y],u[y]]);Q.push([V[y],p[y],a[y]][E]),o.push(H)}return{generated_text:Q,scores:o,char_preds:V,bpe_preds:p,wp_preds:a}}static async from_pretrained(...N){let m=await super.from_pretrained(...N),h=await e.AutoTokenizer.from_pretrained("Xenova/gpt2"),V=await e.AutoTokenizer.from_pretrained("Xenova/bert-base-uncased");return m.components={image_processor:m.image_processor,char_tokenizer:m.tokenizer,bpe_tokenizer:h,wp_tokenizer:V},m}async _call(N,m=null){let h=await this.image_processor(N);return m&&(h.labels=this.tokenizer(m).input_ids),h}}},"./src/models/mobilenet_v1/image_processing_mobilenet_v1.js":(I,G,l)=>{l.r(G),l.d(G,{MobileNetV1FeatureExtractor:()=>e,MobileNetV1ImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{}class e extends d{}},"./src/models/mobilenet_v2/image_processing_mobilenet_v2.js":(I,G,l)=>{l.r(G),l.d(G,{MobileNetV2FeatureExtractor:()=>e,MobileNetV2ImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{}class e extends d{}},"./src/models/mobilenet_v3/image_processing_mobilenet_v3.js":(I,G,l)=>{l.r(G),l.d(G,{MobileNetV3FeatureExtractor:()=>e,MobileNetV3ImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{}class e extends d{}},"./src/models/mobilenet_v4/image_processing_mobilenet_v4.js":(I,G,l)=>{l.r(G),l.d(G,{MobileNetV4FeatureExtractor:()=>e,MobileNetV4ImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{}class e extends d{}},"./src/models/mobilevit/image_processing_mobilevit.js":(I,G,l)=>{l.r(G),l.d(G,{MobileViTFeatureExtractor:()=>e,MobileViTImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{}class e extends d{}},"./src/models/moonshine/feature_extraction_moonshine.js":(I,G,l)=>{l.r(G),l.d(G,{MoonshineFeatureExtractor:()=>e});var b=l("./src/base/feature_extraction_utils.js"),d=l("./src/utils/tensor.js");class e extends b.FeatureExtractor{async _call(W){(0,b.validate_audio_inputs)(W,"MoonshineFeatureExtractor"),W instanceof Float64Array&&(W=new Float32Array(W));let n=[1,W.length];return{input_values:new d.Tensor("float32",W,n)}}}},"./src/models/moonshine/processing_moonshine.js":(I,G,l)=>{l.r(G),l.d(G,{MoonshineProcessor:()=>t});var b=l("./src/models/auto/feature_extraction_auto.js"),d=l("./src/tokenizers.js"),e=l("./src/base/processing_utils.js");class t extends e.Processor{static tokenizer_class=d.AutoTokenizer;static feature_extractor_class=b.AutoFeatureExtractor;async _call(n){return await this.feature_extractor(n)}}},"./src/models/nougat/image_processing_nougat.js":(I,G,l)=>{l.r(G),l.d(G,{NougatImageProcessor:()=>d});var b=l("./src/models/donut/image_processing_donut.js");class d extends b.DonutImageProcessor{}},"./src/models/owlv2/image_processing_owlv2.js":(I,G,l)=>{l.r(G),l.d(G,{Owlv2ImageProcessor:()=>d});var b=l("./src/models/owlvit/image_processing_owlvit.js");class d extends b.OwlViTImageProcessor{}},"./src/models/owlvit/image_processing_owlvit.js":(I,G,l)=>{l.r(G),l.d(G,{OwlViTFeatureExtractor:()=>e,OwlViTImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{post_process_object_detection(...W){return(0,b.post_process_object_detection)(...W)}}class e extends d{}},"./src/models/owlvit/processing_owlvit.js":(I,G,l)=>{l.r(G),l.d(G,{OwlViTProcessor:()=>t});var b=l("./src/base/processing_utils.js"),d=l("./src/models/auto/image_processing_auto.js"),e=l("./src/tokenizers.js");class t extends b.Processor{static tokenizer_class=e.AutoTokenizer;static image_processor_class=d.AutoImageProcessor}},"./src/models/paligemma/processing_paligemma.js":(I,G,l)=>{l.r(G),l.d(G,{PaliGemmaProcessor:()=>n});var b=l("./src/base/processing_utils.js"),d=l("./src/models/auto/image_processing_auto.js"),e=l("./src/tokenizers.js");let t="<image>";function W(s,N,m,h,V){return`${h.repeat(m*V)}${N}${s}
`}class n extends b.Processor{static tokenizer_class=e.AutoTokenizer;static image_processor_class=d.AutoImageProcessor;static uses_processor_config=!1;async _call(N,m=null,h={}){m||(console.warn("You are using PaliGemma without a text prefix. It will perform as a picture-captioning model."),m=""),Array.isArray(N)||(N=[N]),Array.isArray(m)||(m=[m]);let V=this.tokenizer.bos_token,X=this.image_processor.config.image_seq_length,p;m.some(u=>u.includes(t))?p=m.map(u=>{let Q=u.replaceAll(t,t.repeat(X)),o=Q.lastIndexOf(t),y=o===-1?0:o+t.length;return Q.slice(0,y)+V+Q.slice(y)+`
`}):(console.warn("You are passing both `text` and `images` to `PaliGemmaProcessor`. The processor expects special image tokens in the text, as many tokens as there are images per each text. It is recommended to add `<image>` tokens in the very beginning of your text. For this call, we will infer how many images each text has and add special tokens."),p=m.map(u=>W(u,V,X,t,N.length)));let F=this.tokenizer(p,h);return{...await this.image_processor(N,h),...F}}}},"./src/models/phi3_v/image_processing_phi3_v.js":(I,G,l)=>{l.r(G),l.d(G,{Phi3VImageProcessor:()=>N});var b=l("./src/base/image_processors_utils.js"),d=l("./src/utils/tensor.js");let e=336,t=[2,3],{ceil:W,floor:n,sqrt:s}=Math;class N extends b.ImageProcessor{constructor(h){super({...h,do_normalize:!0,do_pad:!0,pad_size:"custom",do_convert_rgb:!0,do_resize:!0}),this._num_crops=h.num_crops}calc_num_image_tokens_from_image_size(h,V){let{num_img_tokens:X}=this.config;return n((n(V/e)*n(h/e)+1)*X+1+(n(V/e)+1)*s(X))}get_resize_output_image_size(h,V){let X=this._num_crops,[p,F]=h.size,a=p/F,u=1;for(;u*Math.ceil(u/a)<=X;)u+=1;u-=1;let Q=Math.floor(u*336),o=Math.floor(Q/a);return[Q,o]}pad_image(h,V,X,p={}){let[F,a]=V,u=e*W(F/e),Q=e*W(a/e),o=[1,1,1].map((y,H)=>(y-this.image_mean[H])/this.image_std[H]);return super.pad_image(h,V,{width:Q,height:u},{center:!0,constant_values:o,...p})}async _call(h,{num_crops:V=null}={}){if(this._num_crops=V??=this.config.num_crops,V<4||s(V)%1!==0)throw new Error("num_crops must be a square number >= 4");Array.isArray(h)||(h=[h]);let X=h.length,p=await Promise.all(h.map(E=>this.preprocess(E))),F=p.map(E=>E.original_size),a=p.map(E=>E.reshaped_input_size),u=[];for(let{pixel_values:E}of p){E.unsqueeze_(0);let[C,T]=E.dims.slice(-2),S=await(0,d.interpolate_4d)(E,{size:[e,e],mode:"bicubic"});if(V>0){let cI=[],hI=s(V),WI=n(T/hI),VI=n(C/hI);for(let ZI=0;ZI<hI;++ZI)for(let dI=0;dI<hI;++dI){let pI,yI,eI,HI;ZI===hI-1?(yI=C-VI,HI=C):(yI=ZI*VI,HI=(ZI+1)*VI),dI===hI-1?(pI=T-WI,eI=T):(pI=dI*WI,eI=(dI+1)*WI);let YI=[yI,pI],$=[HI,eI],JI=await(0,d.slice)(E,YI,$,t);cI.push(JI)}let sI=await(0,d.interpolate_4d)((0,d.cat)(cI,0),{size:[e,e],mode:"bicubic"});u.push((0,d.cat)([S,sI],0))}else u.push(S)}let Q=(0,d.stack)(u,0),o=a.map(E=>E.map(C=>e*W(C/e))),y=new d.Tensor("int64",o.flat(),[X,2]),H=o.map(([E,C])=>this.calc_num_image_tokens_from_image_size(C,E));return{pixel_values:Q,original_sizes:F,reshaped_input_sizes:a,image_sizes:y,num_img_tokens:H}}}},"./src/models/phi3_v/processing_phi3_v.js":(I,G,l)=>{l.r(G),l.d(G,{Phi3VProcessor:()=>s});var b=l("./src/base/processing_utils.js"),d=l("./src/models/auto/image_processing_auto.js"),e=l("./src/tokenizers.js"),t=l("./src/utils/image.js");let W="<|image|>",n=/<\|image_\d+\|>/g;class s extends b.Processor{static image_processor_class=d.AutoImageProcessor;static tokenizer_class=e.AutoTokenizer;async _call(m,h=null,{padding:V=!0,truncation:X=!0,num_crops:p=null}={}){Array.isArray(m)||(m=[m]);let F,a;if(h){a=await this.image_processor(h,{num_crops:p});let{num_img_tokens:u}=a,Q=m.map((y,H)=>y.split(n).join(W.repeat(u[H])));F=this.tokenizer(Q,{padding:V,truncation:X});let o=this.tokenizer.model.convert_tokens_to_ids([W])[0];F.input_ids.map_(y=>y==o?-y:y)}else F=this.tokenizer(m);return{...F,...a}}}},"./src/models/processors.js":(I,G,l)=>{l.r(G),l.d(G,{Florence2Processor:()=>b.Florence2Processor,GroundingDinoProcessor:()=>d.GroundingDinoProcessor,Idefics3Processor:()=>e.Idefics3Processor,JinaCLIPProcessor:()=>W.JinaCLIPProcessor,MgpstrProcessor:()=>n.MgpstrProcessor,MoonshineProcessor:()=>s.MoonshineProcessor,OwlViTProcessor:()=>N.OwlViTProcessor,PaliGemmaProcessor:()=>h.PaliGemmaProcessor,Phi3VProcessor:()=>m.Phi3VProcessor,PyAnnoteProcessor:()=>V.PyAnnoteProcessor,Qwen2VLProcessor:()=>X.Qwen2VLProcessor,SamProcessor:()=>p.SamProcessor,SpeechT5Processor:()=>F.SpeechT5Processor,VLChatProcessor:()=>t.VLChatProcessor,Wav2Vec2Processor:()=>a.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>u.Wav2Vec2ProcessorWithLM,WhisperProcessor:()=>Q.WhisperProcessor});var b=l("./src/models/florence2/processing_florence2.js"),d=l("./src/models/grounding_dino/processing_grounding_dino.js"),e=l("./src/models/idefics3/processing_idefics3.js"),t=l("./src/models/janus/processing_janus.js"),W=l("./src/models/jina_clip/processing_jina_clip.js"),n=l("./src/models/mgp_str/processing_mgp_str.js"),s=l("./src/models/moonshine/processing_moonshine.js"),N=l("./src/models/owlvit/processing_owlvit.js"),m=l("./src/models/phi3_v/processing_phi3_v.js"),h=l("./src/models/paligemma/processing_paligemma.js"),V=l("./src/models/pyannote/processing_pyannote.js"),X=l("./src/models/qwen2_vl/processing_qwen2_vl.js"),p=l("./src/models/sam/processing_sam.js"),F=l("./src/models/speecht5/processing_speecht5.js"),a=l("./src/models/wav2vec2/processing_wav2vec2.js"),u=l("./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js"),Q=l("./src/models/whisper/processing_whisper.js")},"./src/models/pvt/image_processing_pvt.js":(I,G,l)=>{l.r(G),l.d(G,{PvtImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{}},"./src/models/pyannote/feature_extraction_pyannote.js":(I,G,l)=>{l.r(G),l.d(G,{PyAnnoteFeatureExtractor:()=>t});var b=l("./src/base/feature_extraction_utils.js"),d=l("./src/utils/tensor.js"),e=l("./src/utils/maths.js");class t extends b.FeatureExtractor{async _call(n){(0,b.validate_audio_inputs)(n,"PyAnnoteFeatureExtractor"),n instanceof Float64Array&&(n=new Float32Array(n));let s=[1,1,n.length];return{input_values:new d.Tensor("float32",n,s)}}samples_to_frames(n){return(n-this.config.offset)/this.config.step}post_process_speaker_diarization(n,s){let N=s/this.samples_to_frames(s)/this.config.sampling_rate,m=[];for(let h of n.tolist()){let V=[],X=-1;for(let p=0;p<h.length;++p){let F=(0,e.softmax)(h[p]),[a,u]=(0,e.max)(F),[Q,o]=[p,p+1];u!==X?(X=u,V.push({id:u,start:Q,end:o,score:a})):(V.at(-1).end=o,V.at(-1).score+=a)}m.push(V.map(({id:p,start:F,end:a,score:u})=>({id:p,start:F*N,end:a*N,confidence:u/(a-F)})))}return m}}},"./src/models/pyannote/processing_pyannote.js":(I,G,l)=>{l.r(G),l.d(G,{PyAnnoteProcessor:()=>e});var b=l("./src/base/processing_utils.js"),d=l("./src/models/pyannote/feature_extraction_pyannote.js");class e extends b.Processor{static feature_extractor_class=d.PyAnnoteFeatureExtractor;async _call(W){return await this.feature_extractor(W)}post_process_speaker_diarization(...W){return this.feature_extractor.post_process_speaker_diarization(...W)}get sampling_rate(){return this.feature_extractor.config.sampling_rate}}},"./src/models/qwen2_vl/image_processing_qwen2_vl.js":(I,G,l)=>{l.r(G),l.d(G,{Qwen2VLImageProcessor:()=>e});var b=l("./src/base/image_processors_utils.js"),d=l("./src/utils/tensor.js");class e extends b.ImageProcessor{async _call(W,...n){let{pixel_values:s,original_sizes:N,reshaped_input_sizes:m}=await super._call(W,...n),h=s,{temporal_patch_size:V,merge_size:X,patch_size:p}=this.config;h.dims[0]===1&&(h=(0,d.cat)(Array.from({length:V},()=>h),0));let F=h.dims[0]/V,a=h.dims[1],u=Math.floor(h.dims[2]/p),Q=Math.floor(h.dims[3]/p),o=h.view(F,V,a,Math.floor(u/X),X,p,Math.floor(Q/X),X,p).permute(0,3,6,4,7,2,1,5,8).view(F*u*Q,a*V*p*p),y=new d.Tensor("int64",[F,u,Q],[1,3]);return{pixel_values:o,image_grid_thw:y,original_sizes:N,reshaped_input_sizes:m}}}},"./src/models/qwen2_vl/processing_qwen2_vl.js":(I,G,l)=>{l.r(G),l.d(G,{Qwen2VLProcessor:()=>W});var b=l("./src/base/processing_utils.js"),d=l("./src/models/auto/image_processing_auto.js"),e=l("./src/tokenizers.js"),t=l("./src/utils/image.js");class W extends b.Processor{static image_processor_class=d.AutoImageProcessor;static tokenizer_class=e.AutoTokenizer;async _call(s,N=null,...m){Array.isArray(s)||(s=[s]);let h,V;if(N&&(h=await this.image_processor(N),V=h.image_grid_thw),V){let p=this.image_processor.config.merge_size**2,F=0,a=V.tolist();s=s.map(u=>{for(;u.includes("<|image_pad|>");){let Q=Number(a[F++].reduce((o,y)=>o*y,1n));u=u.replace("<|image_pad|>","<|placeholder|>".repeat(Math.floor(Q/p)))}return u.replaceAll("<|placeholder|>","<|image_pad|>")})}return{...this.tokenizer(s),...h}}}},"./src/models/rt_detr/image_processing_rt_detr.js":(I,G,l)=>{l.r(G),l.d(G,{RTDetrImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{post_process_object_detection(...t){return(0,b.post_process_object_detection)(...t)}}},"./src/models/sam/image_processing_sam.js":(I,G,l)=>{l.r(G),l.d(G,{SamImageProcessor:()=>t});var b=l("./src/base/image_processors_utils.js"),d=l("./src/utils/core.js"),e=l("./src/utils/tensor.js");class t extends b.ImageProcessor{reshape_input_points(n,s,N,m=!1){n=structuredClone(n);let h=(0,d.calculateDimensions)(n);if(h.length===3)m||(h=[1,...h]),n=[n];else if(h.length!==4)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let V=0;V<n.length;++V){let X=s[V],p=N[V],F=[p[0]/X[0],p[1]/X[1]];for(let a=0;a<n[V].length;++a)for(let u=0;u<n[V][a].length;++u)for(let Q=0;Q<n[V][a][u].length;++Q)n[V][a][u][Q]*=F[Q%2]}return new e.Tensor("float32",Float32Array.from(n.flat(1/0)),h)}add_input_labels(n,s){let N=(0,d.calculateDimensions)(n);if(N.length===2)N=[1,...N],n=[n];else if(N.length!==3)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(N.some((m,h)=>m!==s.dims[h]))throw Error(`The first ${N.length} dimensions of 'input_points' and 'input_labels' must be the same.`);return new e.Tensor("int64",n.flat(1/0).map(BigInt),N)}async _call(n,{input_points:s=null,input_labels:N=null,input_boxes:m=null}={}){let h=await super._call(n);if(s&&(h.input_points=this.reshape_input_points(s,h.original_sizes,h.reshaped_input_sizes)),N){if(!h.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");h.input_labels=this.add_input_labels(N,h.input_points)}return m&&(h.input_boxes=this.reshape_input_points(m,h.original_sizes,h.reshaped_input_sizes,!0)),h}async post_process_masks(n,s,N,{mask_threshold:m=0,binarize:h=!0,pad_size:V=null}={}){let X=[];V=V??this.pad_size;let p=[V.height,V.width];for(let F=0;F<s.length;++F){let a=s[F],u=N[F],Q=await(0,e.interpolate_4d)(n[F],{mode:"bilinear",size:p});if(Q=Q.slice(null,null,[0,u[0]],[0,u[1]]),Q=await(0,e.interpolate_4d)(Q,{mode:"bilinear",size:a}),h){let o=Q.data,y=new Uint8Array(o.length);for(let H=0;H<o.length;++H)o[H]>m&&(y[H]=1);Q=new e.Tensor("bool",y,Q.dims)}X.push(Q)}return X}generate_crop_boxes(n,s,{crop_n_layers:N=0,overlap_ratio:m=.3413333333333333,points_per_crop:h=32,crop_n_points_downscale_factor:V=1}={}){}}},"./src/models/sam/processing_sam.js":(I,G,l)=>{l.r(G),l.d(G,{SamProcessor:()=>e});var b=l("./src/base/processing_utils.js"),d=l("./src/models/auto/image_processing_auto.js");class e extends b.Processor{static image_processor_class=d.AutoImageProcessor;async _call(...W){return await this.image_processor(...W)}post_process_masks(...W){return this.image_processor.post_process_masks(...W)}reshape_input_points(...W){return this.image_processor.reshape_input_points(...W)}}},"./src/models/seamless_m4t/feature_extraction_seamless_m4t.js":(I,G,l)=>{l.r(G),l.d(G,{SeamlessM4TFeatureExtractor:()=>t});var b=l("./src/base/feature_extraction_utils.js"),d=l("./src/utils/tensor.js"),e=l("./src/utils/audio.js");class t extends b.FeatureExtractor{constructor(n){super(n);let s=this.config.sampling_rate,N=(0,e.mel_filter_bank)(256,this.config.num_mel_bins,20,Math.floor(s/2),s,null,"kaldi",!0);for(let m=0;m<N.length;++m)N[m].push(0);this.mel_filters=N,this.window=(0,e.window_function)(400,"povey",{periodic:!1})}async _extract_fbank_features(n,s){return n=n.map(N=>N*32768),(0,e.spectrogram)(n,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:s,transpose:!0})}async _call(n,{padding:s=!0,pad_to_multiple_of:N=2,do_normalize_per_mel_bins:m=!0,return_attention_mask:h=!0}={}){(0,b.validate_audio_inputs)(n,"SeamlessM4TFeatureExtractor");let V=await this._extract_fbank_features(n,this.config.max_length);if(m){let[y,H]=V.dims,E=V.data;for(let C=0;C<H;++C){let T=0;for(let WI=0;WI<y;++WI)T+=E[WI*H+C];let S=T/y,cI=0;for(let WI=0;WI<y;++WI)cI+=(E[WI*H+C]-S)**2;cI/=y-1;let hI=Math.sqrt(cI+1e-7);for(let WI=0;WI<y;++WI){let VI=WI*H+C;E[VI]=(E[VI]-S)/hI}}}let X;if(s){let[y,H]=V.dims,E=V.data,C=y%N;if(C>0){let T=new Float32Array(H*(y+C));T.set(E),T.fill(this.config.padding_value,E.length);let S=y+C;V=new d.Tensor(V.type,T,[S,H]),h&&(X=new d.Tensor("int64",new BigInt64Array(S),[1,S]),X.data.fill(1n,0,y))}}let[p,F]=V.dims,a=this.config.stride;if(p%a!==0)throw new Error(`The number of frames (${p}) must be a multiple of the stride (${a}).`);let Q=V.view(1,Math.floor(p/a),F*a),o={input_features:Q};if(h){let y=Q.dims[1],H=new BigInt64Array(y);if(X){let E=X.data;for(let C=1,T=0;C<p;C+=a,++T)H[T]=E[C]}else H.fill(1n);o.attention_mask=new d.Tensor("int64",H,[1,y])}return o}}},"./src/models/segformer/image_processing_segformer.js":(I,G,l)=>{l.r(G),l.d(G,{SegformerFeatureExtractor:()=>e,SegformerImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{post_process_semantic_segmentation(...W){return(0,b.post_process_semantic_segmentation)(...W)}}class e extends d{}},"./src/models/siglip/image_processing_siglip.js":(I,G,l)=>{l.r(G),l.d(G,{SiglipImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{}},"./src/models/speecht5/feature_extraction_speecht5.js":(I,G,l)=>{l.r(G),l.d(G,{SpeechT5FeatureExtractor:()=>d});var b=l("./src/base/feature_extraction_utils.js");class d extends b.FeatureExtractor{}},"./src/models/speecht5/processing_speecht5.js":(I,G,l)=>{l.r(G),l.d(G,{SpeechT5Processor:()=>t});var b=l("./src/base/processing_utils.js"),d=l("./src/tokenizers.js"),e=l("./src/models/auto/feature_extraction_auto.js");class t extends b.Processor{static tokenizer_class=d.AutoTokenizer;static feature_extractor_class=e.AutoFeatureExtractor;async _call(n){return await this.feature_extractor(n)}}},"./src/models/swin2sr/image_processing_swin2sr.js":(I,G,l)=>{l.r(G),l.d(G,{Swin2SRImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{pad_image(t,W,n,s={}){let[N,m,h]=W;return super.pad_image(t,W,{width:m+(n-m%n)%n,height:N+(n-N%n)%n},{mode:"symmetric",center:!1,constant_values:-1,...s})}}},"./src/models/vit/image_processing_vit.js":(I,G,l)=>{l.r(G),l.d(G,{ViTFeatureExtractor:()=>e,ViTImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{}class e extends d{}},"./src/models/vitmatte/image_processing_vitmatte.js":(I,G,l)=>{l.r(G),l.d(G,{VitMatteImageProcessor:()=>e});var b=l("./src/base/image_processors_utils.js"),d=l("./src/utils/tensor.js");class e extends b.ImageProcessor{async _call(W,n){Array.isArray(W)||(W=[W]),Array.isArray(n)||(n=[n]);let s=await Promise.all(W.map(h=>this.preprocess(h))),N=await Promise.all(n.map(h=>this.preprocess(h,{do_normalize:!1,do_convert_rgb:!1,do_convert_grayscale:!0})));return{pixel_values:(0,d.stack)(s.map((h,V)=>(0,d.cat)([h.pixel_values,N[V].pixel_values],0)),0),original_sizes:s.map(h=>h.original_size),reshaped_input_sizes:s.map(h=>h.reshaped_input_size)}}}},"./src/models/vitpose/image_processing_vitpose.js":(I,G,l)=>{l.r(G),l.d(G,{VitPoseImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{post_process_pose_estimation(t,W,{threshold:n=null}={}){let s=t.tolist(),[N,m,h,V]=t.dims,X=[];for(let p=0;p<N;++p){let F=s[p],a=W[p],u=[];for(let Q=0;Q<a.length;++Q){let o=a[Q],y=[],H=[],E=[],C=o.at(-2)/V,T=o.at(-1)/h;for(let S=0;S<F.length;++S){let[cI,hI]=[0,0],WI=0,VI=-1/0,sI=F[S];for(let dI=0;dI<sI.length;++dI){let pI=sI[dI];for(let yI=0;yI<pI.length;++yI){let eI=pI[yI];WI+=eI,VI=Math.max(VI,eI),cI+=(yI+.5)*eI,hI+=dI*eI}}if(n!=null&&VI<n)continue;let ZI=[C*cI/WI,T*hI/WI];y.push(ZI),E.push(S),H.push(VI)}u.push({bbox:o,scores:H,labels:E,keypoints:y})}X.push(u)}return X}}},"./src/models/wav2vec2/feature_extraction_wav2vec2.js":(I,G,l)=>{l.r(G),l.d(G,{Wav2Vec2FeatureExtractor:()=>e});var b=l("./src/base/feature_extraction_utils.js"),d=l("./src/utils/tensor.js");class e extends b.FeatureExtractor{_zero_mean_unit_var_norm(W){let s=W.reduce((m,h)=>m+h,0)/W.length,N=W.reduce((m,h)=>m+(h-s)**2,0)/W.length;return W.map(m=>(m-s)/Math.sqrt(N+1e-7))}async _call(W){(0,b.validate_audio_inputs)(W,"Wav2Vec2FeatureExtractor"),W instanceof Float64Array&&(W=new Float32Array(W));let n=W;this.config.do_normalize&&(n=this._zero_mean_unit_var_norm(n));let s=[1,n.length];return{input_values:new d.Tensor("float32",n,s),attention_mask:new d.Tensor("int64",new BigInt64Array(n.length).fill(1n),s)}}}},"./src/models/wav2vec2/processing_wav2vec2.js":(I,G,l)=>{l.r(G),l.d(G,{Wav2Vec2Processor:()=>t});var b=l("./src/tokenizers.js"),d=l("./src/models/auto/feature_extraction_auto.js"),e=l("./src/base/processing_utils.js");class t extends e.Processor{static tokenizer_class=b.AutoTokenizer;static feature_extractor_class=d.AutoFeatureExtractor;async _call(n){return await this.feature_extractor(n)}}},"./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js":(I,G,l)=>{l.r(G),l.d(G,{Wav2Vec2ProcessorWithLM:()=>t});var b=l("./src/tokenizers.js"),d=l("./src/models/auto/feature_extraction_auto.js"),e=l("./src/base/processing_utils.js");class t extends e.Processor{static tokenizer_class=b.AutoTokenizer;static feature_extractor_class=d.AutoFeatureExtractor;async _call(n){return await this.feature_extractor(n)}}},"./src/models/wespeaker/feature_extraction_wespeaker.js":(I,G,l)=>{l.r(G),l.d(G,{WeSpeakerFeatureExtractor:()=>t});var b=l("./src/base/feature_extraction_utils.js"),d=l("./src/utils/tensor.js"),e=l("./src/utils/audio.js");class t extends b.FeatureExtractor{constructor(n){super(n);let s=this.config.sampling_rate,N=(0,e.mel_filter_bank)(256,this.config.num_mel_bins,20,Math.floor(s/2),s,null,"kaldi",!0);for(let m=0;m<N.length;++m)N[m].push(0);this.mel_filters=N,this.window=(0,e.window_function)(400,"hamming",{periodic:!1}),this.min_num_frames=this.config.min_num_frames}async _extract_fbank_features(n){return n=n.map(s=>s*32768),(0,e.spectrogram)(n,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,transpose:!0,min_num_frames:this.min_num_frames})}async _call(n){(0,b.validate_audio_inputs)(n,"WeSpeakerFeatureExtractor");let s=(await this._extract_fbank_features(n)).unsqueeze_(0);if(this.config.fbank_centering_span===null){let N=s.mean(1).data,m=s.data,[h,V,X]=s.dims;for(let p=0;p<h;++p){let F=p*V*X,a=p*X;for(let u=0;u<V;++u){let Q=F+u*X;for(let o=0;o<X;++o)m[Q+o]-=N[a+o]}}}return{input_features:s}}}},"./src/models/whisper/common_whisper.js":(I,G,l)=>{l.r(G),l.d(G,{WHISPER_LANGUAGE_MAPPING:()=>d,WHISPER_TO_LANGUAGE_CODE_MAPPING:()=>e,whisper_language_to_code:()=>t});let b=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],d=new Map(b),e=new Map([...b.map(([W,n])=>[n,W]),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);function t(W){W=W.toLowerCase();let n=e.get(W);if(n===void 0)if(d.has(W))n=W;else{let N=W.length===2?d.keys():d.values();throw new Error(`Language "${W}" is not supported. Must be one of: ${JSON.stringify(N)}`)}return n}},"./src/models/whisper/feature_extraction_whisper.js":(I,G,l)=>{l.r(G),l.d(G,{WhisperFeatureExtractor:()=>W});var b=l("./src/base/feature_extraction_utils.js"),d=l("./src/utils/tensor.js"),e=l("./src/utils/audio.js"),t=l("./src/utils/maths.js");class W extends b.FeatureExtractor{constructor(s){super(s),this.config.mel_filters??=(0,e.mel_filter_bank)(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8e3,this.config.sampling_rate,"slaney","slaney"),this.window=(0,e.window_function)(this.config.n_fft,"hann")}async _extract_fbank_features(s){let N=await(0,e.spectrogram)(s,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:this.config.nb_max_frames}),m=N.data,h=(0,t.max)(m)[0];for(let V=0;V<m.length;++V)m[V]=(Math.max(m[V],h-8)+4)/4;return N}async _call(s){(0,b.validate_audio_inputs)(s,"WhisperFeatureExtractor");let N;return s.length>this.config.n_samples?(console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`."),N=s.slice(0,this.config.n_samples)):(N=new Float32Array(this.config.n_samples),N.set(s)),{input_features:(await this._extract_fbank_features(N)).unsqueeze_(0)}}}},"./src/models/whisper/generation_whisper.js":(I,G,l)=>{l.r(G),l.d(G,{WhisperGenerationConfig:()=>d});var b=l("./src/generation/configuration_utils.js");class d extends b.GenerationConfig{return_timestamps=null;return_token_timestamps=null;num_frames=null;alignment_heads=null;task=null;language=null;no_timestamps_token_id=null;prompt_ids=null;is_multilingual=null;lang_to_id=null;task_to_id=null;max_initial_timestamp_index=1}},"./src/models/whisper/processing_whisper.js":(I,G,l)=>{l.r(G),l.d(G,{WhisperProcessor:()=>t});var b=l("./src/models/auto/feature_extraction_auto.js"),d=l("./src/tokenizers.js"),e=l("./src/base/processing_utils.js");class t extends e.Processor{static tokenizer_class=d.AutoTokenizer;static feature_extractor_class=b.AutoFeatureExtractor;async _call(n){return await this.feature_extractor(n)}}},"./src/models/yolos/image_processing_yolos.js":(I,G,l)=>{l.r(G),l.d(G,{YolosFeatureExtractor:()=>e,YolosImageProcessor:()=>d});var b=l("./src/base/image_processors_utils.js");class d extends b.ImageProcessor{post_process_object_detection(...W){return(0,b.post_process_object_detection)(...W)}}class e extends d{}},"./src/ops/registry.js":(I,G,l)=>{l.r(G),l.d(G,{TensorOpRegistry:()=>n});var b=l("./src/backends/onnx.js"),d=l("./src/utils/tensor.js"),e=l("./src/env.js");let t=e.apis.IS_BROWSER_ENV||e.apis.IS_WEBWORKER_ENV,W=async(s,N,m)=>{let h=await(0,b.createInferenceSession)(new Uint8Array(s),N),V=Promise.resolve();return async X=>{let p=(0,b.isONNXProxy)(),F=Object.fromEntries(Object.entries(X).map(([u,Q])=>[u,(p?Q.clone():Q).ort_tensor])),a=await(V=t?V.then(()=>h.run(F)):h.run(F));return Array.isArray(m)?m.map(u=>new d.Tensor(a[u])):new d.Tensor(a[m])}};class n{static session_options={};static get nearest_interpolate_4d(){return this._nearest_interpolate_4d||(this._nearest_interpolate_4d=W([8,10,18,0,58,129,1,10,41,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,18,10,4,109,111,100,101,34,7,110,101,97,114,101,115,116,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,21],this.session_options,"y")),this._nearest_interpolate_4d}static get bilinear_interpolate_4d(){return this._bilinear_interpolate_4d||(this._bilinear_interpolate_4d=W([8,9,18,0,58,128,1,10,40,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,17,10,4,109,111,100,101,34,6,108,105,110,101,97,114,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bilinear_interpolate_4d}static get bicubic_interpolate_4d(){return this._bicubic_interpolate_4d||(this._bicubic_interpolate_4d=W([8,9,18,0,58,127,10,39,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,16,10,4,109,111,100,101,34,5,99,117,98,105,99,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bicubic_interpolate_4d}static get matmul(){return this._matmul||(this._matmul=W([8,9,18,0,58,55,10,17,10,1,97,10,1,98,18,1,99,34,6,77,97,116,77,117,108,18,1,114,90,9,10,1,97,18,4,10,2,8,1,90,9,10,1,98,18,4,10,2,8,1,98,9,10,1,99,18,4,10,2,8,1,66,2,16,20],this.session_options,"c")),this._matmul}static get stft(){return this._stft||(this._stft=W([8,7,18,0,58,148,1,10,38,10,1,115,10,1,106,10,1,119,10,1,108,18,1,111,34,4,83,84,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,115,90,26,10,1,115,18,21,10,19,8,1,18,15,10,3,18,1,98,10,3,18,1,115,10,3,18,1,99,90,11,10,1,106,18,6,10,4,8,7,18,0,90,16,10,1,119,18,11,10,9,8,1,18,5,10,3,18,1,119,90,11,10,1,108,18,6,10,4,8,7,18,0,98,31,10,1,111,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,102,10,3,18,1,100,10,3,18,1,99,66,2,16,17],this.session_options,"o")),this._stft}static get rfft(){return this._rfft||(this._rfft=W([8,9,18,0,58,97,10,33,10,1,120,10,0,10,1,97,18,1,121,34,3,68,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,100,90,21,10,1,120,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,90,11,10,1,97,18,6,10,4,8,7,18,0,98,21,10,1,121,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,66,2,16,20],this.session_options,"y")),this._rfft}static get top_k(){return this._top_k||(this._top_k=W([8,10,18,0,58,73,10,18,10,1,120,10,1,107,18,1,118,18,1,105,34,4,84,111,112,75,18,1,116,90,9,10,1,120,18,4,10,2,8,1,90,15,10,1,107,18,10,10,8,8,7,18,4,10,2,8,1,98,9,10,1,118,18,4,10,2,8,1,98,9,10,1,105,18,4,10,2,8,7,66,2,16,21],this.session_options,["v","i"])),this._top_k}static get slice(){return this._slice||(this._slice=W([8,7,18,0,58,96,10,25,10,1,120,10,1,115,10,1,101,10,1,97,10,1,116,18,1,121,34,5,83,108,105,99,101,18,1,114,90,9,10,1,120,18,4,10,2,8,1,90,9,10,1,115,18,4,10,2,8,7,90,9,10,1,101,18,4,10,2,8,7,90,9,10,1,97,18,4,10,2,8,7,90,9,10,1,116,18,4,10,2,8,7,98,9,10,1,121,18,4,10,2,8,1,66,2,16,13],this.session_options,"y")),this._slice}}},"./src/pipelines.js":(I,G,l)=>{l.r(G),l.d(G,{AudioClassificationPipeline:()=>WI,AutomaticSpeechRecognitionPipeline:()=>sI,DepthEstimationPipeline:()=>UI,DocumentQuestionAnsweringPipeline:()=>YI,FeatureExtractionPipeline:()=>cI,FillMaskPipeline:()=>o,ImageClassificationPipeline:()=>dI,ImageFeatureExtractionPipeline:()=>hI,ImageSegmentationPipeline:()=>pI,ImageToImagePipeline:()=>JI,ImageToTextPipeline:()=>ZI,ObjectDetectionPipeline:()=>eI,Pipeline:()=>F,QuestionAnsweringPipeline:()=>Q,SummarizationPipeline:()=>H,Text2TextGenerationPipeline:()=>y,TextClassificationPipeline:()=>a,TextGenerationPipeline:()=>T,TextToAudioPipeline:()=>$,TokenClassificationPipeline:()=>u,TranslationPipeline:()=>E,ZeroShotAudioClassificationPipeline:()=>VI,ZeroShotClassificationPipeline:()=>S,ZeroShotImageClassificationPipeline:()=>yI,ZeroShotObjectDetectionPipeline:()=>HI,pipeline:()=>bI});var b=l("./src/tokenizers.js"),d=l("./src/models.js"),e=l("./src/models/auto/processing_auto.js"),t=l("./src/base/processing_utils.js"),W=l("./src/utils/generic.js"),n=l("./src/utils/core.js"),s=l("./src/utils/maths.js"),N=l("./src/utils/audio.js"),m=l("./src/utils/tensor.js"),h=l("./src/utils/image.js");async function V(U){return Array.isArray(U)||(U=[U]),await Promise.all(U.map(k=>h.RawImage.read(k)))}async function X(U,k){return Array.isArray(U)||(U=[U]),await Promise.all(U.map(w=>typeof w=="string"||w instanceof URL?(0,N.read_audio)(w,k):w instanceof Float64Array?new Float32Array(w):w))}function p(U,k){k&&(U=U.map(K=>K|0));let[w,r,A,O]=U;return{xmin:w,ymin:r,xmax:A,ymax:O}}class F extends W.Callable{constructor({task:k,model:w,tokenizer:r=null,processor:A=null}){super(),this.task=k,this.model=w,this.tokenizer=r,this.processor=A}async dispose(){await this.model.dispose()}}class a extends F{constructor(k){super(k)}async _call(k,{top_k:w=1}={}){let r=this.tokenizer(k,{padding:!0,truncation:!0}),A=await this.model(r),O=this.model.config.problem_type==="multi_label_classification"?GI=>GI.sigmoid():GI=>new m.Tensor("float32",(0,s.softmax)(GI.data),GI.dims),K=this.model.config.id2label,q=[];for(let GI of A.logits){let tI=O(GI),iI=await(0,m.topk)(tI,w),B=iI[0].tolist(),lI=iI[1].tolist().map((QI,vI)=>({label:K?K[QI]:`LABEL_${QI}`,score:B[vI]}));w===1?q.push(...lI):q.push(lI)}return Array.isArray(k)||w===1?q:q[0]}}class u extends F{constructor(k){super(k)}async _call(k,{ignore_labels:w=["O"]}={}){let r=Array.isArray(k),A=this.tokenizer(r?k:[k],{padding:!0,truncation:!0}),K=(await this.model(A)).logits,q=this.model.config.id2label,GI=[];for(let tI=0;tI<K.dims[0];++tI){let iI=A.input_ids[tI],B=K[tI],aI=[];for(let lI=0;lI<B.dims[0];++lI){let QI=B[lI],vI=(0,s.max)(QI.data)[1],OI=q?q[vI]:`LABEL_${vI}`;if(w.includes(OI))continue;let uI=this.tokenizer.decode([iI[lI].item()],{skip_special_tokens:!0});if(uI==="")continue;let wI=(0,s.softmax)(QI.data);aI.push({entity:OI,score:wI[vI],index:lI,word:uI})}GI.push(aI)}return r?GI:GI[0]}}class Q extends F{constructor(k){super(k)}async _call(k,w,{top_k:r=1}={}){let A=this.tokenizer(k,{text_pair:w,padding:!0,truncation:!0}),{start_logits:O,end_logits:K}=await this.model(A),q=A.input_ids.tolist(),GI=A.attention_mask.tolist(),tI=this.tokenizer.all_special_ids,iI=[];for(let B=0;B<O.dims[0];++B){let aI=q[B],lI=aI.findIndex(TI=>TI==this.tokenizer.sep_token_id),QI=GI[B].map((TI,Il)=>TI==1&&(Il===0||Il>lI&&tI.findIndex(nl=>nl==aI[Il])===-1)),vI=O[B].tolist(),OI=K[B].tolist();for(let TI=1;TI<vI.length;++TI)(GI[B]==0||TI<=lI||tI.findIndex(Il=>Il==aI[TI])!==-1)&&(vI[TI]=-1/0,OI[TI]=-1/0);let uI=(0,s.softmax)(vI).map((TI,Il)=>[TI,Il]),wI=(0,s.softmax)(OI).map((TI,Il)=>[TI,Il]);uI[0][0]=0,wI[0][0]=0;let kI=(0,n.product)(uI,wI).filter(TI=>TI[0][1]<=TI[1][1]).map(TI=>[TI[0][1],TI[1][1],TI[0][0]*TI[1][0]]).sort((TI,Il)=>Il[2]-TI[2]);for(let TI=0;TI<Math.min(kI.length,r);++TI){let[Il,nl,ol]=kI[TI],PI=aI.slice(Il,nl+1),KI=this.tokenizer.decode(PI,{skip_special_tokens:!0});iI.push({answer:KI,score:ol})}}return r===1?iI[0]:iI}}class o extends F{constructor(k){super(k)}async _call(k,{top_k:w=5}={}){let r=this.tokenizer(k,{padding:!0,truncation:!0}),{logits:A}=await this.model(r),O=[],K=r.input_ids.tolist();for(let q=0;q<K.length;++q){let GI=K[q],tI=GI.findIndex(QI=>QI==this.tokenizer.mask_token_id);if(tI===-1)throw Error(`Mask token (${this.tokenizer.mask_token}) not found in text.`);let iI=A[q][tI],B=await(0,m.topk)(new m.Tensor("float32",(0,s.softmax)(iI.data),iI.dims),w),aI=B[0].tolist(),lI=B[1].tolist();O.push(lI.map((QI,vI)=>{let OI=GI.slice();return OI[tI]=QI,{score:aI[vI],token:Number(QI),token_str:this.tokenizer.decode([QI]),sequence:this.tokenizer.decode(OI,{skip_special_tokens:!0})}}))}return Array.isArray(k)?O:O[0]}}class y extends F{_key="generated_text";constructor(k){super(k)}async _call(k,w={}){Array.isArray(k)||(k=[k]),this.model.config.prefix&&(k=k.map(GI=>this.model.config.prefix+GI));let r=this.model.config.task_specific_params;r&&r[this.task]&&r[this.task].prefix&&(k=k.map(GI=>r[this.task].prefix+GI));let A=this.tokenizer,O={padding:!0,truncation:!0},K;this instanceof E&&"_build_translation_inputs"in A?K=A._build_translation_inputs(k,O,w):K=A(k,O);let q=await this.model.generate({...K,...w});return A.batch_decode(q,{skip_special_tokens:!0}).map(GI=>({[this._key]:GI}))}}class H extends y{_key="summary_text";constructor(k){super(k)}}class E extends y{_key="translation_text";constructor(k){super(k)}}function C(U){return Array.isArray(U)&&U.every(k=>"role"in k&&"content"in k)}class T extends F{constructor(k){super(k)}async _call(k,w={}){let r=!1,A=!1,O;if(typeof k=="string")O=k=[k];else if(Array.isArray(k)&&k.every(lI=>typeof lI=="string"))r=!0,O=k;else{if(C(k))k=[k];else if(Array.isArray(k)&&k.every(C))r=!0;else throw new Error("Input must be a string, an array of strings, a Chat, or an array of Chats");A=!0,O=k.map(lI=>this.tokenizer.apply_chat_template(lI,{tokenize:!1,add_generation_prompt:!0}))}let K=w.add_special_tokens??!1,q=A?!1:w.return_full_text??!0;this.tokenizer.padding_side="left";let GI=this.tokenizer(O,{add_special_tokens:K,padding:!0,truncation:!0}),tI=await this.model.generate({...GI,...w}),iI=this.tokenizer.batch_decode(tI,{skip_special_tokens:!0}),B;!q&&GI.input_ids.dims.at(-1)>0&&(B=this.tokenizer.batch_decode(GI.input_ids,{skip_special_tokens:!0}).map(lI=>lI.length));let aI=Array.from({length:k.length},lI=>[]);for(let lI=0;lI<iI.length;++lI){let QI=Math.floor(lI/tI.dims[0]*k.length);B&&(iI[lI]=iI[lI].slice(B[QI])),aI[QI].push({generated_text:A?[...k[QI],{role:"assistant",content:iI[lI]}]:iI[lI]})}return!r&&aI.length===1?aI[0]:aI}}class S extends F{constructor(k){super(k),this.label2id=Object.fromEntries(Object.entries(this.model.config.label2id).map(([w,r])=>[w.toLowerCase(),r])),this.entailment_id=this.label2id.entailment,this.entailment_id===void 0&&(console.warn("Could not find 'entailment' in label2id mapping. Using 2 as entailment_id."),this.entailment_id=2),this.contradiction_id=this.label2id.contradiction??this.label2id.not_entailment,this.contradiction_id===void 0&&(console.warn("Could not find 'contradiction' in label2id mapping. Using 0 as contradiction_id."),this.contradiction_id=0)}async _call(k,w,{hypothesis_template:r="This example is {}.",multi_label:A=!1}={}){let O=Array.isArray(k);O||(k=[k]),Array.isArray(w)||(w=[w]);let K=w.map(tI=>r.replace("{}",tI)),q=A||w.length===1,GI=[];for(let tI of k){let iI=[];for(let lI of K){let QI=this.tokenizer(tI,{text_pair:lI,padding:!0,truncation:!0}),vI=await this.model(QI);q?iI.push([vI.logits.data[this.contradiction_id],vI.logits.data[this.entailment_id]]):iI.push(vI.logits.data[this.entailment_id])}let aI=(q?iI.map(lI=>(0,s.softmax)(lI)[1]):(0,s.softmax)(iI)).map((lI,QI)=>[lI,QI]).sort((lI,QI)=>QI[0]-lI[0]);GI.push({sequence:tI,labels:aI.map(lI=>w[lI[1]]),scores:aI.map(lI=>lI[0])})}return O?GI:GI[0]}}class cI extends F{constructor(k){super(k)}async _call(k,{pooling:w="none",normalize:r=!1,quantize:A=!1,precision:O="binary"}={}){let K=this.tokenizer(k,{padding:!0,truncation:!0}),q=await this.model(K),GI=q.last_hidden_state??q.logits??q.token_embeddings;if(w!=="none")if(w==="mean")GI=(0,m.mean_pooling)(GI,K.attention_mask);else if(w==="cls")GI=GI.slice(null,0);else throw Error(`Pooling method '${w}' not supported.`);return r&&(GI=GI.normalize(2,-1)),A&&(GI=(0,m.quantize_embeddings)(GI,O)),GI}}class hI extends F{constructor(k){super(k)}async _call(k,{pool:w=null}={}){let r=await V(k),{pixel_values:A}=await this.processor(r),O=await this.model({pixel_values:A}),K;if(w){if(!("pooler_output"in O))throw Error("No pooled output was returned. Make sure the model has a 'pooler' layer when using the 'pool' option.");K=O.pooler_output}else K=O.last_hidden_state??O.logits??O.image_embeds;return K}}class WI extends F{constructor(k){super(k)}async _call(k,{top_k:w=5}={}){let r=this.processor.feature_extractor.config.sampling_rate,A=await X(k,r),O=this.model.config.id2label,K=[];for(let q of A){let GI=await this.processor(q),iI=(await this.model(GI)).logits[0],B=await(0,m.topk)(new m.Tensor("float32",(0,s.softmax)(iI.data),iI.dims),w),aI=B[0].tolist(),QI=B[1].tolist().map((vI,OI)=>({label:O?O[vI]:`LABEL_${vI}`,score:aI[OI]}));K.push(QI)}return Array.isArray(k)?K:K[0]}}class VI extends F{constructor(k){super(k)}async _call(k,w,{hypothesis_template:r="This is a sound of {}."}={}){let A=!Array.isArray(k);A&&(k=[k]);let O=w.map(iI=>r.replace("{}",iI)),K=this.tokenizer(O,{padding:!0,truncation:!0}),q=this.processor.feature_extractor.config.sampling_rate,GI=await X(k,q),tI=[];for(let iI of GI){let B=await this.processor(iI),aI=await this.model({...K,...B}),lI=(0,s.softmax)(aI.logits_per_audio.data);tI.push([...lI].map((QI,vI)=>({score:QI,label:w[vI]})))}return A?tI[0]:tI}}class sI extends F{constructor(k){super(k)}async _call(k,w={}){switch(this.model.config.model_type){case"whisper":return this._call_whisper(k,w);case"wav2vec2":case"wav2vec2-bert":case"unispeech":case"unispeech-sat":case"hubert":return this._call_wav2vec2(k,w);case"moonshine":return this._call_moonshine(k,w);default:throw new Error(`AutomaticSpeechRecognitionPipeline does not support model type '${this.model.config.model_type}'.`)}}async _call_wav2vec2(k,w){w.language&&console.warn('`language` parameter is not yet supported for `wav2vec2` models, defaulting to "English".'),w.task&&console.warn('`task` parameter is not yet supported for `wav2vec2` models, defaulting to "transcribe".');let r=!Array.isArray(k);r&&(k=[k]);let A=this.processor.feature_extractor.config.sampling_rate,O=await X(k,A),K=[];for(let q of O){let GI=await this.processor(q),iI=(await this.model(GI)).logits[0],B=[];for(let lI of iI)B.push((0,s.max)(lI.data)[1]);let aI=this.tokenizer.decode(B);K.push({text:aI})}return r?K[0]:K}async _call_whisper(k,w){let r=w.return_timestamps??!1,A=w.chunk_length_s??0,O=w.force_full_sequences??!1,K=w.stride_length_s??null,q={...w};r==="word"&&(q.return_token_timestamps=!0,q.return_timestamps=!1);let GI=!Array.isArray(k);GI&&(k=[k]);let tI=this.processor.feature_extractor.config.chunk_length/this.model.config.max_source_positions,iI=this.processor.feature_extractor.config.hop_length,B=this.processor.feature_extractor.config.sampling_rate,aI=await X(k,B),lI=[];for(let QI of aI){let vI=[];if(A>0){if(K===null)K=A/6;else if(A<=K)throw Error("`chunk_length_s` must be larger than `stride_length_s`.");let wI=B*A,kI=B*K,TI=wI-2*kI,Il=0;for(;;){let nl=Il+wI,ol=QI.subarray(Il,nl),PI=await this.processor(ol),KI=Il===0,jI=nl>=QI.length;if(vI.push({stride:[ol.length,KI?0:kI,jI?0:kI],input_features:PI.input_features,is_last:jI}),jI)break;Il+=TI}}else vI=[{stride:[QI.length,0,0],input_features:(await this.processor(QI)).input_features,is_last:!0}];for(let wI of vI){q.num_frames=Math.floor(wI.stride[0]/iI);let kI=await this.model.generate({inputs:wI.input_features,...q});r==="word"?(wI.tokens=kI.sequences.tolist()[0],wI.token_timestamps=kI.token_timestamps.tolist()[0].map(TI=>(0,s.round)(TI,2))):wI.tokens=kI[0].tolist(),wI.stride=wI.stride.map(TI=>TI/B)}let[OI,uI]=this.tokenizer._decode_asr(vI,{time_precision:tI,return_timestamps:r,force_full_sequences:O});lI.push({text:OI,...uI})}return GI?lI[0]:lI}async _call_moonshine(k,w){let r=!Array.isArray(k);r&&(k=[k]);let A=this.processor.feature_extractor.config.sampling_rate,O=await X(k,A),K=[];for(let q of O){let GI=await this.processor(q),tI=Math.floor(q.length/A)*6,iI=await this.model.generate({max_new_tokens:tI,...w,...GI}),B=this.processor.batch_decode(iI,{skip_special_tokens:!0})[0];K.push({text:B})}return r?K[0]:K}}class ZI extends F{constructor(k){super(k)}async _call(k,w={}){let r=Array.isArray(k),A=await V(k),{pixel_values:O}=await this.processor(A),K=[];for(let q of O){q.dims=[1,...q.dims];let GI=await this.model.generate({inputs:q,...w}),tI=this.tokenizer.batch_decode(GI,{skip_special_tokens:!0}).map(iI=>({generated_text:iI.trim()}));K.push(tI)}return r?K:K[0]}}class dI extends F{constructor(k){super(k)}async _call(k,{top_k:w=5}={}){let r=await V(k),{pixel_values:A}=await this.processor(r),O=await this.model({pixel_values:A}),K=this.model.config.id2label,q=[];for(let GI of O.logits){let tI=await(0,m.topk)(new m.Tensor("float32",(0,s.softmax)(GI.data),GI.dims),w),iI=tI[0].tolist(),aI=tI[1].tolist().map((lI,QI)=>({label:K?K[lI]:`LABEL_${lI}`,score:iI[QI]}));q.push(aI)}return Array.isArray(k)?q:q[0]}}class pI extends F{constructor(k){super(k),this.subtasks_mapping={panoptic:"post_process_panoptic_segmentation",instance:"post_process_instance_segmentation",semantic:"post_process_semantic_segmentation"}}async _call(k,{threshold:w=.5,mask_threshold:r=.5,overlap_mask_area_threshold:A=.8,label_ids_to_fuse:O=null,target_sizes:K=null,subtask:q=null}={}){if(Array.isArray(k)&&k.length!==1)throw Error("Image segmentation pipeline currently only supports a batch size of 1.");let tI=await V(k),iI=tI.map(uI=>[uI.height,uI.width]),{pixel_values:B,pixel_mask:aI}=await this.processor(tI),lI=await this.model({pixel_values:B,pixel_mask:aI}),QI=null;if(q!==null)QI=this.subtasks_mapping[q];else for(let[uI,wI]of Object.entries(this.subtasks_mapping))if(wI in this.processor.image_processor){QI=this.processor.image_processor[wI].bind(this.processor.image_processor),q=uI;break}let vI=this.model.config.id2label,OI=[];if(q==="panoptic"||q==="instance"){let uI=QI(lI,w,r,A,O,K??iI)[0],wI=uI.segmentation;for(let kI of uI.segments_info){let TI=new Uint8ClampedArray(wI.data.length);for(let nl=0;nl<wI.data.length;++nl)wI.data[nl]===kI.id&&(TI[nl]=255);let Il=new h.RawImage(TI,wI.dims[1],wI.dims[0],1);OI.push({score:kI.score,label:vI[kI.label_id],mask:Il})}}else if(q==="semantic"){let{segmentation:uI,labels:wI}=QI(lI,K??iI)[0];for(let kI of wI){let TI=new Uint8ClampedArray(uI.data.length);for(let nl=0;nl<uI.data.length;++nl)uI.data[nl]===kI&&(TI[nl]=255);let Il=new h.RawImage(TI,uI.dims[1],uI.dims[0],1);OI.push({score:null,label:vI[kI],mask:Il})}}else throw Error(`Subtask ${q} not supported.`);return OI}}class yI extends F{constructor(k){super(k)}async _call(k,w,{hypothesis_template:r="This is a photo of {}"}={}){let A=Array.isArray(k),O=await V(k),K=w.map(aI=>r.replace("{}",aI)),q=this.tokenizer(K,{padding:this.model.config.model_type==="siglip"?"max_length":!0,truncation:!0}),{pixel_values:GI}=await this.processor(O),tI=await this.model({...q,pixel_values:GI}),iI=this.model.config.model_type==="siglip"?aI=>aI.sigmoid().data:aI=>(0,s.softmax)(aI.data),B=[];for(let aI of tI.logits_per_image){let QI=[...iI(aI)].map((vI,OI)=>({score:vI,label:w[OI]}));QI.sort((vI,OI)=>OI.score-vI.score),B.push(QI)}return A?B:B[0]}}class eI extends F{constructor(k){super(k)}async _call(k,{threshold:w=.9,percentage:r=!1}={}){let A=Array.isArray(k);if(A&&k.length!==1)throw Error("Object detection pipeline currently only supports a batch size of 1.");let O=await V(k),K=r?null:O.map(lI=>[lI.height,lI.width]),{pixel_values:q,pixel_mask:GI}=await this.processor(O),tI=await this.model({pixel_values:q,pixel_mask:GI}),iI=this.processor.image_processor.post_process_object_detection(tI,w,K),B=this.model.config.id2label,aI=iI.map(lI=>lI.boxes.map((QI,vI)=>({score:lI.scores[vI],label:B[lI.classes[vI]],box:p(QI,!r)})));return A?aI:aI[0]}}class HI extends F{constructor(k){super(k)}async _call(k,w,{threshold:r=.1,top_k:A=null,percentage:O=!1}={}){let K=Array.isArray(k),q=await V(k),GI=this.tokenizer(w,{padding:!0,truncation:!0}),tI=await this.processor(q),iI=[];for(let B=0;B<q.length;++B){let aI=q[B],lI=O?null:[[aI.height,aI.width]],QI=tI.pixel_values[B].unsqueeze_(0),vI=await this.model({...GI,pixel_values:QI}),OI;if("post_process_grounded_object_detection"in this.processor){let uI=this.processor.post_process_grounded_object_detection(vI,GI.input_ids,{box_threshold:r,text_threshold:r,target_sizes:lI})[0];OI=uI.boxes.map((wI,kI)=>({score:uI.scores[kI],label:uI.labels[kI],box:p(wI,!O)}))}else{let uI=this.processor.image_processor.post_process_object_detection(vI,r,lI,!0)[0];OI=uI.boxes.map((wI,kI)=>({score:uI.scores[kI],label:w[uI.classes[kI]],box:p(wI,!O)}))}OI.sort((uI,wI)=>wI.score-uI.score),A!==null&&(OI=OI.slice(0,A)),iI.push(OI)}return K?iI:iI[0]}}class YI extends F{constructor(k){super(k)}async _call(k,w,r={}){let A=(await V(k))[0],{pixel_values:O}=await this.processor(A),K=`<s_docvqa><s_question>${w}</s_question><s_answer>`,q=this.tokenizer(K,{add_special_tokens:!1,padding:!0,truncation:!0}).input_ids,GI=await this.model.generate({inputs:O,max_length:this.model.config.decoder.max_position_embeddings,decoder_input_ids:q,...r}),iI=this.tokenizer.batch_decode(GI)[0].match(/<s_answer>(.*?)<\/s_answer>/),B=null;return iI&&iI.length>=2&&(B=iI[1].trim()),[{answer:B}]}}class $ extends F{DEFAULT_VOCODER_ID="Xenova/speecht5_hifigan";constructor(k){super(k),this.vocoder=k.vocoder??null}async _call(k,{speaker_embeddings:w=null}={}){return this.processor?this._call_text_to_spectrogram(k,{speaker_embeddings:w}):this._call_text_to_waveform(k)}async _call_text_to_waveform(k){let w=this.tokenizer(k,{padding:!0,truncation:!0}),{waveform:r}=await this.model(w),A=this.model.config.sampling_rate;return new N.RawAudio(r.data,A)}async _call_text_to_spectrogram(k,{speaker_embeddings:w}){if(this.vocoder||(console.log("No vocoder specified, using default HifiGan vocoder."),this.vocoder=await d.AutoModel.from_pretrained(this.DEFAULT_VOCODER_ID,{dtype:"fp32"})),(typeof w=="string"||w instanceof URL)&&(w=new Float32Array(await(await fetch(w)).arrayBuffer())),w instanceof Float32Array)w=new m.Tensor("float32",w,[1,w.length]);else if(!(w instanceof m.Tensor))throw new Error("Speaker embeddings must be a `Tensor`, `Float32Array`, `string`, or `URL`.");let{input_ids:r}=this.tokenizer(k,{padding:!0,truncation:!0}),{waveform:A}=await this.model.generate_speech(r,w,{vocoder:this.vocoder}),O=this.processor.feature_extractor.config.sampling_rate;return new N.RawAudio(A.data,O)}}class JI extends F{constructor(k){super(k)}async _call(k){let w=await V(k),r=await this.processor(w),A=await this.model(r),O=[];for(let K of A.reconstruction){let q=K.squeeze().clamp_(0,1).mul_(255).round_().to("uint8");O.push(h.RawImage.fromTensor(q))}return O.length>1?O:O[0]}}class UI extends F{constructor(k){super(k)}async _call(k){let w=await V(k),r=await this.processor(w),{predicted_depth:A}=await this.model(r),O=[];for(let K=0;K<w.length;++K){let q=A[K],[GI,tI]=q.dims.slice(-2),[iI,B]=w[K].size,aI=(await(0,m.interpolate_4d)(q.view(1,1,GI,tI),{size:[B,iI],mode:"bilinear"})).view(B,iI),lI=aI.min().item(),QI=aI.max().item(),vI=aI.sub(lI).div_(QI-lI).mul_(255).to("uint8").unsqueeze(0),OI=h.RawImage.fromTensor(vI);O.push({predicted_depth:aI,depth:OI})}return O.length>1?O:O[0]}}let zI=Object.freeze({"text-classification":{tokenizer:b.AutoTokenizer,pipeline:a,model:d.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-finetuned-sst-2-english"},type:"text"},"token-classification":{tokenizer:b.AutoTokenizer,pipeline:u,model:d.AutoModelForTokenClassification,default:{model:"Xenova/bert-base-multilingual-cased-ner-hrl"},type:"text"},"question-answering":{tokenizer:b.AutoTokenizer,pipeline:Q,model:d.AutoModelForQuestionAnswering,default:{model:"Xenova/distilbert-base-cased-distilled-squad"},type:"text"},"fill-mask":{tokenizer:b.AutoTokenizer,pipeline:o,model:d.AutoModelForMaskedLM,default:{model:"Xenova/bert-base-uncased"},type:"text"},summarization:{tokenizer:b.AutoTokenizer,pipeline:H,model:d.AutoModelForSeq2SeqLM,default:{model:"Xenova/distilbart-cnn-6-6"},type:"text"},translation:{tokenizer:b.AutoTokenizer,pipeline:E,model:d.AutoModelForSeq2SeqLM,default:{model:"Xenova/t5-small"},type:"text"},"text2text-generation":{tokenizer:b.AutoTokenizer,pipeline:y,model:d.AutoModelForSeq2SeqLM,default:{model:"Xenova/flan-t5-small"},type:"text"},"text-generation":{tokenizer:b.AutoTokenizer,pipeline:T,model:d.AutoModelForCausalLM,default:{model:"Xenova/gpt2"},type:"text"},"zero-shot-classification":{tokenizer:b.AutoTokenizer,pipeline:S,model:d.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-mnli"},type:"text"},"audio-classification":{pipeline:WI,model:d.AutoModelForAudioClassification,processor:e.AutoProcessor,default:{model:"Xenova/wav2vec2-base-superb-ks"},type:"audio"},"zero-shot-audio-classification":{tokenizer:b.AutoTokenizer,pipeline:VI,model:d.AutoModel,processor:e.AutoProcessor,default:{model:"Xenova/clap-htsat-unfused"},type:"multimodal"},"automatic-speech-recognition":{tokenizer:b.AutoTokenizer,pipeline:sI,model:[d.AutoModelForSpeechSeq2Seq,d.AutoModelForCTC],processor:e.AutoProcessor,default:{model:"Xenova/whisper-tiny.en"},type:"multimodal"},"text-to-audio":{tokenizer:b.AutoTokenizer,pipeline:$,model:[d.AutoModelForTextToWaveform,d.AutoModelForTextToSpectrogram],processor:[e.AutoProcessor,null],default:{model:"Xenova/speecht5_tts"},type:"text"},"image-to-text":{tokenizer:b.AutoTokenizer,pipeline:ZI,model:d.AutoModelForVision2Seq,processor:e.AutoProcessor,default:{model:"Xenova/vit-gpt2-image-captioning"},type:"multimodal"},"image-classification":{pipeline:dI,model:d.AutoModelForImageClassification,processor:e.AutoProcessor,default:{model:"Xenova/vit-base-patch16-224"},type:"multimodal"},"image-segmentation":{pipeline:pI,model:[d.AutoModelForImageSegmentation,d.AutoModelForSemanticSegmentation,d.AutoModelForUniversalSegmentation],processor:e.AutoProcessor,default:{model:"Xenova/detr-resnet-50-panoptic"},type:"multimodal"},"zero-shot-image-classification":{tokenizer:b.AutoTokenizer,pipeline:yI,model:d.AutoModel,processor:e.AutoProcessor,default:{model:"Xenova/clip-vit-base-patch32"},type:"multimodal"},"object-detection":{pipeline:eI,model:d.AutoModelForObjectDetection,processor:e.AutoProcessor,default:{model:"Xenova/detr-resnet-50"},type:"multimodal"},"zero-shot-object-detection":{tokenizer:b.AutoTokenizer,pipeline:HI,model:d.AutoModelForZeroShotObjectDetection,processor:e.AutoProcessor,default:{model:"Xenova/owlvit-base-patch32"},type:"multimodal"},"document-question-answering":{tokenizer:b.AutoTokenizer,pipeline:YI,model:d.AutoModelForDocumentQuestionAnswering,processor:e.AutoProcessor,default:{model:"Xenova/donut-base-finetuned-docvqa"},type:"multimodal"},"image-to-image":{pipeline:JI,model:d.AutoModelForImageToImage,processor:e.AutoProcessor,default:{model:"Xenova/swin2SR-classical-sr-x2-64"},type:"image"},"depth-estimation":{pipeline:UI,model:d.AutoModelForDepthEstimation,processor:e.AutoProcessor,default:{model:"Xenova/dpt-large"},type:"image"},"feature-extraction":{tokenizer:b.AutoTokenizer,pipeline:cI,model:d.AutoModel,default:{model:"Xenova/all-MiniLM-L6-v2"},type:"text"},"image-feature-extraction":{processor:e.AutoProcessor,pipeline:hI,model:[d.AutoModelForImageFeatureExtraction,d.AutoModel],default:{model:"Xenova/vit-base-patch16-224-in21k"},type:"image"}}),L=Object.freeze({"sentiment-analysis":"text-classification",ner:"token-classification",asr:"automatic-speech-recognition","text-to-speech":"text-to-audio",embeddings:"feature-extraction"});async function bI(U,k=null,{progress_callback:w=null,config:r=null,cache_dir:A=null,local_files_only:O=!1,revision:K="main",device:q=null,dtype:GI=null,model_file_name:tI=null,session_options:iI={}}={}){U=L[U]??U;let B=zI[U.split("_",1)[0]];if(!B)throw Error(`Unsupported pipeline: ${U}. Must be one of [${Object.keys(zI)}]`);k||(k=B.default.model,console.log(`No model specified. Using default model: "${k}".`));let aI={progress_callback:w,config:r,cache_dir:A,local_files_only:O,revision:K,device:q,dtype:GI,model_file_name:tI,session_options:iI},lI=new Map([["tokenizer",B.tokenizer],["model",B.model],["processor",B.processor]]),QI=await FI(lI,k,aI);QI.task=U,(0,n.dispatchCallback)(w,{status:"ready",task:U,model:k});let vI=B.pipeline;return new vI(QI)}async function FI(U,k,w){let r=Object.create(null),A=[];for(let[O,K]of U.entries()){if(!K)continue;let q;Array.isArray(K)?q=new Promise(async(GI,tI)=>{let iI;for(let B of K){if(B===null){GI(null);return}try{GI(await B.from_pretrained(k,w));return}catch(aI){if(aI.message?.includes("Unsupported model type"))iI=aI;else if(aI.message?.includes("Could not locate file"))iI=aI;else{tI(aI);return}}}tI(iI)}):q=K.from_pretrained(k,w),r[O]=q,A.push(q)}await Promise.all(A);for(let[O,K]of Object.entries(r))r[O]=await K;return r}},"./src/tokenizers.js":(I,G,l)=>{l.r(G),l.d(G,{AlbertTokenizer:()=>XG,AutoTokenizer:()=>gG,BartTokenizer:()=>ib,BertTokenizer:()=>Dl,BlenderbotSmallTokenizer:()=>PZ,BlenderbotTokenizer:()=>_Z,BloomTokenizer:()=>Qb,CLIPTokenizer:()=>QZ,CamembertTokenizer:()=>sl,CodeGenTokenizer:()=>iZ,CodeLlamaTokenizer:()=>sb,CohereTokenizer:()=>wZ,ConvBertTokenizer:()=>MG,DebertaTokenizer:()=>DG,DebertaV2Tokenizer:()=>Wc,DistilBertTokenizer:()=>qG,ElectraTokenizer:()=>Cl,EsmTokenizer:()=>Yb,FalconTokenizer:()=>qb,GPT2Tokenizer:()=>yc,GPTNeoXTokenizer:()=>_b,GemmaTokenizer:()=>nd,Grok1Tokenizer:()=>hb,HerbertTokenizer:()=>EG,LlamaTokenizer:()=>Lb,M2M100Tokenizer:()=>XZ,MBart50Tokenizer:()=>lb,MBartTokenizer:()=>xG,MPNetTokenizer:()=>Db,MarianTokenizer:()=>Sl,MgpstrTokenizer:()=>le,MobileBertTokenizer:()=>LG,NllbTokenizer:()=>Vb,NougatTokenizer:()=>Jd,PreTrainedTokenizer:()=>Fl,Qwen2Tokenizer:()=>Pb,RoFormerTokenizer:()=>xc,RobertaTokenizer:()=>cc,SiglipTokenizer:()=>HZ,SpeechT5Tokenizer:()=>$Z,SqueezeBertTokenizer:()=>lc,T5Tokenizer:()=>Gc,TokenizerModel:()=>cI,VitsTokenizer:()=>Ie,Wav2Vec2CTCTokenizer:()=>rZ,WhisperTokenizer:()=>Dd,XLMRobertaTokenizer:()=>td,XLMTokenizer:()=>ul,is_chinese_char:()=>Q});var b=l("./src/utils/generic.js"),d=l("./src/utils/core.js"),e=l("./src/utils/hub.js"),t=l("./src/utils/maths.js"),W=l("./src/utils/tensor.js"),n=l("./src/utils/data-structures.js"),s=l("./node_modules/@huggingface/jinja/dist/index.js"),N=l("./src/models/whisper/common_whisper.js");async function m($I,II){let AI=await Promise.all([(0,e.getModelJSON)($I,"tokenizer.json",!0,II),(0,e.getModelJSON)($I,"tokenizer_config.json",!0,II)]);return II.legacy!==null&&(AI[1].legacy=II.legacy),AI}function h($I,II){let AI=[],BI=0;for(let fI of $I.matchAll(II)){let bl=fI[0];BI<fI.index&&AI.push($I.slice(BI,fI.index)),bl.length>0&&AI.push(bl),BI=fI.index+bl.length}return BI<$I.length&&AI.push($I.slice(BI)),AI}function V($I,II=!0){if($I.Regex!==void 0){let AI=$I.Regex.replace(/\\([#&~])/g,"$1");for(let[BI,fI]of T)AI=AI.replaceAll(BI,fI);return new RegExp(AI,"gu")}else if($I.String!==void 0){let AI=(0,d.escapeRegExp)($I.String);return new RegExp(II?AI:`(${AI})`,"gu")}else return console.warn("Unknown pattern type:",$I),null}function X($I){return new Map(Object.entries($I))}function p($I){let II=$I.dims;switch(II.length){case 1:return $I.tolist();case 2:if(II[0]!==1)throw new Error("Unable to decode tensor with `batch size !== 1`. Use `tokenizer.batch_decode(...)` for batched inputs.");return $I.tolist()[0];default:throw new Error(`Expected tensor to have 1-2 dimensions, got ${II.length}.`)}}function F($I){return $I.replace(/ \./g,".").replace(/ \?/g,"?").replace(/ \!/g,"!").replace(/ ,/g,",").replace(/ \' /g,"'").replace(/ n\'t/g,"n't").replace(/ \'m/g,"'m").replace(/ \'s/g,"'s").replace(/ \'ve/g,"'ve").replace(/ \'re/g,"'re")}function a($I){return $I.replace(/\p{M}/gu,"")}function u($I){return a($I.toLowerCase())}function Q($I){return $I>=19968&&$I<=40959||$I>=13312&&$I<=19903||$I>=131072&&$I<=173791||$I>=173824&&$I<=177983||$I>=177984&&$I<=178207||$I>=178208&&$I<=183983||$I>=63744&&$I<=64255||$I>=194560&&$I<=195103}function o($I,II,AI){let BI=[],fI=0;for(;fI<$I.length;){if(BI.push($I[fI]),(II.get($I[fI])??AI)!==AI){++fI;continue}for(;++fI<$I.length&&(II.get($I[fI])??AI)===AI;)II.get(BI.at(-1))!==AI&&(BI[BI.length-1]+=$I[fI])}return BI}function y($I){return $I.match(/\S+/g)||[]}let H="\\p{P}\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E",E=new RegExp(`^[${H}]+$`,"gu"),C=".,!?\u2026\u3002\uFF0C\u3001\u0964\u06D4\u060C",T=new Map([["(?i:'s|'t|'re|'ve|'m|'ll|'d)","(?:'([sS]|[tT]|[rR][eE]|[vV][eE]|[mM]|[lL][lL]|[dD]))"],[` ?[^(\\s|[${C}])]+`,` ?[^\\s${C}]+`]]);class S{constructor(II){this.content=II.content,this.id=II.id,this.single_word=II.single_word??!1,this.lstrip=II.lstrip??!1,this.rstrip=II.rstrip??!1,this.special=II.special??!1,this.normalized=II.normalized??null}}class cI extends b.Callable{constructor(II){super(),this.config=II,this.vocab=[],this.tokens_to_ids=new Map,this.unk_token_id=void 0,this.unk_token=void 0,this.end_of_word_suffix=void 0,this.fuse_unk=this.config.fuse_unk??!1}static fromConfig(II,...AI){switch(II.type){case"WordPiece":return new hI(II);case"Unigram":return new WI(II,...AI);case"BPE":return new ZI(II);default:if(II.vocab)return Array.isArray(II.vocab)?new WI(II,...AI):typeof II.vocab=="object"&&II.continuing_subword_prefix&&II.unk_token?new hI(II):new dI(II,...AI);throw new Error(`Unknown TokenizerModel type: ${II.type}`)}}_call(II){return II=this.encode(II),this.fuse_unk&&(II=o(II,this.tokens_to_ids,this.unk_token_id)),II}encode(II){throw Error("encode should be implemented in subclass.")}convert_tokens_to_ids(II){return II.map(AI=>this.tokens_to_ids.get(AI)??this.unk_token_id)}convert_ids_to_tokens(II){return II.map(AI=>this.vocab[AI]??this.unk_token)}}class hI extends cI{constructor(II){super(II),this.tokens_to_ids=X(II.vocab),this.unk_token_id=this.tokens_to_ids.get(II.unk_token),this.unk_token=II.unk_token,this.max_input_chars_per_word=II.max_input_chars_per_word??100,this.vocab=new Array(this.tokens_to_ids.size);for(let[AI,BI]of this.tokens_to_ids)this.vocab[BI]=AI}encode(II){let AI=[];for(let BI of II){let fI=[...BI];if(fI.length>this.max_input_chars_per_word){AI.push(this.unk_token);continue}let bl=!1,Nl=0,vl=[];for(;Nl<fI.length;){let yl=fI.length,El=null;for(;Nl<yl;){let Hl=fI.slice(Nl,yl).join("");if(Nl>0&&(Hl=this.config.continuing_subword_prefix+Hl),this.tokens_to_ids.has(Hl)){El=Hl;break}--yl}if(El===null){bl=!0;break}vl.push(El),Nl=yl}bl?AI.push(this.unk_token):AI.push(...vl)}return AI}}class WI extends cI{constructor(II,AI){super(II);let BI=II.vocab.length;this.vocab=new Array(BI),this.scores=new Array(BI);for(let fI=0;fI<BI;++fI)[this.vocab[fI],this.scores[fI]]=II.vocab[fI];this.unk_token_id=II.unk_id,this.unk_token=this.vocab[II.unk_id],this.tokens_to_ids=new Map(this.vocab.map((fI,bl)=>[fI,bl])),this.bos_token=" ",this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=AI.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.unk_token=this.vocab[this.unk_token_id],this.minScore=(0,t.min)(this.scores)[0],this.unk_score=this.minScore-10,this.scores[this.unk_token_id]=this.unk_score,this.trie=new n.CharTrie,this.trie.extend(this.vocab),this.fuse_unk=!0}populateNodes(II){let AI=II.chars,BI=1,fI=0;for(;fI<AI.length;){let bl=!1,Nl=[],vl=AI.slice(fI).join(""),yl=this.trie.commonPrefixSearch(vl);for(let El of yl){Nl.push(El);let Hl=this.tokens_to_ids.get(El),rG=this.scores[Hl],dG=(0,d.len)(El);II.insert(fI,dG,rG,Hl),!bl&&dG===BI&&(bl=!0)}bl||II.insert(fI,BI,this.unk_score,this.unk_token_id),fI+=BI}}tokenize(II){let AI=new n.TokenLattice(II,this.bos_token_id,this.eos_token_id);return this.populateNodes(AI),AI.tokens()}encode(II){let AI=[];for(let BI of II){let fI=this.tokenize(BI);AI.push(...fI)}return AI}}let VI=(()=>{let $I=[...Array.from({length:94},(fI,bl)=>bl+33),...Array.from({length:12},(fI,bl)=>bl+161),...Array.from({length:82},(fI,bl)=>bl+174)],II=$I.slice(),AI=0;for(let fI=0;fI<256;++fI)$I.includes(fI)||($I.push(fI),II.push(256+AI),AI+=1);let BI=II.map(fI=>String.fromCharCode(fI));return Object.fromEntries($I.map((fI,bl)=>[fI,BI[bl]]))})(),sI=(0,d.reverseDictionary)(VI);class ZI extends cI{constructor(II){super(II),this.tokens_to_ids=X(II.vocab),this.unk_token_id=this.tokens_to_ids.get(II.unk_token),this.unk_token=II.unk_token,this.vocab=new Array(this.tokens_to_ids.size);for(let[BI,fI]of this.tokens_to_ids)this.vocab[fI]=BI;let AI=Array.isArray(II.merges[0]);this.merges=AI?II.merges:II.merges.map(BI=>BI.split(" ",2)),this.bpe_ranks=new Map(this.merges.map((BI,fI)=>[JSON.stringify(BI),fI])),this.end_of_word_suffix=II.end_of_word_suffix,this.continuing_subword_suffix=II.continuing_subword_suffix??null,this.byte_fallback=this.config.byte_fallback??!1,this.byte_fallback&&(this.text_encoder=new TextEncoder),this.ignore_merges=this.config.ignore_merges??!1,this.cache=new Map}bpe(II){if(II.length===0)return[];let AI=this.cache.get(II);if(AI!==void 0)return AI;let BI=Array.from(II);this.end_of_word_suffix&&(BI[BI.length-1]+=this.end_of_word_suffix);let fI=[];if(BI.length>1){let bl=new n.PriorityQueue((yl,El)=>yl.score<El.score),Nl={token:BI[0],bias:0,prev:null,next:null},vl=Nl;for(let yl=1;yl<BI.length;++yl){let El={bias:yl/BI.length,token:BI[yl],prev:vl,next:null};vl.next=El,this._add_node(bl,vl),vl=El}for(;!bl.isEmpty();){let yl=bl.pop();if(yl.deleted||!yl.next||yl.next.deleted)continue;if(yl.deleted=!0,yl.next.deleted=!0,yl.prev){let Hl={...yl.prev};yl.prev.deleted=!0,yl.prev=Hl,Hl.prev?Hl.prev.next=Hl:Nl=Hl}let El={token:yl.token+yl.next.token,bias:yl.bias,prev:yl.prev,next:yl.next.next};El.prev?(El.prev.next=El,this._add_node(bl,El.prev)):Nl=El,El.next&&(El.next.prev=El,this._add_node(bl,El))}for(let yl=Nl;yl!==null;yl=yl.next)fI.push(yl.token)}else fI=BI;if(this.continuing_subword_suffix)for(let bl=0;bl<fI.length-1;++bl)fI[bl]+=this.continuing_subword_suffix;return this.cache.set(II,fI),fI}_add_node(II,AI){let BI=this.bpe_ranks.get(JSON.stringify([AI.token,AI.next.token]));BI!==void 0&&(AI.score=BI+AI.bias,II.push(AI))}encode(II){let AI=[];for(let BI of II){if(this.ignore_merges&&this.tokens_to_ids.has(BI)){AI.push(BI);continue}let fI=this.bpe(BI);for(let bl of fI)if(this.tokens_to_ids.has(bl))AI.push(bl);else if(this.byte_fallback){let Nl=Array.from(this.text_encoder.encode(bl)).map(vl=>`<0x${vl.toString(16).toUpperCase().padStart(2,"0")}>`);Nl.every(vl=>this.tokens_to_ids.has(vl))?AI.push(...Nl):AI.push(this.unk_token)}else AI.push(this.unk_token)}return AI}}class dI extends cI{constructor(II,AI){super(II),this.tokens_to_ids=X(AI.target_lang?II.vocab[AI.target_lang]:II.vocab),this.bos_token=AI.bos_token,this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=AI.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.pad_token=AI.pad_token,this.pad_token_id=this.tokens_to_ids.get(this.pad_token),this.unk_token=AI.unk_token,this.unk_token_id=this.tokens_to_ids.get(this.unk_token),this.vocab=new Array(this.tokens_to_ids.size);for(let[BI,fI]of this.tokens_to_ids)this.vocab[fI]=BI}encode(II){return II}}class pI extends b.Callable{constructor(II){super(),this.config=II}static fromConfig(II){if(II===null)return null;switch(II.type){case"BertNormalizer":return new bI(II);case"Precompiled":return new PI(II);case"Sequence":return new L(II);case"Replace":return new yI(II);case"NFC":return new eI(II);case"NFKC":return new HI(II);case"NFKD":return new YI(II);case"Strip":return new $(II);case"StripAccents":return new JI(II);case"Lowercase":return new UI(II);case"Prepend":return new zI(II);default:throw new Error(`Unknown Normalizer type: ${II.type}`)}}normalize(II){throw Error("normalize should be implemented in subclass.")}_call(II){return this.normalize(II)}}class yI extends pI{normalize(II){let AI=V(this.config.pattern);return AI===null?II:II.replaceAll(AI,this.config.content)}}class eI extends pI{normalize(II){return II=II.normalize("NFC"),II}}class HI extends pI{normalize(II){return II=II.normalize("NFKC"),II}}class YI extends pI{normalize(II){return II=II.normalize("NFKD"),II}}class $ extends pI{normalize(II){return this.config.strip_left&&this.config.strip_right?II=II.trim():(this.config.strip_left&&(II=II.trimStart()),this.config.strip_right&&(II=II.trimEnd())),II}}class JI extends pI{normalize(II){return II=a(II),II}}class UI extends pI{normalize(II){return II=II.toLowerCase(),II}}class zI extends pI{normalize(II){return II=this.config.prepend+II,II}}class L extends pI{constructor(II){super(II),this.normalizers=II.normalizers.map(AI=>pI.fromConfig(AI))}normalize(II){return this.normalizers.reduce((AI,BI)=>BI.normalize(AI),II)}}class bI extends pI{_tokenize_chinese_chars(II){let AI=[];for(let BI=0;BI<II.length;++BI){let fI=II[BI],bl=fI.charCodeAt(0);Q(bl)?(AI.push(" "),AI.push(fI),AI.push(" ")):AI.push(fI)}return AI.join("")}stripAccents(II){return II.normalize("NFD").replace(/\p{Mn}/gu,"")}_is_control(II){switch(II){case"	":case`
`:case"\r":return!1;default:return/^\p{Cc}|\p{Cf}|\p{Co}|\p{Cs}$/u.test(II)}}_clean_text(II){let AI=[];for(let BI of II){let fI=BI.charCodeAt(0);fI===0||fI===65533||this._is_control(BI)||(/^\s$/.test(BI)?AI.push(" "):AI.push(BI))}return AI.join("")}normalize(II){return this.config.clean_text&&(II=this._clean_text(II)),this.config.handle_chinese_chars&&(II=this._tokenize_chinese_chars(II)),this.config.lowercase?(II=II.toLowerCase(),this.config.strip_accents!==!1&&(II=this.stripAccents(II))):this.config.strip_accents&&(II=this.stripAccents(II)),II}}class FI extends b.Callable{static fromConfig(II){if(II===null)return null;switch(II.type){case"BertPreTokenizer":return new U(II);case"Sequence":return new KI(II);case"Whitespace":return new jI(II);case"WhitespaceSplit":return new Wl(II);case"Metaspace":return new nl(II);case"ByteLevel":return new k(II);case"Split":return new w(II);case"Punctuation":return new r(II);case"Digits":return new A(II);case"Replace":return new wl(II);default:throw new Error(`Unknown PreTokenizer type: ${II.type}`)}}pre_tokenize_text(II,AI){throw Error("pre_tokenize_text should be implemented in subclass.")}pre_tokenize(II,AI){return(Array.isArray(II)?II.map(BI=>this.pre_tokenize_text(BI,AI)):this.pre_tokenize_text(II,AI)).flat()}_call(II,AI){return this.pre_tokenize(II,AI)}}class U extends FI{constructor(II){super(),this.pattern=new RegExp(`[^\\s${H}]+|[${H}]`,"gu")}pre_tokenize_text(II,AI){return II.trim().match(this.pattern)||[]}}class k extends FI{constructor(II){super(),this.config=II,this.add_prefix_space=this.config.add_prefix_space,this.trim_offsets=this.config.trim_offsets,this.use_regex=this.config.use_regex??!0,this.pattern=/'s|'t|'re|'ve|'m|'ll|'d| ?\p{L}+| ?\p{N}+| ?[^\s\p{L}\p{N}]+|\s+(?!\S)|\s+/gu,this.byte_encoder=VI,this.text_encoder=new TextEncoder}pre_tokenize_text(II,AI){return this.add_prefix_space&&!II.startsWith(" ")&&(II=" "+II),(this.use_regex?II.match(this.pattern)||[]:[II]).map(fI=>Array.from(this.text_encoder.encode(fI),bl=>this.byte_encoder[bl]).join(""))}}class w extends FI{constructor(II){super(),this.config=II,this.pattern=V(this.config.pattern,this.config.invert)}pre_tokenize_text(II,AI){return this.pattern===null?[]:this.config.invert?II.match(this.pattern)||[]:this.config.behavior?.toLowerCase()==="removed"?II.split(this.pattern).filter(BI=>BI):h(II,this.pattern)}}class r extends FI{constructor(II){super(),this.config=II,this.pattern=new RegExp(`[^${H}]+|[${H}]+`,"gu")}pre_tokenize_text(II,AI){return II.match(this.pattern)||[]}}class A extends FI{constructor(II){super(),this.config=II;let AI=`[^\\d]+|\\d${this.config.individual_digits?"":"+"}`;this.pattern=new RegExp(AI,"gu")}pre_tokenize_text(II,AI){return II.match(this.pattern)||[]}}class O extends b.Callable{constructor(II){super(),this.config=II}static fromConfig(II){if(II===null)return null;switch(II.type){case"TemplateProcessing":return new GI(II);case"ByteLevel":return new tI(II);case"RobertaProcessing":return new q(II);case"BertProcessing":return new K(II);case"Sequence":return new iI(II);default:throw new Error(`Unknown PostProcessor type: ${II.type}`)}}post_process(II,...AI){throw Error("post_process should be implemented in subclass.")}_call(II,...AI){return this.post_process(II,...AI)}}class K extends O{constructor(II){super(II),this.cls=II.cls[0],this.sep=II.sep[0]}post_process(II,AI=null,{add_special_tokens:BI=!0}={}){BI&&(II=(0,d.mergeArrays)([this.cls],II,[this.sep]));let fI=new Array(II.length).fill(0);if(AI!==null){let bl=BI&&this instanceof q?[this.sep]:[],Nl=BI?[this.sep]:[];II=(0,d.mergeArrays)(II,bl,AI,Nl),fI=(0,d.mergeArrays)(fI,new Array(AI.length+bl.length+Nl.length).fill(1))}return{tokens:II,token_type_ids:fI}}}class q extends K{}class GI extends O{constructor(II){super(II),this.single=II.single,this.pair=II.pair}post_process(II,AI=null,{add_special_tokens:BI=!0}={}){let fI=AI===null?this.single:this.pair,bl=[],Nl=[];for(let vl of fI)"SpecialToken"in vl?BI&&(bl.push(vl.SpecialToken.id),Nl.push(vl.SpecialToken.type_id)):"Sequence"in vl&&(vl.Sequence.id==="A"?(bl=(0,d.mergeArrays)(bl,II),Nl=(0,d.mergeArrays)(Nl,new Array(II.length).fill(vl.Sequence.type_id))):vl.Sequence.id==="B"&&(bl=(0,d.mergeArrays)(bl,AI),Nl=(0,d.mergeArrays)(Nl,new Array(AI.length).fill(vl.Sequence.type_id))));return{tokens:bl,token_type_ids:Nl}}}class tI extends O{post_process(II,AI=null){return AI&&(II=(0,d.mergeArrays)(II,AI)),{tokens:II}}}class iI extends O{constructor(II){super(II),this.processors=II.processors.map(AI=>O.fromConfig(AI))}post_process(II,AI=null,BI={}){let fI;for(let bl of this.processors)if(bl instanceof tI)II=bl.post_process(II).tokens,AI&&(AI=bl.post_process(AI).tokens);else{let Nl=bl.post_process(II,AI,BI);II=Nl.tokens,fI=Nl.token_type_ids}return{tokens:II,token_type_ids:fI}}}class B extends b.Callable{constructor(II){super(),this.config=II,this.added_tokens=[],this.end_of_word_suffix=null,this.trim_offsets=II.trim_offsets}static fromConfig(II){if(II===null)return null;switch(II.type){case"WordPiece":return new OI(II);case"Metaspace":return new ol(II);case"ByteLevel":return new uI(II);case"Replace":return new aI(II);case"ByteFallback":return new lI(II);case"Fuse":return new QI(II);case"Strip":return new vI(II);case"Sequence":return new kI(II);case"CTC":return new wI(II);case"BPEDecoder":return new TI(II);default:throw new Error(`Unknown Decoder type: ${II.type}`)}}_call(II){return this.decode(II)}decode(II){return this.decode_chain(II).join("")}decode_chain(II){throw Error("`decode_chain` should be implemented in subclass.")}}class aI extends B{decode_chain(II){let AI=V(this.config.pattern);return AI===null?II:II.map(BI=>BI.replaceAll(AI,this.config.content))}}class lI extends B{constructor(II){super(II),this.text_decoder=new TextDecoder}decode_chain(II){let AI=[],BI=[];for(let fI of II){let bl=null;if(fI.length===6&&fI.startsWith("<0x")&&fI.endsWith(">")){let Nl=parseInt(fI.slice(3,5),16);isNaN(Nl)||(bl=Nl)}if(bl!==null)BI.push(bl);else{if(BI.length>0){let Nl=this.text_decoder.decode(Uint8Array.from(BI));AI.push(Nl),BI=[]}AI.push(fI)}}if(BI.length>0){let fI=this.text_decoder.decode(Uint8Array.from(BI));AI.push(fI),BI=[]}return AI}}class QI extends B{decode_chain(II){return[II.join("")]}}class vI extends B{constructor(II){super(II),this.content=this.config.content,this.start=this.config.start,this.stop=this.config.stop}decode_chain(II){return II.map(AI=>{let BI=0;for(let bl=0;bl<this.start&&AI[bl]===this.content;++bl){BI=bl+1;continue}let fI=AI.length;for(let bl=0;bl<this.stop;++bl){let Nl=AI.length-bl-1;if(AI[Nl]===this.content){fI=Nl;continue}else break}return AI.slice(BI,fI)})}}class OI extends B{constructor(II){super(II),this.cleanup=II.cleanup}decode_chain(II){return II.map((AI,BI)=>(BI!==0&&(AI.startsWith(this.config.prefix)?AI=AI.replace(this.config.prefix,""):AI=" "+AI),this.cleanup&&(AI=F(AI)),AI))}}class uI extends B{constructor(II){super(II),this.byte_decoder=sI,this.text_decoder=new TextDecoder("utf-8",{fatal:!1,ignoreBOM:!0}),this.end_of_word_suffix=null}convert_tokens_to_string(II){let AI=II.join(""),BI=new Uint8Array([...AI].map(bl=>this.byte_decoder[bl]));return this.text_decoder.decode(BI)}decode_chain(II){let AI=[],BI=[];for(let fI of II)this.added_tokens.find(bl=>bl.content===fI)!==void 0?(BI.length>0&&(AI.push(this.convert_tokens_to_string(BI)),BI=[]),AI.push(fI)):BI.push(fI);return BI.length>0&&AI.push(this.convert_tokens_to_string(BI)),AI}}class wI extends B{constructor(II){super(II),this.pad_token=this.config.pad_token,this.word_delimiter_token=this.config.word_delimiter_token,this.cleanup=this.config.cleanup}convert_tokens_to_string(II){if(II.length===0)return"";let AI=[II[0]];for(let bl=1;bl<II.length;++bl)II[bl]!==AI.at(-1)&&AI.push(II[bl]);let fI=AI.filter(bl=>bl!==this.pad_token).join("");return this.cleanup&&(fI=F(fI).replaceAll(this.word_delimiter_token," ").trim()),fI}decode_chain(II){return[this.convert_tokens_to_string(II)]}}class kI extends B{constructor(II){super(II),this.decoders=II.decoders.map(AI=>B.fromConfig(AI))}decode_chain(II){return this.decoders.reduce((AI,BI)=>BI.decode_chain(AI),II)}}class TI extends B{constructor(II){super(II),this.suffix=this.config.suffix}decode_chain(II){return II.map((AI,BI)=>AI.replaceAll(this.suffix,BI===II.length-1?"":" "))}}class Il extends B{decode_chain(II){let AI="";for(let BI=1;BI<II.length;BI+=2)AI+=II[BI];return[AI]}}class nl extends FI{constructor(II){super(),this.addPrefixSpace=II.add_prefix_space,this.replacement=II.replacement,this.strRep=II.str_rep||this.replacement,this.prepend_scheme=II.prepend_scheme??"always"}pre_tokenize_text(II,{section_index:AI=void 0}={}){let BI=II.replaceAll(" ",this.strRep);return this.addPrefixSpace&&!BI.startsWith(this.replacement)&&(this.prepend_scheme==="always"||this.prepend_scheme==="first"&&AI===0)&&(BI=this.strRep+BI),[BI]}}class ol extends B{constructor(II){super(II),this.addPrefixSpace=II.add_prefix_space,this.replacement=II.replacement}decode_chain(II){let AI=[];for(let BI=0;BI<II.length;++BI){let fI=II[BI].replaceAll(this.replacement," ");this.addPrefixSpace&&BI==0&&fI.startsWith(" ")&&(fI=fI.substring(1)),AI.push(fI)}return AI}}class PI extends pI{constructor(II){super(II),this.charsmap=II.precompiled_charsmap}normalize(II){return II=II.replace(/[\u0001-\u0008\u000B\u000E-\u001F\u007F\u008F\u009F]/gm,""),II=II.replace(/[\u0009\u000A\u000C\u000D\u00A0\u1680\u2000-\u200F\u2028\u2029\u202F\u205F\u2581\u3000\uFEFF\uFFFD]/gm," "),II.includes("\uFF5E")?II=II.split("\uFF5E").map(BI=>BI.normalize("NFKC")).join("\uFF5E"):II=II.normalize("NFKC"),II}}class KI extends FI{constructor(II){super(),this.tokenizers=II.pretokenizers.map(AI=>FI.fromConfig(AI))}pre_tokenize_text(II,AI){return this.tokenizers.reduce((BI,fI)=>fI.pre_tokenize(BI,AI),[II])}}class jI extends FI{constructor(II){super()}pre_tokenize_text(II,AI){return II.match(/\w+|[^\w\s]+/g)||[]}}class Wl extends FI{constructor(II){super()}pre_tokenize_text(II,AI){return y(II)}}class wl extends FI{constructor(II){super(),this.config=II,this.pattern=V(this.config.pattern),this.content=this.config.content}pre_tokenize_text(II,AI){return this.pattern===null?[II]:[II.replaceAll(this.pattern,this.config.content)]}}let Ol=["bos_token","eos_token","unk_token","sep_token","pad_token","cls_token","mask_token"];function jl($I,II,AI,BI){for(let fI of Object.keys($I)){let bl=II-$I[fI].length,Nl=AI(fI),vl=new Array(bl).fill(Nl);$I[fI]=BI==="right"?(0,d.mergeArrays)($I[fI],vl):(0,d.mergeArrays)(vl,$I[fI])}}function NG($I,II){for(let AI of Object.keys($I))$I[AI].length=II}class Fl extends b.Callable{return_token_type_ids=!1;padding_side="right";constructor(II,AI){super(),this._tokenizer_config=AI,this.normalizer=pI.fromConfig(II.normalizer),this.pre_tokenizer=FI.fromConfig(II.pre_tokenizer),this.model=cI.fromConfig(II.model,AI),this.post_processor=O.fromConfig(II.post_processor),this.decoder=B.fromConfig(II.decoder),this.special_tokens=[],this.all_special_ids=[],this.added_tokens=[];for(let BI of II.added_tokens){let fI=new S(BI);this.added_tokens.push(fI),this.model.tokens_to_ids.set(fI.content,fI.id),this.model.vocab[fI.id]=fI.content,fI.special&&(this.special_tokens.push(fI.content),this.all_special_ids.push(fI.id))}if(this.additional_special_tokens=AI.additional_special_tokens??[],this.special_tokens.push(...this.additional_special_tokens),this.special_tokens=[...new Set(this.special_tokens)],this.decoder&&(this.decoder.added_tokens=this.added_tokens,this.decoder.end_of_word_suffix=this.model.end_of_word_suffix),this.added_tokens_regex=this.added_tokens.length>0?new RegExp(this.added_tokens.slice().sort((BI,fI)=>fI.content.length-BI.content.length).map(BI=>`${BI.lstrip?"\\s*":""}(${(0,d.escapeRegExp)(BI.content)})${BI.rstrip?"\\s*":""}`).join("|")):null,this.mask_token=this.getToken("mask_token"),this.mask_token_id=this.model.tokens_to_ids.get(this.mask_token),this.pad_token=this.getToken("pad_token","eos_token"),this.pad_token_id=this.model.tokens_to_ids.get(this.pad_token),this.sep_token=this.getToken("sep_token"),this.sep_token_id=this.model.tokens_to_ids.get(this.sep_token),this.unk_token=this.getToken("unk_token"),this.unk_token_id=this.model.tokens_to_ids.get(this.unk_token),this.bos_token=this.getToken("bos_token"),this.bos_token_id=this.model.tokens_to_ids.get(this.bos_token),this.eos_token=this.getToken("eos_token"),this.eos_token_id=this.model.tokens_to_ids.get(this.eos_token),this.model_max_length=AI.model_max_length,this.remove_space=AI.remove_space,this.clean_up_tokenization_spaces=AI.clean_up_tokenization_spaces??!0,this.do_lowercase_and_remove_accent=AI.do_lowercase_and_remove_accent??!1,AI.padding_side&&(this.padding_side=AI.padding_side),this.legacy=!1,this.chat_template=AI.chat_template??null,Array.isArray(this.chat_template)){let BI=Object.create(null);for(let{name:fI,template:bl}of this.chat_template){if(typeof fI!="string"||typeof bl!="string")throw new Error('Chat template must be a list of objects with "name" and "template" properties');BI[fI]=bl}this.chat_template=BI}this._compiled_template_cache=new Map}getToken(...II){for(let AI of II){let BI=this._tokenizer_config[AI];if(BI)if(typeof BI=="object"){if(BI.__type==="AddedToken")return BI.content;throw Error(`Unknown token: ${BI}`)}else return BI}return null}static async from_pretrained(II,{progress_callback:AI=null,config:BI=null,cache_dir:fI=null,local_files_only:bl=!1,revision:Nl="main",legacy:vl=null}={}){let yl=await m(II,{progress_callback:AI,config:BI,cache_dir:fI,local_files_only:bl,revision:Nl,legacy:vl});return new this(...yl)}_call(II,{text_pair:AI=null,add_special_tokens:BI=!0,padding:fI=!1,truncation:bl=null,max_length:Nl=null,return_tensor:vl=!0,return_token_type_ids:yl=null}={}){let El=Array.isArray(II),Hl;if(El){if(II.length===0)throw Error("text array must be non-empty");if(AI!==null){if(Array.isArray(AI)){if(II.length!==AI.length)throw Error("text and text_pair must have the same length")}else throw Error("text_pair must also be an array");Hl=II.map((dG,bc)=>this._encode_plus(dG,{text_pair:AI[bc],add_special_tokens:BI,return_token_type_ids:yl}))}else Hl=II.map(dG=>this._encode_plus(dG,{add_special_tokens:BI,return_token_type_ids:yl}))}else{if(II==null)throw Error("text may not be null or undefined");if(Array.isArray(AI))throw Error("When specifying `text_pair`, since `text` is a string, `text_pair` must also be a string (i.e., not an array).");Hl=[this._encode_plus(II,{text_pair:AI,add_special_tokens:BI,return_token_type_ids:yl})]}if(Nl===null?fI==="max_length"?Nl=this.model_max_length:Nl=(0,t.max)(Hl.map(dG=>dG.input_ids.length))[0]:bl||console.warn("Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation=true` to explicitly truncate examples to max length."),Nl=Math.min(Nl,this.model_max_length??1/0),fI||bl)for(let dG=0;dG<Hl.length;++dG)Hl[dG].input_ids.length!==Nl&&(Hl[dG].input_ids.length>Nl?bl&&NG(Hl[dG],Nl):fI&&jl(Hl[dG],Nl,bc=>bc==="input_ids"?this.pad_token_id:0,this.padding_side));let rG={};if(vl){if(!(fI&&bl)&&Hl.some(bc=>{for(let zc of Object.keys(bc))if(bc[zc].length!==Hl[0][zc]?.length)return!0;return!1}))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=true' and 'truncation=true' to have batched tensors with the same length.");let dG=[Hl.length,Hl[0].input_ids.length];for(let bc of Object.keys(Hl[0]))rG[bc]=new W.Tensor("int64",BigInt64Array.from(Hl.flatMap(zc=>zc[bc]).map(BigInt)),dG)}else{for(let dG of Object.keys(Hl[0]))rG[dG]=Hl.map(bc=>bc[dG]);if(!El)for(let dG of Object.keys(rG))rG[dG]=rG[dG][0]}return rG}_encode_text(II){return II===null?null:(this.added_tokens_regex?II.split(this.added_tokens_regex).filter(fI=>fI):[II]).map((fI,bl)=>{if(this.added_tokens.find(vl=>vl.content===fI)!==void 0)return fI;{if(this.remove_space===!0&&(fI=fI.trim().split(/\s+/).join(" ")),this.do_lowercase_and_remove_accent&&(fI=u(fI)),this.normalizer!==null&&(fI=this.normalizer(fI)),fI.length===0)return[];let vl=this.pre_tokenizer!==null?this.pre_tokenizer(fI,{section_index:bl}):[fI];return this.model(vl)}}).flat()}_encode_plus(II,{text_pair:AI=null,add_special_tokens:BI=!0,return_token_type_ids:fI=null}={}){let{tokens:bl,token_type_ids:Nl}=this._tokenize_helper(II,{pair:AI,add_special_tokens:BI}),vl=this.model.convert_tokens_to_ids(bl),yl={input_ids:vl,attention_mask:new Array(vl.length).fill(1)};return(fI??this.return_token_type_ids)&&Nl&&(yl.token_type_ids=Nl),yl}_tokenize_helper(II,{pair:AI=null,add_special_tokens:BI=!1}={}){let fI=this._encode_text(II),bl=this._encode_text(AI);return this.post_processor?this.post_processor(fI,bl,{add_special_tokens:BI}):{tokens:(0,d.mergeArrays)(fI??[],bl??[])}}tokenize(II,{pair:AI=null,add_special_tokens:BI=!1}={}){return this._tokenize_helper(II,{pair:AI,add_special_tokens:BI}).tokens}encode(II,{text_pair:AI=null,add_special_tokens:BI=!0,return_token_type_ids:fI=null}={}){return this._encode_plus(II,{text_pair:AI,add_special_tokens:BI,return_token_type_ids:fI}).input_ids}batch_decode(II,AI={}){return II instanceof W.Tensor&&(II=II.tolist()),II.map(BI=>this.decode(BI,AI))}decode(II,AI={}){if(II instanceof W.Tensor&&(II=p(II)),!Array.isArray(II)||II.length===0||!(0,d.isIntegralNumber)(II[0]))throw Error("token_ids must be a non-empty array of integers.");return this.decode_single(II,AI)}decode_single(II,{skip_special_tokens:AI=!1,clean_up_tokenization_spaces:BI=null}){let fI=this.model.convert_ids_to_tokens(II);AI&&(fI=fI.filter(Nl=>!this.special_tokens.includes(Nl)));let bl=this.decoder?this.decoder(fI):fI.join(" ");return this.decoder&&this.decoder.end_of_word_suffix&&(bl=bl.replaceAll(this.decoder.end_of_word_suffix," "),AI&&(bl=bl.trim())),(BI??this.clean_up_tokenization_spaces)&&(bl=F(bl)),bl}get_chat_template({chat_template:II=null,tools:AI=null}={}){if(this.chat_template&&typeof this.chat_template=="object"){let BI=this.chat_template;if(II!==null&&Object.hasOwn(BI,II))II=BI[II];else if(II===null)if(AI!==null&&"tool_use"in BI)II=BI.tool_use;else if("default"in BI)II=BI.default;else throw Error(`This model has multiple chat templates with no default specified! Please either pass a chat template or the name of the template you wish to use to the 'chat_template' argument. Available template names are ${Object.keys(BI).sort()}.`)}else if(II===null)if(this.chat_template)II=this.chat_template;else throw Error("Cannot use apply_chat_template() because tokenizer.chat_template is not set and no template argument was passed! For information about writing templates and setting the tokenizer.chat_template attribute, please see the documentation at https://huggingface.co/docs/transformers/main/en/chat_templating");return II}apply_chat_template(II,{tools:AI=null,documents:BI=null,chat_template:fI=null,add_generation_prompt:bl=!1,tokenize:Nl=!0,padding:vl=!1,truncation:yl=!1,max_length:El=null,return_tensor:Hl=!0,return_dict:rG=!1,tokenizer_kwargs:dG={},...bc}={}){if(fI=this.get_chat_template({chat_template:fI,tools:AI}),typeof fI!="string")throw Error(`chat_template must be a string, but got ${typeof fI}`);let zc=this._compiled_template_cache.get(fI);zc===void 0&&(zc=new s.Template(fI),this._compiled_template_cache.set(fI,zc));let lG=Object.create(null);for(let Uc of Ol){let _c=this.getToken(Uc);_c&&(lG[Uc]=_c)}let vG=zc.render({messages:II,add_generation_prompt:bl,tools:AI,documents:BI,...lG,...bc});if(Nl){let Uc=this._call(vG,{add_special_tokens:!1,padding:vl,truncation:yl,max_length:El,return_tensor:Hl,...dG});return rG?Uc:Uc.input_ids}return vG}}class Dl extends Fl{return_token_type_ids=!0}class XG extends Fl{return_token_type_ids=!0}class LG extends Fl{return_token_type_ids=!0}class lc extends Fl{return_token_type_ids=!0}class DG extends Fl{return_token_type_ids=!0}class Wc extends Fl{return_token_type_ids=!0}class EG extends Fl{return_token_type_ids=!0}class MG extends Fl{return_token_type_ids=!0}class xc extends Fl{return_token_type_ids=!0}class qG extends Fl{}class sl extends Fl{}class ul extends Fl{return_token_type_ids=!0;constructor(II,AI){super(II,AI),console.warn('WARNING: `XLMTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}}class Cl extends Fl{return_token_type_ids=!0}class Gc extends Fl{}class yc extends Fl{}class ib extends Fl{}class xG extends Fl{constructor(II,AI){super(II,AI),this.languageRegex=/^[a-z]{2}_[A-Z]{2}$/,this.language_codes=this.special_tokens.filter(BI=>this.languageRegex.test(BI)),this.lang_to_token=BI=>BI}_build_translation_inputs(II,AI,BI){return kb(this,II,AI,BI)}}class lb extends xG{}class cc extends Fl{}class Qb extends Fl{}let YG="\u2581";class Lb extends Fl{padding_side="left";constructor(II,AI){super(II,AI),this.legacy=AI.legacy??!0,this.legacy||(this.normalizer=null,this.pre_tokenizer=new nl({replacement:YG,add_prefix_space:!0,prepend_scheme:"first"}))}_encode_text(II){if(II===null)return null;if(this.legacy||II.length===0)return super._encode_text(II);let AI=super._encode_text(YG+II.replaceAll(YG," "));return AI.length>1&&AI[0]===YG&&this.special_tokens.includes(AI[1])&&(AI=AI.slice(1)),AI}}class sb extends Fl{}class td extends Fl{}class Db extends Fl{}class qb extends Fl{}class _b extends Fl{}class Yb extends Fl{}class Pb extends Fl{}class nd extends Fl{}class hb extends Fl{}function kb($I,II,AI,BI){if(!("language_codes"in $I)||!Array.isArray($I.language_codes))throw new Error("Tokenizer must have `language_codes` attribute set and it should be an array of language ids.");if(!("languageRegex"in $I)||!($I.languageRegex instanceof RegExp))throw new Error("Tokenizer must have `languageRegex` attribute set and it should be a regular expression.");if(!("lang_to_token"in $I)||typeof $I.lang_to_token!="function")throw new Error("Tokenizer must have `lang_to_token` attribute set and it should be a function.");let fI=BI.src_lang,bl=BI.tgt_lang;if(!$I.language_codes.includes(bl))throw new Error(`Target language code "${bl}" is not valid. Must be one of: {${$I.language_codes.join(", ")}}`);if(fI!==void 0){if(!$I.language_codes.includes(fI))throw new Error(`Source language code "${fI}" is not valid. Must be one of: {${$I.language_codes.join(", ")}}`);for(let Nl of $I.post_processor.config.single)if("SpecialToken"in Nl&&$I.languageRegex.test(Nl.SpecialToken.id)){Nl.SpecialToken.id=$I.lang_to_token(fI);break}}return BI.forced_bos_token_id=$I.model.convert_tokens_to_ids([$I.lang_to_token(bl)])[0],$I._call(II,AI)}class Vb extends Fl{constructor(II,AI){super(II,AI),this.languageRegex=/^[a-z]{3}_[A-Z][a-z]{3}$/,this.language_codes=this.special_tokens.filter(BI=>this.languageRegex.test(BI)),this.lang_to_token=BI=>BI}_build_translation_inputs(II,AI,BI){return kb(this,II,AI,BI)}}class XZ extends Fl{constructor(II,AI){super(II,AI),this.languageRegex=/^__[a-z]{2,3}__$/,this.language_codes=this.special_tokens.filter(BI=>this.languageRegex.test(BI)).map(BI=>BI.slice(2,-2)),this.lang_to_token=BI=>`__${BI}__`}_build_translation_inputs(II,AI,BI){return kb(this,II,AI,BI)}}class Dd extends Fl{get timestamp_begin(){return this.model.convert_tokens_to_ids(["<|notimestamps|>"])[0]+1}_decode_asr(II,{return_timestamps:AI=!1,return_language:BI=!1,time_precision:fI=null,force_full_sequences:bl=!0}={}){if(fI===null)throw Error("Must specify time_precision");let Nl=null,vl=AI==="word";function yl(){return{language:Nl,timestamp:[null,null],text:""}}let El=[],Hl=yl(),rG=0,dG=this.timestamp_begin,zc=dG+1500,lG=[],vG=[],Uc=!1,_c=null,dl=new Set(this.all_special_ids);for(let tc of II){let Mc=tc.tokens,Kl=vl?tc.token_timestamps:null,ab=null,xb=dG;if("stride"in tc){let[gl,ZG,Rc]=tc.stride;if(rG-=ZG,_c=gl-Rc,ZG&&(xb=ZG/fI+dG),Rc)for(let mc=Mc.length-1;mc>=0;--mc){let gc=Number(Mc[mc]);if(gc>=dG){if(ab!==null&&(gc-dG)*fI<_c)break;ab=gc}}}let kG=[],nc=[];for(let gl=0;gl<Mc.length;++gl){let ZG=Number(Mc[gl]);if(dl.has(ZG)){let Rc=this.decode([ZG]),mc=N.WHISPER_LANGUAGE_MAPPING.get(Rc.slice(2,-2));if(mc!==void 0){if(Nl!==null&&mc!==Nl&&!AI){lG.push(kG);let gc=this.findLongestCommonSequence(lG)[0],Ll=this.decode(gc);Hl.text=Ll,El.push(Hl),lG=[],kG=[],Hl=yl()}Nl=Hl.language=mc}}else if(ZG>=dG&&ZG<=zc){let Rc=(ZG-dG)*fI+rG,mc=(0,t.round)(Rc,2);if(ab!==null&&ZG>=ab)Uc=!0;else if(Uc||lG.length>0&&ZG<xb)Uc=!1;else if(Hl.timestamp[0]===null)Hl.timestamp[0]=mc;else if(mc!==Hl.timestamp[0]){Hl.timestamp[1]=mc,lG.push(kG),vl&&vG.push(nc);let[gc,Ll]=this.findLongestCommonSequence(lG,vG),qd=this.decode(gc);Hl.text=qd,vl&&(Hl.words=this.collateWordTimestamps(gc,Ll,Nl)),El.push(Hl),lG=[],kG=[],vG=[],nc=[],Hl=yl()}}else if(kG.push(ZG),vl){let Rc=(0,t.round)(Kl[gl]+rG,2),mc;if(gl+1<Kl.length){mc=(0,t.round)(Kl[gl+1]+rG,2);let gc=this.decode([ZG]);E.test(gc)&&(mc=(0,t.round)(Math.min(Rc+fI,mc),2))}else mc=null;nc.push([Rc,mc])}}if("stride"in tc){let[gl,ZG,Rc]=tc.stride;rG+=gl-Rc}kG.length>0?(lG.push(kG),vl&&vG.push(nc)):lG.every(gl=>gl.length===0)&&(Hl=yl(),lG=[],kG=[],vG=[],nc=[])}if(lG.length>0){if(bl&&AI)throw new Error("Whisper did not predict an ending timestamp, which can happen if audio is cut off in the middle of a word. Also make sure WhisperTimeStampLogitsProcessor was used during generation.");let[tc,Mc]=this.findLongestCommonSequence(lG,vG),Kl=this.decode(tc);Hl.text=Kl,vl&&(Hl.words=this.collateWordTimestamps(tc,Mc,Nl)),El.push(Hl)}let Tc=Object.create(null),md=El.map(tc=>tc.text).join("");if(AI||BI){for(let tc=0;tc<El.length;++tc){let Mc=El[tc];AI||delete Mc.timestamp,BI||delete Mc.language}if(vl){let tc=[];for(let Mc of El)for(let Kl of Mc.words)tc.push(Kl);Tc={chunks:tc}}else Tc={chunks:El}}return[md,Tc]}findLongestCommonSequence(II,AI=null){let BI=II[0],fI=BI.length,bl=[],Nl=Array.isArray(AI)&&AI.length>0,vl=Nl?[]:null,yl=Nl?AI[0]:null;for(let El=1;El<II.length;++El){let Hl=II[El],rG=0,dG=[fI,fI,0,0],bc=Hl.length;for(let Tc=1;Tc<fI+bc;++Tc){let md=Math.max(0,fI-Tc),tc=Math.min(fI,fI+bc-Tc),Mc=BI.slice(md,tc),Kl=Math.max(0,Tc-fI),ab=Math.min(bc,Tc),xb=Hl.slice(Kl,ab);if(Mc.length!==xb.length)throw new Error("There is a bug within whisper `decode_asr` function, please report it. Dropping to prevent bad inference.");let kG;Nl?kG=Mc.filter((ZG,Rc)=>ZG===xb[Rc]&&yl[md+Rc]<=AI[El][Kl+Rc]).length:kG=Mc.filter((ZG,Rc)=>ZG===xb[Rc]).length;let nc=Tc/1e4,gl=kG/Tc+nc;kG>1&&gl>rG&&(rG=gl,dG=[md,tc,Kl,ab])}let[zc,lG,vG,Uc]=dG,_c=Math.floor((lG+zc)/2),dl=Math.floor((Uc+vG)/2);bl.push(...BI.slice(0,_c)),BI=Hl.slice(dl),fI=BI.length,Nl&&(vl.push(...yl.slice(0,_c)),yl=AI[El].slice(dl))}return bl.push(...BI),Nl?(vl.push(...yl),[bl,vl]):[bl,[]]}collateWordTimestamps(II,AI,BI){let[fI,bl,Nl]=this.combineTokensIntoWords(II,BI),vl=[];for(let yl=0;yl<fI.length;++yl){let El=Nl[yl];vl.push({text:fI[yl],timestamp:[AI[El.at(0)][0],AI[El.at(-1)][1]]})}return vl}combineTokensIntoWords(II,AI,BI=`"'\u201C\xA1\xBF([{-`,fI=`"'.\u3002,\uFF0C!\uFF01?\uFF1F:\uFF1A\u201D)]}\u3001`){AI=AI??"english";let bl,Nl,vl;return["chinese","japanese","thai","lao","myanmar"].includes(AI)?[bl,Nl,vl]=this.splitTokensOnUnicode(II):[bl,Nl,vl]=this.splitTokensOnSpaces(II),this.mergePunctuations(bl,Nl,vl,BI,fI)}decode(II,AI){let BI;return AI?.decode_with_timestamps?(II instanceof W.Tensor&&(II=p(II)),BI=this.decodeWithTimestamps(II,AI)):BI=super.decode(II,AI),BI}decodeWithTimestamps(II,AI){let BI=AI?.time_precision??.02,fI=Array.from(this.all_special_ids).at(-1)+1,bl=[[]];for(let Nl of II)if(Nl=Number(Nl),Nl>=fI){let vl=((Nl-fI)*BI).toFixed(2);bl.push(`<|${vl}|>`),bl.push([])}else bl[bl.length-1].push(Nl);return bl=bl.map(Nl=>typeof Nl=="string"?Nl:super.decode(Nl,AI)),bl.join("")}splitTokensOnUnicode(II){let AI=this.decode(II,{decode_with_timestamps:!0}),BI="\uFFFD",fI=[],bl=[],Nl=[],vl=[],yl=[],El=0;for(let Hl=0;Hl<II.length;++Hl){let rG=II[Hl];vl.push(rG),yl.push(Hl);let dG=this.decode(vl,{decode_with_timestamps:!0});(!dG.includes(BI)||AI[El+dG.indexOf(BI)]===BI)&&(fI.push(dG),bl.push(vl),Nl.push(yl),vl=[],yl=[],El+=dG.length)}return[fI,bl,Nl]}splitTokensOnSpaces(II){let[AI,BI,fI]=this.splitTokensOnUnicode(II),bl=[],Nl=[],vl=[],yl=new RegExp(`^[${H}]$`,"gu");for(let El=0;El<AI.length;++El){let Hl=AI[El],rG=BI[El],dG=fI[El],bc=rG[0]>=this.model.tokens_to_ids.get("<|endoftext|>"),zc=Hl.startsWith(" "),lG=Hl.trim(),vG=yl.test(lG);if(bc||zc||vG||bl.length===0)bl.push(Hl),Nl.push(rG),vl.push(dG);else{let Uc=bl.length-1;bl[Uc]+=Hl,Nl[Uc].push(...rG),vl[Uc].push(...dG)}}return[bl,Nl,vl]}mergePunctuations(II,AI,BI,fI,bl){let Nl=structuredClone(II),vl=structuredClone(AI),yl=structuredClone(BI),El=Nl.length-2,Hl=Nl.length-1;for(;El>=0;)Nl[El].startsWith(" ")&&fI.includes(Nl[El].trim())?(Nl[Hl]=Nl[El]+Nl[Hl],vl[Hl]=(0,d.mergeArrays)(vl[El],vl[Hl]),yl[Hl]=(0,d.mergeArrays)(yl[El],yl[Hl]),Nl[El]="",vl[El]=[],yl[El]=[]):Hl=El,--El;for(El=0,Hl=1;Hl<Nl.length;)!Nl[El].endsWith(" ")&&bl.includes(Nl[Hl])?(Nl[El]+=Nl[Hl],vl[El]=(0,d.mergeArrays)(vl[El],vl[Hl]),yl[El]=(0,d.mergeArrays)(yl[El],yl[Hl]),Nl[Hl]="",vl[Hl]=[],yl[Hl]=[]):El=Hl,++Hl;return[Nl.filter(rG=>rG),vl.filter(rG=>rG.length>0),yl.filter(rG=>rG.length>0)]}}class iZ extends Fl{}class QZ extends Fl{}class HZ extends Fl{}class Sl extends Fl{constructor(II,AI){super(II,AI),this.languageRegex=/^(>>\w+<<)\s*/g,this.supported_language_codes=this.model.vocab.filter(BI=>this.languageRegex.test(BI)),console.warn('WARNING: `MarianTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}_encode_text(II){if(II===null)return null;let[AI,...BI]=II.trim().split(this.languageRegex);if(BI.length===0)return super._encode_text(AI);if(BI.length===2){let[fI,bl]=BI;return this.supported_language_codes.includes(fI)||console.warn(`Unsupported language code "${fI}" detected, which may lead to unexpected behavior. Should be one of: ${JSON.stringify(this.supported_language_codes)}`),(0,d.mergeArrays)([fI],super._encode_text(bl))}}}class rZ extends Fl{}class _Z extends Fl{}class PZ extends Fl{}class $Z extends Fl{}class Jd extends Fl{}class Ie extends Fl{constructor(II,AI){super(II,AI),this.decoder=new Il({})}}class wZ extends Fl{}class le extends Fl{}class gG{static TOKENIZER_CLASS_MAPPING={T5Tokenizer:Gc,DistilBertTokenizer:qG,CamembertTokenizer:sl,DebertaTokenizer:DG,DebertaV2Tokenizer:Wc,BertTokenizer:Dl,HerbertTokenizer:EG,ConvBertTokenizer:MG,RoFormerTokenizer:xc,XLMTokenizer:ul,ElectraTokenizer:Cl,MobileBertTokenizer:LG,SqueezeBertTokenizer:lc,AlbertTokenizer:XG,GPT2Tokenizer:yc,BartTokenizer:ib,MBartTokenizer:xG,MBart50Tokenizer:lb,RobertaTokenizer:cc,WhisperTokenizer:Dd,CodeGenTokenizer:iZ,CLIPTokenizer:QZ,SiglipTokenizer:HZ,MarianTokenizer:Sl,BloomTokenizer:Qb,NllbTokenizer:Vb,M2M100Tokenizer:XZ,LlamaTokenizer:Lb,CodeLlamaTokenizer:sb,XLMRobertaTokenizer:td,MPNetTokenizer:Db,FalconTokenizer:qb,GPTNeoXTokenizer:_b,EsmTokenizer:Yb,Wav2Vec2CTCTokenizer:rZ,BlenderbotTokenizer:_Z,BlenderbotSmallTokenizer:PZ,SpeechT5Tokenizer:$Z,NougatTokenizer:Jd,VitsTokenizer:Ie,Qwen2Tokenizer:Pb,GemmaTokenizer:nd,Grok1Tokenizer:hb,CohereTokenizer:wZ,MgpstrTokenizer:le,PreTrainedTokenizer:Fl};static async from_pretrained(II,{progress_callback:AI=null,config:BI=null,cache_dir:fI=null,local_files_only:bl=!1,revision:Nl="main",legacy:vl=null}={}){let[yl,El]=await m(II,{progress_callback:AI,config:BI,cache_dir:fI,local_files_only:bl,revision:Nl,legacy:vl}),Hl=El.tokenizer_class?.replace(/Fast$/,"")??"PreTrainedTokenizer",rG=this.TOKENIZER_CLASS_MAPPING[Hl];return rG||(console.warn(`Unknown tokenizer class "${Hl}", attempting to construct from base class.`),rG=Fl),new rG(yl,El)}}},"./src/utils/audio.js":(I,G,l)=>{l.r(G),l.d(G,{RawAudio:()=>hI,hamming:()=>h,hanning:()=>m,mel_filter_bank:()=>Q,read_audio:()=>s,spectrogram:()=>C,window_function:()=>T});var b=l("./src/utils/hub.js"),d=l("./src/utils/maths.js"),e=l("./src/utils/core.js"),t=l("./src/env.js"),W=l("?7a2c"),n=l("./src/utils/tensor.js");async function s(WI,VI){if(typeof AudioContext>"u")throw Error("Unable to load audio from path/URL since `AudioContext` is not available in your environment. Instead, audio data should be passed directly to the pipeline/processor. For more information and some example code, see https://huggingface.co/docs/transformers.js/guides/node-audio-processing.");let sI=await(await(0,b.getFile)(WI)).arrayBuffer(),ZI=new AudioContext({sampleRate:VI});typeof VI>"u"&&console.warn(`No sampling rate provided, using default of ${ZI.sampleRate}Hz.`);let dI=await ZI.decodeAudioData(sI),pI;if(dI.numberOfChannels===2){let yI=Math.sqrt(2),eI=dI.getChannelData(0),HI=dI.getChannelData(1);pI=new Float32Array(eI.length);for(let YI=0;YI<dI.length;++YI)pI[YI]=yI*(eI[YI]+HI[YI])/2}else pI=dI.getChannelData(0);return pI}function N(WI,VI){if(WI<1)return new Float64Array;if(WI===1)return new Float64Array([1]);let sI=1-VI,ZI=2*Math.PI/(WI-1),dI=new Float64Array(WI);for(let pI=0;pI<WI;++pI)dI[pI]=VI-sI*Math.cos(pI*ZI);return dI}function m(WI){return N(WI,.5)}function h(WI){return N(WI,.54)}let V={htk:WI=>2595*Math.log10(1+WI/700),kaldi:WI=>1127*Math.log(1+WI/700),slaney:(WI,VI=1e3,sI=15,ZI=27/Math.log(6.4))=>WI>=VI?sI+Math.log(WI/VI)*ZI:3*WI/200};function X(WI,VI="htk"){let sI=V[VI];if(!sI)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof WI=="number"?sI(WI):WI.map(ZI=>sI(ZI))}let p={htk:WI=>700*(10**(WI/2595)-1),kaldi:WI=>700*(Math.exp(WI/1127)-1),slaney:(WI,VI=1e3,sI=15,ZI=Math.log(6.4)/27)=>WI>=sI?VI*Math.exp(ZI*(WI-sI)):200*WI/3};function F(WI,VI="htk"){let sI=p[VI];if(!sI)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof WI=="number"?sI(WI):WI.map(ZI=>sI(ZI))}function a(WI,VI){let sI=Float64Array.from({length:VI.length-1},(yI,eI)=>VI[eI+1]-VI[eI]),ZI=Array.from({length:WI.length},()=>new Array(VI.length));for(let yI=0;yI<WI.length;++yI){let eI=ZI[yI];for(let HI=0;HI<VI.length;++HI)eI[HI]=VI[HI]-WI[yI]}let dI=VI.length-2,pI=Array.from({length:dI},()=>new Array(WI.length));for(let yI=0;yI<WI.length;++yI){let eI=ZI[yI];for(let HI=0;HI<dI;++HI){let YI=-eI[HI]/sI[HI],$=eI[HI+2]/sI[HI+1];pI[HI][yI]=Math.max(0,Math.min(YI,$))}}return pI}function u(WI,VI,sI){let ZI=(VI-WI)/(sI-1);return Float64Array.from({length:sI},(dI,pI)=>WI+ZI*pI)}function Q(WI,VI,sI,ZI,dI,pI=null,yI="htk",eI=!1){if(pI!==null&&pI!=="slaney")throw new Error('norm must be one of null or "slaney"');let HI=X(sI,yI),YI=X(ZI,yI),$=u(HI,YI,VI+2),JI=F($,yI),UI;if(eI){let L=dI/(WI*2);UI=X(Float64Array.from({length:WI},(bI,FI)=>FI*L),yI),JI=$}else UI=u(0,Math.floor(dI/2),WI);let zI=a(UI,JI);if(pI!==null&&pI==="slaney")for(let L=0;L<VI;++L){let bI=zI[L],FI=2/(JI[L+2]-JI[L]);for(let U=0;U<WI;++U)bI[U]*=FI}return zI}function o(WI,VI,sI){let ZI=new WI.constructor(WI.length+VI+sI),dI=WI.length-1;for(let pI=0;pI<WI.length;++pI)ZI[VI+pI]=WI[pI];for(let pI=1;pI<=VI;++pI)ZI[VI-pI]=WI[(0,e.calculateReflectOffset)(pI,dI)];for(let pI=1;pI<=sI;++pI)ZI[dI+VI+pI]=WI[(0,e.calculateReflectOffset)(dI-pI,dI)];return ZI}function y(WI,VI,sI,ZI,dI){if(sI<=0)throw new Error("reference must be greater than zero");if(ZI<=0)throw new Error("min_value must be greater than zero");sI=Math.max(ZI,sI);let pI=Math.log10(sI);for(let yI=0;yI<WI.length;++yI)WI[yI]=VI*Math.log10(Math.max(ZI,WI[yI])-pI);if(dI!==null){if(dI<=0)throw new Error("db_range must be greater than zero");let yI=(0,d.max)(WI)[0]-dI;for(let eI=0;eI<WI.length;++eI)WI[eI]=Math.max(WI[eI],yI)}return WI}function H(WI,VI=1,sI=1e-5,ZI=null){return y(WI,20,VI,sI,ZI)}function E(WI,VI=1,sI=1e-10,ZI=null){return y(WI,10,VI,sI,ZI)}async function C(WI,VI,sI,ZI,{fft_length:dI=null,power:pI=1,center:yI=!0,pad_mode:eI="reflect",onesided:HI=!0,preemphasis:YI=null,mel_filters:$=null,mel_floor:JI=1e-10,log_mel:UI=null,reference:zI=1,min_value:L=1e-10,db_range:bI=null,remove_dc_offset:FI=null,min_num_frames:U=null,max_num_frames:k=null,do_pad:w=!0,transpose:r=!1}={}){let A=VI.length;if(dI===null&&(dI=sI),sI>dI)throw Error(`frame_length (${sI}) may not be larger than fft_length (${dI})`);if(A!==sI)throw new Error(`Length of the window (${A}) must equal frame_length (${sI})`);if(ZI<=0)throw new Error("hop_length must be greater than zero");if(pI===null&&$!==null)throw new Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(yI){if(eI!=="reflect")throw new Error(`pad_mode="${eI}" not implemented yet.`);let OI=Math.floor((dI-1)/2)+1;WI=o(WI,OI,OI)}let O=Math.floor(1+Math.floor((WI.length-sI)/ZI));U!==null&&O<U&&(O=U);let K=HI?Math.floor(dI/2)+1:dI,q=O,GI=O;k!==null&&(k>O?w&&(GI=k):GI=q=k);let tI=new d.FFT(dI),iI=new Float64Array(dI),B=new Float64Array(tI.outputBufferSize),aI=new Float32Array(K*GI);for(let OI=0;OI<q;++OI){let uI=OI*ZI,wI=Math.min(WI.length-uI,sI);wI!==sI&&iI.fill(0,0,sI);for(let kI=0;kI<wI;++kI)iI[kI]=WI[uI+kI];if(FI){let kI=0;for(let Il=0;Il<wI;++Il)kI+=iI[Il];let TI=kI/wI;for(let Il=0;Il<wI;++Il)iI[Il]-=TI}if(YI!==null){for(let kI=wI-1;kI>=1;--kI)iI[kI]-=YI*iI[kI-1];iI[0]*=1-YI}for(let kI=0;kI<VI.length;++kI)iI[kI]*=VI[kI];tI.realTransform(B,iI);for(let kI=0;kI<K;++kI){let TI=kI<<1;aI[kI*GI+OI]=B[TI]**2+B[TI+1]**2}}if(pI!==null&&pI!==2){let OI=2/pI;for(let uI=0;uI<aI.length;++uI)aI[uI]**=OI}let lI=$.length,QI=await(0,n.matmul)(new n.Tensor("float32",$.flat(),[lI,K]),new n.Tensor("float32",aI,[K,GI]));r&&(QI=QI.transpose(1,0));let vI=QI.data;for(let OI=0;OI<vI.length;++OI)vI[OI]=Math.max(JI,vI[OI]);if(pI!==null&&UI!==null){let OI=Math.min(vI.length,q*lI);switch(UI){case"log":for(let uI=0;uI<OI;++uI)vI[uI]=Math.log(vI[uI]);break;case"log10":for(let uI=0;uI<OI;++uI)vI[uI]=Math.log10(vI[uI]);break;case"dB":if(pI===1)H(vI,zI,L,bI);else if(pI===2)E(vI,zI,L,bI);else throw new Error(`Cannot use log_mel option '${UI}' with power ${pI}`);break;default:throw new Error(`log_mel must be one of null, 'log', 'log10' or 'dB'. Got '${UI}'`)}}return QI}function T(WI,VI,{periodic:sI=!0,frame_length:ZI=null,center:dI=!0}={}){let pI=sI?WI+1:WI,yI;switch(VI){case"boxcar":yI=new Float64Array(pI).fill(1);break;case"hann":case"hann_window":yI=m(pI);break;case"hamming":yI=h(pI);break;case"povey":yI=m(pI).map(eI=>Math.pow(eI,.85));break;default:throw new Error(`Unknown window type ${VI}.`)}if(sI&&(yI=yI.subarray(0,WI)),ZI===null)return yI;if(WI>ZI)throw new Error(`Length of the window (${WI}) may not be larger than frame_length (${ZI})`);return yI}function S(WI,VI){let sI=44,ZI=new ArrayBuffer(sI+WI.length*4),dI=new DataView(ZI);cI(dI,0,"RIFF"),dI.setUint32(4,36+WI.length*4,!0),cI(dI,8,"WAVE"),cI(dI,12,"fmt "),dI.setUint32(16,16,!0),dI.setUint16(20,3,!0),dI.setUint16(22,1,!0),dI.setUint32(24,VI,!0),dI.setUint32(28,VI*4,!0),dI.setUint16(32,4,!0),dI.setUint16(34,32,!0),cI(dI,36,"data"),dI.setUint32(40,WI.length*4,!0);for(let pI=0;pI<WI.length;++pI,sI+=4)dI.setFloat32(sI,WI[pI],!0);return ZI}function cI(WI,VI,sI){for(let ZI=0;ZI<sI.length;++ZI)WI.setUint8(VI+ZI,sI.charCodeAt(ZI))}class hI{constructor(VI,sI){this.audio=VI,this.sampling_rate=sI}toWav(){return S(this.audio,this.sampling_rate)}toBlob(){let VI=this.toWav();return new Blob([VI],{type:"audio/wav"})}async save(VI){let sI;if(t.apis.IS_BROWSER_ENV){if(t.apis.IS_WEBWORKER_ENV)throw new Error("Unable to save a file from a Web Worker.");sI=e.saveBlob}else if(t.apis.IS_FS_AVAILABLE)sI=async(ZI,dI)=>{let pI=await dI.arrayBuffer();W.writeFileSync(ZI,Buffer.from(pI))};else throw new Error("Unable to save because filesystem is disabled in this environment.");await sI(VI,this.toBlob())}}},"./src/utils/constants.js":(I,G,l)=>{l.r(G),l.d(G,{CHAT_TEMPLATE_NAME:()=>n,CONFIG_NAME:()=>d,FEATURE_EXTRACTOR_NAME:()=>e,GENERATION_CONFIG_NAME:()=>s,GITHUB_ISSUE_URL:()=>b,IMAGE_PROCESSOR_NAME:()=>t,PROCESSOR_NAME:()=>W});let b="https://github.com/huggingface/transformers.js/issues/new/choose",d="config.json",e="preprocessor_config.json",t=e,W="processor_config.json",n="chat_template.json",s="generation_config.json"},"./src/utils/core.js":(I,G,l)=>{l.r(G),l.d(G,{calculateDimensions:()=>s,calculateReflectOffset:()=>V,count:()=>a,dispatchCallback:()=>b,escapeRegExp:()=>e,isIntegralNumber:()=>W,isNullishDimension:()=>n,isTypedArray:()=>t,len:()=>F,mergeArrays:()=>m,pick:()=>p,pop:()=>N,product:()=>h,reverseDictionary:()=>d,saveBlob:()=>X});function b(u,Q){u&&u(Q)}function d(u){return Object.fromEntries(Object.entries(u).map(([Q,o])=>[o,Q]))}function e(u){return u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function t(u){return u?.prototype?.__proto__?.constructor?.name==="TypedArray"}function W(u){return Number.isInteger(u)||typeof u=="bigint"}function n(u){return u==null||u===-1}function s(u){let Q=[],o=u;for(;Array.isArray(o);)Q.push(o.length),o=o[0];return Q}function N(u,Q,o=void 0){let y=u[Q];if(y!==void 0)return delete u[Q],y;if(o===void 0)throw Error(`Key ${Q} does not exist in object.`);return o}function m(...u){return Array.prototype.concat.apply([],u)}function h(...u){return u.reduce((Q,o)=>Q.flatMap(y=>o.map(H=>[y,H])))}function V(u,Q){return Math.abs((u+Q)%(2*Q)-Q)}function X(u,Q){let o=URL.createObjectURL(Q),y=document.createElement("a");y.href=o,y.download=u,y.click(),y.remove(),URL.revokeObjectURL(o)}function p(u,Q){return Object.assign({},...Q.map(o=>{if(u[o]!==void 0)return{[o]:u[o]}}))}function F(u){let Q=0;for(let o of u)++Q;return Q}function a(u,Q){let o=0;for(let y of u)y===Q&&++o;return o}},"./src/utils/data-structures.js":(I,G,l)=>{l.r(G),l.d(G,{CharTrie:()=>d,PriorityQueue:()=>b,TokenLattice:()=>t});class b{constructor(s=(m,h)=>m>h,N=1/0){this._heap=[],this._comparator=s,this._maxSize=N}get size(){return this._heap.length}isEmpty(){return this.size===0}peek(){return this._heap[0]}push(...s){return this.extend(s)}extend(s){for(let N of s)if(this.size<this._maxSize)this._heap.push(N),this._siftUp();else{let m=this._smallest();this._comparator(N,this._heap[m])&&(this._heap[m]=N,this._siftUpFrom(m))}return this.size}pop(){let s=this.peek(),N=this.size-1;return N>0&&this._swap(0,N),this._heap.pop(),this._siftDown(),s}replace(s){let N=this.peek();return this._heap[0]=s,this._siftDown(),N}_parent(s){return(s+1>>>1)-1}_left(s){return(s<<1)+1}_right(s){return s+1<<1}_greater(s,N){return this._comparator(this._heap[s],this._heap[N])}_swap(s,N){let m=this._heap[s];this._heap[s]=this._heap[N],this._heap[N]=m}_siftUp(){this._siftUpFrom(this.size-1)}_siftUpFrom(s){for(;s>0&&this._greater(s,this._parent(s));)this._swap(s,this._parent(s)),s=this._parent(s)}_siftDown(){let s=0;for(;this._left(s)<this.size&&this._greater(this._left(s),s)||this._right(s)<this.size&&this._greater(this._right(s),s);){let N=this._right(s)<this.size&&this._greater(this._right(s),this._left(s))?this._right(s):this._left(s);this._swap(s,N),s=N}}_smallest(){return 2**Math.floor(Math.log2(this.size))-1}}class d{constructor(){this.root=e.default()}extend(s){for(let N of s)this.push(N)}push(s){let N=this.root;for(let m of s){let h=N.children.get(m);h===void 0&&(h=e.default(),N.children.set(m,h)),N=h}N.isLeaf=!0}*commonPrefixSearch(s){let N=this.root;if(N===void 0)return;let m="";for(let h of s){if(m+=h,N=N.children.get(h),N===void 0)return;N.isLeaf&&(yield m)}}}class e{constructor(s,N){this.isLeaf=s,this.children=N}static default(){return new e(!1,new Map)}}class t{constructor(s,N,m){this.chars=Array.from(s),this.len=this.chars.length,this.bosTokenId=N,this.eosTokenId=m,this.nodes=[],this.beginNodes=Array.from({length:this.len+1},()=>[]),this.endNodes=Array.from({length:this.len+1},()=>[]);let h=new W(this.bosTokenId,0,0,0,0),V=new W(this.eosTokenId,1,this.len,0,0);this.nodes.push(h.clone()),this.nodes.push(V.clone()),this.beginNodes[this.len].push(V),this.endNodes[0].push(h)}insert(s,N,m,h){let V=this.nodes.length,X=new W(h,V,s,N,m);this.beginNodes[s].push(X),this.endNodes[s+N].push(X),this.nodes.push(X)}viterbi(){let s=this.len,N=0;for(;N<=s;){if(this.beginNodes[N].length==0)return[];for(let p of this.beginNodes[N]){p.prev=null;let F=0,a=null;for(let u of this.endNodes[N]){let Q=u.backtraceScore+p.score;(a===null||Q>F)&&(a=u.clone(),F=Q)}if(a!==null)p.prev=a,p.backtraceScore=F;else return[]}++N}let m=[],V=this.beginNodes[s][0].prev;if(V===null)return[];let X=V.clone();for(;X.prev!==null;)m.push(X.clone()),X=X.clone().prev.clone();return m.reverse(),m}piece(s){return this.chars.slice(s.pos,s.pos+s.length).join("")}tokens(){return this.viterbi().map(N=>this.piece(N))}tokenIds(){return this.viterbi().map(N=>N.tokenId)}}class W{constructor(s,N,m,h,V){this.tokenId=s,this.nodeId=N,this.pos=m,this.length=h,this.score=V,this.prev=null,this.backtraceScore=0}clone(){let s=new W(this.tokenId,this.nodeId,this.pos,this.length,this.score);return s.prev=this.prev,s.backtraceScore=this.backtraceScore,s}}},"./src/utils/devices.js":(I,G,l)=>{l.r(G),l.d(G,{DEVICE_TYPES:()=>b});let b=Object.freeze({auto:"auto",gpu:"gpu",cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:"webnn","webnn-npu":"webnn-npu","webnn-gpu":"webnn-gpu","webnn-cpu":"webnn-cpu"})},"./src/utils/dtypes.js":(I,G,l)=>{l.r(G),l.d(G,{DATA_TYPES:()=>t,DEFAULT_DEVICE_DTYPE_MAPPING:()=>W,DEFAULT_DTYPE_SUFFIX_MAPPING:()=>n,isWebGpuFp16Supported:()=>e});var b=l("./src/env.js"),d=l("./src/utils/devices.js");let e=function(){let s;return async function(){if(s===void 0)if(!b.apis.IS_WEBGPU_AVAILABLE)s=!1;else try{s=(await navigator.gpu.requestAdapter()).features.has("shader-f16")}catch{s=!1}return s}}(),t=Object.freeze({auto:"auto",fp32:"fp32",fp16:"fp16",q8:"q8",int8:"int8",uint8:"uint8",q4:"q4",bnb4:"bnb4",q4f16:"q4f16"}),W=Object.freeze({[d.DEVICE_TYPES.wasm]:t.q8}),n=Object.freeze({[t.fp32]:"",[t.fp16]:"_fp16",[t.int8]:"_int8",[t.uint8]:"_uint8",[t.q8]:"_quantized",[t.q4]:"_q4",[t.q4f16]:"_q4f16",[t.bnb4]:"_bnb4"})},"./src/utils/generic.js":(I,G,l)=>{l.r(G),l.d(G,{Callable:()=>b});let b=class{constructor(){let d=function(...e){return d._call(...e)};return Object.setPrototypeOf(d,new.target.prototype)}_call(...d){throw Error("Must implement _call method in subclass")}}},"./src/utils/hub.js":(I,G,l)=>{l.r(G),l.d(G,{getFile:()=>N,getModelFile:()=>p,getModelJSON:()=>F});var b=l("?7a2c"),d=l("?a42a"),e=l("./src/env.js"),t=l("./src/utils/core.js");let W={txt:"text/plain",html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};class n{constructor(o){if(this.filePath=o,this.headers=new Headers,this.exists=b.existsSync(o),this.exists){this.status=200,this.statusText="OK";let y=b.statSync(o);this.headers.set("content-length",y.size.toString()),this.updateContentType();let H=this;this.body=new ReadableStream({start(E){H.arrayBuffer().then(C=>{E.enqueue(new Uint8Array(C)),E.close()})}})}else this.status=404,this.statusText="Not Found",this.body=null}updateContentType(){let o=this.filePath.toString().split(".").pop().toLowerCase();this.headers.set("content-type",W[o]??"application/octet-stream")}clone(){let o=new n(this.filePath);return o.exists=this.exists,o.status=this.status,o.statusText=this.statusText,o.headers=new Headers(this.headers),o}async arrayBuffer(){return(await b.promises.readFile(this.filePath)).buffer}async blob(){let o=await b.promises.readFile(this.filePath);return new Blob([o],{type:this.headers.get("content-type")})}async text(){return await b.promises.readFile(this.filePath,"utf8")}async json(){return JSON.parse(await this.text())}}function s(Q,o=null,y=null){let H;try{H=new URL(Q)}catch{return!1}return!(o&&!o.includes(H.protocol)||y&&!y.includes(H.hostname))}async function N(Q){if(e.env.useFS&&!s(Q,["http:","https:","blob:"]))return new n(Q);if(typeof process<"u"&&process?.release?.name==="node"){let o=!!process.env?.TESTING_REMOTELY,y=e.env.version,H=new Headers;if(H.set("User-Agent",`transformers.js/${y}; is_ci/${o};`),s(Q,["http:","https:"],["huggingface.co","hf.co"])){let C=process.env?.HF_TOKEN??process.env?.HF_ACCESS_TOKEN;C&&H.set("Authorization",`Bearer ${C}`)}return fetch(Q,{headers:H})}else return fetch(Q)}let m={400:"Bad request error occurred while trying to load file",401:"Unauthorized access to file",403:"Forbidden access to file",404:"Could not locate file",408:"Request timeout error occurred while trying to load file",500:"Internal server error error occurred while trying to load file",502:"Bad gateway error occurred while trying to load file",503:"Service unavailable error occurred while trying to load file",504:"Gateway timeout error occurred while trying to load file"};function h(Q,o,y){if(!y)return null;let H=m[Q]??`Error (${Q}) occurred while trying to load file`;throw Error(`${H}: "${o}".`)}class V{constructor(o){this.path=o}async match(o){let y=d.join(this.path,o),H=new n(y);if(H.exists)return H}async put(o,y){let H=Buffer.from(await y.arrayBuffer()),E=d.join(this.path,o);try{await b.promises.mkdir(d.dirname(E),{recursive:!0}),await b.promises.writeFile(E,H)}catch(C){console.warn("An error occurred while writing the file to cache:",C)}}}async function X(Q,...o){for(let y of o)try{let H=await Q.match(y);if(H)return H}catch{continue}}async function p(Q,o,y=!0,H={}){if(!e.env.allowLocalModels){if(H.local_files_only)throw Error("Invalid configuration detected: local models are disabled (`env.allowLocalModels=false`) but you have requested to only use local models (`local_files_only=true`).");if(!e.env.allowRemoteModels)throw Error("Invalid configuration detected: both local and remote models are disabled. Fix by setting `env.allowLocalModels` or `env.allowRemoteModels` to `true`.")}(0,t.dispatchCallback)(H.progress_callback,{status:"initiate",name:Q,file:o});let E;if(!E&&e.env.useBrowserCache){if(typeof caches>"u")throw Error("Browser cache is not available in this environment.");try{E=await caches.open("transformers-cache")}catch(yI){console.warn("An error occurred while opening the browser cache:",yI)}}if(!E&&e.env.useFSCache&&(E=new V(H.cache_dir??e.env.cacheDir)),!E&&e.env.useCustomCache){if(!e.env.customCache)throw Error("`env.useCustomCache=true`, but `env.customCache` is not defined.");if(!e.env.customCache.match||!e.env.customCache.put)throw new Error("`env.customCache` must be an object which implements the `match` and `put` functions of the Web Cache API. For more information, see https://developer.mozilla.org/en-US/docs/Web/API/Cache");E=e.env.customCache}let C=H.revision??"main",T=u(Q,o),S=u(e.env.localModelPath,T),cI=u(e.env.remoteHost,e.env.remotePathTemplate.replaceAll("{model}",Q).replaceAll("{revision}",encodeURIComponent(C)),o),hI=C==="main"?T:u(Q,C,o),WI,VI=E instanceof V?hI:cI,sI=!1,ZI;E&&(ZI=await X(E,S,VI));let dI=ZI!==void 0;if(ZI===void 0){if(e.env.allowLocalModels)if(s(T,["http:","https:"])){if(H.local_files_only)throw new Error(`\`local_files_only=true\`, but attempted to load a remote file from: ${T}.`);if(!e.env.allowRemoteModels)throw new Error(`\`env.allowRemoteModels=false\`, but attempted to load a remote file from: ${T}.`)}else try{ZI=await N(S),WI=S}catch(eI){console.warn(`Unable to load from local path "${S}": "${eI}"`)}if(ZI===void 0||ZI.status===404){if(H.local_files_only||!e.env.allowRemoteModels){if(y)throw Error(`\`local_files_only=true\` or \`env.allowRemoteModels=false\` and file was not found locally at "${S}".`);return null}if(ZI=await N(cI),ZI.status!==200)return h(ZI.status,cI,y);WI=VI}sI=E&&typeof Response<"u"&&ZI instanceof Response&&ZI.status===200}(0,t.dispatchCallback)(H.progress_callback,{status:"download",name:Q,file:o});let pI;return H.progress_callback?dI&&typeof navigator<"u"&&/firefox/i.test(navigator.userAgent)?(pI=new Uint8Array(await ZI.arrayBuffer()),(0,t.dispatchCallback)(H.progress_callback,{status:"progress",name:Q,file:o,progress:100,loaded:pI.length,total:pI.length})):pI=await a(ZI,yI=>{(0,t.dispatchCallback)(H.progress_callback,{status:"progress",name:Q,file:o,...yI})}):pI=new Uint8Array(await ZI.arrayBuffer()),sI&&WI&&await E.match(WI)===void 0&&await E.put(WI,new Response(pI,{headers:ZI.headers})).catch(yI=>{console.warn(`Unable to add response to browser cache: ${yI}.`)}),(0,t.dispatchCallback)(H.progress_callback,{status:"done",name:Q,file:o}),pI}async function F(Q,o,y=!0,H={}){let E=await p(Q,o,y,H);if(E===null)return{};let T=new TextDecoder("utf-8").decode(E);return JSON.parse(T)}async function a(Q,o){let y=Q.headers.get("Content-Length");y===null&&console.warn("Unable to determine content-length from response headers. Will expand buffer when needed.");let H=parseInt(y??"0"),E=new Uint8Array(H),C=0,T=Q.body.getReader();async function S(){let{done:cI,value:hI}=await T.read();if(cI)return;let WI=C+hI.length;if(WI>H){H=WI;let sI=new Uint8Array(H);sI.set(E),E=sI}E.set(hI,C),C=WI;let VI=C/H*100;return o({progress:VI,loaded:C,total:H}),S()}return await S(),E}function u(...Q){return Q=Q.map((o,y)=>(y&&(o=o.replace(new RegExp("^/"),"")),y!==Q.length-1&&(o=o.replace(new RegExp("/$"),"")),o)),Q.join("/")}},"./src/utils/image.js":(I,G,l)=>{l.r(G),l.d(G,{RawImage:()=>X,load_image:()=>p});var b=l("./src/utils/core.js"),d=l("./src/utils/hub.js"),e=l("./src/env.js"),t=l("./src/utils/tensor.js"),W=l("?2b25");let n,s,N,m=e.apis.IS_BROWSER_ENV||e.apis.IS_WEBWORKER_ENV;if(m)n=(F,a)=>{if(!self.OffscreenCanvas)throw new Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(F,a)},N=self.createImageBitmap,s=self.ImageData;else if(W)N=async F=>{let u=(await F.metadata()).channels,{data:Q,info:o}=await F.rotate().raw().toBuffer({resolveWithObject:!0}),y=new X(new Uint8ClampedArray(Q),o.width,o.height,o.channels);return u!==void 0&&u!==o.channels&&y.convert(u),y};else throw new Error("Unable to load image processing library.");let h={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},V=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);class X{constructor(a,u,Q,o){this.data=a,this.width=u,this.height=Q,this.channels=o}get size(){return[this.width,this.height]}static async read(a){if(a instanceof X)return a;if(typeof a=="string"||a instanceof URL)return await this.fromURL(a);throw new Error(`Unsupported input type: ${typeof a}`)}static fromCanvas(a){if(!m)throw new Error("fromCanvas() is only supported in browser environments.");let Q=a.getContext("2d").getImageData(0,0,a.width,a.height).data;return new X(Q,a.width,a.height,4)}static async fromURL(a){let u=await(0,d.getFile)(a);if(u.status!==200)throw new Error(`Unable to read image from "${a}" (${u.status} ${u.statusText})`);let Q=await u.blob();return this.fromBlob(Q)}static async fromBlob(a){if(m){let u=await N(a),Q=n(u.width,u.height).getContext("2d");return Q.drawImage(u,0,0),new this(Q.getImageData(0,0,u.width,u.height).data,u.width,u.height,4)}else{let u=W(await a.arrayBuffer());return await N(u)}}static fromTensor(a,u="CHW"){if(a.dims.length!==3)throw new Error(`Tensor should have 3 dimensions, but has ${a.dims.length} dimensions.`);if(u==="CHW")a=a.transpose(1,2,0);else if(u!=="HWC")throw new Error(`Unsupported channel format: ${u}`);if(!(a.data instanceof Uint8ClampedArray||a.data instanceof Uint8Array))throw new Error(`Unsupported tensor type: ${a.type}`);switch(a.dims[2]){case 1:case 2:case 3:case 4:return new X(a.data,a.dims[1],a.dims[0],a.dims[2]);default:throw new Error(`Unsupported number of channels: ${a.dims[2]}`)}}grayscale(){if(this.channels===1)return this;let a=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let u=0,Q=0;u<this.data.length;u+=this.channels){let o=this.data[u],y=this.data[u+1],H=this.data[u+2];a[Q++]=Math.round(.2989*o+.587*y+.114*H)}break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(a,this.width,this.height,1)}rgb(){if(this.channels===3)return this;let a=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let u=0,Q=0;u<this.data.length;++u)a[Q++]=this.data[u],a[Q++]=this.data[u],a[Q++]=this.data[u];break;case 4:for(let u=0,Q=0;u<this.data.length;u+=4)a[Q++]=this.data[u],a[Q++]=this.data[u+1],a[Q++]=this.data[u+2];break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(a,this.width,this.height,3)}rgba(){if(this.channels===4)return this;let a=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let u=0,Q=0;u<this.data.length;++u)a[Q++]=this.data[u],a[Q++]=this.data[u],a[Q++]=this.data[u],a[Q++]=255;break;case 3:for(let u=0,Q=0;u<this.data.length;u+=3)a[Q++]=this.data[u],a[Q++]=this.data[u+1],a[Q++]=this.data[u+2],a[Q++]=255;break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(a,this.width,this.height,4)}putAlpha(a){if(a.width!==this.width||a.height!==this.height)throw new Error(`Expected mask size to be ${this.width}x${this.height}, but got ${a.width}x${a.height}`);if(a.channels!==1)throw new Error(`Expected mask to have 1 channel, but got ${a.channels}`);let u=this.data,Q=a.data,o=this.width*this.height;if(this.channels===3){let y=new Uint8ClampedArray(o*4);for(let H=0,E=0,C=0;H<o;++H)y[C++]=u[E++],y[C++]=u[E++],y[C++]=u[E++],y[C++]=Q[H];return this._update(y,this.width,this.height,4)}else if(this.channels===4){for(let y=0;y<o;++y)u[4*y+3]=Q[y];return this}throw new Error(`Expected image to have 3 or 4 channels, but got ${this.channels}`)}async resize(a,u,{resample:Q=2}={}){if(this.width===a&&this.height===u)return this;let o=h[Q]??Q,y=(0,b.isNullishDimension)(a),H=(0,b.isNullishDimension)(u);if(y&&H)return this;if(y?a=u/this.height*this.width:H&&(u=a/this.width*this.height),m){let E=this.channels,C=this.toCanvas(),T=n(a,u).getContext("2d");return T.drawImage(C,0,0,a,u),new X(T.getImageData(0,0,a,u).data,a,u,4).convert(E)}else{let E=this.toSharp();switch(o){case"box":case"hamming":(o==="box"||o==="hamming")&&(console.warn(`Resampling method ${o} is not yet supported. Using bilinear instead.`),o="bilinear");case"nearest":case"bilinear":case"bicubic":E=E.affine([a/this.width,0,0,u/this.height],{interpolator:o});break;case"lanczos":E=E.resize({width:a,height:u,fit:"fill",kernel:"lanczos3"});break;default:throw new Error(`Resampling method ${o} is not supported.`)}return await N(E)}}async pad([a,u,Q,o]){if(a=Math.max(a,0),u=Math.max(u,0),Q=Math.max(Q,0),o=Math.max(o,0),a===0&&u===0&&Q===0&&o===0)return this;if(m){let y=this.channels,H=this.toCanvas(),E=this.width+a+u,C=this.height+Q+o,T=n(E,C).getContext("2d");return T.drawImage(H,0,0,this.width,this.height,a,Q,this.width,this.height),new X(T.getImageData(0,0,E,C).data,E,C,4).convert(y)}else{let y=this.toSharp().extend({left:a,right:u,top:Q,bottom:o});return await N(y)}}async crop([a,u,Q,o]){if(a=Math.max(a,0),u=Math.max(u,0),Q=Math.min(Q,this.width-1),o=Math.min(o,this.height-1),a===0&&u===0&&Q===this.width-1&&o===this.height-1)return this;let y=Q-a+1,H=o-u+1;if(m){let E=this.channels,C=this.toCanvas(),T=n(y,H).getContext("2d");return T.drawImage(C,a,u,y,H,0,0,y,H),new X(T.getImageData(0,0,y,H).data,y,H,4).convert(E)}else{let E=this.toSharp().extract({left:a,top:u,width:y,height:H});return await N(E)}}async center_crop(a,u){if(this.width===a&&this.height===u)return this;let Q=(this.width-a)/2,o=(this.height-u)/2;if(m){let y=this.channels,H=this.toCanvas(),E=n(a,u).getContext("2d"),C=0,T=0,S=0,cI=0;return Q>=0?C=Q:S=-Q,o>=0?T=o:cI=-o,E.drawImage(H,C,T,a,u,S,cI,a,u),new X(E.getImageData(0,0,a,u).data,a,u,4).convert(y)}else{let y=this.toSharp();if(Q>=0&&o>=0)y=y.extract({left:Math.floor(Q),top:Math.floor(o),width:a,height:u});else if(Q<=0&&o<=0){let H=Math.floor(-o),E=Math.floor(-Q);y=y.extend({top:H,left:E,right:a-this.width-E,bottom:u-this.height-H})}else{let H=[0,0],E=0;o<0?(H[0]=Math.floor(-o),H[1]=u-this.height-H[0]):E=Math.floor(o);let C=[0,0],T=0;Q<0?(C[0]=Math.floor(-Q),C[1]=a-this.width-C[0]):T=Math.floor(Q),y=y.extend({top:H[0],bottom:H[1],left:C[0],right:C[1]}).extract({left:T,top:E,width:a,height:u})}return await N(y)}}async toBlob(a="image/png",u=1){if(!m)throw new Error("toBlob() is only supported in browser environments.");return await this.toCanvas().convertToBlob({type:a,quality:u})}toTensor(a="CHW"){let u=new t.Tensor("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if(a!=="HWC")if(a==="CHW")u=u.permute(2,0,1);else throw new Error(`Unsupported channel format: ${a}`);return u}toCanvas(){if(!m)throw new Error("toCanvas() is only supported in browser environments.");let a=this.clone().rgba(),u=n(a.width,a.height),Q=new s(a.data,a.width,a.height);return u.getContext("2d").putImageData(Q,0,0),u}split(){let{data:a,width:u,height:Q,channels:o}=this,y=a.constructor,H=a.length/o,E=Array.from({length:o},()=>new y(H));for(let C=0;C<H;++C){let T=o*C;for(let S=0;S<o;++S)E[S][C]=a[T+S]}return E.map(C=>new X(C,u,Q,1))}_update(a,u,Q,o=null){return this.data=a,this.width=u,this.height=Q,o!==null&&(this.channels=o),this}clone(){return new X(this.data.slice(),this.width,this.height,this.channels)}convert(a){if(this.channels===a)return this;switch(a){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(a){if(m){if(e.apis.IS_WEBWORKER_ENV)throw new Error("Unable to save an image from a Web Worker.");let u=a.split(".").pop().toLowerCase(),Q=V.get(u)??"image/png",o=await this.toBlob(Q);(0,b.saveBlob)(a,o)}else{if(e.apis.IS_FS_AVAILABLE)return await this.toSharp().toFile(a);throw new Error("Unable to save the image because filesystem is disabled in this environment.")}}toSharp(){if(m)throw new Error("toSharp() is only supported in server-side environments.");return W(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}}let p=X.read.bind(X)},"./src/utils/maths.js":(I,G,l)=>{l.r(G),l.d(G,{FFT:()=>p,bankers_round:()=>u,cos_sim:()=>n,dot:()=>W,dynamic_time_warping:()=>Q,interpolate_data:()=>b,log_softmax:()=>t,magnitude:()=>s,max:()=>m,medianFilter:()=>F,min:()=>N,permute_data:()=>d,round:()=>a,softmax:()=>e});function b(o,[y,H,E],[C,T],S="bilinear",cI=!1){let hI=T/E,WI=C/H,VI=new o.constructor(C*T*y),sI=H*E,ZI=C*T;for(let dI=0;dI<C;++dI)for(let pI=0;pI<T;++pI){let yI=dI*T+pI,eI=(pI+.5)/hI-.5,HI=(dI+.5)/WI-.5,YI=Math.floor(eI),$=Math.floor(HI),JI=Math.min(YI+1,E-1),UI=Math.min($+1,H-1);YI=Math.max(YI,0),$=Math.max($,0);let zI=eI-YI,L=HI-$,bI=(1-zI)*(1-L),FI=zI*(1-L),U=(1-zI)*L,k=zI*L,w=$*E,r=UI*E,A=w+YI,O=w+JI,K=r+YI,q=r+JI;for(let GI=0;GI<y;++GI){let tI=GI*sI;VI[GI*ZI+yI]=bI*o[tI+A]+FI*o[tI+O]+U*o[tI+K]+k*o[tI+q]}}return VI}function d(o,y,H){let E=new Array(H.length),C=new Array(H.length);for(let cI=H.length-1,hI=1;cI>=0;--cI)C[cI]=hI,E[cI]=y[H[cI]],hI*=E[cI];let T=H.map((cI,hI)=>C[H.indexOf(hI)]),S=new o.constructor(o.length);for(let cI=0;cI<o.length;++cI){let hI=0;for(let WI=y.length-1,VI=cI;WI>=0;--WI)hI+=VI%y[WI]*T[WI],VI=Math.floor(VI/y[WI]);S[hI]=o[cI]}return[S,E]}function e(o){let y=m(o)[0],H=o.map(T=>Math.exp(T-y)),E=H.reduce((T,S)=>T+S,0);return H.map(T=>T/E)}function t(o){let y=m(o)[0],H=0;for(let T=0;T<o.length;++T)H+=Math.exp(o[T]-y);let E=Math.log(H);return o.map(T=>T-y-E)}function W(o,y){let H=0;for(let E=0;E<o.length;++E)H+=o[E]*y[E];return H}function n(o,y){let H=W(o,y),E=s(o),C=s(y);return H/(E*C)}function s(o){return Math.sqrt(o.reduce((y,H)=>y+H*H,0))}function N(o){if(o.length===0)throw Error("Array must not be empty");let y=o[0],H=0;for(let E=1;E<o.length;++E)o[E]<y&&(y=o[E],H=E);return[y,H]}function m(o){if(o.length===0)throw Error("Array must not be empty");let y=o[0],H=0;for(let E=1;E<o.length;++E)o[E]>y&&(y=o[E],H=E);return[y,H]}function h(o){return o>0&&(o&o-1)===0}class V{constructor(y){if(this.size=y|0,this.size<=1||!h(this.size))throw new Error("FFT size must be a power of two larger than 1");this._csize=y<<1,this.table=new Float64Array(this.size*2);for(let E=0;E<this.table.length;E+=2){let C=Math.PI*E/this.size;this.table[E]=Math.cos(C),this.table[E+1]=-Math.sin(C)}let H=0;for(let E=1;this.size>E;E<<=1)++H;this._width=H%2===0?H-1:H,this._bitrev=new Int32Array(1<<this._width);for(let E=0;E<this._bitrev.length;++E){this._bitrev[E]=0;for(let C=0;C<this._width;C+=2){let T=this._width-C-2;this._bitrev[E]|=(E>>>C&3)<<T}}}createComplexArray(){return new Float64Array(this._csize)}fromComplexArray(y,H){let E=H||new Array(y.length>>>1);for(let C=0;C<y.length;C+=2)E[C>>>1]=y[C];return E}toComplexArray(y,H){let E=H||this.createComplexArray();for(let C=0;C<E.length;C+=2)E[C]=y[C>>>1],E[C+1]=0;return E}transform(y,H){if(y===H)throw new Error("Input and output buffers must be different");this._transform4(y,H,1)}realTransform(y,H){if(y===H)throw new Error("Input and output buffers must be different");this._realTransform4(y,H,1)}inverseTransform(y,H){if(y===H)throw new Error("Input and output buffers must be different");this._transform4(y,H,-1);for(let E=0;E<y.length;++E)y[E]/=this.size}_transform4(y,H,E){let C=this._csize,S=1<<this._width,cI=C/S<<1,hI,WI,VI=this._bitrev;if(cI===4)for(hI=0,WI=0;hI<C;hI+=cI,++WI){let ZI=VI[WI];this._singleTransform2(H,y,hI,ZI,S)}else for(hI=0,WI=0;hI<C;hI+=cI,++WI){let ZI=VI[WI];this._singleTransform4(H,y,hI,ZI,S,E)}let sI=this.table;for(S>>=2;S>=2;S>>=2){cI=C/S<<1;let ZI=cI>>>2;for(hI=0;hI<C;hI+=cI){let dI=hI+ZI-1;for(let pI=hI,yI=0;pI<dI;pI+=2,yI+=S){let eI=pI,HI=eI+ZI,YI=HI+ZI,$=YI+ZI,JI=y[eI],UI=y[eI+1],zI=y[HI],L=y[HI+1],bI=y[YI],FI=y[YI+1],U=y[$],k=y[$+1],w=sI[yI],r=E*sI[yI+1],A=zI*w-L*r,O=zI*r+L*w,K=sI[2*yI],q=E*sI[2*yI+1],GI=bI*K-FI*q,tI=bI*q+FI*K,iI=sI[3*yI],B=E*sI[3*yI+1],aI=U*iI-k*B,lI=U*B+k*iI,QI=JI+GI,vI=UI+tI,OI=JI-GI,uI=UI-tI,wI=A+aI,kI=O+lI,TI=E*(A-aI),Il=E*(O-lI);y[eI]=QI+wI,y[eI+1]=vI+kI,y[HI]=OI+Il,y[HI+1]=uI-TI,y[YI]=QI-wI,y[YI+1]=vI-kI,y[$]=OI-Il,y[$+1]=uI+TI}}}}_singleTransform2(y,H,E,C,T){let S=y[C],cI=y[C+1],hI=y[C+T],WI=y[C+T+1];H[E]=S+hI,H[E+1]=cI+WI,H[E+2]=S-hI,H[E+3]=cI-WI}_singleTransform4(y,H,E,C,T,S){let cI=T*2,hI=T*3,WI=y[C],VI=y[C+1],sI=y[C+T],ZI=y[C+T+1],dI=y[C+cI],pI=y[C+cI+1],yI=y[C+hI],eI=y[C+hI+1],HI=WI+dI,YI=VI+pI,$=WI-dI,JI=VI-pI,UI=sI+yI,zI=ZI+eI,L=S*(sI-yI),bI=S*(ZI-eI);H[E]=HI+UI,H[E+1]=YI+zI,H[E+2]=$+bI,H[E+3]=JI-L,H[E+4]=HI-UI,H[E+5]=YI-zI,H[E+6]=$-bI,H[E+7]=JI+L}_realTransform4(y,H,E){let C=this._csize,S=1<<this._width,cI=C/S<<1,hI,WI,VI=this._bitrev;if(cI===4)for(hI=0,WI=0;hI<C;hI+=cI,++WI){let dI=VI[WI];this._singleRealTransform2(H,y,hI,dI>>>1,S>>>1)}else for(hI=0,WI=0;hI<C;hI+=cI,++WI){let dI=VI[WI];this._singleRealTransform4(H,y,hI,dI>>>1,S>>>1,E)}let sI=this.table;for(S>>=2;S>=2;S>>=2){cI=C/S<<1;let dI=cI>>>1,pI=dI>>>1,yI=pI>>>1;for(hI=0;hI<C;hI+=cI)for(let eI=0,HI=0;eI<=yI;eI+=2,HI+=S){let YI=hI+eI,$=YI+pI,JI=$+pI,UI=JI+pI,zI=y[YI],L=y[YI+1],bI=y[$],FI=y[$+1],U=y[JI],k=y[JI+1],w=y[UI],r=y[UI+1],A=zI,O=L,K=sI[HI],q=E*sI[HI+1],GI=bI*K-FI*q,tI=bI*q+FI*K,iI=sI[2*HI],B=E*sI[2*HI+1],aI=U*iI-k*B,lI=U*B+k*iI,QI=sI[3*HI],vI=E*sI[3*HI+1],OI=w*QI-r*vI,uI=w*vI+r*QI,wI=A+aI,kI=O+lI,TI=A-aI,Il=O-lI,nl=GI+OI,ol=tI+uI,PI=E*(GI-OI),KI=E*(tI-uI);if(y[YI]=wI+nl,y[YI+1]=kI+ol,y[$]=TI+KI,y[$+1]=Il-PI,eI===0){y[JI]=wI-nl,y[JI+1]=kI-ol;continue}if(eI===yI)continue;let jI=hI+pI-eI,Wl=hI+dI-eI;y[jI]=TI-E*KI,y[jI+1]=-Il-E*PI,y[Wl]=wI-E*nl,y[Wl+1]=-kI+E*ol}}let ZI=C>>>1;for(let dI=2;dI<ZI;dI+=2)y[C-dI]=y[dI],y[C-dI+1]=-y[dI+1]}_singleRealTransform2(y,H,E,C,T){let S=y[C],cI=y[C+T];H[E]=S+cI,H[E+1]=0,H[E+2]=S-cI,H[E+3]=0}_singleRealTransform4(y,H,E,C,T,S){let cI=T*2,hI=T*3,WI=y[C],VI=y[C+T],sI=y[C+cI],ZI=y[C+hI],dI=WI+sI,pI=WI-sI,yI=VI+ZI,eI=S*(VI-ZI);H[E]=dI+yI,H[E+1]=0,H[E+2]=pI,H[E+3]=-eI,H[E+4]=dI-yI,H[E+5]=0,H[E+6]=pI,H[E+7]=eI}}class X{constructor(y){let H=2*(y-1),E=2*(2*y-1),C=2**Math.ceil(Math.log2(E));this.bufferSize=C,this._a=H;let T=new Float64Array(E),S=new Float64Array(C);this._chirpBuffer=new Float64Array(C),this._buffer1=new Float64Array(C),this._buffer2=new Float64Array(C),this._outBuffer1=new Float64Array(C),this._outBuffer2=new Float64Array(C);let cI=-2*Math.PI/y,hI=Math.cos(cI),WI=Math.sin(cI);for(let VI=0;VI<E>>1;++VI){let sI=(VI+1-y)**2/2,ZI=Math.sqrt(hI**2+WI**2)**sI,dI=sI*Math.atan2(WI,hI),pI=2*VI;T[pI]=ZI*Math.cos(dI),T[pI+1]=ZI*Math.sin(dI),S[pI]=T[pI],S[pI+1]=-T[pI+1]}this._slicedChirpBuffer=T.subarray(H,E),this._f=new V(C>>1),this._f.transform(this._chirpBuffer,S)}_transform(y,H,E){let C=this._buffer1,T=this._buffer2,S=this._outBuffer1,cI=this._outBuffer2,hI=this._chirpBuffer,WI=this._slicedChirpBuffer,VI=this._a;if(E)for(let sI=0;sI<WI.length;sI+=2){let ZI=sI+1,dI=sI>>1,pI=H[dI];C[sI]=pI*WI[sI],C[ZI]=pI*WI[ZI]}else for(let sI=0;sI<WI.length;sI+=2){let ZI=sI+1;C[sI]=H[sI]*WI[sI]-H[ZI]*WI[ZI],C[ZI]=H[sI]*WI[ZI]+H[ZI]*WI[sI]}this._f.transform(S,C);for(let sI=0;sI<hI.length;sI+=2){let ZI=sI+1;T[sI]=S[sI]*hI[sI]-S[ZI]*hI[ZI],T[ZI]=S[sI]*hI[ZI]+S[ZI]*hI[sI]}this._f.inverseTransform(cI,T);for(let sI=0;sI<cI.length;sI+=2){let ZI=cI[sI+VI],dI=cI[sI+VI+1],pI=WI[sI],yI=WI[sI+1];y[sI]=ZI*pI-dI*yI,y[sI+1]=ZI*yI+dI*pI}}transform(y,H){this._transform(y,H,!1)}realTransform(y,H){this._transform(y,H,!0)}}class p{constructor(y){this.fft_length=y,this.isPowerOfTwo=h(y),this.isPowerOfTwo?(this.fft=new V(y),this.outputBufferSize=2*y):(this.fft=new X(y),this.outputBufferSize=this.fft.bufferSize)}realTransform(y,H){this.fft.realTransform(y,H)}transform(y,H){this.fft.transform(y,H)}}function F(o,y){if(y%2===0||y<=0)throw new Error("Window size must be a positive odd number");let H=new o.constructor(o.length),E=new o.constructor(y),C=Math.floor(y/2);for(let T=0;T<o.length;++T){let S=0;for(let cI=-C;cI<=C;++cI){let hI=T+cI;hI<0?hI=Math.abs(hI):hI>=o.length&&(hI=2*(o.length-1)-hI),E[S++]=o[hI]}E.sort(),H[T]=E[C]}return H}function a(o,y){let H=Math.pow(10,y);return Math.round(o*H)/H}function u(o){let y=Math.round(o);return Math.abs(o)%1===.5?y%2===0?y:y-1:y}function Q(o){let y=o.length,H=o[0].length,E=[y+1,H+1],C=Array.from({length:E[0]},()=>Array(E[1]).fill(1/0));C[0][0]=0;let T=Array.from({length:E[0]},()=>Array(E[1]).fill(-1));for(let VI=1;VI<E[1];++VI)for(let sI=1;sI<E[0];++sI){let ZI=C[sI-1][VI-1],dI=C[sI-1][VI],pI=C[sI][VI-1],yI,eI;ZI<dI&&ZI<pI?(yI=ZI,eI=0):dI<ZI&&dI<pI?(yI=dI,eI=1):(yI=pI,eI=2),C[sI][VI]=o[sI-1][VI-1]+yI,T[sI][VI]=eI}for(let VI=0;VI<E[1];++VI)T[0][VI]=2;for(let VI=0;VI<E[0];++VI)T[VI][0]=1;let S=y,cI=H,hI=[],WI=[];for(;S>0||cI>0;)switch(hI.push(S-1),WI.push(cI-1),T[S][cI]){case 0:--S,--cI;break;case 1:--S;break;case 2:--cI;break;default:throw new Error(`Internal error in dynamic time warping. Unexpected trace[${S}, ${cI}]. Please file a bug report.`)}return hI.reverse(),WI.reverse(),[hI,WI]}},"./src/utils/tensor.js":(I,G,l)=>{l.r(G),l.d(G,{Tensor:()=>W,cat:()=>H,full:()=>WI,full_like:()=>VI,interpolate:()=>N,interpolate_4d:()=>m,layer_norm:()=>u,matmul:()=>h,mean:()=>S,mean_pooling:()=>a,ones:()=>sI,ones_like:()=>ZI,permute:()=>s,quantize_embeddings:()=>eI,rand:()=>yI,rfft:()=>V,slice:()=>F,stack:()=>E,std_mean:()=>T,topk:()=>X,zeros:()=>dI,zeros_like:()=>pI});var b=l("./src/utils/maths.js"),d=l("./src/backends/onnx.js"),e=l("./src/ops/registry.js");let t=Object.freeze({float32:Float32Array,float16:Uint16Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array,uint4:Uint8Array,int4:Int8Array});class W{get dims(){return this.ort_tensor.dims}set dims(YI){this.ort_tensor.dims=YI}get type(){return this.ort_tensor.type}get data(){return this.ort_tensor.data}get size(){return this.ort_tensor.size}get location(){return this.ort_tensor.location}ort_tensor;constructor(...YI){return(0,d.isONNXTensor)(YI[0])?this.ort_tensor=YI[0]:this.ort_tensor=new d.Tensor(YI[0],YI[1],YI[2]),new Proxy(this,{get:($,JI)=>{if(typeof JI=="string"){let UI=Number(JI);if(Number.isInteger(UI))return $._getitem(UI)}return $[JI]},set:($,JI,UI)=>$[JI]=UI})}dispose(){this.ort_tensor.dispose()}*[Symbol.iterator](){let[YI,...$]=this.dims;if($.length>0){let JI=$.reduce((UI,zI)=>UI*zI);for(let UI=0;UI<YI;++UI)yield this._subarray(UI,JI,$)}else yield*this.data}_getitem(YI){let[$,...JI]=this.dims;if(YI=y(YI,$),JI.length>0){let UI=JI.reduce((zI,L)=>zI*L);return this._subarray(YI,UI,JI)}else return new W(this.type,[this.data[YI]],JI)}indexOf(YI){let $=this.data;for(let JI=0;JI<$.length;++JI)if($[JI]==YI)return JI;return-1}_subarray(YI,$,JI){let UI=YI*$,zI=(YI+1)*$,L="subarray"in this.data?this.data.subarray(UI,zI):this.data.slice(UI,zI);return new W(this.type,L,JI)}item(){let YI=this.data;if(YI.length!==1)throw new Error(`a Tensor with ${YI.length} elements cannot be converted to Scalar`);return YI[0]}tolist(){return n(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){let YI=this.data;for(let $=0;$<YI.length;++$)YI[$]=1/(1+Math.exp(-YI[$]));return this}map(YI){return this.clone().map_(YI)}map_(YI){let $=this.data;for(let JI=0;JI<$.length;++JI)$[JI]=YI($[JI],JI,$);return this}mul(YI){return this.clone().mul_(YI)}mul_(YI){let $=this.data;for(let JI=0;JI<$.length;++JI)$[JI]*=YI;return this}div(YI){return this.clone().div_(YI)}div_(YI){let $=this.data;for(let JI=0;JI<$.length;++JI)$[JI]/=YI;return this}add(YI){return this.clone().add_(YI)}add_(YI){let $=this.data;for(let JI=0;JI<$.length;++JI)$[JI]+=YI;return this}sub(YI){return this.clone().sub_(YI)}sub_(YI){let $=this.data;for(let JI=0;JI<$.length;++JI)$[JI]-=YI;return this}clone(){return new W(this.type,this.data.slice(),this.dims.slice())}slice(...YI){let $=[],JI=[];for(let U=0;U<this.dims.length;++U){let k=YI[U];if(k==null)JI.push([0,this.dims[U]]),$.push(this.dims[U]);else if(typeof k=="number")k=y(k,this.dims[U],U),JI.push([k,k+1]);else if(Array.isArray(k)&&k.length===2){let[w,r]=k;if(w=w===null?0:y(w,this.dims[U],U,!1),r=r===null?this.dims[U]:y(r,this.dims[U],U,!1),w>r)throw new Error(`Invalid slice: ${k}`);let A=[Math.max(w,0),Math.min(r,this.dims[U])];JI.push(A),$.push(A[1]-A[0])}else throw new Error(`Invalid slice: ${k}`)}let UI=JI.map(([U,k])=>k-U),zI=UI.reduce((U,k)=>U*k),L=this.data,bI=new L.constructor(zI),FI=this.stride();for(let U=0;U<zI;++U){let k=0;for(let w=UI.length-1,r=U;w>=0;--w){let A=UI[w];k+=(r%A+JI[w][0])*FI[w],r=Math.floor(r/A)}bI[U]=L[k]}return new W(this.type,bI,$)}permute(...YI){return s(this,YI)}transpose(...YI){return this.permute(...YI)}sum(YI=null,$=!1){return this.norm(1,YI,$)}norm(YI="fro",$=null,JI=!1){if(YI==="fro")YI=2;else if(typeof YI=="string")throw Error(`Unsupported norm: ${YI}`);let UI=this.data,zI=(U,k)=>U+k**YI;if($===null){let U=UI.reduce(zI,0)**(1/YI);return new W(this.type,[U],[])}let[L,bI,FI]=C(zI,this,$,JI);if(YI!==1)for(let U=0;U<bI.length;++U)bI[U]=bI[U]**(1/YI);return new W(L,bI,FI)}normalize_(YI=2,$=1){$=y($,this.dims.length);let JI=this.norm(YI,$,!0),UI=this.data,zI=JI.data;for(let L=0;L<UI.length;++L){let bI=0;for(let FI=this.dims.length-1,U=L,k=1;FI>=0;--FI){let w=this.dims[FI];if(FI!==$){let r=U%w;bI+=r*k,k*=this.dims[FI]}U=Math.floor(U/w)}UI[L]/=zI[bI]}return this}normalize(YI=2,$=1){return this.clone().normalize_(YI,$)}stride(){return cI(this.dims)}squeeze(YI=null){return new W(this.type,this.data,Q(this.dims,YI))}squeeze_(YI=null){return this.dims=Q(this.dims,YI),this}unsqueeze(YI=null){return new W(this.type,this.data,o(this.dims,YI))}unsqueeze_(YI=null){return this.dims=o(this.dims,YI),this}flatten_(YI=0,$=-1){$=($+this.dims.length)%this.dims.length;let JI=this.dims.slice(0,YI),UI=this.dims.slice(YI,$+1),zI=this.dims.slice($+1);return this.dims=[...JI,UI.reduce((L,bI)=>L*bI,1),...zI],this}flatten(YI=0,$=-1){return this.clone().flatten_(YI,$)}view(...YI){let $=-1;for(let UI=0;UI<YI.length;++UI)if(YI[UI]===-1){if($!==-1)throw new Error("Only one dimension can be inferred");$=UI}let JI=this.data;if($!==-1){let UI=YI.reduce((zI,L,bI)=>bI!==$?zI*L:zI,1);YI[$]=JI.length/UI}return new W(this.type,JI,YI)}neg_(){let YI=this.data;for(let $=0;$<YI.length;++$)YI[$]=-YI[$];return this}neg(){return this.clone().neg_()}gt(YI){let $=new Uint8Array(this.data.length),JI=this.data;for(let UI=0;UI<JI.length;++UI)$[UI]=JI[UI]>YI?1:0;return new W("bool",$,this.dims)}lt(YI){let $=new Uint8Array(this.data.length),JI=this.data;for(let UI=0;UI<JI.length;++UI)$[UI]=JI[UI]<YI?1:0;return new W("bool",$,this.dims)}clamp_(YI,$){let JI=this.data;for(let UI=0;UI<JI.length;++UI)JI[UI]=Math.min(Math.max(JI[UI],YI),$);return this}clamp(YI,$){return this.clone().clamp_(YI,$)}round_(){let YI=this.data;for(let $=0;$<YI.length;++$)YI[$]=Math.round(YI[$]);return this}round(){return this.clone().round_()}mean(YI=null,$=!1){return S(this,YI,$)}min(YI=null,$=!1){if(YI===null){let L=(0,b.min)(this.data)[0];return new W(this.type,[L],[])}let[JI,UI,zI]=C((L,bI)=>Math.min(L,bI),this,YI,$,1/0);return new W(JI,UI,zI)}max(YI=null,$=!1){if(YI===null){let L=(0,b.max)(this.data)[0];return new W(this.type,[L],[])}let[JI,UI,zI]=C((L,bI)=>Math.max(L,bI),this,YI,$,-1/0);return new W(JI,UI,zI)}argmin(YI=null,$=!1){if(YI!==null)throw new Error("`dim !== null` not yet implemented.");let JI=(0,b.min)(this.data)[1];return new W("int64",[BigInt(JI)],[])}argmax(YI=null,$=!1){if(YI!==null)throw new Error("`dim !== null` not yet implemented.");let JI=(0,b.max)(this.data)[1];return new W("int64",[BigInt(JI)],[])}to(YI){if(this.type===YI)return this;if(!t.hasOwnProperty(YI))throw new Error(`Unsupported type: ${YI}`);let $,JI=["int64","uint64"].includes(this.type),UI=["int64","uint64"].includes(YI);return JI&&!UI?$=Number:!JI&&UI&&($=BigInt),new W(YI,t[YI].from(this.data,$),this.dims)}}function n(HI,YI){let $=HI.length,JI=YI.reduce((zI,L)=>zI*L);if($!==JI)throw Error(`cannot reshape array of size ${$} into shape (${YI})`);let UI=HI;for(let zI=YI.length-1;zI>=0;zI--)UI=UI.reduce((L,bI)=>{let FI=L[L.length-1];return FI.length<YI[zI]?FI.push(bI):L.push([bI]),L},[[]]);return UI[0]}function s(HI,YI){let[$,JI]=(0,b.permute_data)(HI.data,HI.dims,YI);return new W(HI.type,$,JI)}function N(HI,[YI,$],JI="bilinear",UI=!1){let zI=HI.dims.at(-3)??1,L=HI.dims.at(-2),bI=HI.dims.at(-1),FI=(0,b.interpolate_data)(HI.data,[zI,L,bI],[YI,$],JI,UI);return new W(HI.type,FI,[zI,YI,$])}async function m(HI,{size:YI=null,mode:$="bilinear"}={}){if(HI.dims.length!==4)throw new Error("`interpolate_4d` currently only supports 4D input.");if(!YI)throw new Error("`interpolate_4d` requires a `size` argument.");let JI;if(YI.length===2)JI=[...HI.dims.slice(0,2),...YI];else if(YI.length===3)JI=[HI.dims[0],...YI];else if(YI.length===4)JI=YI;else throw new Error("`size` must be of length 2, 3, or 4.");let UI;if($==="nearest")UI=await e.TensorOpRegistry.nearest_interpolate_4d;else if($==="bilinear")UI=await e.TensorOpRegistry.bilinear_interpolate_4d;else if($==="bicubic")UI=await e.TensorOpRegistry.bicubic_interpolate_4d;else throw new Error(`Unsupported mode: ${$}`);let zI=new W("int64",new BigInt64Array(JI.map(BigInt)),[JI.length]);return await UI({x:HI,s:zI})}async function h(HI,YI){return await(await e.TensorOpRegistry.matmul)({a:HI,b:YI})}async function V(HI,YI){return await(await e.TensorOpRegistry.rfft)({x:HI,a:YI})}async function X(HI,YI){let $=await e.TensorOpRegistry.top_k;return YI==null?YI=HI.dims.at(-1):YI=Math.min(YI,HI.dims.at(-1)),await $({x:HI,k:new W("int64",[BigInt(YI)],[1])})}let p=HI=>new W("int64",HI,[HI.length]);async function F(HI,YI,$,JI,UI){return await(await e.TensorOpRegistry.slice)({x:HI,s:p(YI),e:p($),a:p(JI),t:p(UI??new Array(JI.length).fill(1))})}function a(HI,YI){let $=HI.data,JI=YI.data,UI=[HI.dims[0],HI.dims[2]],zI=new $.constructor(UI[0]*UI[1]),[L,bI,FI]=HI.dims,U=0;for(let k=0;k<L;++k){let w=k*FI*bI;for(let r=0;r<FI;++r){let A=0,O=0,K=k*bI,q=w+r;for(let tI=0;tI<bI;++tI){let iI=Number(JI[K+tI]);O+=iI,A+=$[q+tI*FI]*iI}let GI=A/O;zI[U++]=GI}}return new W(HI.type,zI,UI)}function u(HI,YI,{eps:$=1e-5}={}){if(HI.dims.length!==2)throw new Error("`layer_norm` currently only supports 2D input.");let[JI,UI]=HI.dims;if(YI.length!==1&&YI[0]!==UI)throw new Error("`normalized_shape` must be a 1D array with shape `[input.dims[1]]`.");let[zI,L]=T(HI,1,0,!0),bI=zI.data,FI=L.data,U=HI.data,k=new U.constructor(U.length);for(let w=0;w<JI;++w){let r=w*UI;for(let A=0;A<UI;++A){let O=r+A;k[O]=(U[O]-FI[w])/(bI[w]+$)}}return new W(HI.type,k,HI.dims)}function Q(HI,YI){return HI=HI.slice(),YI===null?HI=HI.filter($=>$!==1):typeof YI=="number"?HI[YI]===1&&HI.splice(YI,1):Array.isArray(YI)&&(HI=HI.filter(($,JI)=>$!==1||!YI.includes(JI))),HI}function o(HI,YI){return YI=y(YI,HI.length+1),HI=HI.slice(),HI.splice(YI,0,1),HI}function y(HI,YI,$=null,JI=!0){if(JI&&(HI<-YI||HI>=YI))throw new Error(`IndexError: index ${HI} is out of bounds for dimension${$===null?"":" "+$} with size ${YI}`);return HI<0&&(HI=(HI%YI+YI)%YI),HI}function H(HI,YI=0){YI=y(YI,HI[0].dims.length);let $=HI[0].dims.slice();$[YI]=HI.reduce((L,bI)=>L+bI.dims[YI],0);let JI=$.reduce((L,bI)=>L*bI,1),UI=new HI[0].data.constructor(JI),zI=HI[0].type;if(YI===0){let L=0;for(let bI of HI){let FI=bI.data;UI.set(FI,L),L+=FI.length}}else{let L=0;for(let bI=0;bI<HI.length;++bI){let{data:FI,dims:U}=HI[bI];for(let k=0;k<FI.length;++k){let w=0;for(let r=U.length-1,A=k,O=1;r>=0;--r){let K=U[r],q=A%K;r===YI&&(q+=L),w+=q*O,O*=$[r],A=Math.floor(A/K)}UI[w]=FI[k]}L+=U[YI]}}return new W(zI,UI,$)}function E(HI,YI=0){return H(HI.map($=>$.unsqueeze(YI)),YI)}function C(HI,YI,$=null,JI=!1,UI=null){let zI=YI.data,L=YI.dims;$=y($,L.length);let bI=L.slice();bI[$]=1;let FI=new zI.constructor(zI.length/L[$]);UI!==null&&FI.fill(UI);for(let U=0;U<zI.length;++U){let k=0;for(let w=L.length-1,r=U,A=1;w>=0;--w){let O=L[w];if(w!==$){let K=r%O;k+=K*A,A*=bI[w]}r=Math.floor(r/O)}FI[k]=HI(FI[k],zI[U],U,k)}return JI||bI.splice($,1),[YI.type,FI,bI]}function T(HI,YI=null,$=1,JI=!1){let UI=HI.data,zI=HI.dims;if(YI===null){let A=UI.reduce((GI,tI)=>GI+tI,0)/UI.length,O=Math.sqrt(UI.reduce((GI,tI)=>GI+(tI-A)**2,0)/(UI.length-$)),K=new W(HI.type,[A],[]);return[new W(HI.type,[O],[]),K]}YI=y(YI,zI.length);let L=S(HI,YI,JI),bI=L.data,[FI,U,k]=C((r,A,O,K)=>r+(A-bI[K])**2,HI,YI,JI);for(let r=0;r<U.length;++r)U[r]=Math.sqrt(U[r]/(zI[YI]-$));return[new W(FI,U,k),L]}function S(HI,YI=null,$=!1){let JI=HI.dims,UI=HI.data;if(YI===null){let FI=UI.reduce((U,k)=>U+k,0);return new W(HI.type,[FI/UI.length],[])}YI=y(YI,JI.length);let[zI,L,bI]=C((FI,U)=>FI+U,HI,YI,$);if(JI[YI]!==1)for(let FI=0;FI<L.length;++FI)L[FI]/=JI[YI];return new W(zI,L,bI)}function cI(HI){let YI=new Array(HI.length);for(let $=HI.length-1,JI=1;$>=0;--$)YI[$]=JI,JI*=HI[$];return YI}function hI(HI,YI,$,JI){let UI=HI.reduce((zI,L)=>zI*L,1);return new W($,new JI(UI).fill(YI),HI)}function WI(HI,YI){let $,JI;if(typeof YI=="number")$="float32",JI=Float32Array;else if(typeof YI=="bigint")$="int64",JI=BigInt64Array;else if(typeof YI=="boolean")$="bool",JI=Uint8Array;else throw new Error(`Unsupported data type: ${typeof YI}`);return hI(HI,YI,$,JI)}function VI(HI,YI){return WI(HI.dims,YI)}function sI(HI){return hI(HI,1n,"int64",BigInt64Array)}function ZI(HI){return sI(HI.dims)}function dI(HI){return hI(HI,0n,"int64",BigInt64Array)}function pI(HI){return dI(HI.dims)}function yI(HI){let YI=HI.reduce(($,JI)=>$*JI,1);return new W("float32",Float32Array.from({length:YI},()=>Math.random()),HI)}function eI(HI,YI){if(HI.dims.length!==2)throw new Error("The tensor must have 2 dimensions");if(HI.dims.at(-1)%8!==0)throw new Error("The last dimension of the tensor must be a multiple of 8");if(!["binary","ubinary"].includes(YI))throw new Error("The precision must be either 'binary' or 'ubinary'");let $=YI==="binary",JI=$?"int8":"uint8",UI=$?Int8Array:Uint8Array,zI=HI.data,L=new UI(zI.length/8);for(let bI=0;bI<zI.length;++bI){let FI=zI[bI]>0?1:0,U=Math.floor(bI/8),k=bI%8;L[U]|=FI<<7-k,$&&k===0&&(L[U]-=128)}return new W(JI,L,[HI.dims[0],HI.dims[1]/8])}}},BQ={};function zG(I){var G=BQ[I];if(G!==void 0)return G.exports;var l=BQ[I]={exports:{}};return OQ[I](l,l.exports,zG),l.exports}zG.m=OQ;(()=>{var I=Object.getPrototypeOf?l=>Object.getPrototypeOf(l):l=>l.__proto__,G;zG.t=function(l,b){if(b&1&&(l=this(l)),b&8||typeof l=="object"&&l&&(b&4&&l.__esModule||b&16&&typeof l.then=="function"))return l;var d=Object.create(null);zG.r(d);var e={};G=G||[null,I({}),I([]),I(I)];for(var t=b&2&&l;typeof t=="object"&&!~G.indexOf(t);t=I(t))Object.getOwnPropertyNames(t).forEach(W=>e[W]=()=>l[W]);return e.default=()=>l,zG.d(d,e),d}})();zG.d=(I,G)=>{for(var l in G)zG.o(G,l)&&!zG.o(I,l)&&Object.defineProperty(I,l,{enumerable:!0,get:G[l]})};zG.o=(I,G)=>Object.prototype.hasOwnProperty.call(I,G);zG.r=I=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(I,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(I,"__esModule",{value:!0})};(()=>{var I;if(typeof import.meta.url=="string"&&(I=import.meta.url),!I)throw new Error("Automatic publicPath is not supported in this browser");I=I.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),zG.p=I})();(()=>{zG.b=new URL(import.meta.url);var I={transformers:0}})();var z={};(()=>{zG.r(z),zG.d(z,{ASTFeatureExtractor:()=>N.ASTFeatureExtractor,ASTForAudioClassification:()=>l.ASTForAudioClassification,ASTModel:()=>l.ASTModel,ASTPreTrainedModel:()=>l.ASTPreTrainedModel,AlbertForMaskedLM:()=>l.AlbertForMaskedLM,AlbertForQuestionAnswering:()=>l.AlbertForQuestionAnswering,AlbertForSequenceClassification:()=>l.AlbertForSequenceClassification,AlbertModel:()=>l.AlbertModel,AlbertPreTrainedModel:()=>l.AlbertPreTrainedModel,AlbertTokenizer:()=>b.AlbertTokenizer,AudioClassificationPipeline:()=>G.AudioClassificationPipeline,AutoConfig:()=>d.AutoConfig,AutoFeatureExtractor:()=>m.AutoFeatureExtractor,AutoImageProcessor:()=>X.AutoImageProcessor,AutoModel:()=>l.AutoModel,AutoModelForAudioClassification:()=>l.AutoModelForAudioClassification,AutoModelForAudioFrameClassification:()=>l.AutoModelForAudioFrameClassification,AutoModelForCTC:()=>l.AutoModelForCTC,AutoModelForCausalLM:()=>l.AutoModelForCausalLM,AutoModelForDepthEstimation:()=>l.AutoModelForDepthEstimation,AutoModelForDocumentQuestionAnswering:()=>l.AutoModelForDocumentQuestionAnswering,AutoModelForImageClassification:()=>l.AutoModelForImageClassification,AutoModelForImageFeatureExtraction:()=>l.AutoModelForImageFeatureExtraction,AutoModelForImageMatting:()=>l.AutoModelForImageMatting,AutoModelForImageSegmentation:()=>l.AutoModelForImageSegmentation,AutoModelForImageToImage:()=>l.AutoModelForImageToImage,AutoModelForMaskGeneration:()=>l.AutoModelForMaskGeneration,AutoModelForMaskedLM:()=>l.AutoModelForMaskedLM,AutoModelForNormalEstimation:()=>l.AutoModelForNormalEstimation,AutoModelForObjectDetection:()=>l.AutoModelForObjectDetection,AutoModelForPoseEstimation:()=>l.AutoModelForPoseEstimation,AutoModelForQuestionAnswering:()=>l.AutoModelForQuestionAnswering,AutoModelForSemanticSegmentation:()=>l.AutoModelForSemanticSegmentation,AutoModelForSeq2SeqLM:()=>l.AutoModelForSeq2SeqLM,AutoModelForSequenceClassification:()=>l.AutoModelForSequenceClassification,AutoModelForSpeechSeq2Seq:()=>l.AutoModelForSpeechSeq2Seq,AutoModelForTextToSpectrogram:()=>l.AutoModelForTextToSpectrogram,AutoModelForTextToWaveform:()=>l.AutoModelForTextToWaveform,AutoModelForTokenClassification:()=>l.AutoModelForTokenClassification,AutoModelForUniversalSegmentation:()=>l.AutoModelForUniversalSegmentation,AutoModelForVision2Seq:()=>l.AutoModelForVision2Seq,AutoModelForXVector:()=>l.AutoModelForXVector,AutoModelForZeroShotObjectDetection:()=>l.AutoModelForZeroShotObjectDetection,AutoProcessor:()=>a.AutoProcessor,AutoTokenizer:()=>b.AutoTokenizer,AutomaticSpeechRecognitionPipeline:()=>G.AutomaticSpeechRecognitionPipeline,BartForConditionalGeneration:()=>l.BartForConditionalGeneration,BartForSequenceClassification:()=>l.BartForSequenceClassification,BartModel:()=>l.BartModel,BartPretrainedModel:()=>l.BartPretrainedModel,BartTokenizer:()=>b.BartTokenizer,BaseModelOutput:()=>l.BaseModelOutput,BaseStreamer:()=>u.BaseStreamer,BeitFeatureExtractor:()=>V.BeitFeatureExtractor,BeitForImageClassification:()=>l.BeitForImageClassification,BeitModel:()=>l.BeitModel,BeitPreTrainedModel:()=>l.BeitPreTrainedModel,BertForMaskedLM:()=>l.BertForMaskedLM,BertForQuestionAnswering:()=>l.BertForQuestionAnswering,BertForSequenceClassification:()=>l.BertForSequenceClassification,BertForTokenClassification:()=>l.BertForTokenClassification,BertModel:()=>l.BertModel,BertPreTrainedModel:()=>l.BertPreTrainedModel,BertTokenizer:()=>b.BertTokenizer,BitImageProcessor:()=>V.BitImageProcessor,BlenderbotForConditionalGeneration:()=>l.BlenderbotForConditionalGeneration,BlenderbotModel:()=>l.BlenderbotModel,BlenderbotPreTrainedModel:()=>l.BlenderbotPreTrainedModel,BlenderbotSmallForConditionalGeneration:()=>l.BlenderbotSmallForConditionalGeneration,BlenderbotSmallModel:()=>l.BlenderbotSmallModel,BlenderbotSmallPreTrainedModel:()=>l.BlenderbotSmallPreTrainedModel,BlenderbotSmallTokenizer:()=>b.BlenderbotSmallTokenizer,BlenderbotTokenizer:()=>b.BlenderbotTokenizer,BloomForCausalLM:()=>l.BloomForCausalLM,BloomModel:()=>l.BloomModel,BloomPreTrainedModel:()=>l.BloomPreTrainedModel,BloomTokenizer:()=>b.BloomTokenizer,CLIPFeatureExtractor:()=>V.CLIPFeatureExtractor,CLIPImageProcessor:()=>V.CLIPImageProcessor,CLIPModel:()=>l.CLIPModel,CLIPPreTrainedModel:()=>l.CLIPPreTrainedModel,CLIPSegForImageSegmentation:()=>l.CLIPSegForImageSegmentation,CLIPSegModel:()=>l.CLIPSegModel,CLIPSegPreTrainedModel:()=>l.CLIPSegPreTrainedModel,CLIPTextModel:()=>l.CLIPTextModel,CLIPTextModelWithProjection:()=>l.CLIPTextModelWithProjection,CLIPTokenizer:()=>b.CLIPTokenizer,CLIPVisionModel:()=>l.CLIPVisionModel,CLIPVisionModelWithProjection:()=>l.CLIPVisionModelWithProjection,CamembertForMaskedLM:()=>l.CamembertForMaskedLM,CamembertForQuestionAnswering:()=>l.CamembertForQuestionAnswering,CamembertForSequenceClassification:()=>l.CamembertForSequenceClassification,CamembertForTokenClassification:()=>l.CamembertForTokenClassification,CamembertModel:()=>l.CamembertModel,CamembertPreTrainedModel:()=>l.CamembertPreTrainedModel,CamembertTokenizer:()=>b.CamembertTokenizer,CausalLMOutput:()=>l.CausalLMOutput,CausalLMOutputWithPast:()=>l.CausalLMOutputWithPast,ChineseCLIPFeatureExtractor:()=>V.ChineseCLIPFeatureExtractor,ChineseCLIPModel:()=>l.ChineseCLIPModel,ChineseCLIPPreTrainedModel:()=>l.ChineseCLIPPreTrainedModel,ClapAudioModelWithProjection:()=>l.ClapAudioModelWithProjection,ClapFeatureExtractor:()=>N.ClapFeatureExtractor,ClapModel:()=>l.ClapModel,ClapPreTrainedModel:()=>l.ClapPreTrainedModel,ClapTextModelWithProjection:()=>l.ClapTextModelWithProjection,ClassifierFreeGuidanceLogitsProcessor:()=>o.ClassifierFreeGuidanceLogitsProcessor,CodeGenForCausalLM:()=>l.CodeGenForCausalLM,CodeGenModel:()=>l.CodeGenModel,CodeGenPreTrainedModel:()=>l.CodeGenPreTrainedModel,CodeGenTokenizer:()=>b.CodeGenTokenizer,CodeLlamaTokenizer:()=>b.CodeLlamaTokenizer,CohereForCausalLM:()=>l.CohereForCausalLM,CohereModel:()=>l.CohereModel,CoherePreTrainedModel:()=>l.CoherePreTrainedModel,CohereTokenizer:()=>b.CohereTokenizer,ConvBertForMaskedLM:()=>l.ConvBertForMaskedLM,ConvBertForQuestionAnswering:()=>l.ConvBertForQuestionAnswering,ConvBertForSequenceClassification:()=>l.ConvBertForSequenceClassification,ConvBertForTokenClassification:()=>l.ConvBertForTokenClassification,ConvBertModel:()=>l.ConvBertModel,ConvBertPreTrainedModel:()=>l.ConvBertPreTrainedModel,ConvBertTokenizer:()=>b.ConvBertTokenizer,ConvNextFeatureExtractor:()=>V.ConvNextFeatureExtractor,ConvNextForImageClassification:()=>l.ConvNextForImageClassification,ConvNextImageProcessor:()=>V.ConvNextImageProcessor,ConvNextModel:()=>l.ConvNextModel,ConvNextPreTrainedModel:()=>l.ConvNextPreTrainedModel,ConvNextV2ForImageClassification:()=>l.ConvNextV2ForImageClassification,ConvNextV2Model:()=>l.ConvNextV2Model,ConvNextV2PreTrainedModel:()=>l.ConvNextV2PreTrainedModel,DPTFeatureExtractor:()=>V.DPTFeatureExtractor,DPTForDepthEstimation:()=>l.DPTForDepthEstimation,DPTImageProcessor:()=>V.DPTImageProcessor,DPTModel:()=>l.DPTModel,DPTPreTrainedModel:()=>l.DPTPreTrainedModel,DebertaForMaskedLM:()=>l.DebertaForMaskedLM,DebertaForQuestionAnswering:()=>l.DebertaForQuestionAnswering,DebertaForSequenceClassification:()=>l.DebertaForSequenceClassification,DebertaForTokenClassification:()=>l.DebertaForTokenClassification,DebertaModel:()=>l.DebertaModel,DebertaPreTrainedModel:()=>l.DebertaPreTrainedModel,DebertaTokenizer:()=>b.DebertaTokenizer,DebertaV2ForMaskedLM:()=>l.DebertaV2ForMaskedLM,DebertaV2ForQuestionAnswering:()=>l.DebertaV2ForQuestionAnswering,DebertaV2ForSequenceClassification:()=>l.DebertaV2ForSequenceClassification,DebertaV2ForTokenClassification:()=>l.DebertaV2ForTokenClassification,DebertaV2Model:()=>l.DebertaV2Model,DebertaV2PreTrainedModel:()=>l.DebertaV2PreTrainedModel,DebertaV2Tokenizer:()=>b.DebertaV2Tokenizer,DecisionTransformerModel:()=>l.DecisionTransformerModel,DecisionTransformerPreTrainedModel:()=>l.DecisionTransformerPreTrainedModel,DeiTFeatureExtractor:()=>V.DeiTFeatureExtractor,DeiTForImageClassification:()=>l.DeiTForImageClassification,DeiTImageProcessor:()=>V.DeiTImageProcessor,DeiTModel:()=>l.DeiTModel,DeiTPreTrainedModel:()=>l.DeiTPreTrainedModel,DepthAnythingForDepthEstimation:()=>l.DepthAnythingForDepthEstimation,DepthAnythingPreTrainedModel:()=>l.DepthAnythingPreTrainedModel,DepthEstimationPipeline:()=>G.DepthEstimationPipeline,DepthProForDepthEstimation:()=>l.DepthProForDepthEstimation,DepthProPreTrainedModel:()=>l.DepthProPreTrainedModel,DetrFeatureExtractor:()=>V.DetrFeatureExtractor,DetrForObjectDetection:()=>l.DetrForObjectDetection,DetrForSegmentation:()=>l.DetrForSegmentation,DetrImageProcessor:()=>V.DetrImageProcessor,DetrModel:()=>l.DetrModel,DetrObjectDetectionOutput:()=>l.DetrObjectDetectionOutput,DetrPreTrainedModel:()=>l.DetrPreTrainedModel,DetrSegmentationOutput:()=>l.DetrSegmentationOutput,Dinov2ForImageClassification:()=>l.Dinov2ForImageClassification,Dinov2Model:()=>l.Dinov2Model,Dinov2PreTrainedModel:()=>l.Dinov2PreTrainedModel,Dinov2WithRegistersForImageClassification:()=>l.Dinov2WithRegistersForImageClassification,Dinov2WithRegistersModel:()=>l.Dinov2WithRegistersModel,Dinov2WithRegistersPreTrainedModel:()=>l.Dinov2WithRegistersPreTrainedModel,DistilBertForMaskedLM:()=>l.DistilBertForMaskedLM,DistilBertForQuestionAnswering:()=>l.DistilBertForQuestionAnswering,DistilBertForSequenceClassification:()=>l.DistilBertForSequenceClassification,DistilBertForTokenClassification:()=>l.DistilBertForTokenClassification,DistilBertModel:()=>l.DistilBertModel,DistilBertPreTrainedModel:()=>l.DistilBertPreTrainedModel,DistilBertTokenizer:()=>b.DistilBertTokenizer,DocumentQuestionAnsweringPipeline:()=>G.DocumentQuestionAnsweringPipeline,DonutFeatureExtractor:()=>V.DonutFeatureExtractor,DonutImageProcessor:()=>V.DonutImageProcessor,DonutSwinModel:()=>l.DonutSwinModel,DonutSwinPreTrainedModel:()=>l.DonutSwinPreTrainedModel,EfficientNetForImageClassification:()=>l.EfficientNetForImageClassification,EfficientNetImageProcessor:()=>V.EfficientNetImageProcessor,EfficientNetModel:()=>l.EfficientNetModel,EfficientNetPreTrainedModel:()=>l.EfficientNetPreTrainedModel,ElectraForMaskedLM:()=>l.ElectraForMaskedLM,ElectraForQuestionAnswering:()=>l.ElectraForQuestionAnswering,ElectraForSequenceClassification:()=>l.ElectraForSequenceClassification,ElectraForTokenClassification:()=>l.ElectraForTokenClassification,ElectraModel:()=>l.ElectraModel,ElectraPreTrainedModel:()=>l.ElectraPreTrainedModel,ElectraTokenizer:()=>b.ElectraTokenizer,EosTokenCriteria:()=>Q.EosTokenCriteria,EsmForMaskedLM:()=>l.EsmForMaskedLM,EsmForSequenceClassification:()=>l.EsmForSequenceClassification,EsmForTokenClassification:()=>l.EsmForTokenClassification,EsmModel:()=>l.EsmModel,EsmPreTrainedModel:()=>l.EsmPreTrainedModel,EsmTokenizer:()=>b.EsmTokenizer,ExaoneForCausalLM:()=>l.ExaoneForCausalLM,ExaoneModel:()=>l.ExaoneModel,ExaonePreTrainedModel:()=>l.ExaonePreTrainedModel,FFT:()=>n.FFT,FalconForCausalLM:()=>l.FalconForCausalLM,FalconModel:()=>l.FalconModel,FalconPreTrainedModel:()=>l.FalconPreTrainedModel,FalconTokenizer:()=>b.FalconTokenizer,FastViTForImageClassification:()=>l.FastViTForImageClassification,FastViTModel:()=>l.FastViTModel,FastViTPreTrainedModel:()=>l.FastViTPreTrainedModel,FeatureExtractionPipeline:()=>G.FeatureExtractionPipeline,FeatureExtractor:()=>s.FeatureExtractor,FillMaskPipeline:()=>G.FillMaskPipeline,Florence2ForConditionalGeneration:()=>l.Florence2ForConditionalGeneration,Florence2PreTrainedModel:()=>l.Florence2PreTrainedModel,Florence2Processor:()=>F.Florence2Processor,ForcedBOSTokenLogitsProcessor:()=>o.ForcedBOSTokenLogitsProcessor,ForcedEOSTokenLogitsProcessor:()=>o.ForcedEOSTokenLogitsProcessor,GLPNFeatureExtractor:()=>V.GLPNFeatureExtractor,GLPNForDepthEstimation:()=>l.GLPNForDepthEstimation,GLPNModel:()=>l.GLPNModel,GLPNPreTrainedModel:()=>l.GLPNPreTrainedModel,GPT2LMHeadModel:()=>l.GPT2LMHeadModel,GPT2Model:()=>l.GPT2Model,GPT2PreTrainedModel:()=>l.GPT2PreTrainedModel,GPT2Tokenizer:()=>b.GPT2Tokenizer,GPTBigCodeForCausalLM:()=>l.GPTBigCodeForCausalLM,GPTBigCodeModel:()=>l.GPTBigCodeModel,GPTBigCodePreTrainedModel:()=>l.GPTBigCodePreTrainedModel,GPTJForCausalLM:()=>l.GPTJForCausalLM,GPTJModel:()=>l.GPTJModel,GPTJPreTrainedModel:()=>l.GPTJPreTrainedModel,GPTNeoForCausalLM:()=>l.GPTNeoForCausalLM,GPTNeoModel:()=>l.GPTNeoModel,GPTNeoPreTrainedModel:()=>l.GPTNeoPreTrainedModel,GPTNeoXForCausalLM:()=>l.GPTNeoXForCausalLM,GPTNeoXModel:()=>l.GPTNeoXModel,GPTNeoXPreTrainedModel:()=>l.GPTNeoXPreTrainedModel,GPTNeoXTokenizer:()=>b.GPTNeoXTokenizer,Gemma2ForCausalLM:()=>l.Gemma2ForCausalLM,Gemma2Model:()=>l.Gemma2Model,Gemma2PreTrainedModel:()=>l.Gemma2PreTrainedModel,GemmaForCausalLM:()=>l.GemmaForCausalLM,GemmaModel:()=>l.GemmaModel,GemmaPreTrainedModel:()=>l.GemmaPreTrainedModel,GemmaTokenizer:()=>b.GemmaTokenizer,GlmForCausalLM:()=>l.GlmForCausalLM,GlmModel:()=>l.GlmModel,GlmPreTrainedModel:()=>l.GlmPreTrainedModel,GraniteForCausalLM:()=>l.GraniteForCausalLM,GraniteModel:()=>l.GraniteModel,GranitePreTrainedModel:()=>l.GranitePreTrainedModel,Grok1Tokenizer:()=>b.Grok1Tokenizer,GroundingDinoForObjectDetection:()=>l.GroundingDinoForObjectDetection,GroundingDinoImageProcessor:()=>V.GroundingDinoImageProcessor,GroundingDinoPreTrainedModel:()=>l.GroundingDinoPreTrainedModel,GroundingDinoProcessor:()=>F.GroundingDinoProcessor,GroupViTModel:()=>l.GroupViTModel,GroupViTPreTrainedModel:()=>l.GroupViTPreTrainedModel,HeliumForCausalLM:()=>l.HeliumForCausalLM,HeliumModel:()=>l.HeliumModel,HeliumPreTrainedModel:()=>l.HeliumPreTrainedModel,HerbertTokenizer:()=>b.HerbertTokenizer,HieraForImageClassification:()=>l.HieraForImageClassification,HieraModel:()=>l.HieraModel,HieraPreTrainedModel:()=>l.HieraPreTrainedModel,HubertForCTC:()=>l.HubertForCTC,HubertForSequenceClassification:()=>l.HubertForSequenceClassification,HubertModel:()=>l.HubertModel,HubertPreTrainedModel:()=>l.HubertPreTrainedModel,IJepaForImageClassification:()=>l.IJepaForImageClassification,IJepaModel:()=>l.IJepaModel,IJepaPreTrainedModel:()=>l.IJepaPreTrainedModel,Idefics3ForConditionalGeneration:()=>l.Idefics3ForConditionalGeneration,Idefics3ImageProcessor:()=>V.Idefics3ImageProcessor,Idefics3PreTrainedModel:()=>l.Idefics3PreTrainedModel,Idefics3Processor:()=>F.Idefics3Processor,ImageClassificationPipeline:()=>G.ImageClassificationPipeline,ImageFeatureExtractionPipeline:()=>G.ImageFeatureExtractionPipeline,ImageFeatureExtractor:()=>N.ImageFeatureExtractor,ImageMattingOutput:()=>l.ImageMattingOutput,ImageProcessor:()=>h.ImageProcessor,ImageSegmentationPipeline:()=>G.ImageSegmentationPipeline,ImageToImagePipeline:()=>G.ImageToImagePipeline,ImageToTextPipeline:()=>G.ImageToTextPipeline,InterruptableStoppingCriteria:()=>Q.InterruptableStoppingCriteria,JAISLMHeadModel:()=>l.JAISLMHeadModel,JAISModel:()=>l.JAISModel,JAISPreTrainedModel:()=>l.JAISPreTrainedModel,JinaCLIPImageProcessor:()=>V.JinaCLIPImageProcessor,JinaCLIPModel:()=>l.JinaCLIPModel,JinaCLIPPreTrainedModel:()=>l.JinaCLIPPreTrainedModel,JinaCLIPProcessor:()=>F.JinaCLIPProcessor,JinaCLIPTextModel:()=>l.JinaCLIPTextModel,JinaCLIPVisionModel:()=>l.JinaCLIPVisionModel,LlamaForCausalLM:()=>l.LlamaForCausalLM,LlamaModel:()=>l.LlamaModel,LlamaPreTrainedModel:()=>l.LlamaPreTrainedModel,LlamaTokenizer:()=>b.LlamaTokenizer,LlavaForConditionalGeneration:()=>l.LlavaForConditionalGeneration,LlavaOnevisionForConditionalGeneration:()=>l.LlavaOnevisionForConditionalGeneration,LlavaOnevisionImageProcessor:()=>V.LlavaOnevisionImageProcessor,LlavaPreTrainedModel:()=>l.LlavaPreTrainedModel,LogitsProcessor:()=>o.LogitsProcessor,LogitsProcessorList:()=>o.LogitsProcessorList,LogitsWarper:()=>o.LogitsWarper,LongT5ForConditionalGeneration:()=>l.LongT5ForConditionalGeneration,LongT5Model:()=>l.LongT5Model,LongT5PreTrainedModel:()=>l.LongT5PreTrainedModel,M2M100ForConditionalGeneration:()=>l.M2M100ForConditionalGeneration,M2M100Model:()=>l.M2M100Model,M2M100PreTrainedModel:()=>l.M2M100PreTrainedModel,M2M100Tokenizer:()=>b.M2M100Tokenizer,MBart50Tokenizer:()=>b.MBart50Tokenizer,MBartForCausalLM:()=>l.MBartForCausalLM,MBartForConditionalGeneration:()=>l.MBartForConditionalGeneration,MBartForSequenceClassification:()=>l.MBartForSequenceClassification,MBartModel:()=>l.MBartModel,MBartPreTrainedModel:()=>l.MBartPreTrainedModel,MBartTokenizer:()=>b.MBartTokenizer,MPNetForMaskedLM:()=>l.MPNetForMaskedLM,MPNetForQuestionAnswering:()=>l.MPNetForQuestionAnswering,MPNetForSequenceClassification:()=>l.MPNetForSequenceClassification,MPNetForTokenClassification:()=>l.MPNetForTokenClassification,MPNetModel:()=>l.MPNetModel,MPNetPreTrainedModel:()=>l.MPNetPreTrainedModel,MPNetTokenizer:()=>b.MPNetTokenizer,MT5ForConditionalGeneration:()=>l.MT5ForConditionalGeneration,MT5Model:()=>l.MT5Model,MT5PreTrainedModel:()=>l.MT5PreTrainedModel,MarianMTModel:()=>l.MarianMTModel,MarianModel:()=>l.MarianModel,MarianPreTrainedModel:()=>l.MarianPreTrainedModel,MarianTokenizer:()=>b.MarianTokenizer,Mask2FormerImageProcessor:()=>V.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>V.MaskFormerFeatureExtractor,MaskFormerForInstanceSegmentation:()=>l.MaskFormerForInstanceSegmentation,MaskFormerImageProcessor:()=>V.MaskFormerImageProcessor,MaskFormerModel:()=>l.MaskFormerModel,MaskFormerPreTrainedModel:()=>l.MaskFormerPreTrainedModel,MaskedLMOutput:()=>l.MaskedLMOutput,MaxLengthCriteria:()=>Q.MaxLengthCriteria,MgpstrForSceneTextRecognition:()=>l.MgpstrForSceneTextRecognition,MgpstrModelOutput:()=>l.MgpstrModelOutput,MgpstrPreTrainedModel:()=>l.MgpstrPreTrainedModel,MgpstrProcessor:()=>F.MgpstrProcessor,MgpstrTokenizer:()=>b.MgpstrTokenizer,MinLengthLogitsProcessor:()=>o.MinLengthLogitsProcessor,MinNewTokensLengthLogitsProcessor:()=>o.MinNewTokensLengthLogitsProcessor,MistralForCausalLM:()=>l.MistralForCausalLM,MistralModel:()=>l.MistralModel,MistralPreTrainedModel:()=>l.MistralPreTrainedModel,MobileBertForMaskedLM:()=>l.MobileBertForMaskedLM,MobileBertForQuestionAnswering:()=>l.MobileBertForQuestionAnswering,MobileBertForSequenceClassification:()=>l.MobileBertForSequenceClassification,MobileBertModel:()=>l.MobileBertModel,MobileBertPreTrainedModel:()=>l.MobileBertPreTrainedModel,MobileBertTokenizer:()=>b.MobileBertTokenizer,MobileLLMForCausalLM:()=>l.MobileLLMForCausalLM,MobileLLMModel:()=>l.MobileLLMModel,MobileLLMPreTrainedModel:()=>l.MobileLLMPreTrainedModel,MobileNetV1FeatureExtractor:()=>V.MobileNetV1FeatureExtractor,MobileNetV1ForImageClassification:()=>l.MobileNetV1ForImageClassification,MobileNetV1ImageProcessor:()=>V.MobileNetV1ImageProcessor,MobileNetV1Model:()=>l.MobileNetV1Model,MobileNetV1PreTrainedModel:()=>l.MobileNetV1PreTrainedModel,MobileNetV2FeatureExtractor:()=>V.MobileNetV2FeatureExtractor,MobileNetV2ForImageClassification:()=>l.MobileNetV2ForImageClassification,MobileNetV2ImageProcessor:()=>V.MobileNetV2ImageProcessor,MobileNetV2Model:()=>l.MobileNetV2Model,MobileNetV2PreTrainedModel:()=>l.MobileNetV2PreTrainedModel,MobileNetV3FeatureExtractor:()=>V.MobileNetV3FeatureExtractor,MobileNetV3ForImageClassification:()=>l.MobileNetV3ForImageClassification,MobileNetV3ImageProcessor:()=>V.MobileNetV3ImageProcessor,MobileNetV3Model:()=>l.MobileNetV3Model,MobileNetV3PreTrainedModel:()=>l.MobileNetV3PreTrainedModel,MobileNetV4FeatureExtractor:()=>V.MobileNetV4FeatureExtractor,MobileNetV4ForImageClassification:()=>l.MobileNetV4ForImageClassification,MobileNetV4ImageProcessor:()=>V.MobileNetV4ImageProcessor,MobileNetV4Model:()=>l.MobileNetV4Model,MobileNetV4PreTrainedModel:()=>l.MobileNetV4PreTrainedModel,MobileViTFeatureExtractor:()=>V.MobileViTFeatureExtractor,MobileViTForImageClassification:()=>l.MobileViTForImageClassification,MobileViTImageProcessor:()=>V.MobileViTImageProcessor,MobileViTModel:()=>l.MobileViTModel,MobileViTPreTrainedModel:()=>l.MobileViTPreTrainedModel,MobileViTV2ForImageClassification:()=>l.MobileViTV2ForImageClassification,MobileViTV2Model:()=>l.MobileViTV2Model,MobileViTV2PreTrainedModel:()=>l.MobileViTV2PreTrainedModel,ModelOutput:()=>l.ModelOutput,ModernBertForMaskedLM:()=>l.ModernBertForMaskedLM,ModernBertForSequenceClassification:()=>l.ModernBertForSequenceClassification,ModernBertForTokenClassification:()=>l.ModernBertForTokenClassification,ModernBertModel:()=>l.ModernBertModel,ModernBertPreTrainedModel:()=>l.ModernBertPreTrainedModel,Moondream1ForConditionalGeneration:()=>l.Moondream1ForConditionalGeneration,MoonshineFeatureExtractor:()=>N.MoonshineFeatureExtractor,MoonshineForConditionalGeneration:()=>l.MoonshineForConditionalGeneration,MoonshineModel:()=>l.MoonshineModel,MoonshinePreTrainedModel:()=>l.MoonshinePreTrainedModel,MoonshineProcessor:()=>F.MoonshineProcessor,MptForCausalLM:()=>l.MptForCausalLM,MptModel:()=>l.MptModel,MptPreTrainedModel:()=>l.MptPreTrainedModel,MultiModalityCausalLM:()=>l.MultiModalityCausalLM,MultiModalityPreTrainedModel:()=>l.MultiModalityPreTrainedModel,MusicgenForCausalLM:()=>l.MusicgenForCausalLM,MusicgenForConditionalGeneration:()=>l.MusicgenForConditionalGeneration,MusicgenModel:()=>l.MusicgenModel,MusicgenPreTrainedModel:()=>l.MusicgenPreTrainedModel,NllbTokenizer:()=>b.NllbTokenizer,NoBadWordsLogitsProcessor:()=>o.NoBadWordsLogitsProcessor,NoRepeatNGramLogitsProcessor:()=>o.NoRepeatNGramLogitsProcessor,NomicBertModel:()=>l.NomicBertModel,NomicBertPreTrainedModel:()=>l.NomicBertPreTrainedModel,NougatImageProcessor:()=>V.NougatImageProcessor,NougatTokenizer:()=>b.NougatTokenizer,OPTForCausalLM:()=>l.OPTForCausalLM,OPTModel:()=>l.OPTModel,OPTPreTrainedModel:()=>l.OPTPreTrainedModel,ObjectDetectionPipeline:()=>G.ObjectDetectionPipeline,Olmo2ForCausalLM:()=>l.Olmo2ForCausalLM,Olmo2Model:()=>l.Olmo2Model,Olmo2PreTrainedModel:()=>l.Olmo2PreTrainedModel,OlmoForCausalLM:()=>l.OlmoForCausalLM,OlmoModel:()=>l.OlmoModel,OlmoPreTrainedModel:()=>l.OlmoPreTrainedModel,OpenELMForCausalLM:()=>l.OpenELMForCausalLM,OpenELMModel:()=>l.OpenELMModel,OpenELMPreTrainedModel:()=>l.OpenELMPreTrainedModel,OwlViTFeatureExtractor:()=>V.OwlViTFeatureExtractor,OwlViTForObjectDetection:()=>l.OwlViTForObjectDetection,OwlViTImageProcessor:()=>V.OwlViTImageProcessor,OwlViTModel:()=>l.OwlViTModel,OwlViTPreTrainedModel:()=>l.OwlViTPreTrainedModel,OwlViTProcessor:()=>F.OwlViTProcessor,Owlv2ForObjectDetection:()=>l.Owlv2ForObjectDetection,Owlv2ImageProcessor:()=>V.Owlv2ImageProcessor,Owlv2Model:()=>l.Owlv2Model,Owlv2PreTrainedModel:()=>l.Owlv2PreTrainedModel,PaliGemmaForConditionalGeneration:()=>l.PaliGemmaForConditionalGeneration,PaliGemmaPreTrainedModel:()=>l.PaliGemmaPreTrainedModel,PaliGemmaProcessor:()=>F.PaliGemmaProcessor,PatchTSMixerForPrediction:()=>l.PatchTSMixerForPrediction,PatchTSMixerModel:()=>l.PatchTSMixerModel,PatchTSMixerPreTrainedModel:()=>l.PatchTSMixerPreTrainedModel,PatchTSTForPrediction:()=>l.PatchTSTForPrediction,PatchTSTModel:()=>l.PatchTSTModel,PatchTSTPreTrainedModel:()=>l.PatchTSTPreTrainedModel,Phi3ForCausalLM:()=>l.Phi3ForCausalLM,Phi3Model:()=>l.Phi3Model,Phi3PreTrainedModel:()=>l.Phi3PreTrainedModel,Phi3VForCausalLM:()=>l.Phi3VForCausalLM,Phi3VImageProcessor:()=>V.Phi3VImageProcessor,Phi3VPreTrainedModel:()=>l.Phi3VPreTrainedModel,Phi3VProcessor:()=>F.Phi3VProcessor,PhiForCausalLM:()=>l.PhiForCausalLM,PhiModel:()=>l.PhiModel,PhiPreTrainedModel:()=>l.PhiPreTrainedModel,Pipeline:()=>G.Pipeline,PreTrainedModel:()=>l.PreTrainedModel,PreTrainedTokenizer:()=>b.PreTrainedTokenizer,PretrainedConfig:()=>d.PretrainedConfig,PretrainedMixin:()=>l.PretrainedMixin,Processor:()=>p.Processor,PvtForImageClassification:()=>l.PvtForImageClassification,PvtImageProcessor:()=>V.PvtImageProcessor,PvtModel:()=>l.PvtModel,PvtPreTrainedModel:()=>l.PvtPreTrainedModel,PyAnnoteFeatureExtractor:()=>N.PyAnnoteFeatureExtractor,PyAnnoteForAudioFrameClassification:()=>l.PyAnnoteForAudioFrameClassification,PyAnnoteModel:()=>l.PyAnnoteModel,PyAnnotePreTrainedModel:()=>l.PyAnnotePreTrainedModel,PyAnnoteProcessor:()=>F.PyAnnoteProcessor,QuestionAnsweringModelOutput:()=>l.QuestionAnsweringModelOutput,QuestionAnsweringPipeline:()=>G.QuestionAnsweringPipeline,Qwen2ForCausalLM:()=>l.Qwen2ForCausalLM,Qwen2Model:()=>l.Qwen2Model,Qwen2PreTrainedModel:()=>l.Qwen2PreTrainedModel,Qwen2Tokenizer:()=>b.Qwen2Tokenizer,Qwen2VLForConditionalGeneration:()=>l.Qwen2VLForConditionalGeneration,Qwen2VLImageProcessor:()=>V.Qwen2VLImageProcessor,Qwen2VLPreTrainedModel:()=>l.Qwen2VLPreTrainedModel,Qwen2VLProcessor:()=>F.Qwen2VLProcessor,RTDetrForObjectDetection:()=>l.RTDetrForObjectDetection,RTDetrImageProcessor:()=>V.RTDetrImageProcessor,RTDetrModel:()=>l.RTDetrModel,RTDetrObjectDetectionOutput:()=>l.RTDetrObjectDetectionOutput,RTDetrPreTrainedModel:()=>l.RTDetrPreTrainedModel,RawAudio:()=>e.RawAudio,RawImage:()=>t.RawImage,RepetitionPenaltyLogitsProcessor:()=>o.RepetitionPenaltyLogitsProcessor,ResNetForImageClassification:()=>l.ResNetForImageClassification,ResNetModel:()=>l.ResNetModel,ResNetPreTrainedModel:()=>l.ResNetPreTrainedModel,RoFormerForMaskedLM:()=>l.RoFormerForMaskedLM,RoFormerForQuestionAnswering:()=>l.RoFormerForQuestionAnswering,RoFormerForSequenceClassification:()=>l.RoFormerForSequenceClassification,RoFormerForTokenClassification:()=>l.RoFormerForTokenClassification,RoFormerModel:()=>l.RoFormerModel,RoFormerPreTrainedModel:()=>l.RoFormerPreTrainedModel,RoFormerTokenizer:()=>b.RoFormerTokenizer,RobertaForMaskedLM:()=>l.RobertaForMaskedLM,RobertaForQuestionAnswering:()=>l.RobertaForQuestionAnswering,RobertaForSequenceClassification:()=>l.RobertaForSequenceClassification,RobertaForTokenClassification:()=>l.RobertaForTokenClassification,RobertaModel:()=>l.RobertaModel,RobertaPreTrainedModel:()=>l.RobertaPreTrainedModel,RobertaTokenizer:()=>b.RobertaTokenizer,SamImageProcessor:()=>V.SamImageProcessor,SamImageSegmentationOutput:()=>l.SamImageSegmentationOutput,SamModel:()=>l.SamModel,SamPreTrainedModel:()=>l.SamPreTrainedModel,SamProcessor:()=>F.SamProcessor,SapiensForDepthEstimation:()=>l.SapiensForDepthEstimation,SapiensForNormalEstimation:()=>l.SapiensForNormalEstimation,SapiensForSemanticSegmentation:()=>l.SapiensForSemanticSegmentation,SapiensPreTrainedModel:()=>l.SapiensPreTrainedModel,SeamlessM4TFeatureExtractor:()=>N.SeamlessM4TFeatureExtractor,SegformerFeatureExtractor:()=>V.SegformerFeatureExtractor,SegformerForImageClassification:()=>l.SegformerForImageClassification,SegformerForSemanticSegmentation:()=>l.SegformerForSemanticSegmentation,SegformerImageProcessor:()=>V.SegformerImageProcessor,SegformerModel:()=>l.SegformerModel,SegformerPreTrainedModel:()=>l.SegformerPreTrainedModel,Seq2SeqLMOutput:()=>l.Seq2SeqLMOutput,SequenceClassifierOutput:()=>l.SequenceClassifierOutput,SiglipImageProcessor:()=>V.SiglipImageProcessor,SiglipModel:()=>l.SiglipModel,SiglipPreTrainedModel:()=>l.SiglipPreTrainedModel,SiglipTextModel:()=>l.SiglipTextModel,SiglipTokenizer:()=>b.SiglipTokenizer,SiglipVisionModel:()=>l.SiglipVisionModel,SpeechT5FeatureExtractor:()=>N.SpeechT5FeatureExtractor,SpeechT5ForSpeechToText:()=>l.SpeechT5ForSpeechToText,SpeechT5ForTextToSpeech:()=>l.SpeechT5ForTextToSpeech,SpeechT5HifiGan:()=>l.SpeechT5HifiGan,SpeechT5Model:()=>l.SpeechT5Model,SpeechT5PreTrainedModel:()=>l.SpeechT5PreTrainedModel,SpeechT5Processor:()=>F.SpeechT5Processor,SpeechT5Tokenizer:()=>b.SpeechT5Tokenizer,SqueezeBertForMaskedLM:()=>l.SqueezeBertForMaskedLM,SqueezeBertForQuestionAnswering:()=>l.SqueezeBertForQuestionAnswering,SqueezeBertForSequenceClassification:()=>l.SqueezeBertForSequenceClassification,SqueezeBertModel:()=>l.SqueezeBertModel,SqueezeBertPreTrainedModel:()=>l.SqueezeBertPreTrainedModel,SqueezeBertTokenizer:()=>b.SqueezeBertTokenizer,StableLmForCausalLM:()=>l.StableLmForCausalLM,StableLmModel:()=>l.StableLmModel,StableLmPreTrainedModel:()=>l.StableLmPreTrainedModel,Starcoder2ForCausalLM:()=>l.Starcoder2ForCausalLM,Starcoder2Model:()=>l.Starcoder2Model,Starcoder2PreTrainedModel:()=>l.Starcoder2PreTrainedModel,StoppingCriteria:()=>Q.StoppingCriteria,StoppingCriteriaList:()=>Q.StoppingCriteriaList,StyleTextToSpeech2Model:()=>l.StyleTextToSpeech2Model,StyleTextToSpeech2PreTrainedModel:()=>l.StyleTextToSpeech2PreTrainedModel,SummarizationPipeline:()=>G.SummarizationPipeline,SuppressTokensAtBeginLogitsProcessor:()=>o.SuppressTokensAtBeginLogitsProcessor,Swin2SRForImageSuperResolution:()=>l.Swin2SRForImageSuperResolution,Swin2SRImageProcessor:()=>V.Swin2SRImageProcessor,Swin2SRModel:()=>l.Swin2SRModel,Swin2SRPreTrainedModel:()=>l.Swin2SRPreTrainedModel,SwinForImageClassification:()=>l.SwinForImageClassification,SwinModel:()=>l.SwinModel,SwinPreTrainedModel:()=>l.SwinPreTrainedModel,T5ForConditionalGeneration:()=>l.T5ForConditionalGeneration,T5Model:()=>l.T5Model,T5PreTrainedModel:()=>l.T5PreTrainedModel,T5Tokenizer:()=>b.T5Tokenizer,TableTransformerForObjectDetection:()=>l.TableTransformerForObjectDetection,TableTransformerModel:()=>l.TableTransformerModel,TableTransformerObjectDetectionOutput:()=>l.TableTransformerObjectDetectionOutput,TableTransformerPreTrainedModel:()=>l.TableTransformerPreTrainedModel,TemperatureLogitsWarper:()=>o.TemperatureLogitsWarper,Tensor:()=>W.Tensor,Text2TextGenerationPipeline:()=>G.Text2TextGenerationPipeline,TextClassificationPipeline:()=>G.TextClassificationPipeline,TextGenerationPipeline:()=>G.TextGenerationPipeline,TextStreamer:()=>u.TextStreamer,TextToAudioPipeline:()=>G.TextToAudioPipeline,TokenClassificationPipeline:()=>G.TokenClassificationPipeline,TokenClassifierOutput:()=>l.TokenClassifierOutput,TokenizerModel:()=>b.TokenizerModel,TopKLogitsWarper:()=>o.TopKLogitsWarper,TopPLogitsWarper:()=>o.TopPLogitsWarper,TrOCRForCausalLM:()=>l.TrOCRForCausalLM,TrOCRPreTrainedModel:()=>l.TrOCRPreTrainedModel,TranslationPipeline:()=>G.TranslationPipeline,UniSpeechForCTC:()=>l.UniSpeechForCTC,UniSpeechForSequenceClassification:()=>l.UniSpeechForSequenceClassification,UniSpeechModel:()=>l.UniSpeechModel,UniSpeechPreTrainedModel:()=>l.UniSpeechPreTrainedModel,UniSpeechSatForAudioFrameClassification:()=>l.UniSpeechSatForAudioFrameClassification,UniSpeechSatForCTC:()=>l.UniSpeechSatForCTC,UniSpeechSatForSequenceClassification:()=>l.UniSpeechSatForSequenceClassification,UniSpeechSatModel:()=>l.UniSpeechSatModel,UniSpeechSatPreTrainedModel:()=>l.UniSpeechSatPreTrainedModel,VLChatProcessor:()=>F.VLChatProcessor,VLMImageProcessor:()=>V.VLMImageProcessor,ViTFeatureExtractor:()=>V.ViTFeatureExtractor,ViTForImageClassification:()=>l.ViTForImageClassification,ViTImageProcessor:()=>V.ViTImageProcessor,ViTMAEModel:()=>l.ViTMAEModel,ViTMAEPreTrainedModel:()=>l.ViTMAEPreTrainedModel,ViTMSNForImageClassification:()=>l.ViTMSNForImageClassification,ViTMSNModel:()=>l.ViTMSNModel,ViTMSNPreTrainedModel:()=>l.ViTMSNPreTrainedModel,ViTModel:()=>l.ViTModel,ViTPreTrainedModel:()=>l.ViTPreTrainedModel,VisionEncoderDecoderModel:()=>l.VisionEncoderDecoderModel,VitMatteForImageMatting:()=>l.VitMatteForImageMatting,VitMatteImageProcessor:()=>V.VitMatteImageProcessor,VitMattePreTrainedModel:()=>l.VitMattePreTrainedModel,VitPoseForPoseEstimation:()=>l.VitPoseForPoseEstimation,VitPoseImageProcessor:()=>V.VitPoseImageProcessor,VitPosePreTrainedModel:()=>l.VitPosePreTrainedModel,VitsModel:()=>l.VitsModel,VitsModelOutput:()=>l.VitsModelOutput,VitsPreTrainedModel:()=>l.VitsPreTrainedModel,VitsTokenizer:()=>b.VitsTokenizer,Wav2Vec2BertForCTC:()=>l.Wav2Vec2BertForCTC,Wav2Vec2BertForSequenceClassification:()=>l.Wav2Vec2BertForSequenceClassification,Wav2Vec2BertModel:()=>l.Wav2Vec2BertModel,Wav2Vec2BertPreTrainedModel:()=>l.Wav2Vec2BertPreTrainedModel,Wav2Vec2CTCTokenizer:()=>b.Wav2Vec2CTCTokenizer,Wav2Vec2FeatureExtractor:()=>N.Wav2Vec2FeatureExtractor,Wav2Vec2ForAudioFrameClassification:()=>l.Wav2Vec2ForAudioFrameClassification,Wav2Vec2ForCTC:()=>l.Wav2Vec2ForCTC,Wav2Vec2ForSequenceClassification:()=>l.Wav2Vec2ForSequenceClassification,Wav2Vec2Model:()=>l.Wav2Vec2Model,Wav2Vec2PreTrainedModel:()=>l.Wav2Vec2PreTrainedModel,Wav2Vec2Processor:()=>F.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>F.Wav2Vec2ProcessorWithLM,WavLMForAudioFrameClassification:()=>l.WavLMForAudioFrameClassification,WavLMForCTC:()=>l.WavLMForCTC,WavLMForSequenceClassification:()=>l.WavLMForSequenceClassification,WavLMForXVector:()=>l.WavLMForXVector,WavLMModel:()=>l.WavLMModel,WavLMPreTrainedModel:()=>l.WavLMPreTrainedModel,WeSpeakerFeatureExtractor:()=>N.WeSpeakerFeatureExtractor,WeSpeakerResNetModel:()=>l.WeSpeakerResNetModel,WeSpeakerResNetPreTrainedModel:()=>l.WeSpeakerResNetPreTrainedModel,WhisperFeatureExtractor:()=>N.WhisperFeatureExtractor,WhisperForConditionalGeneration:()=>l.WhisperForConditionalGeneration,WhisperModel:()=>l.WhisperModel,WhisperPreTrainedModel:()=>l.WhisperPreTrainedModel,WhisperProcessor:()=>F.WhisperProcessor,WhisperTextStreamer:()=>u.WhisperTextStreamer,WhisperTimeStampLogitsProcessor:()=>o.WhisperTimeStampLogitsProcessor,WhisperTokenizer:()=>b.WhisperTokenizer,XLMForQuestionAnswering:()=>l.XLMForQuestionAnswering,XLMForSequenceClassification:()=>l.XLMForSequenceClassification,XLMForTokenClassification:()=>l.XLMForTokenClassification,XLMModel:()=>l.XLMModel,XLMPreTrainedModel:()=>l.XLMPreTrainedModel,XLMRobertaForMaskedLM:()=>l.XLMRobertaForMaskedLM,XLMRobertaForQuestionAnswering:()=>l.XLMRobertaForQuestionAnswering,XLMRobertaForSequenceClassification:()=>l.XLMRobertaForSequenceClassification,XLMRobertaForTokenClassification:()=>l.XLMRobertaForTokenClassification,XLMRobertaModel:()=>l.XLMRobertaModel,XLMRobertaPreTrainedModel:()=>l.XLMRobertaPreTrainedModel,XLMRobertaTokenizer:()=>b.XLMRobertaTokenizer,XLMTokenizer:()=>b.XLMTokenizer,XLMWithLMHeadModel:()=>l.XLMWithLMHeadModel,XVectorOutput:()=>l.XVectorOutput,YolosFeatureExtractor:()=>V.YolosFeatureExtractor,YolosForObjectDetection:()=>l.YolosForObjectDetection,YolosImageProcessor:()=>V.YolosImageProcessor,YolosModel:()=>l.YolosModel,YolosObjectDetectionOutput:()=>l.YolosObjectDetectionOutput,YolosPreTrainedModel:()=>l.YolosPreTrainedModel,ZeroShotAudioClassificationPipeline:()=>G.ZeroShotAudioClassificationPipeline,ZeroShotClassificationPipeline:()=>G.ZeroShotClassificationPipeline,ZeroShotImageClassificationPipeline:()=>G.ZeroShotImageClassificationPipeline,ZeroShotObjectDetectionPipeline:()=>G.ZeroShotObjectDetectionPipeline,bankers_round:()=>n.bankers_round,cat:()=>W.cat,cos_sim:()=>n.cos_sim,dot:()=>n.dot,dynamic_time_warping:()=>n.dynamic_time_warping,env:()=>I.env,full:()=>W.full,full_like:()=>W.full_like,getKeyValueShapes:()=>d.getKeyValueShapes,hamming:()=>e.hamming,hanning:()=>e.hanning,interpolate:()=>W.interpolate,interpolate_4d:()=>W.interpolate_4d,interpolate_data:()=>n.interpolate_data,is_chinese_char:()=>b.is_chinese_char,layer_norm:()=>W.layer_norm,load_image:()=>t.load_image,log_softmax:()=>n.log_softmax,magnitude:()=>n.magnitude,matmul:()=>W.matmul,max:()=>n.max,mean:()=>W.mean,mean_pooling:()=>W.mean_pooling,medianFilter:()=>n.medianFilter,mel_filter_bank:()=>e.mel_filter_bank,min:()=>n.min,ones:()=>W.ones,ones_like:()=>W.ones_like,permute:()=>W.permute,permute_data:()=>n.permute_data,pipeline:()=>G.pipeline,quantize_embeddings:()=>W.quantize_embeddings,rand:()=>W.rand,read_audio:()=>e.read_audio,rfft:()=>W.rfft,round:()=>n.round,slice:()=>W.slice,softmax:()=>n.softmax,spectrogram:()=>e.spectrogram,stack:()=>W.stack,std_mean:()=>W.std_mean,topk:()=>W.topk,window_function:()=>e.window_function,zeros:()=>W.zeros,zeros_like:()=>W.zeros_like});var I=zG("./src/env.js"),G=zG("./src/pipelines.js"),l=zG("./src/models.js"),b=zG("./src/tokenizers.js"),d=zG("./src/configs.js"),e=zG("./src/utils/audio.js"),t=zG("./src/utils/image.js"),W=zG("./src/utils/tensor.js"),n=zG("./src/utils/maths.js"),s=zG("./src/base/feature_extraction_utils.js"),N=zG("./src/models/feature_extractors.js"),m=zG("./src/models/auto/feature_extraction_auto.js"),h=zG("./src/base/image_processors_utils.js"),V=zG("./src/models/image_processors.js"),X=zG("./src/models/auto/image_processing_auto.js"),p=zG("./src/base/processing_utils.js"),F=zG("./src/models/processors.js"),a=zG("./src/models/auto/processing_auto.js"),u=zG("./src/generation/streamers.js"),Q=zG("./src/generation/stopping_criteria.js"),o=zG("./src/generation/logits_process.js")})();var Uj=z.ASTFeatureExtractor,Mj=z.ASTForAudioClassification,Bj=z.ASTModel,Oj=z.ASTPreTrainedModel,jj=z.AlbertForMaskedLM,Kj=z.AlbertForQuestionAnswering,Tj=z.AlbertForSequenceClassification,fj=z.AlbertModel,Sj=z.AlbertPreTrainedModel,Dj=z.AlbertTokenizer,qj=z.AudioClassificationPipeline,_j=z.AutoConfig,Pj=z.AutoFeatureExtractor,$j=z.AutoImageProcessor,IK=z.AutoModel,lK=z.AutoModelForAudioClassification,GK=z.AutoModelForAudioFrameClassification,cK=z.AutoModelForCTC,bK=z.AutoModelForCausalLM,dK=z.AutoModelForDepthEstimation,ZK=z.AutoModelForDocumentQuestionAnswering,eK=z.AutoModelForImageClassification,aK=z.AutoModelForImageFeatureExtraction,WK=z.AutoModelForImageMatting,tK=z.AutoModelForImageSegmentation,nK=z.AutoModelForImageToImage,mK=z.AutoModelForMaskGeneration,NK=z.AutoModelForMaskedLM,sK=z.AutoModelForNormalEstimation,YK=z.AutoModelForObjectDetection,hK=z.AutoModelForPoseEstimation,VK=z.AutoModelForQuestionAnswering,pK=z.AutoModelForSemanticSegmentation,uK=z.AutoModelForSeq2SeqLM,RK=z.AutoModelForSequenceClassification,oK=z.AutoModelForSpeechSeq2Seq,FK=z.AutoModelForTextToSpectrogram,XK=z.AutoModelForTextToWaveform,iK=z.AutoModelForTokenClassification,QK=z.AutoModelForUniversalSegmentation,HK=z.AutoModelForVision2Seq,rK=z.AutoModelForXVector,wK=z.AutoModelForZeroShotObjectDetection,vK=z.AutoProcessor,TQ=z.AutoTokenizer,EK=z.AutomaticSpeechRecognitionPipeline,yK=z.BartForConditionalGeneration,gK=z.BartForSequenceClassification,JK=z.BartModel,CK=z.BartPretrainedModel,AK=z.BartTokenizer,LK=z.BaseModelOutput,kK=z.BaseStreamer,xK=z.BeitFeatureExtractor,zK=z.BeitForImageClassification,UK=z.BeitModel,MK=z.BeitPreTrainedModel,BK=z.BertForMaskedLM,OK=z.BertForQuestionAnswering,jK=z.BertForSequenceClassification,KK=z.BertForTokenClassification,TK=z.BertModel,fK=z.BertPreTrainedModel,SK=z.BertTokenizer,DK=z.BitImageProcessor,qK=z.BlenderbotForConditionalGeneration,_K=z.BlenderbotModel,PK=z.BlenderbotPreTrainedModel,$K=z.BlenderbotSmallForConditionalGeneration,IT=z.BlenderbotSmallModel,lT=z.BlenderbotSmallPreTrainedModel,GT=z.BlenderbotSmallTokenizer,cT=z.BlenderbotTokenizer,bT=z.BloomForCausalLM,dT=z.BloomModel,ZT=z.BloomPreTrainedModel,eT=z.BloomTokenizer,aT=z.CLIPFeatureExtractor,WT=z.CLIPImageProcessor,tT=z.CLIPModel,nT=z.CLIPPreTrainedModel,mT=z.CLIPSegForImageSegmentation,NT=z.CLIPSegModel,sT=z.CLIPSegPreTrainedModel,YT=z.CLIPTextModel,hT=z.CLIPTextModelWithProjection,VT=z.CLIPTokenizer,pT=z.CLIPVisionModel,uT=z.CLIPVisionModelWithProjection,RT=z.CamembertForMaskedLM,oT=z.CamembertForQuestionAnswering,FT=z.CamembertForSequenceClassification,XT=z.CamembertForTokenClassification,iT=z.CamembertModel,QT=z.CamembertPreTrainedModel,HT=z.CamembertTokenizer,rT=z.CausalLMOutput,wT=z.CausalLMOutputWithPast,vT=z.ChineseCLIPFeatureExtractor,ET=z.ChineseCLIPModel,yT=z.ChineseCLIPPreTrainedModel,gT=z.ClapAudioModelWithProjection,JT=z.ClapFeatureExtractor,CT=z.ClapModel,AT=z.ClapPreTrainedModel,LT=z.ClapTextModelWithProjection,kT=z.ClassifierFreeGuidanceLogitsProcessor,xT=z.CodeGenForCausalLM,zT=z.CodeGenModel,UT=z.CodeGenPreTrainedModel,MT=z.CodeGenTokenizer,BT=z.CodeLlamaTokenizer,OT=z.CohereForCausalLM,jT=z.CohereModel,KT=z.CoherePreTrainedModel,TT=z.CohereTokenizer,fT=z.ConvBertForMaskedLM,ST=z.ConvBertForQuestionAnswering,DT=z.ConvBertForSequenceClassification,qT=z.ConvBertForTokenClassification,_T=z.ConvBertModel,PT=z.ConvBertPreTrainedModel,$T=z.ConvBertTokenizer,If=z.ConvNextFeatureExtractor,lf=z.ConvNextForImageClassification,Gf=z.ConvNextImageProcessor,cf=z.ConvNextModel,bf=z.ConvNextPreTrainedModel,df=z.ConvNextV2ForImageClassification,Zf=z.ConvNextV2Model,ef=z.ConvNextV2PreTrainedModel,af=z.DPTFeatureExtractor,Wf=z.DPTForDepthEstimation,tf=z.DPTImageProcessor,nf=z.DPTModel,mf=z.DPTPreTrainedModel,Nf=z.DebertaForMaskedLM,sf=z.DebertaForQuestionAnswering,Yf=z.DebertaForSequenceClassification,hf=z.DebertaForTokenClassification,Vf=z.DebertaModel,pf=z.DebertaPreTrainedModel,uf=z.DebertaTokenizer,Rf=z.DebertaV2ForMaskedLM,of=z.DebertaV2ForQuestionAnswering,Ff=z.DebertaV2ForSequenceClassification,Xf=z.DebertaV2ForTokenClassification,Qf=z.DebertaV2Model,Hf=z.DebertaV2PreTrainedModel,rf=z.DebertaV2Tokenizer,wf=z.DecisionTransformerModel,vf=z.DecisionTransformerPreTrainedModel,Ef=z.DeiTFeatureExtractor,yf=z.DeiTForImageClassification,gf=z.DeiTImageProcessor,Jf=z.DeiTModel,Cf=z.DeiTPreTrainedModel,Af=z.DepthAnythingForDepthEstimation,Lf=z.DepthAnythingPreTrainedModel,kf=z.DepthEstimationPipeline,xf=z.DepthProForDepthEstimation,zf=z.DepthProPreTrainedModel,Uf=z.DetrFeatureExtractor,Mf=z.DetrForObjectDetection,Bf=z.DetrForSegmentation,Of=z.DetrImageProcessor,jf=z.DetrModel,Kf=z.DetrObjectDetectionOutput,Tf=z.DetrPreTrainedModel,ff=z.DetrSegmentationOutput,Sf=z.Dinov2ForImageClassification,Df=z.Dinov2Model,qf=z.Dinov2PreTrainedModel,_f=z.Dinov2WithRegistersForImageClassification,Pf=z.Dinov2WithRegistersModel,$f=z.Dinov2WithRegistersPreTrainedModel,IS=z.DistilBertForMaskedLM,lS=z.DistilBertForQuestionAnswering,GS=z.DistilBertForSequenceClassification,cS=z.DistilBertForTokenClassification,bS=z.DistilBertModel,dS=z.DistilBertPreTrainedModel,ZS=z.DistilBertTokenizer,eS=z.DocumentQuestionAnsweringPipeline,aS=z.DonutFeatureExtractor,WS=z.DonutImageProcessor,tS=z.DonutSwinModel,nS=z.DonutSwinPreTrainedModel,mS=z.EfficientNetForImageClassification,NS=z.EfficientNetImageProcessor,sS=z.EfficientNetModel,YS=z.EfficientNetPreTrainedModel,hS=z.ElectraForMaskedLM,VS=z.ElectraForQuestionAnswering,pS=z.ElectraForSequenceClassification,uS=z.ElectraForTokenClassification,RS=z.ElectraModel,oS=z.ElectraPreTrainedModel,FS=z.ElectraTokenizer,XS=z.EosTokenCriteria,iS=z.EsmForMaskedLM,QS=z.EsmForSequenceClassification,HS=z.EsmForTokenClassification,rS=z.EsmModel,wS=z.EsmPreTrainedModel,vS=z.EsmTokenizer,ES=z.ExaoneForCausalLM,yS=z.ExaoneModel,gS=z.ExaonePreTrainedModel,JS=z.FFT,CS=z.FalconForCausalLM,AS=z.FalconModel,LS=z.FalconPreTrainedModel,kS=z.FalconTokenizer,xS=z.FastViTForImageClassification,zS=z.FastViTModel,US=z.FastViTPreTrainedModel,MS=z.FeatureExtractionPipeline,BS=z.FeatureExtractor,OS=z.FillMaskPipeline,jS=z.Florence2ForConditionalGeneration,KS=z.Florence2PreTrainedModel,TS=z.Florence2Processor,fS=z.ForcedBOSTokenLogitsProcessor,SS=z.ForcedEOSTokenLogitsProcessor,DS=z.GLPNFeatureExtractor,qS=z.GLPNForDepthEstimation,_S=z.GLPNModel,PS=z.GLPNPreTrainedModel,$S=z.GPT2LMHeadModel,ID=z.GPT2Model,lD=z.GPT2PreTrainedModel,GD=z.GPT2Tokenizer,cD=z.GPTBigCodeForCausalLM,bD=z.GPTBigCodeModel,dD=z.GPTBigCodePreTrainedModel,ZD=z.GPTJForCausalLM,eD=z.GPTJModel,aD=z.GPTJPreTrainedModel,WD=z.GPTNeoForCausalLM,tD=z.GPTNeoModel,nD=z.GPTNeoPreTrainedModel,mD=z.GPTNeoXForCausalLM,ND=z.GPTNeoXModel,sD=z.GPTNeoXPreTrainedModel,YD=z.GPTNeoXTokenizer,hD=z.Gemma2ForCausalLM,VD=z.Gemma2Model,pD=z.Gemma2PreTrainedModel,uD=z.GemmaForCausalLM,RD=z.GemmaModel,oD=z.GemmaPreTrainedModel,FD=z.GemmaTokenizer,XD=z.GlmForCausalLM,iD=z.GlmModel,QD=z.GlmPreTrainedModel,HD=z.GraniteForCausalLM,rD=z.GraniteModel,wD=z.GranitePreTrainedModel,vD=z.Grok1Tokenizer,ED=z.GroundingDinoForObjectDetection,yD=z.GroundingDinoImageProcessor,gD=z.GroundingDinoPreTrainedModel,JD=z.GroundingDinoProcessor,CD=z.GroupViTModel,AD=z.GroupViTPreTrainedModel,LD=z.HeliumForCausalLM,kD=z.HeliumModel,xD=z.HeliumPreTrainedModel,zD=z.HerbertTokenizer,UD=z.HieraForImageClassification,MD=z.HieraModel,BD=z.HieraPreTrainedModel,OD=z.HubertForCTC,jD=z.HubertForSequenceClassification,KD=z.HubertModel,TD=z.HubertPreTrainedModel,fD=z.IJepaForImageClassification,SD=z.IJepaModel,DD=z.IJepaPreTrainedModel,qD=z.Idefics3ForConditionalGeneration,_D=z.Idefics3ImageProcessor,PD=z.Idefics3PreTrainedModel,$D=z.Idefics3Processor,Iq=z.ImageClassificationPipeline,lq=z.ImageFeatureExtractionPipeline,Gq=z.ImageFeatureExtractor,cq=z.ImageMattingOutput,bq=z.ImageProcessor,dq=z.ImageSegmentationPipeline,Zq=z.ImageToImagePipeline,eq=z.ImageToTextPipeline,aq=z.InterruptableStoppingCriteria,Wq=z.JAISLMHeadModel,tq=z.JAISModel,nq=z.JAISPreTrainedModel,mq=z.JinaCLIPImageProcessor,Nq=z.JinaCLIPModel,sq=z.JinaCLIPPreTrainedModel,Yq=z.JinaCLIPProcessor,hq=z.JinaCLIPTextModel,Vq=z.JinaCLIPVisionModel,pq=z.LlamaForCausalLM,uq=z.LlamaModel,Rq=z.LlamaPreTrainedModel,oq=z.LlamaTokenizer,Fq=z.LlavaForConditionalGeneration,Xq=z.LlavaOnevisionForConditionalGeneration,iq=z.LlavaOnevisionImageProcessor,Qq=z.LlavaPreTrainedModel,Hq=z.LogitsProcessor,rq=z.LogitsProcessorList,wq=z.LogitsWarper,vq=z.LongT5ForConditionalGeneration,Eq=z.LongT5Model,yq=z.LongT5PreTrainedModel,gq=z.M2M100ForConditionalGeneration,Jq=z.M2M100Model,Cq=z.M2M100PreTrainedModel,Aq=z.M2M100Tokenizer,Lq=z.MBart50Tokenizer,kq=z.MBartForCausalLM,xq=z.MBartForConditionalGeneration,zq=z.MBartForSequenceClassification,Uq=z.MBartModel,Mq=z.MBartPreTrainedModel,Bq=z.MBartTokenizer,Oq=z.MPNetForMaskedLM,jq=z.MPNetForQuestionAnswering,Kq=z.MPNetForSequenceClassification,Tq=z.MPNetForTokenClassification,fq=z.MPNetModel,Sq=z.MPNetPreTrainedModel,Dq=z.MPNetTokenizer,qq=z.MT5ForConditionalGeneration,_q=z.MT5Model,Pq=z.MT5PreTrainedModel,$q=z.MarianMTModel,I_=z.MarianModel,l_=z.MarianPreTrainedModel,G_=z.MarianTokenizer,c_=z.Mask2FormerImageProcessor,b_=z.MaskFormerFeatureExtractor,d_=z.MaskFormerForInstanceSegmentation,Z_=z.MaskFormerImageProcessor,e_=z.MaskFormerModel,a_=z.MaskFormerPreTrainedModel,W_=z.MaskedLMOutput,t_=z.MaxLengthCriteria,n_=z.MgpstrForSceneTextRecognition,m_=z.MgpstrModelOutput,N_=z.MgpstrPreTrainedModel,s_=z.MgpstrProcessor,Y_=z.MgpstrTokenizer,h_=z.MinLengthLogitsProcessor,V_=z.MinNewTokensLengthLogitsProcessor,p_=z.MistralForCausalLM,u_=z.MistralModel,R_=z.MistralPreTrainedModel,o_=z.MobileBertForMaskedLM,F_=z.MobileBertForQuestionAnswering,X_=z.MobileBertForSequenceClassification,i_=z.MobileBertModel,Q_=z.MobileBertPreTrainedModel,H_=z.MobileBertTokenizer,r_=z.MobileLLMForCausalLM,w_=z.MobileLLMModel,v_=z.MobileLLMPreTrainedModel,E_=z.MobileNetV1FeatureExtractor,y_=z.MobileNetV1ForImageClassification,g_=z.MobileNetV1ImageProcessor,J_=z.MobileNetV1Model,C_=z.MobileNetV1PreTrainedModel,A_=z.MobileNetV2FeatureExtractor,L_=z.MobileNetV2ForImageClassification,k_=z.MobileNetV2ImageProcessor,x_=z.MobileNetV2Model,z_=z.MobileNetV2PreTrainedModel,U_=z.MobileNetV3FeatureExtractor,M_=z.MobileNetV3ForImageClassification,B_=z.MobileNetV3ImageProcessor,O_=z.MobileNetV3Model,j_=z.MobileNetV3PreTrainedModel,K_=z.MobileNetV4FeatureExtractor,T_=z.MobileNetV4ForImageClassification,f_=z.MobileNetV4ImageProcessor,S_=z.MobileNetV4Model,D_=z.MobileNetV4PreTrainedModel,q_=z.MobileViTFeatureExtractor,__=z.MobileViTForImageClassification,P_=z.MobileViTImageProcessor,$_=z.MobileViTModel,I6=z.MobileViTPreTrainedModel,l6=z.MobileViTV2ForImageClassification,G6=z.MobileViTV2Model,c6=z.MobileViTV2PreTrainedModel,b6=z.ModelOutput,d6=z.ModernBertForMaskedLM,Z6=z.ModernBertForSequenceClassification,e6=z.ModernBertForTokenClassification,a6=z.ModernBertModel,W6=z.ModernBertPreTrainedModel,t6=z.Moondream1ForConditionalGeneration,n6=z.MoonshineFeatureExtractor,m6=z.MoonshineForConditionalGeneration,N6=z.MoonshineModel,s6=z.MoonshinePreTrainedModel,Y6=z.MoonshineProcessor,h6=z.MptForCausalLM,V6=z.MptModel,p6=z.MptPreTrainedModel,u6=z.MultiModalityCausalLM,R6=z.MultiModalityPreTrainedModel,o6=z.MusicgenForCausalLM,F6=z.MusicgenForConditionalGeneration,X6=z.MusicgenModel,i6=z.MusicgenPreTrainedModel,Q6=z.NllbTokenizer,H6=z.NoBadWordsLogitsProcessor,r6=z.NoRepeatNGramLogitsProcessor,w6=z.NomicBertModel,v6=z.NomicBertPreTrainedModel,E6=z.NougatImageProcessor,y6=z.NougatTokenizer,g6=z.OPTForCausalLM,J6=z.OPTModel,C6=z.OPTPreTrainedModel,A6=z.ObjectDetectionPipeline,L6=z.Olmo2ForCausalLM,k6=z.Olmo2Model,x6=z.Olmo2PreTrainedModel,z6=z.OlmoForCausalLM,U6=z.OlmoModel,M6=z.OlmoPreTrainedModel,B6=z.OpenELMForCausalLM,O6=z.OpenELMModel,j6=z.OpenELMPreTrainedModel,K6=z.OwlViTFeatureExtractor,T6=z.OwlViTForObjectDetection,f6=z.OwlViTImageProcessor,S6=z.OwlViTModel,D6=z.OwlViTPreTrainedModel,q6=z.OwlViTProcessor,_6=z.Owlv2ForObjectDetection,P6=z.Owlv2ImageProcessor,$6=z.Owlv2Model,IP=z.Owlv2PreTrainedModel,lP=z.PaliGemmaForConditionalGeneration,GP=z.PaliGemmaPreTrainedModel,cP=z.PaliGemmaProcessor,bP=z.PatchTSMixerForPrediction,dP=z.PatchTSMixerModel,ZP=z.PatchTSMixerPreTrainedModel,eP=z.PatchTSTForPrediction,aP=z.PatchTSTModel,WP=z.PatchTSTPreTrainedModel,tP=z.Phi3ForCausalLM,nP=z.Phi3Model,mP=z.Phi3PreTrainedModel,NP=z.Phi3VForCausalLM,sP=z.Phi3VImageProcessor,YP=z.Phi3VPreTrainedModel,hP=z.Phi3VProcessor,VP=z.PhiForCausalLM,pP=z.PhiModel,uP=z.PhiPreTrainedModel,RP=z.Pipeline,oP=z.PreTrainedModel,FP=z.PreTrainedTokenizer,XP=z.PretrainedConfig,iP=z.PretrainedMixin,QP=z.Processor,HP=z.PvtForImageClassification,rP=z.PvtImageProcessor,wP=z.PvtModel,vP=z.PvtPreTrainedModel,EP=z.PyAnnoteFeatureExtractor,yP=z.PyAnnoteForAudioFrameClassification,gP=z.PyAnnoteModel,JP=z.PyAnnotePreTrainedModel,CP=z.PyAnnoteProcessor,AP=z.QuestionAnsweringModelOutput,LP=z.QuestionAnsweringPipeline,kP=z.Qwen2ForCausalLM,xP=z.Qwen2Model,zP=z.Qwen2PreTrainedModel,UP=z.Qwen2Tokenizer,MP=z.Qwen2VLForConditionalGeneration,BP=z.Qwen2VLImageProcessor,OP=z.Qwen2VLPreTrainedModel,jP=z.Qwen2VLProcessor,KP=z.RTDetrForObjectDetection,TP=z.RTDetrImageProcessor,fP=z.RTDetrModel,SP=z.RTDetrObjectDetectionOutput,DP=z.RTDetrPreTrainedModel,qP=z.RawAudio,_P=z.RawImage,PP=z.RepetitionPenaltyLogitsProcessor,$P=z.ResNetForImageClassification,I7=z.ResNetModel,l7=z.ResNetPreTrainedModel,G7=z.RoFormerForMaskedLM,c7=z.RoFormerForQuestionAnswering,b7=z.RoFormerForSequenceClassification,d7=z.RoFormerForTokenClassification,Z7=z.RoFormerModel,e7=z.RoFormerPreTrainedModel,a7=z.RoFormerTokenizer,W7=z.RobertaForMaskedLM,t7=z.RobertaForQuestionAnswering,n7=z.RobertaForSequenceClassification,m7=z.RobertaForTokenClassification,N7=z.RobertaModel,s7=z.RobertaPreTrainedModel,Y7=z.RobertaTokenizer,h7=z.SamImageProcessor,V7=z.SamImageSegmentationOutput,p7=z.SamModel,u7=z.SamPreTrainedModel,R7=z.SamProcessor,o7=z.SapiensForDepthEstimation,F7=z.SapiensForNormalEstimation,X7=z.SapiensForSemanticSegmentation,i7=z.SapiensPreTrainedModel,Q7=z.SeamlessM4TFeatureExtractor,H7=z.SegformerFeatureExtractor,r7=z.SegformerForImageClassification,w7=z.SegformerForSemanticSegmentation,v7=z.SegformerImageProcessor,E7=z.SegformerModel,y7=z.SegformerPreTrainedModel,g7=z.Seq2SeqLMOutput,J7=z.SequenceClassifierOutput,C7=z.SiglipImageProcessor,A7=z.SiglipModel,L7=z.SiglipPreTrainedModel,k7=z.SiglipTextModel,x7=z.SiglipTokenizer,z7=z.SiglipVisionModel,U7=z.SpeechT5FeatureExtractor,M7=z.SpeechT5ForSpeechToText,B7=z.SpeechT5ForTextToSpeech,O7=z.SpeechT5HifiGan,j7=z.SpeechT5Model,K7=z.SpeechT5PreTrainedModel,T7=z.SpeechT5Processor,f7=z.SpeechT5Tokenizer,S7=z.SqueezeBertForMaskedLM,D7=z.SqueezeBertForQuestionAnswering,q7=z.SqueezeBertForSequenceClassification,_7=z.SqueezeBertModel,P7=z.SqueezeBertPreTrainedModel,$7=z.SqueezeBertTokenizer,I8=z.StableLmForCausalLM,l8=z.StableLmModel,G8=z.StableLmPreTrainedModel,c8=z.Starcoder2ForCausalLM,b8=z.Starcoder2Model,d8=z.Starcoder2PreTrainedModel,Z8=z.StoppingCriteria,e8=z.StoppingCriteriaList,a8=z.StyleTextToSpeech2Model,W8=z.StyleTextToSpeech2PreTrainedModel,t8=z.SummarizationPipeline,n8=z.SuppressTokensAtBeginLogitsProcessor,m8=z.Swin2SRForImageSuperResolution,N8=z.Swin2SRImageProcessor,s8=z.Swin2SRModel,Y8=z.Swin2SRPreTrainedModel,h8=z.SwinForImageClassification,V8=z.SwinModel,p8=z.SwinPreTrainedModel,u8=z.T5ForConditionalGeneration,R8=z.T5Model,o8=z.T5PreTrainedModel,F8=z.T5Tokenizer,X8=z.TableTransformerForObjectDetection,i8=z.TableTransformerModel,Q8=z.TableTransformerObjectDetectionOutput,H8=z.TableTransformerPreTrainedModel,r8=z.TemperatureLogitsWarper,w8=z.Tensor,v8=z.Text2TextGenerationPipeline,E8=z.TextClassificationPipeline,y8=z.TextGenerationPipeline,g8=z.TextStreamer,J8=z.TextToAudioPipeline,C8=z.TokenClassificationPipeline,A8=z.TokenClassifierOutput,L8=z.TokenizerModel,k8=z.TopKLogitsWarper,x8=z.TopPLogitsWarper,z8=z.TrOCRForCausalLM,U8=z.TrOCRPreTrainedModel,M8=z.TranslationPipeline,B8=z.UniSpeechForCTC,O8=z.UniSpeechForSequenceClassification,j8=z.UniSpeechModel,K8=z.UniSpeechPreTrainedModel,T8=z.UniSpeechSatForAudioFrameClassification,f8=z.UniSpeechSatForCTC,S8=z.UniSpeechSatForSequenceClassification,D8=z.UniSpeechSatModel,q8=z.UniSpeechSatPreTrainedModel,_8=z.VLChatProcessor,P8=z.VLMImageProcessor,$8=z.ViTFeatureExtractor,I$=z.ViTForImageClassification,l$=z.ViTImageProcessor,G$=z.ViTMAEModel,c$=z.ViTMAEPreTrainedModel,b$=z.ViTMSNForImageClassification,d$=z.ViTMSNModel,Z$=z.ViTMSNPreTrainedModel,e$=z.ViTModel,a$=z.ViTPreTrainedModel,W$=z.VisionEncoderDecoderModel,t$=z.VitMatteForImageMatting,n$=z.VitMatteImageProcessor,m$=z.VitMattePreTrainedModel,N$=z.VitPoseForPoseEstimation,s$=z.VitPoseImageProcessor,Y$=z.VitPosePreTrainedModel,h$=z.VitsModel,V$=z.VitsModelOutput,p$=z.VitsPreTrainedModel,u$=z.VitsTokenizer,R$=z.Wav2Vec2BertForCTC,o$=z.Wav2Vec2BertForSequenceClassification,F$=z.Wav2Vec2BertModel,X$=z.Wav2Vec2BertPreTrainedModel,i$=z.Wav2Vec2CTCTokenizer,Q$=z.Wav2Vec2FeatureExtractor,H$=z.Wav2Vec2ForAudioFrameClassification,r$=z.Wav2Vec2ForCTC,w$=z.Wav2Vec2ForSequenceClassification,v$=z.Wav2Vec2Model,E$=z.Wav2Vec2PreTrainedModel,y$=z.Wav2Vec2Processor,g$=z.Wav2Vec2ProcessorWithLM,J$=z.WavLMForAudioFrameClassification,C$=z.WavLMForCTC,A$=z.WavLMForSequenceClassification,L$=z.WavLMForXVector,k$=z.WavLMModel,x$=z.WavLMPreTrainedModel,z$=z.WeSpeakerFeatureExtractor,U$=z.WeSpeakerResNetModel,M$=z.WeSpeakerResNetPreTrainedModel,B$=z.WhisperFeatureExtractor,O$=z.WhisperForConditionalGeneration,j$=z.WhisperModel,K$=z.WhisperPreTrainedModel,T$=z.WhisperProcessor,f$=z.WhisperTextStreamer,S$=z.WhisperTimeStampLogitsProcessor,D$=z.WhisperTokenizer,q$=z.XLMForQuestionAnswering,_$=z.XLMForSequenceClassification,P$=z.XLMForTokenClassification,$$=z.XLMModel,III=z.XLMPreTrainedModel,lII=z.XLMRobertaForMaskedLM,GII=z.XLMRobertaForQuestionAnswering,cII=z.XLMRobertaForSequenceClassification,bII=z.XLMRobertaForTokenClassification,dII=z.XLMRobertaModel,ZII=z.XLMRobertaPreTrainedModel,eII=z.XLMRobertaTokenizer,aII=z.XLMTokenizer,WII=z.XLMWithLMHeadModel,tII=z.XVectorOutput,nII=z.YolosFeatureExtractor,mII=z.YolosForObjectDetection,NII=z.YolosImageProcessor,sII=z.YolosModel,YII=z.YolosObjectDetectionOutput,hII=z.YolosPreTrainedModel,VII=z.ZeroShotAudioClassificationPipeline,pII=z.ZeroShotClassificationPipeline,uII=z.ZeroShotImageClassificationPipeline,RII=z.ZeroShotObjectDetectionPipeline,oII=z.bankers_round,FII=z.cat,XII=z.cos_sim,iII=z.dot,QII=z.dynamic_time_warping,HII=z.env,rII=z.full,wII=z.full_like,vII=z.getKeyValueShapes,EII=z.hamming,yII=z.hanning,gII=z.interpolate,JII=z.interpolate_4d,CII=z.interpolate_data,AII=z.is_chinese_char,LII=z.layer_norm,kII=z.load_image,xII=z.log_softmax,zII=z.magnitude,UII=z.matmul,MII=z.max,BII=z.mean,OII=z.mean_pooling,jII=z.medianFilter,KII=z.mel_filter_bank,TII=z.min,fII=z.ones,SII=z.ones_like,DII=z.permute,qII=z.permute_data,_II=z.pipeline,PII=z.quantize_embeddings,$II=z.rand,IlI=z.read_audio,llI=z.rfft,GlI=z.round,clI=z.slice,blI=z.softmax,dlI=z.spectrogram,ZlI=z.stack,elI=z.std_mean,alI=z.topk,WlI=z.window_function,tlI=z.zeros,nlI=z.zeros_like;var qQ=el(DQ(),1),PC=Object.defineProperty,$C=(I,G,l)=>G in I?PC(I,G,{enumerable:!0,configurable:!0,writable:!0,value:l}):I[G]=l,I5=(I,G,l)=>($C(I,typeof G!="symbol"?G+"":G,l),l);function l5(I,G){let l=Array.from({length:I.length},(b,d)=>({start:d,end:d+1}));for(;l.length>1;){let b=null;for(let d=0;d<l.length-1;d++){let e=I.slice(l[d].start,l[d+1].end),t=G.get(e.join(","));t!=null&&(b==null||t<b[0])&&(b=[t,d])}if(b!=null){let d=b[1];l[d]={start:l[d].start,end:l[d+1].end},l.splice(d+1,1)}else break}return l}function G5(I,G){return I.length===1?[G.get(I.join(","))]:l5(I,G).map(l=>G.get(I.slice(l.start,l.end).join(","))).filter(l=>l!=null)}function c5(I){return I.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var $R=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(I,G){this.patStr=I.pat_str;let l=I.bpe_ranks.split(`
`).filter(Boolean).reduce((b,d)=>{let[e,t,...W]=d.split(" "),n=Number.parseInt(t,10);return W.forEach((s,N)=>b[s]=n+N),b},{});for(let[b,d]of Object.entries(l)){let e=qQ.default.toByteArray(b);this.rankMap.set(e.join(","),d),this.textMap.set(d,e)}this.specialTokens={...I.special_tokens,...G},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((b,[d,e])=>(b[e]=this.textEncoder.encode(d),b),{})}encode(I,G=[],l="all"){let b=new RegExp(this.patStr,"ug"),d=$R.specialTokenRegex(Object.keys(this.specialTokens)),e=[],t=new Set(G==="all"?Object.keys(this.specialTokens):G),W=new Set(l==="all"?Object.keys(this.specialTokens).filter(s=>!t.has(s)):l);if(W.size>0){let s=$R.specialTokenRegex([...W]),N=I.match(s);if(N!=null)throw new Error(`The text contains a special token that is not allowed: ${N[0]}`)}let n=0;for(;;){let s=null,N=n;for(;d.lastIndex=N,s=d.exec(I),!(s==null||t.has(s[0]));)N=s.index+1;let m=s?.index??I.length;for(let V of I.substring(n,m).matchAll(b)){let X=this.textEncoder.encode(V[0]),p=this.rankMap.get(X.join(","));if(p!=null){e.push(p);continue}e.push(...G5(X,this.rankMap))}if(s==null)break;let h=this.specialTokens[s[0]];e.push(h),n=s.index+s[0].length}return e}decode(I){let G=[],l=0;for(let e=0;e<I.length;++e){let t=I[e],W=this.textMap.get(t)??this.inverseSpecialTokens[t];W!=null&&(G.push(W),l+=W.length)}let b=new Uint8Array(l),d=0;for(let e of G)b.set(e,d),d+=e.length;return this.textDecoder.decode(b)}},Cn=$R;I5(Cn,"specialTokenRegex",I=>new RegExp(I.map(G=>c5(G)).join("|"),"g"));function Gh(I){switch(I){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"o1-mini":case"o1-preview":case"o1-preview-2024-09-12":case"o1-mini-2024-09-12":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":return"o200k_base";default:throw new Error("Unknown model")}}var jp={};async function _Q(I,G){return I in jp||(jp[I]=fetch(`https://tiktoken.pages.dev/js/${I}.json`,{signal:G?.signal}).then(l=>l.json()).catch(l=>{throw delete jp[I],l})),new Cn(await jp[I],G?.extendedSpecialTokens)}function PQ(I){let G="cl100k_base";try{G=Gh(I)}catch{}return G}async function Od(I,G){return(await IH(G)).encode(I,"all")}async function ch(I,G){return(await IH(G)).decode(I)}async function $Q(I,G,l){let b=await Od(I,l);return b.length>G?!1:b.length}async function Kp(I,G){G||(G=(await MZ()).model);let l;return typeof I=="string"?l=I:l=I.resolvedTemplate+I.content,(await Od(l,G)).length}async function IH(I){return/^deepseek/.test(I)?b5():_Q(PQ(I))}async function b5(){return TQ.from_pretrained("deepseek-ai/DeepSeek-V3")}var GH=el(uc());async function cH({initialResolvedTemplate:I,content:G,maxTokens:l,followupResolvedTemplate:b,modelName:d}){let e=await Od(I,d),t=await Od(G,d),W=[],n={resolvedTemplate:await ch(e,d),content:await ch(t.slice(0,l),d),templateTokensCount:e.length};return W.push(n),t=t.slice(l),W.push(...await bH(t,l,b,d)),W}async function bH(I,G,l,b){let d=await Od(l||"",b),e=[],t=Math.ceil(I.length/G);G=G-d.length;for(let W=0;W<t;W++){let n=await ch(I.slice(G*W,G*(W+1)),b);e.push({resolvedTemplate:l,content:n,templateTokensCount:d.length})}return e}async function dH(I,G,l){let b=await MZ(),d=b.model,e=l??await Io(b);if(!Array.isArray(I)||I.length===0)throw new Error("Invalid or empty chunks array.");let W=(await Od(za(I[0]),d)).length-Math.round(e*G*.1);if(W<=0)throw new Error("Could not produce summary. The maximum token size is too small.");let n=d5(I),s=await Od(n,d),N=[],m={resolvedTemplate:I[0].resolvedTemplate,content:await ch(s.slice(0,W-I[0].templateTokensCount),d),templateTokensCount:I[0].templateTokensCount};return N.push(m),s=s.slice(W-I[0].templateTokensCount),N.push(...await bH(s,W,I[1].resolvedTemplate,d)),N}function ZH(I){return I.map(za).join("")}function d5(I){return I.map(G=>G.content).join("")}function za(I){return I.resolvedTemplate+I.content}function lH(I,G){return Math.round(G*.1)+I}async function Io(I,G=0){if(I.provider==="web"){let d=(await GH.default.runtime.sendMessage({type:"GET_MODELS",to:"background"}))?.find(e=>e.slug===I.model);if(d&&d.max_tokens)return d.max_tokens-lH(0,d.max_tokens)}let l=LZ.findModel(I.model,I.provider)?.maxTokens??fi;return l-lH(G,l)}var Z5={976:(I,G,l)=>{l.d(G,{AnnotationLayer:()=>UI,FreeTextAnnotationElement:()=>cI,InkAnnotationElement:()=>pI,StampAnnotationElement:()=>$});var b=l(292),d=l(419),e=l(792);function t(zI){return Math.floor(Math.max(0,Math.min(1,zI))*255).toString(16).padStart(2,"0")}function W(zI){return Math.max(0,Math.min(255,255*zI))}class n{static CMYK_G([L,bI,FI,U]){return["G",1-Math.min(1,.3*L+.59*FI+.11*bI+U)]}static G_CMYK([L]){return["CMYK",0,0,0,1-L]}static G_RGB([L]){return["RGB",L,L,L]}static G_rgb([L]){return L=W(L),[L,L,L]}static G_HTML([L]){let bI=t(L);return`#${bI}${bI}${bI}`}static RGB_G([L,bI,FI]){return["G",.3*L+.59*bI+.11*FI]}static RGB_rgb(L){return L.map(W)}static RGB_HTML(L){return`#${L.map(t).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([L,bI,FI,U]){return["RGB",1-Math.min(1,L+U),1-Math.min(1,FI+U),1-Math.min(1,bI+U)]}static CMYK_rgb([L,bI,FI,U]){return[W(1-Math.min(1,L+U)),W(1-Math.min(1,FI+U)),W(1-Math.min(1,bI+U))]}static CMYK_HTML(L){let bI=this.CMYK_RGB(L).slice(1);return this.RGB_HTML(bI)}static RGB_CMYK([L,bI,FI]){let U=1-L,k=1-bI,w=1-FI,r=Math.min(U,k,w);return["CMYK",U,k,w,r]}}var s=l(284);let N=1e3,m=9,h=new WeakSet;function V(zI){return{width:zI[2]-zI[0],height:zI[3]-zI[1]}}class X{static create(L){switch(L.data.annotationType){case b.AnnotationType.LINK:return new F(L);case b.AnnotationType.TEXT:return new a(L);case b.AnnotationType.WIDGET:switch(L.data.fieldType){case"Tx":return new Q(L);case"Btn":return L.data.radioButton?new H(L):L.data.checkBox?new y(L):new E(L);case"Ch":return new C(L);case"Sig":return new o(L)}return new u(L);case b.AnnotationType.POPUP:return new T(L);case b.AnnotationType.FREETEXT:return new cI(L);case b.AnnotationType.LINE:return new hI(L);case b.AnnotationType.SQUARE:return new WI(L);case b.AnnotationType.CIRCLE:return new VI(L);case b.AnnotationType.POLYLINE:return new sI(L);case b.AnnotationType.CARET:return new dI(L);case b.AnnotationType.INK:return new pI(L);case b.AnnotationType.POLYGON:return new ZI(L);case b.AnnotationType.HIGHLIGHT:return new yI(L);case b.AnnotationType.UNDERLINE:return new eI(L);case b.AnnotationType.SQUIGGLY:return new HI(L);case b.AnnotationType.STRIKEOUT:return new YI(L);case b.AnnotationType.STAMP:return new $(L);case b.AnnotationType.FILEATTACHMENT:return new JI(L);default:return new p(L)}}}class p{#I=null;#l=!1;constructor(L,{isRenderable:bI=!1,ignoreBorder:FI=!1,createQuadrilaterals:U=!1}={}){this.isRenderable=bI,this.data=L.data,this.layer=L.layer,this.linkService=L.linkService,this.downloadManager=L.downloadManager,this.imageResourcesPath=L.imageResourcesPath,this.renderForms=L.renderForms,this.svgFactory=L.svgFactory,this.annotationStorage=L.annotationStorage,this.enableScripting=L.enableScripting,this.hasJSActions=L.hasJSActions,this._fieldObjects=L.fieldObjects,this.parent=L.parent,bI&&(this.container=this._createContainer(FI)),U&&this._createQuadrilaterals()}static _hasPopupData({titleObj:L,contentsObj:bI,richText:FI}){return!!(L?.str||bI?.str||FI?.str)}get hasPopupData(){return p._hasPopupData(this.data)}updateEdited(L){if(!this.container)return;this.#I||={rect:this.data.rect.slice(0)};let{rect:bI}=L;bI&&this.#G(bI)}resetEdited(){this.#I&&(this.#G(this.#I.rect),this.#I=null)}#G(L){let{container:{style:bI},data:{rect:FI,rotation:U},parent:{viewport:{rawDims:{pageWidth:k,pageHeight:w,pageX:r,pageY:A}}}}=this;FI?.splice(0,4,...L);let{width:O,height:K}=V(L);bI.left=`${100*(L[0]-r)/k}%`,bI.top=`${100*(w-L[3]+A)/w}%`,U===0?(bI.width=`${100*O/k}%`,bI.height=`${100*K/w}%`):this.setRotation(U)}_createContainer(L){let{data:bI,parent:{page:FI,viewport:U}}=this,k=document.createElement("section");k.setAttribute("data-annotation-id",bI.id),this instanceof u||(k.tabIndex=N);let{style:w}=k;if(w.zIndex=this.parent.zIndex++,bI.popupRef&&k.setAttribute("aria-haspopup","dialog"),bI.alternativeText&&(k.title=bI.alternativeText),bI.noRotate&&k.classList.add("norotate"),!bI.rect||this instanceof T){let{rotation:B}=bI;return!bI.hasOwnCanvas&&B!==0&&this.setRotation(B,k),k}let{width:r,height:A}=V(bI.rect);if(!L&&bI.borderStyle.width>0){w.borderWidth=`${bI.borderStyle.width}px`;let B=bI.borderStyle.horizontalCornerRadius,aI=bI.borderStyle.verticalCornerRadius;if(B>0||aI>0){let QI=`calc(${B}px * var(--scale-factor)) / calc(${aI}px * var(--scale-factor))`;w.borderRadius=QI}else if(this instanceof H){let QI=`calc(${r}px * var(--scale-factor)) / calc(${A}px * var(--scale-factor))`;w.borderRadius=QI}switch(bI.borderStyle.style){case b.AnnotationBorderStyleType.SOLID:w.borderStyle="solid";break;case b.AnnotationBorderStyleType.DASHED:w.borderStyle="dashed";break;case b.AnnotationBorderStyleType.BEVELED:(0,b.warn)("Unimplemented border style: beveled");break;case b.AnnotationBorderStyleType.INSET:(0,b.warn)("Unimplemented border style: inset");break;case b.AnnotationBorderStyleType.UNDERLINE:w.borderBottomStyle="solid";break;default:break}let lI=bI.borderColor||null;lI?(this.#l=!0,w.borderColor=b.Util.makeHexColor(lI[0]|0,lI[1]|0,lI[2]|0)):w.borderWidth=0}let O=b.Util.normalizeRect([bI.rect[0],FI.view[3]-bI.rect[1]+FI.view[1],bI.rect[2],FI.view[3]-bI.rect[3]+FI.view[1]]),{pageWidth:K,pageHeight:q,pageX:GI,pageY:tI}=U.rawDims;w.left=`${100*(O[0]-GI)/K}%`,w.top=`${100*(O[1]-tI)/q}%`;let{rotation:iI}=bI;return bI.hasOwnCanvas||iI===0?(w.width=`${100*r/K}%`,w.height=`${100*A/q}%`):this.setRotation(iI,k),k}setRotation(L,bI=this.container){if(!this.data.rect)return;let{pageWidth:FI,pageHeight:U}=this.parent.viewport.rawDims,{width:k,height:w}=V(this.data.rect),r,A;L%180===0?(r=100*k/FI,A=100*w/U):(r=100*w/FI,A=100*k/U),bI.style.width=`${r}%`,bI.style.height=`${A}%`,bI.setAttribute("data-main-rotation",(360-L)%360)}get _commonActions(){let L=(bI,FI,U)=>{let k=U.detail[bI],w=k[0],r=k.slice(1);U.target.style[FI]=n[`${w}_HTML`](r),this.annotationStorage.setValue(this.data.id,{[FI]:n[`${w}_rgb`](r)})};return(0,b.shadow)(this,"_commonActions",{display:bI=>{let{display:FI}=bI.detail,U=FI%2===1;this.container.style.visibility=U?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:U,noPrint:FI===1||FI===2})},print:bI=>{this.annotationStorage.setValue(this.data.id,{noPrint:!bI.detail.print})},hidden:bI=>{let{hidden:FI}=bI.detail;this.container.style.visibility=FI?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:FI,noView:FI})},focus:bI=>{setTimeout(()=>bI.target.focus({preventScroll:!1}),0)},userName:bI=>{bI.target.title=bI.detail.userName},readonly:bI=>{bI.target.disabled=bI.detail.readonly},required:bI=>{this._setRequired(bI.target,bI.detail.required)},bgColor:bI=>{L("bgColor","backgroundColor",bI)},fillColor:bI=>{L("fillColor","backgroundColor",bI)},fgColor:bI=>{L("fgColor","color",bI)},textColor:bI=>{L("textColor","color",bI)},borderColor:bI=>{L("borderColor","borderColor",bI)},strokeColor:bI=>{L("strokeColor","borderColor",bI)},rotation:bI=>{let FI=bI.detail.rotation;this.setRotation(FI),this.annotationStorage.setValue(this.data.id,{rotation:FI})}})}_dispatchEventFromSandbox(L,bI){let FI=this._commonActions;for(let U of Object.keys(bI.detail))(L[U]||FI[U])?.(bI)}_setDefaultPropertiesFromJS(L){if(!this.enableScripting)return;let bI=this.annotationStorage.getRawValue(this.data.id);if(!bI)return;let FI=this._commonActions;for(let[U,k]of Object.entries(bI)){let w=FI[U];if(w){let r={detail:{[U]:k},target:L};w(r),delete bI[U]}}}_createQuadrilaterals(){if(!this.container)return;let{quadPoints:L}=this.data;if(!L)return;let[bI,FI,U,k]=this.data.rect;if(L.length===1){let[,{x:B,y:aI},{x:lI,y:QI}]=L[0];if(U===B&&k===aI&&bI===lI&&FI===QI)return}let{style:w}=this.container,r;if(this.#l){let{borderColor:B,borderWidth:aI}=w;w.borderWidth=0,r=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${B}" stroke-width="${aI}">`],this.container.classList.add("hasBorder")}let A=U-bI,O=k-FI,{svgFactory:K}=this,q=K.createElement("svg");q.classList.add("quadrilateralsContainer"),q.setAttribute("width",0),q.setAttribute("height",0);let GI=K.createElement("defs");q.append(GI);let tI=K.createElement("clipPath"),iI=`clippath_${this.data.id}`;tI.setAttribute("id",iI),tI.setAttribute("clipPathUnits","objectBoundingBox"),GI.append(tI);for(let[,{x:B,y:aI},{x:lI,y:QI}]of L){let vI=K.createElement("rect"),OI=(lI-bI)/A,uI=(k-aI)/O,wI=(B-lI)/A,kI=(aI-QI)/O;vI.setAttribute("x",OI),vI.setAttribute("y",uI),vI.setAttribute("width",wI),vI.setAttribute("height",kI),tI.append(vI),r?.push(`<rect vector-effect="non-scaling-stroke" x="${OI}" y="${uI}" width="${wI}" height="${kI}"/>`)}this.#l&&(r.push("</g></svg>')"),w.backgroundImage=r.join("")),this.container.append(q),this.container.style.clipPath=`url(#${iI})`}_createPopup(){let{container:L,data:bI}=this;L.setAttribute("aria-haspopup","dialog");let FI=new T({data:{color:bI.color,titleObj:bI.titleObj,modificationDate:bI.modificationDate,contentsObj:bI.contentsObj,richText:bI.richText,parentRect:bI.rect,borderStyle:0,id:`popup_${bI.id}`,rotation:bI.rotation},parent:this.parent,elements:[this]});this.parent.div.append(FI.render())}render(){(0,b.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(L,bI=null){let FI=[];if(this._fieldObjects){let U=this._fieldObjects[L];if(U)for(let{page:k,id:w,exportValues:r}of U){if(k===-1||w===bI)continue;let A=typeof r=="string"?r:null,O=document.querySelector(`[data-element-id="${w}"]`);if(O&&!h.has(O)){(0,b.warn)(`_getElementsByName - element not allowed: ${w}`);continue}FI.push({id:w,exportValue:A,domElement:O})}return FI}for(let U of document.getElementsByName(L)){let{exportValue:k}=U,w=U.getAttribute("data-element-id");w!==bI&&h.has(U)&&FI.push({id:w,exportValue:k,domElement:U})}return FI}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let L=this.getElementsToTriggerPopup();if(Array.isArray(L))for(let bI of L)bI.classList.add("highlightArea");else L.classList.add("highlightArea")}get _isEditable(){return!1}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:L,data:{id:bI}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:L,editId:bI})})}}class F extends p{constructor(L,bI=null){super(L,{isRenderable:!0,ignoreBorder:!!bI?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=L.data.isTooltipOnly}render(){let{data:L,linkService:bI}=this,FI=document.createElement("a");FI.setAttribute("data-element-id",L.id);let U=!1;return L.url?(bI.addLinkAttributes(FI,L.url,L.newWindow),U=!0):L.action?(this._bindNamedAction(FI,L.action),U=!0):L.attachment?(this.#l(FI,L.attachment,L.attachmentDest),U=!0):L.setOCGState?(this.#G(FI,L.setOCGState),U=!0):L.dest?(this._bindLink(FI,L.dest),U=!0):(L.actions&&(L.actions.Action||L.actions["Mouse Up"]||L.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(FI,L),U=!0),L.resetForm?(this._bindResetFormAction(FI,L.resetForm),U=!0):this.isTooltipOnly&&!U&&(this._bindLink(FI,""),U=!0)),this.container.classList.add("linkAnnotation"),U&&this.container.append(FI),this.container}#I(){this.container.setAttribute("data-internal-link","")}_bindLink(L,bI){L.href=this.linkService.getDestinationHash(bI),L.onclick=()=>(bI&&this.linkService.goToDestination(bI),!1),(bI||bI==="")&&this.#I()}_bindNamedAction(L,bI){L.href=this.linkService.getAnchorUrl(""),L.onclick=()=>(this.linkService.executeNamedAction(bI),!1),this.#I()}#l(L,bI,FI=null){L.href=this.linkService.getAnchorUrl(""),L.onclick=()=>(this.downloadManager?.openOrDownloadData(bI.content,bI.filename,FI),!1),this.#I()}#G(L,bI){L.href=this.linkService.getAnchorUrl(""),L.onclick=()=>(this.linkService.executeSetOCGState(bI),!1),this.#I()}_bindJSAction(L,bI){L.href=this.linkService.getAnchorUrl("");let FI=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let U of Object.keys(bI.actions)){let k=FI.get(U);k&&(L[k]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:bI.id,name:U}}),!1))}L.onclick||(L.onclick=()=>!1),this.#I()}_bindResetFormAction(L,bI){let FI=L.onclick;if(FI||(L.href=this.linkService.getAnchorUrl("")),this.#I(),!this._fieldObjects){(0,b.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),FI||(L.onclick=()=>!1);return}L.onclick=()=>{FI?.();let{fields:U,refs:k,include:w}=bI,r=[];if(U.length!==0||k.length!==0){let K=new Set(k);for(let q of U){let GI=this._fieldObjects[q]||[];for(let{id:tI}of GI)K.add(tI)}for(let q of Object.values(this._fieldObjects))for(let GI of q)K.has(GI.id)===w&&r.push(GI)}else for(let K of Object.values(this._fieldObjects))r.push(...K);let A=this.annotationStorage,O=[];for(let K of r){let{id:q}=K;switch(O.push(q),K.type){case"text":{let tI=K.defaultValue||"";A.setValue(q,{value:tI});break}case"checkbox":case"radiobutton":{let tI=K.defaultValue===K.exportValues;A.setValue(q,{value:tI});break}case"combobox":case"listbox":{let tI=K.defaultValue||"";A.setValue(q,{value:tI});break}default:continue}let GI=document.querySelector(`[data-element-id="${q}"]`);if(GI){if(!h.has(GI)){(0,b.warn)(`_bindResetFormAction - element not allowed: ${q}`);continue}}else continue;GI.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:O,name:"ResetForm"}}),!1}}}class a extends p{constructor(L){super(L,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let L=document.createElement("img");return L.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",L.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),L.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(L),this.container}}class u extends p{render(){return this.container}showElementAndHideCanvas(L){this.data.hasOwnCanvas&&(L.previousSibling?.nodeName==="CANVAS"&&(L.previousSibling.hidden=!0),L.hidden=!1)}_getKeyModifier(L){return b.FeatureTest.platform.isMac?L.metaKey:L.ctrlKey}_setEventListener(L,bI,FI,U,k){FI.includes("mouse")?L.addEventListener(FI,w=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:U,value:k(w),shift:w.shiftKey,modifier:this._getKeyModifier(w)}})}):L.addEventListener(FI,w=>{if(FI==="blur"){if(!bI.focused||!w.relatedTarget)return;bI.focused=!1}else if(FI==="focus"){if(bI.focused)return;bI.focused=!0}k&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:U,value:k(w)}})})}_setEventListeners(L,bI,FI,U){for(let[k,w]of FI)(w==="Action"||this.data.actions?.[w])&&((w==="Focus"||w==="Blur")&&(bI||={focused:!1}),this._setEventListener(L,bI,k,w,U),w==="Focus"&&!this.data.actions?.Blur?this._setEventListener(L,bI,"blur","Blur",null):w==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(L,bI,"focus","Focus",null))}_setBackgroundColor(L){let bI=this.data.backgroundColor||null;L.style.backgroundColor=bI===null?"transparent":b.Util.makeHexColor(bI[0],bI[1],bI[2])}_setTextStyle(L){let bI=["left","center","right"],{fontColor:FI}=this.data.defaultAppearanceData,U=this.data.defaultAppearanceData.fontSize||m,k=L.style,w,r=2,A=O=>Math.round(10*O)/10;if(this.data.multiLine){let O=Math.abs(this.data.rect[3]-this.data.rect[1]-r),K=Math.round(O/(b.LINE_FACTOR*U))||1,q=O/K;w=Math.min(U,A(q/b.LINE_FACTOR))}else{let O=Math.abs(this.data.rect[3]-this.data.rect[1]-r);w=Math.min(U,A(O/b.LINE_FACTOR))}k.fontSize=`calc(${w}px * var(--scale-factor))`,k.color=b.Util.makeHexColor(FI[0],FI[1],FI[2]),this.data.textAlignment!==null&&(k.textAlign=bI[this.data.textAlignment])}_setRequired(L,bI){bI?L.setAttribute("required",!0):L.removeAttribute("required"),L.setAttribute("aria-required",bI)}}class Q extends u{constructor(L){let bI=L.renderForms||L.data.hasOwnCanvas||!L.data.hasAppearance&&!!L.data.fieldValue;super(L,{isRenderable:bI})}setPropertyOnSiblings(L,bI,FI,U){let k=this.annotationStorage;for(let w of this._getElementsByName(L.name,L.id))w.domElement&&(w.domElement[bI]=FI),k.setValue(w.id,{[U]:FI})}render(){let L=this.annotationStorage,bI=this.data.id;this.container.classList.add("textWidgetAnnotation");let FI=null;if(this.renderForms){let U=L.getValue(bI,{value:this.data.fieldValue}),k=U.value||"",w=L.getValue(bI,{charLimit:this.data.maxLen}).charLimit;w&&k.length>w&&(k=k.slice(0,w));let r=U.formattedValue||this.data.textContent?.join(`
`)||null;r&&this.data.comb&&(r=r.replaceAll(/\s+/g,""));let A={userValue:k,formattedValue:r,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(FI=document.createElement("textarea"),FI.textContent=r??k,this.data.doNotScroll&&(FI.style.overflowY="hidden")):(FI=document.createElement("input"),FI.type="text",FI.setAttribute("value",r??k),this.data.doNotScroll&&(FI.style.overflowX="hidden")),this.data.hasOwnCanvas&&(FI.hidden=!0),h.add(FI),FI.setAttribute("data-element-id",bI),FI.disabled=this.data.readOnly,FI.name=this.data.fieldName,FI.tabIndex=N,this._setRequired(FI,this.data.required),w&&(FI.maxLength=w),FI.addEventListener("input",K=>{L.setValue(bI,{value:K.target.value}),this.setPropertyOnSiblings(FI,"value",K.target.value,"value"),A.formattedValue=null}),FI.addEventListener("resetform",K=>{let q=this.data.defaultFieldValue??"";FI.value=A.userValue=q,A.formattedValue=null});let O=K=>{let{formattedValue:q}=A;q!=null&&(K.target.value=q),K.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){FI.addEventListener("focus",q=>{if(A.focused)return;let{target:GI}=q;A.userValue&&(GI.value=A.userValue),A.lastCommittedValue=GI.value,A.commitKey=1,this.data.actions?.Focus||(A.focused=!0)}),FI.addEventListener("updatefromsandbox",q=>{this.showElementAndHideCanvas(q.target);let GI={value(tI){A.userValue=tI.detail.value??"",L.setValue(bI,{value:A.userValue.toString()}),tI.target.value=A.userValue},formattedValue(tI){let{formattedValue:iI}=tI.detail;A.formattedValue=iI,iI!=null&&tI.target!==document.activeElement&&(tI.target.value=iI),L.setValue(bI,{formattedValue:iI})},selRange(tI){tI.target.setSelectionRange(...tI.detail.selRange)},charLimit:tI=>{let{charLimit:iI}=tI.detail,{target:B}=tI;if(iI===0){B.removeAttribute("maxLength");return}B.setAttribute("maxLength",iI);let aI=A.userValue;!aI||aI.length<=iI||(aI=aI.slice(0,iI),B.value=A.userValue=aI,L.setValue(bI,{value:aI}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:bI,name:"Keystroke",value:aI,willCommit:!0,commitKey:1,selStart:B.selectionStart,selEnd:B.selectionEnd}}))}};this._dispatchEventFromSandbox(GI,q)}),FI.addEventListener("keydown",q=>{A.commitKey=1;let GI=-1;if(q.key==="Escape"?GI=0:q.key==="Enter"&&!this.data.multiLine?GI=2:q.key==="Tab"&&(A.commitKey=3),GI===-1)return;let{value:tI}=q.target;A.lastCommittedValue!==tI&&(A.lastCommittedValue=tI,A.userValue=tI,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:bI,name:"Keystroke",value:tI,willCommit:!0,commitKey:GI,selStart:q.target.selectionStart,selEnd:q.target.selectionEnd}}))});let K=O;O=null,FI.addEventListener("blur",q=>{if(!A.focused||!q.relatedTarget)return;this.data.actions?.Blur||(A.focused=!1);let{value:GI}=q.target;A.userValue=GI,A.lastCommittedValue!==GI&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:bI,name:"Keystroke",value:GI,willCommit:!0,commitKey:A.commitKey,selStart:q.target.selectionStart,selEnd:q.target.selectionEnd}}),K(q)}),this.data.actions?.Keystroke&&FI.addEventListener("beforeinput",q=>{A.lastCommittedValue=null;let{data:GI,target:tI}=q,{value:iI,selectionStart:B,selectionEnd:aI}=tI,lI=B,QI=aI;switch(q.inputType){case"deleteWordBackward":{let vI=iI.substring(0,B).match(/\w*[^\w]*$/);vI&&(lI-=vI[0].length);break}case"deleteWordForward":{let vI=iI.substring(B).match(/^[^\w]*\w*/);vI&&(QI+=vI[0].length);break}case"deleteContentBackward":B===aI&&(lI-=1);break;case"deleteContentForward":B===aI&&(QI+=1);break}q.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:bI,name:"Keystroke",value:iI,change:GI||"",willCommit:!1,selStart:lI,selEnd:QI}})}),this._setEventListeners(FI,A,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],q=>q.target.value)}if(O&&FI.addEventListener("blur",O),this.data.comb){let q=(this.data.rect[2]-this.data.rect[0])/w;FI.classList.add("comb"),FI.style.letterSpacing=`calc(${q}px * var(--scale-factor) - 1ch)`}}else FI=document.createElement("div"),FI.textContent=this.data.fieldValue,FI.style.verticalAlign="middle",FI.style.display="table-cell",this.data.hasOwnCanvas&&(FI.hidden=!0);return this._setTextStyle(FI),this._setBackgroundColor(FI),this._setDefaultPropertiesFromJS(FI),this.container.append(FI),this.container}}class o extends u{constructor(L){super(L,{isRenderable:!!L.data.hasOwnCanvas})}}class y extends u{constructor(L){super(L,{isRenderable:L.renderForms})}render(){let L=this.annotationStorage,bI=this.data,FI=bI.id,U=L.getValue(FI,{value:bI.exportValue===bI.fieldValue}).value;typeof U=="string"&&(U=U!=="Off",L.setValue(FI,{value:U})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let k=document.createElement("input");return h.add(k),k.setAttribute("data-element-id",FI),k.disabled=bI.readOnly,this._setRequired(k,this.data.required),k.type="checkbox",k.name=bI.fieldName,U&&k.setAttribute("checked",!0),k.setAttribute("exportValue",bI.exportValue),k.tabIndex=N,k.addEventListener("change",w=>{let{name:r,checked:A}=w.target;for(let O of this._getElementsByName(r,FI)){let K=A&&O.exportValue===bI.exportValue;O.domElement&&(O.domElement.checked=K),L.setValue(O.id,{value:K})}L.setValue(FI,{value:A})}),k.addEventListener("resetform",w=>{let r=bI.defaultFieldValue||"Off";w.target.checked=r===bI.exportValue}),this.enableScripting&&this.hasJSActions&&(k.addEventListener("updatefromsandbox",w=>{let r={value(A){A.target.checked=A.detail.value!=="Off",L.setValue(FI,{value:A.target.checked})}};this._dispatchEventFromSandbox(r,w)}),this._setEventListeners(k,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],w=>w.target.checked)),this._setBackgroundColor(k),this._setDefaultPropertiesFromJS(k),this.container.append(k),this.container}}class H extends u{constructor(L){super(L,{isRenderable:L.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let L=this.annotationStorage,bI=this.data,FI=bI.id,U=L.getValue(FI,{value:bI.fieldValue===bI.buttonValue}).value;if(typeof U=="string"&&(U=U!==bI.buttonValue,L.setValue(FI,{value:U})),U)for(let w of this._getElementsByName(bI.fieldName,FI))L.setValue(w.id,{value:!1});let k=document.createElement("input");if(h.add(k),k.setAttribute("data-element-id",FI),k.disabled=bI.readOnly,this._setRequired(k,this.data.required),k.type="radio",k.name=bI.fieldName,U&&k.setAttribute("checked",!0),k.tabIndex=N,k.addEventListener("change",w=>{let{name:r,checked:A}=w.target;for(let O of this._getElementsByName(r,FI))L.setValue(O.id,{value:!1});L.setValue(FI,{value:A})}),k.addEventListener("resetform",w=>{let r=bI.defaultFieldValue;w.target.checked=r!=null&&r===bI.buttonValue}),this.enableScripting&&this.hasJSActions){let w=bI.buttonValue;k.addEventListener("updatefromsandbox",r=>{let A={value:O=>{let K=w===O.detail.value;for(let q of this._getElementsByName(O.target.name)){let GI=K&&q.id===FI;q.domElement&&(q.domElement.checked=GI),L.setValue(q.id,{value:GI})}}};this._dispatchEventFromSandbox(A,r)}),this._setEventListeners(k,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)}return this._setBackgroundColor(k),this._setDefaultPropertiesFromJS(k),this.container.append(k),this.container}}class E extends F{constructor(L){super(L,{ignoreBorder:L.data.hasAppearance})}render(){let L=super.render();L.classList.add("buttonWidgetAnnotation","pushButton");let bI=L.lastChild;return this.enableScripting&&this.hasJSActions&&bI&&(this._setDefaultPropertiesFromJS(bI),bI.addEventListener("updatefromsandbox",FI=>{this._dispatchEventFromSandbox({},FI)})),L}}class C extends u{constructor(L){super(L,{isRenderable:L.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let L=this.annotationStorage,bI=this.data.id,FI=L.getValue(bI,{value:this.data.fieldValue}),U=document.createElement("select");h.add(U),U.setAttribute("data-element-id",bI),U.disabled=this.data.readOnly,this._setRequired(U,this.data.required),U.name=this.data.fieldName,U.tabIndex=N;let k=this.data.combo&&this.data.options.length>0;this.data.combo||(U.size=this.data.options.length,this.data.multiSelect&&(U.multiple=!0)),U.addEventListener("resetform",K=>{let q=this.data.defaultFieldValue;for(let GI of U.options)GI.selected=GI.value===q});for(let K of this.data.options){let q=document.createElement("option");q.textContent=K.displayValue,q.value=K.exportValue,FI.value.includes(K.exportValue)&&(q.setAttribute("selected",!0),k=!1),U.append(q)}let w=null;if(k){let K=document.createElement("option");K.value=" ",K.setAttribute("hidden",!0),K.setAttribute("selected",!0),U.prepend(K),w=()=>{K.remove(),U.removeEventListener("input",w),w=null},U.addEventListener("input",w)}let r=K=>{let q=K?"value":"textContent",{options:GI,multiple:tI}=U;return tI?Array.prototype.filter.call(GI,iI=>iI.selected).map(iI=>iI[q]):GI.selectedIndex===-1?null:GI[GI.selectedIndex][q]},A=r(!1),O=K=>{let q=K.target.options;return Array.prototype.map.call(q,GI=>({displayValue:GI.textContent,exportValue:GI.value}))};return this.enableScripting&&this.hasJSActions?(U.addEventListener("updatefromsandbox",K=>{let q={value(GI){w?.();let tI=GI.detail.value,iI=new Set(Array.isArray(tI)?tI:[tI]);for(let B of U.options)B.selected=iI.has(B.value);L.setValue(bI,{value:r(!0)}),A=r(!1)},multipleSelection(GI){U.multiple=!0},remove(GI){let tI=U.options,iI=GI.detail.remove;tI[iI].selected=!1,U.remove(iI),tI.length>0&&Array.prototype.findIndex.call(tI,aI=>aI.selected)===-1&&(tI[0].selected=!0),L.setValue(bI,{value:r(!0),items:O(GI)}),A=r(!1)},clear(GI){for(;U.length!==0;)U.remove(0);L.setValue(bI,{value:null,items:[]}),A=r(!1)},insert(GI){let{index:tI,displayValue:iI,exportValue:B}=GI.detail.insert,aI=U.children[tI],lI=document.createElement("option");lI.textContent=iI,lI.value=B,aI?aI.before(lI):U.append(lI),L.setValue(bI,{value:r(!0),items:O(GI)}),A=r(!1)},items(GI){let{items:tI}=GI.detail;for(;U.length!==0;)U.remove(0);for(let iI of tI){let{displayValue:B,exportValue:aI}=iI,lI=document.createElement("option");lI.textContent=B,lI.value=aI,U.append(lI)}U.options.length>0&&(U.options[0].selected=!0),L.setValue(bI,{value:r(!0),items:O(GI)}),A=r(!1)},indices(GI){let tI=new Set(GI.detail.indices);for(let iI of GI.target.options)iI.selected=tI.has(iI.index);L.setValue(bI,{value:r(!0)}),A=r(!1)},editable(GI){GI.target.disabled=!GI.detail.editable}};this._dispatchEventFromSandbox(q,K)}),U.addEventListener("input",K=>{let q=r(!0),GI=r(!1);L.setValue(bI,{value:q}),K.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:bI,name:"Keystroke",value:A,change:GI,changeEx:q,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(U,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],K=>K.target.value)):U.addEventListener("input",function(K){L.setValue(bI,{value:r(!0)})}),this.data.combo&&this._setTextStyle(U),this._setBackgroundColor(U),this._setDefaultPropertiesFromJS(U),this.container.append(U),this.container}}class T extends p{constructor(L){let{data:bI,elements:FI}=L;super(L,{isRenderable:p._hasPopupData(bI)}),this.elements=FI}render(){this.container.classList.add("popupAnnotation");let L=new S({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),bI=[];for(let FI of this.elements)FI.popup=L,bI.push(FI.data.id),FI.addHighlightArea();return this.container.setAttribute("aria-controls",bI.map(FI=>`${b.AnnotationPrefix}${FI}`).join(",")),this.container}}class S{#I=this.#h.bind(this);#l=this.#H.bind(this);#G=this.#o.bind(this);#b=this.#u.bind(this);#d=null;#c=null;#Z=null;#W=null;#a=null;#n=null;#m=null;#t=!1;#e=null;#s=null;#Y=null;#N=null;#p=!1;constructor({container:L,color:bI,elements:FI,titleObj:U,modificationDate:k,contentsObj:w,richText:r,parent:A,rect:O,parentRect:K,open:q}){this.#c=L,this.#N=U,this.#Z=w,this.#Y=r,this.#n=A,this.#d=bI,this.#s=O,this.#m=K,this.#a=FI,this.#W=d.PDFDateString.toDateObject(k),this.trigger=FI.flatMap(GI=>GI.getElementsToTriggerPopup());for(let GI of this.trigger)GI.addEventListener("click",this.#b),GI.addEventListener("mouseenter",this.#G),GI.addEventListener("mouseleave",this.#l),GI.classList.add("popupTriggerArea");for(let GI of FI)GI.container?.addEventListener("keydown",this.#I);this.#c.hidden=!0,q&&this.#u()}render(){if(this.#e)return;let{page:{view:L},viewport:{rawDims:{pageWidth:bI,pageHeight:FI,pageX:U,pageY:k}}}=this.#n,w=this.#e=document.createElement("div");if(w.className="popup",this.#d){let vI=w.style.outlineColor=b.Util.makeHexColor(...this.#d);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?w.style.backgroundColor=`color-mix(in srgb, ${vI} 30%, white)`:w.style.backgroundColor=b.Util.makeHexColor(...this.#d.map(uI=>Math.floor(.7*(255-uI)+uI)))}let r=document.createElement("span");r.className="header";let A=document.createElement("h1");if(r.append(A),{dir:A.dir,str:A.textContent}=this.#N,w.append(r),this.#W){let vI=document.createElement("span");vI.classList.add("popupDate"),vI.setAttribute("data-l10n-id","pdfjs-annotation-date-string"),vI.setAttribute("data-l10n-args",JSON.stringify({date:this.#W.toLocaleDateString(),time:this.#W.toLocaleTimeString()})),r.append(vI)}let O=this.#Z,K=this.#Y;if(K?.str&&(!O?.str||O.str===K.str))s.XfaLayer.render({xfaHtml:K.html,intent:"richText",div:w}),w.lastChild.classList.add("richText","popupContent");else{let vI=this._formatContents(O);w.append(vI)}let q=!!this.#m,GI=q?this.#m:this.#s;for(let vI of this.#a)if(!GI||b.Util.intersect(vI.data.rect,GI)!==null){GI=vI.data.rect,q=!0;break}let tI=b.Util.normalizeRect([GI[0],L[3]-GI[1]+L[1],GI[2],L[3]-GI[3]+L[1]]),B=q?GI[2]-GI[0]+5:0,aI=tI[0]+B,lI=tI[1],{style:QI}=this.#c;QI.left=`${100*(aI-U)/bI}%`,QI.top=`${100*(lI-k)/FI}%`,this.#c.append(w)}_formatContents({str:L,dir:bI}){let FI=document.createElement("p");FI.classList.add("popupContent"),FI.dir=bI;let U=L.split(/(?:\r\n?|\n)/);for(let k=0,w=U.length;k<w;++k){let r=U[k];FI.append(document.createTextNode(r)),k<w-1&&FI.append(document.createElement("br"))}return FI}#h(L){L.altKey||L.shiftKey||L.ctrlKey||L.metaKey||(L.key==="Enter"||L.key==="Escape"&&this.#t)&&this.#u()}#u(){this.#t=!this.#t,this.#t?(this.#o(),this.#c.addEventListener("click",this.#b),this.#c.addEventListener("keydown",this.#I)):(this.#H(),this.#c.removeEventListener("click",this.#b),this.#c.removeEventListener("keydown",this.#I))}#o(){this.#e||this.render(),this.isVisible?this.#t&&this.#c.classList.add("focused"):(this.#c.hidden=!1,this.#c.style.zIndex=parseInt(this.#c.style.zIndex)+1e3)}#H(){this.#c.classList.remove("focused"),!(this.#t||!this.isVisible)&&(this.#c.hidden=!0,this.#c.style.zIndex=parseInt(this.#c.style.zIndex)-1e3)}forceHide(){this.#p=this.isVisible,this.#p&&(this.#c.hidden=!0)}maybeShow(){this.#p&&(this.#p=!1,this.#c.hidden=!1)}get isVisible(){return this.#c.hidden===!1}}class cI extends p{constructor(L){super(L,{isRenderable:!0,ignoreBorder:!0}),this.textContent=L.data.textContent,this.textPosition=L.data.textPosition,this.annotationEditorType=b.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let L=document.createElement("div");L.classList.add("annotationTextContent"),L.setAttribute("role","comment");for(let bI of this.textContent){let FI=document.createElement("span");FI.textContent=bI,L.append(FI)}this.container.append(L)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}get _isEditable(){return this.data.hasOwnCanvas}}class hI extends p{#I=null;constructor(L){super(L,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");let L=this.data,{width:bI,height:FI}=V(L.rect),U=this.svgFactory.create(bI,FI,!0),k=this.#I=this.svgFactory.createElement("svg:line");return k.setAttribute("x1",L.rect[2]-L.lineCoordinates[0]),k.setAttribute("y1",L.rect[3]-L.lineCoordinates[1]),k.setAttribute("x2",L.rect[2]-L.lineCoordinates[2]),k.setAttribute("y2",L.rect[3]-L.lineCoordinates[3]),k.setAttribute("stroke-width",L.borderStyle.width||1),k.setAttribute("stroke","transparent"),k.setAttribute("fill","transparent"),U.append(k),this.container.append(U),!L.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#I}addHighlightArea(){this.container.classList.add("highlightArea")}}class WI extends p{#I=null;constructor(L){super(L,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");let L=this.data,{width:bI,height:FI}=V(L.rect),U=this.svgFactory.create(bI,FI,!0),k=L.borderStyle.width,w=this.#I=this.svgFactory.createElement("svg:rect");return w.setAttribute("x",k/2),w.setAttribute("y",k/2),w.setAttribute("width",bI-k),w.setAttribute("height",FI-k),w.setAttribute("stroke-width",k||1),w.setAttribute("stroke","transparent"),w.setAttribute("fill","transparent"),U.append(w),this.container.append(U),!L.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#I}addHighlightArea(){this.container.classList.add("highlightArea")}}class VI extends p{#I=null;constructor(L){super(L,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");let L=this.data,{width:bI,height:FI}=V(L.rect),U=this.svgFactory.create(bI,FI,!0),k=L.borderStyle.width,w=this.#I=this.svgFactory.createElement("svg:ellipse");return w.setAttribute("cx",bI/2),w.setAttribute("cy",FI/2),w.setAttribute("rx",bI/2-k/2),w.setAttribute("ry",FI/2-k/2),w.setAttribute("stroke-width",k||1),w.setAttribute("stroke","transparent"),w.setAttribute("fill","transparent"),U.append(w),this.container.append(U),!L.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#I}addHighlightArea(){this.container.classList.add("highlightArea")}}class sI extends p{#I=null;constructor(L){super(L,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let L=this.data,{width:bI,height:FI}=V(L.rect),U=this.svgFactory.create(bI,FI,!0),k=[];for(let r of L.vertices){let A=r.x-L.rect[0],O=L.rect[3]-r.y;k.push(A+","+O)}k=k.join(" ");let w=this.#I=this.svgFactory.createElement(this.svgElementName);return w.setAttribute("points",k),w.setAttribute("stroke-width",L.borderStyle.width||1),w.setAttribute("stroke","transparent"),w.setAttribute("fill","transparent"),U.append(w),this.container.append(U),!L.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#I}addHighlightArea(){this.container.classList.add("highlightArea")}}class ZI extends sI{constructor(L){super(L),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class dI extends p{constructor(L){super(L,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class pI extends p{#I=[];constructor(L){super(L,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=b.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);let L=this.data,{width:bI,height:FI}=V(L.rect),U=this.svgFactory.create(bI,FI,!0);for(let k of L.inkLists){let w=[];for(let A of k){let O=A.x-L.rect[0],K=L.rect[3]-A.y;w.push(`${O},${K}`)}w=w.join(" ");let r=this.svgFactory.createElement(this.svgElementName);this.#I.push(r),r.setAttribute("points",w),r.setAttribute("stroke-width",L.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),!L.popupRef&&this.hasPopupData&&this._createPopup(),U.append(r)}return this.container.append(U),this.container}getElementsToTriggerPopup(){return this.#I}addHighlightArea(){this.container.classList.add("highlightArea")}}class yI extends p{constructor(L){super(L,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class eI extends p{constructor(L){super(L,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class HI extends p{constructor(L){super(L,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class YI extends p{constructor(L){super(L,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class $ extends p{constructor(L){super(L,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class JI extends p{#I=null;constructor(L){super(L,{isRenderable:!0});let{filename:bI,content:FI}=this.data.file;this.filename=(0,d.getFilenameFromUrl)(bI,!0),this.content=FI,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:bI,content:FI})}render(){this.container.classList.add("fileAttachmentAnnotation");let{container:L,data:bI}=this,FI;bI.hasAppearance||bI.fillAlpha===0?FI=document.createElement("div"):(FI=document.createElement("img"),FI.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(bI.name)?"paperclip":"pushpin"}.svg`,bI.fillAlpha&&bI.fillAlpha<1&&(FI.style=`filter: opacity(${Math.round(bI.fillAlpha*100)}%);`)),FI.addEventListener("dblclick",this.#l.bind(this)),this.#I=FI;let{isMac:U}=b.FeatureTest.platform;return L.addEventListener("keydown",k=>{k.key==="Enter"&&(U?k.metaKey:k.ctrlKey)&&this.#l()}),!bI.popupRef&&this.hasPopupData?this._createPopup():FI.classList.add("popupTriggerArea"),L.append(FI),L}getElementsToTriggerPopup(){return this.#I}addHighlightArea(){this.container.classList.add("highlightArea")}#l(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class UI{#I=null;#l=null;#G=new Map;constructor({div:L,accessibilityManager:bI,annotationCanvasMap:FI,annotationEditorUIManager:U,page:k,viewport:w}){this.div=L,this.#I=bI,this.#l=FI,this.page=k,this.viewport=w,this.zIndex=0,this._annotationEditorUIManager=U}#b(L,bI){let FI=L.firstChild||L;FI.id=`${b.AnnotationPrefix}${bI}`,this.div.append(L),this.#I?.moveElementInDOM(this.div,L,FI,!1)}async render(L){let{annotations:bI}=L,FI=this.div;(0,d.setLayerDimensions)(FI,this.viewport);let U=new Map,k={data:null,layer:FI,linkService:L.linkService,downloadManager:L.downloadManager,imageResourcesPath:L.imageResourcesPath||"",renderForms:L.renderForms!==!1,svgFactory:new d.DOMSVGFactory,annotationStorage:L.annotationStorage||new e.AnnotationStorage,enableScripting:L.enableScripting===!0,hasJSActions:L.hasJSActions,fieldObjects:L.fieldObjects,parent:this,elements:null};for(let w of bI){if(w.noHTML)continue;let r=w.annotationType===b.AnnotationType.POPUP;if(r){let K=U.get(w.id);if(!K)continue;k.elements=K}else{let{width:K,height:q}=V(w.rect);if(K<=0||q<=0)continue}k.data=w;let A=X.create(k);if(!A.isRenderable)continue;if(!r&&w.popupRef){let K=U.get(w.popupRef);K?K.push(A):U.set(w.popupRef,[A])}let O=A.render();w.hidden&&(O.style.visibility="hidden"),this.#b(O,w.id),A.annotationEditorType>0&&(this.#G.set(A.data.id,A),this._annotationEditorUIManager?.renderAnnotationElement(A))}this.#d()}update({viewport:L}){let bI=this.div;this.viewport=L,(0,d.setLayerDimensions)(bI,{rotation:L.rotation}),this.#d(),bI.hidden=!1}#d(){if(!this.#l)return;let L=this.div;for(let[bI,FI]of this.#l){let U=L.querySelector(`[data-annotation-id="${bI}"]`);if(!U)continue;FI.className="annotationContent";let{firstChild:k}=U;k?k.nodeName==="CANVAS"?k.replaceWith(FI):k.classList.contains("annotationContent")?k.after(FI):k.before(FI):U.append(FI)}this.#l.clear()}getEditableAnnotations(){return Array.from(this.#G.values())}getEditableAnnotation(L){return this.#G.get(L)}}},792:(I,G,l)=>{l.d(G,{AnnotationStorage:()=>W,PrintAnnotationStorage:()=>n,SerializableEmpty:()=>t});var b=l(292),d=l(310),e=l(651);let t=Object.freeze({map:null,hash:"",transfer:void 0});class W{#I=!1;#l=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(N,m){let h=this.#l.get(N);return h===void 0?m:Object.assign(m,h)}getRawValue(N){return this.#l.get(N)}remove(N){if(this.#l.delete(N),this.#l.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let m of this.#l.values())if(m instanceof d.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(N,m){let h=this.#l.get(N),V=!1;if(h!==void 0)for(let[X,p]of Object.entries(m))h[X]!==p&&(V=!0,h[X]=p);else V=!0,this.#l.set(N,m);V&&this.#G(),m instanceof d.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(m.constructor._type)}has(N){return this.#l.has(N)}getAll(){return this.#l.size>0?(0,b.objectFromMap)(this.#l):null}setAll(N){for(let[m,h]of Object.entries(N))this.setValue(m,h)}get size(){return this.#l.size}#G(){this.#I||(this.#I=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#I&&(this.#I=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new n(this)}get serializable(){if(this.#l.size===0)return t;let N=new Map,m=new e.MurmurHash3_64,h=[],V=Object.create(null),X=!1;for(let[p,F]of this.#l){let a=F instanceof d.AnnotationEditor?F.serialize(!1,V):F;a&&(N.set(p,a),m.update(`${p}:${JSON.stringify(a)}`),X||=!!a.bitmap)}if(X)for(let p of N.values())p.bitmap&&h.push(p.bitmap);return N.size>0?{map:N,hash:m.hexdigest(),transfer:h}:t}get editorStats(){let N=null,m=new Map;for(let h of this.#l.values()){if(!(h instanceof d.AnnotationEditor))continue;let V=h.telemetryFinalData;if(!V)continue;let{type:X}=V;m.has(X)||m.set(X,Object.getPrototypeOf(h).constructor),N||=Object.create(null);let p=N[X]||=new Map;for(let[F,a]of Object.entries(V)){if(F==="type")continue;let u=p.get(F);u||(u=new Map,p.set(F,u));let Q=u.get(a)??0;u.set(a,Q+1)}}for(let[h,V]of m)N[h]=V.computeTelemetryFinalData(N[h]);return N}}class n extends W{#I;constructor(N){super();let{map:m,hash:h,transfer:V}=N.serializable,X=structuredClone(m,V?{transfer:V}:null);this.#I={map:X,hash:h,transfer:V}}get print(){(0,b.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#I}}},831:(I,G,l)=>{l.a(I,async(b,d)=>{try{let WI=function(w){if(typeof w=="string"||w instanceof URL?w={url:w}:(w instanceof ArrayBuffer||ArrayBuffer.isView(w))&&(w={data:w}),typeof w!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!w.url&&!w.data&&!w.range)throw new Error("Invalid parameter object: need either .data, .range or .url");let r=new pI,{docId:A}=r,O=w.url?sI(w.url):null,K=w.data?ZI(w.data):null,q=w.httpHeaders||null,GI=w.withCredentials===!0,tI=w.password??null,iI=w.range instanceof yI?w.range:null,B=Number.isInteger(w.rangeChunkSize)&&w.rangeChunkSize>0?w.rangeChunkSize:H,aI=w.worker instanceof JI?w.worker:null,lI=w.verbosity,QI=typeof w.docBaseUrl=="string"&&!(0,W.isDataScheme)(w.docBaseUrl)?w.docBaseUrl:null,vI=typeof w.cMapUrl=="string"?w.cMapUrl:null,OI=w.cMapPacked!==!1,uI=w.CMapReaderFactory||S,wI=typeof w.standardFontDataUrl=="string"?w.standardFontDataUrl:null,kI=w.StandardFontDataFactory||hI,TI=w.stopAtErrors!==!0,Il=Number.isInteger(w.maxImageSize)&&w.maxImageSize>-1?w.maxImageSize:-1,nl=w.isEvalSupported!==!1,ol=typeof w.isOffscreenCanvasSupported=="boolean"?w.isOffscreenCanvasSupported:!e.isNodeJS,PI=Number.isInteger(w.canvasMaxAreaInBytes)?w.canvasMaxAreaInBytes:-1,KI=typeof w.disableFontFace=="boolean"?w.disableFontFace:e.isNodeJS,jI=w.fontExtraProperties===!0,Wl=w.enableXfa===!0,wl=w.ownerDocument||globalThis.document,Ol=w.disableRange===!0,jl=w.disableStream===!0,NG=w.disableAutoFetch===!0,Fl=w.pdfBug===!0,Dl=iI?iI.length:w.length??NaN,XG=typeof w.useSystemFonts=="boolean"?w.useSystemFonts:!e.isNodeJS&&!KI,LG=typeof w.useWorkerFetch=="boolean"?w.useWorkerFetch:uI===W.DOMCMapReaderFactory&&kI===W.DOMStandardFontDataFactory&&vI&&wI&&(0,W.isValidFetchUrl)(vI,document.baseURI)&&(0,W.isValidFetchUrl)(wI,document.baseURI),lc=w.canvasFactory||new T({ownerDocument:wl}),DG=w.filterFactory||new cI({docId:A,ownerDocument:wl}),Wc=null;(0,e.setVerbosityLevel)(lI);let EG={canvasFactory:lc,filterFactory:DG};if(LG||(EG.cMapReaderFactory=new uI({baseUrl:vI,isCompressed:OI}),EG.standardFontDataFactory=new kI({baseUrl:wI})),!aI){let qG={verbosity:lI,port:h.GlobalWorkerOptions.workerPort};aI=qG.port?JI.fromPort(qG):new JI(qG),r._worker=aI}let MG={docId:A,apiVersion:"4.2.67",data:K,password:tI,disableAutoFetch:NG,rangeChunkSize:B,length:Dl,docBaseUrl:QI,enableXfa:Wl,evaluatorOptions:{maxImageSize:Il,disableFontFace:KI,ignoreErrors:TI,isEvalSupported:nl,isOffscreenCanvasSupported:ol,canvasMaxAreaInBytes:PI,fontExtraProperties:jI,useSystemFonts:XG,cMapUrl:LG?vI:null,standardFontDataUrl:LG?wI:null}},xc={ignoreErrors:TI,disableFontFace:KI,fontExtraProperties:jI,enableXfa:Wl,ownerDocument:wl,disableAutoFetch:NG,pdfBug:Fl,styleElement:Wc};return aI.promise.then(function(){if(r.destroyed)throw new Error("Loading aborted");let qG=VI(aI,MG),sl=new Promise(function(ul){let Cl;iI?Cl=new F.PDFDataTransportStream(iI,{disableRange:Ol,disableStream:jl}):K||(Cl=(yc=>e.isNodeJS?function(){return typeof fetch<"u"&&typeof Response<"u"&&"body"in Response.prototype}()&&(0,W.isValidFetchUrl)(yc.url)?new a.PDFFetchStream(yc):new Q.PDFNodeStream(yc):(0,W.isValidFetchUrl)(yc.url)?new a.PDFFetchStream(yc):new u.PDFNetworkStream(yc))({url:O,length:Dl,httpHeaders:q,withCredentials:GI,rangeChunkSize:B,disableRange:Ol,disableStream:jl})),ul(Cl)});return Promise.all([qG,sl]).then(function([ul,Cl]){if(r.destroyed)throw new Error("Loading aborted");let Gc=new V.MessageHandler(A,ul,aI.port),yc=new UI(Gc,r,Cl,xc,EG);r._transport=yc,Gc.send("Ready",null)})}).catch(r._capability.reject),r},sI=function(w){if(w instanceof URL)return w.href;try{return new URL(w,window.location).href}catch{if(e.isNodeJS&&typeof w=="string")return w}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")},ZI=function(w){if(e.isNodeJS&&typeof Buffer<"u"&&w instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(w instanceof Uint8Array&&w.byteLength===w.buffer.byteLength)return w;if(typeof w=="string")return(0,e.stringToBytes)(w);if(w instanceof ArrayBuffer||ArrayBuffer.isView(w)||typeof w=="object"&&!isNaN(w?.length))return new Uint8Array(w);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")},dI=function(w){return typeof w=="object"&&Number.isInteger(w?.num)&&w.num>=0&&Number.isInteger(w?.gen)&&w.gen>=0};l.d(G,{PDFDataRangeTransport:()=>yI,PDFWorker:()=>JI,build:()=>k,getDocument:()=>WI,version:()=>U});var e=l(292),t=l(792),W=l(419),n=l(10),s=l(573),N=l(923),m=l(814),h=l(164),V=l(178),X=l(62),p=l(626),F=l(585),a=l(94),u=l(457),Q=l(786),o=l(50),y=b([s,Q]);[s,Q]=y.then?(await y)():y;let H=65536,E=100,C=5e3,T=e.isNodeJS?s.NodeCanvasFactory:W.DOMCanvasFactory,S=e.isNodeJS?s.NodeCMapReaderFactory:W.DOMCMapReaderFactory,cI=e.isNodeJS?s.NodeFilterFactory:W.DOMFilterFactory,hI=e.isNodeJS?s.NodeStandardFontDataFactory:W.DOMStandardFontDataFactory;async function VI(w,r){if(w.destroyed)throw new Error("Worker was destroyed");let A=await w.messageHandler.sendWithPromise("GetDocRequest",r,r.data?[r.data.buffer]:null);if(w.destroyed)throw new Error("Worker was destroyed");return A}class pI{static#I=0;constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${pI.#I++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(r){throw this._worker?.port&&delete this._worker._pendingDestroy,r}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}class yI{constructor(r,A,O=!1,K=null){this.length=r,this.initialData=A,this.progressiveDone=O,this.contentDispositionFilename=K,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(r){this._rangeListeners.push(r)}addProgressListener(r){this._progressListeners.push(r)}addProgressiveReadListener(r){this._progressiveReadListeners.push(r)}addProgressiveDoneListener(r){this._progressiveDoneListeners.push(r)}onDataRange(r,A){for(let O of this._rangeListeners)O(r,A)}onDataProgress(r,A){this._readyCapability.promise.then(()=>{for(let O of this._progressListeners)O(r,A)})}onDataProgressiveRead(r){this._readyCapability.promise.then(()=>{for(let A of this._progressiveReadListeners)A(r)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let r of this._progressiveDoneListeners)r()})}transportReady(){this._readyCapability.resolve()}requestDataRange(r,A){(0,e.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class eI{constructor(r,A){this._pdfInfo=r,this._transport=A}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,e.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(r){return this._transport.getPage(r)}getPageIndex(r){return this._transport.getPageIndex(r)}getDestinations(){return this._transport.getDestinations()}getDestination(r){return this._transport.getDestination(r)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:r="display"}={}){let{renderingIntent:A}=this._transport.getRenderingIntent(r);return this._transport.getOptionalContentConfig(A)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(r=!1){return this._transport.startCleanup(r||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(r){return this._transport.cachedPageNumber(r)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class HI{#I=null;#l=!1;constructor(r,A,O,K=!1){this._pageIndex=r,this._pageInfo=A,this._transport=O,this._stats=K?new W.StatTimer:null,this._pdfBug=K,this.commonObjs=O.commonObjs,this.objs=new L,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:r,rotation:A=this.rotate,offsetX:O=0,offsetY:K=0,dontFlip:q=!1}={}){return new W.PageViewport({viewBox:this.view,scale:r,rotation:A,offsetX:O,offsetY:K,dontFlip:q})}getAnnotations({intent:r="display"}={}){let{renderingIntent:A}=this._transport.getRenderingIntent(r);return this._transport.getAnnotations(this._pageIndex,A)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,e.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:r,viewport:A,intent:O="display",annotationMode:K=e.AnnotationMode.ENABLE,transform:q=null,background:GI=null,optionalContentConfigPromise:tI=null,annotationCanvasMap:iI=null,pageColors:B=null,printAnnotationStorage:aI=null}){this._stats?.time("Overall");let lI=this._transport.getRenderingIntent(O,K,aI),{renderingIntent:QI,cacheKey:vI}=lI;this.#l=!1,this.#b(),tI||=this._transport.getOptionalContentConfig(QI);let OI=this._intentStates.get(vI);OI||(OI=Object.create(null),this._intentStates.set(vI,OI)),OI.streamReaderCancelTimeout&&(clearTimeout(OI.streamReaderCancelTimeout),OI.streamReaderCancelTimeout=null);let uI=!!(QI&e.RenderingIntentFlag.PRINT);OI.displayReadyCapability||(OI.displayReadyCapability=Promise.withResolvers(),OI.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(lI));let wI=Il=>{OI.renderTasks.delete(kI),(this._maybeCleanupAfterRender||uI)&&(this.#l=!0),this.#G(!uI),Il?(kI.capability.reject(Il),this._abortOperatorList({intentState:OI,reason:Il instanceof Error?Il:new Error(Il)})):kI.capability.resolve(),this._stats?.timeEnd("Rendering"),this._stats?.timeEnd("Overall")},kI=new FI({callback:wI,params:{canvasContext:r,viewport:A,transform:q,background:GI},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:iI,operatorList:OI.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!uI,pdfBug:this._pdfBug,pageColors:B});(OI.renderTasks||=new Set).add(kI);let TI=kI.task;return Promise.all([OI.displayReadyCapability.promise,tI]).then(([Il,nl])=>{if(this.destroyed){wI();return}if(this._stats?.time("Rendering"),!(nl.renderingIntent&QI))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");kI.initializeGraphics({transparency:Il,optionalContentConfig:nl}),kI.operatorListChanged()}).catch(wI),TI}getOperatorList({intent:r="display",annotationMode:A=e.AnnotationMode.ENABLE,printAnnotationStorage:O=null}={}){function K(){GI.operatorList.lastChunk&&(GI.opListReadCapability.resolve(GI.operatorList),GI.renderTasks.delete(tI))}let q=this._transport.getRenderingIntent(r,A,O,!0),GI=this._intentStates.get(q.cacheKey);GI||(GI=Object.create(null),this._intentStates.set(q.cacheKey,GI));let tI;return GI.opListReadCapability||(tI=Object.create(null),tI.operatorListChanged=K,GI.opListReadCapability=Promise.withResolvers(),(GI.renderTasks||=new Set).add(tI),GI.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(q)),GI.opListReadCapability.promise}streamTextContent({includeMarkedContent:r=!1,disableNormalization:A=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:r===!0,disableNormalization:A===!0},{highWaterMark:100,size(K){return K.items.length}})}getTextContent(r={}){if(this._transport._htmlForXfa)return this.getXfa().then(O=>o.XfaText.textContent(O));let A=this.streamTextContent(r);return new Promise(function(O,K){function q(){GI.read().then(function({value:iI,done:B}){if(B){O(tI);return}Object.assign(tI.styles,iI.styles),tI.items.push(...iI.items),q()},K)}let GI=A.getReader(),tI={items:[],styles:Object.create(null)};q()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let r=[];for(let A of this._intentStates.values())if(this._abortOperatorList({intentState:A,reason:new Error("Page was destroyed."),force:!0}),!A.opListReadCapability)for(let O of A.renderTasks)r.push(O.completed),O.cancel();return this.objs.clear(),this.#l=!1,this.#b(),Promise.all(r)}cleanup(r=!1){this.#l=!0;let A=this.#G(!1);return r&&A&&(this._stats&&=new W.StatTimer),A}#G(r=!1){if(this.#b(),!this.#l||this.destroyed)return!1;if(r)return this.#I=setTimeout(()=>{this.#I=null,this.#G(!1)},C),!1;for(let{renderTasks:A,operatorList:O}of this._intentStates.values())if(A.size>0||!O.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#l=!1,!0}#b(){this.#I&&(clearTimeout(this.#I),this.#I=null)}_startRenderPage(r,A){let O=this._intentStates.get(A);O&&(this._stats?.timeEnd("Page Request"),O.displayReadyCapability?.resolve(r))}_renderPageChunk(r,A){for(let O=0,K=r.length;O<K;O++)A.operatorList.fnArray.push(r.fnArray[O]),A.operatorList.argsArray.push(r.argsArray[O]);A.operatorList.lastChunk=r.lastChunk,A.operatorList.separateAnnots=r.separateAnnots;for(let O of A.renderTasks)O.operatorListChanged();r.lastChunk&&this.#G(!0)}_pumpOperatorList({renderingIntent:r,cacheKey:A,annotationStorageSerializable:O}){let{map:K,transfer:q}=O,tI=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:r,cacheKey:A,annotationStorage:K},q).getReader(),iI=this._intentStates.get(A);iI.streamReader=tI;let B=()=>{tI.read().then(({value:aI,done:lI})=>{if(lI){iI.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(aI,iI),B())},aI=>{if(iI.streamReader=null,!this._transport.destroyed){if(iI.operatorList){iI.operatorList.lastChunk=!0;for(let lI of iI.renderTasks)lI.operatorListChanged();this.#G(!0)}if(iI.displayReadyCapability)iI.displayReadyCapability.reject(aI);else if(iI.opListReadCapability)iI.opListReadCapability.reject(aI);else throw aI}})};B()}_abortOperatorList({intentState:r,reason:A,force:O=!1}){if(r.streamReader){if(r.streamReaderCancelTimeout&&(clearTimeout(r.streamReaderCancelTimeout),r.streamReaderCancelTimeout=null),!O){if(r.renderTasks.size>0)return;if(A instanceof W.RenderingCancelledException){let K=E;A.extraDelay>0&&A.extraDelay<1e3&&(K+=A.extraDelay),r.streamReaderCancelTimeout=setTimeout(()=>{r.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:r,reason:A,force:!0})},K);return}}if(r.streamReader.cancel(new e.AbortException(A.message)).catch(()=>{}),r.streamReader=null,!this._transport.destroyed){for(let[K,q]of this._intentStates)if(q===r){this._intentStates.delete(K);break}this.cleanup()}}}get stats(){return this._stats}}class YI{#I=new Set;#l=Promise.resolve();postMessage(r,A){let O={data:structuredClone(r,A?{transfer:A}:null)};this.#l.then(()=>{for(let K of this.#I)K.call(this,O)})}addEventListener(r,A){this.#I.add(A)}removeEventListener(r,A){this.#I.delete(A)}terminate(){this.#I.clear()}}let $={isWorkerDisabled:!1,fakeWorkerId:0};e.isNodeJS&&($.isWorkerDisabled=!0,h.GlobalWorkerOptions.workerSrc||="./pdf.worker.mjs"),$.isSameOrigin=function(w,r){let A;try{if(A=new URL(w),!A.origin||A.origin==="null")return!1}catch{return!1}let O=new URL(r,A);return A.origin===O.origin},$.createCDNWrapper=function(w){let r=`await import("${w}");`;return URL.createObjectURL(new Blob([r],{type:"text/javascript"}))};class JI{static#I;constructor({name:r=null,port:A=null,verbosity:O=(0,e.getVerbosityLevel)()}={}){if(this.name=r,this.destroyed=!1,this.verbosity=O,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,A){if(JI.#I?.has(A))throw new Error("Cannot use more than one PDFWorker per port.");(JI.#I||=new WeakMap).set(A,this),this._initializeFromPort(A);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(r){this._port=r,this._messageHandler=new V.MessageHandler("main","worker",r),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!$.isWorkerDisabled&&!JI.#l){let{workerSrc:r}=JI;try{$.isSameOrigin(window.location.href,r)||(r=$.createCDNWrapper(new URL(r,window.location).href));let A=new Worker(r,{type:"module"}),O=new V.MessageHandler("main","worker",A),K=()=>{A.removeEventListener("error",q),O.destroy(),A.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},q=()=>{this._webWorker||K()};A.addEventListener("error",q),O.on("test",tI=>{if(A.removeEventListener("error",q),this.destroyed){K();return}tI?(this._messageHandler=O,this._port=A,this._webWorker=A,this._readyCapability.resolve(),O.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),O.destroy(),A.terminate())}),O.on("ready",tI=>{if(A.removeEventListener("error",q),this.destroyed){K();return}try{GI()}catch{this._setupFakeWorker()}});let GI=()=>{let tI=new Uint8Array;O.send("test",tI,[tI.buffer])};GI();return}catch{(0,e.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){$.isWorkerDisabled||((0,e.warn)("Setting up fake worker."),$.isWorkerDisabled=!0),JI._setupFakeWorkerGlobal.then(r=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let A=new YI;this._port=A;let O=`fake${$.fakeWorkerId++}`,K=new V.MessageHandler(O+"_worker",O,A);r.setup(K,A);let q=new V.MessageHandler(O,O+"_worker",A);this._messageHandler=q,this._readyCapability.resolve(),q.send("configure",{verbosity:this.verbosity})}).catch(r=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${r.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),JI.#I?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(r){if(!r?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");let A=this.#I?.get(r.port);if(A){if(A._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return A}return new JI(r)}static get workerSrc(){if(h.GlobalWorkerOptions.workerSrc)return h.GlobalWorkerOptions.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#l(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){let r=async()=>this.#l?this.#l:(await import(this.workerSrc)).WorkerMessageHandler;return(0,e.shadow)(this,"_setupFakeWorkerGlobal",r())}}class UI{#I=new Map;#l=new Map;#G=new Map;#b=new Map;#d=null;constructor(r,A,O,K,q){this.messageHandler=r,this.loadingTask=A,this.commonObjs=new L,this.fontLoader=new n.FontLoader({ownerDocument:K.ownerDocument,styleElement:K.styleElement}),this._params=K,this.canvasFactory=q.canvasFactory,this.filterFactory=q.filterFactory,this.cMapReaderFactory=q.cMapReaderFactory,this.standardFontDataFactory=q.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=O,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}#c(r,A=null){let O=this.#I.get(r);if(O)return O;let K=this.messageHandler.sendWithPromise(r,A);return this.#I.set(r,K),K}get annotationStorage(){return(0,e.shadow)(this,"annotationStorage",new t.AnnotationStorage)}getRenderingIntent(r,A=e.AnnotationMode.ENABLE,O=null,K=!1){let q=e.RenderingIntentFlag.DISPLAY,GI=t.SerializableEmpty;switch(r){case"any":q=e.RenderingIntentFlag.ANY;break;case"display":break;case"print":q=e.RenderingIntentFlag.PRINT;break;default:(0,e.warn)(`getRenderingIntent - invalid intent: ${r}`)}switch(A){case e.AnnotationMode.DISABLE:q+=e.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case e.AnnotationMode.ENABLE:break;case e.AnnotationMode.ENABLE_FORMS:q+=e.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case e.AnnotationMode.ENABLE_STORAGE:q+=e.RenderingIntentFlag.ANNOTATIONS_STORAGE,GI=(q&e.RenderingIntentFlag.PRINT&&O instanceof t.PrintAnnotationStorage?O:this.annotationStorage).serializable;break;default:(0,e.warn)(`getRenderingIntent - invalid annotationMode: ${A}`)}return K&&(q+=e.RenderingIntentFlag.OPLIST),{renderingIntent:q,cacheKey:`${q}_${GI.hash}`,annotationStorageSerializable:GI}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#d?.reject(new Error("Worker was destroyed during onPassword callback"));let r=[];for(let O of this.#l.values())r.push(O._destroy());this.#l.clear(),this.#G.clear(),this.#b.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let A=this.messageHandler.sendWithPromise("Terminate",null);return r.push(A),Promise.all(r).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#I.clear(),this.filterFactory.destroy(),(0,m.cleanupTextLayer)(),this._networkStream?.cancelAllRequests(new e.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:r,loadingTask:A}=this;r.on("GetReader",(O,K)=>{(0,e.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=q=>{this._lastProgress={loaded:q.loaded,total:q.total}},K.onPull=()=>{this._fullReader.read().then(function({value:q,done:GI}){if(GI){K.close();return}(0,e.assert)(q instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),K.enqueue(new Uint8Array(q),1,[q])}).catch(q=>{K.error(q)})},K.onCancel=q=>{this._fullReader.cancel(q),K.ready.catch(GI=>{if(!this.destroyed)throw GI})}}),r.on("ReaderHeadersReady",O=>{let K=Promise.withResolvers(),q=this._fullReader;return q.headersReady.then(()=>{(!q.isStreamingSupported||!q.isRangeSupported)&&(this._lastProgress&&A.onProgress?.(this._lastProgress),q.onProgress=GI=>{A.onProgress?.({loaded:GI.loaded,total:GI.total})}),K.resolve({isStreamingSupported:q.isStreamingSupported,isRangeSupported:q.isRangeSupported,contentLength:q.contentLength})},K.reject),K.promise}),r.on("GetRangeReader",(O,K)=>{(0,e.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let q=this._networkStream.getRangeReader(O.begin,O.end);if(!q){K.close();return}K.onPull=()=>{q.read().then(function({value:GI,done:tI}){if(tI){K.close();return}(0,e.assert)(GI instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),K.enqueue(new Uint8Array(GI),1,[GI])}).catch(GI=>{K.error(GI)})},K.onCancel=GI=>{q.cancel(GI),K.ready.catch(tI=>{if(!this.destroyed)throw tI})}}),r.on("GetDoc",({pdfInfo:O})=>{this._numPages=O.numPages,this._htmlForXfa=O.htmlForXfa,delete O.htmlForXfa,A._capability.resolve(new eI(O,this))}),r.on("DocException",function(O){let K;switch(O.name){case"PasswordException":K=new e.PasswordException(O.message,O.code);break;case"InvalidPDFException":K=new e.InvalidPDFException(O.message);break;case"MissingPDFException":K=new e.MissingPDFException(O.message);break;case"UnexpectedResponseException":K=new e.UnexpectedResponseException(O.message,O.status);break;case"UnknownErrorException":K=new e.UnknownErrorException(O.message,O.details);break;default:(0,e.unreachable)("DocException - expected a valid Error.")}A._capability.reject(K)}),r.on("PasswordRequest",O=>{if(this.#d=Promise.withResolvers(),A.onPassword){let K=q=>{q instanceof Error?this.#d.reject(q):this.#d.resolve({password:q})};try{A.onPassword(K,O.code)}catch(q){this.#d.reject(q)}}else this.#d.reject(new e.PasswordException(O.message,O.code));return this.#d.promise}),r.on("DataLoaded",O=>{A.onProgress?.({loaded:O.length,total:O.length}),this.downloadInfoCapability.resolve(O)}),r.on("StartRenderPage",O=>{if(this.destroyed)return;this.#l.get(O.pageIndex)._startRenderPage(O.transparency,O.cacheKey)}),r.on("commonobj",([O,K,q])=>{if(this.destroyed||this.commonObjs.has(O))return null;switch(K){case"Font":let GI=this._params;if("error"in q){let aI=q.error;(0,e.warn)(`Error during font loading: ${aI}`),this.commonObjs.resolve(O,aI);break}let tI=GI.pdfBug&&globalThis.FontInspector?.enabled?(aI,lI)=>globalThis.FontInspector.fontAdded(aI,lI):null,iI=new n.FontFaceObject(q,{disableFontFace:GI.disableFontFace,ignoreErrors:GI.ignoreErrors,inspectFont:tI});this.fontLoader.bind(iI).catch(()=>r.sendWithPromise("FontFallback",{id:O})).finally(()=>{!GI.fontExtraProperties&&iI.data&&(iI.data=null),this.commonObjs.resolve(O,iI)});break;case"CopyLocalImage":let{imageRef:B}=q;(0,e.assert)(B,"The imageRef must be defined.");for(let aI of this.#l.values())for(let[,lI]of aI.objs)if(lI.ref===B)return lI.dataLen?(this.commonObjs.resolve(O,structuredClone(lI)),lI.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(O,q);break;default:throw new Error(`Got unknown common object type ${K}`)}return null}),r.on("obj",([O,K,q,GI])=>{if(this.destroyed)return;let tI=this.#l.get(K);if(!tI.objs.has(O)){if(tI._intentStates.size===0){GI?.bitmap?.close();return}switch(q){case"Image":tI.objs.resolve(O,GI),GI?.dataLen>e.MAX_IMAGE_SIZE_TO_CACHE&&(tI._maybeCleanupAfterRender=!0);break;case"Pattern":tI.objs.resolve(O,GI);break;default:throw new Error(`Got unknown object type ${q}`)}}}),r.on("DocProgress",O=>{this.destroyed||A.onProgress?.({loaded:O.loaded,total:O.total})}),r.on("FetchBuiltInCMap",O=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(O):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),r.on("FetchStandardFontData",O=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(O):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&(0,e.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:r,transfer:A}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:r,filename:this._fullReader?.filename??null},A).finally(()=>{this.annotationStorage.resetModified()})}getPage(r){if(!Number.isInteger(r)||r<=0||r>this._numPages)return Promise.reject(new Error("Invalid page request."));let A=r-1,O=this.#G.get(A);if(O)return O;let K=this.messageHandler.sendWithPromise("GetPage",{pageIndex:A}).then(q=>{if(this.destroyed)throw new Error("Transport destroyed");q.refStr&&this.#b.set(q.refStr,r);let GI=new HI(A,q,this,this._params.pdfBug);return this.#l.set(A,GI),GI});return this.#G.set(A,K),K}getPageIndex(r){return dI(r)?this.messageHandler.sendWithPromise("GetPageIndex",{num:r.num,gen:r.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(r,A){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:r,intent:A})}getFieldObjects(){return this.#c("GetFieldObjects")}hasJSActions(){return this.#c("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(r){return typeof r!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:r})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#c("GetDocJSActions")}getPageJSActions(r){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:r})}getStructTree(r){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:r})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(r){return this.#c("GetOptionalContentConfig").then(A=>new p.OptionalContentConfig(A,r))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let r="GetMetadata",A=this.#I.get(r);if(A)return A;let O=this.messageHandler.sendWithPromise(r,null).then(K=>({info:K[0],metadata:K[1]?new X.Metadata(K[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#I.set(r,O),O}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(r=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(let A of this.#l.values())if(!A.cleanup())throw new Error(`startCleanup: Page ${A.pageNumber} is currently rendering.`);this.commonObjs.clear(),r||this.fontLoader.clear(),this.#I.clear(),this.filterFactory.destroy(!0),(0,m.cleanupTextLayer)()}}cachedPageNumber(r){if(!dI(r))return null;let A=r.gen===0?`${r.num}R`:`${r.num}R${r.gen}`;return this.#b.get(A)??null}get loadingParams(){let{disableAutoFetch:r,enableXfa:A}=this._params;return(0,e.shadow)(this,"loadingParams",{disableAutoFetch:r,enableXfa:A})}}let zI=Symbol("INITIAL_DATA");class L{#I=Object.create(null);#l(r){return this.#I[r]||={...Promise.withResolvers(),data:zI}}get(r,A=null){if(A){let K=this.#l(r);return K.promise.then(()=>A(K.data)),null}let O=this.#I[r];if(!O||O.data===zI)throw new Error(`Requesting object that isn't resolved yet ${r}.`);return O.data}has(r){let A=this.#I[r];return!!A&&A.data!==zI}resolve(r,A=null){let O=this.#l(r);O.data=A,O.resolve()}clear(){for(let r in this.#I){let{data:A}=this.#I[r];A?.bitmap?.close()}this.#I=Object.create(null)}*[Symbol.iterator](){for(let r in this.#I){let{data:A}=this.#I[r];A!==zI&&(yield[r,A])}}}class bI{#I=null;constructor(r){this.#I=r,this.onContinue=null}get promise(){return this.#I.capability.promise}cancel(r=0){this.#I.cancel(null,r)}get separateAnnots(){let{separateAnnots:r}=this.#I.operatorList;if(!r)return!1;let{annotationCanvasMap:A}=this.#I;return r.form||r.canvas&&A?.size>0}}class FI{static#I=new WeakSet;constructor({callback:r,params:A,objs:O,commonObjs:K,annotationCanvasMap:q,operatorList:GI,pageIndex:tI,canvasFactory:iI,filterFactory:B,useRequestAnimationFrame:aI=!1,pdfBug:lI=!1,pageColors:QI=null}){this.callback=r,this.params=A,this.objs=O,this.commonObjs=K,this.annotationCanvasMap=q,this.operatorListIdx=null,this.operatorList=GI,this._pageIndex=tI,this.canvasFactory=iI,this.filterFactory=B,this._pdfBug=lI,this.pageColors=QI,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=aI===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new bI(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=A.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:r=!1,optionalContentConfig:A}){if(this.cancelled)return;if(this._canvas){if(FI.#I.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");FI.#I.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:O,viewport:K,transform:q,background:GI}=this.params;this.gfx=new N.CanvasGraphics(O,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:A},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:q,viewport:K,transparency:r,background:GI}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(r=null,A=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),FI.#I.delete(this._canvas),this.callback(r||new W.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,A))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),FI.#I.delete(this._canvas),this.callback())))}}let U="4.2.67",k="49b388101";d()}catch(H){d(H)}})},583:(I,G,l)=>{l.d(G,{BaseCMapReaderFactory:()=>t,BaseCanvasFactory:()=>e,BaseFilterFactory:()=>d,BaseSVGFactory:()=>n,BaseStandardFontDataFactory:()=>W});var b=l(292);class d{constructor(){this.constructor===d&&(0,b.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(N){return"none"}addHCMFilter(N,m){return"none"}addHighlightHCMFilter(N,m,h,V,X){return"none"}destroy(N=!1){}}class e{constructor(){this.constructor===e&&(0,b.unreachable)("Cannot initialize BaseCanvasFactory.")}create(N,m){if(N<=0||m<=0)throw new Error("Invalid canvas size");let h=this._createCanvas(N,m);return{canvas:h,context:h.getContext("2d")}}reset(N,m,h){if(!N.canvas)throw new Error("Canvas is not specified");if(m<=0||h<=0)throw new Error("Invalid canvas size");N.canvas.width=m,N.canvas.height=h}destroy(N){if(!N.canvas)throw new Error("Canvas is not specified");N.canvas.width=0,N.canvas.height=0,N.canvas=null,N.context=null}_createCanvas(N,m){(0,b.unreachable)("Abstract method `_createCanvas` called.")}}class t{constructor({baseUrl:N=null,isCompressed:m=!0}){this.constructor===t&&(0,b.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=N,this.isCompressed=m}async fetch({name:N}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!N)throw new Error("CMap name must be specified.");let m=this.baseUrl+N+(this.isCompressed?".bcmap":""),h=this.isCompressed?b.CMapCompressionType.BINARY:b.CMapCompressionType.NONE;return this._fetchData(m,h).catch(V=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${m}`)})}_fetchData(N,m){(0,b.unreachable)("Abstract method `_fetchData` called.")}}class W{constructor({baseUrl:N=null}){this.constructor===W&&(0,b.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=N}async fetch({filename:N}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!N)throw new Error("Font filename must be specified.");let m=`${this.baseUrl}${N}`;return this._fetchData(m).catch(h=>{throw new Error(`Unable to load font data at: ${m}`)})}_fetchData(N){(0,b.unreachable)("Abstract method `_fetchData` called.")}}class n{constructor(){this.constructor===n&&(0,b.unreachable)("Cannot initialize BaseSVGFactory.")}create(N,m,h=!1){if(N<=0||m<=0)throw new Error("Invalid SVG dimensions");let V=this._createSVG("svg:svg");return V.setAttribute("version","1.1"),h||(V.setAttribute("width",`${N}px`),V.setAttribute("height",`${m}px`)),V.setAttribute("preserveAspectRatio","none"),V.setAttribute("viewBox",`0 0 ${N} ${m}`),V}createElement(N){if(typeof N!="string")throw new Error("Invalid SVG element type");return this._createSVG(N)}_createSVG(N){(0,b.unreachable)("Abstract method `_createSVG` called.")}}},923:(I,G,l)=>{l.d(G,{CanvasGraphics:()=>U});var b=l(292),d=l(419);let e={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function t(k,w){if(!w)return;let r=w[2]-w[0],A=w[3]-w[1],O=new Path2D;O.rect(w[0],w[1],r,A),k.clip(O)}class W{constructor(){this.constructor===W&&(0,b.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,b.unreachable)("Abstract method `getPattern` called.")}}class n extends W{constructor(w){super(),this._type=w[1],this._bbox=w[2],this._colorStops=w[3],this._p0=w[4],this._p1=w[5],this._r0=w[6],this._r1=w[7],this.matrix=null}_createGradient(w){let r;this._type==="axial"?r=w.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(r=w.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let A of this._colorStops)r.addColorStop(A[0],A[1]);return r}getPattern(w,r,A,O){let K;if(O===e.STROKE||O===e.FILL){let q=r.current.getClippedPathBoundingBox(O,(0,d.getCurrentTransform)(w))||[0,0,0,0],GI=Math.ceil(q[2]-q[0])||1,tI=Math.ceil(q[3]-q[1])||1,iI=r.cachedCanvases.getCanvas("pattern",GI,tI,!0),B=iI.context;B.clearRect(0,0,B.canvas.width,B.canvas.height),B.beginPath(),B.rect(0,0,B.canvas.width,B.canvas.height),B.translate(-q[0],-q[1]),A=b.Util.transform(A,[1,0,0,1,q[0],q[1]]),B.transform(...r.baseTransform),this.matrix&&B.transform(...this.matrix),t(B,this._bbox),B.fillStyle=this._createGradient(B),B.fill(),K=w.createPattern(iI.canvas,"no-repeat");let aI=new DOMMatrix(A);K.setTransform(aI)}else t(w,this._bbox),K=this._createGradient(w);return K}}function s(k,w,r,A,O,K,q,GI){let tI=w.coords,iI=w.colors,B=k.data,aI=k.width*4,lI;tI[r+1]>tI[A+1]&&(lI=r,r=A,A=lI,lI=K,K=q,q=lI),tI[A+1]>tI[O+1]&&(lI=A,A=O,O=lI,lI=q,q=GI,GI=lI),tI[r+1]>tI[A+1]&&(lI=r,r=A,A=lI,lI=K,K=q,q=lI);let QI=(tI[r]+w.offsetX)*w.scaleX,vI=(tI[r+1]+w.offsetY)*w.scaleY,OI=(tI[A]+w.offsetX)*w.scaleX,uI=(tI[A+1]+w.offsetY)*w.scaleY,wI=(tI[O]+w.offsetX)*w.scaleX,kI=(tI[O+1]+w.offsetY)*w.scaleY;if(vI>=kI)return;let TI=iI[K],Il=iI[K+1],nl=iI[K+2],ol=iI[q],PI=iI[q+1],KI=iI[q+2],jI=iI[GI],Wl=iI[GI+1],wl=iI[GI+2],Ol=Math.round(vI),jl=Math.round(kI),NG,Fl,Dl,XG,LG,lc,DG,Wc;for(let EG=Ol;EG<=jl;EG++){if(EG<uI){let ul=EG<vI?0:(vI-EG)/(vI-uI);NG=QI-(QI-OI)*ul,Fl=TI-(TI-ol)*ul,Dl=Il-(Il-PI)*ul,XG=nl-(nl-KI)*ul}else{let ul;EG>kI?ul=1:uI===kI?ul=0:ul=(uI-EG)/(uI-kI),NG=OI-(OI-wI)*ul,Fl=ol-(ol-jI)*ul,Dl=PI-(PI-Wl)*ul,XG=KI-(KI-wl)*ul}let MG;EG<vI?MG=0:EG>kI?MG=1:MG=(vI-EG)/(vI-kI),LG=QI-(QI-wI)*MG,lc=TI-(TI-jI)*MG,DG=Il-(Il-Wl)*MG,Wc=nl-(nl-wl)*MG;let xc=Math.round(Math.min(NG,LG)),qG=Math.round(Math.max(NG,LG)),sl=aI*EG+xc*4;for(let ul=xc;ul<=qG;ul++)MG=(NG-ul)/(NG-LG),MG<0?MG=0:MG>1&&(MG=1),B[sl++]=Fl-(Fl-lc)*MG|0,B[sl++]=Dl-(Dl-DG)*MG|0,B[sl++]=XG-(XG-Wc)*MG|0,B[sl++]=255}}function N(k,w,r){let A=w.coords,O=w.colors,K,q;switch(w.type){case"lattice":let GI=w.verticesPerRow,tI=Math.floor(A.length/GI)-1,iI=GI-1;for(K=0;K<tI;K++){let B=K*GI;for(let aI=0;aI<iI;aI++,B++)s(k,r,A[B],A[B+1],A[B+GI],O[B],O[B+1],O[B+GI]),s(k,r,A[B+GI+1],A[B+1],A[B+GI],O[B+GI+1],O[B+1],O[B+GI])}break;case"triangles":for(K=0,q=A.length;K<q;K+=3)s(k,r,A[K],A[K+1],A[K+2],O[K],O[K+1],O[K+2]);break;default:throw new Error("illegal figure")}}class m extends W{constructor(w){super(),this._coords=w[2],this._colors=w[3],this._figures=w[4],this._bounds=w[5],this._bbox=w[7],this._background=w[8],this.matrix=null}_createMeshCanvas(w,r,A){let GI=Math.floor(this._bounds[0]),tI=Math.floor(this._bounds[1]),iI=Math.ceil(this._bounds[2])-GI,B=Math.ceil(this._bounds[3])-tI,aI=Math.min(Math.ceil(Math.abs(iI*w[0]*1.1)),3e3),lI=Math.min(Math.ceil(Math.abs(B*w[1]*1.1)),3e3),QI=iI/aI,vI=B/lI,OI={coords:this._coords,colors:this._colors,offsetX:-GI,offsetY:-tI,scaleX:1/QI,scaleY:1/vI},uI=aI+2*2,wI=lI+2*2,kI=A.getCanvas("mesh",uI,wI,!1),TI=kI.context,Il=TI.createImageData(aI,lI);if(r){let ol=Il.data;for(let PI=0,KI=ol.length;PI<KI;PI+=4)ol[PI]=r[0],ol[PI+1]=r[1],ol[PI+2]=r[2],ol[PI+3]=255}for(let ol of this._figures)N(Il,ol,OI);return TI.putImageData(Il,2,2),{canvas:kI.canvas,offsetX:GI-2*QI,offsetY:tI-2*vI,scaleX:QI,scaleY:vI}}getPattern(w,r,A,O){t(w,this._bbox);let K;if(O===e.SHADING)K=b.Util.singularValueDecompose2dScale((0,d.getCurrentTransform)(w));else if(K=b.Util.singularValueDecompose2dScale(r.baseTransform),this.matrix){let GI=b.Util.singularValueDecompose2dScale(this.matrix);K=[K[0]*GI[0],K[1]*GI[1]]}let q=this._createMeshCanvas(K,O===e.SHADING?null:this._background,r.cachedCanvases);return O!==e.SHADING&&(w.setTransform(...r.baseTransform),this.matrix&&w.transform(...this.matrix)),w.translate(q.offsetX,q.offsetY),w.scale(q.scaleX,q.scaleY),w.createPattern(q.canvas,"no-repeat")}}class h extends W{getPattern(){return"hotpink"}}function V(k){switch(k[0]){case"RadialAxial":return new n(k);case"Mesh":return new m(k);case"Dummy":return new h}throw new Error(`Unknown IR type: ${k[0]}`)}let X={COLORED:1,UNCOLORED:2};class p{static MAX_PATTERN_SIZE=3e3;constructor(w,r,A,O,K){this.operatorList=w[2],this.matrix=w[3]||[1,0,0,1,0,0],this.bbox=w[4],this.xstep=w[5],this.ystep=w[6],this.paintType=w[7],this.tilingType=w[8],this.color=r,this.ctx=A,this.canvasGraphicsFactory=O,this.baseTransform=K}createPatternCanvas(w){let r=this.operatorList,A=this.bbox,O=this.xstep,K=this.ystep,q=this.paintType,GI=this.tilingType,tI=this.color,iI=this.canvasGraphicsFactory;(0,b.info)("TilingType: "+GI);let B=A[0],aI=A[1],lI=A[2],QI=A[3],vI=b.Util.singularValueDecompose2dScale(this.matrix),OI=b.Util.singularValueDecompose2dScale(this.baseTransform),uI=[vI[0]*OI[0],vI[1]*OI[1]],wI=this.getSizeAndScale(O,this.ctx.canvas.width,uI[0]),kI=this.getSizeAndScale(K,this.ctx.canvas.height,uI[1]),TI=w.cachedCanvases.getCanvas("pattern",wI.size,kI.size,!0),Il=TI.context,nl=iI.createCanvasGraphics(Il);nl.groupLevel=w.groupLevel,this.setFillAndStrokeStyleToContext(nl,q,tI);let ol=B,PI=aI,KI=lI,jI=QI;return B<0&&(ol=0,KI+=Math.abs(B)),aI<0&&(PI=0,jI+=Math.abs(aI)),Il.translate(-(wI.scale*ol),-(kI.scale*PI)),nl.transform(wI.scale,0,0,kI.scale,0,0),Il.save(),this.clipBbox(nl,ol,PI,KI,jI),nl.baseTransform=(0,d.getCurrentTransform)(nl.ctx),nl.executeOperatorList(r),nl.endDrawing(),{canvas:TI.canvas,scaleX:wI.scale,scaleY:kI.scale,offsetX:ol,offsetY:PI}}getSizeAndScale(w,r,A){w=Math.abs(w);let O=Math.max(p.MAX_PATTERN_SIZE,r),K=Math.ceil(w*A);return K>=O?K=O:A=K/w,{scale:A,size:K}}clipBbox(w,r,A,O,K){let q=O-r,GI=K-A;w.ctx.rect(r,A,q,GI),w.current.updateRectMinMax((0,d.getCurrentTransform)(w.ctx),[r,A,O,K]),w.clip(),w.endPath()}setFillAndStrokeStyleToContext(w,r,A){let O=w.ctx,K=w.current;switch(r){case X.COLORED:let q=this.ctx;O.fillStyle=q.fillStyle,O.strokeStyle=q.strokeStyle,K.fillColor=q.fillStyle,K.strokeColor=q.strokeStyle;break;case X.UNCOLORED:let GI=b.Util.makeHexColor(A[0],A[1],A[2]);O.fillStyle=GI,O.strokeStyle=GI,K.fillColor=GI,K.strokeColor=GI;break;default:throw new b.FormatError(`Unsupported paint type: ${r}`)}}getPattern(w,r,A,O){let K=A;O!==e.SHADING&&(K=b.Util.transform(K,r.baseTransform),this.matrix&&(K=b.Util.transform(K,this.matrix)));let q=this.createPatternCanvas(r),GI=new DOMMatrix(K);GI=GI.translate(q.offsetX,q.offsetY),GI=GI.scale(1/q.scaleX,1/q.scaleY);let tI=w.createPattern(q.canvas,"repeat");return tI.setTransform(GI),tI}}function F(k){switch(k.kind){case ImageKind.GRAYSCALE_1BPP:return a(k);case ImageKind.RGB_24BPP:return u(k)}return null}function a({src:k,srcPos:w=0,dest:r,width:A,height:O,nonBlackColor:K=4294967295,inverseDecode:q=!1}){let GI=b.FeatureTest.isLittleEndian?4278190080:255,[tI,iI]=q?[K,GI]:[GI,K],B=A>>3,aI=A&7,lI=k.length;r=new Uint32Array(r.buffer);let QI=0;for(let vI=0;vI<O;vI++){for(let uI=w+B;w<uI;w++){let wI=w<lI?k[w]:255;r[QI++]=wI&128?iI:tI,r[QI++]=wI&64?iI:tI,r[QI++]=wI&32?iI:tI,r[QI++]=wI&16?iI:tI,r[QI++]=wI&8?iI:tI,r[QI++]=wI&4?iI:tI,r[QI++]=wI&2?iI:tI,r[QI++]=wI&1?iI:tI}if(aI===0)continue;let OI=w<lI?k[w++]:255;for(let uI=0;uI<aI;uI++)r[QI++]=OI&1<<7-uI?iI:tI}return{srcPos:w,destPos:QI}}function u({src:k,srcPos:w=0,dest:r,destPos:A=0,width:O,height:K}){let q=0,GI=k.length>>2,tI=new Uint32Array(k.buffer,w,GI);if(FeatureTest.isLittleEndian){for(;q<GI-2;q+=3,A+=4){let iI=tI[q],B=tI[q+1],aI=tI[q+2];r[A]=iI|4278190080,r[A+1]=iI>>>24|B<<8|4278190080,r[A+2]=B>>>16|aI<<16|4278190080,r[A+3]=aI>>>8|4278190080}for(let iI=q*4,B=k.length;iI<B;iI+=3)r[A++]=k[iI]|k[iI+1]<<8|k[iI+2]<<16|4278190080}else{for(;q<GI-2;q+=3,A+=4){let iI=tI[q],B=tI[q+1],aI=tI[q+2];r[A]=iI|255,r[A+1]=iI<<24|B>>>8|255,r[A+2]=B<<16|aI>>>16|255,r[A+3]=aI<<8|255}for(let iI=q*4,B=k.length;iI<B;iI+=3)r[A++]=k[iI]<<24|k[iI+1]<<16|k[iI+2]<<8|255}return{srcPos:w,destPos:A}}function Q(k,w){if(FeatureTest.isLittleEndian)for(let r=0,A=k.length;r<A;r++)w[r]=k[r]*65793|4278190080;else for(let r=0,A=k.length;r<A;r++)w[r]=k[r]*16843008|255}let o=16,y=100,H=4096,E=15,C=10,T=1e3,S=16;function cI(k,w){if(k._removeMirroring)throw new Error("Context is already forwarding operations.");k.__originalSave=k.save,k.__originalRestore=k.restore,k.__originalRotate=k.rotate,k.__originalScale=k.scale,k.__originalTranslate=k.translate,k.__originalTransform=k.transform,k.__originalSetTransform=k.setTransform,k.__originalResetTransform=k.resetTransform,k.__originalClip=k.clip,k.__originalMoveTo=k.moveTo,k.__originalLineTo=k.lineTo,k.__originalBezierCurveTo=k.bezierCurveTo,k.__originalRect=k.rect,k.__originalClosePath=k.closePath,k.__originalBeginPath=k.beginPath,k._removeMirroring=()=>{k.save=k.__originalSave,k.restore=k.__originalRestore,k.rotate=k.__originalRotate,k.scale=k.__originalScale,k.translate=k.__originalTranslate,k.transform=k.__originalTransform,k.setTransform=k.__originalSetTransform,k.resetTransform=k.__originalResetTransform,k.clip=k.__originalClip,k.moveTo=k.__originalMoveTo,k.lineTo=k.__originalLineTo,k.bezierCurveTo=k.__originalBezierCurveTo,k.rect=k.__originalRect,k.closePath=k.__originalClosePath,k.beginPath=k.__originalBeginPath,delete k._removeMirroring},k.save=function(){w.save(),this.__originalSave()},k.restore=function(){w.restore(),this.__originalRestore()},k.translate=function(A,O){w.translate(A,O),this.__originalTranslate(A,O)},k.scale=function(A,O){w.scale(A,O),this.__originalScale(A,O)},k.transform=function(A,O,K,q,GI,tI){w.transform(A,O,K,q,GI,tI),this.__originalTransform(A,O,K,q,GI,tI)},k.setTransform=function(A,O,K,q,GI,tI){w.setTransform(A,O,K,q,GI,tI),this.__originalSetTransform(A,O,K,q,GI,tI)},k.resetTransform=function(){w.resetTransform(),this.__originalResetTransform()},k.rotate=function(A){w.rotate(A),this.__originalRotate(A)},k.clip=function(A){w.clip(A),this.__originalClip(A)},k.moveTo=function(r,A){w.moveTo(r,A),this.__originalMoveTo(r,A)},k.lineTo=function(r,A){w.lineTo(r,A),this.__originalLineTo(r,A)},k.bezierCurveTo=function(r,A,O,K,q,GI){w.bezierCurveTo(r,A,O,K,q,GI),this.__originalBezierCurveTo(r,A,O,K,q,GI)},k.rect=function(r,A,O,K){w.rect(r,A,O,K),this.__originalRect(r,A,O,K)},k.closePath=function(){w.closePath(),this.__originalClosePath()},k.beginPath=function(){w.beginPath(),this.__originalBeginPath()}}class hI{constructor(w){this.canvasFactory=w,this.cache=Object.create(null)}getCanvas(w,r,A){let O;return this.cache[w]!==void 0?(O=this.cache[w],this.canvasFactory.reset(O,r,A)):(O=this.canvasFactory.create(r,A),this.cache[w]=O),O}delete(w){delete this.cache[w]}clear(){for(let w in this.cache){let r=this.cache[w];this.canvasFactory.destroy(r),delete this.cache[w]}}}function WI(k,w,r,A,O,K,q,GI,tI,iI){let[B,aI,lI,QI,vI,OI]=(0,d.getCurrentTransform)(k);if(aI===0&&lI===0){let kI=q*B+vI,TI=Math.round(kI),Il=GI*QI+OI,nl=Math.round(Il),ol=(q+tI)*B+vI,PI=Math.abs(Math.round(ol)-TI)||1,KI=(GI+iI)*QI+OI,jI=Math.abs(Math.round(KI)-nl)||1;return k.setTransform(Math.sign(B),0,0,Math.sign(QI),TI,nl),k.drawImage(w,r,A,O,K,0,0,PI,jI),k.setTransform(B,aI,lI,QI,vI,OI),[PI,jI]}if(B===0&&QI===0){let kI=GI*lI+vI,TI=Math.round(kI),Il=q*aI+OI,nl=Math.round(Il),ol=(GI+iI)*lI+vI,PI=Math.abs(Math.round(ol)-TI)||1,KI=(q+tI)*aI+OI,jI=Math.abs(Math.round(KI)-nl)||1;return k.setTransform(0,Math.sign(aI),Math.sign(lI),0,TI,nl),k.drawImage(w,r,A,O,K,0,0,jI,PI),k.setTransform(B,aI,lI,QI,vI,OI),[jI,PI]}k.drawImage(w,r,A,O,K,q,GI,tI,iI);let uI=Math.hypot(B,aI),wI=Math.hypot(lI,QI);return[uI*tI,wI*iI]}function VI(k){let{width:w,height:r}=k;if(w>T||r>T)return null;let A=1e3,O=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),K=w+1,q=new Uint8Array(K*(r+1)),GI,tI,iI,B=w+7&-8,aI=new Uint8Array(B*r),lI=0;for(let wI of k.data){let kI=128;for(;kI>0;)aI[lI++]=wI&kI?0:255,kI>>=1}let QI=0;for(lI=0,aI[lI]!==0&&(q[0]=1,++QI),tI=1;tI<w;tI++)aI[lI]!==aI[lI+1]&&(q[tI]=aI[lI]?2:1,++QI),lI++;for(aI[lI]!==0&&(q[tI]=2,++QI),GI=1;GI<r;GI++){lI=GI*B,iI=GI*K,aI[lI-B]!==aI[lI]&&(q[iI]=aI[lI]?1:8,++QI);let wI=(aI[lI]?4:0)+(aI[lI-B]?8:0);for(tI=1;tI<w;tI++)wI=(wI>>2)+(aI[lI+1]?4:0)+(aI[lI-B+1]?8:0),O[wI]&&(q[iI+tI]=O[wI],++QI),lI++;if(aI[lI-B]!==aI[lI]&&(q[iI+tI]=aI[lI]?2:4,++QI),QI>A)return null}for(lI=B*(r-1),iI=GI*K,aI[lI]!==0&&(q[iI]=8,++QI),tI=1;tI<w;tI++)aI[lI]!==aI[lI+1]&&(q[iI+tI]=aI[lI]?4:8,++QI),lI++;if(aI[lI]!==0&&(q[iI+tI]=4,++QI),QI>A)return null;let vI=new Int32Array([0,K,-1,0,-K,0,0,0,1]),OI=new Path2D;for(GI=0;QI&&GI<=r;GI++){let wI=GI*K,kI=wI+w;for(;wI<kI&&!q[wI];)wI++;if(wI===kI)continue;OI.moveTo(wI%K,GI);let TI=wI,Il=q[wI];do{let nl=vI[Il];do wI+=nl;while(!q[wI]);let ol=q[wI];ol!==5&&ol!==10?(Il=ol,q[wI]=0):(Il=ol&51*Il>>4,q[wI]&=Il>>2|Il<<2),OI.lineTo(wI%K,wI/K|0),q[wI]||--QI}while(TI!==wI);--GI}return aI=null,q=null,function(wI){wI.save(),wI.scale(1/w,-1/r),wI.translate(0,-r),wI.fill(OI),wI.beginPath(),wI.restore()}}class sI{constructor(w,r){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=b.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=b.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=b.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,w,r])}clone(){let w=Object.create(this);return w.clipBox=this.clipBox.slice(),w}setCurrentPoint(w,r){this.x=w,this.y=r}updatePathMinMax(w,r,A){[r,A]=b.Util.applyTransform([r,A],w),this.minX=Math.min(this.minX,r),this.minY=Math.min(this.minY,A),this.maxX=Math.max(this.maxX,r),this.maxY=Math.max(this.maxY,A)}updateRectMinMax(w,r){let A=b.Util.applyTransform(r,w),O=b.Util.applyTransform(r.slice(2),w),K=b.Util.applyTransform([r[0],r[3]],w),q=b.Util.applyTransform([r[2],r[1]],w);this.minX=Math.min(this.minX,A[0],O[0],K[0],q[0]),this.minY=Math.min(this.minY,A[1],O[1],K[1],q[1]),this.maxX=Math.max(this.maxX,A[0],O[0],K[0],q[0]),this.maxY=Math.max(this.maxY,A[1],O[1],K[1],q[1])}updateScalingPathMinMax(w,r){b.Util.scaleMinMax(w,r),this.minX=Math.min(this.minX,r[0]),this.minY=Math.min(this.minY,r[1]),this.maxX=Math.max(this.maxX,r[2]),this.maxY=Math.max(this.maxY,r[3])}updateCurvePathMinMax(w,r,A,O,K,q,GI,tI,iI,B){let aI=b.Util.bezierBoundingBox(r,A,O,K,q,GI,tI,iI,B);B||this.updateRectMinMax(w,aI)}getPathBoundingBox(w=e.FILL,r=null){let A=[this.minX,this.minY,this.maxX,this.maxY];if(w===e.STROKE){r||(0,b.unreachable)("Stroke bounding box must include transform.");let O=b.Util.singularValueDecompose2dScale(r),K=O[0]*this.lineWidth/2,q=O[1]*this.lineWidth/2;A[0]-=K,A[1]-=q,A[2]+=K,A[3]+=q}return A}updateClipFromPath(){let w=b.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(w||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(w){this.clipBox=w,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(w=e.FILL,r=null){return b.Util.intersect(this.clipBox,this.getPathBoundingBox(w,r))}}function ZI(k,w){if(typeof ImageData<"u"&&w instanceof ImageData){k.putImageData(w,0,0);return}let r=w.height,A=w.width,O=r%S,K=(r-O)/S,q=O===0?K:K+1,GI=k.createImageData(A,S),tI=0,iI,B=w.data,aI=GI.data,lI,QI,vI,OI;if(w.kind===b.ImageKind.GRAYSCALE_1BPP){let uI=B.byteLength,wI=new Uint32Array(aI.buffer,0,aI.byteLength>>2),kI=wI.length,TI=A+7>>3,Il=4294967295,nl=b.FeatureTest.isLittleEndian?4278190080:255;for(lI=0;lI<q;lI++){for(vI=lI<K?S:O,iI=0,QI=0;QI<vI;QI++){let ol=uI-tI,PI=0,KI=ol>TI?A:ol*8-7,jI=KI&-8,Wl=0,wl=0;for(;PI<jI;PI+=8)wl=B[tI++],wI[iI++]=wl&128?Il:nl,wI[iI++]=wl&64?Il:nl,wI[iI++]=wl&32?Il:nl,wI[iI++]=wl&16?Il:nl,wI[iI++]=wl&8?Il:nl,wI[iI++]=wl&4?Il:nl,wI[iI++]=wl&2?Il:nl,wI[iI++]=wl&1?Il:nl;for(;PI<KI;PI++)Wl===0&&(wl=B[tI++],Wl=128),wI[iI++]=wl&Wl?Il:nl,Wl>>=1}for(;iI<kI;)wI[iI++]=0;k.putImageData(GI,0,lI*S)}}else if(w.kind===b.ImageKind.RGBA_32BPP){for(QI=0,OI=A*S*4,lI=0;lI<K;lI++)aI.set(B.subarray(tI,tI+OI)),tI+=OI,k.putImageData(GI,0,QI),QI+=S;lI<q&&(OI=A*O*4,aI.set(B.subarray(tI,tI+OI)),k.putImageData(GI,0,QI))}else if(w.kind===b.ImageKind.RGB_24BPP)for(vI=S,OI=A*vI,lI=0;lI<q;lI++){for(lI>=K&&(vI=O,OI=A*vI),iI=0,QI=OI;QI--;)aI[iI++]=B[tI++],aI[iI++]=B[tI++],aI[iI++]=B[tI++],aI[iI++]=255;k.putImageData(GI,0,lI*S)}else throw new Error(`bad image kind: ${w.kind}`)}function dI(k,w){if(w.bitmap){k.drawImage(w.bitmap,0,0);return}let r=w.height,A=w.width,O=r%S,K=(r-O)/S,q=O===0?K:K+1,GI=k.createImageData(A,S),tI=0,iI=w.data,B=GI.data;for(let aI=0;aI<q;aI++){let lI=aI<K?S:O;({srcPos:tI}=a({src:iI,srcPos:tI,dest:B,width:A,height:lI,nonBlackColor:0})),k.putImageData(GI,0,aI*S)}}function pI(k,w){let r=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(let A of r)k[A]!==void 0&&(w[A]=k[A]);k.setLineDash!==void 0&&(w.setLineDash(k.getLineDash()),w.lineDashOffset=k.lineDashOffset)}function yI(k){if(k.strokeStyle=k.fillStyle="#000000",k.fillRule="nonzero",k.globalAlpha=1,k.lineWidth=1,k.lineCap="butt",k.lineJoin="miter",k.miterLimit=10,k.globalCompositeOperation="source-over",k.font="10px sans-serif",k.setLineDash!==void 0&&(k.setLineDash([]),k.lineDashOffset=0),!b.isNodeJS){let{filter:w}=k;w!=="none"&&w!==""&&(k.filter="none")}}function eI(k,w,r,A){let O=k.length;for(let K=3;K<O;K+=4){let q=k[K];if(q===0)k[K-3]=w,k[K-2]=r,k[K-1]=A;else if(q<255){let GI=255-q;k[K-3]=k[K-3]*q+w*GI>>8,k[K-2]=k[K-2]*q+r*GI>>8,k[K-1]=k[K-1]*q+A*GI>>8}}}function HI(k,w,r){let A=k.length,O=1/255;for(let K=3;K<A;K+=4){let q=r?r[k[K]]:k[K];w[K]=w[K]*q*O|0}}function YI(k,w,r){let A=k.length;for(let O=3;O<A;O+=4){let K=k[O-3]*77+k[O-2]*152+k[O-1]*28;w[O]=r?w[O]*r[K>>8]>>8:w[O]*K>>16}}function $(k,w,r,A,O,K,q,GI,tI,iI,B){let aI=!!K,lI=aI?K[0]:0,QI=aI?K[1]:0,vI=aI?K[2]:0,OI=O==="Luminosity"?YI:HI,wI=Math.min(A,Math.ceil(1048576/r));for(let kI=0;kI<A;kI+=wI){let TI=Math.min(wI,A-kI),Il=k.getImageData(GI-iI,kI+(tI-B),r,TI),nl=w.getImageData(GI,kI+tI,r,TI);aI&&eI(Il.data,lI,QI,vI),OI(Il.data,nl.data,q),w.putImageData(nl,GI,kI+tI)}}function JI(k,w,r,A){let O=A[0],K=A[1],q=A[2]-O,GI=A[3]-K;q===0||GI===0||($(w.context,r,q,GI,w.subtype,w.backdrop,w.transferMap,O,K,w.offsetX,w.offsetY),k.save(),k.globalAlpha=1,k.globalCompositeOperation="source-over",k.setTransform(1,0,0,1,0,0),k.drawImage(r.canvas,0,0),k.restore())}function UI(k,w){if(w)return!0;let r=b.Util.singularValueDecompose2dScale(k);r[0]=Math.fround(r[0]),r[1]=Math.fround(r[1]);let A=Math.fround((globalThis.devicePixelRatio||1)*d.PixelsPerInch.PDF_TO_CSS_UNITS);return r[0]<=A&&r[1]<=A}let zI=["butt","round","square"],L=["miter","round","bevel"],bI={},FI={};class U{constructor(w,r,A,O,K,{optionalContentConfig:q,markedContentStack:GI=null},tI,iI){this.ctx=w,this.current=new sI(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=r,this.objs=A,this.canvasFactory=O,this.filterFactory=K,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=GI||[],this.optionalContentConfig=q,this.cachedCanvases=new hI(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=tI,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=iI,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(w,r=null){return typeof w=="string"?w.startsWith("g_")?this.commonObjs.get(w):this.objs.get(w):r}beginDrawing({transform:w,viewport:r,transparency:A=!1,background:O=null}){let K=this.ctx.canvas.width,q=this.ctx.canvas.height,GI=this.ctx.fillStyle;if(this.ctx.fillStyle=O||"#ffffff",this.ctx.fillRect(0,0,K,q),this.ctx.fillStyle=GI,A){let tI=this.cachedCanvases.getCanvas("transparent",K,q);this.compositeCtx=this.ctx,this.transparentCanvas=tI.canvas,this.ctx=tI.context,this.ctx.save(),this.ctx.transform(...(0,d.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),yI(this.ctx),w&&(this.ctx.transform(...w),this.outputScaleX=w[0],this.outputScaleY=w[0]),this.ctx.transform(...r.transform),this.viewportScale=r.scale,this.baseTransform=(0,d.getCurrentTransform)(this.ctx)}executeOperatorList(w,r,A,O){let K=w.argsArray,q=w.fnArray,GI=r||0,tI=K.length;if(tI===GI)return GI;let iI=tI-GI>C&&typeof A=="function",B=iI?Date.now()+E:0,aI=0,lI=this.commonObjs,QI=this.objs,vI;for(;;){if(O!==void 0&&GI===O.nextBreakPoint)return O.breakIt(GI,A),GI;if(vI=q[GI],vI!==b.OPS.dependency)this[vI].apply(this,K[GI]);else for(let OI of K[GI]){let uI=OI.startsWith("g_")?lI:QI;if(!uI.has(OI))return uI.get(OI,A),GI}if(GI++,GI===tI)return GI;if(iI&&++aI>C){if(Date.now()>B)return A(),GI;aI=0}}}#I(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#I(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let w of this._cachedBitmapsMap.values()){for(let r of w.values())typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement&&(r.width=r.height=0);w.clear()}this._cachedBitmapsMap.clear(),this.#l()}#l(){if(this.pageColors){let w=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(w!=="none"){let r=this.ctx.filter;this.ctx.filter=w,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=r}}}_scaleImage(w,r){let A=w.width,O=w.height,K=Math.max(Math.hypot(r[0],r[1]),1),q=Math.max(Math.hypot(r[2],r[3]),1),GI=A,tI=O,iI="prescale1",B,aI;for(;K>2&&GI>1||q>2&&tI>1;){let lI=GI,QI=tI;K>2&&GI>1&&(lI=GI>=16384?Math.floor(GI/2)-1||1:Math.ceil(GI/2),K/=GI/lI),q>2&&tI>1&&(QI=tI>=16384?Math.floor(tI/2)-1||1:Math.ceil(tI)/2,q/=tI/QI),B=this.cachedCanvases.getCanvas(iI,lI,QI),aI=B.context,aI.clearRect(0,0,lI,QI),aI.drawImage(w,0,0,GI,tI,0,0,lI,QI),w=B.canvas,GI=lI,tI=QI,iI=iI==="prescale1"?"prescale2":"prescale1"}return{img:w,paintWidth:GI,paintHeight:tI}}_createMaskCanvas(w){let r=this.ctx,{width:A,height:O}=w,K=this.current.fillColor,q=this.current.patternFill,GI=(0,d.getCurrentTransform)(r),tI,iI,B,aI;if((w.bitmap||w.data)&&w.count>1){let KI=w.bitmap||w.data.buffer;iI=JSON.stringify(q?GI:[GI.slice(0,4),K]),tI=this._cachedBitmapsMap.get(KI),tI||(tI=new Map,this._cachedBitmapsMap.set(KI,tI));let jI=tI.get(iI);if(jI&&!q){let Wl=Math.round(Math.min(GI[0],GI[2])+GI[4]),wl=Math.round(Math.min(GI[1],GI[3])+GI[5]);return{canvas:jI,offsetX:Wl,offsetY:wl}}B=jI}B||(aI=this.cachedCanvases.getCanvas("maskCanvas",A,O),dI(aI.context,w));let lI=b.Util.transform(GI,[1/A,0,0,-1/O,0,0]);lI=b.Util.transform(lI,[1,0,0,1,0,-O]);let[QI,vI,OI,uI]=b.Util.getAxialAlignedBoundingBox([0,0,A,O],lI),wI=Math.round(OI-QI)||1,kI=Math.round(uI-vI)||1,TI=this.cachedCanvases.getCanvas("fillCanvas",wI,kI),Il=TI.context,nl=QI,ol=vI;Il.translate(-nl,-ol),Il.transform(...lI),B||(B=this._scaleImage(aI.canvas,(0,d.getCurrentTransformInverse)(Il)),B=B.img,tI&&q&&tI.set(iI,B)),Il.imageSmoothingEnabled=UI((0,d.getCurrentTransform)(Il),w.interpolate),WI(Il,B,0,0,B.width,B.height,0,0,A,O),Il.globalCompositeOperation="source-in";let PI=b.Util.transform((0,d.getCurrentTransformInverse)(Il),[1,0,0,1,-nl,-ol]);return Il.fillStyle=q?K.getPattern(r,this,PI,e.FILL):K,Il.fillRect(0,0,A,O),tI&&!q&&(this.cachedCanvases.delete("fillCanvas"),tI.set(iI,TI.canvas)),{canvas:TI.canvas,offsetX:Math.round(nl),offsetY:Math.round(ol)}}setLineWidth(w){w!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=w,this.ctx.lineWidth=w}setLineCap(w){this.ctx.lineCap=zI[w]}setLineJoin(w){this.ctx.lineJoin=L[w]}setMiterLimit(w){this.ctx.miterLimit=w}setDash(w,r){let A=this.ctx;A.setLineDash!==void 0&&(A.setLineDash(w),A.lineDashOffset=r)}setRenderingIntent(w){}setFlatness(w){}setGState(w){for(let[r,A]of w)switch(r){case"LW":this.setLineWidth(A);break;case"LC":this.setLineCap(A);break;case"LJ":this.setLineJoin(A);break;case"ML":this.setMiterLimit(A);break;case"D":this.setDash(A[0],A[1]);break;case"RI":this.setRenderingIntent(A);break;case"FL":this.setFlatness(A);break;case"Font":this.setFont(A[0],A[1]);break;case"CA":this.current.strokeAlpha=A;break;case"ca":this.current.fillAlpha=A,this.ctx.globalAlpha=A;break;case"BM":this.ctx.globalCompositeOperation=A;break;case"SMask":this.current.activeSMask=A?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(A);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let w=this.inSMaskMode;this.current.activeSMask&&!w?this.beginSMaskMode():!this.current.activeSMask&&w&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let w=this.ctx.canvas.width,r=this.ctx.canvas.height,A="smaskGroupAt"+this.groupLevel,O=this.cachedCanvases.getCanvas(A,w,r);this.suspendedCtx=this.ctx,this.ctx=O.context;let K=this.ctx;K.setTransform(...(0,d.getCurrentTransform)(this.suspendedCtx)),pI(this.suspendedCtx,K),cI(K,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),pI(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(w){if(!this.current.activeSMask)return;w?(w[0]=Math.floor(w[0]),w[1]=Math.floor(w[1]),w[2]=Math.ceil(w[2]),w[3]=Math.ceil(w[3])):w=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let r=this.current.activeSMask,A=this.suspendedCtx;JI(A,r,this.ctx,w),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(pI(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let w=this.current;this.stateStack.push(w),this.current=w.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),pI(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(w,r,A,O,K,q){this.ctx.transform(w,r,A,O,K,q),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(w,r,A){let O=this.ctx,K=this.current,q=K.x,GI=K.y,tI,iI,B=(0,d.getCurrentTransform)(O),aI=B[0]===0&&B[3]===0||B[1]===0&&B[2]===0,lI=aI?A.slice(0):null;for(let QI=0,vI=0,OI=w.length;QI<OI;QI++)switch(w[QI]|0){case b.OPS.rectangle:q=r[vI++],GI=r[vI++];let uI=r[vI++],wI=r[vI++],kI=q+uI,TI=GI+wI;O.moveTo(q,GI),uI===0||wI===0?O.lineTo(kI,TI):(O.lineTo(kI,GI),O.lineTo(kI,TI),O.lineTo(q,TI)),aI||K.updateRectMinMax(B,[q,GI,kI,TI]),O.closePath();break;case b.OPS.moveTo:q=r[vI++],GI=r[vI++],O.moveTo(q,GI),aI||K.updatePathMinMax(B,q,GI);break;case b.OPS.lineTo:q=r[vI++],GI=r[vI++],O.lineTo(q,GI),aI||K.updatePathMinMax(B,q,GI);break;case b.OPS.curveTo:tI=q,iI=GI,q=r[vI+4],GI=r[vI+5],O.bezierCurveTo(r[vI],r[vI+1],r[vI+2],r[vI+3],q,GI),K.updateCurvePathMinMax(B,tI,iI,r[vI],r[vI+1],r[vI+2],r[vI+3],q,GI,lI),vI+=6;break;case b.OPS.curveTo2:tI=q,iI=GI,O.bezierCurveTo(q,GI,r[vI],r[vI+1],r[vI+2],r[vI+3]),K.updateCurvePathMinMax(B,tI,iI,q,GI,r[vI],r[vI+1],r[vI+2],r[vI+3],lI),q=r[vI+2],GI=r[vI+3],vI+=4;break;case b.OPS.curveTo3:tI=q,iI=GI,q=r[vI+2],GI=r[vI+3],O.bezierCurveTo(r[vI],r[vI+1],q,GI,q,GI),K.updateCurvePathMinMax(B,tI,iI,r[vI],r[vI+1],q,GI,q,GI,lI),vI+=4;break;case b.OPS.closePath:O.closePath();break}aI&&K.updateScalingPathMinMax(B,lI),K.setCurrentPoint(q,GI)}closePath(){this.ctx.closePath()}stroke(w=!0){let r=this.ctx,A=this.current.strokeColor;r.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof A=="object"&&A?.getPattern?(r.save(),r.strokeStyle=A.getPattern(r,this,(0,d.getCurrentTransformInverse)(r),e.STROKE),this.rescaleAndStroke(!1),r.restore()):this.rescaleAndStroke(!0)),w&&this.consumePath(this.current.getClippedPathBoundingBox()),r.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(w=!0){let r=this.ctx,A=this.current.fillColor,O=this.current.patternFill,K=!1;O&&(r.save(),r.fillStyle=A.getPattern(r,this,(0,d.getCurrentTransformInverse)(r),e.FILL),K=!0);let q=this.current.getClippedPathBoundingBox();this.contentVisible&&q!==null&&(this.pendingEOFill?(r.fill("evenodd"),this.pendingEOFill=!1):r.fill()),K&&r.restore(),w&&this.consumePath(q)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=bI}eoClip(){this.pendingClip=FI}beginText(){this.current.textMatrix=b.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let w=this.pendingTextPaths,r=this.ctx;if(w===void 0){r.beginPath();return}r.save(),r.beginPath();for(let A of w)r.setTransform(...A.transform),r.translate(A.x,A.y),A.addToPath(r,A.fontSize);r.restore(),r.clip(),r.beginPath(),delete this.pendingTextPaths}setCharSpacing(w){this.current.charSpacing=w}setWordSpacing(w){this.current.wordSpacing=w}setHScale(w){this.current.textHScale=w/100}setLeading(w){this.current.leading=-w}setFont(w,r){let A=this.commonObjs.get(w),O=this.current;if(!A)throw new Error(`Can't find font for ${w}`);if(O.fontMatrix=A.fontMatrix||b.FONT_IDENTITY_MATRIX,(O.fontMatrix[0]===0||O.fontMatrix[3]===0)&&(0,b.warn)("Invalid font matrix for font "+w),r<0?(r=-r,O.fontDirection=-1):O.fontDirection=1,this.current.font=A,this.current.fontSize=r,A.isType3Font)return;let K=A.loadedName||"sans-serif",q=A.systemFontInfo?.css||`"${K}", ${A.fallbackName}`,GI="normal";A.black?GI="900":A.bold&&(GI="bold");let tI=A.italic?"italic":"normal",iI=r;r<o?iI=o:r>y&&(iI=y),this.current.fontSizeScale=r/iI,this.ctx.font=`${tI} ${GI} ${iI}px ${q}`}setTextRenderingMode(w){this.current.textRenderingMode=w}setTextRise(w){this.current.textRise=w}moveText(w,r){this.current.x=this.current.lineX+=w,this.current.y=this.current.lineY+=r}setLeadingMoveText(w,r){this.setLeading(-r),this.moveText(w,r)}setTextMatrix(w,r,A,O,K,q){this.current.textMatrix=[w,r,A,O,K,q],this.current.textMatrixScale=Math.hypot(w,r),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(w,r,A,O){let K=this.ctx,q=this.current,GI=q.font,tI=q.textRenderingMode,iI=q.fontSize/q.fontSizeScale,B=tI&b.TextRenderingMode.FILL_STROKE_MASK,aI=!!(tI&b.TextRenderingMode.ADD_TO_PATH_FLAG),lI=q.patternFill&&!GI.missingFile,QI;(GI.disableFontFace||aI||lI)&&(QI=GI.getPathGenerator(this.commonObjs,w)),GI.disableFontFace||lI?(K.save(),K.translate(r,A),K.beginPath(),QI(K,iI),O&&K.setTransform(...O),(B===b.TextRenderingMode.FILL||B===b.TextRenderingMode.FILL_STROKE)&&K.fill(),(B===b.TextRenderingMode.STROKE||B===b.TextRenderingMode.FILL_STROKE)&&K.stroke(),K.restore()):((B===b.TextRenderingMode.FILL||B===b.TextRenderingMode.FILL_STROKE)&&K.fillText(w,r,A),(B===b.TextRenderingMode.STROKE||B===b.TextRenderingMode.FILL_STROKE)&&K.strokeText(w,r,A)),aI&&(this.pendingTextPaths||=[]).push({transform:(0,d.getCurrentTransform)(K),x:r,y:A,fontSize:iI,addToPath:QI})}get isFontSubpixelAAEnabled(){let{context:w}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);w.scale(1.5,1),w.fillText("I",0,10);let r=w.getImageData(0,0,10,10).data,A=!1;for(let O=3;O<r.length;O+=4)if(r[O]>0&&r[O]<255){A=!0;break}return(0,b.shadow)(this,"isFontSubpixelAAEnabled",A)}showText(w){let r=this.current,A=r.font;if(A.isType3Font)return this.showType3Text(w);let O=r.fontSize;if(O===0)return;let K=this.ctx,q=r.fontSizeScale,GI=r.charSpacing,tI=r.wordSpacing,iI=r.fontDirection,B=r.textHScale*iI,aI=w.length,lI=A.vertical,QI=lI?1:-1,vI=A.defaultVMetrics,OI=O*r.fontMatrix[0],uI=r.textRenderingMode===b.TextRenderingMode.FILL&&!A.disableFontFace&&!r.patternFill;K.save(),K.transform(...r.textMatrix),K.translate(r.x,r.y+r.textRise),iI>0?K.scale(B,-1):K.scale(B,1);let wI;if(r.patternFill){K.save();let ol=r.fillColor.getPattern(K,this,(0,d.getCurrentTransformInverse)(K),e.FILL);wI=(0,d.getCurrentTransform)(K),K.restore(),K.fillStyle=ol}let kI=r.lineWidth,TI=r.textMatrixScale;if(TI===0||kI===0){let ol=r.textRenderingMode&b.TextRenderingMode.FILL_STROKE_MASK;(ol===b.TextRenderingMode.STROKE||ol===b.TextRenderingMode.FILL_STROKE)&&(kI=this.getSinglePixelWidth())}else kI/=TI;if(q!==1&&(K.scale(q,q),kI/=q),K.lineWidth=kI,A.isInvalidPDFjsFont){let ol=[],PI=0;for(let KI of w)ol.push(KI.unicode),PI+=KI.width;K.fillText(ol.join(""),0,0),r.x+=PI*OI*B,K.restore(),this.compose();return}let Il=0,nl;for(nl=0;nl<aI;++nl){let ol=w[nl];if(typeof ol=="number"){Il+=QI*ol*O/1e3;continue}let PI=!1,KI=(ol.isSpace?tI:0)+GI,jI=ol.fontChar,Wl=ol.accent,wl,Ol,jl=ol.width;if(lI){let Fl=ol.vmetric||vI,Dl=-(ol.vmetric?Fl[1]:jl*.5)*OI,XG=Fl[2]*OI;jl=Fl?-Fl[0]:jl,wl=Dl/q,Ol=(Il+XG)/q}else wl=Il/q,Ol=0;if(A.remeasure&&jl>0){let Fl=K.measureText(jI).width*1e3/O*q;if(jl<Fl&&this.isFontSubpixelAAEnabled){let Dl=jl/Fl;PI=!0,K.save(),K.scale(Dl,1),wl/=Dl}else jl!==Fl&&(wl+=(jl-Fl)/2e3*O/q)}if(this.contentVisible&&(ol.isInFont||A.missingFile)){if(uI&&!Wl)K.fillText(jI,wl,Ol);else if(this.paintChar(jI,wl,Ol,wI),Wl){let Fl=wl+O*Wl.offset.x/q,Dl=Ol-O*Wl.offset.y/q;this.paintChar(Wl.fontChar,Fl,Dl,wI)}}let NG=lI?jl*OI-KI*iI:jl*OI+KI*iI;Il+=NG,PI&&K.restore()}lI?r.y-=Il:r.x+=Il*B,K.restore(),this.compose()}showType3Text(w){let r=this.ctx,A=this.current,O=A.font,K=A.fontSize,q=A.fontDirection,GI=O.vertical?1:-1,tI=A.charSpacing,iI=A.wordSpacing,B=A.textHScale*q,aI=A.fontMatrix||b.FONT_IDENTITY_MATRIX,lI=w.length,QI=A.textRenderingMode===b.TextRenderingMode.INVISIBLE,vI,OI,uI,wI;if(!(QI||K===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,r.save(),r.transform(...A.textMatrix),r.translate(A.x,A.y),r.scale(B,q),vI=0;vI<lI;++vI){if(OI=w[vI],typeof OI=="number"){wI=GI*OI*K/1e3,this.ctx.translate(wI,0),A.x+=wI*B;continue}let kI=(OI.isSpace?iI:0)+tI,TI=O.charProcOperatorList[OI.operatorListId];if(!TI){(0,b.warn)(`Type3 character "${OI.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=OI,this.save(),r.scale(K,K),r.transform(...aI),this.executeOperatorList(TI),this.restore()),uI=b.Util.applyTransform([OI.width,0],aI)[0]*K+kI,r.translate(uI,0),A.x+=uI*B}r.restore(),this.processingType3=null}}setCharWidth(w,r){}setCharWidthAndBounds(w,r,A,O,K,q){this.ctx.rect(A,O,K-A,q-O),this.ctx.clip(),this.endPath()}getColorN_Pattern(w){let r;if(w[0]==="TilingPattern"){let A=w[1],O=this.baseTransform||(0,d.getCurrentTransform)(this.ctx),K={createCanvasGraphics:q=>new U(q,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};r=new p(w,A,this.ctx,K,O)}else r=this._getPattern(w[1],w[2]);return r}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(w,r,A){let O=b.Util.makeHexColor(w,r,A);this.ctx.strokeStyle=O,this.current.strokeColor=O}setFillRGBColor(w,r,A){let O=b.Util.makeHexColor(w,r,A);this.ctx.fillStyle=O,this.current.fillColor=O,this.current.patternFill=!1}_getPattern(w,r=null){let A;return this.cachedPatterns.has(w)?A=this.cachedPatterns.get(w):(A=V(this.getObject(w)),this.cachedPatterns.set(w,A)),r&&(A.matrix=r),A}shadingFill(w){if(!this.contentVisible)return;let r=this.ctx;this.save();let A=this._getPattern(w);r.fillStyle=A.getPattern(r,this,(0,d.getCurrentTransformInverse)(r),e.SHADING);let O=(0,d.getCurrentTransformInverse)(r);if(O){let{width:K,height:q}=r.canvas,[GI,tI,iI,B]=b.Util.getAxialAlignedBoundingBox([0,0,K,q],O);this.ctx.fillRect(GI,tI,iI-GI,B-tI)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,b.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,b.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(w,r){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(w)&&w.length===6&&this.transform(...w),this.baseTransform=(0,d.getCurrentTransform)(this.ctx),r)){let A=r[2]-r[0],O=r[3]-r[1];this.ctx.rect(r[0],r[1],A,O),this.current.updateRectMinMax((0,d.getCurrentTransform)(this.ctx),r),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(w){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let r=this.ctx;w.isolated||(0,b.info)("TODO: Support non-isolated groups."),w.knockout&&(0,b.warn)("Knockout groups not supported.");let A=(0,d.getCurrentTransform)(r);if(w.matrix&&r.transform(...w.matrix),!w.bbox)throw new Error("Bounding box is required.");let O=b.Util.getAxialAlignedBoundingBox(w.bbox,(0,d.getCurrentTransform)(r)),K=[0,0,r.canvas.width,r.canvas.height];O=b.Util.intersect(O,K)||[0,0,0,0];let q=Math.floor(O[0]),GI=Math.floor(O[1]),tI=Math.max(Math.ceil(O[2])-q,1),iI=Math.max(Math.ceil(O[3])-GI,1),B=1,aI=1;tI>H&&(B=tI/H,tI=H),iI>H&&(aI=iI/H,iI=H),this.current.startNewPathAndClipBox([0,0,tI,iI]);let lI="groupAt"+this.groupLevel;w.smask&&(lI+="_smask_"+this.smaskCounter++%2);let QI=this.cachedCanvases.getCanvas(lI,tI,iI),vI=QI.context;vI.scale(1/B,1/aI),vI.translate(-q,-GI),vI.transform(...A),w.smask?this.smaskStack.push({canvas:QI.canvas,context:vI,offsetX:q,offsetY:GI,scaleX:B,scaleY:aI,subtype:w.smask.subtype,backdrop:w.smask.backdrop,transferMap:w.smask.transferMap||null,startTransformInverse:null}):(r.setTransform(1,0,0,1,0,0),r.translate(q,GI),r.scale(B,aI),r.save()),pI(r,vI),this.ctx=vI,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(r),this.groupLevel++}endGroup(w){if(!this.contentVisible)return;this.groupLevel--;let r=this.ctx,A=this.groupStack.pop();if(this.ctx=A,this.ctx.imageSmoothingEnabled=!1,w.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let O=(0,d.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...O);let K=b.Util.getAxialAlignedBoundingBox([0,0,r.canvas.width,r.canvas.height],O);this.ctx.drawImage(r.canvas,0,0),this.ctx.restore(),this.compose(K)}}beginAnnotation(w,r,A,O,K){if(this.#I(),yI(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(r)&&r.length===4){let q=r[2]-r[0],GI=r[3]-r[1];if(K&&this.annotationCanvasMap){A=A.slice(),A[4]-=r[0],A[5]-=r[1],r=r.slice(),r[0]=r[1]=0,r[2]=q,r[3]=GI;let[tI,iI]=b.Util.singularValueDecompose2dScale((0,d.getCurrentTransform)(this.ctx)),{viewportScale:B}=this,aI=Math.ceil(q*this.outputScaleX*B),lI=Math.ceil(GI*this.outputScaleY*B);this.annotationCanvas=this.canvasFactory.create(aI,lI);let{canvas:QI,context:vI}=this.annotationCanvas;this.annotationCanvasMap.set(w,QI),this.annotationCanvas.savedCtx=this.ctx,this.ctx=vI,this.ctx.save(),this.ctx.setTransform(tI,0,0,-iI,0,GI*iI),yI(this.ctx)}else yI(this.ctx),this.ctx.rect(r[0],r[1],q,GI),this.ctx.clip(),this.endPath()}this.current=new sI(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...A),this.transform(...O)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#l(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(w){if(!this.contentVisible)return;let r=w.count;w=this.getObject(w.data,w),w.count=r;let A=this.ctx,O=this.processingType3;if(O&&(O.compiled===void 0&&(O.compiled=VI(w)),O.compiled)){O.compiled(A);return}let K=this._createMaskCanvas(w),q=K.canvas;A.save(),A.setTransform(1,0,0,1,0,0),A.drawImage(q,K.offsetX,K.offsetY),A.restore(),this.compose()}paintImageMaskXObjectRepeat(w,r,A=0,O=0,K,q){if(!this.contentVisible)return;w=this.getObject(w.data,w);let GI=this.ctx;GI.save();let tI=(0,d.getCurrentTransform)(GI);GI.transform(r,A,O,K,0,0);let iI=this._createMaskCanvas(w);GI.setTransform(1,0,0,1,iI.offsetX-tI[4],iI.offsetY-tI[5]);for(let B=0,aI=q.length;B<aI;B+=2){let lI=b.Util.transform(tI,[r,A,O,K,q[B],q[B+1]]),[QI,vI]=b.Util.applyTransform([0,0],lI);GI.drawImage(iI.canvas,QI,vI)}GI.restore(),this.compose()}paintImageMaskXObjectGroup(w){if(!this.contentVisible)return;let r=this.ctx,A=this.current.fillColor,O=this.current.patternFill;for(let K of w){let{data:q,width:GI,height:tI,transform:iI}=K,B=this.cachedCanvases.getCanvas("maskCanvas",GI,tI),aI=B.context;aI.save();let lI=this.getObject(q,K);dI(aI,lI),aI.globalCompositeOperation="source-in",aI.fillStyle=O?A.getPattern(aI,this,(0,d.getCurrentTransformInverse)(r),e.FILL):A,aI.fillRect(0,0,GI,tI),aI.restore(),r.save(),r.transform(...iI),r.scale(1,-1),WI(r,B.canvas,0,0,GI,tI,0,-1,1,1),r.restore()}this.compose()}paintImageXObject(w){if(!this.contentVisible)return;let r=this.getObject(w);if(!r){(0,b.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(r)}paintImageXObjectRepeat(w,r,A,O){if(!this.contentVisible)return;let K=this.getObject(w);if(!K){(0,b.warn)("Dependent image isn't ready yet");return}let q=K.width,GI=K.height,tI=[];for(let iI=0,B=O.length;iI<B;iI+=2)tI.push({transform:[r,0,0,A,O[iI],O[iI+1]],x:0,y:0,w:q,h:GI});this.paintInlineImageXObjectGroup(K,tI)}applyTransferMapsToCanvas(w){return this.current.transferMaps!=="none"&&(w.filter=this.current.transferMaps,w.drawImage(w.canvas,0,0),w.filter="none"),w.canvas}applyTransferMapsToBitmap(w){if(this.current.transferMaps==="none")return w.bitmap;let{bitmap:r,width:A,height:O}=w,K=this.cachedCanvases.getCanvas("inlineImage",A,O),q=K.context;return q.filter=this.current.transferMaps,q.drawImage(r,0,0),q.filter="none",K.canvas}paintInlineImageXObject(w){if(!this.contentVisible)return;let r=w.width,A=w.height,O=this.ctx;if(this.save(),!b.isNodeJS){let{filter:GI}=O;GI!=="none"&&GI!==""&&(O.filter="none")}O.scale(1/r,-1/A);let K;if(w.bitmap)K=this.applyTransferMapsToBitmap(w);else if(typeof HTMLElement=="function"&&w instanceof HTMLElement||!w.data)K=w;else{let tI=this.cachedCanvases.getCanvas("inlineImage",r,A).context;ZI(tI,w),K=this.applyTransferMapsToCanvas(tI)}let q=this._scaleImage(K,(0,d.getCurrentTransformInverse)(O));O.imageSmoothingEnabled=UI((0,d.getCurrentTransform)(O),w.interpolate),WI(O,q.img,0,0,q.paintWidth,q.paintHeight,0,-A,r,A),this.compose(),this.restore()}paintInlineImageXObjectGroup(w,r){if(!this.contentVisible)return;let A=this.ctx,O;if(w.bitmap)O=w.bitmap;else{let K=w.width,q=w.height,tI=this.cachedCanvases.getCanvas("inlineImage",K,q).context;ZI(tI,w),O=this.applyTransferMapsToCanvas(tI)}for(let K of r)A.save(),A.transform(...K.transform),A.scale(1,-1),WI(A,O,K.x,K.y,K.w,K.h,0,-1,1,1),A.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(w){}markPointProps(w,r){}beginMarkedContent(w){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(w,r){w==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(r)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(w){let r=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(w);let A=this.ctx;this.pendingClip&&(r||(this.pendingClip===FI?A.clip("evenodd"):A.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),A.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let w=(0,d.getCurrentTransform)(this.ctx);if(w[1]===0&&w[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(w[0]),Math.abs(w[3]));else{let r=Math.abs(w[0]*w[3]-w[2]*w[1]),A=Math.hypot(w[0],w[2]),O=Math.hypot(w[1],w[3]);this._cachedGetSinglePixelWidth=Math.max(A,O)/r}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){let{lineWidth:w}=this.current,{a:r,b:A,c:O,d:K}=this.ctx.getTransform(),q,GI;if(A===0&&O===0){let tI=Math.abs(r),iI=Math.abs(K);if(tI===iI)if(w===0)q=GI=1/tI;else{let B=tI*w;q=GI=B<1?1/B:1}else if(w===0)q=1/tI,GI=1/iI;else{let B=tI*w,aI=iI*w;q=B<1?1/B:1,GI=aI<1?1/aI:1}}else{let tI=Math.abs(r*K-A*O),iI=Math.hypot(r,A),B=Math.hypot(O,K);if(w===0)q=B/tI,GI=iI/tI;else{let aI=w*tI;q=B>aI?B/aI:1,GI=iI>aI?iI/aI:1}}this._cachedScaleForStroking[0]=q,this._cachedScaleForStroking[1]=GI}return this._cachedScaleForStroking}rescaleAndStroke(w){let{ctx:r}=this,{lineWidth:A}=this.current,[O,K]=this.getScaleForStroking();if(r.lineWidth=A||1,O===1&&K===1){r.stroke();return}let q=r.getLineDash();if(w&&r.save(),r.scale(O,K),q.length>0){let GI=Math.max(O,K);r.setLineDash(q.map(tI=>tI/GI)),r.lineDashOffset/=GI}r.stroke(),w&&r.restore()}isContentVisible(){for(let w=this.markedContentStack.length-1;w>=0;w--)if(!this.markedContentStack[w].visible)return!1;return!0}}for(let k in b.OPS)U.prototype[k]!==void 0&&(U.prototype[b.OPS[k]]=U.prototype[k])},419:(I,G,l)=>{l.d(G,{DOMCMapReaderFactory:()=>N,DOMCanvasFactory:()=>n,DOMFilterFactory:()=>W,DOMSVGFactory:()=>h,DOMStandardFontDataFactory:()=>m,PDFDateString:()=>C,PageViewport:()=>V,PixelsPerInch:()=>t,RenderingCancelledException:()=>X,StatTimer:()=>Q,fetchData:()=>s,getColorValues:()=>cI,getCurrentTransform:()=>hI,getCurrentTransformInverse:()=>WI,getFilenameFromUrl:()=>a,getPdfFilenameFromUrl:()=>u,getRGB:()=>S,getXfaPageViewport:()=>T,isDataScheme:()=>p,isPdfFile:()=>F,isValidFetchUrl:()=>o,noContextMenu:()=>y,setLayerDimensions:()=>VI});var b=l(583),d=l(292);let e="http://www.w3.org/2000/svg";class t{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}class W extends b.BaseFilterFactory{#I;#l;#G;#b;#d;#c=0;constructor({docId:ZI,ownerDocument:dI=globalThis.document}={}){super(),this.#G=ZI,this.#b=dI}get#Z(){return this.#I||=new Map}get#W(){return this.#d||=new Map}get#a(){if(!this.#l){let ZI=this.#b.createElement("div"),{style:dI}=ZI;dI.visibility="hidden",dI.contain="strict",dI.width=dI.height=0,dI.position="absolute",dI.top=dI.left=0,dI.zIndex=-1;let pI=this.#b.createElementNS(e,"svg");pI.setAttribute("width",0),pI.setAttribute("height",0),this.#l=this.#b.createElementNS(e,"defs"),ZI.append(pI),pI.append(this.#l),this.#b.body.append(ZI)}return this.#l}addFilter(ZI){if(!ZI)return"none";let dI=this.#Z.get(ZI);if(dI)return dI;let pI,yI,eI,HI;if(ZI.length===1){let UI=ZI[0],zI=new Array(256);for(let L=0;L<256;L++)zI[L]=UI[L]/255;HI=pI=yI=eI=zI.join(",")}else{let[UI,zI,L]=ZI,bI=new Array(256),FI=new Array(256),U=new Array(256);for(let k=0;k<256;k++)bI[k]=UI[k]/255,FI[k]=zI[k]/255,U[k]=L[k]/255;pI=bI.join(","),yI=FI.join(","),eI=U.join(","),HI=`${pI}${yI}${eI}`}if(dI=this.#Z.get(HI),dI)return this.#Z.set(ZI,dI),dI;let YI=`g_${this.#G}_transfer_map_${this.#c++}`,$=`url(#${YI})`;this.#Z.set(ZI,$),this.#Z.set(HI,$);let JI=this.#m(YI);return this.#e(pI,yI,eI,JI),$}addHCMFilter(ZI,dI){let pI=`${ZI}-${dI}`,yI="base",eI=this.#W.get(yI);if(eI?.key===pI||(eI?(eI.filter?.remove(),eI.key=pI,eI.url="none",eI.filter=null):(eI={key:pI,url:"none",filter:null},this.#W.set(yI,eI)),!ZI||!dI))return eI.url;let HI=this.#s(ZI);ZI=d.Util.makeHexColor(...HI);let YI=this.#s(dI);if(dI=d.Util.makeHexColor(...YI),this.#a.style.color="",ZI==="#000000"&&dI==="#ffffff"||ZI===dI)return eI.url;let $=new Array(256);for(let bI=0;bI<=255;bI++){let FI=bI/255;$[bI]=FI<=.03928?FI/12.92:((FI+.055)/1.055)**2.4}let JI=$.join(","),UI=`g_${this.#G}_hcm_filter`,zI=eI.filter=this.#m(UI);this.#e(JI,JI,JI,zI),this.#n(zI);let L=(bI,FI)=>{let U=HI[bI]/255,k=YI[bI]/255,w=new Array(FI+1);for(let r=0;r<=FI;r++)w[r]=U+r/FI*(k-U);return w.join(",")};return this.#e(L(0,5),L(1,5),L(2,5),zI),eI.url=`url(#${UI})`,eI.url}addHighlightHCMFilter(ZI,dI,pI,yI,eI){let HI=`${dI}-${pI}-${yI}-${eI}`,YI=this.#W.get(ZI);if(YI?.key===HI||(YI?(YI.filter?.remove(),YI.key=HI,YI.url="none",YI.filter=null):(YI={key:HI,url:"none",filter:null},this.#W.set(ZI,YI)),!dI||!pI))return YI.url;let[$,JI]=[dI,pI].map(this.#s.bind(this)),UI=Math.round(.2126*$[0]+.7152*$[1]+.0722*$[2]),zI=Math.round(.2126*JI[0]+.7152*JI[1]+.0722*JI[2]),[L,bI]=[yI,eI].map(this.#s.bind(this));zI<UI&&([UI,zI,L,bI]=[zI,UI,bI,L]),this.#a.style.color="";let FI=(w,r,A)=>{let O=new Array(256),K=(zI-UI)/A,q=w/255,GI=(r-w)/(255*A),tI=0;for(let iI=0;iI<=A;iI++){let B=Math.round(UI+iI*K),aI=q+iI*GI;for(let lI=tI;lI<=B;lI++)O[lI]=aI;tI=B+1}for(let iI=tI;iI<256;iI++)O[iI]=O[tI-1];return O.join(",")},U=`g_${this.#G}_hcm_${ZI}_filter`,k=YI.filter=this.#m(U);return this.#n(k),this.#e(FI(L[0],bI[0],5),FI(L[1],bI[1],5),FI(L[2],bI[2],5),k),YI.url=`url(#${U})`,YI.url}destroy(ZI=!1){ZI&&this.#W.size!==0||(this.#l&&(this.#l.parentNode.parentNode.remove(),this.#l=null),this.#I&&(this.#I.clear(),this.#I=null),this.#c=0)}#n(ZI){let dI=this.#b.createElementNS(e,"feColorMatrix");dI.setAttribute("type","matrix"),dI.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),ZI.append(dI)}#m(ZI){let dI=this.#b.createElementNS(e,"filter");return dI.setAttribute("color-interpolation-filters","sRGB"),dI.setAttribute("id",ZI),this.#a.append(dI),dI}#t(ZI,dI,pI){let yI=this.#b.createElementNS(e,dI);yI.setAttribute("type","discrete"),yI.setAttribute("tableValues",pI),ZI.append(yI)}#e(ZI,dI,pI,yI){let eI=this.#b.createElementNS(e,"feComponentTransfer");yI.append(eI),this.#t(eI,"feFuncR",ZI),this.#t(eI,"feFuncG",dI),this.#t(eI,"feFuncB",pI)}#s(ZI){return this.#a.style.color=ZI,S(getComputedStyle(this.#a).getPropertyValue("color"))}}class n extends b.BaseCanvasFactory{constructor({ownerDocument:ZI=globalThis.document}={}){super(),this._document=ZI}_createCanvas(ZI,dI){let pI=this._document.createElement("canvas");return pI.width=ZI,pI.height=dI,pI}}async function s(sI,ZI="text"){if(o(sI,document.baseURI)){let dI=await fetch(sI);if(!dI.ok)throw new Error(dI.statusText);switch(ZI){case"arraybuffer":return dI.arrayBuffer();case"blob":return dI.blob();case"json":return dI.json()}return dI.text()}return new Promise((dI,pI)=>{let yI=new XMLHttpRequest;yI.open("GET",sI,!0),yI.responseType=ZI,yI.onreadystatechange=()=>{if(yI.readyState===XMLHttpRequest.DONE){if(yI.status===200||yI.status===0){switch(ZI){case"arraybuffer":case"blob":case"json":dI(yI.response);return}dI(yI.responseText);return}pI(new Error(yI.statusText))}},yI.send(null)})}class N extends b.BaseCMapReaderFactory{_fetchData(ZI,dI){return s(ZI,this.isCompressed?"arraybuffer":"text").then(pI=>({cMapData:pI instanceof ArrayBuffer?new Uint8Array(pI):(0,d.stringToBytes)(pI),compressionType:dI}))}}class m extends b.BaseStandardFontDataFactory{_fetchData(ZI){return s(ZI,"arraybuffer").then(dI=>new Uint8Array(dI))}}class h extends b.BaseSVGFactory{_createSVG(ZI){return document.createElementNS(e,ZI)}}class V{constructor({viewBox:ZI,scale:dI,rotation:pI,offsetX:yI=0,offsetY:eI=0,dontFlip:HI=!1}){this.viewBox=ZI,this.scale=dI,this.rotation=pI,this.offsetX=yI,this.offsetY=eI;let YI=(ZI[2]+ZI[0])/2,$=(ZI[3]+ZI[1])/2,JI,UI,zI,L;switch(pI%=360,pI<0&&(pI+=360),pI){case 180:JI=-1,UI=0,zI=0,L=1;break;case 90:JI=0,UI=1,zI=1,L=0;break;case 270:JI=0,UI=-1,zI=-1,L=0;break;case 0:JI=1,UI=0,zI=0,L=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}HI&&(zI=-zI,L=-L);let bI,FI,U,k;JI===0?(bI=Math.abs($-ZI[1])*dI+yI,FI=Math.abs(YI-ZI[0])*dI+eI,U=(ZI[3]-ZI[1])*dI,k=(ZI[2]-ZI[0])*dI):(bI=Math.abs(YI-ZI[0])*dI+yI,FI=Math.abs($-ZI[1])*dI+eI,U=(ZI[2]-ZI[0])*dI,k=(ZI[3]-ZI[1])*dI),this.transform=[JI*dI,UI*dI,zI*dI,L*dI,bI-JI*dI*YI-zI*dI*$,FI-UI*dI*YI-L*dI*$],this.width=U,this.height=k}get rawDims(){let{viewBox:ZI}=this;return(0,d.shadow)(this,"rawDims",{pageWidth:ZI[2]-ZI[0],pageHeight:ZI[3]-ZI[1],pageX:ZI[0],pageY:ZI[1]})}clone({scale:ZI=this.scale,rotation:dI=this.rotation,offsetX:pI=this.offsetX,offsetY:yI=this.offsetY,dontFlip:eI=!1}={}){return new V({viewBox:this.viewBox.slice(),scale:ZI,rotation:dI,offsetX:pI,offsetY:yI,dontFlip:eI})}convertToViewportPoint(ZI,dI){return d.Util.applyTransform([ZI,dI],this.transform)}convertToViewportRectangle(ZI){let dI=d.Util.applyTransform([ZI[0],ZI[1]],this.transform),pI=d.Util.applyTransform([ZI[2],ZI[3]],this.transform);return[dI[0],dI[1],pI[0],pI[1]]}convertToPdfPoint(ZI,dI){return d.Util.applyInverseTransform([ZI,dI],this.transform)}}class X extends d.BaseException{constructor(ZI,dI=0){super(ZI,"RenderingCancelledException"),this.extraDelay=dI}}function p(sI){let ZI=sI.length,dI=0;for(;dI<ZI&&sI[dI].trim()==="";)dI++;return sI.substring(dI,dI+5).toLowerCase()==="data:"}function F(sI){return typeof sI=="string"&&/\.pdf$/i.test(sI)}function a(sI,ZI=!1){return ZI||([sI]=sI.split(/[#?]/,1)),sI.substring(sI.lastIndexOf("/")+1)}function u(sI,ZI="document.pdf"){if(typeof sI!="string")return ZI;if(p(sI))return(0,d.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),ZI;let dI=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,pI=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,yI=dI.exec(sI),eI=pI.exec(yI[1])||pI.exec(yI[2])||pI.exec(yI[3]);if(eI&&(eI=eI[0],eI.includes("%")))try{eI=pI.exec(decodeURIComponent(eI))[0]}catch{}return eI||ZI}class Q{started=Object.create(null);times=[];time(ZI){ZI in this.started&&(0,d.warn)(`Timer is already running for ${ZI}`),this.started[ZI]=Date.now()}timeEnd(ZI){ZI in this.started||(0,d.warn)(`Timer has not been started for ${ZI}`),this.times.push({name:ZI,start:this.started[ZI],end:Date.now()}),delete this.started[ZI]}toString(){let ZI=[],dI=0;for(let{name:pI}of this.times)dI=Math.max(pI.length,dI);for(let{name:pI,start:yI,end:eI}of this.times)ZI.push(`${pI.padEnd(dI)} ${eI-yI}ms
`);return ZI.join("")}}function o(sI,ZI){try{let{protocol:dI}=ZI?new URL(sI,ZI):new URL(sI);return dI==="http:"||dI==="https:"}catch{return!1}}function y(sI){sI.preventDefault()}function H(sI){console.log("Deprecated API usage: "+sI)}let E;class C{static toDateObject(ZI){if(!ZI||typeof ZI!="string")return null;E||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");let dI=E.exec(ZI);if(!dI)return null;let pI=parseInt(dI[1],10),yI=parseInt(dI[2],10);yI=yI>=1&&yI<=12?yI-1:0;let eI=parseInt(dI[3],10);eI=eI>=1&&eI<=31?eI:1;let HI=parseInt(dI[4],10);HI=HI>=0&&HI<=23?HI:0;let YI=parseInt(dI[5],10);YI=YI>=0&&YI<=59?YI:0;let $=parseInt(dI[6],10);$=$>=0&&$<=59?$:0;let JI=dI[7]||"Z",UI=parseInt(dI[8],10);UI=UI>=0&&UI<=23?UI:0;let zI=parseInt(dI[9],10)||0;return zI=zI>=0&&zI<=59?zI:0,JI==="-"?(HI+=UI,YI+=zI):JI==="+"&&(HI-=UI,YI-=zI),new Date(Date.UTC(pI,yI,eI,HI,YI,$))}}function T(sI,{scale:ZI=1,rotation:dI=0}){let{width:pI,height:yI}=sI.attributes.style,eI=[0,0,parseInt(pI),parseInt(yI)];return new V({viewBox:eI,scale:ZI,rotation:dI})}function S(sI){if(sI.startsWith("#")){let ZI=parseInt(sI.slice(1),16);return[(ZI&16711680)>>16,(ZI&65280)>>8,ZI&255]}return sI.startsWith("rgb(")?sI.slice(4,-1).split(",").map(ZI=>parseInt(ZI)):sI.startsWith("rgba(")?sI.slice(5,-1).split(",").map(ZI=>parseInt(ZI)).slice(0,3):((0,d.warn)(`Not a valid color format: "${sI}"`),[0,0,0])}function cI(sI){let ZI=document.createElement("span");ZI.style.visibility="hidden",document.body.append(ZI);for(let dI of sI.keys()){ZI.style.color=dI;let pI=window.getComputedStyle(ZI).color;sI.set(dI,S(pI))}ZI.remove()}function hI(sI){let{a:ZI,b:dI,c:pI,d:yI,e:eI,f:HI}=sI.getTransform();return[ZI,dI,pI,yI,eI,HI]}function WI(sI){let{a:ZI,b:dI,c:pI,d:yI,e:eI,f:HI}=sI.getTransform().invertSelf();return[ZI,dI,pI,yI,eI,HI]}function VI(sI,ZI,dI=!1,pI=!0){if(ZI instanceof V){let{pageWidth:yI,pageHeight:eI}=ZI.rawDims,{style:HI}=sI,YI=d.FeatureTest.isCSSRoundSupported,$=`var(--scale-factor) * ${yI}px`,JI=`var(--scale-factor) * ${eI}px`,UI=YI?`round(${$}, 1px)`:`calc(${$})`,zI=YI?`round(${JI}, 1px)`:`calc(${JI})`;!dI||ZI.rotation%180===0?(HI.width=UI,HI.height=zI):(HI.width=zI,HI.height=UI)}pI&&sI.setAttribute("data-main-rotation",ZI.rotation)}},47:(I,G,l)=>{l.d(G,{DrawLayer:()=>e});var b=l(419),d=l(292);class e{#I=null;#l=0;#G=new Map;#b=new Map;constructor({pageIndex:W}){this.pageIndex=W}setParent(W){if(!this.#I){this.#I=W;return}if(this.#I!==W){if(this.#G.size>0)for(let n of this.#G.values())n.remove(),W.append(n);this.#I=W}}static get _svgFactory(){return(0,d.shadow)(this,"_svgFactory",new b.DOMSVGFactory)}static#d(W,{x:n=0,y:s=0,width:N=1,height:m=1}={}){let{style:h}=W;h.top=`${100*s}%`,h.left=`${100*n}%`,h.width=`${100*N}%`,h.height=`${100*m}%`}#c(W){let n=e._svgFactory.create(1,1,!0);return this.#I.append(n),n.setAttribute("aria-hidden",!0),e.#d(n,W),n}#Z(W,n){let s=e._svgFactory.createElement("clipPath");W.append(s);let N=`clip_${n}`;s.setAttribute("id",N),s.setAttribute("clipPathUnits","objectBoundingBox");let m=e._svgFactory.createElement("use");return s.append(m),m.setAttribute("href",`#${n}`),m.classList.add("clip"),N}highlight(W,n,s,N=!1){let m=this.#l++,h=this.#c(W.box);h.classList.add("highlight"),W.free&&h.classList.add("free");let V=e._svgFactory.createElement("defs");h.append(V);let X=e._svgFactory.createElement("path");V.append(X);let p=`path_p${this.pageIndex}_${m}`;X.setAttribute("id",p),X.setAttribute("d",W.toSVGPath()),N&&this.#b.set(m,X);let F=this.#Z(V,p),a=e._svgFactory.createElement("use");return h.append(a),h.setAttribute("fill",n),h.setAttribute("fill-opacity",s),a.setAttribute("href",`#${p}`),this.#G.set(m,h),{id:m,clipPathId:`url(#${F})`}}highlightOutline(W){let n=this.#l++,s=this.#c(W.box);s.classList.add("highlightOutline");let N=e._svgFactory.createElement("defs");s.append(N);let m=e._svgFactory.createElement("path");N.append(m);let h=`path_p${this.pageIndex}_${n}`;m.setAttribute("id",h),m.setAttribute("d",W.toSVGPath()),m.setAttribute("vector-effect","non-scaling-stroke");let V;if(W.free){s.classList.add("free");let F=e._svgFactory.createElement("mask");N.append(F),V=`mask_p${this.pageIndex}_${n}`,F.setAttribute("id",V),F.setAttribute("maskUnits","objectBoundingBox");let a=e._svgFactory.createElement("rect");F.append(a),a.setAttribute("width","1"),a.setAttribute("height","1"),a.setAttribute("fill","white");let u=e._svgFactory.createElement("use");F.append(u),u.setAttribute("href",`#${h}`),u.setAttribute("stroke","none"),u.setAttribute("fill","black"),u.setAttribute("fill-rule","nonzero"),u.classList.add("mask")}let X=e._svgFactory.createElement("use");s.append(X),X.setAttribute("href",`#${h}`),V&&X.setAttribute("mask",`url(#${V})`);let p=X.cloneNode();return s.append(p),X.classList.add("mainOutline"),p.classList.add("secondaryOutline"),this.#G.set(n,s),n}finalizeLine(W,n){let s=this.#b.get(W);this.#b.delete(W),this.updateBox(W,n.box),s.setAttribute("d",n.toSVGPath())}updateLine(W,n){this.#G.get(W).firstChild.firstChild.setAttribute("d",n.toSVGPath())}removeFreeHighlight(W){this.remove(W),this.#b.delete(W)}updatePath(W,n){this.#b.get(W).setAttribute("d",n.toSVGPath())}updateBox(W,n){e.#d(this.#G.get(W),n)}show(W,n){this.#G.get(W).classList.toggle("hidden",!n)}rotate(W,n){this.#G.get(W).setAttribute("data-main-rotation",n)}changeColor(W,n){this.#G.get(W).setAttribute("fill",n)}changeOpacity(W,n){this.#G.get(W).setAttribute("fill-opacity",n)}addClass(W,n){this.#G.get(W).classList.add(n)}removeClass(W,n){this.#G.get(W).classList.remove(n)}remove(W){this.#I!==null&&(this.#G.get(W).remove(),this.#G.delete(W))}destroy(){this.#I=null;for(let W of this.#G.values())W.remove();this.#G.clear()}}},731:(I,G,l)=>{l.d(G,{AnnotationEditorLayer:()=>p});var b=l(292),d=l(310),e=l(830),t=l(976);let W=/\r\n?|\n/g;class n extends d.AnnotationEditor{#I=this.editorDivBlur.bind(this);#l=this.editorDivFocus.bind(this);#G=this.editorDivInput.bind(this);#b=this.editorDivKeydown.bind(this);#d=this.editorDivPaste.bind(this);#c;#Z="";#W=`${this.id}-editor`;#a;#n=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){let a=n.prototype,u=y=>y.isEmpty(),Q=e.AnnotationEditorUIManager.TRANSLATE_SMALL,o=e.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,b.shadow)(this,"_keyboardManager",new e.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],a.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],a.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],a._translateEmpty,{args:[-Q,0],checker:u}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],a._translateEmpty,{args:[-o,0],checker:u}],[["ArrowRight","mac+ArrowRight"],a._translateEmpty,{args:[Q,0],checker:u}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],a._translateEmpty,{args:[o,0],checker:u}],[["ArrowUp","mac+ArrowUp"],a._translateEmpty,{args:[0,-Q],checker:u}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],a._translateEmpty,{args:[0,-o],checker:u}],[["ArrowDown","mac+ArrowDown"],a._translateEmpty,{args:[0,Q],checker:u}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],a._translateEmpty,{args:[0,o],checker:u}]]))}static _type="freetext";static _editorType=b.AnnotationEditorType.FREETEXT;constructor(a){super({...a,name:"freeTextEditor"}),this.#c=a.color||n._defaultColor||d.AnnotationEditor._defaultLineColor,this.#a=a.fontSize||n._defaultFontSize}static initialize(a,u){d.AnnotationEditor.initialize(a,u,{strings:["pdfjs-free-text-default-content"]});let Q=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(Q.getPropertyValue("--freetext-padding"))}static updateDefaultParams(a,u){switch(a){case b.AnnotationEditorParamsType.FREETEXT_SIZE:n._defaultFontSize=u;break;case b.AnnotationEditorParamsType.FREETEXT_COLOR:n._defaultColor=u;break}}updateParams(a,u){switch(a){case b.AnnotationEditorParamsType.FREETEXT_SIZE:this.#m(u);break;case b.AnnotationEditorParamsType.FREETEXT_COLOR:this.#t(u);break}}static get defaultPropertiesToUpdate(){return[[b.AnnotationEditorParamsType.FREETEXT_SIZE,n._defaultFontSize],[b.AnnotationEditorParamsType.FREETEXT_COLOR,n._defaultColor||d.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[b.AnnotationEditorParamsType.FREETEXT_SIZE,this.#a],[b.AnnotationEditorParamsType.FREETEXT_COLOR,this.#c]]}#m(a){let u=o=>{this.editorDiv.style.fontSize=`calc(${o}px * var(--scale-factor))`,this.translate(0,-(o-this.#a)*this.parentScale),this.#a=o,this.#s()},Q=this.#a;this.addCommands({cmd:u.bind(this,a),undo:u.bind(this,Q),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:b.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#t(a){let u=o=>{this.#c=this.editorDiv.style.color=o},Q=this.#c;this.addCommands({cmd:u.bind(this,a),undo:u.bind(this,Q),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:b.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(a,u){this._uiManager.translateSelectedEditors(a,u,!0)}getInitialTranslation(){let a=this.parentScale;return[-n._internalPadding*a,-(n._internalPadding+this.#a)*a]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(b.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",this.#b),this.editorDiv.addEventListener("focus",this.#l),this.editorDiv.addEventListener("blur",this.#I),this.editorDiv.addEventListener("input",this.#G),this.editorDiv.addEventListener("paste",this.#d))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#W),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",this.#b),this.editorDiv.removeEventListener("focus",this.#l),this.editorDiv.removeEventListener("blur",this.#I),this.editorDiv.removeEventListener("input",this.#G),this.editorDiv.removeEventListener("paste",this.#d),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(a){this._focusEventsAllowed&&(super.focusin(a),a.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#e(){let a=[];this.editorDiv.normalize();for(let u of this.editorDiv.childNodes)a.push(n.#Y(u));return a.join(`
`)}#s(){let[a,u]=this.parentDimensions,Q;if(this.isAttachedToDOM)Q=this.div.getBoundingClientRect();else{let{currentLayer:o,div:y}=this,H=y.style.display,E=y.classList.contains("hidden");y.classList.remove("hidden"),y.style.display="hidden",o.div.append(this.div),Q=y.getBoundingClientRect(),y.remove(),y.style.display=H,y.classList.toggle("hidden",E)}this.rotation%180===this.parentRotation%180?(this.width=Q.width/a,this.height=Q.height/u):(this.width=Q.height/a,this.height=Q.width/u),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let a=this.#Z,u=this.#Z=this.#e().trimEnd();if(a===u)return;let Q=o=>{if(this.#Z=o,!o){this.remove();return}this.#N(),this._uiManager.rebuild(this),this.#s()};this.addCommands({cmd:()=>{Q(u)},undo:()=>{Q(a)},mustExec:!1}),this.#s()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(a){this.enterInEditMode()}keydown(a){a.target===this.div&&a.key==="Enter"&&(this.enterInEditMode(),a.preventDefault())}editorDivKeydown(a){n._keyboardManager.exec(this,a)}editorDivFocus(a){this.isEditing=!0}editorDivBlur(a){this.isEditing=!1}editorDivInput(a){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let a,u;this.width&&(a=this.x,u=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#W),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text"),this.enableEditing(),d.AnnotationEditor._l10nPromise.get("pdfjs-free-text-default-content").then(o=>this.editorDiv?.setAttribute("default-content",o)),this.editorDiv.contentEditable=!0;let{style:Q}=this.editorDiv;if(Q.fontSize=`calc(${this.#a}px * var(--scale-factor))`,Q.color=this.#c,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,e.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){let[o,y]=this.parentDimensions;if(this.annotationElementId){let{position:H}=this.#n,[E,C]=this.getInitialTranslation();[E,C]=this.pageTranslationToScreen(E,C);let[T,S]=this.pageDimensions,[cI,hI]=this.pageTranslation,WI,VI;switch(this.rotation){case 0:WI=a+(H[0]-cI)/T,VI=u+this.height-(H[1]-hI)/S;break;case 90:WI=a+(H[0]-cI)/T,VI=u-(H[1]-hI)/S,[E,C]=[C,-E];break;case 180:WI=a-this.width+(H[0]-cI)/T,VI=u-(H[1]-hI)/S,[E,C]=[-E,-C];break;case 270:WI=a+(H[0]-cI-this.height*S)/T,VI=u+(H[1]-hI-this.width*T)/S,[E,C]=[-C,E];break}this.setAt(WI*o,VI*y,E,C)}else this.setAt(a*o,u*y,this.width*o,this.height*y);this.#N(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#Y(a){return(a.nodeType===Node.TEXT_NODE?a.nodeValue:a.innerText).replaceAll(W,"")}editorDivPaste(a){let u=a.clipboardData||window.clipboardData,{types:Q}=u;if(Q.length===1&&Q[0]==="text/plain")return;a.preventDefault();let o=n.#h(u.getData("text")||"").replaceAll(W,`
`);if(!o)return;let y=window.getSelection();if(!y.rangeCount)return;this.editorDiv.normalize(),y.deleteFromDocument();let H=y.getRangeAt(0);if(!o.includes(`
`)){H.insertNode(document.createTextNode(o)),this.editorDiv.normalize(),y.collapseToStart();return}let{startContainer:E,startOffset:C}=H,T=[],S=[];if(E.nodeType===Node.TEXT_NODE){let WI=E.parentElement;if(S.push(E.nodeValue.slice(C).replaceAll(W,"")),WI!==this.editorDiv){let VI=T;for(let sI of this.editorDiv.childNodes){if(sI===WI){VI=S;continue}VI.push(n.#Y(sI))}}T.push(E.nodeValue.slice(0,C).replaceAll(W,""))}else if(E===this.editorDiv){let WI=T,VI=0;for(let sI of this.editorDiv.childNodes)VI++===C&&(WI=S),WI.push(n.#Y(sI))}this.#Z=`${T.join(`
`)}${o}${S.join(`
`)}`,this.#N();let cI=new Range,hI=T.reduce((WI,VI)=>WI+VI.length,0);for(let{firstChild:WI}of this.editorDiv.childNodes)if(WI.nodeType===Node.TEXT_NODE){let VI=WI.nodeValue.length;if(hI<=VI){cI.setStart(WI,hI),cI.setEnd(WI,hI);break}hI-=VI}y.removeAllRanges(),y.addRange(cI)}#N(){if(this.editorDiv.replaceChildren(),!!this.#Z)for(let a of this.#Z.split(`
`)){let u=document.createElement("div");u.append(a?document.createTextNode(a):document.createElement("br")),this.editorDiv.append(u)}}#p(){return this.#Z.replaceAll("\xA0"," ")}static#h(a){return a.replaceAll(" ","\xA0")}get contentDiv(){return this.editorDiv}static deserialize(a,u,Q){let o=null;if(a instanceof t.FreeTextAnnotationElement){let{data:{defaultAppearanceData:{fontSize:H,fontColor:E},rect:C,rotation:T,id:S},textContent:cI,textPosition:hI,parent:{page:{pageNumber:WI}}}=a;if(!cI||cI.length===0)return null;o=a={annotationType:b.AnnotationEditorType.FREETEXT,color:Array.from(E),fontSize:H,value:cI.join(`
`),position:hI,pageIndex:WI-1,rect:C.slice(0),rotation:T,id:S,deleted:!1}}let y=super.deserialize(a,u,Q);return y.#a=a.fontSize,y.#c=b.Util.makeHexColor(...a.color),y.#Z=n.#h(a.value),y.annotationElementId=a.id||null,y.#n=o,y}serialize(a=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};let u=n._internalPadding*this.parentScale,Q=this.getRect(u,u),o=d.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#c),y={annotationType:b.AnnotationEditorType.FREETEXT,color:o,fontSize:this.#a,value:this.#p(),pageIndex:this.pageIndex,rect:Q,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return a?y:this.annotationElementId&&!this.#u(y)?null:(y.id=this.annotationElementId,y)}#u(a){let{value:u,fontSize:Q,color:o,pageIndex:y}=this.#n;return this._hasBeenMoved||a.value!==u||a.fontSize!==Q||a.color.some((H,E)=>H!==o[E])||a.pageIndex!==y}renderAnnotationElement(a){let u=super.renderAnnotationElement(a);if(this.deleted)return u;let{style:Q}=u;Q.fontSize=`calc(${this.#a}px * var(--scale-factor))`,Q.color=this.#c,u.replaceChildren();for(let y of this.#Z.split(`
`)){let H=document.createElement("div");H.append(y?document.createTextNode(y):document.createElement("br")),u.append(H)}let o=n._internalPadding*this.parentScale;return a.updateEdited({rect:this.getRect(o,o)}),u}resetAnnotationElement(a){super.resetAnnotationElement(a),a.resetEdited()}}var s=l(61),N=l(259),m=l(419);class h extends d.AnnotationEditor{#I=null;#l=0;#G;#b=null;#d=null;#c=null;#Z=null;#W=0;#a=null;#n=null;#m=null;#t=!1;#e=this.#X.bind(this);#s=null;#Y;#N=null;#p="";#h;#u="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _l10nPromise;static _type="highlight";static _editorType=b.AnnotationEditorType.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){let a=h.prototype;return(0,b.shadow)(this,"_keyboardManager",new e.KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],a._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],a._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],a._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],a._moveCaret,{args:[3]}]]))}constructor(a){super({...a,name:"highlightEditor"}),this.color=a.color||h._defaultColor,this.#h=a.thickness||h._defaultThickness,this.#Y=a.opacity||h._defaultOpacity,this.#G=a.boxes||null,this.#u=a.methodOfCreation||"",this.#p=a.text||"",this._isDraggable=!1,a.highlightId>-1?(this.#t=!0,this.#H(a),this.#V()):(this.#I=a.anchorNode,this.#l=a.anchorOffset,this.#Z=a.focusNode,this.#W=a.focusOffset,this.#o(),this.#V(),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:this.#t?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#h,methodOfCreation:this.#u}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(a){return{numberOfColors:a.get("color").size}}#o(){let a=new s.Outliner(this.#G,.001);this.#n=a.getOutlines(),{x:this.x,y:this.y,width:this.width,height:this.height}=this.#n.box;let u=new s.Outliner(this.#G,.0025,.001,this._uiManager.direction==="ltr");this.#c=u.getOutlines();let{lastPoint:Q}=this.#c.box;this.#s=[(Q[0]-this.x)/this.width,(Q[1]-this.y)/this.height]}#H({highlightOutlines:a,highlightId:u,clipPathId:Q}){this.#n=a;let o=1.5;if(this.#c=a.getNewOutline(this.#h/2+o,.0025),u>=0)this.#m=u,this.#b=Q,this.parent.drawLayer.finalizeLine(u,a),this.#N=this.parent.drawLayer.highlightOutline(this.#c);else if(this.parent){let S=this.parent.viewport.rotation;this.parent.drawLayer.updateLine(this.#m,a),this.parent.drawLayer.updateBox(this.#m,h.#F(this.#n.box,(S-this.rotation+360)%360)),this.parent.drawLayer.updateLine(this.#N,this.#c),this.parent.drawLayer.updateBox(this.#N,h.#F(this.#c.box,S))}let{x:y,y:H,width:E,height:C}=a.box;switch(this.rotation){case 0:this.x=y,this.y=H,this.width=E,this.height=C;break;case 90:{let[S,cI]=this.parentDimensions;this.x=H,this.y=1-y,this.width=E*cI/S,this.height=C*S/cI;break}case 180:this.x=1-y,this.y=1-H,this.width=E,this.height=C;break;case 270:{let[S,cI]=this.parentDimensions;this.x=1-H,this.y=y,this.width=E*cI/S,this.height=C*S/cI;break}}let{lastPoint:T}=this.#c.box;this.#s=[(T[0]-y)/E,(T[1]-H)/C]}static initialize(a,u){d.AnnotationEditor.initialize(a,u),h._defaultColor||=u.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(a,u){switch(a){case b.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:h._defaultColor=u;break;case b.AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:h._defaultThickness=u;break}}translateInPage(a,u){}get toolbarPosition(){return this.#s}updateParams(a,u){switch(a){case b.AnnotationEditorParamsType.HIGHLIGHT_COLOR:this.#r(u);break;case b.AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:this.#J(u);break}}static get defaultPropertiesToUpdate(){return[[b.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR,h._defaultColor],[b.AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,h._defaultThickness]]}get propertiesToUpdate(){return[[b.AnnotationEditorParamsType.HIGHLIGHT_COLOR,this.color||h._defaultColor],[b.AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,this.#h||h._defaultThickness],[b.AnnotationEditorParamsType.HIGHLIGHT_FREE,this.#t]]}#r(a){let u=o=>{this.color=o,this.parent?.drawLayer.changeColor(this.#m,o),this.#d?.updateColor(o)},Q=this.color;this.addCommands({cmd:u.bind(this,a),undo:u.bind(this,Q),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:b.AnnotationEditorParamsType.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(a)},!0)}#J(a){let u=this.#h,Q=o=>{this.#h=o,this.#y(o)};this.addCommands({cmd:Q.bind(this,a),undo:Q.bind(this,u),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:b.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:a},!0)}async addEditToolbar(){let a=await super.addEditToolbar();return a?(this._uiManager.highlightColors&&(this.#d=new N.ColorPicker({editor:this}),a.addColorPicker(this.#d)),a):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#Q())}getBaseTranslation(){return[0,0]}getRect(a,u){return super.getRect(a,u,this.#Q())}onceAdded(){this.parent.addUndoableEditor(this),this.div.focus()}remove(){this.#R(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#V(),this.isAttachedToDOM||this.parent.add(this)))}setParent(a){let u=!1;this.parent&&!a?this.#R():a&&(this.#V(a),u=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(a),this.show(this._isVisible),u&&this.select()}#y(a){if(!this.#t)return;this.#H({highlightOutlines:this.#n.getNewOutline(a/2)}),this.fixAndSetPosition();let[u,Q]=this.parentDimensions;this.setDims(this.width*u,this.height*Q)}#R(){this.#m===null||!this.parent||(this.parent.drawLayer.remove(this.#m),this.#m=null,this.parent.drawLayer.remove(this.#N),this.#N=null)}#V(a=this.parent){this.#m===null&&({id:this.#m,clipPathId:this.#b}=a.drawLayer.highlight(this.#n,this.color,this.#Y),this.#N=a.drawLayer.highlightOutline(this.#c),this.#a&&(this.#a.style.clipPath=this.#b))}static#F({x:a,y:u,width:Q,height:o},y){switch(y){case 90:return{x:1-u-o,y:a,width:o,height:Q};case 180:return{x:1-a-Q,y:1-u-o,width:Q,height:o};case 270:return{x:u,y:1-a-Q,width:o,height:Q}}return{x:a,y:u,width:Q,height:o}}rotate(a){let{drawLayer:u}=this.parent,Q;this.#t?(a=(a-this.rotation+360)%360,Q=h.#F(this.#n.box,a)):Q=h.#F(this,a),u.rotate(this.#m,a),u.rotate(this.#N,a),u.updateBox(this.#m,Q),u.updateBox(this.#N,h.#F(this.#c.box,a))}render(){if(this.div)return this.div;let a=super.render();this.#p&&(a.setAttribute("aria-label",this.#p),a.setAttribute("role","mark")),this.#t?a.classList.add("free"):this.div.addEventListener("keydown",this.#e);let u=this.#a=document.createElement("div");a.append(u),u.setAttribute("aria-hidden","true"),u.className="internal",u.style.clipPath=this.#b;let[Q,o]=this.parentDimensions;return this.setDims(this.width*Q,this.height*o),(0,e.bindEvents)(this,this.#a,["pointerover","pointerleave"]),this.enableEditing(),a}pointerover(){this.parent.drawLayer.addClass(this.#N,"hovered")}pointerleave(){this.parent.drawLayer.removeClass(this.#N,"hovered")}#X(a){h._keyboardManager.exec(this,a)}_moveCaret(a){switch(this.parent.unselect(this),a){case 0:case 2:this.#w(!0);break;case 1:case 3:this.#w(!1);break}}#w(a){if(!this.#I)return;let u=window.getSelection();a?u.setPosition(this.#I,this.#l):u.setPosition(this.#Z,this.#W)}select(){super.select(),this.#N&&(this.parent?.drawLayer.removeClass(this.#N,"hovered"),this.parent?.drawLayer.addClass(this.#N,"selected"))}unselect(){super.unselect(),this.#N&&(this.parent?.drawLayer.removeClass(this.#N,"selected"),this.#t||this.#w(!1))}get _mustFixPosition(){return!this.#t}show(a=this._isVisible){super.show(a),this.parent&&(this.parent.drawLayer.show(this.#m,a),this.parent.drawLayer.show(this.#N,a))}#Q(){return this.#t?this.rotation:0}#g(){if(this.#t)return null;let[a,u]=this.pageDimensions,Q=this.#G,o=new Array(Q.length*8),y=0;for(let{x:H,y:E,width:C,height:T}of Q){let S=H*a,cI=(1-E-T)*u;o[y]=o[y+4]=S,o[y+1]=o[y+3]=cI,o[y+2]=o[y+6]=S+C*a,o[y+5]=o[y+7]=cI+T*u,y+=8}return o}#v(a){return this.#n.serialize(a,this.#Q())}static startHighlighting(a,u,{target:Q,x:o,y}){let{x:H,y:E,width:C,height:T}=Q.getBoundingClientRect(),S=VI=>{this.#C(a,VI)},cI={capture:!0,passive:!1},hI=VI=>{VI.preventDefault(),VI.stopPropagation()},WI=VI=>{Q.removeEventListener("pointermove",S),window.removeEventListener("blur",WI),window.removeEventListener("pointerup",WI),window.removeEventListener("pointerdown",hI,cI),window.removeEventListener("contextmenu",m.noContextMenu),this.#E(a,VI)};window.addEventListener("blur",WI),window.addEventListener("pointerup",WI),window.addEventListener("pointerdown",hI,cI),window.addEventListener("contextmenu",m.noContextMenu),Q.addEventListener("pointermove",S),this._freeHighlight=new s.FreeOutliner({x:o,y},[H,E,C,T],a.scale,this._defaultThickness/2,u,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=a.drawLayer.highlight(this._freeHighlight,this._defaultColor,this._defaultOpacity,!0)}static#C(a,u){this._freeHighlight.add(u)&&a.drawLayer.updatePath(this._freeHighlightId,this._freeHighlight)}static#E(a,u){this._freeHighlight.isEmpty()?a.drawLayer.removeFreeHighlight(this._freeHighlightId):a.createAndAddNewEditor(u,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static deserialize(a,u,Q){let o=super.deserialize(a,u,Q),{rect:[y,H,E,C],color:T,quadPoints:S}=a;o.color=b.Util.makeHexColor(...T),o.#Y=a.opacity;let[cI,hI]=o.pageDimensions;o.width=(E-y)/cI,o.height=(C-H)/hI;let WI=o.#G=[];for(let VI=0;VI<S.length;VI+=8)WI.push({x:(S[4]-E)/cI,y:(C-(1-S[VI+5]))/hI,width:(S[VI+2]-S[VI])/cI,height:(S[VI+5]-S[VI+1])/hI});return o.#o(),o}serialize(a=!1){if(this.isEmpty()||a)return null;let u=this.getRect(0,0),Q=d.AnnotationEditor._colorManager.convert(this.color);return{annotationType:b.AnnotationEditorType.HIGHLIGHT,color:Q,opacity:this.#Y,thickness:this.#h,quadPoints:this.#g(),outlines:this.#v(u),pageIndex:this.pageIndex,rect:u,rotation:this.#Q(),structTreeParentId:this._structTreeParentId}}static canCreateNewEmptyEditor(){return!1}}class V extends d.AnnotationEditor{#I=0;#l=0;#G=this.canvasPointermove.bind(this);#b=this.canvasPointerleave.bind(this);#d=this.canvasPointerup.bind(this);#c=this.canvasPointerdown.bind(this);#Z=null;#W=new Path2D;#a=!1;#n=!1;#m=!1;#t=null;#e=0;#s=0;#Y=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";static _editorType=b.AnnotationEditorType.INK;constructor(a){super({...a,name:"inkEditor"}),this.color=a.color||null,this.thickness=a.thickness||null,this.opacity=a.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(a,u){d.AnnotationEditor.initialize(a,u)}static updateDefaultParams(a,u){switch(a){case b.AnnotationEditorParamsType.INK_THICKNESS:V._defaultThickness=u;break;case b.AnnotationEditorParamsType.INK_COLOR:V._defaultColor=u;break;case b.AnnotationEditorParamsType.INK_OPACITY:V._defaultOpacity=u/100;break}}updateParams(a,u){switch(a){case b.AnnotationEditorParamsType.INK_THICKNESS:this.#N(u);break;case b.AnnotationEditorParamsType.INK_COLOR:this.#p(u);break;case b.AnnotationEditorParamsType.INK_OPACITY:this.#h(u);break}}static get defaultPropertiesToUpdate(){return[[b.AnnotationEditorParamsType.INK_THICKNESS,V._defaultThickness],[b.AnnotationEditorParamsType.INK_COLOR,V._defaultColor||d.AnnotationEditor._defaultLineColor],[b.AnnotationEditorParamsType.INK_OPACITY,Math.round(V._defaultOpacity*100)]]}get propertiesToUpdate(){return[[b.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||V._defaultThickness],[b.AnnotationEditorParamsType.INK_COLOR,this.color||V._defaultColor||d.AnnotationEditor._defaultLineColor],[b.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??V._defaultOpacity))]]}#N(a){let u=o=>{this.thickness=o,this.#L()},Q=this.thickness;this.addCommands({cmd:u.bind(this,a),undo:u.bind(this,Q),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:b.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#p(a){let u=o=>{this.color=o,this.#X()},Q=this.color;this.addCommands({cmd:u.bind(this,a),undo:u.bind(this,Q),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:b.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#h(a){let u=o=>{this.opacity=o,this.#X()};a/=100;let Q=this.opacity;this.addCommands({cmd:u.bind(this,a),undo:u.bind(this,Q),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:b.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(this.#Q(),this.#g()),this.isAttachedToDOM||(this.parent.add(this),this.#v()),this.#L()))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#Z&&(clearTimeout(this.#Z),this.#Z=null),this.#t.disconnect(),this.#t=null,super.remove())}setParent(a){!this.parent&&a?this._uiManager.removeShouldRescale(this):this.parent&&a===null&&this._uiManager.addShouldRescale(this),super.setParent(a)}onScaleChanging(){let[a,u]=this.parentDimensions,Q=this.width*a,o=this.height*u;this.setDimensions(Q,o)}enableEditMode(){this.#a||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",this.#c))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#c))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}#u(){let{parentRotation:a,parentDimensions:[u,Q]}=this;switch(a){case 90:return[0,Q,Q,u];case 180:return[u,Q,u,Q];case 270:return[u,0,Q,u];default:return[0,0,u,Q]}}#o(){let{ctx:a,color:u,opacity:Q,thickness:o,parentScale:y,scaleFactor:H}=this;a.lineWidth=o*y/H,a.lineCap="round",a.lineJoin="round",a.miterLimit=10,a.strokeStyle=`${u}${(0,e.opacityToHex)(Q)}`}#H(a,u){this.canvas.addEventListener("contextmenu",m.noContextMenu),this.canvas.addEventListener("pointerleave",this.#b),this.canvas.addEventListener("pointermove",this.#G),this.canvas.addEventListener("pointerup",this.#d),this.canvas.removeEventListener("pointerdown",this.#c),this.isEditing=!0,this.#m||(this.#m=!0,this.#v(),this.thickness||=V._defaultThickness,this.color||=V._defaultColor||d.AnnotationEditor._defaultLineColor,this.opacity??=V._defaultOpacity),this.currentPath.push([a,u]),this.#n=!1,this.#o(),this.#Y=()=>{this.#R(),this.#Y&&window.requestAnimationFrame(this.#Y)},window.requestAnimationFrame(this.#Y)}#r(a,u){let[Q,o]=this.currentPath.at(-1);if(this.currentPath.length>1&&a===Q&&u===o)return;let y=this.currentPath,H=this.#W;if(y.push([a,u]),this.#n=!0,y.length<=2){H.moveTo(...y[0]),H.lineTo(a,u);return}y.length===3&&(this.#W=H=new Path2D,H.moveTo(...y[0])),this.#V(H,...y.at(-3),...y.at(-2),a,u)}#J(){if(this.currentPath.length===0)return;let a=this.currentPath.at(-1);this.#W.lineTo(...a)}#y(a,u){this.#Y=null,a=Math.min(Math.max(a,0),this.canvas.width),u=Math.min(Math.max(u,0),this.canvas.height),this.#r(a,u),this.#J();let Q;if(this.currentPath.length!==1)Q=this.#F();else{let C=[a,u];Q=[[C,C.slice(),C.slice(),C]]}let o=this.#W,y=this.currentPath;this.currentPath=[],this.#W=new Path2D;let H=()=>{this.allRawPaths.push(y),this.paths.push(Q),this.bezierPath2D.push(o),this._uiManager.rebuild(this)},E=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(this.#Q(),this.#g()),this.#L())};this.addCommands({cmd:H,undo:E,mustExec:!0})}#R(){if(!this.#n)return;this.#n=!1;let a=Math.ceil(this.thickness*this.parentScale),u=this.currentPath.slice(-3),Q=u.map(S=>S[0]),o=u.map(S=>S[1]),y=Math.min(...Q)-a,H=Math.max(...Q)+a,E=Math.min(...o)-a,C=Math.max(...o)+a,{ctx:T}=this;T.save(),T.clearRect(0,0,this.canvas.width,this.canvas.height);for(let S of this.bezierPath2D)T.stroke(S);T.stroke(this.#W),T.restore()}#V(a,u,Q,o,y,H,E){let C=(u+o)/2,T=(Q+y)/2,S=(o+H)/2,cI=(y+E)/2;a.bezierCurveTo(C+2*(o-C)/3,T+2*(y-T)/3,S+2*(o-S)/3,cI+2*(y-cI)/3,S,cI)}#F(){let a=this.currentPath;if(a.length<=2)return[[a[0],a[0],a.at(-1),a.at(-1)]];let u=[],Q,[o,y]=a[0];for(Q=1;Q<a.length-2;Q++){let[hI,WI]=a[Q],[VI,sI]=a[Q+1],ZI=(hI+VI)/2,dI=(WI+sI)/2,pI=[o+2*(hI-o)/3,y+2*(WI-y)/3],yI=[ZI+2*(hI-ZI)/3,dI+2*(WI-dI)/3];u.push([[o,y],pI,yI,[ZI,dI]]),[o,y]=[ZI,dI]}let[H,E]=a[Q],[C,T]=a[Q+1],S=[o+2*(H-o)/3,y+2*(E-y)/3],cI=[C+2*(H-C)/3,T+2*(E-T)/3];return u.push([[o,y],S,cI,[C,T]]),u}#X(){if(this.isEmpty()){this.#E();return}this.#o();let{canvas:a,ctx:u}=this;u.setTransform(1,0,0,1,0,0),u.clearRect(0,0,a.width,a.height),this.#E();for(let Q of this.bezierPath2D)u.stroke(Q)}commit(){this.#a||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#a=!0,this.div.classList.add("disabled"),this.#L(!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(a){this._focusEventsAllowed&&(super.focusin(a),this.enableEditMode())}canvasPointerdown(a){a.button!==0||!this.isInEditMode()||this.#a||(this.setInForeground(),a.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),this.#H(a.offsetX,a.offsetY))}canvasPointermove(a){a.preventDefault(),this.#r(a.offsetX,a.offsetY)}canvasPointerup(a){a.preventDefault(),this.#w(a)}canvasPointerleave(a){this.#w(a)}#w(a){this.canvas.removeEventListener("pointerleave",this.#b),this.canvas.removeEventListener("pointermove",this.#G),this.canvas.removeEventListener("pointerup",this.#d),this.canvas.addEventListener("pointerdown",this.#c),this.#Z&&clearTimeout(this.#Z),this.#Z=setTimeout(()=>{this.#Z=null,this.canvas.removeEventListener("contextmenu",m.noContextMenu)},10),this.#y(a.offsetX,a.offsetY),this.addToAnnotationStorage(),this.setInBackground()}#Q(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#g(){this.#t=new ResizeObserver(a=>{let u=a[0].contentRect;u.width&&u.height&&this.setDimensions(u.width,u.height)}),this.#t.observe(this.div)}get isResizable(){return!this.isEmpty()&&this.#a}render(){if(this.div)return this.div;let a,u;this.width&&(a=this.x,u=this.y),super.render(),this.div.setAttribute("data-l10n-id","pdfjs-ink");let[Q,o,y,H]=this.#u();if(this.setAt(Q,o,0,0),this.setDims(y,H),this.#Q(),this.width){let[E,C]=this.parentDimensions;this.setAspectRatio(this.width*E,this.height*C),this.setAt(a*E,u*C,this.width*E,this.height*C),this.#m=!0,this.#v(),this.setDims(this.width*E,this.height*C),this.#X(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#g(),this.div}#v(){if(!this.#m)return;let[a,u]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*a),this.canvas.height=Math.ceil(this.height*u),this.#E()}setDimensions(a,u){let Q=Math.round(a),o=Math.round(u);if(this.#e===Q&&this.#s===o)return;this.#e=Q,this.#s=o,this.canvas.style.visibility="hidden";let[y,H]=this.parentDimensions;this.width=a/y,this.height=u/H,this.fixAndSetPosition(),this.#a&&this.#C(a,u),this.#v(),this.#X(),this.canvas.style.visibility="visible",this.fixDims()}#C(a,u){let Q=this.#z(),o=(a-Q)/this.#l,y=(u-Q)/this.#I;this.scaleFactor=Math.min(o,y)}#E(){let a=this.#z()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+a,this.translationY*this.scaleFactor+a)}static#A(a){let u=new Path2D;for(let Q=0,o=a.length;Q<o;Q++){let[y,H,E,C]=a[Q];Q===0&&u.moveTo(...y),u.bezierCurveTo(H[0],H[1],E[0],E[1],C[0],C[1])}return u}static#M(a,u,Q){let[o,y,H,E]=u;switch(Q){case 0:for(let C=0,T=a.length;C<T;C+=2)a[C]+=o,a[C+1]=E-a[C+1];break;case 90:for(let C=0,T=a.length;C<T;C+=2){let S=a[C];a[C]=a[C+1]+o,a[C+1]=S+y}break;case 180:for(let C=0,T=a.length;C<T;C+=2)a[C]=H-a[C],a[C+1]+=y;break;case 270:for(let C=0,T=a.length;C<T;C+=2){let S=a[C];a[C]=H-a[C+1],a[C+1]=E-S}break;default:throw new Error("Invalid rotation")}return a}static#j(a,u,Q){let[o,y,H,E]=u;switch(Q){case 0:for(let C=0,T=a.length;C<T;C+=2)a[C]-=o,a[C+1]=E-a[C+1];break;case 90:for(let C=0,T=a.length;C<T;C+=2){let S=a[C];a[C]=a[C+1]-y,a[C+1]=S-o}break;case 180:for(let C=0,T=a.length;C<T;C+=2)a[C]=H-a[C],a[C+1]-=y;break;case 270:for(let C=0,T=a.length;C<T;C+=2){let S=a[C];a[C]=E-a[C+1],a[C+1]=H-S}break;default:throw new Error("Invalid rotation")}return a}#K(a,u,Q,o){let y=[],H=this.thickness/2,E=a*u+H,C=a*Q+H;for(let T of this.paths){let S=[],cI=[];for(let hI=0,WI=T.length;hI<WI;hI++){let[VI,sI,ZI,dI]=T[hI];if(VI[0]===dI[0]&&VI[1]===dI[1]&&WI===1){let zI=a*VI[0]+E,L=a*VI[1]+C;S.push(zI,L),cI.push(zI,L);break}let pI=a*VI[0]+E,yI=a*VI[1]+C,eI=a*sI[0]+E,HI=a*sI[1]+C,YI=a*ZI[0]+E,$=a*ZI[1]+C,JI=a*dI[0]+E,UI=a*dI[1]+C;hI===0&&(S.push(pI,yI),cI.push(pI,yI)),S.push(eI,HI,YI,$,JI,UI),cI.push(eI,HI),hI===WI-1&&cI.push(JI,UI)}y.push({bezier:V.#M(S,o,this.rotation),points:V.#M(cI,o,this.rotation)})}return y}#B(){let a=1/0,u=-1/0,Q=1/0,o=-1/0;for(let y of this.paths)for(let[H,E,C,T]of y){let S=b.Util.bezierBoundingBox(...H,...E,...C,...T);a=Math.min(a,S[0]),Q=Math.min(Q,S[1]),u=Math.max(u,S[2]),o=Math.max(o,S[3])}return[a,Q,u,o]}#z(){return this.#a?Math.ceil(this.thickness*this.parentScale):0}#L(a=!1){if(this.isEmpty())return;if(!this.#a){this.#X();return}let u=this.#B(),Q=this.#z();this.#l=Math.max(d.AnnotationEditor.MIN_SIZE,u[2]-u[0]),this.#I=Math.max(d.AnnotationEditor.MIN_SIZE,u[3]-u[1]);let o=Math.ceil(Q+this.#l*this.scaleFactor),y=Math.ceil(Q+this.#I*this.scaleFactor),[H,E]=this.parentDimensions;this.width=o/H,this.height=y/E,this.setAspectRatio(o,y);let C=this.translationX,T=this.translationY;this.translationX=-u[0],this.translationY=-u[1],this.#v(),this.#X(),this.#e=o,this.#s=y,this.setDims(o,y);let S=a?Q/this.scaleFactor/2:0;this.translate(C-this.translationX-S,T-this.translationY-S)}static deserialize(a,u,Q){if(a instanceof t.InkAnnotationElement)return null;let o=super.deserialize(a,u,Q);o.thickness=a.thickness,o.color=b.Util.makeHexColor(...a.color),o.opacity=a.opacity;let[y,H]=o.pageDimensions,E=o.width*y,C=o.height*H,T=o.parentScale,S=a.thickness/2;o.#a=!0,o.#e=Math.round(E),o.#s=Math.round(C);let{paths:cI,rect:hI,rotation:WI}=a;for(let{bezier:sI}of cI){sI=V.#j(sI,hI,WI);let ZI=[];o.paths.push(ZI);let dI=T*(sI[0]-S),pI=T*(sI[1]-S);for(let eI=2,HI=sI.length;eI<HI;eI+=6){let YI=T*(sI[eI]-S),$=T*(sI[eI+1]-S),JI=T*(sI[eI+2]-S),UI=T*(sI[eI+3]-S),zI=T*(sI[eI+4]-S),L=T*(sI[eI+5]-S);ZI.push([[dI,pI],[YI,$],[JI,UI],[zI,L]]),dI=zI,pI=L}let yI=this.#A(ZI);o.bezierPath2D.push(yI)}let VI=o.#B();return o.#l=Math.max(d.AnnotationEditor.MIN_SIZE,VI[2]-VI[0]),o.#I=Math.max(d.AnnotationEditor.MIN_SIZE,VI[3]-VI[1]),o.#C(E,C),o}serialize(){if(this.isEmpty())return null;let a=this.getRect(0,0),u=d.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:b.AnnotationEditorType.INK,color:u,thickness:this.thickness,opacity:this.opacity,paths:this.#K(this.scaleFactor/this.parentScale,this.translationX,this.translationY,a),pageIndex:this.pageIndex,rect:a,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}class X extends d.AnnotationEditor{#I=null;#l=null;#G=null;#b=null;#d=null;#c="";#Z=null;#W=null;#a=null;#n=!1;#m=!1;static _type="stamp";static _editorType=b.AnnotationEditorType.STAMP;constructor(a){super({...a,name:"stampEditor"}),this.#b=a.bitmapUrl,this.#d=a.bitmapFile}static initialize(a,u){d.AnnotationEditor.initialize(a,u)}static get supportedTypes(){let a=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,b.shadow)(this,"supportedTypes",a.map(u=>`image/${u}`))}static get supportedTypesStr(){return(0,b.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(a){return this.supportedTypes.includes(a)}static paste(a,u){u.pasteEditor(b.AnnotationEditorType.STAMP,{bitmapFile:a.getAsFile()})}#t(a,u=!1){if(!a){this.remove();return}this.#I=a.bitmap,u||(this.#l=a.id,this.#n=a.isSvg),a.file&&(this.#c=a.file.name),this.#Y()}#e(){this.#G=null,this._uiManager.enableWaiting(!1),this.#Z&&this.div.focus()}#s(){if(this.#l){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#l).then(u=>this.#t(u,!0)).finally(()=>this.#e());return}if(this.#b){let u=this.#b;this.#b=null,this._uiManager.enableWaiting(!0),this.#G=this._uiManager.imageManager.getFromUrl(u).then(Q=>this.#t(Q)).finally(()=>this.#e());return}if(this.#d){let u=this.#d;this.#d=null,this._uiManager.enableWaiting(!0),this.#G=this._uiManager.imageManager.getFromFile(u).then(Q=>this.#t(Q)).finally(()=>this.#e());return}let a=document.createElement("input");a.type="file",a.accept=X.supportedTypesStr,this.#G=new Promise(u=>{a.addEventListener("change",async()=>{if(!a.files||a.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);let Q=await this._uiManager.imageManager.getFromFile(a.files[0]);this.#t(Q)}u()}),a.addEventListener("cancel",()=>{this.remove(),u()})}).finally(()=>this.#e()),a.click()}remove(){this.#l&&(this.#I=null,this._uiManager.imageManager.deleteId(this.#l),this.#Z?.remove(),this.#Z=null,this.#W?.disconnect(),this.#W=null,this.#a&&(clearTimeout(this.#a),this.#a=null)),super.remove()}rebuild(){if(!this.parent){this.#l&&this.#s();return}super.rebuild(),this.div!==null&&(this.#l&&this.#Z===null&&this.#s(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#G||this.#I||this.#b||this.#d||this.#l)}get isResizable(){return!0}render(){if(this.div)return this.div;let a,u;if(this.width&&(a=this.x,u=this.y),super.render(),this.div.hidden=!0,this.addAltTextButton(),this.#I?this.#Y():this.#s(),this.width){let[Q,o]=this.parentDimensions;this.setAt(a*Q,u*o,this.width*Q,this.height*o)}return this.div}#Y(){let{div:a}=this,{width:u,height:Q}=this.#I,[o,y]=this.pageDimensions,H=.75;if(this.width)u=this.width*o,Q=this.height*y;else if(u>H*o||Q>H*y){let S=Math.min(H*o/u,H*y/Q);u*=S,Q*=S}let[E,C]=this.parentDimensions;this.setDims(u*E/o,Q*C/y),this._uiManager.enableWaiting(!1);let T=this.#Z=document.createElement("canvas");a.append(T),a.hidden=!1,this.#h(u,Q),this.#o(),this.#m||(this.parent.addUndoableEditor(this),this.#m=!0),this._reportTelemetry({action:"inserted_image"}),this.#c&&T.setAttribute("aria-label",this.#c)}#N(a,u){let[Q,o]=this.parentDimensions;this.width=a/Q,this.height=u/o,this.setDims(a,u),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this.#a!==null&&clearTimeout(this.#a);let y=200;this.#a=setTimeout(()=>{this.#a=null,this.#h(a,u)},y)}#p(a,u){let{width:Q,height:o}=this.#I,y=Q,H=o,E=this.#I;for(;y>2*a||H>2*u;){let C=y,T=H;y>2*a&&(y=y>=16384?Math.floor(y/2)-1:Math.ceil(y/2)),H>2*u&&(H=H>=16384?Math.floor(H/2)-1:Math.ceil(H/2));let S=new OffscreenCanvas(y,H);S.getContext("2d").drawImage(E,0,0,C,T,0,0,y,H),E=S.transferToImageBitmap()}return E}#h(a,u){a=Math.ceil(a),u=Math.ceil(u);let Q=this.#Z;if(!Q||Q.width===a&&Q.height===u)return;Q.width=a,Q.height=u;let o=this.#n?this.#I:this.#p(a,u);if(this._uiManager.hasMLManager&&!this.hasAltText()){let H=new OffscreenCanvas(a,u);H.getContext("2d").drawImage(o,0,0,o.width,o.height,0,0,a,u),H.convertToBlob().then(C=>{let T=new FileReader;T.onload=()=>{let S=T.result;this._uiManager.mlGuess({service:"image-to-text",request:{imageData:S}}).then(cI=>{let hI=cI?.output||"";this.parent&&hI&&!this.hasAltText()&&(this.altTextData={altText:hI,decorative:!1})})},T.readAsDataURL(C)})}let y=Q.getContext("2d");y.filter=this._uiManager.hcmFilter,y.drawImage(o,0,0,o.width,o.height,0,0,a,u)}getImageForAltText(){return this.#Z}#u(a){if(a){if(this.#n){let o=this._uiManager.imageManager.getSvgUrl(this.#l);if(o)return o}let u=document.createElement("canvas");return{width:u.width,height:u.height}=this.#I,u.getContext("2d").drawImage(this.#I,0,0),u.toDataURL()}if(this.#n){let[u,Q]=this.pageDimensions,o=Math.round(this.width*u*m.PixelsPerInch.PDF_TO_CSS_UNITS),y=Math.round(this.height*Q*m.PixelsPerInch.PDF_TO_CSS_UNITS),H=new OffscreenCanvas(o,y);return H.getContext("2d").drawImage(this.#I,0,0,this.#I.width,this.#I.height,0,0,o,y),H.transferToImageBitmap()}return structuredClone(this.#I)}#o(){this.#W=new ResizeObserver(a=>{let u=a[0].contentRect;u.width&&u.height&&this.#N(u.width,u.height)}),this.#W.observe(this.div)}static deserialize(a,u,Q){if(a instanceof t.StampAnnotationElement)return null;let o=super.deserialize(a,u,Q),{rect:y,bitmapUrl:H,bitmapId:E,isSvg:C,accessibilityData:T}=a;E&&Q.imageManager.isValidId(E)?o.#l=E:o.#b=H,o.#n=C;let[S,cI]=o.pageDimensions;return o.width=(y[2]-y[0])/S,o.height=(y[3]-y[1])/cI,T&&(o.altTextData=T),o}serialize(a=!1,u=null){if(this.isEmpty())return null;let Q={annotationType:b.AnnotationEditorType.STAMP,bitmapId:this.#l,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#n,structTreeParentId:this._structTreeParentId};if(a)return Q.bitmapUrl=this.#u(!0),Q.accessibilityData=this.altTextData,Q;let{decorative:o,altText:y}=this.altTextData;if(!o&&y&&(Q.accessibilityData={type:"Figure",alt:y}),u===null)return Q;u.stamps||=new Map;let H=this.#n?(Q.rect[2]-Q.rect[0])*(Q.rect[3]-Q.rect[1]):null;if(!u.stamps.has(this.#l))u.stamps.set(this.#l,{area:H,serialized:Q}),Q.bitmap=this.#u(!1);else if(this.#n){let E=u.stamps.get(this.#l);H>E.area&&(E.area=H,E.serialized.bitmap.close(),E.serialized.bitmap=this.#u(!1))}return Q}}class p{#I;#l=!1;#G=null;#b=null;#d=null;#c=null;#Z=null;#W=new Map;#a=!1;#n=!1;#m=!1;#t=null;#e;static _initialized=!1;static#s=new Map([n,V,X,h].map(a=>[a._editorType,a]));constructor({uiManager:a,pageIndex:u,div:Q,accessibilityManager:o,annotationLayer:y,drawLayer:H,textLayer:E,viewport:C,l10n:T}){let S=[...p.#s.values()];if(!p._initialized){p._initialized=!0;for(let cI of S)cI.initialize(T,a)}a.registerEditorTypes(S),this.#e=a,this.pageIndex=u,this.div=Q,this.#I=o,this.#G=y,this.viewport=C,this.#t=E,this.drawLayer=H,this.#e.addLayer(this)}get isEmpty(){return this.#W.size===0}get isInvisible(){return this.isEmpty&&this.#e.getMode()===b.AnnotationEditorType.NONE}updateToolbar(a){this.#e.updateToolbar(a)}updateMode(a=this.#e.getMode()){switch(this.#u(),a){case b.AnnotationEditorType.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case b.AnnotationEditorType.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case b.AnnotationEditorType.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:u}=this.div;for(let Q of p.#s.values())u.toggle(`${Q._type}Editing`,a===Q._editorType);this.div.hidden=!1}hasTextLayer(a){return a===this.#t?.div}addInkEditorIfNeeded(a){if(this.#e.getMode()!==b.AnnotationEditorType.INK)return;if(!a){for(let Q of this.#W.values())if(Q.isEmpty()){Q.setInBackground();return}}this.createAndAddNewEditor({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(a){this.#e.setEditingState(a)}addCommands(a){this.#e.addCommands(a)}togglePointerEvents(a=!1){this.div.classList.toggle("disabled",!a)}toggleAnnotationLayerPointerEvents(a=!1){this.#G?.div.classList.toggle("disabled",!a)}enable(){this.div.tabIndex=0,this.togglePointerEvents(!0);let a=new Set;for(let Q of this.#W.values())Q.enableEditing(),Q.show(!0),Q.annotationElementId&&(this.#e.removeChangedExistingAnnotation(Q),a.add(Q.annotationElementId));if(!this.#G)return;let u=this.#G.getEditableAnnotations();for(let Q of u){if(Q.hide(),this.#e.isDeletedAnnotationElement(Q.data.id)||a.has(Q.data.id))continue;let o=this.deserialize(Q);o&&(this.addOrRebuild(o),o.enableEditing())}}disable(){this.#m=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1);let a=new Map,u=new Map;for(let o of this.#W.values())if(o.disableEditing(),!!o.annotationElementId){if(o.serialize()!==null){a.set(o.annotationElementId,o);continue}else u.set(o.annotationElementId,o);this.getEditableAnnotation(o.annotationElementId)?.show(),o.remove()}if(this.#G){let o=this.#G.getEditableAnnotations();for(let y of o){let{id:H}=y.data;if(this.#e.isDeletedAnnotationElement(H))continue;let E=u.get(H);if(E){E.resetAnnotationElement(y),E.show(!1),y.show();continue}E=a.get(H),E&&(this.#e.addChangedExistingAnnotation(E),E.renderAnnotationElement(y),E.show(!1)),y.show()}}this.#u(),this.isEmpty&&(this.div.hidden=!0);let{classList:Q}=this.div;for(let o of p.#s.values())Q.remove(`${o._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#m=!1}getEditableAnnotation(a){return this.#G?.getEditableAnnotation(a)||null}setActiveEditor(a){this.#e.getActive()!==a&&this.#e.setActiveEditor(a)}enableTextSelection(){this.div.tabIndex=-1,this.#t?.div&&!this.#c&&(this.#c=this.#Y.bind(this),this.#t.div.addEventListener("pointerdown",this.#c),this.#t.div.classList.add("highlighting"))}disableTextSelection(){this.div.tabIndex=0,this.#t?.div&&this.#c&&(this.#t.div.removeEventListener("pointerdown",this.#c),this.#c=null,this.#t.div.classList.remove("highlighting"))}#Y(a){if(this.#e.unselectAll(),a.target===this.#t.div){let{isMac:u}=b.FeatureTest.platform;if(a.button!==0||a.ctrlKey&&u)return;this.#e.showAllEditors("highlight",!0,!0),this.#t.div.classList.add("free"),h.startHighlighting(this,this.#e.direction==="ltr",a),this.#t.div.addEventListener("pointerup",()=>{this.#t.div.classList.remove("free")},{once:!0}),a.preventDefault()}}enableClick(){this.#d||(this.#d=this.pointerdown.bind(this),this.#b=this.pointerup.bind(this),this.div.addEventListener("pointerdown",this.#d),this.div.addEventListener("pointerup",this.#b))}disableClick(){this.#d&&(this.div.removeEventListener("pointerdown",this.#d),this.div.removeEventListener("pointerup",this.#b),this.#d=null,this.#b=null)}attach(a){this.#W.set(a.id,a);let{annotationElementId:u}=a;u&&this.#e.isDeletedAnnotationElement(u)&&this.#e.removeDeletedAnnotationElement(a)}detach(a){this.#W.delete(a.id),this.#I?.removePointerInTextLayer(a.contentDiv),!this.#m&&a.annotationElementId&&this.#e.addDeletedAnnotationElement(a)}remove(a){this.detach(a),this.#e.removeEditor(a),a.div.remove(),a.isAttachedToDOM=!1,this.#n||this.addInkEditorIfNeeded(!1)}changeParent(a){a.parent!==this&&(a.parent&&a.annotationElementId&&(this.#e.addDeletedAnnotationElement(a.annotationElementId),d.AnnotationEditor.deleteAnnotationElement(a),a.annotationElementId=null),this.attach(a),a.parent?.detach(a),a.setParent(this),a.div&&a.isAttachedToDOM&&(a.div.remove(),this.div.append(a.div)))}add(a){if(!(a.parent===this&&a.isAttachedToDOM)){if(this.changeParent(a),this.#e.addEditor(a),this.attach(a),!a.isAttachedToDOM){let u=a.render();this.div.append(u),a.isAttachedToDOM=!0}a.fixAndSetPosition(),a.onceAdded(),this.#e.addToAnnotationStorage(a),a._reportTelemetry(a.telemetryInitialData)}}moveEditorInDOM(a){if(!a.isAttachedToDOM)return;let{activeElement:u}=document;a.div.contains(u)&&!this.#Z&&(a._focusEventsAllowed=!1,this.#Z=setTimeout(()=>{this.#Z=null,a.div.contains(document.activeElement)?a._focusEventsAllowed=!0:(a.div.addEventListener("focusin",()=>{a._focusEventsAllowed=!0},{once:!0}),u.focus())},0)),a._structTreeParentId=this.#I?.moveElementInDOM(this.div,a.div,a.contentDiv,!0)}addOrRebuild(a){a.needsToBeRebuilt()?(a.parent||=this,a.rebuild(),a.show()):this.add(a)}addUndoableEditor(a){let u=()=>a._uiManager.rebuild(a),Q=()=>{a.remove()};this.addCommands({cmd:u,undo:Q,mustExec:!1})}getNextId(){return this.#e.getId()}get#N(){return p.#s.get(this.#e.getMode())}#p(a){let u=this.#N;return u?new u.prototype.constructor(a):null}canCreateNewEmptyEditor(){return this.#N?.canCreateNewEmptyEditor()}pasteEditor(a,u){this.#e.updateToolbar(a),this.#e.updateMode(a);let{offsetX:Q,offsetY:o}=this.#h(),y=this.getNextId(),H=this.#p({parent:this,id:y,x:Q,y:o,uiManager:this.#e,isCentered:!0,...u});H&&this.add(H)}deserialize(a){return p.#s.get(a.annotationType??a.annotationEditorType)?.deserialize(a,this,this.#e)||null}createAndAddNewEditor(a,u,Q={}){let o=this.getNextId(),y=this.#p({parent:this,id:o,x:a.offsetX,y:a.offsetY,uiManager:this.#e,isCentered:u,...Q});return y&&this.add(y),y}#h(){let{x:a,y:u,width:Q,height:o}=this.div.getBoundingClientRect(),y=Math.max(0,a),H=Math.max(0,u),E=Math.min(window.innerWidth,a+Q),C=Math.min(window.innerHeight,u+o),T=(y+E)/2-a,S=(H+C)/2-u,[cI,hI]=this.viewport.rotation%180===0?[T,S]:[S,T];return{offsetX:cI,offsetY:hI}}addNewEditor(){this.createAndAddNewEditor(this.#h(),!0)}setSelected(a){this.#e.setSelected(a)}toggleSelected(a){this.#e.toggleSelected(a)}isSelected(a){return this.#e.isSelected(a)}unselect(a){this.#e.unselect(a)}pointerup(a){let{isMac:u}=b.FeatureTest.platform;if(!(a.button!==0||a.ctrlKey&&u)&&a.target===this.div&&this.#a){if(this.#a=!1,!this.#l){this.#l=!0;return}if(this.#e.getMode()===b.AnnotationEditorType.STAMP){this.#e.unselectAll();return}this.createAndAddNewEditor(a,!1)}}pointerdown(a){if(this.#e.getMode()===b.AnnotationEditorType.HIGHLIGHT&&this.enableTextSelection(),this.#a){this.#a=!1;return}let{isMac:u}=b.FeatureTest.platform;if(a.button!==0||a.ctrlKey&&u||a.target!==this.div)return;this.#a=!0;let Q=this.#e.getActive();this.#l=!Q||Q.isEmpty()}findNewParent(a,u,Q){let o=this.#e.findParent(u,Q);return o===null||o===this?!1:(o.changeParent(a),!0)}destroy(){this.#e.getActive()?.parent===this&&(this.#e.commitOrRemove(),this.#e.setActiveEditor(null)),this.#Z&&(clearTimeout(this.#Z),this.#Z=null);for(let a of this.#W.values())this.#I?.removePointerInTextLayer(a.contentDiv),a.setParent(null),a.isAttachedToDOM=!1,a.div.remove();this.div=null,this.#W.clear(),this.#e.removeLayer(this)}#u(){this.#n=!0;for(let a of this.#W.values())a.isEmpty()&&a.remove();this.#n=!1}render({viewport:a}){this.viewport=a,(0,m.setLayerDimensions)(this.div,a);for(let u of this.#e.getEditors(this.pageIndex))this.add(u),u.rebuild();this.updateMode()}update({viewport:a}){this.#e.commitOrRemove(),this.#u();let u=this.viewport.rotation,Q=a.rotation;if(this.viewport=a,(0,m.setLayerDimensions)(this.div,{rotation:Q}),u!==Q)for(let o of this.#W.values())o.rotate(Q);this.addInkEditorIfNeeded(!1)}get pageDimensions(){let{pageWidth:a,pageHeight:u}=this.viewport.rawDims;return[a,u]}get scale(){return this.#e.viewParameters.realScale}}},259:(I,G,l)=>{l.d(G,{ColorPicker:()=>t});var b=l(292),d=l(830),e=l(419);class t{#I=this.#Y.bind(this);#l=this.#p.bind(this);#G=null;#b=null;#d;#c=null;#Z=!1;#W=!1;#a=null;#n;#m=null;#t;static get _keyboardManager(){return(0,b.shadow)(this,"_keyboardManager",new d.KeyboardManager([[["Escape","mac+Escape"],t.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],t.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],t.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],t.prototype._moveToPrevious],[["Home","mac+Home"],t.prototype._moveToBeginning],[["End","mac+End"],t.prototype._moveToEnd]]))}constructor({editor:n=null,uiManager:s=null}){n?(this.#W=!1,this.#t=b.AnnotationEditorParamsType.HIGHLIGHT_COLOR,this.#a=n):(this.#W=!0,this.#t=b.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR),this.#m=n?._uiManager||s,this.#n=this.#m._eventBus,this.#d=n?.color||this.#m?.highlightColors.values().next().value||"#FFFF98"}renderButton(){let n=this.#G=document.createElement("button");n.className="colorPicker",n.tabIndex="0",n.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),n.setAttribute("aria-haspopup",!0),n.addEventListener("click",this.#N.bind(this)),n.addEventListener("keydown",this.#I);let s=this.#b=document.createElement("span");return s.className="swatch",s.setAttribute("aria-hidden",!0),s.style.backgroundColor=this.#d,n.append(s),n}renderMainDropdown(){let n=this.#c=this.#e();return n.setAttribute("aria-orientation","horizontal"),n.setAttribute("aria-labelledby","highlightColorPickerLabel"),n}#e(){let n=document.createElement("div");n.addEventListener("contextmenu",e.noContextMenu),n.className="dropdown",n.role="listbox",n.setAttribute("aria-multiselectable",!1),n.setAttribute("aria-orientation","vertical"),n.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(let[s,N]of this.#m.highlightColors){let m=document.createElement("button");m.tabIndex="0",m.role="option",m.setAttribute("data-color",N),m.title=s,m.setAttribute("data-l10n-id",`pdfjs-editor-colorpicker-${s}`);let h=document.createElement("span");m.append(h),h.className="swatch",h.style.backgroundColor=N,m.setAttribute("aria-selected",N===this.#d),m.addEventListener("click",this.#s.bind(this,N)),n.append(m)}return n.addEventListener("keydown",this.#I),n}#s(n,s){s.stopPropagation(),this.#n.dispatch("switchannotationeditorparams",{source:this,type:this.#t,value:n})}_colorSelectFromKeyboard(n){if(n.target===this.#G){this.#N(n);return}let s=n.target.getAttribute("data-color");s&&this.#s(s,n)}_moveToNext(n){if(!this.#h){this.#N(n);return}if(n.target===this.#G){this.#c.firstChild?.focus();return}n.target.nextSibling?.focus()}_moveToPrevious(n){if(n.target===this.#c?.firstChild||n.target===this.#G){this.#h&&this._hideDropdownFromKeyboard();return}this.#h||this.#N(n),n.target.previousSibling?.focus()}_moveToBeginning(n){if(!this.#h){this.#N(n);return}this.#c.firstChild?.focus()}_moveToEnd(n){if(!this.#h){this.#N(n);return}this.#c.lastChild?.focus()}#Y(n){t._keyboardManager.exec(this,n)}#N(n){if(this.#h){this.hideDropdown();return}if(this.#Z=n.detail===0,window.addEventListener("pointerdown",this.#l),this.#c){this.#c.classList.remove("hidden");return}let s=this.#c=this.#e();this.#G.append(s)}#p(n){this.#c?.contains(n.target)||this.hideDropdown()}hideDropdown(){this.#c?.classList.add("hidden"),window.removeEventListener("pointerdown",this.#l)}get#h(){return this.#c&&!this.#c.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#W){if(!this.#h){this.#a?.unselect();return}this.hideDropdown(),this.#G.focus({preventScroll:!0,focusVisible:this.#Z})}}updateColor(n){if(this.#b&&(this.#b.style.backgroundColor=n),!this.#c)return;let s=this.#m.highlightColors.values();for(let N of this.#c.children)N.setAttribute("aria-selected",s.next().value===n)}destroy(){this.#G?.remove(),this.#G=null,this.#b=null,this.#c?.remove(),this.#c=null}}},310:(I,G,l)=>{l.d(G,{AnnotationEditor:()=>n});var b=l(830),d=l(292),e=l(419);class t{#I="";#l=!1;#G=null;#b=null;#d=null;#c=!1;#Z=null;static _l10nPromise=null;constructor(m){this.#Z=m}static initialize(m){t._l10nPromise||=m}async render(){let m=this.#G=document.createElement("button");m.className="altText";let h=await t._l10nPromise.get("pdfjs-editor-alt-text-button-label");m.textContent=h,m.setAttribute("aria-label",h),m.tabIndex="0",m.addEventListener("contextmenu",e.noContextMenu),m.addEventListener("pointerdown",X=>X.stopPropagation());let V=X=>{X.preventDefault(),this.#Z._uiManager.editAltText(this.#Z)};return m.addEventListener("click",V,{capture:!0}),m.addEventListener("keydown",X=>{X.target===m&&X.key==="Enter"&&(this.#c=!0,V(X))}),await this.#W(),m}finish(){this.#G&&(this.#G.focus({focusVisible:this.#c}),this.#c=!1)}isEmpty(){return!this.#I&&!this.#l}get data(){return{altText:this.#I,decorative:this.#l}}set data({altText:m,decorative:h}){this.#I===m&&this.#l===h||(this.#I=m,this.#l=h,this.#W())}toggle(m=!1){this.#G&&(!m&&this.#d&&(clearTimeout(this.#d),this.#d=null),this.#G.disabled=!m)}destroy(){this.#G?.remove(),this.#G=null,this.#b=null}async#W(){let m=this.#G;if(!m)return;if(!this.#I&&!this.#l){m.classList.remove("done"),this.#b?.remove();return}m.classList.add("done"),t._l10nPromise.get("pdfjs-editor-alt-text-edit-button-label").then(X=>{m.setAttribute("aria-label",X)});let h=this.#b;if(!h){this.#b=h=document.createElement("span"),h.className="tooltip",h.setAttribute("role","tooltip");let X=h.id=`alt-text-tooltip-${this.#Z.id}`;m.setAttribute("aria-describedby",X);let p=100;m.addEventListener("mouseenter",()=>{this.#d=setTimeout(()=>{this.#d=null,this.#b.classList.add("show"),this.#Z._reportTelemetry({action:"alt_text_tooltip"})},p)}),m.addEventListener("mouseleave",()=>{this.#d&&(clearTimeout(this.#d),this.#d=null),this.#b?.classList.remove("show")})}h.innerText=this.#l?await t._l10nPromise.get("pdfjs-editor-alt-text-decorative-tooltip"):this.#I,h.parentNode||m.append(h),this.#Z.getImageForAltText()?.setAttribute("aria-describedby",h.id)}}var W=l(362);class n{#I=null;#l=null;#G=!1;#b=!1;#d=null;#c=null;#Z=this.focusin.bind(this);#W=this.focusout.bind(this);#a=null;#n="";#m=!1;#t=null;#e=!1;#s=!1;#Y=!1;#N=null;#p=0;#h=0;#u=null;_initialOptions=Object.create(null);_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;_l10nPromise=null;#o=!1;#H=n._zIndex++;static _borderLineWidth=-1;static _colorManager=new b.ColorManager;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){let m=n.prototype._resizeWithKeyboard,h=b.AnnotationEditorUIManager.TRANSLATE_SMALL,V=b.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,d.shadow)(this,"_resizerKeyboardManager",new b.KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],m,{args:[-h,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],m,{args:[-V,0]}],[["ArrowRight","mac+ArrowRight"],m,{args:[h,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],m,{args:[V,0]}],[["ArrowUp","mac+ArrowUp"],m,{args:[0,-h]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],m,{args:[0,-V]}],[["ArrowDown","mac+ArrowDown"],m,{args:[0,h]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],m,{args:[0,V]}],[["Escape","mac+Escape"],n.prototype._stopResizingWithKeyboard]]))}constructor(m){this.constructor===n&&(0,d.unreachable)("Cannot initialize AnnotationEditor."),this.parent=m.parent,this.id=m.id,this.width=this.height=null,this.pageIndex=m.parent.pageIndex,this.name=m.name,this.div=null,this._uiManager=m.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=m.isCentered,this._structTreeParentId=null;let{rotation:h,rawDims:{pageWidth:V,pageHeight:X,pageX:p,pageY:F}}=this.parent.viewport;this.rotation=h,this.pageRotation=(360+h-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[V,X],this.pageTranslation=[p,F];let[a,u]=this.parentDimensions;this.x=m.x/a,this.y=m.y/u,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,d.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(m){let h=new s({id:m.parent.getNextId(),parent:m.parent,uiManager:m._uiManager});h.annotationElementId=m.annotationElementId,h.deleted=!0,h._uiManager.addToAnnotationStorage(h)}static initialize(m,h,V){if(n._l10nPromise||=new Map(["pdfjs-editor-alt-text-button-label","pdfjs-editor-alt-text-edit-button-label","pdfjs-editor-alt-text-decorative-tooltip","pdfjs-editor-resizer-label-topLeft","pdfjs-editor-resizer-label-topMiddle","pdfjs-editor-resizer-label-topRight","pdfjs-editor-resizer-label-middleRight","pdfjs-editor-resizer-label-bottomRight","pdfjs-editor-resizer-label-bottomMiddle","pdfjs-editor-resizer-label-bottomLeft","pdfjs-editor-resizer-label-middleLeft"].map(p=>[p,m.get(p.replaceAll(/([A-Z])/g,F=>`-${F.toLowerCase()}`))])),V?.strings)for(let p of V.strings)n._l10nPromise.set(p,m.get(p));if(n._borderLineWidth!==-1)return;let X=getComputedStyle(document.documentElement);n._borderLineWidth=parseFloat(X.getPropertyValue("--outline-width"))||0}static updateDefaultParams(m,h){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(m){return!1}static paste(m,h){(0,d.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#o}set _isDraggable(m){this.#o=m,this.div?.classList.toggle("draggable",m)}get isEnterHandled(){return!0}center(){let[m,h]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*h/(m*2),this.y+=this.width*m/(h*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*h/(m*2),this.y-=this.width*m/(h*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(m){this._uiManager.addCommands(m)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#H}setParent(m){m!==null?(this.pageIndex=m.pageIndex,this.pageDimensions=m.pageDimensions):this.#A(),this.parent=m}focusin(m){this._focusEventsAllowed&&(this.#m?this.#m=!1:this.parent.setSelected(this))}focusout(m){!this._focusEventsAllowed||!this.isAttachedToDOM||m.relatedTarget?.closest(`#${this.id}`)||(m.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(m,h,V,X){let[p,F]=this.parentDimensions;[V,X]=this.screenToPageTranslation(V,X),this.x=(m+V)/p,this.y=(h+X)/F,this.fixAndSetPosition()}#r([m,h],V,X){[V,X]=this.screenToPageTranslation(V,X),this.x+=V/m,this.y+=X/h,this.fixAndSetPosition()}translate(m,h){this.#r(this.parentDimensions,m,h)}translateInPage(m,h){this.#t||=[this.x,this.y],this.#r(this.pageDimensions,m,h),this.div.scrollIntoView({block:"nearest"})}drag(m,h){this.#t||=[this.x,this.y];let[V,X]=this.parentDimensions;if(this.x+=m/V,this.y+=h/X,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:Q,y:o}=this.div.getBoundingClientRect();this.parent.findNewParent(this,Q,o)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:p,y:F}=this,[a,u]=this.getBaseTranslation();p+=a,F+=u,this.div.style.left=`${(100*p).toFixed(2)}%`,this.div.style.top=`${(100*F).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}get _hasBeenMoved(){return!!this.#t&&(this.#t[0]!==this.x||this.#t[1]!==this.y)}getBaseTranslation(){let[m,h]=this.parentDimensions,{_borderLineWidth:V}=n,X=V/m,p=V/h;switch(this.rotation){case 90:return[-X,p];case 180:return[X,p];case 270:return[X,-p];default:return[-X,-p]}}get _mustFixPosition(){return!0}fixAndSetPosition(m=this.rotation){let[h,V]=this.pageDimensions,{x:X,y:p,width:F,height:a}=this;if(F*=h,a*=V,X*=h,p*=V,this._mustFixPosition)switch(m){case 0:X=Math.max(0,Math.min(h-F,X)),p=Math.max(0,Math.min(V-a,p));break;case 90:X=Math.max(0,Math.min(h-a,X)),p=Math.min(V,Math.max(F,p));break;case 180:X=Math.min(h,Math.max(F,X)),p=Math.min(V,Math.max(a,p));break;case 270:X=Math.min(h,Math.max(a,X)),p=Math.max(0,Math.min(V-F,p));break}this.x=X/=h,this.y=p/=V;let[u,Q]=this.getBaseTranslation();X+=u,p+=Q;let{style:o}=this.div;o.left=`${(100*X).toFixed(2)}%`,o.top=`${(100*p).toFixed(2)}%`,this.moveInDOM()}static#J(m,h,V){switch(V){case 90:return[h,-m];case 180:return[-m,-h];case 270:return[-h,m];default:return[m,h]}}screenToPageTranslation(m,h){return n.#J(m,h,this.parentRotation)}pageTranslationToScreen(m,h){return n.#J(m,h,360-this.parentRotation)}#y(m){switch(m){case 90:{let[h,V]=this.pageDimensions;return[0,-h/V,V/h,0]}case 180:return[-1,0,0,-1];case 270:{let[h,V]=this.pageDimensions;return[0,h/V,-V/h,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:m,pageDimensions:[h,V]}=this,X=h*m,p=V*m;return d.FeatureTest.isCSSRoundSupported?[Math.round(X),Math.round(p)]:[X,p]}setDims(m,h){let[V,X]=this.parentDimensions;this.div.style.width=`${(100*m/V).toFixed(2)}%`,this.#b||(this.div.style.height=`${(100*h/X).toFixed(2)}%`)}fixDims(){let{style:m}=this.div,{height:h,width:V}=m,X=V.endsWith("%"),p=!this.#b&&h.endsWith("%");if(X&&p)return;let[F,a]=this.parentDimensions;X||(m.width=`${(100*parseFloat(V)/F).toFixed(2)}%`),!this.#b&&!p&&(m.height=`${(100*parseFloat(h)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#R(){if(this.#d)return;this.#d=document.createElement("div"),this.#d.classList.add("resizers");let m=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"];for(let h of m){let V=document.createElement("div");this.#d.append(V),V.classList.add("resizer",h),V.setAttribute("data-resizer-name",h),V.addEventListener("pointerdown",this.#V.bind(this,h)),V.addEventListener("contextmenu",e.noContextMenu),V.tabIndex=-1}this.div.prepend(this.#d)}#V(m,h){h.preventDefault();let{isMac:V}=d.FeatureTest.platform;if(h.button!==0||h.ctrlKey&&V)return;this.#l?.toggle(!1);let X=this.#X.bind(this,m),p=this._isDraggable;this._isDraggable=!1;let F={passive:!0,capture:!0};this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",X,F),window.addEventListener("contextmenu",e.noContextMenu);let a=this.x,u=this.y,Q=this.width,o=this.height,y=this.parent.div.style.cursor,H=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(h.target).cursor;let E=()=>{this.parent.togglePointerEvents(!0),this.#l?.toggle(!0),this._isDraggable=p,window.removeEventListener("pointerup",E),window.removeEventListener("blur",E),window.removeEventListener("pointermove",X,F),window.removeEventListener("contextmenu",e.noContextMenu),this.parent.div.style.cursor=y,this.div.style.cursor=H,this.#F(a,u,Q,o)};window.addEventListener("pointerup",E),window.addEventListener("blur",E)}#F(m,h,V,X){let p=this.x,F=this.y,a=this.width,u=this.height;p===m&&F===h&&a===V&&u===X||this.addCommands({cmd:()=>{this.width=a,this.height=u,this.x=p,this.y=F;let[Q,o]=this.parentDimensions;this.setDims(Q*a,o*u),this.fixAndSetPosition()},undo:()=>{this.width=V,this.height=X,this.x=m,this.y=h;let[Q,o]=this.parentDimensions;this.setDims(Q*V,o*X),this.fixAndSetPosition()},mustExec:!0})}#X(m,h){let[V,X]=this.parentDimensions,p=this.x,F=this.y,a=this.width,u=this.height,Q=n.MIN_SIZE/V,o=n.MIN_SIZE/X,y=L=>Math.round(L*1e4)/1e4,H=this.#y(this.rotation),E=(L,bI)=>[H[0]*L+H[2]*bI,H[1]*L+H[3]*bI],C=this.#y(360-this.rotation),T=(L,bI)=>[C[0]*L+C[2]*bI,C[1]*L+C[3]*bI],S,cI,hI=!1,WI=!1;switch(m){case"topLeft":hI=!0,S=(L,bI)=>[0,0],cI=(L,bI)=>[L,bI];break;case"topMiddle":S=(L,bI)=>[L/2,0],cI=(L,bI)=>[L/2,bI];break;case"topRight":hI=!0,S=(L,bI)=>[L,0],cI=(L,bI)=>[0,bI];break;case"middleRight":WI=!0,S=(L,bI)=>[L,bI/2],cI=(L,bI)=>[0,bI/2];break;case"bottomRight":hI=!0,S=(L,bI)=>[L,bI],cI=(L,bI)=>[0,0];break;case"bottomMiddle":S=(L,bI)=>[L/2,bI],cI=(L,bI)=>[L/2,0];break;case"bottomLeft":hI=!0,S=(L,bI)=>[0,bI],cI=(L,bI)=>[L,0];break;case"middleLeft":WI=!0,S=(L,bI)=>[0,bI/2],cI=(L,bI)=>[L,bI/2];break}let VI=S(a,u),sI=cI(a,u),ZI=E(...sI),dI=y(p+ZI[0]),pI=y(F+ZI[1]),yI=1,eI=1,[HI,YI]=this.screenToPageTranslation(h.movementX,h.movementY);if([HI,YI]=T(HI/V,YI/X),hI){let L=Math.hypot(a,u);yI=eI=Math.max(Math.min(Math.hypot(sI[0]-VI[0]-HI,sI[1]-VI[1]-YI)/L,1/a,1/u),Q/a,o/u)}else WI?yI=Math.max(Q,Math.min(1,Math.abs(sI[0]-VI[0]-HI)))/a:eI=Math.max(o,Math.min(1,Math.abs(sI[1]-VI[1]-YI)))/u;let $=y(a*yI),JI=y(u*eI);ZI=E(...cI($,JI));let UI=dI-ZI[0],zI=pI-ZI[1];this.width=$,this.height=JI,this.x=UI,this.y=zI,this.setDims(V*$,X*JI),this.fixAndSetPosition()}altTextFinish(){this.#l?.finish()}async addEditToolbar(){return this.#a||this.#s?this.#a:(this.#a=new W.EditorToolbar(this),this.div.append(this.#a.render()),this.#l&&this.#a.addAltTextButton(await this.#l.render()),this.#a)}removeEditToolbar(){this.#a&&(this.#a.remove(),this.#a=null,this.#l?.destroy())}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){this.#l||(t.initialize(n._l10nPromise),this.#l=new t(this),await this.addEditToolbar())}get altTextData(){return this.#l?.data}set altTextData(m){this.#l&&(this.#l.data=m)}hasAltText(){return!this.#l?.isEmpty()}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=this.#G?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),this.div.addEventListener("focusin",this.#Z),this.div.addEventListener("focusout",this.#W);let[m,h]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*h/m).toFixed(2)}%`,this.div.style.maxHeight=`${(100*m/h).toFixed(2)}%`);let[V,X]=this.getInitialTranslation();return this.translate(V,X),(0,b.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(m){let{isMac:h}=d.FeatureTest.platform;if(m.button!==0||m.ctrlKey&&h){m.preventDefault();return}if(this.#m=!0,this._isDraggable){this.#Q(m);return}this.#w(m)}#w(m){let{isMac:h}=d.FeatureTest.platform;m.ctrlKey&&!h||m.shiftKey||m.metaKey&&h?this.parent.toggleSelected(this):this.parent.setSelected(this)}#Q(m){let h=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let V,X;h&&(this.div.classList.add("moving"),V={passive:!0,capture:!0},this.#p=m.clientX,this.#h=m.clientY,X=F=>{let{clientX:a,clientY:u}=F,[Q,o]=this.screenToPageTranslation(a-this.#p,u-this.#h);this.#p=a,this.#h=u,this._uiManager.dragSelectedEditors(Q,o)},window.addEventListener("pointermove",X,V));let p=()=>{window.removeEventListener("pointerup",p),window.removeEventListener("blur",p),h&&(this.div.classList.remove("moving"),window.removeEventListener("pointermove",X,V)),this.#m=!1,this._uiManager.endDragSession()||this.#w(m)};window.addEventListener("pointerup",p),window.addEventListener("blur",p)}moveInDOM(){this.#N&&clearTimeout(this.#N),this.#N=setTimeout(()=>{this.#N=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(m,h,V){m.changeParent(this),this.x=h,this.y=V,this.fixAndSetPosition()}getRect(m,h,V=this.rotation){let X=this.parentScale,[p,F]=this.pageDimensions,[a,u]=this.pageTranslation,Q=m/X,o=h/X,y=this.x*p,H=this.y*F,E=this.width*p,C=this.height*F;switch(V){case 0:return[y+Q+a,F-H-o-C+u,y+Q+E+a,F-H-o+u];case 90:return[y+o+a,F-H+Q+u,y+o+C+a,F-H+Q+E+u];case 180:return[y-Q-E+a,F-H+o+u,y-Q+a,F-H+o+C+u];case 270:return[y-o-C+a,F-H-Q-E+u,y-o+a,F-H-Q+u];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(m,h){let[V,X,p,F]=m,a=p-V,u=F-X;switch(this.rotation){case 0:return[V,h-F,a,u];case 90:return[V,h-X,u,a];case 180:return[p,h-X,a,u];case 270:return[p,h-F,u,a];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#s=!0}disableEditMode(){this.#s=!1}isInEditMode(){return this.#s}shouldGetKeyboardEvents(){return this.#Y}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#Z),this.div?.addEventListener("focusout",this.#W)}rotate(m){}serialize(m=!1,h=null){(0,d.unreachable)("An editor must be serializable")}static deserialize(m,h,V){let X=new this.prototype.constructor({parent:h,id:h.getNextId(),uiManager:V});X.rotation=m.rotation;let[p,F]=X.pageDimensions,[a,u,Q,o]=X.getRectInCurrentCoords(m.rect,F);return X.x=a/p,X.y=u/F,X.width=Q/p,X.height=o/F,X}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.div.removeEventListener("focusin",this.#Z),this.div.removeEventListener("focusout",this.#W),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#N&&(clearTimeout(this.#N),this.#N=null),this.#A(),this.removeEditToolbar(),this.#u){for(let m of this.#u.values())clearTimeout(m);this.#u=null}this.parent=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#R(),this.#d.classList.remove("hidden"),(0,b.bindEvents)(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(m){if(!this.isResizable||m.target!==this.div||m.key!=="Enter")return;this._uiManager.setSelected(this),this.#c={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let h=this.#d.children;if(!this.#I){this.#I=Array.from(h);let F=this.#g.bind(this),a=this.#v.bind(this);for(let u of this.#I){let Q=u.getAttribute("data-resizer-name");u.setAttribute("role","spinbutton"),u.addEventListener("keydown",F),u.addEventListener("blur",a),u.addEventListener("focus",this.#C.bind(this,Q)),n._l10nPromise.get(`pdfjs-editor-resizer-label-${Q}`).then(o=>u.setAttribute("aria-label",o))}}let V=this.#I[0],X=0;for(let F of h){if(F===V)break;X++}let p=(360-this.rotation+this.parentRotation)%360/90*(this.#I.length/4);if(p!==X){if(p<X)for(let a=0;a<X-p;a++)this.#d.append(this.#d.firstChild);else if(p>X)for(let a=0;a<p-X;a++)this.#d.firstChild.before(this.#d.lastChild);let F=0;for(let a of h){let Q=this.#I[F++].getAttribute("data-resizer-name");n._l10nPromise.get(`pdfjs-editor-resizer-label-${Q}`).then(o=>a.setAttribute("aria-label",o))}}this.#E(0),this.#Y=!0,this.#d.firstChild.focus({focusVisible:!0}),m.preventDefault(),m.stopImmediatePropagation()}#g(m){n._resizerKeyboardManager.exec(this,m)}#v(m){this.#Y&&m.relatedTarget?.parentNode!==this.#d&&this.#A()}#C(m){this.#n=this.#Y?m:""}#E(m){if(this.#I)for(let h of this.#I)h.tabIndex=m}_resizeWithKeyboard(m,h){this.#Y&&this.#X(this.#n,{movementX:m,movementY:h})}#A(){if(this.#Y=!1,this.#E(-1),this.#c){let{savedX:m,savedY:h,savedWidth:V,savedHeight:X}=this.#c;this.#F(m,h,V,X),this.#c=null}}_stopResizingWithKeyboard(){this.#A(),this.div.focus()}select(){if(this.makeResizable(),this.div?.classList.add("selectedEditor"),!this.#a){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this.#a?.show()});return}this.#a?.show()}unselect(){this.#d?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this.#a?.hide()}updateParams(m,h){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#e}set isEditing(m){this.#e=m,this.parent&&(m?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(m,h){this.#b=!0;let V=m/h,{style:X}=this.div;X.aspectRatio=V,X.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(m,h=!1){if(h){this.#u||=new Map;let{action:V}=m,X=this.#u.get(V);X&&clearTimeout(X),X=setTimeout(()=>{this._reportTelemetry(m),this.#u.delete(V),this.#u.size===0&&(this.#u=null)},n._telemetryTimeout),this.#u.set(V,X);return}m.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:m}})}show(m=this._isVisible){this.div.classList.toggle("hidden",!m),this._isVisible=m}enable(){this.div&&(this.div.tabIndex=0),this.#G=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#G=!0}renderAnnotationElement(m){let h=m.container.querySelector(".annotationContent");if(!h)h=document.createElement("div"),h.classList.add("annotationContent",this.editorType),m.container.prepend(h);else if(h.nodeName==="CANVAS"){let V=h;h=document.createElement("div"),h.classList.add("annotationContent",this.editorType),V.before(h)}return h}resetAnnotationElement(m){let{firstChild:h}=m.container;h.nodeName==="DIV"&&h.classList.contains("annotationContent")&&h.remove()}}class s extends n{constructor(m){super(m),this.annotationElementId=m.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},61:(I,G,l)=>{l.d(G,{FreeOutliner:()=>W,Outliner:()=>d});var b=l(292);class d{#I;#l=[];#G=[];constructor(N,m=0,h=0,V=!0){let X=1/0,p=-1/0,F=1/0,a=-1/0,Q=10**-4;for(let{x:S,y:cI,width:hI,height:WI}of N){let VI=Math.floor((S-m)/Q)*Q,sI=Math.ceil((S+hI+m)/Q)*Q,ZI=Math.floor((cI-m)/Q)*Q,dI=Math.ceil((cI+WI+m)/Q)*Q,pI=[VI,ZI,dI,!0],yI=[sI,ZI,dI,!1];this.#l.push(pI,yI),X=Math.min(X,VI),p=Math.max(p,sI),F=Math.min(F,ZI),a=Math.max(a,dI)}let o=p-X+2*h,y=a-F+2*h,H=X-h,E=F-h,C=this.#l.at(V?-1:-2),T=[C[0],C[2]];for(let S of this.#l){let[cI,hI,WI]=S;S[0]=(cI-H)/o,S[1]=(hI-E)/y,S[2]=(WI-E)/y}this.#I={x:H,y:E,width:o,height:y,lastPoint:T}}getOutlines(){this.#l.sort((m,h)=>m[0]-h[0]||m[1]-h[1]||m[2]-h[2]);let N=[];for(let m of this.#l)m[3]?(N.push(...this.#W(m)),this.#c(m)):(this.#Z(m),N.push(...this.#W(m)));return this.#b(N)}#b(N){let m=[],h=new Set;for(let p of N){let[F,a,u]=p;m.push([F,a,p],[F,u,p])}m.sort((p,F)=>p[1]-F[1]||p[0]-F[0]);for(let p=0,F=m.length;p<F;p+=2){let a=m[p][2],u=m[p+1][2];a.push(u),u.push(a),h.add(a),h.add(u)}let V=[],X;for(;h.size>0;){let p=h.values().next().value,[F,a,u,Q,o]=p;h.delete(p);let y=F,H=a;for(X=[F,u],V.push(X);;){let E;if(h.has(Q))E=Q;else if(h.has(o))E=o;else break;h.delete(E),[F,a,u,Q,o]=E,y!==F&&(X.push(y,H,F,H===a?a:u),y=F),H=H===a?u:a}X.push(y,H)}return new t(V,this.#I)}#d(N){let m=this.#G,h=0,V=m.length-1;for(;h<=V;){let X=h+V>>1,p=m[X][0];if(p===N)return X;p<N?h=X+1:V=X-1}return V+1}#c([,N,m]){let h=this.#d(N);this.#G.splice(h,0,[N,m])}#Z([,N,m]){let h=this.#d(N);for(let V=h;V<this.#G.length;V++){let[X,p]=this.#G[V];if(X!==N)break;if(X===N&&p===m){this.#G.splice(V,1);return}}for(let V=h-1;V>=0;V--){let[X,p]=this.#G[V];if(X!==N)break;if(X===N&&p===m){this.#G.splice(V,1);return}}}#W(N){let[m,h,V]=N,X=[[m,h,V]],p=this.#d(V);for(let F=0;F<p;F++){let[a,u]=this.#G[F];for(let Q=0,o=X.length;Q<o;Q++){let[,y,H]=X[Q];if(!(u<=y||H<=a)){if(y>=a){if(H>u)X[Q][1]=u;else{if(o===1)return[];X.splice(Q,1),Q--,o--}continue}X[Q][2]=a,H>u&&X.push([m,u,H])}}}return X}}class e{toSVGPath(){throw new Error("Abstract method `toSVGPath` must be implemented.")}get box(){throw new Error("Abstract getter `box` must be implemented.")}serialize(N,m){throw new Error("Abstract method `serialize` must be implemented.")}get free(){return this instanceof n}}class t extends e{#I;#l;constructor(N,m){super(),this.#l=N,this.#I=m}toSVGPath(){let N=[];for(let m of this.#l){let[h,V]=m;N.push(`M${h} ${V}`);for(let X=2;X<m.length;X+=2){let p=m[X],F=m[X+1];p===h?(N.push(`V${F}`),V=F):F===V&&(N.push(`H${p}`),h=p)}N.push("Z")}return N.join(" ")}serialize([N,m,h,V],X){let p=[],F=h-N,a=V-m;for(let u of this.#l){let Q=new Array(u.length);for(let o=0;o<u.length;o+=2)Q[o]=N+u[o]*F,Q[o+1]=V-u[o+1]*a;p.push(Q)}return p}get box(){return this.#I}}class W{#I;#l=[];#G;#b;#d=[];#c=new Float64Array(18);#Z;#W;#a;#n;#m;#t;#e=[];static#s=8;static#Y=2;static#N=W.#s+W.#Y;constructor({x:N,y:m},h,V,X,p,F=0){this.#I=h,this.#t=X*V,this.#b=p,this.#c.set([NaN,NaN,NaN,NaN,N,m],6),this.#G=F,this.#n=W.#s*V,this.#a=W.#N*V,this.#m=V,this.#e.push(N,m)}get free(){return!0}isEmpty(){return isNaN(this.#c[8])}#p(){let N=this.#c.subarray(4,6),m=this.#c.subarray(16,18),[h,V,X,p]=this.#I;return[(this.#Z+(N[0]-m[0])/2-h)/X,(this.#W+(N[1]-m[1])/2-V)/p,(this.#Z+(m[0]-N[0])/2-h)/X,(this.#W+(m[1]-N[1])/2-V)/p]}add({x:N,y:m}){this.#Z=N,this.#W=m;let[h,V,X,p]=this.#I,[F,a,u,Q]=this.#c.subarray(8,12),o=N-u,y=m-Q,H=Math.hypot(o,y);if(H<this.#a)return!1;let E=H-this.#n,C=E/H,T=C*o,S=C*y,cI=F,hI=a;F=u,a=Q,u+=T,Q+=S,this.#e?.push(N,m);let WI=-S/E,VI=T/E,sI=WI*this.#t,ZI=VI*this.#t;return this.#c.set(this.#c.subarray(2,8),0),this.#c.set([u+sI,Q+ZI],4),this.#c.set(this.#c.subarray(14,18),12),this.#c.set([u-sI,Q-ZI],16),isNaN(this.#c[6])?(this.#d.length===0&&(this.#c.set([F+sI,a+ZI],2),this.#d.push(NaN,NaN,NaN,NaN,(F+sI-h)/X,(a+ZI-V)/p),this.#c.set([F-sI,a-ZI],14),this.#l.push(NaN,NaN,NaN,NaN,(F-sI-h)/X,(a-ZI-V)/p)),this.#c.set([cI,hI,F,a,u,Q],6),!this.isEmpty()):(this.#c.set([cI,hI,F,a,u,Q],6),Math.abs(Math.atan2(hI-a,cI-F)-Math.atan2(S,T))<Math.PI/2?([F,a,u,Q]=this.#c.subarray(2,6),this.#d.push(NaN,NaN,NaN,NaN,((F+u)/2-h)/X,((a+Q)/2-V)/p),[F,a,cI,hI]=this.#c.subarray(14,18),this.#l.push(NaN,NaN,NaN,NaN,((cI+F)/2-h)/X,((hI+a)/2-V)/p),!0):([cI,hI,F,a,u,Q]=this.#c.subarray(0,6),this.#d.push(((cI+5*F)/6-h)/X,((hI+5*a)/6-V)/p,((5*F+u)/6-h)/X,((5*a+Q)/6-V)/p,((F+u)/2-h)/X,((a+Q)/2-V)/p),[u,Q,F,a,cI,hI]=this.#c.subarray(12,18),this.#l.push(((cI+5*F)/6-h)/X,((hI+5*a)/6-V)/p,((5*F+u)/6-h)/X,((5*a+Q)/6-V)/p,((F+u)/2-h)/X,((a+Q)/2-V)/p),!0))}toSVGPath(){if(this.isEmpty())return"";let N=this.#d,m=this.#l,h=this.#c.subarray(4,6),V=this.#c.subarray(16,18),[X,p,F,a]=this.#I,[u,Q,o,y]=this.#p();if(isNaN(this.#c[6])&&!this.isEmpty())return`M${(this.#c[2]-X)/F} ${(this.#c[3]-p)/a} L${(this.#c[4]-X)/F} ${(this.#c[5]-p)/a} L${u} ${Q} L${o} ${y} L${(this.#c[16]-X)/F} ${(this.#c[17]-p)/a} L${(this.#c[14]-X)/F} ${(this.#c[15]-p)/a} Z`;let H=[];H.push(`M${N[4]} ${N[5]}`);for(let E=6;E<N.length;E+=6)isNaN(N[E])?H.push(`L${N[E+4]} ${N[E+5]}`):H.push(`C${N[E]} ${N[E+1]} ${N[E+2]} ${N[E+3]} ${N[E+4]} ${N[E+5]}`);H.push(`L${(h[0]-X)/F} ${(h[1]-p)/a} L${u} ${Q} L${o} ${y} L${(V[0]-X)/F} ${(V[1]-p)/a}`);for(let E=m.length-6;E>=6;E-=6)isNaN(m[E])?H.push(`L${m[E+4]} ${m[E+5]}`):H.push(`C${m[E]} ${m[E+1]} ${m[E+2]} ${m[E+3]} ${m[E+4]} ${m[E+5]}`);return H.push(`L${m[4]} ${m[5]} Z`),H.join(" ")}getOutlines(){let N=this.#d,m=this.#l,h=this.#c,V=h.subarray(4,6),X=h.subarray(16,18),[p,F,a,u]=this.#I,Q=new Float64Array((this.#e?.length??0)+2);for(let S=0,cI=Q.length-2;S<cI;S+=2)Q[S]=(this.#e[S]-p)/a,Q[S+1]=(this.#e[S+1]-F)/u;Q[Q.length-2]=(this.#Z-p)/a,Q[Q.length-1]=(this.#W-F)/u;let[o,y,H,E]=this.#p();if(isNaN(h[6])&&!this.isEmpty()){let S=new Float64Array(36);return S.set([NaN,NaN,NaN,NaN,(h[2]-p)/a,(h[3]-F)/u,NaN,NaN,NaN,NaN,(h[4]-p)/a,(h[5]-F)/u,NaN,NaN,NaN,NaN,o,y,NaN,NaN,NaN,NaN,H,E,NaN,NaN,NaN,NaN,(h[16]-p)/a,(h[17]-F)/u,NaN,NaN,NaN,NaN,(h[14]-p)/a,(h[15]-F)/u],0),new n(S,Q,this.#I,this.#m,this.#G,this.#b)}let C=new Float64Array(this.#d.length+24+this.#l.length),T=N.length;for(let S=0;S<T;S+=2){if(isNaN(N[S])){C[S]=C[S+1]=NaN;continue}C[S]=N[S],C[S+1]=N[S+1]}C.set([NaN,NaN,NaN,NaN,(V[0]-p)/a,(V[1]-F)/u,NaN,NaN,NaN,NaN,o,y,NaN,NaN,NaN,NaN,H,E,NaN,NaN,NaN,NaN,(X[0]-p)/a,(X[1]-F)/u],T),T+=24;for(let S=m.length-6;S>=6;S-=6)for(let cI=0;cI<6;cI+=2){if(isNaN(m[S+cI])){C[T]=C[T+1]=NaN,T+=2;continue}C[T]=m[S+cI],C[T+1]=m[S+cI+1],T+=2}return C.set([NaN,NaN,NaN,NaN,m[4],m[5]],T),new n(C,Q,this.#I,this.#m,this.#G,this.#b)}}class n extends e{#I;#l=null;#G;#b;#d;#c;#Z;constructor(N,m,h,V,X,p){super(),this.#Z=N,this.#d=m,this.#I=h,this.#c=V,this.#G=X,this.#b=p,this.#n(p);let{x:F,y:a,width:u,height:Q}=this.#l;for(let o=0,y=N.length;o<y;o+=2)N[o]=(N[o]-F)/u,N[o+1]=(N[o+1]-a)/Q;for(let o=0,y=m.length;o<y;o+=2)m[o]=(m[o]-F)/u,m[o+1]=(m[o+1]-a)/Q}toSVGPath(){let N=[`M${this.#Z[4]} ${this.#Z[5]}`];for(let m=6,h=this.#Z.length;m<h;m+=6){if(isNaN(this.#Z[m])){N.push(`L${this.#Z[m+4]} ${this.#Z[m+5]}`);continue}N.push(`C${this.#Z[m]} ${this.#Z[m+1]} ${this.#Z[m+2]} ${this.#Z[m+3]} ${this.#Z[m+4]} ${this.#Z[m+5]}`)}return N.push("Z"),N.join(" ")}serialize([N,m,h,V],X){let p=h-N,F=V-m,a,u;switch(X){case 0:a=this.#W(this.#Z,N,V,p,-F),u=this.#W(this.#d,N,V,p,-F);break;case 90:a=this.#a(this.#Z,N,m,p,F),u=this.#a(this.#d,N,m,p,F);break;case 180:a=this.#W(this.#Z,h,m,-p,F),u=this.#W(this.#d,h,m,-p,F);break;case 270:a=this.#a(this.#Z,h,V,-p,-F),u=this.#a(this.#d,h,V,-p,-F);break}return{outline:Array.from(a),points:[Array.from(u)]}}#W(N,m,h,V,X){let p=new Float64Array(N.length);for(let F=0,a=N.length;F<a;F+=2)p[F]=m+N[F]*V,p[F+1]=h+N[F+1]*X;return p}#a(N,m,h,V,X){let p=new Float64Array(N.length);for(let F=0,a=N.length;F<a;F+=2)p[F]=m+N[F+1]*V,p[F+1]=h+N[F]*X;return p}#n(N){let m=this.#Z,h=m[4],V=m[5],X=h,p=V,F=h,a=V,u=h,Q=V,o=N?Math.max:Math.min;for(let T=6,S=m.length;T<S;T+=6){if(isNaN(m[T]))X=Math.min(X,m[T+4]),p=Math.min(p,m[T+5]),F=Math.max(F,m[T+4]),a=Math.max(a,m[T+5]),Q<m[T+5]?(u=m[T+4],Q=m[T+5]):Q===m[T+5]&&(u=o(u,m[T+4]));else{let cI=b.Util.bezierBoundingBox(h,V,...m.slice(T,T+6));X=Math.min(X,cI[0]),p=Math.min(p,cI[1]),F=Math.max(F,cI[2]),a=Math.max(a,cI[3]),Q<cI[3]?(u=cI[2],Q=cI[3]):Q===cI[3]&&(u=o(u,cI[2]))}h=m[T+4],V=m[T+5]}let y=X-this.#G,H=p-this.#G,E=F-X+2*this.#G,C=a-p+2*this.#G;this.#l={x:y,y:H,width:E,height:C,lastPoint:[u,Q]}}get box(){return this.#l}getNewOutline(N,m){let{x:h,y:V,width:X,height:p}=this.#l,[F,a,u,Q]=this.#I,o=X*u,y=p*Q,H=h*u+F,E=V*Q+a,C=new W({x:this.#d[0]*o+H,y:this.#d[1]*y+E},this.#I,this.#c,N,this.#b,m??this.#G);for(let T=2;T<this.#d.length;T+=2)C.add({x:this.#d[T]*o+H,y:this.#d[T+1]*y+E});return C.getOutlines()}}},362:(I,G,l)=>{l.d(G,{EditorToolbar:()=>d,HighlightToolbar:()=>e});var b=l(419);class d{#I=null;#l=null;#G;#b=null;constructor(W){this.#G=W}render(){let W=this.#I=document.createElement("div");W.className="editToolbar",W.setAttribute("role","toolbar"),W.addEventListener("contextmenu",b.noContextMenu),W.addEventListener("pointerdown",d.#d);let n=this.#b=document.createElement("div");n.className="buttons",W.append(n);let s=this.#G.toolbarPosition;if(s){let{style:N}=W,m=this.#G._uiManager.direction==="ltr"?1-s[0]:s[0];N.insetInlineEnd=`${100*m}%`,N.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return this.#a(),W}static#d(W){W.stopPropagation()}#c(W){this.#G._focusEventsAllowed=!1,W.preventDefault(),W.stopPropagation()}#Z(W){this.#G._focusEventsAllowed=!0,W.preventDefault(),W.stopPropagation()}#W(W){W.addEventListener("focusin",this.#c.bind(this),{capture:!0}),W.addEventListener("focusout",this.#Z.bind(this),{capture:!0}),W.addEventListener("contextmenu",b.noContextMenu)}hide(){this.#I.classList.add("hidden"),this.#l?.hideDropdown()}show(){this.#I.classList.remove("hidden")}#a(){let W=document.createElement("button");W.className="delete",W.tabIndex=0,W.setAttribute("data-l10n-id",`pdfjs-editor-remove-${this.#G.editorType}-button`),this.#W(W),W.addEventListener("click",n=>{this.#G._uiManager.delete()}),this.#b.append(W)}get#n(){let W=document.createElement("div");return W.className="divider",W}addAltTextButton(W){this.#W(W),this.#b.prepend(W,this.#n)}addColorPicker(W){this.#l=W;let n=W.renderButton();this.#W(n),this.#b.prepend(n,this.#n)}remove(){this.#I.remove(),this.#l?.destroy(),this.#l=null}}class e{#I=null;#l=null;#G;constructor(W){this.#G=W}#b(){let W=this.#l=document.createElement("div");W.className="editToolbar",W.setAttribute("role","toolbar"),W.addEventListener("contextmenu",b.noContextMenu);let n=this.#I=document.createElement("div");return n.className="buttons",W.append(n),this.#c(),W}#d(W,n){let s=0,N=0;for(let m of W){let h=m.y+m.height;if(h<s)continue;let V=m.x+(n?m.width:0);if(h>s){N=V,s=h;continue}n?V>N&&(N=V):V<N&&(N=V)}return[n?1-N:N,s]}show(W,n,s){let[N,m]=this.#d(n,s),{style:h}=this.#l||=this.#b();W.append(this.#l),h.insetInlineEnd=`${100*N}%`,h.top=`calc(${100*m}% + var(--editor-toolbar-vert-offset))`}hide(){this.#l.remove()}#c(){let W=document.createElement("button");W.className="highlightButton",W.tabIndex=0,W.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");let n=document.createElement("span");W.append(n),n.className="visuallyHidden",n.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label"),W.addEventListener("contextmenu",b.noContextMenu),W.addEventListener("click",()=>{this.#G.highlightSelection("floating_button")}),this.#I.append(W)}}},830:(I,G,l)=>{l.d(G,{AnnotationEditorUIManager:()=>V,ColorManager:()=>h,KeyboardManager:()=>m,bindEvents:()=>t,opacityToHex:()=>W});var b=l(292),d=l(419),e=l(362);function t(X,p,F){for(let a of F)p.addEventListener(a,X[a].bind(X))}function W(X){return Math.round(Math.min(255,Math.max(1,255*X))).toString(16).padStart(2,"0")}class n{#I=0;constructor(){}get id(){return`${b.AnnotationEditorPrefix}${this.#I++}`}}class s{#I=(0,b.getUuid)();#l=0;#G=null;static get _isSVGFittingCanvas(){let p='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',a=new OffscreenCanvas(1,3).getContext("2d"),u=new Image;u.src=p;let Q=u.decode().then(()=>(a.drawImage(u,0,0,1,1,0,0,1,3),new Uint32Array(a.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,b.shadow)(this,"_isSVGFittingCanvas",Q)}async#b(p,F){this.#G||=new Map;let a=this.#G.get(p);if(a===null)return null;if(a?.bitmap)return a.refCounter+=1,a;try{a||={bitmap:null,id:`image_${this.#I}_${this.#l++}`,refCounter:0,isSvg:!1};let u;if(typeof F=="string"?(a.url=F,u=await(0,d.fetchData)(F,"blob")):u=a.file=F,u.type==="image/svg+xml"){let Q=s._isSVGFittingCanvas,o=new FileReader,y=new Image,H=new Promise((E,C)=>{y.onload=()=>{a.bitmap=y,a.isSvg=!0,E()},o.onload=async()=>{let T=a.svgUrl=o.result;y.src=await Q?`${T}#svgView(preserveAspectRatio(none))`:T},y.onerror=o.onerror=C});o.readAsDataURL(u),await H}else a.bitmap=await createImageBitmap(u);a.refCounter=1}catch(u){console.error(u),a=null}return this.#G.set(p,a),a&&this.#G.set(a.id,a),a}async getFromFile(p){let{lastModified:F,name:a,size:u,type:Q}=p;return this.#b(`${F}_${a}_${u}_${Q}`,p)}async getFromUrl(p){return this.#b(p,p)}async getFromId(p){this.#G||=new Map;let F=this.#G.get(p);return F?F.bitmap?(F.refCounter+=1,F):F.file?this.getFromFile(F.file):this.getFromUrl(F.url):null}getSvgUrl(p){let F=this.#G.get(p);return F?.isSvg?F.svgUrl:null}deleteId(p){this.#G||=new Map;let F=this.#G.get(p);F&&(F.refCounter-=1,F.refCounter===0&&(F.bitmap=null))}isValidId(p){return p.startsWith(`image_${this.#I}_`)}}class N{#I=[];#l=!1;#G;#b=-1;constructor(p=128){this.#G=p}add({cmd:p,undo:F,post:a,mustExec:u,type:Q=NaN,overwriteIfSameType:o=!1,keepUndo:y=!1}){if(u&&p(),this.#l)return;let H={cmd:p,undo:F,post:a,type:Q};if(this.#b===-1){this.#I.length>0&&(this.#I.length=0),this.#b=0,this.#I.push(H);return}if(o&&this.#I[this.#b].type===Q){y&&(H.undo=this.#I[this.#b].undo),this.#I[this.#b]=H;return}let E=this.#b+1;E===this.#G?this.#I.splice(0,1):(this.#b=E,E<this.#I.length&&this.#I.splice(E)),this.#I.push(H)}undo(){if(this.#b===-1)return;this.#l=!0;let{undo:p,post:F}=this.#I[this.#b];p(),F?.(),this.#l=!1,this.#b-=1}redo(){if(this.#b<this.#I.length-1){this.#b+=1,this.#l=!0;let{cmd:p,post:F}=this.#I[this.#b];p(),F?.(),this.#l=!1}}hasSomethingToUndo(){return this.#b!==-1}hasSomethingToRedo(){return this.#b<this.#I.length-1}destroy(){this.#I=null}}class m{constructor(p){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:F}=b.FeatureTest.platform;for(let[a,u,Q={}]of p)for(let o of a){let y=o.startsWith("mac+");F&&y?(this.callbacks.set(o.slice(4),{callback:u,options:Q}),this.allKeys.add(o.split("+").at(-1))):!F&&!y&&(this.callbacks.set(o,{callback:u,options:Q}),this.allKeys.add(o.split("+").at(-1)))}}#I(p){p.altKey&&this.buffer.push("alt"),p.ctrlKey&&this.buffer.push("ctrl"),p.metaKey&&this.buffer.push("meta"),p.shiftKey&&this.buffer.push("shift"),this.buffer.push(p.key);let F=this.buffer.join("+");return this.buffer.length=0,F}exec(p,F){if(!this.allKeys.has(F.key))return;let a=this.callbacks.get(this.#I(F));if(!a)return;let{callback:u,options:{bubbles:Q=!1,args:o=[],checker:y=null}}=a;y&&!y(p,F)||(u.bind(p,...o,F)(),Q||(F.stopPropagation(),F.preventDefault()))}}class h{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){let p=new Map([["CanvasText",null],["Canvas",null]]);return(0,d.getColorValues)(p),(0,b.shadow)(this,"_colors",p)}convert(p){let F=(0,d.getRGB)(p);if(!window.matchMedia("(forced-colors: active)").matches)return F;for(let[a,u]of this._colors)if(u.every((Q,o)=>Q===F[o]))return h._colorsMapping.get(a);return F}getHexCode(p){let F=this._colors.get(p);return F?b.Util.makeHexColor(...F):p}}class V{#I=null;#l=new Map;#G=new Map;#b=null;#d=null;#c=null;#Z=new N;#W=0;#a=new Set;#n=null;#m=null;#t=new Set;#e=!1;#s=null;#Y=null;#N=null;#p=!1;#h=null;#u=new n;#o=!1;#H=!1;#r=null;#J=null;#y=null;#R=b.AnnotationEditorType.NONE;#V=new Set;#F=null;#X=null;#w=null;#Q=this.blur.bind(this);#g=this.focus.bind(this);#v=this.copy.bind(this);#C=this.cut.bind(this);#E=this.paste.bind(this);#A=this.keydown.bind(this);#M=this.keyup.bind(this);#j=this.onEditingAction.bind(this);#K=this.onPageChanging.bind(this);#B=this.onScaleChanging.bind(this);#z=this.#dI.bind(this);#L=this.onRotationChanging.bind(this);#D={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#O=[0,0];#k=null;#U=null;#q=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){let p=V.prototype,F=o=>o.#U.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),a=(o,{target:y})=>{if(y instanceof HTMLInputElement){let{type:H}=y;return H!=="text"&&H!=="number"}return!0},u=this.TRANSLATE_SMALL,Q=this.TRANSLATE_BIG;return(0,b.shadow)(this,"_keyboardManager",new m([[["ctrl+a","mac+meta+a"],p.selectAll,{checker:a}],[["ctrl+z","mac+meta+z"],p.undo,{checker:a}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],p.redo,{checker:a}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],p.delete,{checker:a}],[["Enter","mac+Enter"],p.addNewEditorFromKeyboard,{checker:(o,{target:y})=>!(y instanceof HTMLButtonElement)&&o.#U.contains(y)&&!o.isEnterHandled}],[[" ","mac+ "],p.addNewEditorFromKeyboard,{checker:(o,{target:y})=>!(y instanceof HTMLButtonElement)&&o.#U.contains(document.activeElement)}],[["Escape","mac+Escape"],p.unselectAll],[["ArrowLeft","mac+ArrowLeft"],p.translateSelectedEditors,{args:[-u,0],checker:F}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],p.translateSelectedEditors,{args:[-Q,0],checker:F}],[["ArrowRight","mac+ArrowRight"],p.translateSelectedEditors,{args:[u,0],checker:F}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],p.translateSelectedEditors,{args:[Q,0],checker:F}],[["ArrowUp","mac+ArrowUp"],p.translateSelectedEditors,{args:[0,-u],checker:F}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],p.translateSelectedEditors,{args:[0,-Q],checker:F}],[["ArrowDown","mac+ArrowDown"],p.translateSelectedEditors,{args:[0,u],checker:F}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],p.translateSelectedEditors,{args:[0,Q],checker:F}]]))}constructor(p,F,a,u,Q,o,y,H,E){this.#U=p,this.#q=F,this.#b=a,this._eventBus=u,this._eventBus._on("editingaction",this.#j),this._eventBus._on("pagechanging",this.#K),this._eventBus._on("scalechanging",this.#B),this._eventBus._on("rotationchanging",this.#L),this.#ZI(),this.#P(),this.#d=Q.annotationStorage,this.#s=Q.filterFactory,this.#X=o,this.#N=y||null,this.#e=H,this.#y=E||null,this.viewParameters={realScale:d.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1}destroy(){this.#$(),this.#_(),this._eventBus._off("editingaction",this.#j),this._eventBus._off("pagechanging",this.#K),this._eventBus._off("scalechanging",this.#B),this._eventBus._off("rotationchanging",this.#L);for(let p of this.#G.values())p.destroy();this.#G.clear(),this.#l.clear(),this.#t.clear(),this.#I=null,this.#V.clear(),this.#Z.destroy(),this.#b?.destroy(),this.#h?.hide(),this.#h=null,this.#Y&&(clearTimeout(this.#Y),this.#Y=null),this.#k&&(clearTimeout(this.#k),this.#k=null),this.#eI()}async mlGuess(p){return this.#y?.guess(p)||null}get hasMLManager(){return!!this.#y}get hcmFilter(){return(0,b.shadow)(this,"hcmFilter",this.#X?this.#s.addHCMFilter(this.#X.foreground,this.#X.background):"none")}get direction(){return(0,b.shadow)(this,"direction",getComputedStyle(this.#U).direction)}get highlightColors(){return(0,b.shadow)(this,"highlightColors",this.#N?new Map(this.#N.split(",").map(p=>p.split("=").map(F=>F.trim()))):null)}get highlightColorNames(){return(0,b.shadow)(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,p=>p.reverse())):null)}setMainHighlightColorPicker(p){this.#J=p}editAltText(p){this.#b?.editAltText(this,p)}onPageChanging({pageNumber:p}){this.#W=p-1}focusMainContainer(){this.#U.focus()}findParent(p,F){for(let a of this.#G.values()){let{x:u,y:Q,width:o,height:y}=a.div.getBoundingClientRect();if(p>=u&&p<=u+o&&F>=Q&&F<=Q+y)return a}return null}disableUserSelect(p=!1){this.#q.classList.toggle("noUserSelect",p)}addShouldRescale(p){this.#t.add(p)}removeShouldRescale(p){this.#t.delete(p)}onScaleChanging({scale:p}){this.commitOrRemove(),this.viewParameters.realScale=p*d.PixelsPerInch.PDF_TO_CSS_UNITS;for(let F of this.#t)F.onScaleChanging()}onRotationChanging({pagesRotation:p}){this.commitOrRemove(),this.viewParameters.rotation=p}#f({anchorNode:p}){return p.nodeType===Node.TEXT_NODE?p.parentElement:p}highlightSelection(p=""){let F=document.getSelection();if(!F||F.isCollapsed)return;let{anchorNode:a,anchorOffset:u,focusNode:Q,focusOffset:o}=F,y=F.toString(),E=this.#f(F).closest(".textLayer"),C=this.getSelectionBoxes(E);if(C){F.empty(),this.#R===b.AnnotationEditorType.NONE&&(this._eventBus.dispatch("showannotationeditorui",{source:this,mode:b.AnnotationEditorType.HIGHLIGHT}),this.showAllEditors("highlight",!0,!0));for(let T of this.#G.values())if(T.hasTextLayer(E)){T.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:p,boxes:C,anchorNode:a,anchorOffset:u,focusNode:Q,focusOffset:o,text:y});break}}}#bI(){let p=document.getSelection();if(!p||p.isCollapsed)return;let a=this.#f(p).closest(".textLayer"),u=this.getSelectionBoxes(a);u&&(this.#h||=new e.HighlightToolbar(this),this.#h.show(a,u,this.direction==="ltr"))}addToAnnotationStorage(p){!p.isEmpty()&&this.#d&&!this.#d.has(p.id)&&this.#d.setValue(p.id,p)}#dI(){let p=document.getSelection();if(!p||p.isCollapsed){this.#F&&(this.#h?.hide(),this.#F=null,this.#i({hasSelectedText:!1}));return}let{anchorNode:F}=p;if(F===this.#F)return;if(!this.#f(p).closest(".textLayer")){this.#F&&(this.#h?.hide(),this.#F=null,this.#i({hasSelectedText:!1}));return}if(this.#h?.hide(),this.#F=F,this.#i({hasSelectedText:!0}),!(this.#R!==b.AnnotationEditorType.HIGHLIGHT&&this.#R!==b.AnnotationEditorType.NONE)&&(this.#R===b.AnnotationEditorType.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#p=this.isShiftKeyDown,!this.isShiftKeyDown)){let Q=o=>{o.type==="pointerup"&&o.button!==0||(window.removeEventListener("pointerup",Q),window.removeEventListener("blur",Q),o.type==="pointerup"&&this.#S("main_toolbar"))};window.addEventListener("pointerup",Q),window.addEventListener("blur",Q)}}#S(p=""){this.#R===b.AnnotationEditorType.HIGHLIGHT?this.highlightSelection(p):this.#e&&this.#bI()}#ZI(){document.addEventListener("selectionchange",this.#z)}#eI(){document.removeEventListener("selectionchange",this.#z)}#aI(){window.addEventListener("focus",this.#g),window.addEventListener("blur",this.#Q)}#_(){window.removeEventListener("focus",this.#g),window.removeEventListener("blur",this.#Q)}blur(){if(this.isShiftKeyDown=!1,this.#p&&(this.#p=!1,this.#S("main_toolbar")),!this.hasSelection)return;let{activeElement:p}=document;for(let F of this.#V)if(F.div.contains(p)){this.#r=[F,p],F._focusEventsAllowed=!1;break}}focus(){if(!this.#r)return;let[p,F]=this.#r;this.#r=null,F.addEventListener("focusin",()=>{p._focusEventsAllowed=!0},{once:!0}),F.focus()}#P(){window.addEventListener("keydown",this.#A),window.addEventListener("keyup",this.#M)}#$(){window.removeEventListener("keydown",this.#A),window.removeEventListener("keyup",this.#M)}#II(){document.addEventListener("copy",this.#v),document.addEventListener("cut",this.#C),document.addEventListener("paste",this.#E)}#lI(){document.removeEventListener("copy",this.#v),document.removeEventListener("cut",this.#C),document.removeEventListener("paste",this.#E)}addEditListeners(){this.#P(),this.#II()}removeEditListeners(){this.#$(),this.#lI()}copy(p){if(p.preventDefault(),this.#I?.commitOrRemove(),!this.hasSelection)return;let F=[];for(let a of this.#V){let u=a.serialize(!0);u&&F.push(u)}F.length!==0&&p.clipboardData.setData("application/pdfjs",JSON.stringify(F))}cut(p){this.copy(p),this.delete()}paste(p){p.preventDefault();let{clipboardData:F}=p;for(let Q of F.items)for(let o of this.#m)if(o.isHandlingMimeForPasting(Q.type)){o.paste(Q,this.currentLayer);return}let a=F.getData("application/pdfjs");if(!a)return;try{a=JSON.parse(a)}catch(Q){(0,b.warn)(`paste: "${Q.message}".`);return}if(!Array.isArray(a))return;this.unselectAll();let u=this.currentLayer;try{let Q=[];for(let H of a){let E=u.deserialize(H);if(!E)return;Q.push(E)}let o=()=>{for(let H of Q)this.#GI(H);this.#cI(Q)},y=()=>{for(let H of Q)H.remove()};this.addCommands({cmd:o,undo:y,mustExec:!0})}catch(Q){(0,b.warn)(`paste: "${Q.message}".`)}}keydown(p){!this.isShiftKeyDown&&p.key==="Shift"&&(this.isShiftKeyDown=!0),this.#R!==b.AnnotationEditorType.NONE&&!this.isEditorHandlingKeyboard&&V._keyboardManager.exec(this,p)}keyup(p){this.isShiftKeyDown&&p.key==="Shift"&&(this.isShiftKeyDown=!1,this.#p&&(this.#p=!1,this.#S("main_toolbar")))}onEditingAction({name:p}){switch(p){case"undo":case"redo":case"delete":case"selectAll":this[p]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}#i(p){Object.entries(p).some(([a,u])=>this.#D[a]!==u)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#D,p)}),this.#R===b.AnnotationEditorType.HIGHLIGHT&&p.hasSelectedEditor===!1&&this.#x([[b.AnnotationEditorParamsType.HIGHLIGHT_FREE,!0]]))}#x(p){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:p})}setEditingState(p){p?(this.#aI(),this.#II(),this.#i({isEditing:this.#R!==b.AnnotationEditorType.NONE,isEmpty:this.#T(),hasSomethingToUndo:this.#Z.hasSomethingToUndo(),hasSomethingToRedo:this.#Z.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#_(),this.#lI(),this.#i({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(p){if(!this.#m){this.#m=p;for(let F of this.#m)this.#x(F.defaultPropertiesToUpdate)}}getId(){return this.#u.id}get currentLayer(){return this.#G.get(this.#W)}getLayer(p){return this.#G.get(p)}get currentPageIndex(){return this.#W}addLayer(p){this.#G.set(p.pageIndex,p),this.#o?p.enable():p.disable()}removeLayer(p){this.#G.delete(p.pageIndex)}updateMode(p,F=null,a=!1){if(this.#R!==p){if(this.#R=p,p===b.AnnotationEditorType.NONE){this.setEditingState(!1),this.#tI();return}this.setEditingState(!0),this.#WI(),this.unselectAll();for(let u of this.#G.values())u.updateMode(p);if(!F&&a){this.addNewEditorFromKeyboard();return}if(F){for(let u of this.#l.values())if(u.annotationElementId===F){this.setSelected(u),u.enterInEditMode();break}}}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(p){p!==this.#R&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:p})}updateParams(p,F){if(this.#m){switch(p){case b.AnnotationEditorParamsType.CREATE:this.currentLayer.addNewEditor();return;case b.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:this.#J?.updateColor(F);break;case b.AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#w||=new Map).set(p,F),this.showAllEditors("highlight",F);break}for(let a of this.#V)a.updateParams(p,F);for(let a of this.#m)a.updateDefaultParams(p,F)}}showAllEditors(p,F,a=!1){for(let Q of this.#l.values())Q.editorType===p&&Q.show(F);(this.#w?.get(b.AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL)??!0)!==F&&this.#x([[b.AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL,F]])}enableWaiting(p=!1){if(this.#H!==p){this.#H=p;for(let F of this.#G.values())p?F.disableClick():F.enableClick(),F.div.classList.toggle("waiting",p)}}#WI(){if(!this.#o){this.#o=!0;for(let p of this.#G.values())p.enable();for(let p of this.#l.values())p.enable()}}#tI(){if(this.unselectAll(),this.#o){this.#o=!1;for(let p of this.#G.values())p.disable();for(let p of this.#l.values())p.disable()}}getEditors(p){let F=[];for(let a of this.#l.values())a.pageIndex===p&&F.push(a);return F}getEditor(p){return this.#l.get(p)}addEditor(p){this.#l.set(p.id,p)}removeEditor(p){p.div.contains(document.activeElement)&&(this.#Y&&clearTimeout(this.#Y),this.#Y=setTimeout(()=>{this.focusMainContainer(),this.#Y=null},0)),this.#l.delete(p.id),this.unselect(p),(!p.annotationElementId||!this.#a.has(p.annotationElementId))&&this.#d?.remove(p.id)}addDeletedAnnotationElement(p){this.#a.add(p.annotationElementId),this.addChangedExistingAnnotation(p),p.deleted=!0}isDeletedAnnotationElement(p){return this.#a.has(p)}removeDeletedAnnotationElement(p){this.#a.delete(p.annotationElementId),this.removeChangedExistingAnnotation(p),p.deleted=!1}#GI(p){let F=this.#G.get(p.pageIndex);F?F.addOrRebuild(p):(this.addEditor(p),this.addToAnnotationStorage(p))}setActiveEditor(p){this.#I!==p&&(this.#I=p,p&&this.#x(p.propertiesToUpdate))}get#nI(){let p=null;for(p of this.#V);return p}updateUI(p){this.#nI===p&&this.#x(p.propertiesToUpdate)}toggleSelected(p){if(this.#V.has(p)){this.#V.delete(p),p.unselect(),this.#i({hasSelectedEditor:this.hasSelection});return}this.#V.add(p),p.select(),this.#x(p.propertiesToUpdate),this.#i({hasSelectedEditor:!0})}setSelected(p){for(let F of this.#V)F!==p&&F.unselect();this.#V.clear(),this.#V.add(p),p.select(),this.#x(p.propertiesToUpdate),this.#i({hasSelectedEditor:!0})}isSelected(p){return this.#V.has(p)}get firstSelectedEditor(){return this.#V.values().next().value}unselect(p){p.unselect(),this.#V.delete(p),this.#i({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#V.size!==0}get isEnterHandled(){return this.#V.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#Z.undo(),this.#i({hasSomethingToUndo:this.#Z.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#T()})}redo(){this.#Z.redo(),this.#i({hasSomethingToUndo:!0,hasSomethingToRedo:this.#Z.hasSomethingToRedo(),isEmpty:this.#T()})}addCommands(p){this.#Z.add(p),this.#i({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#T()})}#T(){if(this.#l.size===0)return!0;if(this.#l.size===1)for(let p of this.#l.values())return p.isEmpty();return!1}delete(){if(this.commitOrRemove(),!this.hasSelection)return;let p=[...this.#V],F=()=>{for(let u of p)u.remove()},a=()=>{for(let u of p)this.#GI(u)};this.addCommands({cmd:F,undo:a,mustExec:!0})}commitOrRemove(){this.#I?.commitOrRemove()}hasSomethingToControl(){return this.#I||this.hasSelection}#cI(p){for(let F of this.#V)F.unselect();this.#V.clear();for(let F of p)F.isEmpty()||(this.#V.add(F),F.select());this.#i({hasSelectedEditor:this.hasSelection})}selectAll(){for(let p of this.#V)p.commit();this.#cI(this.#l.values())}unselectAll(){if(!(this.#I&&(this.#I.commitOrRemove(),this.#R!==b.AnnotationEditorType.NONE))&&this.hasSelection){for(let p of this.#V)p.unselect();this.#V.clear(),this.#i({hasSelectedEditor:!1})}}translateSelectedEditors(p,F,a=!1){if(a||this.commitOrRemove(),!this.hasSelection)return;this.#O[0]+=p,this.#O[1]+=F;let[u,Q]=this.#O,o=[...this.#V],y=1e3;this.#k&&clearTimeout(this.#k),this.#k=setTimeout(()=>{this.#k=null,this.#O[0]=this.#O[1]=0,this.addCommands({cmd:()=>{for(let H of o)this.#l.has(H.id)&&H.translateInPage(u,Q)},undo:()=>{for(let H of o)this.#l.has(H.id)&&H.translateInPage(-u,-Q)},mustExec:!1})},y);for(let H of o)H.translateInPage(p,F)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#n=new Map;for(let p of this.#V)this.#n.set(p,{savedX:p.x,savedY:p.y,savedPageIndex:p.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#n)return!1;this.disableUserSelect(!1);let p=this.#n;this.#n=null;let F=!1;for(let[{x:u,y:Q,pageIndex:o},y]of p)y.newX=u,y.newY=Q,y.newPageIndex=o,F||=u!==y.savedX||Q!==y.savedY||o!==y.savedPageIndex;if(!F)return!1;let a=(u,Q,o,y)=>{if(this.#l.has(u.id)){let H=this.#G.get(y);H?u._setParentAndPosition(H,Q,o):(u.pageIndex=y,u.x=Q,u.y=o)}};return this.addCommands({cmd:()=>{for(let[u,{newX:Q,newY:o,newPageIndex:y}]of p)a(u,Q,o,y)},undo:()=>{for(let[u,{savedX:Q,savedY:o,savedPageIndex:y}]of p)a(u,Q,o,y)},mustExec:!0}),!0}dragSelectedEditors(p,F){if(this.#n)for(let a of this.#n.keys())a.drag(p,F)}rebuild(p){if(p.parent===null){let F=this.getLayer(p.pageIndex);F?(F.changeParent(p),F.addOrRebuild(p)):(this.addEditor(p),this.addToAnnotationStorage(p),p.rebuild())}else p.parent.addOrRebuild(p)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#V.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(p){return this.#I===p}getActive(){return this.#I}getMode(){return this.#R}get imageManager(){return(0,b.shadow)(this,"imageManager",new s)}getSelectionBoxes(p){if(!p)return null;let F=document.getSelection();for(let E=0,C=F.rangeCount;E<C;E++)if(!p.contains(F.getRangeAt(E).commonAncestorContainer))return null;let{x:a,y:u,width:Q,height:o}=p.getBoundingClientRect(),y;switch(p.getAttribute("data-main-rotation")){case"90":y=(E,C,T,S)=>({x:(C-u)/o,y:1-(E+T-a)/Q,width:S/o,height:T/Q});break;case"180":y=(E,C,T,S)=>({x:1-(E+T-a)/Q,y:1-(C+S-u)/o,width:T/Q,height:S/o});break;case"270":y=(E,C,T,S)=>({x:1-(C+S-u)/o,y:(E-a)/Q,width:S/o,height:T/Q});break;default:y=(E,C,T,S)=>({x:(E-a)/Q,y:(C-u)/o,width:T/Q,height:S/o});break}let H=[];for(let E=0,C=F.rangeCount;E<C;E++){let T=F.getRangeAt(E);if(!T.collapsed)for(let{x:S,y:cI,width:hI,height:WI}of T.getClientRects())hI===0||WI===0||H.push(y(S,cI,hI,WI))}return H.length===0?null:H}addChangedExistingAnnotation({annotationElementId:p,id:F}){(this.#c||=new Map).set(p,F)}removeChangedExistingAnnotation({annotationElementId:p}){this.#c?.delete(p)}renderAnnotationElement(p){let F=this.#c?.get(p.data.id);if(!F)return;let a=this.#d.getRawValue(F);a&&(this.#R===b.AnnotationEditorType.NONE&&!a.hasBeenModified||a.renderAnnotationElement(p))}}},94:(I,G,l)=>{l.d(G,{PDFFetchStream:()=>n});var b=l(292),d=l(490);function e(m,h,V){return{method:"GET",headers:m,signal:V.signal,mode:"cors",credentials:h?"include":"same-origin",redirect:"follow"}}function t(m){let h=new Headers;for(let V in m){let X=m[V];X!==void 0&&h.append(V,X)}return h}function W(m){return m instanceof Uint8Array?m.buffer:m instanceof ArrayBuffer?m:((0,b.warn)(`getArrayBuffer - unexpected data format: ${m}`),new Uint8Array(m).buffer)}class n{constructor(h){this.source=h,this.isHttp=/^https?:/i.test(h.url),this.httpHeaders=this.isHttp&&h.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,b.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new s(this),this._fullRequestReader}getRangeReader(h,V){if(V<=this._progressiveDataLength)return null;let X=new N(this,h,V);return this._rangeRequestReaders.push(X),X}cancelAllRequests(h){this._fullRequestReader?.cancel(h);for(let V of this._rangeRequestReaders.slice(0))V.cancel(h)}}class s{constructor(h){this._stream=h,this._reader=null,this._loaded=0,this._filename=null;let V=h.source;this._withCredentials=V.withCredentials||!1,this._contentLength=V.length,this._headersCapability=Promise.withResolvers(),this._disableRange=V.disableRange||!1,this._rangeChunkSize=V.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!V.disableStream,this._isRangeSupported=!V.disableRange,this._headers=t(this._stream.httpHeaders);let X=V.url;fetch(X,e(this._headers,this._withCredentials,this._abortController)).then(p=>{if(!(0,d.validateResponseStatus)(p.status))throw(0,d.createResponseStatusError)(p.status,X);this._reader=p.body.getReader(),this._headersCapability.resolve();let F=Q=>p.headers.get(Q),{allowRangeRequests:a,suggestedLength:u}=(0,d.validateRangeRequestCapabilities)({getResponseHeader:F,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=u||this._contentLength,this._filename=(0,d.extractFilenameFromHeader)(F),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new b.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;let{value:h,done:V}=await this._reader.read();return V?{value:h,done:V}:(this._loaded+=h.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:W(h),done:!1})}cancel(h){this._reader?.cancel(h),this._abortController.abort()}}class N{constructor(h,V,X){this._stream=h,this._reader=null,this._loaded=0;let p=h.source;this._withCredentials=p.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!p.disableStream,this._abortController=new AbortController,this._headers=t(this._stream.httpHeaders),this._headers.append("Range",`bytes=${V}-${X-1}`);let F=p.url;fetch(F,e(this._headers,this._withCredentials,this._abortController)).then(a=>{if(!(0,d.validateResponseStatus)(a.status))throw(0,d.createResponseStatusError)(a.status,F);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;let{value:h,done:V}=await this._reader.read();return V?{value:h,done:V}:(this._loaded+=h.byteLength,this.onProgress?.({loaded:this._loaded}),{value:W(h),done:!1})}cancel(h){this._reader?.cancel(h),this._abortController.abort()}}},10:(I,G,l)=>{l.d(G,{FontFaceObject:()=>e,FontLoader:()=>d});var b=l(292);class d{#I=new Set;constructor({ownerDocument:W=globalThis.document,styleElement:n=null}){this._document=W,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(W){this.nativeFontFaces.add(W),this._document.fonts.add(W)}removeNativeFontFace(W){this.nativeFontFaces.delete(W),this._document.fonts.delete(W)}insertRule(W){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let n=this.styleElement.sheet;n.insertRule(W,n.cssRules.length)}clear(){for(let W of this.nativeFontFaces)this._document.fonts.delete(W);this.nativeFontFaces.clear(),this.#I.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:W,_inspectFont:n}){if(!(!W||this.#I.has(W.loadedName))){if((0,b.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:s,src:N,style:m}=W,h=new FontFace(s,N,m);this.addNativeFontFace(h);try{await h.load(),this.#I.add(s),n?.(W)}catch{(0,b.warn)(`Cannot load system font: ${W.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(h)}return}(0,b.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(W){if(W.attached||W.missingFile&&!W.systemFontInfo)return;if(W.attached=!0,W.systemFontInfo){await this.loadSystemFont(W);return}if(this.isFontLoadingAPISupported){let s=W.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(N){throw(0,b.warn)(`Failed to load font '${s.family}': '${N}'.`),W.disableFontFace=!0,N}}return}let n=W.createFontFaceRule();if(n){if(this.insertRule(n),this.isSyncFontLoadingSupported)return;await new Promise(s=>{let N=this._queueLoadingCallback(s);this._prepareFontLoadEvent(W,N)})}}get isFontLoadingAPISupported(){let W=!!this._document?.fonts;return(0,b.shadow)(this,"isFontLoadingAPISupported",W)}get isSyncFontLoadingSupported(){let W=!1;return(b.isNodeJS||typeof navigator<"u"&&typeof navigator?.userAgent=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(W=!0),(0,b.shadow)(this,"isSyncFontLoadingSupported",W)}_queueLoadingCallback(W){function n(){for((0,b.assert)(!N.done,"completeRequest() cannot be called twice."),N.done=!0;s.length>0&&s[0].done;){let m=s.shift();setTimeout(m.callback,0)}}let{loadingRequests:s}=this,N={done:!1,complete:n,callback:W};return s.push(N),N}get _loadTestFont(){let W=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,b.shadow)(this,"_loadTestFont",W)}_prepareFontLoadEvent(W,n){function s(S,cI){return S.charCodeAt(cI)<<24|S.charCodeAt(cI+1)<<16|S.charCodeAt(cI+2)<<8|S.charCodeAt(cI+3)&255}function N(S,cI,hI,WI){let VI=S.substring(0,cI),sI=S.substring(cI+hI);return VI+WI+sI}let m,h,V=this._document.createElement("canvas");V.width=1,V.height=1;let X=V.getContext("2d"),p=0;function F(S,cI){if(++p>30){(0,b.warn)("Load test font never loaded."),cI();return}if(X.font="30px "+S,X.fillText(".",0,20),X.getImageData(0,0,1,1).data[3]>0){cI();return}setTimeout(F.bind(null,S,cI))}let a=`lt${Date.now()}${this.loadTestFontId++}`,u=this._loadTestFont;u=N(u,976,a.length,a);let o=16,y=1482184792,H=s(u,o);for(m=0,h=a.length-3;m<h;m+=4)H=H-y+s(a,m)|0;m<a.length&&(H=H-y+s(a+"XXX",m)|0),u=N(u,o,4,(0,b.string32)(H));let E=`url(data:font/opentype;base64,${btoa(u)});`,C=`@font-face {font-family:"${a}";src:${E}}`;this.insertRule(C);let T=this._document.createElement("div");T.style.visibility="hidden",T.style.width=T.style.height="10px",T.style.position="absolute",T.style.top=T.style.left="0px";for(let S of[W.loadedName,a]){let cI=this._document.createElement("span");cI.textContent="Hi",cI.style.fontFamily=S,T.append(cI)}this._document.body.append(T),F(a,()=>{T.remove(),n.complete()})}}class e{constructor(W,{disableFontFace:n=!1,ignoreErrors:s=!1,inspectFont:N=null}){this.compiledGlyphs=Object.create(null);for(let m in W)this[m]=W[m];this.disableFontFace=n===!0,this.ignoreErrors=s===!0,this._inspectFont=N}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let W;if(!this.cssFontInfo)W=new FontFace(this.loadedName,this.data,{});else{let n={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(n.style=`oblique ${this.cssFontInfo.italicAngle}deg`),W=new FontFace(this.cssFontInfo.fontFamily,this.data,n)}return this._inspectFont?.(this),W}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;let W=(0,b.bytesToString)(this.data),n=`url(data:${this.mimetype};base64,${btoa(W)});`,s;if(!this.cssFontInfo)s=`@font-face {font-family:"${this.loadedName}";src:${n}}`;else{let N=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(N+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),s=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${N}src:${n}}`}return this._inspectFont?.(this,n),s}getPathGenerator(W,n){if(this.compiledGlyphs[n]!==void 0)return this.compiledGlyphs[n];let s;try{s=W.get(this.loadedName+"_path_"+n)}catch(m){if(!this.ignoreErrors)throw m;(0,b.warn)(`getPathGenerator - ignoring character: "${m}".`)}if(!Array.isArray(s)||s.length===0)return this.compiledGlyphs[n]=function(m,h){};let N=[];for(let m=0,h=s.length;m<h;)switch(s[m++]){case b.FontRenderOps.BEZIER_CURVE_TO:{let[V,X,p,F,a,u]=s.slice(m,m+6);N.push(Q=>Q.bezierCurveTo(V,X,p,F,a,u)),m+=6}break;case b.FontRenderOps.MOVE_TO:{let[V,X]=s.slice(m,m+2);N.push(p=>p.moveTo(V,X)),m+=2}break;case b.FontRenderOps.LINE_TO:{let[V,X]=s.slice(m,m+2);N.push(p=>p.lineTo(V,X)),m+=2}break;case b.FontRenderOps.QUADRATIC_CURVE_TO:{let[V,X,p,F]=s.slice(m,m+4);N.push(a=>a.quadraticCurveTo(V,X,p,F)),m+=4}break;case b.FontRenderOps.RESTORE:N.push(V=>V.restore());break;case b.FontRenderOps.SAVE:N.push(V=>V.save());break;case b.FontRenderOps.SCALE:(0,b.assert)(N.length===2,"Scale command is only valid at the third position.");break;case b.FontRenderOps.TRANSFORM:{let[V,X,p,F,a,u]=s.slice(m,m+6);N.push(Q=>Q.transform(V,X,p,F,a,u)),m+=6}break;case b.FontRenderOps.TRANSLATE:{let[V,X]=s.slice(m,m+2);N.push(p=>p.translate(V,X)),m+=2}break}return this.compiledGlyphs[n]=function(h,V){N[0](h),N[1](h),h.scale(V,-V);for(let X=2,p=N.length;X<p;X++)N[X](h)}}}},62:(I,G,l)=>{l.d(G,{Metadata:()=>d});var b=l(292);class d{#I;#l;constructor({parsedData:t,rawData:W}){this.#I=t,this.#l=W}getRaw(){return this.#l}get(t){return this.#I.get(t)??null}getAll(){return(0,b.objectFromMap)(this.#I)}has(t){return this.#I.has(t)}}},457:(I,G,l)=>{l.d(G,{PDFNetworkStream:()=>s});var b=l(292),d=l(490);let e=200,t=206;function W(h){let V=h.response;return typeof V!="string"?V:(0,b.stringToBytes)(V).buffer}class n{constructor(V,X={}){this.url=V,this.isHttp=/^https?:/i.test(V),this.httpHeaders=this.isHttp&&X.httpHeaders||Object.create(null),this.withCredentials=X.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(V,X,p){let F={begin:V,end:X};for(let a in p)F[a]=p[a];return this.request(F)}requestFull(V){return this.request(V)}request(V){let X=new XMLHttpRequest,p=this.currXhrId++,F=this.pendingRequests[p]={xhr:X};X.open("GET",this.url),X.withCredentials=this.withCredentials;for(let a in this.httpHeaders){let u=this.httpHeaders[a];u!==void 0&&X.setRequestHeader(a,u)}return this.isHttp&&"begin"in V&&"end"in V?(X.setRequestHeader("Range",`bytes=${V.begin}-${V.end-1}`),F.expectedStatus=t):F.expectedStatus=e,X.responseType="arraybuffer",V.onError&&(X.onerror=function(a){V.onError(X.status)}),X.onreadystatechange=this.onStateChange.bind(this,p),X.onprogress=this.onProgress.bind(this,p),F.onHeadersReceived=V.onHeadersReceived,F.onDone=V.onDone,F.onError=V.onError,F.onProgress=V.onProgress,X.send(null),p}onProgress(V,X){let p=this.pendingRequests[V];p&&p.onProgress?.(X)}onStateChange(V,X){let p=this.pendingRequests[V];if(!p)return;let F=p.xhr;if(F.readyState>=2&&p.onHeadersReceived&&(p.onHeadersReceived(),delete p.onHeadersReceived),F.readyState!==4||!(V in this.pendingRequests))return;if(delete this.pendingRequests[V],F.status===0&&this.isHttp){p.onError?.(F.status);return}let a=F.status||e;if(!(a===e&&p.expectedStatus===t)&&a!==p.expectedStatus){p.onError?.(F.status);return}let Q=W(F);if(a===t){let o=F.getResponseHeader("Content-Range"),y=/bytes (\d+)-(\d+)\/(\d+)/.exec(o);p.onDone({begin:parseInt(y[1],10),chunk:Q})}else Q?p.onDone({begin:0,chunk:Q}):p.onError?.(F.status)}getRequestXhr(V){return this.pendingRequests[V].xhr}isPendingRequest(V){return V in this.pendingRequests}abortRequest(V){let X=this.pendingRequests[V].xhr;delete this.pendingRequests[V],X.abort()}}class s{constructor(V){this._source=V,this._manager=new n(V.url,{httpHeaders:V.httpHeaders,withCredentials:V.withCredentials}),this._rangeChunkSize=V.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(V){let X=this._rangeRequestReaders.indexOf(V);X>=0&&this._rangeRequestReaders.splice(X,1)}getFullReader(){return(0,b.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new N(this._manager,this._source),this._fullRequestReader}getRangeReader(V,X){let p=new m(this._manager,V,X);return p.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(p),p}cancelAllRequests(V){this._fullRequestReader?.cancel(V);for(let X of this._rangeRequestReaders.slice(0))X.cancel(V)}}class N{constructor(V,X){this._manager=V;let p={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=X.url,this._fullRequestId=V.requestFull(p),this._headersReceivedCapability=Promise.withResolvers(),this._disableRange=X.disableRange||!1,this._contentLength=X.length,this._rangeChunkSize=X.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let V=this._fullRequestId,X=this._manager.getRequestXhr(V),p=u=>X.getResponseHeader(u),{allowRangeRequests:F,suggestedLength:a}=(0,d.validateRangeRequestCapabilities)({getResponseHeader:p,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});F&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=(0,d.extractFilenameFromHeader)(p),this._isRangeSupported&&this._manager.abortRequest(V),this._headersReceivedCapability.resolve()}_onDone(V){if(V&&(this._requests.length>0?this._requests.shift().resolve({value:V.chunk,done:!1}):this._cachedChunks.push(V.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let X of this._requests)X.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(V){this._storedError=(0,d.createResponseStatusError)(V,this._url),this._headersReceivedCapability.reject(this._storedError);for(let X of this._requests)X.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(V){this.onProgress?.({loaded:V.loaded,total:V.lengthComputable?V.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let V=Promise.withResolvers();return this._requests.push(V),V.promise}cancel(V){this._done=!0,this._headersReceivedCapability.reject(V);for(let X of this._requests)X.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class m{constructor(V,X,p){this._manager=V;let F={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=V.url,this._requestId=V.requestRange(X,p,F),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(V){let X=V.chunk;this._requests.length>0?this._requests.shift().resolve({value:X,done:!1}):this._queuedChunk=X,this._done=!0;for(let p of this._requests)p.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(V){this._storedError=(0,d.createResponseStatusError)(V,this._url);for(let X of this._requests)X.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(V){this.isStreamingSupported||this.onProgress?.({loaded:V.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let X=this._queuedChunk;return this._queuedChunk=null,{value:X,done:!1}}if(this._done)return{value:void 0,done:!0};let V=Promise.withResolvers();return this._requests.push(V),V.promise}cancel(V){this._done=!0;for(let X of this._requests)X.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},490:(I,G,l)=>{l.d(G,{createResponseStatusError:()=>n,extractFilenameFromHeader:()=>W,validateRangeRequestCapabilities:()=>t,validateResponseStatus:()=>s});var b=l(292);function d(N){let m=!0,h=V("filename\\*","i").exec(N);if(h){h=h[1];let o=a(h);return o=unescape(o),o=u(o),o=Q(o),p(o)}if(h=F(N),h){let o=Q(h);return p(o)}if(h=V("filename","i").exec(N),h){h=h[1];let o=a(h);return o=Q(o),p(o)}function V(o,y){return new RegExp("(?:^|;)\\s*"+o+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',y)}function X(o,y){if(o){if(!/^[\x00-\xFF]+$/.test(y))return y;try{let H=new TextDecoder(o,{fatal:!0}),E=(0,b.stringToBytes)(y);y=H.decode(E),m=!1}catch{}}return y}function p(o){return m&&/[\x80-\xff]/.test(o)&&(o=X("utf-8",o),m&&(o=X("iso-8859-1",o))),o}function F(o){let y=[],H,E=V("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(H=E.exec(o))!==null;){let[,T,S,cI]=H;if(T=parseInt(T,10),T in y){if(T===0)break;continue}y[T]=[S,cI]}let C=[];for(let T=0;T<y.length&&T in y;++T){let[S,cI]=y[T];cI=a(cI),S&&(cI=unescape(cI),T===0&&(cI=u(cI))),C.push(cI)}return C.join("")}function a(o){if(o.startsWith('"')){let y=o.slice(1).split('\\"');for(let H=0;H<y.length;++H){let E=y[H].indexOf('"');E!==-1&&(y[H]=y[H].slice(0,E),y.length=H+1),y[H]=y[H].replaceAll(/\\(.)/g,"$1")}o=y.join('"')}return o}function u(o){let y=o.indexOf("'");if(y===-1)return o;let H=o.slice(0,y),C=o.slice(y+1).replace(/^[^']*'/,"");return X(H,C)}function Q(o){return!o.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(o)?o:o.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(y,H,E,C){if(E==="q"||E==="Q")return C=C.replaceAll("_"," "),C=C.replaceAll(/=([0-9a-fA-F]{2})/g,function(T,S){return String.fromCharCode(parseInt(S,16))}),X(H,C);try{C=atob(C)}catch{}return X(H,C)})}return""}var e=l(419);function t({getResponseHeader:N,isHttp:m,rangeChunkSize:h,disableRange:V}){let X={allowRangeRequests:!1,suggestedLength:void 0},p=parseInt(N("Content-Length"),10);return!Number.isInteger(p)||(X.suggestedLength=p,p<=2*h)||V||!m||N("Accept-Ranges")!=="bytes"||(N("Content-Encoding")||"identity")!=="identity"||(X.allowRangeRequests=!0),X}function W(N){let m=N("Content-Disposition");if(m){let h=d(m);if(h.includes("%"))try{h=decodeURIComponent(h)}catch{}if((0,e.isPdfFile)(h))return h}return null}function n(N,m){return N===404||N===0&&m.startsWith("file:")?new b.MissingPDFException('Missing PDF "'+m+'".'):new b.UnexpectedResponseException(`Unexpected server response (${N}) while retrieving PDF "${m}".`,N)}function s(N){return N===200||N===206}},786:(I,G,l)=>{l.a(I,async(b,d)=>{try{let h=function(y){let H=N.parse(y);return H.protocol==="file:"||H.host?H:/^[a-z]:[/\\]/i.test(y)?N.parse(`file:///${y}`):(H.host||(H.protocol="file:"),H)},F=function(y,H){return{protocol:y.protocol,auth:y.auth,host:y.hostname,port:y.port,path:y.path,method:"GET",headers:H}};l.d(G,{PDFNodeStream:()=>V});var e=l(292),t=l(490);let W,n,s,N;e.isNodeJS&&(W=await import("../fs-RRG7ZNTQ.js"),n=await import("../http-JK7RNVAD.js"),s=await import("../https-DS7RZI5A.js"),N=await import("../url-D27SHYLX.js"));let m=/^file:\/\/\/[a-zA-Z]:\//;class V{constructor(H){this.source=H,this.url=h(H.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&H.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,e.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new Q(this):new a(this),this._fullRequestReader}getRangeReader(H,E){if(E<=this._progressiveDataLength)return null;let C=this.isFsUrl?new o(this,H,E):new u(this,H,E);return this._rangeRequestReaders.push(C),C}cancelAllRequests(H){this._fullRequestReader?.cancel(H);for(let E of this._rangeRequestReaders.slice(0))E.cancel(H)}}class X{constructor(H){this._url=H.url,this._done=!1,this._storedError=null,this.onProgress=null;let E=H.source;this._contentLength=E.length,this._loaded=0,this._filename=null,this._disableRange=E.disableRange||!1,this._rangeChunkSize=E.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!E.disableStream,this._isRangeSupported=!E.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let H=this._readableStream.read();return H===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=H.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(H).buffer,done:!1})}cancel(H){if(!this._readableStream){this._error(H);return}this._readableStream.destroy(H)}_error(H){this._storedError=H,this._readCapability.resolve()}_setReadableStream(H){this._readableStream=H,H.on("readable",()=>{this._readCapability.resolve()}),H.on("end",()=>{H.destroy(),this._done=!0,this._readCapability.resolve()}),H.on("error",E=>{this._error(E)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new e.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class p{constructor(H){this._url=H.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();let E=H.source;this._isStreamingSupported=!E.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let H=this._readableStream.read();return H===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=H.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(H).buffer,done:!1})}cancel(H){if(!this._readableStream){this._error(H);return}this._readableStream.destroy(H)}_error(H){this._storedError=H,this._readCapability.resolve()}_setReadableStream(H){this._readableStream=H,H.on("readable",()=>{this._readCapability.resolve()}),H.on("end",()=>{H.destroy(),this._done=!0,this._readCapability.resolve()}),H.on("error",E=>{this._error(E)}),this._storedError&&this._readableStream.destroy(this._storedError)}}class a extends X{constructor(H){super(H);let E=C=>{if(C.statusCode===404){let hI=new e.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=hI,this._headersCapability.reject(hI);return}this._headersCapability.resolve(),this._setReadableStream(C);let T=hI=>this._readableStream.headers[hI.toLowerCase()],{allowRangeRequests:S,suggestedLength:cI}=(0,t.validateRangeRequestCapabilities)({getResponseHeader:T,isHttp:H.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=S,this._contentLength=cI||this._contentLength,this._filename=(0,t.extractFilenameFromHeader)(T)};this._request=null,this._url.protocol==="http:"?this._request=n.request(F(this._url,H.httpHeaders),E):this._request=s.request(F(this._url,H.httpHeaders),E),this._request.on("error",C=>{this._storedError=C,this._headersCapability.reject(C)}),this._request.end()}}class u extends p{constructor(H,E,C){super(H),this._httpHeaders={};for(let S in H.httpHeaders){let cI=H.httpHeaders[S];cI!==void 0&&(this._httpHeaders[S]=cI)}this._httpHeaders.Range=`bytes=${E}-${C-1}`;let T=S=>{if(S.statusCode===404){let cI=new e.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=cI;return}this._setReadableStream(S)};this._request=null,this._url.protocol==="http:"?this._request=n.request(F(this._url,this._httpHeaders),T):this._request=s.request(F(this._url,this._httpHeaders),T),this._request.on("error",S=>{this._storedError=S}),this._request.end()}}class Q extends X{constructor(H){super(H);let E=decodeURIComponent(this._url.path);m.test(this._url.href)&&(E=E.replace(/^\//,"")),W.promises.lstat(E).then(C=>{this._contentLength=C.size,this._setReadableStream(W.createReadStream(E)),this._headersCapability.resolve()},C=>{C.code==="ENOENT"&&(C=new e.MissingPDFException(`Missing PDF "${E}".`)),this._storedError=C,this._headersCapability.reject(C)})}}class o extends p{constructor(H,E,C){super(H);let T=decodeURIComponent(this._url.path);m.test(this._url.href)&&(T=T.replace(/^\//,"")),this._setReadableStream(W.createReadStream(T,{start:E,end:C-1}))}}d()}catch(W){d(W)}},1)},573:(I,G,l)=>{l.a(I,async(b,d)=>{try{l.d(G,{NodeCMapReaderFactory:()=>V,NodeCanvasFactory:()=>h,NodeFilterFactory:()=>m,NodeStandardFontDataFactory:()=>X});var e=l(583),t=l(292);let W,n,s;if(t.isNodeJS){W=await import("../fs-RRG7ZNTQ.js");try{n=await import("../browser-IHSG2WM4.js")}catch{}try{s=await import("../dist-S7YNCPNV.js")}catch{}}let N=function(p){return W.promises.readFile(p).then(F=>new Uint8Array(F))};class m extends e.BaseFilterFactory{}class h extends e.BaseCanvasFactory{_createCanvas(F,a){return n.createCanvas(F,a)}}class V extends e.BaseCMapReaderFactory{_fetchData(F,a){return N(F).then(u=>({cMapData:u,compressionType:a}))}}class X extends e.BaseStandardFontDataFactory{_fetchData(F){return N(F)}}d()}catch(W){d(W)}},1)},626:(I,G,l)=>{l.d(G,{OptionalContentConfig:()=>W});var b=l(292),d=l(651);let e=Symbol("INTERNAL");class t{#I=!1;#l=!1;#G=!1;#b=!0;constructor(s,{name:N,intent:m,usage:h}){this.#I=!!(s&b.RenderingIntentFlag.DISPLAY),this.#l=!!(s&b.RenderingIntentFlag.PRINT),this.name=N,this.intent=m,this.usage=h}get visible(){if(this.#G)return this.#b;if(!this.#b)return!1;let{print:s,view:N}=this.usage;return this.#I?N?.viewState!=="OFF":this.#l?s?.printState!=="OFF":!0}_setVisible(s,N,m=!1){s!==e&&(0,b.unreachable)("Internal method `_setVisible` called."),this.#G=m,this.#b=N}}class W{#I=null;#l=new Map;#G=null;#b=null;constructor(s,N=b.RenderingIntentFlag.DISPLAY){if(this.renderingIntent=N,this.name=null,this.creator=null,s!==null){this.name=s.name,this.creator=s.creator,this.#b=s.order;for(let m of s.groups)this.#l.set(m.id,new t(N,m));if(s.baseState==="OFF")for(let m of this.#l.values())m._setVisible(e,!1);for(let m of s.on)this.#l.get(m)._setVisible(e,!0);for(let m of s.off)this.#l.get(m)._setVisible(e,!1);this.#G=this.getHash()}}#d(s){let N=s.length;if(N<2)return!0;let m=s[0];for(let h=1;h<N;h++){let V=s[h],X;if(Array.isArray(V))X=this.#d(V);else if(this.#l.has(V))X=this.#l.get(V).visible;else return(0,b.warn)(`Optional content group not found: ${V}`),!0;switch(m){case"And":if(!X)return!1;break;case"Or":if(X)return!0;break;case"Not":return!X;default:return!0}}return m==="And"}isVisible(s){if(this.#l.size===0)return!0;if(!s)return(0,b.info)("Optional content group not defined."),!0;if(s.type==="OCG")return this.#l.has(s.id)?this.#l.get(s.id).visible:((0,b.warn)(`Optional content group not found: ${s.id}`),!0);if(s.type==="OCMD"){if(s.expression)return this.#d(s.expression);if(!s.policy||s.policy==="AnyOn"){for(let N of s.ids){if(!this.#l.has(N))return(0,b.warn)(`Optional content group not found: ${N}`),!0;if(this.#l.get(N).visible)return!0}return!1}else if(s.policy==="AllOn"){for(let N of s.ids){if(!this.#l.has(N))return(0,b.warn)(`Optional content group not found: ${N}`),!0;if(!this.#l.get(N).visible)return!1}return!0}else if(s.policy==="AnyOff"){for(let N of s.ids){if(!this.#l.has(N))return(0,b.warn)(`Optional content group not found: ${N}`),!0;if(!this.#l.get(N).visible)return!0}return!1}else if(s.policy==="AllOff"){for(let N of s.ids){if(!this.#l.has(N))return(0,b.warn)(`Optional content group not found: ${N}`),!0;if(this.#l.get(N).visible)return!1}return!0}return(0,b.warn)(`Unknown optional content policy ${s.policy}.`),!0}return(0,b.warn)(`Unknown group type ${s.type}.`),!0}setVisibility(s,N=!0){let m=this.#l.get(s);if(!m){(0,b.warn)(`Optional content group not found: ${s}`);return}m._setVisible(e,!!N,!0),this.#I=null}setOCGState({state:s,preserveRB:N}){let m;for(let h of s){switch(h){case"ON":case"OFF":case"Toggle":m=h;continue}let V=this.#l.get(h);if(V)switch(m){case"ON":V._setVisible(e,!0);break;case"OFF":V._setVisible(e,!1);break;case"Toggle":V._setVisible(e,!V.visible);break}}this.#I=null}get hasInitialVisibility(){return this.#G===null||this.getHash()===this.#G}getOrder(){return this.#l.size?this.#b?this.#b.slice():[...this.#l.keys()]:null}getGroups(){return this.#l.size>0?(0,b.objectFromMap)(this.#l):null}getGroup(s){return this.#l.get(s)||null}getHash(){if(this.#I!==null)return this.#I;let s=new d.MurmurHash3_64;for(let[N,m]of this.#l)s.update(`${N}:${m.visible}`);return this.#I=s.hexdigest()}}},814:(I,G,l)=>{l.d(G,{cleanupTextLayer:()=>m,renderTextLayer:()=>a,updateTextLayer:()=>u});var b=l(292),d=l(419);let e=1e5,t=30,W=.8,n=new Map,s=null;function N(){if(!s){let Q=document.createElement("canvas");Q.className="hiddenCanvasElement",document.body.append(Q),s=Q.getContext("2d",{alpha:!1})}return s}function m(){s?.canvas.remove(),s=null}function h(Q){let o=n.get(Q);if(o)return o;let y=N(),H=y.font;y.canvas.width=y.canvas.height=t,y.font=`${t}px ${Q}`;let E=y.measureText(""),C=E.fontBoundingBoxAscent,T=Math.abs(E.fontBoundingBoxDescent);if(C){let cI=C/(C+T);return n.set(Q,cI),y.canvas.width=y.canvas.height=0,y.font=H,cI}y.strokeStyle="red",y.clearRect(0,0,t,t),y.strokeText("g",0,0);let S=y.getImageData(0,0,t,t).data;T=0;for(let cI=S.length-1-3;cI>=0;cI-=4)if(S[cI]>0){T=Math.ceil(cI/4/t);break}y.clearRect(0,0,t,t),y.strokeText("A",0,t),S=y.getImageData(0,0,t,t).data,C=0;for(let cI=0,hI=S.length;cI<hI;cI+=4)if(S[cI]>0){C=t-Math.floor(cI/4/t);break}if(y.canvas.width=y.canvas.height=0,y.font=H,C){let cI=C/(C+T);return n.set(Q,cI),cI}return n.set(Q,W),W}function V(Q,o,y){let H=document.createElement("span"),E={angle:0,canvasWidth:0,hasText:o.str!=="",hasEOL:o.hasEOL,fontSize:0};Q._textDivs.push(H);let C=b.Util.transform(Q._transform,o.transform),T=Math.atan2(C[1],C[0]),S=y[o.fontName];S.vertical&&(T+=Math.PI/2);let cI=Q._fontInspectorEnabled&&S.fontSubstitution||S.fontFamily,hI=Math.hypot(C[2],C[3]),WI=hI*h(cI),VI,sI;T===0?(VI=C[4],sI=C[5]-WI):(VI=C[4]+WI*Math.sin(T),sI=C[5]-WI*Math.cos(T));let ZI="calc(var(--scale-factor)*",dI=H.style;Q._container===Q._rootContainer?(dI.left=`${(100*VI/Q._pageWidth).toFixed(2)}%`,dI.top=`${(100*sI/Q._pageHeight).toFixed(2)}%`):(dI.left=`${ZI}${VI.toFixed(2)}px)`,dI.top=`${ZI}${sI.toFixed(2)}px)`),dI.fontSize=`${ZI}${hI.toFixed(2)}px)`,dI.fontFamily=cI,E.fontSize=hI,H.setAttribute("role","presentation"),H.textContent=o.str,H.dir=o.dir,Q._fontInspectorEnabled&&(H.dataset.fontName=S.fontSubstitutionLoadedName||o.fontName),T!==0&&(E.angle=T*(180/Math.PI));let pI=!1;if(o.str.length>1)pI=!0;else if(o.str!==" "&&o.transform[0]!==o.transform[3]){let yI=Math.abs(o.transform[0]),eI=Math.abs(o.transform[3]);yI!==eI&&Math.max(yI,eI)/Math.min(yI,eI)>1.5&&(pI=!0)}pI&&(E.canvasWidth=S.vertical?o.height:o.width),Q._textDivProperties.set(H,E),Q._isReadableStream&&Q._layoutText(H)}function X(Q){let{div:o,scale:y,properties:H,ctx:E,prevFontSize:C,prevFontFamily:T}=Q,{style:S}=o,cI="";if(H.canvasWidth!==0&&H.hasText){let{fontFamily:hI}=S,{canvasWidth:WI,fontSize:VI}=H;(C!==VI||T!==hI)&&(E.font=`${VI*y}px ${hI}`,Q.prevFontSize=VI,Q.prevFontFamily=hI);let{width:sI}=E.measureText(o.textContent);sI>0&&(cI=`scaleX(${WI*y/sI})`)}H.angle!==0&&(cI=`rotate(${H.angle}deg) ${cI}`),cI.length>0&&(S.transform=cI)}function p(Q){if(Q._canceled)return;let o=Q._textDivs,y=Q._capability;if(o.length>e){y.resolve();return}if(!Q._isReadableStream)for(let E of o)Q._layoutText(E);y.resolve()}class F{constructor({textContentSource:o,container:y,viewport:H,textDivs:E,textDivProperties:C,textContentItemsStr:T}){this._textContentSource=o,this._isReadableStream=o instanceof ReadableStream,this._container=this._rootContainer=y,this._textDivs=E||[],this._textContentItemsStr=T||[],this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._textDivProperties=C||new WeakMap,this._canceled=!1,this._capability=Promise.withResolvers(),this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:H.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:N()};let{pageWidth:S,pageHeight:cI,pageX:hI,pageY:WI}=H.rawDims;this._transform=[1,0,0,-1,-hI,WI+cI],this._pageWidth=S,this._pageHeight=cI,(0,d.setLayerDimensions)(y,H),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new b.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new b.AbortException("TextLayer task cancelled."))}_processItems(o,y){for(let H of o){if(H.str===void 0){if(H.type==="beginMarkedContentProps"||H.type==="beginMarkedContent"){let E=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),H.id!==null&&this._container.setAttribute("id",`${H.id}`),E.append(this._container)}else H.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(H.str),V(this,H,y)}}_layoutText(o){let y=this._layoutTextParams.properties=this._textDivProperties.get(o);if(this._layoutTextParams.div=o,X(this._layoutTextParams),y.hasText&&this._container.append(o),y.hasEOL){let H=document.createElement("br");H.setAttribute("role","presentation"),this._container.append(H)}}_render(){let{promise:o,resolve:y,reject:H}=Promise.withResolvers(),E=Object.create(null);if(this._isReadableStream){let C=()=>{this._reader.read().then(({value:T,done:S})=>{if(S){y();return}Object.assign(E,T.styles),this._processItems(T.items,E),C()},H)};this._reader=this._textContentSource.getReader(),C()}else if(this._textContentSource){let{items:C,styles:T}=this._textContentSource;this._processItems(C,T),y()}else throw new Error('No "textContentSource" parameter specified.');o.then(()=>{E=null,p(this)},this._capability.reject)}}function a(Q){let o=new F(Q);return o._render(),o}function u({container:Q,viewport:o,textDivs:y,textDivProperties:H,mustRotate:E=!0,mustRescale:C=!0}){if(E&&(0,d.setLayerDimensions)(Q,{rotation:o.rotation}),C){let T=N(),cI={prevFontSize:null,prevFontFamily:null,div:null,scale:o.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:T};for(let hI of y)cI.properties=H.get(hI),cI.div=hI,X(cI)}}},585:(I,G,l)=>{l.d(G,{PDFDataTransportStream:()=>e});var b=l(292),d=l(419);class e{constructor(s,{disableRange:N=!1,disableStream:m=!1}){(0,b.assert)(s,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');let{length:h,initialData:V,progressiveDone:X,contentDispositionFilename:p}=s;if(this._queuedChunks=[],this._progressiveDone=X,this._contentDispositionFilename=p,V?.length>0){let F=V instanceof Uint8Array&&V.byteLength===V.buffer.byteLength?V.buffer:new Uint8Array(V).buffer;this._queuedChunks.push(F)}this._pdfDataRangeTransport=s,this._isStreamingSupported=!m,this._isRangeSupported=!N,this._contentLength=h,this._fullRequestReader=null,this._rangeReaders=[],s.addRangeListener((F,a)=>{this._onReceiveData({begin:F,chunk:a})}),s.addProgressListener((F,a)=>{this._onProgress({loaded:F,total:a})}),s.addProgressiveReadListener(F=>{this._onReceiveData({chunk:F})}),s.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),s.transportReady()}_onReceiveData({begin:s,chunk:N}){let m=N instanceof Uint8Array&&N.byteLength===N.buffer.byteLength?N.buffer:new Uint8Array(N).buffer;if(s===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(m):this._queuedChunks.push(m);else{let h=this._rangeReaders.some(function(V){return V._begin!==s?!1:(V._enqueue(m),!0)});(0,b.assert)(h,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(s){s.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:s.loaded}):this._fullRequestReader?.onProgress?.({loaded:s.loaded,total:s.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(s){let N=this._rangeReaders.indexOf(s);N>=0&&this._rangeReaders.splice(N,1)}getFullReader(){(0,b.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let s=this._queuedChunks;return this._queuedChunks=null,new t(this,s,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(s,N){if(N<=this._progressiveDataLength)return null;let m=new W(this,s,N);return this._pdfDataRangeTransport.requestDataRange(s,N),this._rangeReaders.push(m),m}cancelAllRequests(s){this._fullRequestReader?.cancel(s);for(let N of this._rangeReaders.slice(0))N.cancel(s);this._pdfDataRangeTransport.abort()}}class t{constructor(s,N,m=!1,h=null){this._stream=s,this._done=m||!1,this._filename=(0,d.isPdfFile)(h)?h:null,this._queuedChunks=N||[],this._loaded=0;for(let V of this._queuedChunks)this._loaded+=V.byteLength;this._requests=[],this._headersReady=Promise.resolve(),s._fullRequestReader=this,this.onProgress=null}_enqueue(s){this._done||(this._requests.length>0?this._requests.shift().resolve({value:s,done:!1}):this._queuedChunks.push(s),this._loaded+=s.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let s=Promise.withResolvers();return this._requests.push(s),s.promise}cancel(s){this._done=!0;for(let N of this._requests)N.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class W{constructor(s,N,m){this._stream=s,this._begin=N,this._end=m,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(s){if(!this._done){if(this._requests.length===0)this._queuedChunk=s;else{this._requests.shift().resolve({value:s,done:!1});for(let m of this._requests)m.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){let N=this._queuedChunk;return this._queuedChunk=null,{value:N,done:!1}}if(this._done)return{value:void 0,done:!0};let s=Promise.withResolvers();return this._requests.push(s),s.promise}cancel(s){this._done=!0;for(let N of this._requests)N.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},164:(I,G,l)=>{l.d(G,{GlobalWorkerOptions:()=>b});class b{static#I=null;static#l="";static get workerPort(){return this.#I}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");this.#I=e}static get workerSrc(){return this.#l}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");this.#l=e}}},284:(I,G,l)=>{l.d(G,{XfaLayer:()=>d});var b=l(50);class d{static setupStorage(t,W,n,s,N){let m=s.getValue(W,{value:null});switch(n.name){case"textarea":if(m.value!==null&&(t.textContent=m.value),N==="print")break;t.addEventListener("input",h=>{s.setValue(W,{value:h.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(m.value===n.attributes.xfaOn?t.setAttribute("checked",!0):m.value===n.attributes.xfaOff&&t.removeAttribute("checked"),N==="print")break;t.addEventListener("change",h=>{s.setValue(W,{value:h.target.checked?h.target.getAttribute("xfaOn"):h.target.getAttribute("xfaOff")})})}else{if(m.value!==null&&t.setAttribute("value",m.value),N==="print")break;t.addEventListener("input",h=>{s.setValue(W,{value:h.target.value})})}break;case"select":if(m.value!==null){t.setAttribute("value",m.value);for(let h of n.children)h.attributes.value===m.value?h.attributes.selected=!0:h.attributes.hasOwnProperty("selected")&&delete h.attributes.selected}t.addEventListener("input",h=>{let V=h.target.options,X=V.selectedIndex===-1?"":V[V.selectedIndex].value;s.setValue(W,{value:X})});break}}static setAttributes({html:t,element:W,storage:n=null,intent:s,linkService:N}){let{attributes:m}=W,h=t instanceof HTMLAnchorElement;m.type==="radio"&&(m.name=`${m.name}-${s}`);for(let[V,X]of Object.entries(m))if(X!=null)switch(V){case"class":X.length&&t.setAttribute(V,X.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",X);break;case"style":Object.assign(t.style,X);break;case"textContent":t.textContent=X;break;default:(!h||V!=="href"&&V!=="newWindow")&&t.setAttribute(V,X)}h&&N.addLinkAttributes(t,m.href,m.newWindow),n&&m.dataId&&this.setupStorage(t,m.dataId,W,n)}static render(t){let W=t.annotationStorage,n=t.linkService,s=t.xfaHtml,N=t.intent||"display",m=document.createElement(s.name);s.attributes&&this.setAttributes({html:m,element:s,intent:N,linkService:n});let h=N!=="richText",V=t.div;if(V.append(m),t.viewport){let F=`matrix(${t.viewport.transform.join(",")})`;V.style.transform=F}h&&V.setAttribute("class","xfaLayer xfaFont");let X=[];if(s.children.length===0){if(s.value){let F=document.createTextNode(s.value);m.append(F),h&&b.XfaText.shouldBuildText(s.name)&&X.push(F)}return{textDivs:X}}let p=[[s,-1,m]];for(;p.length>0;){let[F,a,u]=p.at(-1);if(a+1===F.children.length){p.pop();continue}let Q=F.children[++p.at(-1)[1]];if(Q===null)continue;let{name:o}=Q;if(o==="#text"){let H=document.createTextNode(Q.value);X.push(H),u.append(H);continue}let y=Q?.attributes?.xmlns?document.createElementNS(Q.attributes.xmlns,o):document.createElement(o);if(u.append(y),Q.attributes&&this.setAttributes({html:y,element:Q,storage:W,intent:N,linkService:n}),Q.children?.length>0)p.push([Q,-1,y]);else if(Q.value){let H=document.createTextNode(Q.value);h&&b.XfaText.shouldBuildText(o)&&X.push(H),y.append(H)}}for(let F of V.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))F.setAttribute("readOnly",!0);return{textDivs:X}}static update(t){let W=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=W,t.div.hidden=!1}}},50:(I,G,l)=>{l.d(G,{XfaText:()=>b});class b{static textContent(e){let t=[],W={items:t,styles:Object.create(null)};function n(s){if(!s)return;let N=null,m=s.name;if(m==="#text")N=s.value;else if(b.shouldBuildText(m))s?.attributes?.textContent?N=s.attributes.textContent:s.value&&(N=s.value);else return;if(N!==null&&t.push({str:N}),!!s.children)for(let h of s.children)n(h)}return n(e),W}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}},228:(I,G,l)=>{l.a(I,async(b,d)=>{try{l.d(G,{AbortException:()=>e.AbortException,AnnotationEditorLayer:()=>s.AnnotationEditorLayer,AnnotationEditorParamsType:()=>e.AnnotationEditorParamsType,AnnotationEditorType:()=>e.AnnotationEditorType,AnnotationEditorUIManager:()=>N.AnnotationEditorUIManager,AnnotationLayer:()=>m.AnnotationLayer,AnnotationMode:()=>e.AnnotationMode,CMapCompressionType:()=>e.CMapCompressionType,ColorPicker:()=>h.ColorPicker,DOMSVGFactory:()=>W.DOMSVGFactory,DrawLayer:()=>V.DrawLayer,FeatureTest:()=>e.FeatureTest,GlobalWorkerOptions:()=>X.GlobalWorkerOptions,ImageKind:()=>e.ImageKind,InvalidPDFException:()=>e.InvalidPDFException,MissingPDFException:()=>e.MissingPDFException,OPS:()=>e.OPS,Outliner:()=>p.Outliner,PDFDataRangeTransport:()=>t.PDFDataRangeTransport,PDFDateString:()=>W.PDFDateString,PDFWorker:()=>t.PDFWorker,PasswordResponses:()=>e.PasswordResponses,PermissionFlag:()=>e.PermissionFlag,PixelsPerInch:()=>W.PixelsPerInch,RenderingCancelledException:()=>W.RenderingCancelledException,UnexpectedResponseException:()=>e.UnexpectedResponseException,Util:()=>e.Util,VerbosityLevel:()=>e.VerbosityLevel,XfaLayer:()=>F.XfaLayer,build:()=>t.build,createValidAbsoluteUrl:()=>e.createValidAbsoluteUrl,fetchData:()=>W.fetchData,getDocument:()=>t.getDocument,getFilenameFromUrl:()=>W.getFilenameFromUrl,getPdfFilenameFromUrl:()=>W.getPdfFilenameFromUrl,getXfaPageViewport:()=>W.getXfaPageViewport,isDataScheme:()=>W.isDataScheme,isPdfFile:()=>W.isPdfFile,noContextMenu:()=>W.noContextMenu,normalizeUnicode:()=>e.normalizeUnicode,renderTextLayer:()=>n.renderTextLayer,setLayerDimensions:()=>W.setLayerDimensions,shadow:()=>e.shadow,updateTextLayer:()=>n.updateTextLayer,version:()=>t.version});var e=l(292),t=l(831),W=l(419),n=l(814),s=l(731),N=l(830),m=l(976),h=l(259),V=l(47),X=l(164),p=l(61),F=l(284),a=b([t]);t=(a.then?(await a)():a)[0];let u="4.2.67",Q="49b388101";d()}catch(u){d(u)}})},178:(I,G,l)=>{l.d(G,{MessageHandler:()=>W});var b=l(292);let d={UNKNOWN:0,DATA:1,ERROR:2},e={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function t(n){switch(n instanceof Error||typeof n=="object"&&n!==null||(0,b.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),n.name){case"AbortException":return new b.AbortException(n.message);case"MissingPDFException":return new b.MissingPDFException(n.message);case"PasswordException":return new b.PasswordException(n.message,n.code);case"UnexpectedResponseException":return new b.UnexpectedResponseException(n.message,n.status);case"UnknownErrorException":return new b.UnknownErrorException(n.message,n.details);default:return new b.UnknownErrorException(n.message,n.toString())}}class W{constructor(s,N,m){this.sourceName=s,this.targetName=N,this.comObj=m,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=h=>{let V=h.data;if(V.targetName!==this.sourceName)return;if(V.stream){this.#l(V);return}if(V.callback){let p=V.callbackId,F=this.callbackCapabilities[p];if(!F)throw new Error(`Cannot resolve callback ${p}`);if(delete this.callbackCapabilities[p],V.callback===d.DATA)F.resolve(V.data);else if(V.callback===d.ERROR)F.reject(t(V.reason));else throw new Error("Unexpected callback case");return}let X=this.actionHandler[V.action];if(!X)throw new Error(`Unknown action from worker: ${V.action}`);if(V.callbackId){let p=this.sourceName,F=V.sourceName;new Promise(function(a){a(X(V.data))}).then(function(a){m.postMessage({sourceName:p,targetName:F,callback:d.DATA,callbackId:V.callbackId,data:a})},function(a){m.postMessage({sourceName:p,targetName:F,callback:d.ERROR,callbackId:V.callbackId,reason:t(a)})});return}if(V.streamId){this.#I(V);return}X(V.data)},m.addEventListener("message",this._onComObjOnMessage)}on(s,N){let m=this.actionHandler;if(m[s])throw new Error(`There is already an actionName called "${s}"`);m[s]=N}send(s,N,m){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:s,data:N},m)}sendWithPromise(s,N,m){let h=this.callbackId++,V=Promise.withResolvers();this.callbackCapabilities[h]=V;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:s,callbackId:h,data:N},m)}catch(X){V.reject(X)}return V.promise}sendWithStream(s,N,m,h){let V=this.streamId++,X=this.sourceName,p=this.targetName,F=this.comObj;return new ReadableStream({start:a=>{let u=Promise.withResolvers();return this.streamControllers[V]={controller:a,startCall:u,pullCall:null,cancelCall:null,isClosed:!1},F.postMessage({sourceName:X,targetName:p,action:s,streamId:V,data:N,desiredSize:a.desiredSize},h),u.promise},pull:a=>{let u=Promise.withResolvers();return this.streamControllers[V].pullCall=u,F.postMessage({sourceName:X,targetName:p,stream:e.PULL,streamId:V,desiredSize:a.desiredSize}),u.promise},cancel:a=>{(0,b.assert)(a instanceof Error,"cancel must have a valid reason");let u=Promise.withResolvers();return this.streamControllers[V].cancelCall=u,this.streamControllers[V].isClosed=!0,F.postMessage({sourceName:X,targetName:p,stream:e.CANCEL,streamId:V,reason:t(a)}),u.promise}},m)}#I(s){let N=s.streamId,m=this.sourceName,h=s.sourceName,V=this.comObj,X=this,p=this.actionHandler[s.action],F={enqueue(a,u=1,Q){if(this.isCancelled)return;let o=this.desiredSize;this.desiredSize-=u,o>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),V.postMessage({sourceName:m,targetName:h,stream:e.ENQUEUE,streamId:N,chunk:a},Q)},close(){this.isCancelled||(this.isCancelled=!0,V.postMessage({sourceName:m,targetName:h,stream:e.CLOSE,streamId:N}),delete X.streamSinks[N])},error(a){(0,b.assert)(a instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,V.postMessage({sourceName:m,targetName:h,stream:e.ERROR,streamId:N,reason:t(a)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:s.desiredSize,ready:null};F.sinkCapability.resolve(),F.ready=F.sinkCapability.promise,this.streamSinks[N]=F,new Promise(function(a){a(p(s.data,F))}).then(function(){V.postMessage({sourceName:m,targetName:h,stream:e.START_COMPLETE,streamId:N,success:!0})},function(a){V.postMessage({sourceName:m,targetName:h,stream:e.START_COMPLETE,streamId:N,reason:t(a)})})}#l(s){let N=s.streamId,m=this.sourceName,h=s.sourceName,V=this.comObj,X=this.streamControllers[N],p=this.streamSinks[N];switch(s.stream){case e.START_COMPLETE:s.success?X.startCall.resolve():X.startCall.reject(t(s.reason));break;case e.PULL_COMPLETE:s.success?X.pullCall.resolve():X.pullCall.reject(t(s.reason));break;case e.PULL:if(!p){V.postMessage({sourceName:m,targetName:h,stream:e.PULL_COMPLETE,streamId:N,success:!0});break}p.desiredSize<=0&&s.desiredSize>0&&p.sinkCapability.resolve(),p.desiredSize=s.desiredSize,new Promise(function(F){F(p.onPull?.())}).then(function(){V.postMessage({sourceName:m,targetName:h,stream:e.PULL_COMPLETE,streamId:N,success:!0})},function(F){V.postMessage({sourceName:m,targetName:h,stream:e.PULL_COMPLETE,streamId:N,reason:t(F)})});break;case e.ENQUEUE:if((0,b.assert)(X,"enqueue should have stream controller"),X.isClosed)break;X.controller.enqueue(s.chunk);break;case e.CLOSE:if((0,b.assert)(X,"close should have stream controller"),X.isClosed)break;X.isClosed=!0,X.controller.close(),this.#G(X,N);break;case e.ERROR:(0,b.assert)(X,"error should have stream controller"),X.controller.error(t(s.reason)),this.#G(X,N);break;case e.CANCEL_COMPLETE:s.success?X.cancelCall.resolve():X.cancelCall.reject(t(s.reason)),this.#G(X,N);break;case e.CANCEL:if(!p)break;new Promise(function(F){F(p.onCancel?.(t(s.reason)))}).then(function(){V.postMessage({sourceName:m,targetName:h,stream:e.CANCEL_COMPLETE,streamId:N,success:!0})},function(F){V.postMessage({sourceName:m,targetName:h,stream:e.CANCEL_COMPLETE,streamId:N,reason:t(F)})}),p.sinkCapability.reject(t(s.reason)),p.isCancelled=!0,delete this.streamSinks[N];break;default:throw new Error("Unexpected stream case")}}async#G(s,N){await Promise.allSettled([s.startCall?.promise,s.pullCall?.promise,s.cancelCall?.promise]),delete this.streamControllers[N]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}},651:(I,G,l)=>{l.d(G,{MurmurHash3_64:()=>t});let b=3285377520,d=4294901760,e=65535;class t{constructor(n){this.h1=n?n&4294967295:b,this.h2=n?n&4294967295:b}update(n){let s,N;if(typeof n=="string"){s=new Uint8Array(n.length*2),N=0;for(let H=0,E=n.length;H<E;H++){let C=n.charCodeAt(H);C<=255?s[N++]=C:(s[N++]=C>>>8,s[N++]=C&255)}}else if(ArrayBuffer.isView(n))s=n.slice(),N=s.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");let m=N>>2,h=N-m*4,V=new Uint32Array(s.buffer,0,m),X=0,p=0,F=this.h1,a=this.h2,u=3432918353,Q=461845907,o=u&e,y=Q&e;for(let H=0;H<m;H++)H&1?(X=V[H],X=X*u&d|X*o&e,X=X<<15|X>>>17,X=X*Q&d|X*y&e,F^=X,F=F<<13|F>>>19,F=F*5+3864292196):(p=V[H],p=p*u&d|p*o&e,p=p<<15|p>>>17,p=p*Q&d|p*y&e,a^=p,a=a<<13|a>>>19,a=a*5+3864292196);switch(X=0,h){case 3:X^=s[m*4+2]<<16;case 2:X^=s[m*4+1]<<8;case 1:X^=s[m*4],X=X*u&d|X*o&e,X=X<<15|X>>>17,X=X*Q&d|X*y&e,m&1?F^=X:a^=X}this.h1=F,this.h2=a}hexdigest(){let n=this.h1,s=this.h2;return n^=s>>>1,n=n*3981806797&d|n*36045&e,s=s*4283543511&d|((s<<16|n>>>16)*2950163797&d)>>>16,n^=s>>>1,n=n*444984403&d|n*60499&e,s=s*3301882366&d|((s<<16|n>>>16)*3120437893&d)>>>16,n^=s>>>1,(n>>>0).toString(16).padStart(8,"0")+(s>>>0).toString(16).padStart(8,"0")}}},292:(I,G,l)=>{l.d(G,{AbortException:()=>k,AnnotationBorderStyleType:()=>H,AnnotationEditorParamsType:()=>X,AnnotationEditorPrefix:()=>h,AnnotationEditorType:()=>V,AnnotationMode:()=>m,AnnotationPrefix:()=>nl,AnnotationType:()=>u,BaseException:()=>JI,CMapCompressionType:()=>cI,FONT_IDENTITY_MATRIX:()=>e,FeatureTest:()=>tI,FontRenderOps:()=>ol,FormatError:()=>U,IDENTITY_MATRIX:()=>d,ImageKind:()=>a,InvalidPDFException:()=>L,LINE_FACTOR:()=>W,MAX_IMAGE_SIZE_TO_CACHE:()=>t,MissingPDFException:()=>bI,OPS:()=>hI,PasswordException:()=>UI,PasswordResponses:()=>WI,PermissionFlag:()=>p,RenderingIntentFlag:()=>N,TextRenderingMode:()=>F,UnexpectedResponseException:()=>FI,UnknownErrorException:()=>zI,Util:()=>B,VerbosityLevel:()=>S,assert:()=>eI,bytesToString:()=>w,createValidAbsoluteUrl:()=>YI,getUuid:()=>Il,getVerbosityLevel:()=>ZI,info:()=>dI,isNodeJS:()=>b,normalizeUnicode:()=>TI,objectFromMap:()=>K,setVerbosityLevel:()=>sI,shadow:()=>$,string32:()=>A,stringToBytes:()=>r,unreachable:()=>yI,warn:()=>pI});let b=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),d=[1,0,0,1,0,0],e=[.001,0,0,.001,0,0],t=1e7,W=1.35,s=.35/W,N={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256},m={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},h="pdfjs_internal_editor_",V={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},X={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35},p={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},F={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},a={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},u={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Q={GROUP:"Group",REPLY:"R"},o={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512},y={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864},H={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},E={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"},C={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"},T={O:"PageOpen",C:"PageClose"},S={ERRORS:0,WARNINGS:1,INFOS:5},cI={NONE:0,BINARY:1},hI={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},WI={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},VI=S.WARNINGS;function sI(PI){Number.isInteger(PI)&&(VI=PI)}function ZI(){return VI}function dI(PI){VI>=S.INFOS&&console.log(`Info: ${PI}`)}function pI(PI){VI>=S.WARNINGS&&console.log(`Warning: ${PI}`)}function yI(PI){throw new Error(PI)}function eI(PI,KI){PI||yI(KI)}function HI(PI){switch(PI?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function YI(PI,KI=null,jI=null){if(!PI)return null;try{if(jI&&typeof PI=="string"&&(jI.addDefaultProtocol&&PI.startsWith("www.")&&PI.match(/\./g)?.length>=2&&(PI=`http://${PI}`),jI.tryConvertEncoding))try{PI=QI(PI)}catch{}let Wl=KI?new URL(PI,KI):new URL(PI);if(HI(Wl))return Wl}catch{}return null}function $(PI,KI,jI,Wl=!1){return Object.defineProperty(PI,KI,{value:jI,enumerable:!Wl,configurable:!0,writable:!1}),jI}let JI=function(){function KI(jI,Wl){this.constructor===KI&&yI("Cannot initialize BaseException."),this.message=jI,this.name=Wl}return KI.prototype=new Error,KI.constructor=KI,KI}();class UI extends JI{constructor(KI,jI){super(KI,"PasswordException"),this.code=jI}}class zI extends JI{constructor(KI,jI){super(KI,"UnknownErrorException"),this.details=jI}}class L extends JI{constructor(KI){super(KI,"InvalidPDFException")}}class bI extends JI{constructor(KI){super(KI,"MissingPDFException")}}class FI extends JI{constructor(KI,jI){super(KI,"UnexpectedResponseException"),this.status=jI}}class U extends JI{constructor(KI){super(KI,"FormatError")}}class k extends JI{constructor(KI){super(KI,"AbortException")}}function w(PI){(typeof PI!="object"||PI?.length===void 0)&&yI("Invalid argument for bytesToString");let KI=PI.length,jI=8192;if(KI<jI)return String.fromCharCode.apply(null,PI);let Wl=[];for(let wl=0;wl<KI;wl+=jI){let Ol=Math.min(wl+jI,KI),jl=PI.subarray(wl,Ol);Wl.push(String.fromCharCode.apply(null,jl))}return Wl.join("")}function r(PI){typeof PI!="string"&&yI("Invalid argument for stringToBytes");let KI=PI.length,jI=new Uint8Array(KI);for(let Wl=0;Wl<KI;++Wl)jI[Wl]=PI.charCodeAt(Wl)&255;return jI}function A(PI){return String.fromCharCode(PI>>24&255,PI>>16&255,PI>>8&255,PI&255)}function O(PI){return Object.keys(PI).length}function K(PI){let KI=Object.create(null);for(let[jI,Wl]of PI)KI[jI]=Wl;return KI}function q(){let PI=new Uint8Array(4);return PI[0]=1,new Uint32Array(PI.buffer,0,1)[0]===1}function GI(){try{return new Function(""),!0}catch{return!1}}class tI{static get isLittleEndian(){return $(this,"isLittleEndian",q())}static get isEvalSupported(){return $(this,"isEvalSupported",GI())}static get isOffscreenCanvasSupported(){return $(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator<"u"&&typeof navigator?.platform=="string"?$(this,"platform",{isMac:navigator.platform.includes("Mac")}):$(this,"platform",{isMac:!1})}static get isCSSRoundSupported(){return $(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}let iI=Array.from(Array(256).keys(),PI=>PI.toString(16).padStart(2,"0"));class B{static makeHexColor(KI,jI,Wl){return`#${iI[KI]}${iI[jI]}${iI[Wl]}`}static scaleMinMax(KI,jI){let Wl;KI[0]?(KI[0]<0&&(Wl=jI[0],jI[0]=jI[2],jI[2]=Wl),jI[0]*=KI[0],jI[2]*=KI[0],KI[3]<0&&(Wl=jI[1],jI[1]=jI[3],jI[3]=Wl),jI[1]*=KI[3],jI[3]*=KI[3]):(Wl=jI[0],jI[0]=jI[1],jI[1]=Wl,Wl=jI[2],jI[2]=jI[3],jI[3]=Wl,KI[1]<0&&(Wl=jI[1],jI[1]=jI[3],jI[3]=Wl),jI[1]*=KI[1],jI[3]*=KI[1],KI[2]<0&&(Wl=jI[0],jI[0]=jI[2],jI[2]=Wl),jI[0]*=KI[2],jI[2]*=KI[2]),jI[0]+=KI[4],jI[1]+=KI[5],jI[2]+=KI[4],jI[3]+=KI[5]}static transform(KI,jI){return[KI[0]*jI[0]+KI[2]*jI[1],KI[1]*jI[0]+KI[3]*jI[1],KI[0]*jI[2]+KI[2]*jI[3],KI[1]*jI[2]+KI[3]*jI[3],KI[0]*jI[4]+KI[2]*jI[5]+KI[4],KI[1]*jI[4]+KI[3]*jI[5]+KI[5]]}static applyTransform(KI,jI){let Wl=KI[0]*jI[0]+KI[1]*jI[2]+jI[4],wl=KI[0]*jI[1]+KI[1]*jI[3]+jI[5];return[Wl,wl]}static applyInverseTransform(KI,jI){let Wl=jI[0]*jI[3]-jI[1]*jI[2],wl=(KI[0]*jI[3]-KI[1]*jI[2]+jI[2]*jI[5]-jI[4]*jI[3])/Wl,Ol=(-KI[0]*jI[1]+KI[1]*jI[0]+jI[4]*jI[1]-jI[5]*jI[0])/Wl;return[wl,Ol]}static getAxialAlignedBoundingBox(KI,jI){let Wl=this.applyTransform(KI,jI),wl=this.applyTransform(KI.slice(2,4),jI),Ol=this.applyTransform([KI[0],KI[3]],jI),jl=this.applyTransform([KI[2],KI[1]],jI);return[Math.min(Wl[0],wl[0],Ol[0],jl[0]),Math.min(Wl[1],wl[1],Ol[1],jl[1]),Math.max(Wl[0],wl[0],Ol[0],jl[0]),Math.max(Wl[1],wl[1],Ol[1],jl[1])]}static inverseTransform(KI){let jI=KI[0]*KI[3]-KI[1]*KI[2];return[KI[3]/jI,-KI[1]/jI,-KI[2]/jI,KI[0]/jI,(KI[2]*KI[5]-KI[4]*KI[3])/jI,(KI[4]*KI[1]-KI[5]*KI[0])/jI]}static singularValueDecompose2dScale(KI){let jI=[KI[0],KI[2],KI[1],KI[3]],Wl=KI[0]*jI[0]+KI[1]*jI[2],wl=KI[0]*jI[1]+KI[1]*jI[3],Ol=KI[2]*jI[0]+KI[3]*jI[2],jl=KI[2]*jI[1]+KI[3]*jI[3],NG=(Wl+jl)/2,Fl=Math.sqrt((Wl+jl)**2-4*(Wl*jl-Ol*wl))/2,Dl=NG+Fl||1,XG=NG-Fl||1;return[Math.sqrt(Dl),Math.sqrt(XG)]}static normalizeRect(KI){let jI=KI.slice(0);return KI[0]>KI[2]&&(jI[0]=KI[2],jI[2]=KI[0]),KI[1]>KI[3]&&(jI[1]=KI[3],jI[3]=KI[1]),jI}static intersect(KI,jI){let Wl=Math.max(Math.min(KI[0],KI[2]),Math.min(jI[0],jI[2])),wl=Math.min(Math.max(KI[0],KI[2]),Math.max(jI[0],jI[2]));if(Wl>wl)return null;let Ol=Math.max(Math.min(KI[1],KI[3]),Math.min(jI[1],jI[3])),jl=Math.min(Math.max(KI[1],KI[3]),Math.max(jI[1],jI[3]));return Ol>jl?null:[Wl,Ol,wl,jl]}static#I(KI,jI,Wl,wl,Ol,jl,NG,Fl,Dl,XG){if(Dl<=0||Dl>=1)return;let LG=1-Dl,lc=Dl*Dl,DG=lc*Dl,Wc=LG*(LG*(LG*KI+3*Dl*jI)+3*lc*Wl)+DG*wl,EG=LG*(LG*(LG*Ol+3*Dl*jl)+3*lc*NG)+DG*Fl;XG[0]=Math.min(XG[0],Wc),XG[1]=Math.min(XG[1],EG),XG[2]=Math.max(XG[2],Wc),XG[3]=Math.max(XG[3],EG)}static#l(KI,jI,Wl,wl,Ol,jl,NG,Fl,Dl,XG,LG,lc){if(Math.abs(Dl)<1e-12){Math.abs(XG)>=1e-12&&this.#I(KI,jI,Wl,wl,Ol,jl,NG,Fl,-LG/XG,lc);return}let DG=XG**2-4*LG*Dl;if(DG<0)return;let Wc=Math.sqrt(DG),EG=2*Dl;this.#I(KI,jI,Wl,wl,Ol,jl,NG,Fl,(-XG+Wc)/EG,lc),this.#I(KI,jI,Wl,wl,Ol,jl,NG,Fl,(-XG-Wc)/EG,lc)}static bezierBoundingBox(KI,jI,Wl,wl,Ol,jl,NG,Fl,Dl){return Dl?(Dl[0]=Math.min(Dl[0],KI,NG),Dl[1]=Math.min(Dl[1],jI,Fl),Dl[2]=Math.max(Dl[2],KI,NG),Dl[3]=Math.max(Dl[3],jI,Fl)):Dl=[Math.min(KI,NG),Math.min(jI,Fl),Math.max(KI,NG),Math.max(jI,Fl)],this.#l(KI,Wl,Ol,NG,jI,wl,jl,Fl,3*(-KI+3*(Wl-Ol)+NG),6*(KI-2*Wl+Ol),3*(Wl-KI),Dl),this.#l(KI,Wl,Ol,NG,jI,wl,jl,Fl,3*(-jI+3*(wl-jl)+Fl),6*(jI-2*wl+jl),3*(wl-jI),Dl),Dl}}let aI=null;function lI(PI){if(PI[0]>="\xEF"){let jI;if(PI[0]==="\xFE"&&PI[1]==="\xFF"?(jI="utf-16be",PI.length%2===1&&(PI=PI.slice(0,-1))):PI[0]==="\xFF"&&PI[1]==="\xFE"?(jI="utf-16le",PI.length%2===1&&(PI=PI.slice(0,-1))):PI[0]==="\xEF"&&PI[1]==="\xBB"&&PI[2]==="\xBF"&&(jI="utf-8"),jI)try{let Wl=new TextDecoder(jI,{fatal:!0}),wl=r(PI),Ol=Wl.decode(wl);return Ol.includes("\x1B")?Ol.replaceAll(/\x1b[^\x1b]*(?:\x1b|$)/g,""):Ol}catch(Wl){pI(`stringToPDFString: "${Wl}".`)}}let KI=[];for(let jI=0,Wl=PI.length;jI<Wl;jI++){let wl=PI.charCodeAt(jI);if(wl===27){for(;++jI<Wl&&PI.charCodeAt(jI)!==27;);continue}let Ol=aI[wl];KI.push(Ol?String.fromCharCode(Ol):PI.charAt(jI))}return KI.join("")}function QI(PI){return decodeURIComponent(escape(PI))}function vI(PI){return unescape(encodeURIComponent(PI))}function OI(PI,KI){if(PI.length!==KI.length)return!1;for(let jI=0,Wl=PI.length;jI<Wl;jI++)if(PI[jI]!==KI[jI])return!1;return!0}function uI(PI=new Date){return[PI.getUTCFullYear().toString(),(PI.getUTCMonth()+1).toString().padStart(2,"0"),PI.getUTCDate().toString().padStart(2,"0"),PI.getUTCHours().toString().padStart(2,"0"),PI.getUTCMinutes().toString().padStart(2,"0"),PI.getUTCSeconds().toString().padStart(2,"0")].join("")}let wI=null,kI=null;function TI(PI){return wI||(wI=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,kI=new Map([["\uFB05","\u017Ft"]])),PI.replaceAll(wI,(KI,jI,Wl)=>jI?jI.normalize("NFKC"):kI.get(Wl))}function Il(){if(typeof crypto<"u"&&typeof crypto?.randomUUID=="function")return crypto.randomUUID();let PI=new Uint8Array(32);if(typeof crypto<"u"&&typeof crypto?.getRandomValues=="function")crypto.getRandomValues(PI);else for(let KI=0;KI<32;KI++)PI[KI]=Math.floor(Math.random()*255);return w(PI)}let nl="pdfjs_internal_id_",ol={BEZIER_CURVE_TO:0,MOVE_TO:1,LINE_TO:2,QUADRATIC_CURVE_TO:3,RESTORE:4,SAVE:5,SCALE:6,TRANSFORM:7,TRANSLATE:8}}},eH={};function Ua(I){var G=eH[I];if(G!==void 0)return G.exports;var l=eH[I]={exports:{}};return Z5[I](l,l.exports,Ua),l.exports}(()=>{var I=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",G=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",l=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",b=e=>{e&&e.d<1&&(e.d=1,e.forEach(t=>t.r--),e.forEach(t=>t.r--?t.r++:t()))},d=e=>e.map(t=>{if(t!==null&&typeof t=="object"){if(t[I])return t;if(t.then){var W=[];W.d=0,t.then(N=>{n[G]=N,b(W)},N=>{n[l]=N,b(W)});var n={};return n[I]=N=>N(W),n}}var s={};return s[I]=N=>{},s[G]=t,s});Ua.a=(e,t,W)=>{var n;W&&((n=[]).d=-1);var s=new Set,N=e.exports,m,h,V,X=new Promise((p,F)=>{V=F,h=p});X[G]=N,X[I]=p=>(n&&p(n),s.forEach(p),X.catch(F=>{})),e.exports=X,t(p=>{m=d(p);var F,a=()=>m.map(Q=>{if(Q[l])throw Q[l];return Q[G]}),u=new Promise(Q=>{F=()=>Q(a),F.r=0;var o=y=>y!==n&&!s.has(y)&&(s.add(y),y&&!y.d&&(F.r++,y.push(F)));m.map(y=>y[I](o))});return F.r?u:a()},p=>(p?V(X[l]=p):h(N),b(n))),n&&n.d<0&&(n.d=0)}})();Ua.d=(I,G)=>{for(var l in G)Ua.o(G,l)&&!Ua.o(I,l)&&Object.defineProperty(I,l,{enumerable:!0,get:G[l]})};Ua.o=(I,G)=>Object.prototype.hasOwnProperty.call(I,G);var sG=Ua(228);sG=globalThis.pdfjsLib=await(globalThis.pdfjsLibPromise=sG);var SGI=sG.AbortException,DGI=sG.AnnotationEditorLayer,qGI=sG.AnnotationEditorParamsType,_GI=sG.AnnotationEditorType,PGI=sG.AnnotationEditorUIManager,$GI=sG.AnnotationLayer,IcI=sG.AnnotationMode,lcI=sG.CMapCompressionType,GcI=sG.ColorPicker,ccI=sG.DOMSVGFactory,bcI=sG.DrawLayer,dcI=sG.FeatureTest,aH=sG.GlobalWorkerOptions,ZcI=sG.ImageKind,ecI=sG.InvalidPDFException,acI=sG.MissingPDFException,WcI=sG.OPS,tcI=sG.Outliner,ncI=sG.PDFDataRangeTransport,mcI=sG.PDFDateString,NcI=sG.PDFWorker,scI=sG.PasswordResponses,YcI=sG.PermissionFlag,hcI=sG.PixelsPerInch,VcI=sG.RenderingCancelledException,pcI=sG.UnexpectedResponseException,ucI=sG.Util,RcI=sG.VerbosityLevel,ocI=sG.XfaLayer,FcI=sG.build,XcI=sG.createValidAbsoluteUrl,icI=sG.fetchData,WH=sG.getDocument,QcI=sG.getFilenameFromUrl,HcI=sG.getPdfFilenameFromUrl,rcI=sG.getXfaPageViewport,wcI=sG.isDataScheme,vcI=sG.isPdfFile,EcI=sG.noContextMenu,ycI=sG.normalizeUnicode,gcI=sG.renderTextLayer,JcI=sG.setLayerDimensions,CcI=sG.shadow,AcI=sG.updateTextLayer,LcI=sG.version;var tH=el(uc());aH.workerSrc=tH.default.runtime.getURL("pdf.worker.js");async function nH(I){let l=await(await fetch(I)).blob(),b=URL.createObjectURL(l),d=await WH(b).promise,e=[];for(let t=1;t<=d.numPages;t++){let s=(await(await d.getPage(t)).getTextContent()).items.map(N=>N.str).join(" ");e.push(s)}return e.join(" ")}var mH;function e5(I){let G=",",l=new DOMParser().parseFromString(I,"text/xml"),d=[["start","duration","text"].join(",")];for(let e of l.getElementsByTagName("text")){let t=e.textContent;d.push([t].join(G))}return d.join(`
`)}async function lo(){let[I]=await Tp.default.tabs.query({active:!0,currentWindow:!0});if(I.url?.startsWith("chrome"))throw Error("Cannot query content from browser specific pages");if(I.url?.endsWith(".pdf"))return{textContent:await nH(I.url),title:I.title||"",url:I.url||"",isPdf:!0};if(I.id){let G=await Tp.default.tabs.sendMessage(I.id,{type:"GET_PAGE_INFO",to:"content-script"});return G.subtitles?G.plainSubtitles=`
${e5(G.subtitles.text)}
`:Up(I.url||"")&&Jb.sendNotification({element:Tp.default.i18n.getMessage("missingYoutubeTranscription"),position:"top-center",toastType:"blank"}),G}throw Error("Could not query tab")}async function Go(I){let G=await lo();return co(I,G)}async function co(I,G){let l=await MZ();return mH={SELECTED_LANGUAGE:n0(I),TITLE:G.title,CONTENT:G.plainSubtitles||G.textContent,TEXT_CONTENT:G.textContent,URL:G.url,VIDEO_SUBTITLES:G.plainSubtitles},{questionChunks:await a5({templateData:mH,config:l}),systemMessage:l.systemMessage,title:G.title}}function NH(I,G){try{let l=W0.render(I,G,{},{escape:b=>b});return _2(l)}catch(l){throw l instanceof Error?new Error(`QuestionTemplateError: ${l?.message}`):l}}async function a5({templateData:I,config:G},l=0){let b="";G||(G=await MZ()),G.question.includes("{{CONTENT}}")&&(b=_2(I?.CONTENT||""));let d=NH(G.question.replace("{{CONTENT}}",""),I),e=await Io(G,l);if(e<0)throw new Error("Could not produce summary. The maximum token size is too small.");let t=await $Q(d+" "+G.systemMessage+" "+b,e,G.model),W=[{resolvedTemplate:d,content:b,templateTokensCount:(await Od(d||"",G.model)).length}];if(!t){let n=NH(G.question.replace("{{CONTENT}}",""),I),s=await Od(G.systemMessage||"",G.model);W=await cH({initialResolvedTemplate:d,maxTokens:e-s.length,followupResolvedTemplate:n,content:b,modelName:G.model})}return W}var gd=el(IG());var sH=["http","https","mailto","tel"];function YH(I){let G=(I||"").trim(),l=G.charAt(0);if(l==="#"||l==="/")return G;let b=G.indexOf(":");if(b===-1)return G;let d=-1;for(;++d<sH.length;){let e=sH[d];if(b===e.length&&G.slice(0,e.length).toLowerCase()===e)return G}return d=G.indexOf("?"),d!==-1&&b>d||(d=G.indexOf("#"),d!==-1&&b>d)?G:"javascript:void(0)"}var ru=el(IG(),1);var FH=el(bo(),1);function Je(I){return!I||typeof I!="object"?"":"position"in I||"type"in I?VH(I.position):"start"in I||"end"in I?VH(I):"line"in I||"column"in I?Zo(I):""}function Zo(I){return pH(I&&I.line)+":"+pH(I&&I.column)}function VH(I){return Zo(I&&I.start)+"-"+Zo(I&&I.end)}function pH(I){return I&&typeof I=="number"?I:1}var ub=class extends Error{constructor(G,l,b){let d=[null,null],e={start:{line:null,column:null},end:{line:null,column:null}};if(super(),typeof l=="string"&&(b=l,l=void 0),typeof b=="string"){let t=b.indexOf(":");t===-1?d[1]=b:(d[0]=b.slice(0,t),d[1]=b.slice(t+1))}l&&("type"in l||"position"in l?l.position&&(e=l.position):"start"in l||"end"in l?e=l:("line"in l||"column"in l)&&(e.start=l)),this.name=Je(l)||"1:1",this.message=typeof G=="object"?G.message:G,this.stack="",typeof G=="object"&&G.stack&&(this.stack=G.stack),this.reason=this.message,this.fatal,this.line=e.start.line,this.column=e.start.column,this.position=e,this.source=d[0],this.ruleId=d[1],this.file,this.actual,this.expected,this.url,this.note}};ub.prototype.file="";ub.prototype.name="";ub.prototype.reason="";ub.prototype.message="";ub.prototype.stack="";ub.prototype.fatal=null;ub.prototype.column=null;ub.prototype.line=null;ub.prototype.source=null;ub.prototype.ruleId=null;ub.prototype.position=null;var jd={basename:W5,dirname:t5,extname:n5,join:m5,sep:"/"};function W5(I,G){if(G!==void 0&&typeof G!="string")throw new TypeError('"ext" argument must be a string');bh(I);let l=0,b=-1,d=I.length,e;if(G===void 0||G.length===0||G.length>I.length){for(;d--;)if(I.charCodeAt(d)===47){if(e){l=d+1;break}}else b<0&&(e=!0,b=d+1);return b<0?"":I.slice(l,b)}if(G===I)return"";let t=-1,W=G.length-1;for(;d--;)if(I.charCodeAt(d)===47){if(e){l=d+1;break}}else t<0&&(e=!0,t=d+1),W>-1&&(I.charCodeAt(d)===G.charCodeAt(W--)?W<0&&(b=d):(W=-1,b=t));return l===b?b=t:b<0&&(b=I.length),I.slice(l,b)}function t5(I){if(bh(I),I.length===0)return".";let G=-1,l=I.length,b;for(;--l;)if(I.charCodeAt(l)===47){if(b){G=l;break}}else b||(b=!0);return G<0?I.charCodeAt(0)===47?"/":".":G===1&&I.charCodeAt(0)===47?"//":I.slice(0,G)}function n5(I){bh(I);let G=I.length,l=-1,b=0,d=-1,e=0,t;for(;G--;){let W=I.charCodeAt(G);if(W===47){if(t){b=G+1;break}continue}l<0&&(t=!0,l=G+1),W===46?d<0?d=G:e!==1&&(e=1):d>-1&&(e=-1)}return d<0||l<0||e===0||e===1&&d===l-1&&d===b+1?"":I.slice(d,l)}function m5(...I){let G=-1,l;for(;++G<I.length;)bh(I[G]),I[G]&&(l=l===void 0?I[G]:l+"/"+I[G]);return l===void 0?".":N5(l)}function N5(I){bh(I);let G=I.charCodeAt(0)===47,l=s5(I,!G);return l.length===0&&!G&&(l="."),l.length>0&&I.charCodeAt(I.length-1)===47&&(l+="/"),G?"/"+l:l}function s5(I,G){let l="",b=0,d=-1,e=0,t=-1,W,n;for(;++t<=I.length;){if(t<I.length)W=I.charCodeAt(t);else{if(W===47)break;W=47}if(W===47){if(!(d===t-1||e===1))if(d!==t-1&&e===2){if(l.length<2||b!==2||l.charCodeAt(l.length-1)!==46||l.charCodeAt(l.length-2)!==46){if(l.length>2){if(n=l.lastIndexOf("/"),n!==l.length-1){n<0?(l="",b=0):(l=l.slice(0,n),b=l.length-1-l.lastIndexOf("/")),d=t,e=0;continue}}else if(l.length>0){l="",b=0,d=t,e=0;continue}}G&&(l=l.length>0?l+"/..":"..",b=2)}else l.length>0?l+="/"+I.slice(d+1,t):l=I.slice(d+1,t),b=t-d-1;d=t,e=0}else W===46&&e>-1?e++:e=-1}return l}function bh(I){if(typeof I!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(I))}var uH={cwd:Y5};function Y5(){return"/"}function An(I){return I!==null&&typeof I=="object"&&I.href&&I.origin}function RH(I){if(typeof I=="string")I=new URL(I);else if(!An(I)){let G=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+I+"`");throw G.code="ERR_INVALID_ARG_TYPE",G}if(I.protocol!=="file:"){let G=new TypeError("The URL must be of scheme file");throw G.code="ERR_INVALID_URL_SCHEME",G}return h5(I)}function h5(I){if(I.hostname!==""){let b=new TypeError('File URL host must be "localhost" or empty on darwin');throw b.code="ERR_INVALID_FILE_URL_HOST",b}let G=I.pathname,l=-1;for(;++l<G.length;)if(G.charCodeAt(l)===37&&G.charCodeAt(l+1)===50){let b=G.charCodeAt(l+2);if(b===70||b===102){let d=new TypeError("File URL path must not include encoded / characters");throw d.code="ERR_INVALID_FILE_URL_PATH",d}}return decodeURIComponent(G)}var eo=["history","path","basename","stem","extname","dirname"],Ma=class{constructor(G){let l;G?typeof G=="string"||V5(G)?l={value:G}:An(G)?l={path:G}:l=G:l={},this.data={},this.messages=[],this.history=[],this.cwd=uH.cwd(),this.value,this.stored,this.result,this.map;let b=-1;for(;++b<eo.length;){let e=eo[b];e in l&&l[e]!==void 0&&l[e]!==null&&(this[e]=e==="history"?[...l[e]]:l[e])}let d;for(d in l)eo.includes(d)||(this[d]=l[d])}get path(){return this.history[this.history.length-1]}set path(G){An(G)&&(G=RH(G)),Wo(G,"path"),this.path!==G&&this.history.push(G)}get dirname(){return typeof this.path=="string"?jd.dirname(this.path):void 0}set dirname(G){oH(this.basename,"dirname"),this.path=jd.join(G||"",this.basename)}get basename(){return typeof this.path=="string"?jd.basename(this.path):void 0}set basename(G){Wo(G,"basename"),ao(G,"basename"),this.path=jd.join(this.dirname||"",G)}get extname(){return typeof this.path=="string"?jd.extname(this.path):void 0}set extname(G){if(ao(G,"extname"),oH(this.dirname,"extname"),G){if(G.charCodeAt(0)!==46)throw new Error("`extname` must start with `.`");if(G.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=jd.join(this.dirname,this.stem+(G||""))}get stem(){return typeof this.path=="string"?jd.basename(this.path,this.extname):void 0}set stem(G){Wo(G,"stem"),ao(G,"stem"),this.path=jd.join(this.dirname||"",G+(this.extname||""))}toString(G){return(this.value||"").toString(G||void 0)}message(G,l,b){let d=new ub(G,l,b);return this.path&&(d.name=this.path+":"+d.name,d.file=this.path),d.fatal=!1,this.messages.push(d),d}info(G,l,b){let d=this.message(G,l,b);return d.fatal=null,d}fail(G,l,b){let d=this.message(G,l,b);throw d.fatal=!0,d}};function ao(I,G){if(I&&I.includes(jd.sep))throw new Error("`"+G+"` cannot be a path: did not expect `"+jd.sep+"`")}function Wo(I,G){if(!I)throw new Error("`"+G+"` cannot be empty")}function oH(I,G){if(!I)throw new Error("Setting `"+G+"` requires `path` to be set too")}function V5(I){return(0,FH.default)(I)}function to(I){if(I)throw I}var LH=el(bo(),1),so=el(yH(),1);function dh(I){if(typeof I!="object"||I===null)return!1;let G=Object.getPrototypeOf(I);return(G===null||G===Object.prototype||Object.getPrototypeOf(G)===null)&&!(Symbol.toStringTag in I)&&!(Symbol.iterator in I)}function gH(){let I=[],G={run:l,use:b};return G;function l(...d){let e=-1,t=d.pop();if(typeof t!="function")throw new TypeError("Expected function as last argument, not "+t);W(null,...d);function W(n,...s){let N=I[++e],m=-1;if(n){t(n);return}for(;++m<d.length;)(s[m]===null||s[m]===void 0)&&(s[m]=d[m]);d=s,N?p5(N,W)(...s):t(null,...s)}}function b(d){if(typeof d!="function")throw new TypeError("Expected `middelware` to be a function, not "+d);return I.push(d),G}}function p5(I,G){let l;return b;function b(...t){let W=I.length>t.length,n;W&&t.push(d);try{n=I.apply(this,t)}catch(s){let N=s;if(W&&l)throw N;return d(N)}W||(n instanceof Promise?n.then(e,d):n instanceof Error?d(n):e(n))}function d(t,...W){l||(l=!0,G(t,...W))}function e(t){d(null,t)}}var Yo=xH().freeze(),kH={}.hasOwnProperty;function xH(){let I=gH(),G=[],l={},b,d=-1;return e.data=t,e.Parser=void 0,e.Compiler=void 0,e.freeze=W,e.attachers=G,e.use=n,e.parse=s,e.stringify=N,e.run=m,e.runSync=h,e.process=V,e.processSync=X,e;function e(){let p=xH(),F=-1;for(;++F<G.length;)p.use(...G[F]);return p.data((0,so.default)(!0,{},l)),p}function t(p,F){return typeof p=="string"?arguments.length===2?(No("data",b),l[p]=F,e):kH.call(l,p)&&l[p]||null:p?(No("data",b),l=p,e):l}function W(){if(b)return e;for(;++d<G.length;){let[p,...F]=G[d];if(F[0]===!1)continue;F[0]===!0&&(F[0]=void 0);let a=p.call(e,...F);typeof a=="function"&&I.use(a)}return b=!0,d=Number.POSITIVE_INFINITY,e}function n(p,...F){let a;if(No("use",b),p!=null)if(typeof p=="function")y(p,...F);else if(typeof p=="object")Array.isArray(p)?o(p):Q(p);else throw new TypeError("Expected usable value, not `"+p+"`");return a&&(l.settings=Object.assign(l.settings||{},a)),e;function u(H){if(typeof H=="function")y(H);else if(typeof H=="object")if(Array.isArray(H)){let[E,...C]=H;y(E,...C)}else Q(H);else throw new TypeError("Expected usable value, not `"+H+"`")}function Q(H){o(H.plugins),H.settings&&(a=Object.assign(a||{},H.settings))}function o(H){let E=-1;if(H!=null)if(Array.isArray(H))for(;++E<H.length;){let C=H[E];u(C)}else throw new TypeError("Expected a list of plugins, not `"+H+"`")}function y(H,E){let C=-1,T;for(;++C<G.length;)if(G[C][0]===H){T=G[C];break}T?(dh(T[1])&&dh(E)&&(E=(0,so.default)(!0,T[1],E)),T[1]=E):G.push([...arguments])}}function s(p){e.freeze();let F=Zh(p),a=e.Parser;return no("parse",a),JH(a,"parse")?new a(String(F),F).parse():a(String(F),F)}function N(p,F){e.freeze();let a=Zh(F),u=e.Compiler;return mo("stringify",u),CH(p),JH(u,"compile")?new u(p,a).compile():u(p,a)}function m(p,F,a){if(CH(p),e.freeze(),!a&&typeof F=="function"&&(a=F,F=void 0),!a)return new Promise(u);u(null,a);function u(Q,o){I.run(p,Zh(F),y);function y(H,E,C){E=E||p,H?o(H):Q?Q(E):a(null,E,C)}}}function h(p,F){let a,u;return e.run(p,F,Q),AH("runSync","run",u),a;function Q(o,y){to(o),a=y,u=!0}}function V(p,F){if(e.freeze(),no("process",e.Parser),mo("process",e.Compiler),!F)return new Promise(a);a(null,F);function a(u,Q){let o=Zh(p);e.run(e.parse(o),o,(H,E,C)=>{if(H||!E||!C)y(H);else{let T=e.stringify(E,C);T==null||(o5(T)?C.value=T:C.result=T),y(H,C)}});function y(H,E){H||!E?Q(H):u?u(E):F(null,E)}}}function X(p){let F;e.freeze(),no("processSync",e.Parser),mo("processSync",e.Compiler);let a=Zh(p);return e.process(a,u),AH("processSync","process",F),a;function u(Q){F=!0,to(Q)}}}function JH(I,G){return typeof I=="function"&&I.prototype&&(u5(I.prototype)||G in I.prototype)}function u5(I){let G;for(G in I)if(kH.call(I,G))return!0;return!1}function no(I,G){if(typeof G!="function")throw new TypeError("Cannot `"+I+"` without `Parser`")}function mo(I,G){if(typeof G!="function")throw new TypeError("Cannot `"+I+"` without `Compiler`")}function No(I,G){if(G)throw new Error("Cannot call `"+I+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function CH(I){if(!dh(I)||typeof I.type!="string")throw new TypeError("Expected node, got `"+I+"`")}function AH(I,G,l){if(!l)throw new Error("`"+I+"` finished async. Use `"+G+"` instead")}function Zh(I){return R5(I)?I:new Ma(I)}function R5(I){return!!(I&&typeof I=="object"&&"message"in I&&"messages"in I)}function o5(I){return typeof I=="string"||(0,LH.default)(I)}var F5={};function ho(I,G){let l=G||F5,b=typeof l.includeImageAlt=="boolean"?l.includeImageAlt:!0,d=typeof l.includeHtml=="boolean"?l.includeHtml:!0;return UH(I,b,d)}function UH(I,G,l){if(X5(I)){if("value"in I)return I.type==="html"&&!l?"":I.value;if(G&&"alt"in I&&I.alt)return I.alt;if("children"in I)return zH(I.children,G,l)}return Array.isArray(I)?zH(I,G,l):""}function zH(I,G,l){let b=[],d=-1;for(;++d<I.length;)b[d]=UH(I[d],G,l);return b.join("")}function X5(I){return!!(I&&typeof I=="object")}function Nb(I,G,l,b){let d=I.length,e=0,t;if(G<0?G=-G>d?0:d+G:G=G>d?d:G,l=l>0?l:0,b.length<1e4)t=Array.from(b),t.unshift(G,l),I.splice(...t);else for(l&&I.splice(G,l);e<b.length;)t=b.slice(e,e+1e4),t.unshift(G,0),I.splice(...t),e+=1e4,G+=1e4}function Cb(I,G){return I.length>0?(Nb(I,I.length,0,G),I):G}var MH={}.hasOwnProperty;function BH(I){let G={},l=-1;for(;++l<I.length;)i5(G,I[l]);return G}function i5(I,G){let l;for(l in G){let d=(MH.call(I,l)?I[l]:void 0)||(I[l]={}),e=G[l],t;if(e)for(t in e){MH.call(d,t)||(d[t]=[]);let W=e[t];Q5(d[t],Array.isArray(W)?W:W?[W]:[])}}}function Q5(I,G){let l=-1,b=[];for(;++l<G.length;)(G[l].add==="after"?I:b).push(G[l]);Nb(I,0,0,b)}var OH=/[!-\/:-@\[-`\{-~\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061D-\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1B7D\u1B7E\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52-\u2E5D\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]/;var dd=Ce(/[A-Za-z]/),Zb=Ce(/[\dA-Za-z]/),jH=Ce(/[#-'*+\--9=?A-Z^-~]/);function eh(I){return I!==null&&(I<32||I===127)}var ah=Ce(/\d/),KH=Ce(/[\dA-Fa-f]/),TH=Ce(/[!-/:-@[-`{-~]/);function Tl(I){return I!==null&&I<-2}function jc(I){return I!==null&&(I<0||I===32)}function oG(I){return I===-2||I===-1||I===32}var fH=Ce(OH),SH=Ce(/\s/);function Ce(I){return G;function G(l){return l!==null&&I.test(String.fromCharCode(l))}}function HG(I,G,l,b){let d=b?b-1:Number.POSITIVE_INFINITY,e=0;return t;function t(n){return oG(n)?(I.enter(l),W(n)):G(n)}function W(n){return oG(n)&&e++<d?(I.consume(n),W):(I.exit(l),G(n))}}var DH={tokenize:H5};function H5(I){let G=I.attempt(this.parser.constructs.contentInitial,b,d),l;return G;function b(W){if(W===null){I.consume(W);return}return I.enter("lineEnding"),I.consume(W),I.exit("lineEnding"),HG(I,G,"linePrefix")}function d(W){return I.enter("paragraph"),e(W)}function e(W){let n=I.enter("chunkText",{contentType:"text",previous:l});return l&&(l.next=n),l=n,t(W)}function t(W){if(W===null){I.exit("chunkText"),I.exit("paragraph"),I.consume(W);return}return Tl(W)?(I.consume(W),I.exit("chunkText"),e):(I.consume(W),t)}}var _H={tokenize:r5},qH={tokenize:w5};function r5(I){let G=this,l=[],b=0,d,e,t;return W;function W(Q){if(b<l.length){let o=l[b];return G.containerState=o[1],I.attempt(o[0].continuation,n,s)(Q)}return s(Q)}function n(Q){if(b++,G.containerState._closeFlow){G.containerState._closeFlow=void 0,d&&u();let o=G.events.length,y=o,H;for(;y--;)if(G.events[y][0]==="exit"&&G.events[y][1].type==="chunkFlow"){H=G.events[y][1].end;break}a(b);let E=o;for(;E<G.events.length;)G.events[E][1].end=Object.assign({},H),E++;return Nb(G.events,y+1,0,G.events.slice(o)),G.events.length=E,s(Q)}return W(Q)}function s(Q){if(b===l.length){if(!d)return h(Q);if(d.currentConstruct&&d.currentConstruct.concrete)return X(Q);G.interrupt=!!(d.currentConstruct&&!d._gfmTableDynamicInterruptHack)}return G.containerState={},I.check(qH,N,m)(Q)}function N(Q){return d&&u(),a(b),h(Q)}function m(Q){return G.parser.lazy[G.now().line]=b!==l.length,t=G.now().offset,X(Q)}function h(Q){return G.containerState={},I.attempt(qH,V,X)(Q)}function V(Q){return b++,l.push([G.currentConstruct,G.containerState]),h(Q)}function X(Q){if(Q===null){d&&u(),a(0),I.consume(Q);return}return d=d||G.parser.flow(G.now()),I.enter("chunkFlow",{contentType:"flow",previous:e,_tokenizer:d}),p(Q)}function p(Q){if(Q===null){F(I.exit("chunkFlow"),!0),a(0),I.consume(Q);return}return Tl(Q)?(I.consume(Q),F(I.exit("chunkFlow")),b=0,G.interrupt=void 0,W):(I.consume(Q),p)}function F(Q,o){let y=G.sliceStream(Q);if(o&&y.push(null),Q.previous=e,e&&(e.next=Q),e=Q,d.defineSkip(Q.start),d.write(y),G.parser.lazy[Q.start.line]){let H=d.events.length;for(;H--;)if(d.events[H][1].start.offset<t&&(!d.events[H][1].end||d.events[H][1].end.offset>t))return;let E=G.events.length,C=E,T,S;for(;C--;)if(G.events[C][0]==="exit"&&G.events[C][1].type==="chunkFlow"){if(T){S=G.events[C][1].end;break}T=!0}for(a(b),H=E;H<G.events.length;)G.events[H][1].end=Object.assign({},S),H++;Nb(G.events,C+1,0,G.events.slice(E)),G.events.length=H}}function a(Q){let o=l.length;for(;o-- >Q;){let y=l[o];G.containerState=y[1],y[0].exit.call(G,I)}l.length=Q}function u(){d.write([null]),e=void 0,d=void 0,G.containerState._closeFlow=void 0}}function w5(I,G,l){return HG(I,I.attempt(this.parser.constructs.document,G,l),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function Vo(I){if(I===null||jc(I)||SH(I))return 1;if(fH(I))return 2}function Ln(I,G,l){let b=[],d=-1;for(;++d<I.length;){let e=I[d].resolveAll;e&&!b.includes(e)&&(G=e(G,l),b.push(e))}return G}var Wh={name:"attention",tokenize:E5,resolveAll:v5};function v5(I,G){let l=-1,b,d,e,t,W,n,s,N;for(;++l<I.length;)if(I[l][0]==="enter"&&I[l][1].type==="attentionSequence"&&I[l][1]._close){for(b=l;b--;)if(I[b][0]==="exit"&&I[b][1].type==="attentionSequence"&&I[b][1]._open&&G.sliceSerialize(I[b][1]).charCodeAt(0)===G.sliceSerialize(I[l][1]).charCodeAt(0)){if((I[b][1]._close||I[l][1]._open)&&(I[l][1].end.offset-I[l][1].start.offset)%3&&!((I[b][1].end.offset-I[b][1].start.offset+I[l][1].end.offset-I[l][1].start.offset)%3))continue;n=I[b][1].end.offset-I[b][1].start.offset>1&&I[l][1].end.offset-I[l][1].start.offset>1?2:1;let m=Object.assign({},I[b][1].end),h=Object.assign({},I[l][1].start);PH(m,-n),PH(h,n),t={type:n>1?"strongSequence":"emphasisSequence",start:m,end:Object.assign({},I[b][1].end)},W={type:n>1?"strongSequence":"emphasisSequence",start:Object.assign({},I[l][1].start),end:h},e={type:n>1?"strongText":"emphasisText",start:Object.assign({},I[b][1].end),end:Object.assign({},I[l][1].start)},d={type:n>1?"strong":"emphasis",start:Object.assign({},t.start),end:Object.assign({},W.end)},I[b][1].end=Object.assign({},t.start),I[l][1].start=Object.assign({},W.end),s=[],I[b][1].end.offset-I[b][1].start.offset&&(s=Cb(s,[["enter",I[b][1],G],["exit",I[b][1],G]])),s=Cb(s,[["enter",d,G],["enter",t,G],["exit",t,G],["enter",e,G]]),s=Cb(s,Ln(G.parser.constructs.insideSpan.null,I.slice(b+1,l),G)),s=Cb(s,[["exit",e,G],["enter",W,G],["exit",W,G],["exit",d,G]]),I[l][1].end.offset-I[l][1].start.offset?(N=2,s=Cb(s,[["enter",I[l][1],G],["exit",I[l][1],G]])):N=0,Nb(I,b-1,l-b+3,s),l=b+s.length-N-2;break}}for(l=-1;++l<I.length;)I[l][1].type==="attentionSequence"&&(I[l][1].type="data");return I}function E5(I,G){let l=this.parser.constructs.attentionMarkers.null,b=this.previous,d=Vo(b),e;return t;function t(n){return e=n,I.enter("attentionSequence"),W(n)}function W(n){if(n===e)return I.consume(n),W;let s=I.exit("attentionSequence"),N=Vo(n),m=!N||N===2&&d||l.includes(n),h=!d||d===2&&N||l.includes(b);return s._open=!!(e===42?m:m&&(d||!h)),s._close=!!(e===42?h:h&&(N||!m)),G(n)}}function PH(I,G){I.column+=G,I.offset+=G,I._bufferIndex+=G}var po={name:"autolink",tokenize:y5};function y5(I,G,l){let b=0;return d;function d(V){return I.enter("autolink"),I.enter("autolinkMarker"),I.consume(V),I.exit("autolinkMarker"),I.enter("autolinkProtocol"),e}function e(V){return dd(V)?(I.consume(V),t):s(V)}function t(V){return V===43||V===45||V===46||Zb(V)?(b=1,W(V)):s(V)}function W(V){return V===58?(I.consume(V),b=0,n):(V===43||V===45||V===46||Zb(V))&&b++<32?(I.consume(V),W):(b=0,s(V))}function n(V){return V===62?(I.exit("autolinkProtocol"),I.enter("autolinkMarker"),I.consume(V),I.exit("autolinkMarker"),I.exit("autolink"),G):V===null||V===32||V===60||eh(V)?l(V):(I.consume(V),n)}function s(V){return V===64?(I.consume(V),N):jH(V)?(I.consume(V),s):l(V)}function N(V){return Zb(V)?m(V):l(V)}function m(V){return V===46?(I.consume(V),b=0,N):V===62?(I.exit("autolinkProtocol").type="autolinkEmail",I.enter("autolinkMarker"),I.consume(V),I.exit("autolinkMarker"),I.exit("autolink"),G):h(V)}function h(V){if((V===45||Zb(V))&&b++<63){let X=V===45?h:m;return I.consume(V),X}return l(V)}}var Ae={tokenize:g5,partial:!0};function g5(I,G,l){return b;function b(e){return oG(e)?HG(I,d,"linePrefix")(e):d(e)}function d(e){return e===null||Tl(e)?G(e):l(e)}}var Sp={name:"blockQuote",tokenize:J5,continuation:{tokenize:C5},exit:A5};function J5(I,G,l){let b=this;return d;function d(t){if(t===62){let W=b.containerState;return W.open||(I.enter("blockQuote",{_container:!0}),W.open=!0),I.enter("blockQuotePrefix"),I.enter("blockQuoteMarker"),I.consume(t),I.exit("blockQuoteMarker"),e}return l(t)}function e(t){return oG(t)?(I.enter("blockQuotePrefixWhitespace"),I.consume(t),I.exit("blockQuotePrefixWhitespace"),I.exit("blockQuotePrefix"),G):(I.exit("blockQuotePrefix"),G(t))}}function C5(I,G,l){let b=this;return d;function d(t){return oG(t)?HG(I,e,"linePrefix",b.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t):e(t)}function e(t){return I.attempt(Sp,G,l)(t)}}function A5(I){I.exit("blockQuote")}var Dp={name:"characterEscape",tokenize:L5};function L5(I,G,l){return b;function b(e){return I.enter("characterEscape"),I.enter("escapeMarker"),I.consume(e),I.exit("escapeMarker"),d}function d(e){return TH(e)?(I.enter("characterEscapeValue"),I.consume(e),I.exit("characterEscapeValue"),I.exit("characterEscape"),G):l(e)}}var $H=document.createElement("i");function kn(I){let G="&"+I+";";$H.innerHTML=G;let l=$H.textContent;return l.charCodeAt(l.length-1)===59&&I!=="semi"||l===G?!1:l}var qp={name:"characterReference",tokenize:k5};function k5(I,G,l){let b=this,d=0,e,t;return W;function W(m){return I.enter("characterReference"),I.enter("characterReferenceMarker"),I.consume(m),I.exit("characterReferenceMarker"),n}function n(m){return m===35?(I.enter("characterReferenceMarkerNumeric"),I.consume(m),I.exit("characterReferenceMarkerNumeric"),s):(I.enter("characterReferenceValue"),e=31,t=Zb,N(m))}function s(m){return m===88||m===120?(I.enter("characterReferenceMarkerHexadecimal"),I.consume(m),I.exit("characterReferenceMarkerHexadecimal"),I.enter("characterReferenceValue"),e=6,t=KH,N):(I.enter("characterReferenceValue"),e=7,t=ah,N(m))}function N(m){if(m===59&&d){let h=I.exit("characterReferenceValue");return t===Zb&&!kn(b.sliceSerialize(h))?l(m):(I.enter("characterReferenceMarker"),I.consume(m),I.exit("characterReferenceMarker"),I.exit("characterReference"),G)}return t(m)&&d++<e?(I.consume(m),N):l(m)}}var Ir={tokenize:z5,partial:!0},_p={name:"codeFenced",tokenize:x5,concrete:!0};function x5(I,G,l){let b=this,d={tokenize:y,partial:!0},e=0,t=0,W;return n;function n(H){return s(H)}function s(H){let E=b.events[b.events.length-1];return e=E&&E[1].type==="linePrefix"?E[2].sliceSerialize(E[1],!0).length:0,W=H,I.enter("codeFenced"),I.enter("codeFencedFence"),I.enter("codeFencedFenceSequence"),N(H)}function N(H){return H===W?(t++,I.consume(H),N):t<3?l(H):(I.exit("codeFencedFenceSequence"),oG(H)?HG(I,m,"whitespace")(H):m(H))}function m(H){return H===null||Tl(H)?(I.exit("codeFencedFence"),b.interrupt?G(H):I.check(Ir,p,o)(H)):(I.enter("codeFencedFenceInfo"),I.enter("chunkString",{contentType:"string"}),h(H))}function h(H){return H===null||Tl(H)?(I.exit("chunkString"),I.exit("codeFencedFenceInfo"),m(H)):oG(H)?(I.exit("chunkString"),I.exit("codeFencedFenceInfo"),HG(I,V,"whitespace")(H)):H===96&&H===W?l(H):(I.consume(H),h)}function V(H){return H===null||Tl(H)?m(H):(I.enter("codeFencedFenceMeta"),I.enter("chunkString",{contentType:"string"}),X(H))}function X(H){return H===null||Tl(H)?(I.exit("chunkString"),I.exit("codeFencedFenceMeta"),m(H)):H===96&&H===W?l(H):(I.consume(H),X)}function p(H){return I.attempt(d,o,F)(H)}function F(H){return I.enter("lineEnding"),I.consume(H),I.exit("lineEnding"),a}function a(H){return e>0&&oG(H)?HG(I,u,"linePrefix",e+1)(H):u(H)}function u(H){return H===null||Tl(H)?I.check(Ir,p,o)(H):(I.enter("codeFlowValue"),Q(H))}function Q(H){return H===null||Tl(H)?(I.exit("codeFlowValue"),u(H)):(I.consume(H),Q)}function o(H){return I.exit("codeFenced"),G(H)}function y(H,E,C){let T=0;return S;function S(sI){return H.enter("lineEnding"),H.consume(sI),H.exit("lineEnding"),cI}function cI(sI){return H.enter("codeFencedFence"),oG(sI)?HG(H,hI,"linePrefix",b.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(sI):hI(sI)}function hI(sI){return sI===W?(H.enter("codeFencedFenceSequence"),WI(sI)):C(sI)}function WI(sI){return sI===W?(T++,H.consume(sI),WI):T>=t?(H.exit("codeFencedFenceSequence"),oG(sI)?HG(H,VI,"whitespace")(sI):VI(sI)):C(sI)}function VI(sI){return sI===null||Tl(sI)?(H.exit("codeFencedFence"),E(sI)):C(sI)}}}function z5(I,G,l){let b=this;return d;function d(t){return t===null?l(t):(I.enter("lineEnding"),I.consume(t),I.exit("lineEnding"),e)}function e(t){return b.parser.lazy[b.now().line]?l(t):G(t)}}var th={name:"codeIndented",tokenize:M5},U5={tokenize:B5,partial:!0};function M5(I,G,l){let b=this;return d;function d(s){return I.enter("codeIndented"),HG(I,e,"linePrefix",5)(s)}function e(s){let N=b.events[b.events.length-1];return N&&N[1].type==="linePrefix"&&N[2].sliceSerialize(N[1],!0).length>=4?t(s):l(s)}function t(s){return s===null?n(s):Tl(s)?I.attempt(U5,t,n)(s):(I.enter("codeFlowValue"),W(s))}function W(s){return s===null||Tl(s)?(I.exit("codeFlowValue"),t(s)):(I.consume(s),W)}function n(s){return I.exit("codeIndented"),G(s)}}function B5(I,G,l){let b=this;return d;function d(t){return b.parser.lazy[b.now().line]?l(t):Tl(t)?(I.enter("lineEnding"),I.consume(t),I.exit("lineEnding"),d):HG(I,e,"linePrefix",5)(t)}function e(t){let W=b.events[b.events.length-1];return W&&W[1].type==="linePrefix"&&W[2].sliceSerialize(W[1],!0).length>=4?G(t):Tl(t)?d(t):l(t)}}var uo={name:"codeText",tokenize:K5,resolve:O5,previous:j5};function O5(I){let G=I.length-4,l=3,b,d;if((I[l][1].type==="lineEnding"||I[l][1].type==="space")&&(I[G][1].type==="lineEnding"||I[G][1].type==="space")){for(b=l;++b<G;)if(I[b][1].type==="codeTextData"){I[l][1].type="codeTextPadding",I[G][1].type="codeTextPadding",l+=2,G-=2;break}}for(b=l-1,G++;++b<=G;)d===void 0?b!==G&&I[b][1].type!=="lineEnding"&&(d=b):(b===G||I[b][1].type==="lineEnding")&&(I[d][1].type="codeTextData",b!==d+2&&(I[d][1].end=I[b-1][1].end,I.splice(d+2,b-d-2),G-=b-d-2,b=d+2),d=void 0);return I}function j5(I){return I!==96||this.events[this.events.length-1][1].type==="characterEscape"}function K5(I,G,l){let b=this,d=0,e,t;return W;function W(h){return I.enter("codeText"),I.enter("codeTextSequence"),n(h)}function n(h){return h===96?(I.consume(h),d++,n):(I.exit("codeTextSequence"),s(h))}function s(h){return h===null?l(h):h===32?(I.enter("space"),I.consume(h),I.exit("space"),s):h===96?(t=I.enter("codeTextSequence"),e=0,m(h)):Tl(h)?(I.enter("lineEnding"),I.consume(h),I.exit("lineEnding"),s):(I.enter("codeTextData"),N(h))}function N(h){return h===null||h===32||h===96||Tl(h)?(I.exit("codeTextData"),s(h)):(I.consume(h),N)}function m(h){return h===96?(I.consume(h),e++,m):e===d?(I.exit("codeTextSequence"),I.exit("codeText"),G(h)):(t.type="codeTextData",N(h))}}function Pp(I){let G={},l=-1,b,d,e,t,W,n,s;for(;++l<I.length;){for(;l in G;)l=G[l];if(b=I[l],l&&b[1].type==="chunkFlow"&&I[l-1][1].type==="listItemPrefix"&&(n=b[1]._tokenizer.events,e=0,e<n.length&&n[e][1].type==="lineEndingBlank"&&(e+=2),e<n.length&&n[e][1].type==="content"))for(;++e<n.length&&n[e][1].type!=="content";)n[e][1].type==="chunkText"&&(n[e][1]._isInFirstContentOfListItem=!0,e++);if(b[0]==="enter")b[1].contentType&&(Object.assign(G,T5(I,l)),l=G[l],s=!0);else if(b[1]._container){for(e=l,d=void 0;e--&&(t=I[e],t[1].type==="lineEnding"||t[1].type==="lineEndingBlank");)t[0]==="enter"&&(d&&(I[d][1].type="lineEndingBlank"),t[1].type="lineEnding",d=e);d&&(b[1].end=Object.assign({},I[d][1].start),W=I.slice(d,l),W.unshift(b),Nb(I,d,l-d+1,W))}}return!s}function T5(I,G){let l=I[G][1],b=I[G][2],d=G-1,e=[],t=l._tokenizer||b.parser[l.contentType](l.start),W=t.events,n=[],s={},N,m,h=-1,V=l,X=0,p=0,F=[p];for(;V;){for(;I[++d][1]!==V;);e.push(d),V._tokenizer||(N=b.sliceStream(V),V.next||N.push(null),m&&t.defineSkip(V.start),V._isInFirstContentOfListItem&&(t._gfmTasklistFirstContentOfListItem=!0),t.write(N),V._isInFirstContentOfListItem&&(t._gfmTasklistFirstContentOfListItem=void 0)),m=V,V=V.next}for(V=l;++h<W.length;)W[h][0]==="exit"&&W[h-1][0]==="enter"&&W[h][1].type===W[h-1][1].type&&W[h][1].start.line!==W[h][1].end.line&&(p=h+1,F.push(p),V._tokenizer=void 0,V.previous=void 0,V=V.next);for(t.events=[],V?(V._tokenizer=void 0,V.previous=void 0):F.pop(),h=F.length;h--;){let a=W.slice(F[h],F[h+1]),u=e.pop();n.unshift([u,u+a.length-1]),Nb(I,u,2,a)}for(h=-1;++h<n.length;)s[X+n[h][0]]=X+n[h][1],X+=n[h][1]-n[h][0]-1;return s}var Ro={tokenize:D5,resolve:S5},f5={tokenize:q5,partial:!0};function S5(I){return Pp(I),I}function D5(I,G){let l;return b;function b(W){return I.enter("content"),l=I.enter("chunkContent",{contentType:"content"}),d(W)}function d(W){return W===null?e(W):Tl(W)?I.check(f5,t,e)(W):(I.consume(W),d)}function e(W){return I.exit("chunkContent"),I.exit("content"),G(W)}function t(W){return I.consume(W),I.exit("chunkContent"),l.next=I.enter("chunkContent",{contentType:"content",previous:l}),l=l.next,d}}function q5(I,G,l){let b=this;return d;function d(t){return I.exit("chunkContent"),I.enter("lineEnding"),I.consume(t),I.exit("lineEnding"),HG(I,e,"linePrefix")}function e(t){if(t===null||Tl(t))return l(t);let W=b.events[b.events.length-1];return!b.parser.constructs.disable.null.includes("codeIndented")&&W&&W[1].type==="linePrefix"&&W[2].sliceSerialize(W[1],!0).length>=4?G(t):I.interrupt(b.parser.constructs.flow,l,G)(t)}}function $p(I,G,l,b,d,e,t,W,n){let s=n||Number.POSITIVE_INFINITY,N=0;return m;function m(a){return a===60?(I.enter(b),I.enter(d),I.enter(e),I.consume(a),I.exit(e),h):a===null||a===32||a===41||eh(a)?l(a):(I.enter(b),I.enter(t),I.enter(W),I.enter("chunkString",{contentType:"string"}),p(a))}function h(a){return a===62?(I.enter(e),I.consume(a),I.exit(e),I.exit(d),I.exit(b),G):(I.enter(W),I.enter("chunkString",{contentType:"string"}),V(a))}function V(a){return a===62?(I.exit("chunkString"),I.exit(W),h(a)):a===null||a===60||Tl(a)?l(a):(I.consume(a),a===92?X:V)}function X(a){return a===60||a===62||a===92?(I.consume(a),V):V(a)}function p(a){return!N&&(a===null||a===41||jc(a))?(I.exit("chunkString"),I.exit(W),I.exit(t),I.exit(b),G(a)):N<s&&a===40?(I.consume(a),N++,p):a===41?(I.consume(a),N--,p):a===null||a===32||a===40||eh(a)?l(a):(I.consume(a),a===92?F:p)}function F(a){return a===40||a===41||a===92?(I.consume(a),p):p(a)}}function Iu(I,G,l,b,d,e){let t=this,W=0,n;return s;function s(V){return I.enter(b),I.enter(d),I.consume(V),I.exit(d),I.enter(e),N}function N(V){return W>999||V===null||V===91||V===93&&!n||V===94&&!W&&"_hiddenFootnoteSupport"in t.parser.constructs?l(V):V===93?(I.exit(e),I.enter(d),I.consume(V),I.exit(d),I.exit(b),G):Tl(V)?(I.enter("lineEnding"),I.consume(V),I.exit("lineEnding"),N):(I.enter("chunkString",{contentType:"string"}),m(V))}function m(V){return V===null||V===91||V===93||Tl(V)||W++>999?(I.exit("chunkString"),N(V)):(I.consume(V),n||(n=!oG(V)),V===92?h:m)}function h(V){return V===91||V===92||V===93?(I.consume(V),W++,m):m(V)}}function lu(I,G,l,b,d,e){let t;return W;function W(h){return h===34||h===39||h===40?(I.enter(b),I.enter(d),I.consume(h),I.exit(d),t=h===40?41:h,n):l(h)}function n(h){return h===t?(I.enter(d),I.consume(h),I.exit(d),I.exit(b),G):(I.enter(e),s(h))}function s(h){return h===t?(I.exit(e),n(t)):h===null?l(h):Tl(h)?(I.enter("lineEnding"),I.consume(h),I.exit("lineEnding"),HG(I,s,"linePrefix")):(I.enter("chunkString",{contentType:"string"}),N(h))}function N(h){return h===t||h===null||Tl(h)?(I.exit("chunkString"),s(h)):(I.consume(h),h===92?m:N)}function m(h){return h===t||h===92?(I.consume(h),N):N(h)}}function Ba(I,G){let l;return b;function b(d){return Tl(d)?(I.enter("lineEnding"),I.consume(d),I.exit("lineEnding"),l=!0,b):oG(d)?HG(I,b,l?"linePrefix":"lineSuffix")(d):G(d)}}function BZ(I){return I.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}var oo={name:"definition",tokenize:P5},_5={tokenize:$5,partial:!0};function P5(I,G,l){let b=this,d;return e;function e(V){return I.enter("definition"),t(V)}function t(V){return Iu.call(b,I,W,l,"definitionLabel","definitionLabelMarker","definitionLabelString")(V)}function W(V){return d=BZ(b.sliceSerialize(b.events[b.events.length-1][1]).slice(1,-1)),V===58?(I.enter("definitionMarker"),I.consume(V),I.exit("definitionMarker"),n):l(V)}function n(V){return jc(V)?Ba(I,s)(V):s(V)}function s(V){return $p(I,N,l,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(V)}function N(V){return I.attempt(_5,m,m)(V)}function m(V){return oG(V)?HG(I,h,"whitespace")(V):h(V)}function h(V){return V===null||Tl(V)?(I.exit("definition"),b.parser.defined.push(d),G(V)):l(V)}}function $5(I,G,l){return b;function b(W){return jc(W)?Ba(I,d)(W):l(W)}function d(W){return lu(I,e,l,"definitionTitle","definitionTitleMarker","definitionTitleString")(W)}function e(W){return oG(W)?HG(I,t,"whitespace")(W):t(W)}function t(W){return W===null||Tl(W)?G(W):l(W)}}var Fo={name:"hardBreakEscape",tokenize:IA};function IA(I,G,l){return b;function b(e){return I.enter("hardBreakEscape"),I.consume(e),d}function d(e){return Tl(e)?(I.exit("hardBreakEscape"),G(e)):l(e)}}var Xo={name:"headingAtx",tokenize:GA,resolve:lA};function lA(I,G){let l=I.length-2,b=3,d,e;return I[b][1].type==="whitespace"&&(b+=2),l-2>b&&I[l][1].type==="whitespace"&&(l-=2),I[l][1].type==="atxHeadingSequence"&&(b===l-1||l-4>b&&I[l-2][1].type==="whitespace")&&(l-=b+1===l?2:4),l>b&&(d={type:"atxHeadingText",start:I[b][1].start,end:I[l][1].end},e={type:"chunkText",start:I[b][1].start,end:I[l][1].end,contentType:"text"},Nb(I,b,l-b+1,[["enter",d,G],["enter",e,G],["exit",e,G],["exit",d,G]])),I}function GA(I,G,l){let b=0;return d;function d(N){return I.enter("atxHeading"),e(N)}function e(N){return I.enter("atxHeadingSequence"),t(N)}function t(N){return N===35&&b++<6?(I.consume(N),t):N===null||jc(N)?(I.exit("atxHeadingSequence"),W(N)):l(N)}function W(N){return N===35?(I.enter("atxHeadingSequence"),n(N)):N===null||Tl(N)?(I.exit("atxHeading"),G(N)):oG(N)?HG(I,W,"whitespace")(N):(I.enter("atxHeadingText"),s(N))}function n(N){return N===35?(I.consume(N),n):(I.exit("atxHeadingSequence"),W(N))}function s(N){return N===null||N===35||jc(N)?(I.exit("atxHeadingText"),W(N)):(I.consume(N),s)}}var lr=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],io=["pre","script","style","textarea"];var Qo={name:"htmlFlow",tokenize:ZA,resolveTo:dA,concrete:!0},cA={tokenize:aA,partial:!0},bA={tokenize:eA,partial:!0};function dA(I){let G=I.length;for(;G--&&!(I[G][0]==="enter"&&I[G][1].type==="htmlFlow"););return G>1&&I[G-2][1].type==="linePrefix"&&(I[G][1].start=I[G-2][1].start,I[G+1][1].start=I[G-2][1].start,I.splice(G-2,2)),I}function ZA(I,G,l){let b=this,d,e,t,W,n;return s;function s($){return N($)}function N($){return I.enter("htmlFlow"),I.enter("htmlFlowData"),I.consume($),m}function m($){return $===33?(I.consume($),h):$===47?(I.consume($),e=!0,p):$===63?(I.consume($),d=3,b.interrupt?G:eI):dd($)?(I.consume($),t=String.fromCharCode($),F):l($)}function h($){return $===45?(I.consume($),d=2,V):$===91?(I.consume($),d=5,W=0,X):dd($)?(I.consume($),d=4,b.interrupt?G:eI):l($)}function V($){return $===45?(I.consume($),b.interrupt?G:eI):l($)}function X($){let JI="CDATA[";return $===JI.charCodeAt(W++)?(I.consume($),W===JI.length?b.interrupt?G:hI:X):l($)}function p($){return dd($)?(I.consume($),t=String.fromCharCode($),F):l($)}function F($){if($===null||$===47||$===62||jc($)){let JI=$===47,UI=t.toLowerCase();return!JI&&!e&&io.includes(UI)?(d=1,b.interrupt?G($):hI($)):lr.includes(t.toLowerCase())?(d=6,JI?(I.consume($),a):b.interrupt?G($):hI($)):(d=7,b.interrupt&&!b.parser.lazy[b.now().line]?l($):e?u($):Q($))}return $===45||Zb($)?(I.consume($),t+=String.fromCharCode($),F):l($)}function a($){return $===62?(I.consume($),b.interrupt?G:hI):l($)}function u($){return oG($)?(I.consume($),u):S($)}function Q($){return $===47?(I.consume($),S):$===58||$===95||dd($)?(I.consume($),o):oG($)?(I.consume($),Q):S($)}function o($){return $===45||$===46||$===58||$===95||Zb($)?(I.consume($),o):y($)}function y($){return $===61?(I.consume($),H):oG($)?(I.consume($),y):Q($)}function H($){return $===null||$===60||$===61||$===62||$===96?l($):$===34||$===39?(I.consume($),n=$,E):oG($)?(I.consume($),H):C($)}function E($){return $===n?(I.consume($),n=null,T):$===null||Tl($)?l($):(I.consume($),E)}function C($){return $===null||$===34||$===39||$===47||$===60||$===61||$===62||$===96||jc($)?y($):(I.consume($),C)}function T($){return $===47||$===62||oG($)?Q($):l($)}function S($){return $===62?(I.consume($),cI):l($)}function cI($){return $===null||Tl($)?hI($):oG($)?(I.consume($),cI):l($)}function hI($){return $===45&&d===2?(I.consume($),ZI):$===60&&d===1?(I.consume($),dI):$===62&&d===4?(I.consume($),HI):$===63&&d===3?(I.consume($),eI):$===93&&d===5?(I.consume($),yI):Tl($)&&(d===6||d===7)?(I.exit("htmlFlowData"),I.check(cA,YI,WI)($)):$===null||Tl($)?(I.exit("htmlFlowData"),WI($)):(I.consume($),hI)}function WI($){return I.check(bA,VI,YI)($)}function VI($){return I.enter("lineEnding"),I.consume($),I.exit("lineEnding"),sI}function sI($){return $===null||Tl($)?WI($):(I.enter("htmlFlowData"),hI($))}function ZI($){return $===45?(I.consume($),eI):hI($)}function dI($){return $===47?(I.consume($),t="",pI):hI($)}function pI($){if($===62){let JI=t.toLowerCase();return io.includes(JI)?(I.consume($),HI):hI($)}return dd($)&&t.length<8?(I.consume($),t+=String.fromCharCode($),pI):hI($)}function yI($){return $===93?(I.consume($),eI):hI($)}function eI($){return $===62?(I.consume($),HI):$===45&&d===2?(I.consume($),eI):hI($)}function HI($){return $===null||Tl($)?(I.exit("htmlFlowData"),YI($)):(I.consume($),HI)}function YI($){return I.exit("htmlFlow"),G($)}}function eA(I,G,l){let b=this;return d;function d(t){return Tl(t)?(I.enter("lineEnding"),I.consume(t),I.exit("lineEnding"),e):l(t)}function e(t){return b.parser.lazy[b.now().line]?l(t):G(t)}}function aA(I,G,l){return b;function b(d){return I.enter("lineEnding"),I.consume(d),I.exit("lineEnding"),I.attempt(Ae,G,l)}}var Ho={name:"htmlText",tokenize:WA};function WA(I,G,l){let b=this,d,e,t;return W;function W(eI){return I.enter("htmlText"),I.enter("htmlTextData"),I.consume(eI),n}function n(eI){return eI===33?(I.consume(eI),s):eI===47?(I.consume(eI),y):eI===63?(I.consume(eI),Q):dd(eI)?(I.consume(eI),C):l(eI)}function s(eI){return eI===45?(I.consume(eI),N):eI===91?(I.consume(eI),e=0,X):dd(eI)?(I.consume(eI),u):l(eI)}function N(eI){return eI===45?(I.consume(eI),V):l(eI)}function m(eI){return eI===null?l(eI):eI===45?(I.consume(eI),h):Tl(eI)?(t=m,dI(eI)):(I.consume(eI),m)}function h(eI){return eI===45?(I.consume(eI),V):m(eI)}function V(eI){return eI===62?ZI(eI):eI===45?h(eI):m(eI)}function X(eI){let HI="CDATA[";return eI===HI.charCodeAt(e++)?(I.consume(eI),e===HI.length?p:X):l(eI)}function p(eI){return eI===null?l(eI):eI===93?(I.consume(eI),F):Tl(eI)?(t=p,dI(eI)):(I.consume(eI),p)}function F(eI){return eI===93?(I.consume(eI),a):p(eI)}function a(eI){return eI===62?ZI(eI):eI===93?(I.consume(eI),a):p(eI)}function u(eI){return eI===null||eI===62?ZI(eI):Tl(eI)?(t=u,dI(eI)):(I.consume(eI),u)}function Q(eI){return eI===null?l(eI):eI===63?(I.consume(eI),o):Tl(eI)?(t=Q,dI(eI)):(I.consume(eI),Q)}function o(eI){return eI===62?ZI(eI):Q(eI)}function y(eI){return dd(eI)?(I.consume(eI),H):l(eI)}function H(eI){return eI===45||Zb(eI)?(I.consume(eI),H):E(eI)}function E(eI){return Tl(eI)?(t=E,dI(eI)):oG(eI)?(I.consume(eI),E):ZI(eI)}function C(eI){return eI===45||Zb(eI)?(I.consume(eI),C):eI===47||eI===62||jc(eI)?T(eI):l(eI)}function T(eI){return eI===47?(I.consume(eI),ZI):eI===58||eI===95||dd(eI)?(I.consume(eI),S):Tl(eI)?(t=T,dI(eI)):oG(eI)?(I.consume(eI),T):ZI(eI)}function S(eI){return eI===45||eI===46||eI===58||eI===95||Zb(eI)?(I.consume(eI),S):cI(eI)}function cI(eI){return eI===61?(I.consume(eI),hI):Tl(eI)?(t=cI,dI(eI)):oG(eI)?(I.consume(eI),cI):T(eI)}function hI(eI){return eI===null||eI===60||eI===61||eI===62||eI===96?l(eI):eI===34||eI===39?(I.consume(eI),d=eI,WI):Tl(eI)?(t=hI,dI(eI)):oG(eI)?(I.consume(eI),hI):(I.consume(eI),VI)}function WI(eI){return eI===d?(I.consume(eI),d=void 0,sI):eI===null?l(eI):Tl(eI)?(t=WI,dI(eI)):(I.consume(eI),WI)}function VI(eI){return eI===null||eI===34||eI===39||eI===60||eI===61||eI===96?l(eI):eI===47||eI===62||jc(eI)?T(eI):(I.consume(eI),VI)}function sI(eI){return eI===47||eI===62||jc(eI)?T(eI):l(eI)}function ZI(eI){return eI===62?(I.consume(eI),I.exit("htmlTextData"),I.exit("htmlText"),G):l(eI)}function dI(eI){return I.exit("htmlTextData"),I.enter("lineEnding"),I.consume(eI),I.exit("lineEnding"),pI}function pI(eI){return oG(eI)?HG(I,yI,"linePrefix",b.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(eI):yI(eI)}function yI(eI){return I.enter("htmlTextData"),t(eI)}}var Oa={name:"labelEnd",tokenize:YA,resolveTo:sA,resolveAll:NA},tA={tokenize:hA},nA={tokenize:VA},mA={tokenize:pA};function NA(I){let G=-1;for(;++G<I.length;){let l=I[G][1];(l.type==="labelImage"||l.type==="labelLink"||l.type==="labelEnd")&&(I.splice(G+1,l.type==="labelImage"?4:2),l.type="data",G++)}return I}function sA(I,G){let l=I.length,b=0,d,e,t,W;for(;l--;)if(d=I[l][1],e){if(d.type==="link"||d.type==="labelLink"&&d._inactive)break;I[l][0]==="enter"&&d.type==="labelLink"&&(d._inactive=!0)}else if(t){if(I[l][0]==="enter"&&(d.type==="labelImage"||d.type==="labelLink")&&!d._balanced&&(e=l,d.type!=="labelLink")){b=2;break}}else d.type==="labelEnd"&&(t=l);let n={type:I[e][1].type==="labelLink"?"link":"image",start:Object.assign({},I[e][1].start),end:Object.assign({},I[I.length-1][1].end)},s={type:"label",start:Object.assign({},I[e][1].start),end:Object.assign({},I[t][1].end)},N={type:"labelText",start:Object.assign({},I[e+b+2][1].end),end:Object.assign({},I[t-2][1].start)};return W=[["enter",n,G],["enter",s,G]],W=Cb(W,I.slice(e+1,e+b+3)),W=Cb(W,[["enter",N,G]]),W=Cb(W,Ln(G.parser.constructs.insideSpan.null,I.slice(e+b+4,t-3),G)),W=Cb(W,[["exit",N,G],I[t-2],I[t-1],["exit",s,G]]),W=Cb(W,I.slice(t+1)),W=Cb(W,[["exit",n,G]]),Nb(I,e,I.length,W),I}function YA(I,G,l){let b=this,d=b.events.length,e,t;for(;d--;)if((b.events[d][1].type==="labelImage"||b.events[d][1].type==="labelLink")&&!b.events[d][1]._balanced){e=b.events[d][1];break}return W;function W(h){return e?e._inactive?m(h):(t=b.parser.defined.includes(BZ(b.sliceSerialize({start:e.end,end:b.now()}))),I.enter("labelEnd"),I.enter("labelMarker"),I.consume(h),I.exit("labelMarker"),I.exit("labelEnd"),n):l(h)}function n(h){return h===40?I.attempt(tA,N,t?N:m)(h):h===91?I.attempt(nA,N,t?s:m)(h):t?N(h):m(h)}function s(h){return I.attempt(mA,N,m)(h)}function N(h){return G(h)}function m(h){return e._balanced=!0,l(h)}}function hA(I,G,l){return b;function b(m){return I.enter("resource"),I.enter("resourceMarker"),I.consume(m),I.exit("resourceMarker"),d}function d(m){return jc(m)?Ba(I,e)(m):e(m)}function e(m){return m===41?N(m):$p(I,t,W,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(m)}function t(m){return jc(m)?Ba(I,n)(m):N(m)}function W(m){return l(m)}function n(m){return m===34||m===39||m===40?lu(I,s,l,"resourceTitle","resourceTitleMarker","resourceTitleString")(m):N(m)}function s(m){return jc(m)?Ba(I,N)(m):N(m)}function N(m){return m===41?(I.enter("resourceMarker"),I.consume(m),I.exit("resourceMarker"),I.exit("resource"),G):l(m)}}function VA(I,G,l){let b=this;return d;function d(W){return Iu.call(b,I,e,t,"reference","referenceMarker","referenceString")(W)}function e(W){return b.parser.defined.includes(BZ(b.sliceSerialize(b.events[b.events.length-1][1]).slice(1,-1)))?G(W):l(W)}function t(W){return l(W)}}function pA(I,G,l){return b;function b(e){return I.enter("reference"),I.enter("referenceMarker"),I.consume(e),I.exit("referenceMarker"),d}function d(e){return e===93?(I.enter("referenceMarker"),I.consume(e),I.exit("referenceMarker"),I.exit("reference"),G):l(e)}}var ro={name:"labelStartImage",tokenize:uA,resolveAll:Oa.resolveAll};function uA(I,G,l){let b=this;return d;function d(W){return I.enter("labelImage"),I.enter("labelImageMarker"),I.consume(W),I.exit("labelImageMarker"),e}function e(W){return W===91?(I.enter("labelMarker"),I.consume(W),I.exit("labelMarker"),I.exit("labelImage"),t):l(W)}function t(W){return W===94&&"_hiddenFootnoteSupport"in b.parser.constructs?l(W):G(W)}}var wo={name:"labelStartLink",tokenize:RA,resolveAll:Oa.resolveAll};function RA(I,G,l){let b=this;return d;function d(t){return I.enter("labelLink"),I.enter("labelMarker"),I.consume(t),I.exit("labelMarker"),I.exit("labelLink"),e}function e(t){return t===94&&"_hiddenFootnoteSupport"in b.parser.constructs?l(t):G(t)}}var nh={name:"lineEnding",tokenize:oA};function oA(I,G){return l;function l(b){return I.enter("lineEnding"),I.consume(b),I.exit("lineEnding"),HG(I,G,"linePrefix")}}var ja={name:"thematicBreak",tokenize:FA};function FA(I,G,l){let b=0,d;return e;function e(s){return I.enter("thematicBreak"),t(s)}function t(s){return d=s,W(s)}function W(s){return s===d?(I.enter("thematicBreakSequence"),n(s)):b>=3&&(s===null||Tl(s))?(I.exit("thematicBreak"),G(s)):l(s)}function n(s){return s===d?(I.consume(s),b++,n):(I.exit("thematicBreakSequence"),oG(s)?HG(I,W,"whitespace")(s):W(s))}}var Rb={name:"list",tokenize:QA,continuation:{tokenize:HA},exit:wA},XA={tokenize:vA,partial:!0},iA={tokenize:rA,partial:!0};function QA(I,G,l){let b=this,d=b.events[b.events.length-1],e=d&&d[1].type==="linePrefix"?d[2].sliceSerialize(d[1],!0).length:0,t=0;return W;function W(V){let X=b.containerState.type||(V===42||V===43||V===45?"listUnordered":"listOrdered");if(X==="listUnordered"?!b.containerState.marker||V===b.containerState.marker:ah(V)){if(b.containerState.type||(b.containerState.type=X,I.enter(X,{_container:!0})),X==="listUnordered")return I.enter("listItemPrefix"),V===42||V===45?I.check(ja,l,s)(V):s(V);if(!b.interrupt||V===49)return I.enter("listItemPrefix"),I.enter("listItemValue"),n(V)}return l(V)}function n(V){return ah(V)&&++t<10?(I.consume(V),n):(!b.interrupt||t<2)&&(b.containerState.marker?V===b.containerState.marker:V===41||V===46)?(I.exit("listItemValue"),s(V)):l(V)}function s(V){return I.enter("listItemMarker"),I.consume(V),I.exit("listItemMarker"),b.containerState.marker=b.containerState.marker||V,I.check(Ae,b.interrupt?l:N,I.attempt(XA,h,m))}function N(V){return b.containerState.initialBlankLine=!0,e++,h(V)}function m(V){return oG(V)?(I.enter("listItemPrefixWhitespace"),I.consume(V),I.exit("listItemPrefixWhitespace"),h):l(V)}function h(V){return b.containerState.size=e+b.sliceSerialize(I.exit("listItemPrefix"),!0).length,G(V)}}function HA(I,G,l){let b=this;return b.containerState._closeFlow=void 0,I.check(Ae,d,e);function d(W){return b.containerState.furtherBlankLines=b.containerState.furtherBlankLines||b.containerState.initialBlankLine,HG(I,G,"listItemIndent",b.containerState.size+1)(W)}function e(W){return b.containerState.furtherBlankLines||!oG(W)?(b.containerState.furtherBlankLines=void 0,b.containerState.initialBlankLine=void 0,t(W)):(b.containerState.furtherBlankLines=void 0,b.containerState.initialBlankLine=void 0,I.attempt(iA,G,t)(W))}function t(W){return b.containerState._closeFlow=!0,b.interrupt=void 0,HG(I,I.attempt(Rb,G,l),"linePrefix",b.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(W)}}function rA(I,G,l){let b=this;return HG(I,d,"listItemIndent",b.containerState.size+1);function d(e){let t=b.events[b.events.length-1];return t&&t[1].type==="listItemIndent"&&t[2].sliceSerialize(t[1],!0).length===b.containerState.size?G(e):l(e)}}function wA(I){I.exit(this.containerState.type)}function vA(I,G,l){let b=this;return HG(I,d,"listItemPrefixWhitespace",b.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function d(e){let t=b.events[b.events.length-1];return!oG(e)&&t&&t[1].type==="listItemPrefixWhitespace"?G(e):l(e)}}var Gu={name:"setextUnderline",tokenize:yA,resolveTo:EA};function EA(I,G){let l=I.length,b,d,e;for(;l--;)if(I[l][0]==="enter"){if(I[l][1].type==="content"){b=l;break}I[l][1].type==="paragraph"&&(d=l)}else I[l][1].type==="content"&&I.splice(l,1),!e&&I[l][1].type==="definition"&&(e=l);let t={type:"setextHeading",start:Object.assign({},I[d][1].start),end:Object.assign({},I[I.length-1][1].end)};return I[d][1].type="setextHeadingText",e?(I.splice(d,0,["enter",t,G]),I.splice(e+1,0,["exit",I[b][1],G]),I[b][1].end=Object.assign({},I[e][1].end)):I[b][1]=t,I.push(["exit",t,G]),I}function yA(I,G,l){let b=this,d;return e;function e(s){let N=b.events.length,m;for(;N--;)if(b.events[N][1].type!=="lineEnding"&&b.events[N][1].type!=="linePrefix"&&b.events[N][1].type!=="content"){m=b.events[N][1].type==="paragraph";break}return!b.parser.lazy[b.now().line]&&(b.interrupt||m)?(I.enter("setextHeadingLine"),d=s,t(s)):l(s)}function t(s){return I.enter("setextHeadingLineSequence"),W(s)}function W(s){return s===d?(I.consume(s),W):(I.exit("setextHeadingLineSequence"),oG(s)?HG(I,n,"lineSuffix")(s):n(s))}function n(s){return s===null||Tl(s)?(I.exit("setextHeadingLine"),G(s)):l(s)}}var Gr={tokenize:gA};function gA(I){let G=this,l=I.attempt(Ae,b,I.attempt(this.parser.constructs.flowInitial,d,HG(I,I.attempt(this.parser.constructs.flow,d,I.attempt(Ro,d)),"linePrefix")));return l;function b(e){if(e===null){I.consume(e);return}return I.enter("lineEndingBlank"),I.consume(e),I.exit("lineEndingBlank"),G.currentConstruct=void 0,l}function d(e){if(e===null){I.consume(e);return}return I.enter("lineEnding"),I.consume(e),I.exit("lineEnding"),G.currentConstruct=void 0,l}}var cr={resolveAll:er()},br=Zr("string"),dr=Zr("text");function Zr(I){return{tokenize:G,resolveAll:er(I==="text"?JA:void 0)};function G(l){let b=this,d=this.parser.constructs[I],e=l.attempt(d,t,W);return t;function t(N){return s(N)?e(N):W(N)}function W(N){if(N===null){l.consume(N);return}return l.enter("data"),l.consume(N),n}function n(N){return s(N)?(l.exit("data"),e(N)):(l.consume(N),n)}function s(N){if(N===null)return!0;let m=d[N],h=-1;if(m)for(;++h<m.length;){let V=m[h];if(!V.previous||V.previous.call(b,b.previous))return!0}return!1}}}function er(I){return G;function G(l,b){let d=-1,e;for(;++d<=l.length;)e===void 0?l[d]&&l[d][1].type==="data"&&(e=d,d++):(!l[d]||l[d][1].type!=="data")&&(d!==e+2&&(l[e][1].end=l[d-1][1].end,l.splice(e+2,d-e-2),d=e+2),e=void 0);return I?I(l,b):l}}function JA(I,G){let l=0;for(;++l<=I.length;)if((l===I.length||I[l][1].type==="lineEnding")&&I[l-1][1].type==="data"){let b=I[l-1][1],d=G.sliceStream(b),e=d.length,t=-1,W=0,n;for(;e--;){let s=d[e];if(typeof s=="string"){for(t=s.length;s.charCodeAt(t-1)===32;)W++,t--;if(t)break;t=-1}else if(s===-2)n=!0,W++;else if(s!==-1){e++;break}}if(W){let s={type:l===I.length||n||W<2?"lineSuffix":"hardBreakTrailing",start:{line:b.end.line,column:b.end.column-W,offset:b.end.offset-W,_index:b.start._index+e,_bufferIndex:e?t:b.start._bufferIndex+t},end:Object.assign({},b.end)};b.end=Object.assign({},s.start),b.start.offset===b.end.offset?Object.assign(b,s):(I.splice(l,0,["enter",s,G],["exit",s,G]),l+=2)}l++}return I}function ar(I,G,l){let b=Object.assign(l?Object.assign({},l):{line:1,column:1,offset:0},{_index:0,_bufferIndex:-1}),d={},e=[],t=[],W=[],n=!0,s={consume:o,enter:y,exit:H,attempt:T(E),check:T(C),interrupt:T(C,{interrupt:!0})},N={previous:null,code:null,containerState:{},events:[],parser:I,sliceStream:p,sliceSerialize:X,now:F,defineSkip:a,write:V},m=G.tokenize.call(N,s),h;return G.resolveAll&&e.push(G),N;function V(WI){return t=Cb(t,WI),u(),t[t.length-1]!==null?[]:(S(G,0),N.events=Ln(e,N.events,N),N.events)}function X(WI,VI){return AA(p(WI),VI)}function p(WI){return CA(t,WI)}function F(){let{line:WI,column:VI,offset:sI,_index:ZI,_bufferIndex:dI}=b;return{line:WI,column:VI,offset:sI,_index:ZI,_bufferIndex:dI}}function a(WI){d[WI.line]=WI.column,hI()}function u(){let WI;for(;b._index<t.length;){let VI=t[b._index];if(typeof VI=="string")for(WI=b._index,b._bufferIndex<0&&(b._bufferIndex=0);b._index===WI&&b._bufferIndex<VI.length;)Q(VI.charCodeAt(b._bufferIndex));else Q(VI)}}function Q(WI){n=void 0,h=WI,m=m(WI)}function o(WI){Tl(WI)?(b.line++,b.column=1,b.offset+=WI===-3?2:1,hI()):WI!==-1&&(b.column++,b.offset++),b._bufferIndex<0?b._index++:(b._bufferIndex++,b._bufferIndex===t[b._index].length&&(b._bufferIndex=-1,b._index++)),N.previous=WI,n=!0}function y(WI,VI){let sI=VI||{};return sI.type=WI,sI.start=F(),N.events.push(["enter",sI,N]),W.push(sI),sI}function H(WI){let VI=W.pop();return VI.end=F(),N.events.push(["exit",VI,N]),VI}function E(WI,VI){S(WI,VI.from)}function C(WI,VI){VI.restore()}function T(WI,VI){return sI;function sI(ZI,dI,pI){let yI,eI,HI,YI;return Array.isArray(ZI)?JI(ZI):"tokenize"in ZI?JI([ZI]):$(ZI);function $(bI){return FI;function FI(U){let k=U!==null&&bI[U],w=U!==null&&bI.null,r=[...Array.isArray(k)?k:k?[k]:[],...Array.isArray(w)?w:w?[w]:[]];return JI(r)(U)}}function JI(bI){return yI=bI,eI=0,bI.length===0?pI:UI(bI[eI])}function UI(bI){return FI;function FI(U){return YI=cI(),HI=bI,bI.partial||(N.currentConstruct=bI),bI.name&&N.parser.constructs.disable.null.includes(bI.name)?L(U):bI.tokenize.call(VI?Object.assign(Object.create(N),VI):N,s,zI,L)(U)}}function zI(bI){return n=!0,WI(HI,YI),dI}function L(bI){return n=!0,YI.restore(),++eI<yI.length?UI(yI[eI]):pI}}}function S(WI,VI){WI.resolveAll&&!e.includes(WI)&&e.push(WI),WI.resolve&&Nb(N.events,VI,N.events.length-VI,WI.resolve(N.events.slice(VI),N)),WI.resolveTo&&(N.events=WI.resolveTo(N.events,N))}function cI(){let WI=F(),VI=N.previous,sI=N.currentConstruct,ZI=N.events.length,dI=Array.from(W);return{restore:pI,from:ZI};function pI(){b=WI,N.previous=VI,N.currentConstruct=sI,N.events.length=ZI,W=dI,hI()}}function hI(){b.line in d&&b.column<2&&(b.column=d[b.line],b.offset+=d[b.line]-1)}}function CA(I,G){let l=G.start._index,b=G.start._bufferIndex,d=G.end._index,e=G.end._bufferIndex,t;if(l===d)t=[I[l].slice(b,e)];else{if(t=I.slice(l,d),b>-1){let W=t[0];typeof W=="string"?t[0]=W.slice(b):t.shift()}e>0&&t.push(I[d].slice(0,e))}return t}function AA(I,G){let l=-1,b=[],d;for(;++l<I.length;){let e=I[l],t;if(typeof e=="string")t=e;else switch(e){case-5:{t="\r";break}case-4:{t=`
`;break}case-3:{t=`\r
`;break}case-2:{t=G?" ":"	";break}case-1:{if(!G&&d)continue;t=" ";break}default:t=String.fromCharCode(e)}d=e===-2,b.push(t)}return b.join("")}var vo={};Ui(vo,{attentionMarkers:()=>OA,contentInitial:()=>kA,disable:()=>jA,document:()=>LA,flow:()=>zA,flowInitial:()=>xA,insideSpan:()=>BA,string:()=>UA,text:()=>MA});var LA={42:Rb,43:Rb,45:Rb,48:Rb,49:Rb,50:Rb,51:Rb,52:Rb,53:Rb,54:Rb,55:Rb,56:Rb,57:Rb,62:Sp},kA={91:oo},xA={[-2]:th,[-1]:th,32:th},zA={35:Xo,42:ja,45:[Gu,ja],60:Qo,61:Gu,95:ja,96:_p,126:_p},UA={38:qp,92:Dp},MA={[-5]:nh,[-4]:nh,[-3]:nh,33:ro,38:qp,42:Wh,60:[po,Ho],91:wo,92:[Fo,Dp],93:Oa,95:Wh,96:uo},BA={null:[Wh,cr]},OA={null:[42,95]},jA={null:[]};function Wr(I){let l=BH([vo,...(I||{}).extensions||[]]),b={defined:[],lazy:{},constructs:l,content:d(DH),document:d(_H),flow:d(Gr),string:d(br),text:d(dr)};return b;function d(e){return t;function t(W){return ar(b,e,W)}}}var tr=/[\0\t\n\r]/g;function nr(){let I=1,G="",l=!0,b;return d;function d(e,t,W){let n=[],s,N,m,h,V;for(e=G+e.toString(t),m=0,G="",l&&(e.charCodeAt(0)===65279&&m++,l=void 0);m<e.length;){if(tr.lastIndex=m,s=tr.exec(e),h=s&&s.index!==void 0?s.index:e.length,V=e.charCodeAt(h),!s){G=e.slice(m);break}if(V===10&&m===h&&b)n.push(-3),b=void 0;else switch(b&&(n.push(-5),b=void 0),m<h&&(n.push(e.slice(m,h)),I+=h-m),V){case 0:{n.push(65533),I++;break}case 9:{for(N=Math.ceil(I/4)*4,n.push(-2);I++<N;)n.push(-1);break}case 10:{n.push(-4),I=1;break}default:b=!0,I=1}m=h+1}return W&&(b&&n.push(-5),G&&n.push(G),n.push(null)),n}}function mr(I){for(;!Pp(I););return I}function cu(I,G){let l=Number.parseInt(I,G);return l<9||l===11||l>13&&l<32||l>126&&l<160||l>55295&&l<57344||l>64975&&l<65008||(l&65535)===65535||(l&65535)===65534||l>1114111?"\uFFFD":String.fromCharCode(l)}var KA=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function Nr(I){return I.replace(KA,TA)}function TA(I,G,l){if(G)return G;if(l.charCodeAt(0)===35){let d=l.charCodeAt(1),e=d===120||d===88;return cu(l.slice(e?2:1),e?16:10)}return kn(l)||I}var Yr={}.hasOwnProperty,Eo=function(I,G,l){return typeof G!="string"&&(l=G,G=void 0),fA(l)(mr(Wr(l).document().write(nr()(I,G,!0))))};function fA(I){let G={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:W(iI),autolinkProtocol:cI,autolinkEmail:cI,atxHeading:W(K),blockQuote:W(k),characterEscape:cI,characterReference:cI,codeFenced:W(w),codeFencedFenceInfo:n,codeFencedFenceMeta:n,codeIndented:W(w,n),codeText:W(r,n),codeTextData:cI,data:cI,codeFlowValue:cI,definition:W(A),definitionDestinationString:n,definitionLabelString:n,definitionTitleString:n,emphasis:W(O),hardBreakEscape:W(q),hardBreakTrailing:W(q),htmlFlow:W(GI,n),htmlFlowData:cI,htmlText:W(GI,n),htmlTextData:cI,image:W(tI),label:n,link:W(iI),listItem:W(aI),listItemValue:X,listOrdered:W(B,V),listUnordered:W(B),paragraph:W(lI),reference:UI,referenceString:n,resourceDestinationString:n,resourceTitleString:n,setextHeading:W(K),strong:W(QI),thematicBreak:W(OI)},exit:{atxHeading:N(),atxHeadingSequence:E,autolink:N(),autolinkEmail:U,autolinkProtocol:FI,blockQuote:N(),characterEscapeValue:hI,characterReferenceMarkerHexadecimal:L,characterReferenceMarkerNumeric:L,characterReferenceValue:bI,codeFenced:N(u),codeFencedFence:a,codeFencedFenceInfo:p,codeFencedFenceMeta:F,codeFlowValue:hI,codeIndented:N(Q),codeText:N(dI),codeTextData:hI,data:hI,definition:N(),definitionDestinationString:H,definitionLabelString:o,definitionTitleString:y,emphasis:N(),hardBreakEscape:N(VI),hardBreakTrailing:N(VI),htmlFlow:N(sI),htmlFlowData:hI,htmlText:N(ZI),htmlTextData:hI,image:N(yI),label:HI,labelText:eI,lineEnding:WI,link:N(pI),listItem:N(),listOrdered:N(),listUnordered:N(),paragraph:N(),referenceString:zI,resourceDestinationString:YI,resourceTitleString:$,resource:JI,setextHeading:N(S),setextHeadingLineSequence:T,setextHeadingText:C,strong:N(),thematicBreak:N()}};hr(G,(I||{}).mdastExtensions||[]);let l={};return b;function b(uI){let wI={type:"root",children:[]},kI={stack:[wI],tokenStack:[],config:G,enter:s,exit:m,buffer:n,resume:h,setData:e,getData:t},TI=[],Il=-1;for(;++Il<uI.length;)if(uI[Il][1].type==="listOrdered"||uI[Il][1].type==="listUnordered")if(uI[Il][0]==="enter")TI.push(Il);else{let nl=TI.pop();Il=d(uI,nl,Il)}for(Il=-1;++Il<uI.length;){let nl=G[uI[Il][0]];Yr.call(nl,uI[Il][1].type)&&nl[uI[Il][1].type].call(Object.assign({sliceSerialize:uI[Il][2].sliceSerialize},kI),uI[Il][1])}if(kI.tokenStack.length>0){let nl=kI.tokenStack[kI.tokenStack.length-1];(nl[1]||sr).call(kI,void 0,nl[0])}for(wI.position={start:Le(uI.length>0?uI[0][1].start:{line:1,column:1,offset:0}),end:Le(uI.length>0?uI[uI.length-2][1].end:{line:1,column:1,offset:0})},Il=-1;++Il<G.transforms.length;)wI=G.transforms[Il](wI)||wI;return wI}function d(uI,wI,kI){let TI=wI-1,Il=-1,nl=!1,ol,PI,KI,jI;for(;++TI<=kI;){let Wl=uI[TI];if(Wl[1].type==="listUnordered"||Wl[1].type==="listOrdered"||Wl[1].type==="blockQuote"?(Wl[0]==="enter"?Il++:Il--,jI=void 0):Wl[1].type==="lineEndingBlank"?Wl[0]==="enter"&&(ol&&!jI&&!Il&&!KI&&(KI=TI),jI=void 0):Wl[1].type==="linePrefix"||Wl[1].type==="listItemValue"||Wl[1].type==="listItemMarker"||Wl[1].type==="listItemPrefix"||Wl[1].type==="listItemPrefixWhitespace"||(jI=void 0),!Il&&Wl[0]==="enter"&&Wl[1].type==="listItemPrefix"||Il===-1&&Wl[0]==="exit"&&(Wl[1].type==="listUnordered"||Wl[1].type==="listOrdered")){if(ol){let wl=TI;for(PI=void 0;wl--;){let Ol=uI[wl];if(Ol[1].type==="lineEnding"||Ol[1].type==="lineEndingBlank"){if(Ol[0]==="exit")continue;PI&&(uI[PI][1].type="lineEndingBlank",nl=!0),Ol[1].type="lineEnding",PI=wl}else if(!(Ol[1].type==="linePrefix"||Ol[1].type==="blockQuotePrefix"||Ol[1].type==="blockQuotePrefixWhitespace"||Ol[1].type==="blockQuoteMarker"||Ol[1].type==="listItemIndent"))break}KI&&(!PI||KI<PI)&&(ol._spread=!0),ol.end=Object.assign({},PI?uI[PI][1].start:Wl[1].end),uI.splice(PI||TI,0,["exit",ol,Wl[2]]),TI++,kI++}Wl[1].type==="listItemPrefix"&&(ol={type:"listItem",_spread:!1,start:Object.assign({},Wl[1].start),end:void 0},uI.splice(TI,0,["enter",ol,Wl[2]]),TI++,kI++,KI=void 0,jI=!0)}}return uI[wI][1]._spread=nl,kI}function e(uI,wI){l[uI]=wI}function t(uI){return l[uI]}function W(uI,wI){return kI;function kI(TI){s.call(this,uI(TI),TI),wI&&wI.call(this,TI)}}function n(){this.stack.push({type:"fragment",children:[]})}function s(uI,wI,kI){return this.stack[this.stack.length-1].children.push(uI),this.stack.push(uI),this.tokenStack.push([wI,kI]),uI.position={start:Le(wI.start)},uI}function N(uI){return wI;function wI(kI){uI&&uI.call(this,kI),m.call(this,kI)}}function m(uI,wI){let kI=this.stack.pop(),TI=this.tokenStack.pop();if(TI)TI[0].type!==uI.type&&(wI?wI.call(this,uI,TI[0]):(TI[1]||sr).call(this,uI,TI[0]));else throw new Error("Cannot close `"+uI.type+"` ("+Je({start:uI.start,end:uI.end})+"): it\u2019s not open");return kI.position.end=Le(uI.end),kI}function h(){return ho(this.stack.pop())}function V(){e("expectingFirstListItemValue",!0)}function X(uI){if(t("expectingFirstListItemValue")){let wI=this.stack[this.stack.length-2];wI.start=Number.parseInt(this.sliceSerialize(uI),10),e("expectingFirstListItemValue")}}function p(){let uI=this.resume(),wI=this.stack[this.stack.length-1];wI.lang=uI}function F(){let uI=this.resume(),wI=this.stack[this.stack.length-1];wI.meta=uI}function a(){t("flowCodeInside")||(this.buffer(),e("flowCodeInside",!0))}function u(){let uI=this.resume(),wI=this.stack[this.stack.length-1];wI.value=uI.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),e("flowCodeInside")}function Q(){let uI=this.resume(),wI=this.stack[this.stack.length-1];wI.value=uI.replace(/(\r?\n|\r)$/g,"")}function o(uI){let wI=this.resume(),kI=this.stack[this.stack.length-1];kI.label=wI,kI.identifier=BZ(this.sliceSerialize(uI)).toLowerCase()}function y(){let uI=this.resume(),wI=this.stack[this.stack.length-1];wI.title=uI}function H(){let uI=this.resume(),wI=this.stack[this.stack.length-1];wI.url=uI}function E(uI){let wI=this.stack[this.stack.length-1];if(!wI.depth){let kI=this.sliceSerialize(uI).length;wI.depth=kI}}function C(){e("setextHeadingSlurpLineEnding",!0)}function T(uI){let wI=this.stack[this.stack.length-1];wI.depth=this.sliceSerialize(uI).charCodeAt(0)===61?1:2}function S(){e("setextHeadingSlurpLineEnding")}function cI(uI){let wI=this.stack[this.stack.length-1],kI=wI.children[wI.children.length-1];(!kI||kI.type!=="text")&&(kI=vI(),kI.position={start:Le(uI.start)},wI.children.push(kI)),this.stack.push(kI)}function hI(uI){let wI=this.stack.pop();wI.value+=this.sliceSerialize(uI),wI.position.end=Le(uI.end)}function WI(uI){let wI=this.stack[this.stack.length-1];if(t("atHardBreak")){let kI=wI.children[wI.children.length-1];kI.position.end=Le(uI.end),e("atHardBreak");return}!t("setextHeadingSlurpLineEnding")&&G.canContainEols.includes(wI.type)&&(cI.call(this,uI),hI.call(this,uI))}function VI(){e("atHardBreak",!0)}function sI(){let uI=this.resume(),wI=this.stack[this.stack.length-1];wI.value=uI}function ZI(){let uI=this.resume(),wI=this.stack[this.stack.length-1];wI.value=uI}function dI(){let uI=this.resume(),wI=this.stack[this.stack.length-1];wI.value=uI}function pI(){let uI=this.stack[this.stack.length-1];if(t("inReference")){let wI=t("referenceType")||"shortcut";uI.type+="Reference",uI.referenceType=wI,delete uI.url,delete uI.title}else delete uI.identifier,delete uI.label;e("referenceType")}function yI(){let uI=this.stack[this.stack.length-1];if(t("inReference")){let wI=t("referenceType")||"shortcut";uI.type+="Reference",uI.referenceType=wI,delete uI.url,delete uI.title}else delete uI.identifier,delete uI.label;e("referenceType")}function eI(uI){let wI=this.sliceSerialize(uI),kI=this.stack[this.stack.length-2];kI.label=Nr(wI),kI.identifier=BZ(wI).toLowerCase()}function HI(){let uI=this.stack[this.stack.length-1],wI=this.resume(),kI=this.stack[this.stack.length-1];if(e("inReference",!0),kI.type==="link"){let TI=uI.children;kI.children=TI}else kI.alt=wI}function YI(){let uI=this.resume(),wI=this.stack[this.stack.length-1];wI.url=uI}function $(){let uI=this.resume(),wI=this.stack[this.stack.length-1];wI.title=uI}function JI(){e("inReference")}function UI(){e("referenceType","collapsed")}function zI(uI){let wI=this.resume(),kI=this.stack[this.stack.length-1];kI.label=wI,kI.identifier=BZ(this.sliceSerialize(uI)).toLowerCase(),e("referenceType","full")}function L(uI){e("characterReferenceType",uI.type)}function bI(uI){let wI=this.sliceSerialize(uI),kI=t("characterReferenceType"),TI;kI?(TI=cu(wI,kI==="characterReferenceMarkerNumeric"?10:16),e("characterReferenceType")):TI=kn(wI);let Il=this.stack.pop();Il.value+=TI,Il.position.end=Le(uI.end)}function FI(uI){hI.call(this,uI);let wI=this.stack[this.stack.length-1];wI.url=this.sliceSerialize(uI)}function U(uI){hI.call(this,uI);let wI=this.stack[this.stack.length-1];wI.url="mailto:"+this.sliceSerialize(uI)}function k(){return{type:"blockquote",children:[]}}function w(){return{type:"code",lang:null,meta:null,value:""}}function r(){return{type:"inlineCode",value:""}}function A(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function O(){return{type:"emphasis",children:[]}}function K(){return{type:"heading",depth:void 0,children:[]}}function q(){return{type:"break"}}function GI(){return{type:"html",value:""}}function tI(){return{type:"image",title:null,url:"",alt:null}}function iI(){return{type:"link",title:null,url:"",children:[]}}function B(uI){return{type:"list",ordered:uI.type==="listOrdered",start:null,spread:uI._spread,children:[]}}function aI(uI){return{type:"listItem",spread:uI._spread,checked:null,children:[]}}function lI(){return{type:"paragraph",children:[]}}function QI(){return{type:"strong",children:[]}}function vI(){return{type:"text",value:""}}function OI(){return{type:"thematicBreak"}}}function Le(I){return{line:I.line,column:I.column,offset:I.offset}}function hr(I,G){let l=-1;for(;++l<G.length;){let b=G[l];Array.isArray(b)?hr(I,b):SA(I,b)}}function SA(I,G){let l;for(l in G)if(Yr.call(G,l)){if(l==="canContainEols"){let b=G[l];b&&I[l].push(...b)}else if(l==="transforms"){let b=G[l];b&&I[l].push(...b)}else if(l==="enter"||l==="exit"){let b=G[l];b&&Object.assign(I[l],b)}}}function sr(I,G){throw I?new Error("Cannot close `"+I.type+"` ("+Je({start:I.start,end:I.end})+"): a different token (`"+G.type+"`, "+Je({start:G.start,end:G.end})+") is open"):new Error("Cannot close document, a token (`"+G.type+"`, "+Je({start:G.start,end:G.end})+") is still open")}function bu(I){Object.assign(this,{Parser:l=>{let b=this.data("settings");return Eo(l,Object.assign({},b,I,{extensions:this.data("micromarkExtensions")||[],mdastExtensions:this.data("fromMarkdownExtensions")||[]}))}})}function Vr(I,G){let l={type:"element",tagName:"blockquote",properties:{},children:I.wrap(I.all(G),!0)};return I.patch(G,l),I.applyData(G,l)}function pr(I,G){let l={type:"element",tagName:"br",properties:{},children:[]};return I.patch(G,l),[I.applyData(G,l),{type:"text",value:`
`}]}function ur(I,G){let l=G.value?G.value+`
`:"",b=G.lang?G.lang.match(/^[^ \t]+(?=[ \t]|$)/):null,d={};b&&(d.className=["language-"+b]);let e={type:"element",tagName:"code",properties:d,children:[{type:"text",value:l}]};return G.meta&&(e.data={meta:G.meta}),I.patch(G,e),e=I.applyData(G,e),e={type:"element",tagName:"pre",properties:{},children:[e]},I.patch(G,e),e}function Rr(I,G){let l={type:"element",tagName:"del",properties:{},children:I.all(G)};return I.patch(G,l),I.applyData(G,l)}function or(I,G){let l={type:"element",tagName:"em",properties:{},children:I.all(G)};return I.patch(G,l),I.applyData(G,l)}function wd(I){let G=[],l=-1,b=0,d=0;for(;++l<I.length;){let e=I.charCodeAt(l),t="";if(e===37&&Zb(I.charCodeAt(l+1))&&Zb(I.charCodeAt(l+2)))d=2;else if(e<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(e))||(t=String.fromCharCode(e));else if(e>55295&&e<57344){let W=I.charCodeAt(l+1);e<56320&&W>56319&&W<57344?(t=String.fromCharCode(e,W),d=1):t="\uFFFD"}else t=String.fromCharCode(e);t&&(G.push(I.slice(b,l),encodeURIComponent(t)),b=l+d+1,t=""),d&&(l+=d,d=0)}return G.join("")+I.slice(b)}function du(I,G){let l=String(G.identifier).toUpperCase(),b=wd(l.toLowerCase()),d=I.footnoteOrder.indexOf(l),e;d===-1?(I.footnoteOrder.push(l),I.footnoteCounts[l]=1,e=I.footnoteOrder.length):(I.footnoteCounts[l]++,e=d+1);let t=I.footnoteCounts[l],W={type:"element",tagName:"a",properties:{href:"#"+I.clobberPrefix+"fn-"+b,id:I.clobberPrefix+"fnref-"+b+(t>1?"-"+t:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(e)}]};I.patch(G,W);let n={type:"element",tagName:"sup",properties:{},children:[W]};return I.patch(G,n),I.applyData(G,n)}function Fr(I,G){let l=I.footnoteById,b=1;for(;b in l;)b++;let d=String(b);return l[d]={type:"footnoteDefinition",identifier:d,children:[{type:"paragraph",children:G.children}],position:G.position},du(I,{type:"footnoteReference",identifier:d,position:G.position})}function Xr(I,G){let l={type:"element",tagName:"h"+G.depth,properties:{},children:I.all(G)};return I.patch(G,l),I.applyData(G,l)}function ir(I,G){if(I.dangerous){let l={type:"raw",value:G.value};return I.patch(G,l),I.applyData(G,l)}return null}function Zu(I,G){let l=G.referenceType,b="]";if(l==="collapsed"?b+="[]":l==="full"&&(b+="["+(G.label||G.identifier)+"]"),G.type==="imageReference")return{type:"text",value:"!["+G.alt+b};let d=I.all(G),e=d[0];e&&e.type==="text"?e.value="["+e.value:d.unshift({type:"text",value:"["});let t=d[d.length-1];return t&&t.type==="text"?t.value+=b:d.push({type:"text",value:b}),d}function Qr(I,G){let l=I.definition(G.identifier);if(!l)return Zu(I,G);let b={src:wd(l.url||""),alt:G.alt};l.title!==null&&l.title!==void 0&&(b.title=l.title);let d={type:"element",tagName:"img",properties:b,children:[]};return I.patch(G,d),I.applyData(G,d)}function Hr(I,G){let l={src:wd(G.url)};G.alt!==null&&G.alt!==void 0&&(l.alt=G.alt),G.title!==null&&G.title!==void 0&&(l.title=G.title);let b={type:"element",tagName:"img",properties:l,children:[]};return I.patch(G,b),I.applyData(G,b)}function rr(I,G){let l={type:"text",value:G.value.replace(/\r?\n|\r/g," ")};I.patch(G,l);let b={type:"element",tagName:"code",properties:{},children:[l]};return I.patch(G,b),I.applyData(G,b)}function wr(I,G){let l=I.definition(G.identifier);if(!l)return Zu(I,G);let b={href:wd(l.url||"")};l.title!==null&&l.title!==void 0&&(b.title=l.title);let d={type:"element",tagName:"a",properties:b,children:I.all(G)};return I.patch(G,d),I.applyData(G,d)}function vr(I,G){let l={href:wd(G.url)};G.title!==null&&G.title!==void 0&&(l.title=G.title);let b={type:"element",tagName:"a",properties:l,children:I.all(G)};return I.patch(G,b),I.applyData(G,b)}function Er(I,G,l){let b=I.all(G),d=l?DA(l):yr(G),e={},t=[];if(typeof G.checked=="boolean"){let N=b[0],m;N&&N.type==="element"&&N.tagName==="p"?m=N:(m={type:"element",tagName:"p",properties:{},children:[]},b.unshift(m)),m.children.length>0&&m.children.unshift({type:"text",value:" "}),m.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:G.checked,disabled:!0},children:[]}),e.className=["task-list-item"]}let W=-1;for(;++W<b.length;){let N=b[W];(d||W!==0||N.type!=="element"||N.tagName!=="p")&&t.push({type:"text",value:`
`}),N.type==="element"&&N.tagName==="p"&&!d?t.push(...N.children):t.push(N)}let n=b[b.length-1];n&&(d||n.type!=="element"||n.tagName!=="p")&&t.push({type:"text",value:`
`});let s={type:"element",tagName:"li",properties:e,children:t};return I.patch(G,s),I.applyData(G,s)}function DA(I){let G=!1;if(I.type==="list"){G=I.spread||!1;let l=I.children,b=-1;for(;!G&&++b<l.length;)G=yr(l[b])}return G}function yr(I){let G=I.spread;return G??I.children.length>1}function gr(I,G){let l={},b=I.all(G),d=-1;for(typeof G.start=="number"&&G.start!==1&&(l.start=G.start);++d<b.length;){let t=b[d];if(t.type==="element"&&t.tagName==="li"&&t.properties&&Array.isArray(t.properties.className)&&t.properties.className.includes("task-list-item")){l.className=["contains-task-list"];break}}let e={type:"element",tagName:G.ordered?"ol":"ul",properties:l,children:I.wrap(b,!0)};return I.patch(G,e),I.applyData(G,e)}function Jr(I,G){let l={type:"element",tagName:"p",properties:{},children:I.all(G)};return I.patch(G,l),I.applyData(G,l)}function Cr(I,G){let l={type:"root",children:I.wrap(I.all(G))};return I.patch(G,l),I.applyData(G,l)}function Ar(I,G){let l={type:"element",tagName:"strong",properties:{},children:I.all(G)};return I.patch(G,l),I.applyData(G,l)}var xn=Lr("start"),zn=Lr("end");function yo(I){return{start:xn(I),end:zn(I)}}function Lr(I){return G;function G(l){let b=l&&l.position&&l.position[I]||{};return{line:b.line||null,column:b.column||null,offset:b.offset>-1?b.offset:null}}}function kr(I,G){let l=I.all(G),b=l.shift(),d=[];if(b){let t={type:"element",tagName:"thead",properties:{},children:I.wrap([b],!0)};I.patch(G.children[0],t),d.push(t)}if(l.length>0){let t={type:"element",tagName:"tbody",properties:{},children:I.wrap(l,!0)},W=xn(G.children[1]),n=zn(G.children[G.children.length-1]);W.line&&n.line&&(t.position={start:W,end:n}),d.push(t)}let e={type:"element",tagName:"table",properties:{},children:I.wrap(d,!0)};return I.patch(G,e),I.applyData(G,e)}function xr(I,G,l){let b=l?l.children:void 0,e=(b?b.indexOf(G):1)===0?"th":"td",t=l&&l.type==="table"?l.align:void 0,W=t?t.length:G.children.length,n=-1,s=[];for(;++n<W;){let m=G.children[n],h={},V=t?t[n]:void 0;V&&(h.align=V);let X={type:"element",tagName:e,properties:h,children:[]};m&&(X.children=I.all(m),I.patch(m,X),X=I.applyData(G,X)),s.push(X)}let N={type:"element",tagName:"tr",properties:{},children:I.wrap(s,!0)};return I.patch(G,N),I.applyData(G,N)}function zr(I,G){let l={type:"element",tagName:"td",properties:{},children:I.all(G)};return I.patch(G,l),I.applyData(G,l)}function Mr(I){let G=String(I),l=/\r?\n|\r/g,b=l.exec(G),d=0,e=[];for(;b;)e.push(Ur(G.slice(d,b.index),d>0,!0),b[0]),d=b.index+b[0].length,b=l.exec(G);return e.push(Ur(G.slice(d),d>0,!1)),e.join("")}function Ur(I,G,l){let b=0,d=I.length;if(G){let e=I.codePointAt(b);for(;e===9||e===32;)b++,e=I.codePointAt(b)}if(l){let e=I.codePointAt(d-1);for(;e===9||e===32;)d--,e=I.codePointAt(d-1)}return d>b?I.slice(b,d):""}function Br(I,G){let l={type:"text",value:Mr(String(G.value))};return I.patch(G,l),I.applyData(G,l)}function Or(I,G){let l={type:"element",tagName:"hr",properties:{},children:[]};return I.patch(G,l),I.applyData(G,l)}var jr={blockquote:Vr,break:pr,code:ur,delete:Rr,emphasis:or,footnoteReference:du,footnote:Fr,heading:Xr,html:ir,imageReference:Qr,image:Hr,inlineCode:rr,linkReference:wr,link:vr,listItem:Er,list:gr,paragraph:Jr,root:Cr,strong:Ar,table:kr,tableCell:zr,tableRow:xr,text:Br,thematicBreak:Or,toml:eu,yaml:eu,definition:eu,footnoteDefinition:eu};function eu(){return null}var Un=function(I){if(I==null)return $A;if(typeof I=="string")return PA(I);if(typeof I=="object")return Array.isArray(I)?qA(I):_A(I);if(typeof I=="function")return au(I);throw new Error("Expected function, string, or object as test")};function qA(I){let G=[],l=-1;for(;++l<I.length;)G[l]=Un(I[l]);return au(b);function b(...d){let e=-1;for(;++e<G.length;)if(G[e].call(this,...d))return!0;return!1}}function _A(I){return au(G);function G(l){let b;for(b in I)if(l[b]!==I[b])return!1;return!0}}function PA(I){return au(G);function G(l){return l&&l.type===I}}function au(I){return G;function G(l,...b){return!!(l&&typeof l=="object"&&"type"in l&&I.call(this,l,...b))}}function $A(){return!0}var go=!0,Wu=!1,Jo="skip",Co=function(I,G,l,b){typeof G=="function"&&typeof l!="function"&&(b=l,l=G,G=null);let d=Un(G),e=b?-1:1;t(I,void 0,[])();function t(W,n,s){let N=W&&typeof W=="object"?W:{};if(typeof N.type=="string"){let h=typeof N.tagName=="string"?N.tagName:typeof N.name=="string"?N.name:void 0;Object.defineProperty(m,"name",{value:"node ("+(W.type+(h?"<"+h+">":""))+")"})}return m;function m(){let h=[],V,X,p;if((!G||d(W,n,s[s.length-1]||null))&&(h=IL(l(W,s)),h[0]===Wu))return h;if(W.children&&h[0]!==Jo)for(X=(b?W.children.length:-1)+e,p=s.concat(W);X>-1&&X<W.children.length;){if(V=t(W.children[X],X,p)(),V[0]===Wu)return V;X=typeof V[1]=="number"?V[1]:X+e}return h}}};function IL(I){return Array.isArray(I)?I:typeof I=="number"?[go,I]:[I]}var OZ=function(I,G,l,b){typeof G=="function"&&typeof l!="function"&&(b=l,l=G,G=null),Co(I,G,d,b);function d(e,t){let W=t[t.length-1];return l(e,W?W.children.indexOf(e):null,W)}};function Ao(I){return!I||!I.position||!I.position.start||!I.position.start.line||!I.position.start.column||!I.position.end||!I.position.end.line||!I.position.end.column}var Kr={}.hasOwnProperty;function Lo(I){let G=Object.create(null);if(!I||!I.type)throw new Error("mdast-util-definitions expected node");return OZ(I,"definition",b=>{let d=Tr(b.identifier);d&&!Kr.call(G,d)&&(G[d]=b)}),l;function l(b){let d=Tr(b);return d&&Kr.call(G,d)?G[d]:null}}function Tr(I){return String(I||"").toUpperCase()}var tu={}.hasOwnProperty;function fr(I,G){let l=G||{},b=l.allowDangerousHtml||!1,d={};return t.dangerous=b,t.clobberPrefix=l.clobberPrefix===void 0||l.clobberPrefix===null?"user-content-":l.clobberPrefix,t.footnoteLabel=l.footnoteLabel||"Footnotes",t.footnoteLabelTagName=l.footnoteLabelTagName||"h2",t.footnoteLabelProperties=l.footnoteLabelProperties||{className:["sr-only"]},t.footnoteBackLabel=l.footnoteBackLabel||"Back to content",t.unknownHandler=l.unknownHandler,t.passThrough=l.passThrough,t.handlers={...jr,...l.handlers},t.definition=Lo(I),t.footnoteById=d,t.footnoteOrder=[],t.footnoteCounts={},t.patch=lL,t.applyData=GL,t.one=W,t.all=n,t.wrap=bL,t.augment=e,OZ(I,"footnoteDefinition",s=>{let N=String(s.identifier).toUpperCase();tu.call(d,N)||(d[N]=s)}),t;function e(s,N){if(s&&"data"in s&&s.data){let m=s.data;m.hName&&(N.type!=="element"&&(N={type:"element",tagName:"",properties:{},children:[]}),N.tagName=m.hName),N.type==="element"&&m.hProperties&&(N.properties={...N.properties,...m.hProperties}),"children"in N&&N.children&&m.hChildren&&(N.children=m.hChildren)}if(s){let m="type"in s?s:{position:s};Ao(m)||(N.position={start:xn(m),end:zn(m)})}return N}function t(s,N,m,h){return Array.isArray(m)&&(h=m,m={}),e(s,{type:"element",tagName:N,properties:m||{},children:h||[]})}function W(s,N){return Sr(t,s,N)}function n(s){return ko(t,s)}}function lL(I,G){I.position&&(G.position=yo(I))}function GL(I,G){let l=G;if(I&&I.data){let b=I.data.hName,d=I.data.hChildren,e=I.data.hProperties;typeof b=="string"&&(l.type==="element"?l.tagName=b:l={type:"element",tagName:b,properties:{},children:[]}),l.type==="element"&&e&&(l.properties={...l.properties,...e}),"children"in l&&l.children&&d!==null&&d!==void 0&&(l.children=d)}return l}function Sr(I,G,l){let b=G&&G.type;if(!b)throw new Error("Expected node, got `"+G+"`");return tu.call(I.handlers,b)?I.handlers[b](I,G,l):I.passThrough&&I.passThrough.includes(b)?"children"in G?{...G,children:ko(I,G)}:G:I.unknownHandler?I.unknownHandler(I,G,l):cL(I,G)}function ko(I,G){let l=[];if("children"in G){let b=G.children,d=-1;for(;++d<b.length;){let e=Sr(I,b[d],G);if(e){if(d&&b[d-1].type==="break"&&(!Array.isArray(e)&&e.type==="text"&&(e.value=e.value.replace(/^\s+/,"")),!Array.isArray(e)&&e.type==="element")){let t=e.children[0];t&&t.type==="text"&&(t.value=t.value.replace(/^\s+/,""))}Array.isArray(e)?l.push(...e):l.push(e)}}}return l}function cL(I,G){let l=G.data||{},b="value"in G&&!(tu.call(l,"hProperties")||tu.call(l,"hChildren"))?{type:"text",value:G.value}:{type:"element",tagName:"div",properties:{},children:ko(I,G)};return I.patch(G,b),I.applyData(G,b)}function bL(I,G){let l=[],b=-1;for(G&&l.push({type:"text",value:`
`});++b<I.length;)b&&l.push({type:"text",value:`
`}),l.push(I[b]);return G&&I.length>0&&l.push({type:"text",value:`
`}),l}function Dr(I){let G=[],l=-1;for(;++l<I.footnoteOrder.length;){let b=I.footnoteById[I.footnoteOrder[l]];if(!b)continue;let d=I.all(b),e=String(b.identifier).toUpperCase(),t=wd(e.toLowerCase()),W=0,n=[];for(;++W<=I.footnoteCounts[e];){let m={type:"element",tagName:"a",properties:{href:"#"+I.clobberPrefix+"fnref-"+t+(W>1?"-"+W:""),dataFootnoteBackref:!0,className:["data-footnote-backref"],ariaLabel:I.footnoteBackLabel},children:[{type:"text",value:"\u21A9"}]};W>1&&m.children.push({type:"element",tagName:"sup",children:[{type:"text",value:String(W)}]}),n.length>0&&n.push({type:"text",value:" "}),n.push(m)}let s=d[d.length-1];if(s&&s.type==="element"&&s.tagName==="p"){let m=s.children[s.children.length-1];m&&m.type==="text"?m.value+=" ":s.children.push({type:"text",value:" "}),s.children.push(...n)}else d.push(...n);let N={type:"element",tagName:"li",properties:{id:I.clobberPrefix+"fn-"+t},children:I.wrap(d,!0)};I.patch(b,N),G.push(N)}if(G.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:I.footnoteLabelTagName,properties:{...JSON.parse(JSON.stringify(I.footnoteLabelProperties)),id:"footnote-label"},children:[{type:"text",value:I.footnoteLabel}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:I.wrap(G,!0)},{type:"text",value:`
`}]}}function nu(I,G){let l=fr(I,G),b=l.one(I,null),d=Dr(l);return d&&b.children.push({type:"text",value:`
`},d),Array.isArray(b)?{type:"root",children:b}:b}var dL=function(I,G){return I&&"run"in I?ZL(I,G):eL(I||G)},xo=dL;function ZL(I,G){return(l,b,d)=>{I.run(nu(l,G),b,e=>{d(e)})}}function eL(I){return G=>nu(G,I)}var pG=el(cw(),1);var jZ=class{constructor(G,l,b){this.property=G,this.normal=l,b&&(this.space=b)}};jZ.prototype.property={};jZ.prototype.normal={};jZ.prototype.space=null;function zo(I,G){let l={},b={},d=-1;for(;++d<I.length;)Object.assign(l,I[d].property),Object.assign(b,I[d].normal);return new jZ(l,b,G)}function mh(I){return I.toLowerCase()}var ob=class{constructor(G,l){this.property=G,this.attribute=l}};ob.prototype.space=null;ob.prototype.boolean=!1;ob.prototype.booleanish=!1;ob.prototype.overloadedBoolean=!1;ob.prototype.number=!1;ob.prototype.commaSeparated=!1;ob.prototype.spaceSeparated=!1;ob.prototype.commaOrSpaceSeparated=!1;ob.prototype.mustUseProperty=!1;ob.prototype.defined=!1;var Nh={};Ui(Nh,{boolean:()=>FG,booleanish:()=>Lc,commaOrSpaceSeparated:()=>jb,commaSeparated:()=>ke,number:()=>Ql,overloadedBoolean:()=>Uo,spaceSeparated:()=>$G});var tL=0,FG=Ka(),Lc=Ka(),Uo=Ka(),Ql=Ka(),$G=Ka(),ke=Ka(),jb=Ka();function Ka(){return 2**++tL}var Mo=Object.keys(Nh),Ta=class extends ob{constructor(G,l,b,d){let e=-1;if(super(G,l),bw(this,"space",d),typeof b=="number")for(;++e<Mo.length;){let t=Mo[e];bw(this,Mo[e],(b&Nh[t])===Nh[t])}}};Ta.prototype.defined=!0;function bw(I,G,l){l&&(I[G]=l)}var nL={}.hasOwnProperty;function vd(I){let G={},l={},b;for(b in I.properties)if(nL.call(I.properties,b)){let d=I.properties[b],e=new Ta(b,I.transform(I.attributes||{},b),d,I.space);I.mustUseProperty&&I.mustUseProperty.includes(b)&&(e.mustUseProperty=!0),G[b]=e,l[mh(b)]=b,l[mh(e.attribute)]=b}return new jZ(G,l,I.space)}var Bo=vd({space:"xlink",transform(I,G){return"xlink:"+G.slice(5).toLowerCase()},properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null}});var Oo=vd({space:"xml",transform(I,G){return"xml:"+G.slice(3).toLowerCase()},properties:{xmlLang:null,xmlBase:null,xmlSpace:null}});function mu(I,G){return G in I?I[G]:G}function Nu(I,G){return mu(I,G.toLowerCase())}var jo=vd({space:"xmlns",attributes:{xmlnsxlink:"xmlns:xlink"},transform:Nu,properties:{xmlns:null,xmlnsXLink:null}});var Ko=vd({transform(I,G){return G==="role"?G:"aria-"+G.slice(4).toLowerCase()},properties:{ariaActiveDescendant:null,ariaAtomic:Lc,ariaAutoComplete:null,ariaBusy:Lc,ariaChecked:Lc,ariaColCount:Ql,ariaColIndex:Ql,ariaColSpan:Ql,ariaControls:$G,ariaCurrent:null,ariaDescribedBy:$G,ariaDetails:null,ariaDisabled:Lc,ariaDropEffect:$G,ariaErrorMessage:null,ariaExpanded:Lc,ariaFlowTo:$G,ariaGrabbed:Lc,ariaHasPopup:null,ariaHidden:Lc,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:$G,ariaLevel:Ql,ariaLive:null,ariaModal:Lc,ariaMultiLine:Lc,ariaMultiSelectable:Lc,ariaOrientation:null,ariaOwns:$G,ariaPlaceholder:null,ariaPosInSet:Ql,ariaPressed:Lc,ariaReadOnly:Lc,ariaRelevant:null,ariaRequired:Lc,ariaRoleDescription:$G,ariaRowCount:Ql,ariaRowIndex:Ql,ariaRowSpan:Ql,ariaSelected:Lc,ariaSetSize:Ql,ariaSort:null,ariaValueMax:Ql,ariaValueMin:Ql,ariaValueNow:Ql,ariaValueText:null,role:null}});var dw=vd({space:"html",attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},transform:Nu,mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:ke,acceptCharset:$G,accessKey:$G,action:null,allow:null,allowFullScreen:FG,allowPaymentRequest:FG,allowUserMedia:FG,alt:null,as:null,async:FG,autoCapitalize:null,autoComplete:$G,autoFocus:FG,autoPlay:FG,blocking:$G,capture:FG,charSet:null,checked:FG,cite:null,className:$G,cols:Ql,colSpan:null,content:null,contentEditable:Lc,controls:FG,controlsList:$G,coords:Ql|ke,crossOrigin:null,data:null,dateTime:null,decoding:null,default:FG,defer:FG,dir:null,dirName:null,disabled:FG,download:Uo,draggable:Lc,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:FG,formTarget:null,headers:$G,height:Ql,hidden:FG,high:Ql,href:null,hrefLang:null,htmlFor:$G,httpEquiv:$G,id:null,imageSizes:null,imageSrcSet:null,inert:FG,inputMode:null,integrity:null,is:null,isMap:FG,itemId:null,itemProp:$G,itemRef:$G,itemScope:FG,itemType:$G,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:FG,low:Ql,manifest:null,max:null,maxLength:Ql,media:null,method:null,min:null,minLength:Ql,multiple:FG,muted:FG,name:null,nonce:null,noModule:FG,noValidate:FG,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:FG,optimum:Ql,pattern:null,ping:$G,placeholder:null,playsInline:FG,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:FG,referrerPolicy:null,rel:$G,required:FG,reversed:FG,rows:Ql,rowSpan:Ql,sandbox:$G,scope:null,scoped:FG,seamless:FG,selected:FG,shadowRootDelegatesFocus:FG,shadowRootMode:null,shape:null,size:Ql,sizes:null,slot:null,span:Ql,spellCheck:Lc,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Ql,step:null,style:null,tabIndex:Ql,target:null,title:null,translate:null,type:null,typeMustMatch:FG,useMap:null,value:Lc,width:Ql,wrap:null,align:null,aLink:null,archive:$G,axis:null,background:null,bgColor:null,border:Ql,borderColor:null,bottomMargin:Ql,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:FG,declare:FG,event:null,face:null,frame:null,frameBorder:null,hSpace:Ql,leftMargin:Ql,link:null,longDesc:null,lowSrc:null,marginHeight:Ql,marginWidth:Ql,noResize:FG,noHref:FG,noShade:FG,noWrap:FG,object:null,profile:null,prompt:null,rev:null,rightMargin:Ql,rules:null,scheme:null,scrolling:Lc,standby:null,summary:null,text:null,topMargin:Ql,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Ql,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:FG,disableRemotePlayback:FG,prefix:null,property:null,results:Ql,security:null,unselectable:null}});var Zw=vd({space:"svg",attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},transform:mu,properties:{about:jb,accentHeight:Ql,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Ql,amplitude:Ql,arabicForm:null,ascent:Ql,attributeName:null,attributeType:null,azimuth:Ql,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Ql,by:null,calcMode:null,capHeight:Ql,className:$G,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Ql,diffuseConstant:Ql,direction:null,display:null,dur:null,divisor:Ql,dominantBaseline:null,download:FG,dx:null,dy:null,edgeMode:null,editable:null,elevation:Ql,enableBackground:null,end:null,event:null,exponent:Ql,externalResourcesRequired:null,fill:null,fillOpacity:Ql,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:ke,g2:ke,glyphName:ke,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Ql,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Ql,horizOriginX:Ql,horizOriginY:Ql,id:null,ideographic:Ql,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Ql,k:Ql,k1:Ql,k2:Ql,k3:Ql,k4:Ql,kernelMatrix:jb,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Ql,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Ql,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Ql,overlineThickness:Ql,paintOrder:null,panose1:null,path:null,pathLength:Ql,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:$G,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Ql,pointsAtY:Ql,pointsAtZ:Ql,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:jb,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:jb,rev:jb,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:jb,requiredFeatures:jb,requiredFonts:jb,requiredFormats:jb,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Ql,specularExponent:Ql,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Ql,strikethroughThickness:Ql,string:null,stroke:null,strokeDashArray:jb,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Ql,strokeOpacity:Ql,strokeWidth:null,style:null,surfaceScale:Ql,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:jb,tabIndex:Ql,tableValues:null,target:null,targetX:Ql,targetY:Ql,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:jb,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Ql,underlineThickness:Ql,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Ql,values:null,vAlphabetic:Ql,vMathematical:Ql,vectorEffect:null,vHanging:Ql,vIdeographic:Ql,version:null,vertAdvY:Ql,vertOriginX:Ql,vertOriginY:Ql,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Ql,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null}});var mL=/^data[-\w.:]+$/i,ew=/-[a-z]/g,NL=/[A-Z]/g;function To(I,G){let l=mh(G),b=G,d=ob;if(l in I.normal)return I.property[I.normal[l]];if(l.length>4&&l.slice(0,4)==="data"&&mL.test(G)){if(G.charAt(4)==="-"){let e=G.slice(5).replace(ew,YL);b="data"+e.charAt(0).toUpperCase()+e.slice(1)}else{let e=G.slice(4);if(!ew.test(e)){let t=e.replace(NL,sL);t.charAt(0)!=="-"&&(t="-"+t),G="data"+t}}d=Ta}return new d(b,G)}function sL(I){return"-"+I.toLowerCase()}function YL(I){return I.charAt(1).toUpperCase()}var su={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"};var aw=zo([Oo,Bo,jo,Ko,dw],"html"),Ww=zo([Oo,Bo,jo,Ko,Zw],"svg");function fo(I){if(I.allowedElements&&I.disallowedElements)throw new TypeError("Only one of `allowedElements` and `disallowedElements` should be defined");if(I.allowedElements||I.disallowedElements||I.allowElement)return G=>{OZ(G,"element",(l,b,d)=>{let e=d,t;if(I.allowedElements?t=!I.allowedElements.includes(l.tagName):I.disallowedElements&&(t=I.disallowedElements.includes(l.tagName)),!t&&I.allowElement&&typeof b=="number"&&(t=!I.allowElement(l,b,e)),t&&typeof b=="number")return I.unwrapDisallowed&&l.children?e.children.splice(b,1,...l.children):e.children.splice(b,1),b})}}var Qu=el(IG(),1),rw=el(Nw(),1);function sw(I){let G=I&&typeof I=="object"&&I.type==="text"?I.value||"":I;return typeof G=="string"&&G.replace(/[ \t\n\f\r]/g,"")===""}function Yw(I){return I.join(" ").trim()}function hw(I,G){let l=G||{};return(I[I.length-1]===""?[...I,""]:I).join((l.padRight?" ":"")+","+(l.padLeft===!1?"":" ")).trim()}var Qw=el(iw(),1),Hw=Qw.default;var Po={}.hasOwnProperty,vL=new Set(["table","thead","tbody","tfoot","tr"]);function $o(I,G){let l=[],b=-1,d;for(;++b<G.children.length;)d=G.children[b],d.type==="element"?l.push(EL(I,d,b,G)):d.type==="text"?(G.type!=="element"||!vL.has(G.tagName)||!sw(d))&&l.push(d.value):d.type==="raw"&&!I.options.skipHtml&&l.push(d.value);return l}function EL(I,G,l,b){let d=I.options,e=d.transformLinkUri===void 0?YH:d.transformLinkUri,t=I.schema,W=G.tagName,n={},s=t,N;if(t.space==="html"&&W==="svg"&&(s=Ww,I.schema=s),G.properties)for(N in G.properties)Po.call(G.properties,N)&&gL(n,N,G.properties[N],I);(W==="ol"||W==="ul")&&I.listDepth++;let m=$o(I,G);(W==="ol"||W==="ul")&&I.listDepth--,I.schema=t;let h=G.position||{start:{line:null,column:null,offset:null},end:{line:null,column:null,offset:null}},V=d.components&&Po.call(d.components,W)?d.components[W]:W,X=typeof V=="string"||V===Qu.default.Fragment;if(!rw.default.isValidElementType(V))throw new TypeError(`Component for name \`${W}\` not defined or is not renderable`);if(n.key=l,W==="a"&&d.linkTarget&&(n.target=typeof d.linkTarget=="function"?d.linkTarget(String(n.href||""),G.children,typeof n.title=="string"?n.title:null):d.linkTarget),W==="a"&&e&&(n.href=e(String(n.href||""),G.children,typeof n.title=="string"?n.title:null)),!X&&W==="code"&&b.type==="element"&&b.tagName!=="pre"&&(n.inline=!0),!X&&(W==="h1"||W==="h2"||W==="h3"||W==="h4"||W==="h5"||W==="h6")&&(n.level=Number.parseInt(W.charAt(1),10)),W==="img"&&d.transformImageUri&&(n.src=d.transformImageUri(String(n.src||""),String(n.alt||""),typeof n.title=="string"?n.title:null)),!X&&W==="li"&&b.type==="element"){let p=yL(G);n.checked=p&&p.properties?!!p.properties.checked:null,n.index=_o(b,G),n.ordered=b.tagName==="ol"}return!X&&(W==="ol"||W==="ul")&&(n.ordered=W==="ol",n.depth=I.listDepth),(W==="td"||W==="th")&&(n.align&&(n.style||(n.style={}),n.style.textAlign=n.align,delete n.align),X||(n.isHeader=W==="th")),!X&&W==="tr"&&b.type==="element"&&(n.isHeader=b.tagName==="thead"),d.sourcePos&&(n["data-sourcepos"]=AL(h)),!X&&d.rawSourcePos&&(n.sourcePosition=G.position),!X&&d.includeElementIndex&&(n.index=_o(b,G),n.siblingCount=_o(b)),X||(n.node=G),m.length>0?Qu.default.createElement(V,n,m):Qu.default.createElement(V,n)}function yL(I){let G=-1;for(;++G<I.children.length;){let l=I.children[G];if(l.type==="element"&&l.tagName==="input")return l}return null}function _o(I,G){let l=-1,b=0;for(;++l<I.children.length&&I.children[l]!==G;)I.children[l].type==="element"&&b++;return b}function gL(I,G,l,b){let d=To(b.schema,G),e=l;e==null||e!==e||(Array.isArray(e)&&(e=d.commaSeparated?hw(e):Yw(e)),d.property==="style"&&typeof e=="string"&&(e=JL(e)),d.space&&d.property?I[Po.call(su,d.property)?su[d.property]:d.property]=e:d.attribute&&(I[d.attribute]=e))}function JL(I){let G={};try{Hw(I,l)}catch{}return G;function l(b,d){let e=b.slice(0,4)==="-ms-"?`ms-${b.slice(4)}`:b;G[e.replace(/-([a-z])/g,CL)]=d}}function CL(I,G){return G.toUpperCase()}function AL(I){return[I.start.line,":",I.start.column,"-",I.end.line,":",I.end.column].map(String).join("")}var ww={}.hasOwnProperty,LL="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",Hu={plugins:{to:"remarkPlugins",id:"change-plugins-to-remarkplugins"},renderers:{to:"components",id:"change-renderers-to-components"},astPlugins:{id:"remove-buggy-html-in-markdown-parser"},allowDangerousHtml:{id:"remove-buggy-html-in-markdown-parser"},escapeHtml:{id:"remove-buggy-html-in-markdown-parser"},source:{to:"children",id:"change-source-to-children"},allowNode:{to:"allowElement",id:"replace-allownode-allowedtypes-and-disallowedtypes"},allowedTypes:{to:"allowedElements",id:"replace-allownode-allowedtypes-and-disallowedtypes"},disallowedTypes:{to:"disallowedElements",id:"replace-allownode-allowedtypes-and-disallowedtypes"},includeNodeIndex:{to:"includeElementIndex",id:"change-includenodeindex-to-includeelementindex"}};function Mn(I){for(let e in Hu)if(ww.call(Hu,e)&&ww.call(I,e)){let t=Hu[e];console.warn(`[react-markdown] Warning: please ${t.to?`use \`${t.to}\` instead of`:"remove"} \`${e}\` (see <${LL}#${t.id}> for more info)`),delete Hu[e]}let G=Yo().use(bu).use(I.remarkPlugins||[]).use(xo,{...I.remarkRehypeOptions,allowDangerousHtml:!0}).use(I.rehypePlugins||[]).use(fo,I),l=new Ma;typeof I.children=="string"?l.value=I.children:I.children!==void 0&&I.children!==null&&console.warn(`[react-markdown] Warning: please pass a string as \`children\` (not: \`${I.children}\`)`);let b=G.runSync(G.parse(l),l);if(b.type!=="root")throw new TypeError("Expected a `root` node");let d=ru.default.createElement(ru.default.Fragment,{},$o({options:I,schema:aw,listDepth:0},b));return I.className&&(d=ru.default.createElement("div",{className:I.className},d)),d}Mn.propTypes={children:pG.default.string,className:pG.default.string,allowElement:pG.default.func,allowedElements:pG.default.arrayOf(pG.default.string),disallowedElements:pG.default.arrayOf(pG.default.string),unwrapDisallowed:pG.default.bool,remarkPlugins:pG.default.arrayOf(pG.default.oneOfType([pG.default.object,pG.default.func,pG.default.arrayOf(pG.default.oneOfType([pG.default.bool,pG.default.string,pG.default.object,pG.default.func,pG.default.arrayOf(pG.default.any)]))])),rehypePlugins:pG.default.arrayOf(pG.default.oneOfType([pG.default.object,pG.default.func,pG.default.arrayOf(pG.default.oneOfType([pG.default.bool,pG.default.string,pG.default.object,pG.default.func,pG.default.arrayOf(pG.default.any)]))])),sourcePos:pG.default.bool,rawSourcePos:pG.default.bool,skipHtml:pG.default.bool,includeElementIndex:pG.default.bool,transformLinkUri:pG.default.oneOfType([pG.default.func,pG.default.bool]),linkTarget:pG.default.oneOfType([pG.default.func,pG.default.string]),transformImageUri:pG.default.func,components:pG.default.object};function kL(I){let G=I.regex,l=I.COMMENT("//","$",{contains:[{begin:/\\\n/}]}),b="decltype\\(auto\\)",d="[a-zA-Z_]\\w*::",t="(?!struct)("+b+"|"+G.optional(d)+"[a-zA-Z_]\\w*"+G.optional("<[^<>]+>")+")",W={className:"type",begin:"\\b[a-z\\d_]*_t\\b"},s={className:"string",variants:[{begin:'(u8?|U|L)?"',end:'"',illegal:"\\n",contains:[I.BACKSLASH_ESCAPE]},{begin:"(u8?|U|L)?'("+"\\\\(x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4,8}|[0-7]{3}|\\S)"+"|.)",end:"'",illegal:"."},I.END_SAME_AS_BEGIN({begin:/(?:u8?|U|L)?R"([^()\\ ]{0,16})\(/,end:/\)([^()\\ ]{0,16})"/})]},N={className:"number",variants:[{begin:"\\b(0b[01']+)"},{begin:"(-?)\\b([\\d']+(\\.[\\d']*)?|\\.[\\d']+)((ll|LL|l|L)(u|U)?|(u|U)(ll|LL|l|L)?|f|F|b|B)"},{begin:"(-?)(\\b0[xX][a-fA-F0-9']+|(\\b[\\d']+(\\.[\\d']*)?|\\.[\\d']+)([eE][-+]?[\\d']+)?)"}],relevance:0},m={className:"meta",begin:/#\s*[a-z]+\b/,end:/$/,keywords:{keyword:"if else elif endif define undef warning error line pragma _Pragma ifdef ifndef include"},contains:[{begin:/\\\n/,relevance:0},I.inherit(s,{className:"string"}),{className:"string",begin:/<.*?>/},l,I.C_BLOCK_COMMENT_MODE]},h={className:"title",begin:G.optional(d)+I.IDENT_RE,relevance:0},V=G.optional(d)+I.IDENT_RE+"\\s*\\(",X=["alignas","alignof","and","and_eq","asm","atomic_cancel","atomic_commit","atomic_noexcept","auto","bitand","bitor","break","case","catch","class","co_await","co_return","co_yield","compl","concept","const_cast|10","consteval","constexpr","constinit","continue","decltype","default","delete","do","dynamic_cast|10","else","enum","explicit","export","extern","false","final","for","friend","goto","if","import","inline","module","mutable","namespace","new","noexcept","not","not_eq","nullptr","operator","or","or_eq","override","private","protected","public","reflexpr","register","reinterpret_cast|10","requires","return","sizeof","static_assert","static_cast|10","struct","switch","synchronized","template","this","thread_local","throw","transaction_safe","transaction_safe_dynamic","true","try","typedef","typeid","typename","union","using","virtual","volatile","while","xor","xor_eq"],p=["bool","char","char16_t","char32_t","char8_t","double","float","int","long","short","void","wchar_t","unsigned","signed","const","static"],F=["any","auto_ptr","barrier","binary_semaphore","bitset","complex","condition_variable","condition_variable_any","counting_semaphore","deque","false_type","future","imaginary","initializer_list","istringstream","jthread","latch","lock_guard","multimap","multiset","mutex","optional","ostringstream","packaged_task","pair","promise","priority_queue","queue","recursive_mutex","recursive_timed_mutex","scoped_lock","set","shared_future","shared_lock","shared_mutex","shared_timed_mutex","shared_ptr","stack","string_view","stringstream","timed_mutex","thread","true_type","tuple","unique_lock","unique_ptr","unordered_map","unordered_multimap","unordered_multiset","unordered_set","variant","vector","weak_ptr","wstring","wstring_view"],a=["abort","abs","acos","apply","as_const","asin","atan","atan2","calloc","ceil","cerr","cin","clog","cos","cosh","cout","declval","endl","exchange","exit","exp","fabs","floor","fmod","forward","fprintf","fputs","free","frexp","fscanf","future","invoke","isalnum","isalpha","iscntrl","isdigit","isgraph","islower","isprint","ispunct","isspace","isupper","isxdigit","labs","launder","ldexp","log","log10","make_pair","make_shared","make_shared_for_overwrite","make_tuple","make_unique","malloc","memchr","memcmp","memcpy","memset","modf","move","pow","printf","putchar","puts","realloc","scanf","sin","sinh","snprintf","sprintf","sqrt","sscanf","std","stderr","stdin","stdout","strcat","strchr","strcmp","strcpy","strcspn","strlen","strncat","strncmp","strncpy","strpbrk","strrchr","strspn","strstr","swap","tan","tanh","terminate","to_underlying","tolower","toupper","vfprintf","visit","vprintf","vsprintf"],o={type:p,keyword:X,literal:["NULL","false","nullopt","nullptr","true"],built_in:["_Pragma"],_type_hints:F},y={className:"function.dispatch",relevance:0,keywords:{_hint:a},begin:G.concat(/\b/,/(?!decltype)/,/(?!if)/,/(?!for)/,/(?!switch)/,/(?!while)/,I.IDENT_RE,G.lookahead(/(<[^<>]+>|)\s*\(/))},H=[y,m,W,l,I.C_BLOCK_COMMENT_MODE,N,s],E={variants:[{begin:/=/,end:/;/},{begin:/\(/,end:/\)/},{beginKeywords:"new throw return else",end:/;/}],keywords:o,contains:H.concat([{begin:/\(/,end:/\)/,keywords:o,contains:H.concat(["self"]),relevance:0}]),relevance:0},C={className:"function",begin:"("+t+"[\\*&\\s]+)+"+V,returnBegin:!0,end:/[{;=]/,excludeEnd:!0,keywords:o,illegal:/[^\w\s\*&:<>.]/,contains:[{begin:b,keywords:o,relevance:0},{begin:V,returnBegin:!0,contains:[h],relevance:0},{begin:/::/,relevance:0},{begin:/:/,endsWithParent:!0,contains:[s,N]},{relevance:0,match:/,/},{className:"params",begin:/\(/,end:/\)/,keywords:o,relevance:0,contains:[l,I.C_BLOCK_COMMENT_MODE,s,N,W,{begin:/\(/,end:/\)/,keywords:o,relevance:0,contains:["self",l,I.C_BLOCK_COMMENT_MODE,s,N,W]}]},W,l,I.C_BLOCK_COMMENT_MODE,m]};return{name:"C++",aliases:["cc","c++","h++","hpp","hh","hxx","cxx"],keywords:o,illegal:"</",classNameAliases:{"function.dispatch":"built_in"},contains:[].concat(E,C,y,H,[m,{begin:"\\b(deque|list|queue|priority_queue|pair|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array|tuple|optional|variant|function)\\s*<(?!<)",end:">",keywords:o,contains:["self",W]},{begin:I.IDENT_RE+"::",keywords:o},{match:[/\b(?:enum(?:\s+(?:class|struct))?|class|struct|union)/,/\s+/,/\w+/],className:{1:"keyword",3:"title.class"}}])}}function vw(I){let G={type:["boolean","byte","word","String"],built_in:["KeyboardController","MouseController","SoftwareSerial","EthernetServer","EthernetClient","LiquidCrystal","RobotControl","GSMVoiceCall","EthernetUDP","EsploraTFT","HttpClient","RobotMotor","WiFiClient","GSMScanner","FileSystem","Scheduler","GSMServer","YunClient","YunServer","IPAddress","GSMClient","GSMModem","Keyboard","Ethernet","Console","GSMBand","Esplora","Stepper","Process","WiFiUDP","GSM_SMS","Mailbox","USBHost","Firmata","PImage","Client","Server","GSMPIN","FileIO","Bridge","Serial","EEPROM","Stream","Mouse","Audio","Servo","File","Task","GPRS","WiFi","Wire","TFT","GSM","SPI","SD"],_hints:["setup","loop","runShellCommandAsynchronously","analogWriteResolution","retrieveCallingNumber","printFirmwareVersion","analogReadResolution","sendDigitalPortPair","noListenOnLocalhost","readJoystickButton","setFirmwareVersion","readJoystickSwitch","scrollDisplayRight","getVoiceCallStatus","scrollDisplayLeft","writeMicroseconds","delayMicroseconds","beginTransmission","getSignalStrength","runAsynchronously","getAsynchronously","listenOnLocalhost","getCurrentCarrier","readAccelerometer","messageAvailable","sendDigitalPorts","lineFollowConfig","countryNameWrite","runShellCommand","readStringUntil","rewindDirectory","readTemperature","setClockDivider","readLightSensor","endTransmission","analogReference","detachInterrupt","countryNameRead","attachInterrupt","encryptionType","readBytesUntil","robotNameWrite","readMicrophone","robotNameRead","cityNameWrite","userNameWrite","readJoystickY","readJoystickX","mouseReleased","openNextFile","scanNetworks","noInterrupts","digitalWrite","beginSpeaker","mousePressed","isActionDone","mouseDragged","displayLogos","noAutoscroll","addParameter","remoteNumber","getModifiers","keyboardRead","userNameRead","waitContinue","processInput","parseCommand","printVersion","readNetworks","writeMessage","blinkVersion","cityNameRead","readMessage","setDataMode","parsePacket","isListening","setBitOrder","beginPacket","isDirectory","motorsWrite","drawCompass","digitalRead","clearScreen","serialEvent","rightToLeft","setTextSize","leftToRight","requestFrom","keyReleased","compassRead","analogWrite","interrupts","WiFiServer","disconnect","playMelody","parseFloat","autoscroll","getPINUsed","setPINUsed","setTimeout","sendAnalog","readSlider","analogRead","beginWrite","createChar","motorsStop","keyPressed","tempoWrite","readButton","subnetMask","debugPrint","macAddress","writeGreen","randomSeed","attachGPRS","readString","sendString","remotePort","releaseAll","mouseMoved","background","getXChange","getYChange","answerCall","getResult","voiceCall","endPacket","constrain","getSocket","writeJSON","getButton","available","connected","findUntil","readBytes","exitValue","readGreen","writeBlue","startLoop","IPAddress","isPressed","sendSysex","pauseMode","gatewayIP","setCursor","getOemKey","tuneWrite","noDisplay","loadImage","switchPIN","onRequest","onReceive","changePIN","playFile","noBuffer","parseInt","overflow","checkPIN","knobRead","beginTFT","bitClear","updateIR","bitWrite","position","writeRGB","highByte","writeRed","setSpeed","readBlue","noStroke","remoteIP","transfer","shutdown","hangCall","beginSMS","endWrite","attached","maintain","noCursor","checkReg","checkPUK","shiftOut","isValid","shiftIn","pulseIn","connect","println","localIP","pinMode","getIMEI","display","noBlink","process","getBand","running","beginSD","drawBMP","lowByte","setBand","release","bitRead","prepare","pointTo","readRed","setMode","noFill","remove","listen","stroke","detach","attach","noTone","exists","buffer","height","bitSet","circle","config","cursor","random","IRread","setDNS","endSMS","getKey","micros","millis","begin","print","write","ready","flush","width","isPIN","blink","clear","press","mkdir","rmdir","close","point","yield","image","BSSID","click","delay","read","text","move","peek","beep","rect","line","open","seek","fill","size","turn","stop","home","find","step","tone","sqrt","RSSI","SSID","end","bit","tan","cos","sin","pow","map","abs","max","min","get","run","put"],literal:["DIGITAL_MESSAGE","FIRMATA_STRING","ANALOG_MESSAGE","REPORT_DIGITAL","REPORT_ANALOG","INPUT_PULLUP","SET_PIN_MODE","INTERNAL2V56","SYSTEM_RESET","LED_BUILTIN","INTERNAL1V1","SYSEX_START","INTERNAL","EXTERNAL","DEFAULT","OUTPUT","INPUT","HIGH","LOW"]},l=kL(I),b=l.keywords;return b.type=[...b.type,...G.type],b.literal=[...b.literal,...G.literal],b.built_in=[...b.built_in,...G.built_in],b._hints=G._hints,l.name="Arduino",l.aliases=["ino"],l.supersetOf="cpp",l}function Ew(I){let G=I.regex,l={},b={begin:/\$\{/,end:/\}/,contains:["self",{begin:/:-/,contains:[l]}]};Object.assign(l,{className:"variable",variants:[{begin:G.concat(/\$[\w\d#@][\w\d_]*/,"(?![\\w\\d])(?![$])")},b]});let d={className:"subst",begin:/\$\(/,end:/\)/,contains:[I.BACKSLASH_ESCAPE]},e={begin:/<<-?\s*(?=\w+)/,starts:{contains:[I.END_SAME_AS_BEGIN({begin:/(\w+)/,end:/(\w+)/,className:"string"})]}},t={className:"string",begin:/"/,end:/"/,contains:[I.BACKSLASH_ESCAPE,l,d]};d.contains.push(t);let W={className:"",begin:/\\"/},n={className:"string",begin:/'/,end:/'/},s={begin:/\$?\(\(/,end:/\)\)/,contains:[{begin:/\d+#[0-9a-f]+/,className:"number"},I.NUMBER_MODE,l]},N=["fish","bash","zsh","sh","csh","ksh","tcsh","dash","scsh"],m=I.SHEBANG({binary:`(${N.join("|")})`,relevance:10}),h={className:"function",begin:/\w[\w\d_]*\s*\(\s*\)\s*\{/,returnBegin:!0,contains:[I.inherit(I.TITLE_MODE,{begin:/\w[\w\d_]*/})],relevance:0},V=["if","then","else","elif","fi","for","while","until","in","do","done","case","esac","function","select"],X=["true","false"],p={match:/(\/[a-z._-]+)+/},F=["break","cd","continue","eval","exec","exit","export","getopts","hash","pwd","readonly","return","shift","test","times","trap","umask","unset"],a=["alias","bind","builtin","caller","command","declare","echo","enable","help","let","local","logout","mapfile","printf","read","readarray","source","type","typeset","ulimit","unalias"],u=["autoload","bg","bindkey","bye","cap","chdir","clone","comparguments","compcall","compctl","compdescribe","compfiles","compgroups","compquote","comptags","comptry","compvalues","dirs","disable","disown","echotc","echoti","emulate","fc","fg","float","functions","getcap","getln","history","integer","jobs","kill","limit","log","noglob","popd","print","pushd","pushln","rehash","sched","setcap","setopt","stat","suspend","ttyctl","unfunction","unhash","unlimit","unsetopt","vared","wait","whence","where","which","zcompile","zformat","zftp","zle","zmodload","zparseopts","zprof","zpty","zregexparse","zsocket","zstyle","ztcp"],Q=["chcon","chgrp","chown","chmod","cp","dd","df","dir","dircolors","ln","ls","mkdir","mkfifo","mknod","mktemp","mv","realpath","rm","rmdir","shred","sync","touch","truncate","vdir","b2sum","base32","base64","cat","cksum","comm","csplit","cut","expand","fmt","fold","head","join","md5sum","nl","numfmt","od","paste","ptx","pr","sha1sum","sha224sum","sha256sum","sha384sum","sha512sum","shuf","sort","split","sum","tac","tail","tr","tsort","unexpand","uniq","wc","arch","basename","chroot","date","dirname","du","echo","env","expr","factor","groups","hostid","id","link","logname","nice","nohup","nproc","pathchk","pinky","printenv","printf","pwd","readlink","runcon","seq","sleep","stat","stdbuf","stty","tee","test","timeout","tty","uname","unlink","uptime","users","who","whoami","yes"];return{name:"Bash",aliases:["sh"],keywords:{$pattern:/\b[a-z][a-z0-9._-]+\b/,keyword:V,literal:X,built_in:[...F,...a,"set","shopt",...u,...Q]},contains:[m,I.SHEBANG(),h,s,I.HASH_COMMENT_MODE,e,p,t,W,n,l]}}function yw(I){let G=I.regex,l=I.COMMENT("//","$",{contains:[{begin:/\\\n/}]}),b="decltype\\(auto\\)",d="[a-zA-Z_]\\w*::",t="("+b+"|"+G.optional(d)+"[a-zA-Z_]\\w*"+G.optional("<[^<>]+>")+")",W={className:"type",variants:[{begin:"\\b[a-z\\d_]*_t\\b"},{match:/\batomic_[a-z]{3,6}\b/}]},s={className:"string",variants:[{begin:'(u8?|U|L)?"',end:'"',illegal:"\\n",contains:[I.BACKSLASH_ESCAPE]},{begin:"(u8?|U|L)?'("+"\\\\(x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4,8}|[0-7]{3}|\\S)"+"|.)",end:"'",illegal:"."},I.END_SAME_AS_BEGIN({begin:/(?:u8?|U|L)?R"([^()\\ ]{0,16})\(/,end:/\)([^()\\ ]{0,16})"/})]},N={className:"number",variants:[{begin:"\\b(0b[01']+)"},{begin:"(-?)\\b([\\d']+(\\.[\\d']*)?|\\.[\\d']+)((ll|LL|l|L)(u|U)?|(u|U)(ll|LL|l|L)?|f|F|b|B)"},{begin:"(-?)(\\b0[xX][a-fA-F0-9']+|(\\b[\\d']+(\\.[\\d']*)?|\\.[\\d']+)([eE][-+]?[\\d']+)?)"}],relevance:0},m={className:"meta",begin:/#\s*[a-z]+\b/,end:/$/,keywords:{keyword:"if else elif endif define undef warning error line pragma _Pragma ifdef ifndef include"},contains:[{begin:/\\\n/,relevance:0},I.inherit(s,{className:"string"}),{className:"string",begin:/<.*?>/},l,I.C_BLOCK_COMMENT_MODE]},h={className:"title",begin:G.optional(d)+I.IDENT_RE,relevance:0},V=G.optional(d)+I.IDENT_RE+"\\s*\\(",F={keyword:["asm","auto","break","case","continue","default","do","else","enum","extern","for","fortran","goto","if","inline","register","restrict","return","sizeof","struct","switch","typedef","union","volatile","while","_Alignas","_Alignof","_Atomic","_Generic","_Noreturn","_Static_assert","_Thread_local","alignas","alignof","noreturn","static_assert","thread_local","_Pragma"],type:["float","double","signed","unsigned","int","short","long","char","void","_Bool","_Complex","_Imaginary","_Decimal32","_Decimal64","_Decimal128","const","static","complex","bool","imaginary"],literal:"true false NULL",built_in:"std string wstring cin cout cerr clog stdin stdout stderr stringstream istringstream ostringstream auto_ptr deque list queue stack vector map set pair bitset multiset multimap unordered_set unordered_map unordered_multiset unordered_multimap priority_queue make_pair array shared_ptr abort terminate abs acos asin atan2 atan calloc ceil cosh cos exit exp fabs floor fmod fprintf fputs free frexp fscanf future isalnum isalpha iscntrl isdigit isgraph islower isprint ispunct isspace isupper isxdigit tolower toupper labs ldexp log10 log malloc realloc memchr memcmp memcpy memset modf pow printf putchar puts scanf sinh sin snprintf sprintf sqrt sscanf strcat strchr strcmp strcpy strcspn strlen strncat strncmp strncpy strpbrk strrchr strspn strstr tanh tan vfprintf vprintf vsprintf endl initializer_list unique_ptr"},a=[m,W,l,I.C_BLOCK_COMMENT_MODE,N,s],u={variants:[{begin:/=/,end:/;/},{begin:/\(/,end:/\)/},{beginKeywords:"new throw return else",end:/;/}],keywords:F,contains:a.concat([{begin:/\(/,end:/\)/,keywords:F,contains:a.concat(["self"]),relevance:0}]),relevance:0},Q={begin:"("+t+"[\\*&\\s]+)+"+V,returnBegin:!0,end:/[{;=]/,excludeEnd:!0,keywords:F,illegal:/[^\w\s\*&:<>.]/,contains:[{begin:b,keywords:F,relevance:0},{begin:V,returnBegin:!0,contains:[I.inherit(h,{className:"title.function"})],relevance:0},{relevance:0,match:/,/},{className:"params",begin:/\(/,end:/\)/,keywords:F,relevance:0,contains:[l,I.C_BLOCK_COMMENT_MODE,s,N,W,{begin:/\(/,end:/\)/,keywords:F,relevance:0,contains:["self",l,I.C_BLOCK_COMMENT_MODE,s,N,W]}]},W,l,I.C_BLOCK_COMMENT_MODE,m]};return{name:"C",aliases:["h"],keywords:F,disableAutodetect:!0,illegal:"</",contains:[].concat(u,Q,a,[m,{begin:I.IDENT_RE+"::",keywords:F},{className:"class",beginKeywords:"enum class struct union",end:/[{;:<>=]/,contains:[{beginKeywords:"final class struct"},I.TITLE_MODE]}]),exports:{preprocessor:m,strings:s,keywords:F}}}function gw(I){let G=I.regex,l=I.COMMENT("//","$",{contains:[{begin:/\\\n/}]}),b="decltype\\(auto\\)",d="[a-zA-Z_]\\w*::",t="(?!struct)("+b+"|"+G.optional(d)+"[a-zA-Z_]\\w*"+G.optional("<[^<>]+>")+")",W={className:"type",begin:"\\b[a-z\\d_]*_t\\b"},s={className:"string",variants:[{begin:'(u8?|U|L)?"',end:'"',illegal:"\\n",contains:[I.BACKSLASH_ESCAPE]},{begin:"(u8?|U|L)?'("+"\\\\(x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4,8}|[0-7]{3}|\\S)"+"|.)",end:"'",illegal:"."},I.END_SAME_AS_BEGIN({begin:/(?:u8?|U|L)?R"([^()\\ ]{0,16})\(/,end:/\)([^()\\ ]{0,16})"/})]},N={className:"number",variants:[{begin:"\\b(0b[01']+)"},{begin:"(-?)\\b([\\d']+(\\.[\\d']*)?|\\.[\\d']+)((ll|LL|l|L)(u|U)?|(u|U)(ll|LL|l|L)?|f|F|b|B)"},{begin:"(-?)(\\b0[xX][a-fA-F0-9']+|(\\b[\\d']+(\\.[\\d']*)?|\\.[\\d']+)([eE][-+]?[\\d']+)?)"}],relevance:0},m={className:"meta",begin:/#\s*[a-z]+\b/,end:/$/,keywords:{keyword:"if else elif endif define undef warning error line pragma _Pragma ifdef ifndef include"},contains:[{begin:/\\\n/,relevance:0},I.inherit(s,{className:"string"}),{className:"string",begin:/<.*?>/},l,I.C_BLOCK_COMMENT_MODE]},h={className:"title",begin:G.optional(d)+I.IDENT_RE,relevance:0},V=G.optional(d)+I.IDENT_RE+"\\s*\\(",X=["alignas","alignof","and","and_eq","asm","atomic_cancel","atomic_commit","atomic_noexcept","auto","bitand","bitor","break","case","catch","class","co_await","co_return","co_yield","compl","concept","const_cast|10","consteval","constexpr","constinit","continue","decltype","default","delete","do","dynamic_cast|10","else","enum","explicit","export","extern","false","final","for","friend","goto","if","import","inline","module","mutable","namespace","new","noexcept","not","not_eq","nullptr","operator","or","or_eq","override","private","protected","public","reflexpr","register","reinterpret_cast|10","requires","return","sizeof","static_assert","static_cast|10","struct","switch","synchronized","template","this","thread_local","throw","transaction_safe","transaction_safe_dynamic","true","try","typedef","typeid","typename","union","using","virtual","volatile","while","xor","xor_eq"],p=["bool","char","char16_t","char32_t","char8_t","double","float","int","long","short","void","wchar_t","unsigned","signed","const","static"],F=["any","auto_ptr","barrier","binary_semaphore","bitset","complex","condition_variable","condition_variable_any","counting_semaphore","deque","false_type","future","imaginary","initializer_list","istringstream","jthread","latch","lock_guard","multimap","multiset","mutex","optional","ostringstream","packaged_task","pair","promise","priority_queue","queue","recursive_mutex","recursive_timed_mutex","scoped_lock","set","shared_future","shared_lock","shared_mutex","shared_timed_mutex","shared_ptr","stack","string_view","stringstream","timed_mutex","thread","true_type","tuple","unique_lock","unique_ptr","unordered_map","unordered_multimap","unordered_multiset","unordered_set","variant","vector","weak_ptr","wstring","wstring_view"],a=["abort","abs","acos","apply","as_const","asin","atan","atan2","calloc","ceil","cerr","cin","clog","cos","cosh","cout","declval","endl","exchange","exit","exp","fabs","floor","fmod","forward","fprintf","fputs","free","frexp","fscanf","future","invoke","isalnum","isalpha","iscntrl","isdigit","isgraph","islower","isprint","ispunct","isspace","isupper","isxdigit","labs","launder","ldexp","log","log10","make_pair","make_shared","make_shared_for_overwrite","make_tuple","make_unique","malloc","memchr","memcmp","memcpy","memset","modf","move","pow","printf","putchar","puts","realloc","scanf","sin","sinh","snprintf","sprintf","sqrt","sscanf","std","stderr","stdin","stdout","strcat","strchr","strcmp","strcpy","strcspn","strlen","strncat","strncmp","strncpy","strpbrk","strrchr","strspn","strstr","swap","tan","tanh","terminate","to_underlying","tolower","toupper","vfprintf","visit","vprintf","vsprintf"],o={type:p,keyword:X,literal:["NULL","false","nullopt","nullptr","true"],built_in:["_Pragma"],_type_hints:F},y={className:"function.dispatch",relevance:0,keywords:{_hint:a},begin:G.concat(/\b/,/(?!decltype)/,/(?!if)/,/(?!for)/,/(?!switch)/,/(?!while)/,I.IDENT_RE,G.lookahead(/(<[^<>]+>|)\s*\(/))},H=[y,m,W,l,I.C_BLOCK_COMMENT_MODE,N,s],E={variants:[{begin:/=/,end:/;/},{begin:/\(/,end:/\)/},{beginKeywords:"new throw return else",end:/;/}],keywords:o,contains:H.concat([{begin:/\(/,end:/\)/,keywords:o,contains:H.concat(["self"]),relevance:0}]),relevance:0},C={className:"function",begin:"("+t+"[\\*&\\s]+)+"+V,returnBegin:!0,end:/[{;=]/,excludeEnd:!0,keywords:o,illegal:/[^\w\s\*&:<>.]/,contains:[{begin:b,keywords:o,relevance:0},{begin:V,returnBegin:!0,contains:[h],relevance:0},{begin:/::/,relevance:0},{begin:/:/,endsWithParent:!0,contains:[s,N]},{relevance:0,match:/,/},{className:"params",begin:/\(/,end:/\)/,keywords:o,relevance:0,contains:[l,I.C_BLOCK_COMMENT_MODE,s,N,W,{begin:/\(/,end:/\)/,keywords:o,relevance:0,contains:["self",l,I.C_BLOCK_COMMENT_MODE,s,N,W]}]},W,l,I.C_BLOCK_COMMENT_MODE,m]};return{name:"C++",aliases:["cc","c++","h++","hpp","hh","hxx","cxx"],keywords:o,illegal:"</",classNameAliases:{"function.dispatch":"built_in"},contains:[].concat(E,C,y,H,[m,{begin:"\\b(deque|list|queue|priority_queue|pair|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array|tuple|optional|variant|function)\\s*<(?!<)",end:">",keywords:o,contains:["self",W]},{begin:I.IDENT_RE+"::",keywords:o},{match:[/\b(?:enum(?:\s+(?:class|struct))?|class|struct|union)/,/\s+/,/\w+/],className:{1:"keyword",3:"title.class"}}])}}function Jw(I){let G=["bool","byte","char","decimal","delegate","double","dynamic","enum","float","int","long","nint","nuint","object","sbyte","short","string","ulong","uint","ushort"],l=["public","private","protected","static","internal","protected","abstract","async","extern","override","unsafe","virtual","new","sealed","partial"],b=["default","false","null","true"],d=["abstract","as","base","break","case","catch","class","const","continue","do","else","event","explicit","extern","finally","fixed","for","foreach","goto","if","implicit","in","interface","internal","is","lock","namespace","new","operator","out","override","params","private","protected","public","readonly","record","ref","return","scoped","sealed","sizeof","stackalloc","static","struct","switch","this","throw","try","typeof","unchecked","unsafe","using","virtual","void","volatile","while"],e=["add","alias","and","ascending","async","await","by","descending","equals","from","get","global","group","init","into","join","let","nameof","not","notnull","on","or","orderby","partial","remove","select","set","unmanaged","value|0","var","when","where","with","yield"],t={keyword:d.concat(e),built_in:G,literal:b},W=I.inherit(I.TITLE_MODE,{begin:"[a-zA-Z](\\.?\\w)*"}),n={className:"number",variants:[{begin:"\\b(0b[01']+)"},{begin:"(-?)\\b([\\d']+(\\.[\\d']*)?|\\.[\\d']+)(u|U|l|L|ul|UL|f|F|b|B)"},{begin:"(-?)(\\b0[xX][a-fA-F0-9']+|(\\b[\\d']+(\\.[\\d']*)?|\\.[\\d']+)([eE][-+]?[\\d']+)?)"}],relevance:0},s={className:"string",begin:'@"',end:'"',contains:[{begin:'""'}]},N=I.inherit(s,{illegal:/\n/}),m={className:"subst",begin:/\{/,end:/\}/,keywords:t},h=I.inherit(m,{illegal:/\n/}),V={className:"string",begin:/\$"/,end:'"',illegal:/\n/,contains:[{begin:/\{\{/},{begin:/\}\}/},I.BACKSLASH_ESCAPE,h]},X={className:"string",begin:/\$@"/,end:'"',contains:[{begin:/\{\{/},{begin:/\}\}/},{begin:'""'},m]},p=I.inherit(X,{illegal:/\n/,contains:[{begin:/\{\{/},{begin:/\}\}/},{begin:'""'},h]});m.contains=[X,V,s,I.APOS_STRING_MODE,I.QUOTE_STRING_MODE,n,I.C_BLOCK_COMMENT_MODE],h.contains=[p,V,N,I.APOS_STRING_MODE,I.QUOTE_STRING_MODE,n,I.inherit(I.C_BLOCK_COMMENT_MODE,{illegal:/\n/})];let F={variants:[X,V,s,I.APOS_STRING_MODE,I.QUOTE_STRING_MODE]},a={begin:"<",end:">",contains:[{beginKeywords:"in out"},W]},u=I.IDENT_RE+"(<"+I.IDENT_RE+"(\\s*,\\s*"+I.IDENT_RE+")*>)?(\\[\\])?",Q={begin:"@"+I.IDENT_RE,relevance:0};return{name:"C#",aliases:["cs","c#"],keywords:t,illegal:/::/,contains:[I.COMMENT("///","$",{returnBegin:!0,contains:[{className:"doctag",variants:[{begin:"///",relevance:0},{begin:"<!--|-->"},{begin:"</?",end:">"}]}]}),I.C_LINE_COMMENT_MODE,I.C_BLOCK_COMMENT_MODE,{className:"meta",begin:"#",end:"$",keywords:{keyword:"if else elif endif define undef warning error line region endregion pragma checksum"}},F,n,{beginKeywords:"class interface",relevance:0,end:/[{;=]/,illegal:/[^\s:,]/,contains:[{beginKeywords:"where class"},W,a,I.C_LINE_COMMENT_MODE,I.C_BLOCK_COMMENT_MODE]},{beginKeywords:"namespace",relevance:0,end:/[{;=]/,illegal:/[^\s:]/,contains:[W,I.C_LINE_COMMENT_MODE,I.C_BLOCK_COMMENT_MODE]},{beginKeywords:"record",relevance:0,end:/[{;=]/,illegal:/[^\s:]/,contains:[W,a,I.C_LINE_COMMENT_MODE,I.C_BLOCK_COMMENT_MODE]},{className:"meta",begin:"^\\s*\\[(?=[\\w])",excludeBegin:!0,end:"\\]",excludeEnd:!0,contains:[{className:"string",begin:/"/,end:/"/}]},{beginKeywords:"new return throw await else",relevance:0},{className:"function",begin:"("+u+"\\s+)+"+I.IDENT_RE+"\\s*(<[^=]+>\\s*)?\\(",returnBegin:!0,end:/\s*[{;=]/,excludeEnd:!0,keywords:t,contains:[{beginKeywords:l.join(" "),relevance:0},{begin:I.IDENT_RE+"\\s*(<[^=]+>\\s*)?\\(",returnBegin:!0,contains:[I.TITLE_MODE,a],relevance:0},{match:/\(\)/},{className:"params",begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:t,relevance:0,contains:[F,n,I.C_BLOCK_COMMENT_MODE]},I.C_LINE_COMMENT_MODE,I.C_BLOCK_COMMENT_MODE]},Q]}}var xL=I=>({IMPORTANT:{scope:"meta",begin:"!important"},BLOCK_COMMENT:I.C_BLOCK_COMMENT_MODE,HEXCOLOR:{scope:"number",begin:/#(([0-9a-fA-F]{3,4})|(([0-9a-fA-F]{2}){3,4}))\b/},FUNCTION_DISPATCH:{className:"built_in",begin:/[\w-]+(?=\()/},ATTRIBUTE_SELECTOR_MODE:{scope:"selector-attr",begin:/\[/,end:/\]/,illegal:"$",contains:[I.APOS_STRING_MODE,I.QUOTE_STRING_MODE]},CSS_NUMBER_MODE:{scope:"number",begin:I.NUMBER_RE+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",relevance:0},CSS_VARIABLE:{className:"attr",begin:/--[A-Za-z][A-Za-z0-9_-]*/}}),zL=["a","abbr","address","article","aside","audio","b","blockquote","body","button","canvas","caption","cite","code","dd","del","details","dfn","div","dl","dt","em","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","html","i","iframe","img","input","ins","kbd","label","legend","li","main","mark","menu","nav","object","ol","p","q","quote","samp","section","span","strong","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","ul","var","video"],UL=["any-hover","any-pointer","aspect-ratio","color","color-gamut","color-index","device-aspect-ratio","device-height","device-width","display-mode","forced-colors","grid","height","hover","inverted-colors","monochrome","orientation","overflow-block","overflow-inline","pointer","prefers-color-scheme","prefers-contrast","prefers-reduced-motion","prefers-reduced-transparency","resolution","scan","scripting","update","width","min-width","max-width","min-height","max-height"],ML=["active","any-link","blank","checked","current","default","defined","dir","disabled","drop","empty","enabled","first","first-child","first-of-type","fullscreen","future","focus","focus-visible","focus-within","has","host","host-context","hover","indeterminate","in-range","invalid","is","lang","last-child","last-of-type","left","link","local-link","not","nth-child","nth-col","nth-last-child","nth-last-col","nth-last-of-type","nth-of-type","only-child","only-of-type","optional","out-of-range","past","placeholder-shown","read-only","read-write","required","right","root","scope","target","target-within","user-invalid","valid","visited","where"],BL=["after","backdrop","before","cue","cue-region","first-letter","first-line","grammar-error","marker","part","placeholder","selection","slotted","spelling-error"],OL=["align-content","align-items","align-self","all","animation","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","backface-visibility","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","block-size","border","border-block","border-block-color","border-block-end","border-block-end-color","border-block-end-style","border-block-end-width","border-block-start","border-block-start-color","border-block-start-style","border-block-start-width","border-block-style","border-block-width","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-inline","border-inline-color","border-inline-end","border-inline-end-color","border-inline-end-style","border-inline-end-width","border-inline-start","border-inline-start-color","border-inline-start-style","border-inline-start-width","border-inline-style","border-inline-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","caret-color","clear","clip","clip-path","clip-rule","color","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","contain","content","content-visibility","counter-increment","counter-reset","cue","cue-after","cue-before","cursor","direction","display","empty-cells","filter","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","flow","font","font-display","font-family","font-feature-settings","font-kerning","font-language-override","font-size","font-size-adjust","font-smoothing","font-stretch","font-style","font-synthesis","font-variant","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-variation-settings","font-weight","gap","glyph-orientation-vertical","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column","grid-column-end","grid-column-start","grid-gap","grid-row","grid-row-end","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphens","icon","image-orientation","image-rendering","image-resolution","ime-mode","inline-size","isolation","justify-content","left","letter-spacing","line-break","line-height","list-style","list-style-image","list-style-position","list-style-type","margin","margin-block","margin-block-end","margin-block-start","margin-bottom","margin-inline","margin-inline-end","margin-inline-start","margin-left","margin-right","margin-top","marks","mask","mask-border","mask-border-mode","mask-border-outset","mask-border-repeat","mask-border-slice","mask-border-source","mask-border-width","mask-clip","mask-composite","mask-image","mask-mode","mask-origin","mask-position","mask-repeat","mask-size","mask-type","max-block-size","max-height","max-inline-size","max-width","min-block-size","min-height","min-inline-size","min-width","mix-blend-mode","nav-down","nav-index","nav-left","nav-right","nav-up","none","normal","object-fit","object-position","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-wrap","overflow-x","overflow-y","padding","padding-block","padding-block-end","padding-block-start","padding-bottom","padding-inline","padding-inline-end","padding-inline-start","padding-left","padding-right","padding-top","page-break-after","page-break-before","page-break-inside","pause","pause-after","pause-before","perspective","perspective-origin","pointer-events","position","quotes","resize","rest","rest-after","rest-before","right","row-gap","scroll-margin","scroll-margin-block","scroll-margin-block-end","scroll-margin-block-start","scroll-margin-bottom","scroll-margin-inline","scroll-margin-inline-end","scroll-margin-inline-start","scroll-margin-left","scroll-margin-right","scroll-margin-top","scroll-padding","scroll-padding-block","scroll-padding-block-end","scroll-padding-block-start","scroll-padding-bottom","scroll-padding-inline","scroll-padding-inline-end","scroll-padding-inline-start","scroll-padding-left","scroll-padding-right","scroll-padding-top","scroll-snap-align","scroll-snap-stop","scroll-snap-type","scrollbar-color","scrollbar-gutter","scrollbar-width","shape-image-threshold","shape-margin","shape-outside","speak","speak-as","src","tab-size","table-layout","text-align","text-align-all","text-align-last","text-combine-upright","text-decoration","text-decoration-color","text-decoration-line","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-indent","text-justify","text-orientation","text-overflow","text-rendering","text-shadow","text-transform","text-underline-position","top","transform","transform-box","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","white-space","widows","width","will-change","word-break","word-spacing","word-wrap","writing-mode","z-index"].reverse();function Cw(I){let G=I.regex,l=xL(I),b={begin:/-(webkit|moz|ms|o)-(?=[a-z])/},d="and or not only",e=/@-?\w[\w]*(-\w+)*/,t="[a-zA-Z-][a-zA-Z0-9_-]*",W=[I.APOS_STRING_MODE,I.QUOTE_STRING_MODE];return{name:"CSS",case_insensitive:!0,illegal:/[=|'\$]/,keywords:{keyframePosition:"from to"},classNameAliases:{keyframePosition:"selector-tag"},contains:[l.BLOCK_COMMENT,b,l.CSS_NUMBER_MODE,{className:"selector-id",begin:/#[A-Za-z0-9_-]+/,relevance:0},{className:"selector-class",begin:"\\."+t,relevance:0},l.ATTRIBUTE_SELECTOR_MODE,{className:"selector-pseudo",variants:[{begin:":("+ML.join("|")+")"},{begin:":(:)?("+BL.join("|")+")"}]},l.CSS_VARIABLE,{className:"attribute",begin:"\\b("+OL.join("|")+")\\b"},{begin:/:/,end:/[;}{]/,contains:[l.BLOCK_COMMENT,l.HEXCOLOR,l.IMPORTANT,l.CSS_NUMBER_MODE,...W,{begin:/(url|data-uri)\(/,end:/\)/,relevance:0,keywords:{built_in:"url data-uri"},contains:[...W,{className:"string",begin:/[^)]/,endsWithParent:!0,excludeEnd:!0}]},l.FUNCTION_DISPATCH]},{begin:G.lookahead(/@/),end:"[{;]",relevance:0,illegal:/:/,contains:[{className:"keyword",begin:e},{begin:/\s/,endsWithParent:!0,excludeEnd:!0,relevance:0,keywords:{$pattern:/[a-z-]+/,keyword:d,attribute:UL.join(" ")},contains:[{begin:/[a-z-]+(?=:)/,className:"attribute"},...W,l.CSS_NUMBER_MODE]}]},{className:"selector-tag",begin:"\\b("+zL.join("|")+")\\b"}]}}function Aw(I){let G=I.regex;return{name:"Diff",aliases:["patch"],contains:[{className:"meta",relevance:10,match:G.either(/^@@ +-\d+,\d+ +\+\d+,\d+ +@@/,/^\*\*\* +\d+,\d+ +\*\*\*\*$/,/^--- +\d+,\d+ +----$/)},{className:"comment",variants:[{begin:G.either(/Index: /,/^index/,/={3,}/,/^-{3}/,/^\*{3} /,/^\+{3}/,/^diff --git/),end:/$/},{match:/^\*{15}$/}]},{className:"addition",begin:/^\+/,end:/$/},{className:"deletion",begin:/^-/,end:/$/},{className:"addition",begin:/^!/,end:/$/}]}}function Lw(I){let e={keyword:["break","case","chan","const","continue","default","defer","else","fallthrough","for","func","go","goto","if","import","interface","map","package","range","return","select","struct","switch","type","var"],type:["bool","byte","complex64","complex128","error","float32","float64","int8","int16","int32","int64","string","uint8","uint16","uint32","uint64","int","uint","uintptr","rune"],literal:["true","false","iota","nil"],built_in:["append","cap","close","complex","copy","imag","len","make","new","panic","print","println","real","recover","delete"]};return{name:"Go",aliases:["golang"],keywords:e,illegal:"</",contains:[I.C_LINE_COMMENT_MODE,I.C_BLOCK_COMMENT_MODE,{className:"string",variants:[I.QUOTE_STRING_MODE,I.APOS_STRING_MODE,{begin:"`",end:"`"}]},{className:"number",variants:[{begin:I.C_NUMBER_RE+"[i]",relevance:1},I.C_NUMBER_MODE]},{begin:/:=/},{className:"function",beginKeywords:"func",end:"\\s*(\\{|$)",excludeEnd:!0,contains:[I.TITLE_MODE,{className:"params",begin:/\(/,end:/\)/,endsParent:!0,keywords:e,illegal:/["']/}]}]}}function kw(I){let G=I.regex,l=/[_A-Za-z][_0-9A-Za-z]*/;return{name:"GraphQL",aliases:["gql"],case_insensitive:!0,disableAutodetect:!1,keywords:{keyword:["query","mutation","subscription","type","input","schema","directive","interface","union","scalar","fragment","enum","on"],literal:["true","false","null"]},contains:[I.HASH_COMMENT_MODE,I.QUOTE_STRING_MODE,I.NUMBER_MODE,{scope:"punctuation",match:/[.]{3}/,relevance:0},{scope:"punctuation",begin:/[\!\(\)\:\=\[\]\{\|\}]{1}/,relevance:0},{scope:"variable",begin:/\$/,end:/\W/,excludeEnd:!0,relevance:0},{scope:"meta",match:/@\w+/,excludeEnd:!0},{scope:"symbol",begin:G.concat(l,G.lookahead(/\s*:/)),relevance:0}],illegal:[/[;<']/,/BEGIN/]}}function xw(I){let G=I.regex,l={className:"number",relevance:0,variants:[{begin:/([+-]+)?[\d]+_[\d_]+/},{begin:I.NUMBER_RE}]},b=I.COMMENT();b.variants=[{begin:/;/,end:/$/},{begin:/#/,end:/$/}];let d={className:"variable",variants:[{begin:/\$[\w\d"][\w\d_]*/},{begin:/\$\{(.*?)\}/}]},e={className:"literal",begin:/\bon|off|true|false|yes|no\b/},t={className:"string",contains:[I.BACKSLASH_ESCAPE],variants:[{begin:"'''",end:"'''",relevance:10},{begin:'"""',end:'"""',relevance:10},{begin:'"',end:'"'},{begin:"'",end:"'"}]},W={begin:/\[/,end:/\]/,contains:[b,e,d,t,l,"self"],relevance:0},n=/[A-Za-z0-9_-]+/,s=/"(\\"|[^"])*"/,N=/'[^']*'/,m=G.either(n,s,N),h=G.concat(m,"(\\s*\\.\\s*",m,")*",G.lookahead(/\s*=\s*[^#\s]/));return{name:"TOML, also INI",aliases:["toml"],case_insensitive:!0,illegal:/\S/,contains:[b,{className:"section",begin:/\[+/,end:/\]+/},{begin:h,className:"attr",starts:{end:/$/,contains:[b,W,e,d,t,l]}}]}}var Bn="[0-9](_*[0-9])*",wu=`\\.(${Bn})`,vu="[0-9a-fA-F](_*[0-9a-fA-F])*",zw={className:"number",variants:[{begin:`(\\b(${Bn})((${wu})|\\.)?|(${wu}))[eE][+-]?(${Bn})[fFdD]?\\b`},{begin:`\\b(${Bn})((${wu})[fFdD]?\\b|\\.([fFdD]\\b)?)`},{begin:`(${wu})[fFdD]?\\b`},{begin:`\\b(${Bn})[fFdD]\\b`},{begin:`\\b0[xX]((${vu})\\.?|(${vu})?\\.(${vu}))[pP][+-]?(${Bn})[fFdD]?\\b`},{begin:"\\b(0|[1-9](_*[0-9])*)[lL]?\\b"},{begin:`\\b0[xX](${vu})[lL]?\\b`},{begin:"\\b0(_*[0-7])*[lL]?\\b"},{begin:"\\b0[bB][01](_*[01])*[lL]?\\b"}],relevance:0};function Uw(I,G,l){return l===-1?"":I.replace(G,b=>Uw(I,G,l-1))}function Mw(I){let G=I.regex,l="[\xC0-\u02B8a-zA-Z_$][\xC0-\u02B8a-zA-Z_$0-9]*",b=l+Uw("(?:<"+l+"~~~(?:\\s*,\\s*"+l+"~~~)*>)?",/~~~/g,2),n={keyword:["synchronized","abstract","private","var","static","if","const ","for","while","strictfp","finally","protected","import","native","final","void","enum","else","break","transient","catch","instanceof","volatile","case","assert","package","default","public","try","switch","continue","throws","protected","public","private","module","requires","exports","do","sealed","yield","permits"],literal:["false","true","null"],type:["char","boolean","long","float","int","byte","short","double"],built_in:["super","this"]},s={className:"meta",begin:"@"+l,contains:[{begin:/\(/,end:/\)/,contains:["self"]}]},N={className:"params",begin:/\(/,end:/\)/,keywords:n,relevance:0,contains:[I.C_BLOCK_COMMENT_MODE],endsParent:!0};return{name:"Java",aliases:["jsp"],keywords:n,illegal:/<\/|#/,contains:[I.COMMENT("/\\*\\*","\\*/",{relevance:0,contains:[{begin:/\w+@/,relevance:0},{className:"doctag",begin:"@[A-Za-z]+"}]}),{begin:/import java\.[a-z]+\./,keywords:"import",relevance:2},I.C_LINE_COMMENT_MODE,I.C_BLOCK_COMMENT_MODE,{begin:/"""/,end:/"""/,className:"string",contains:[I.BACKSLASH_ESCAPE]},I.APOS_STRING_MODE,I.QUOTE_STRING_MODE,{match:[/\b(?:class|interface|enum|extends|implements|new)/,/\s+/,l],className:{1:"keyword",3:"title.class"}},{match:/non-sealed/,scope:"keyword"},{begin:[G.concat(/(?!else)/,l),/\s+/,l,/\s+/,/=(?!=)/],className:{1:"type",3:"variable",5:"operator"}},{begin:[/record/,/\s+/,l],className:{1:"keyword",3:"title.class"},contains:[N,I.C_LINE_COMMENT_MODE,I.C_BLOCK_COMMENT_MODE]},{beginKeywords:"new throw return else",relevance:0},{begin:["(?:"+b+"\\s+)",I.UNDERSCORE_IDENT_RE,/\s*(?=\()/],className:{2:"title.function"},keywords:n,contains:[{className:"params",begin:/\(/,end:/\)/,keywords:n,relevance:0,contains:[s,I.APOS_STRING_MODE,I.QUOTE_STRING_MODE,zw,I.C_BLOCK_COMMENT_MODE]},I.C_LINE_COMMENT_MODE,I.C_BLOCK_COMMENT_MODE]},zw,s]}}var Bw="[A-Za-z$_][0-9A-Za-z$_]*",jL=["as","in","of","if","for","while","finally","var","new","function","do","return","void","else","break","catch","instanceof","with","throw","case","default","try","switch","continue","typeof","delete","let","yield","const","class","debugger","async","await","static","import","from","export","extends"],KL=["true","false","null","undefined","NaN","Infinity"],Ow=["Object","Function","Boolean","Symbol","Math","Date","Number","BigInt","String","RegExp","Array","Float32Array","Float64Array","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Int32Array","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array","Set","Map","WeakSet","WeakMap","ArrayBuffer","SharedArrayBuffer","Atomics","DataView","JSON","Promise","Generator","GeneratorFunction","AsyncFunction","Reflect","Proxy","Intl","WebAssembly"],jw=["Error","EvalError","InternalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError"],Kw=["setInterval","setTimeout","clearInterval","clearTimeout","require","exports","eval","isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","unescape"],TL=["arguments","this","super","console","window","document","localStorage","sessionStorage","module","global"],fL=[].concat(Kw,Ow,jw);function Tw(I){let G=I.regex,l=(pI,{after:yI})=>{let eI="</"+pI[0].slice(1);return pI.input.indexOf(eI,yI)!==-1},b=Bw,d={begin:"<>",end:"</>"},e=/<[A-Za-z0-9\\._:-]+\s*\/>/,t={begin:/<[A-Za-z0-9\\._:-]+/,end:/\/[A-Za-z0-9\\._:-]+>|\/>/,isTrulyOpeningTag:(pI,yI)=>{let eI=pI[0].length+pI.index,HI=pI.input[eI];if(HI==="<"||HI===","){yI.ignoreMatch();return}HI===">"&&(l(pI,{after:eI})||yI.ignoreMatch());let YI,$=pI.input.substring(eI);if(YI=$.match(/^\s*=/)){yI.ignoreMatch();return}if((YI=$.match(/^\s+extends\s+/))&&YI.index===0){yI.ignoreMatch();return}}},W={$pattern:Bw,keyword:jL,literal:KL,built_in:fL,"variable.language":TL},n="[0-9](_?[0-9])*",s=`\\.(${n})`,N="0|[1-9](_?[0-9])*|0[0-7]*[89][0-9]*",m={className:"number",variants:[{begin:`(\\b(${N})((${s})|\\.)?|(${s}))[eE][+-]?(${n})\\b`},{begin:`\\b(${N})\\b((${s})\\b|\\.)?|(${s})\\b`},{begin:"\\b(0|[1-9](_?[0-9])*)n\\b"},{begin:"\\b0[xX][0-9a-fA-F](_?[0-9a-fA-F])*n?\\b"},{begin:"\\b0[bB][0-1](_?[0-1])*n?\\b"},{begin:"\\b0[oO][0-7](_?[0-7])*n?\\b"},{begin:"\\b0[0-7]+n?\\b"}],relevance:0},h={className:"subst",begin:"\\$\\{",end:"\\}",keywords:W,contains:[]},V={begin:"html`",end:"",starts:{end:"`",returnEnd:!1,contains:[I.BACKSLASH_ESCAPE,h],subLanguage:"xml"}},X={begin:"css`",end:"",starts:{end:"`",returnEnd:!1,contains:[I.BACKSLASH_ESCAPE,h],subLanguage:"css"}},p={begin:"gql`",end:"",starts:{end:"`",returnEnd:!1,contains:[I.BACKSLASH_ESCAPE,h],subLanguage:"graphql"}},F={className:"string",begin:"`",end:"`",contains:[I.BACKSLASH_ESCAPE,h]},u={className:"comment",variants:[I.COMMENT(/\/\*\*(?!\/)/,"\\*/",{relevance:0,contains:[{begin:"(?=@[A-Za-z]+)",relevance:0,contains:[{className:"doctag",begin:"@[A-Za-z]+"},{className:"type",begin:"\\{",end:"\\}",excludeEnd:!0,excludeBegin:!0,relevance:0},{className:"variable",begin:b+"(?=\\s*(-)|$)",endsParent:!0,relevance:0},{begin:/(?=[^\n])\s/,relevance:0}]}]}),I.C_BLOCK_COMMENT_MODE,I.C_LINE_COMMENT_MODE]},Q=[I.APOS_STRING_MODE,I.QUOTE_STRING_MODE,V,X,p,F,{match:/\$\d+/},m];h.contains=Q.concat({begin:/\{/,end:/\}/,keywords:W,contains:["self"].concat(Q)});let o=[].concat(u,h.contains),y=o.concat([{begin:/\(/,end:/\)/,keywords:W,contains:["self"].concat(o)}]),H={className:"params",begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:W,contains:y},E={variants:[{match:[/class/,/\s+/,b,/\s+/,/extends/,/\s+/,G.concat(b,"(",G.concat(/\./,b),")*")],scope:{1:"keyword",3:"title.class",5:"keyword",7:"title.class.inherited"}},{match:[/class/,/\s+/,b],scope:{1:"keyword",3:"title.class"}}]},C={relevance:0,match:G.either(/\bJSON/,/\b[A-Z][a-z]+([A-Z][a-z]*|\d)*/,/\b[A-Z]{2,}([A-Z][a-z]+|\d)+([A-Z][a-z]*)*/,/\b[A-Z]{2,}[a-z]+([A-Z][a-z]+|\d)*([A-Z][a-z]*)*/),className:"title.class",keywords:{_:[...Ow,...jw]}},T={label:"use_strict",className:"meta",relevance:10,begin:/^\s*['"]use (strict|asm)['"]/},S={variants:[{match:[/function/,/\s+/,b,/(?=\s*\()/]},{match:[/function/,/\s*(?=\()/]}],className:{1:"keyword",3:"title.function"},label:"func.def",contains:[H],illegal:/%/},cI={relevance:0,match:/\b[A-Z][A-Z_0-9]+\b/,className:"variable.constant"};function hI(pI){return G.concat("(?!",pI.join("|"),")")}let WI={match:G.concat(/\b/,hI([...Kw,"super","import"]),b,G.lookahead(/\(/)),className:"title.function",relevance:0},VI={begin:G.concat(/\./,G.lookahead(G.concat(b,/(?![0-9A-Za-z$_(])/))),end:b,excludeBegin:!0,keywords:"prototype",className:"property",relevance:0},sI={match:[/get|set/,/\s+/,b,/(?=\()/],className:{1:"keyword",3:"title.function"},contains:[{begin:/\(\)/},H]},ZI="(\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)|"+I.UNDERSCORE_IDENT_RE+")\\s*=>",dI={match:[/const|var|let/,/\s+/,b,/\s*/,/=\s*/,/(async\s*)?/,G.lookahead(ZI)],keywords:"async",className:{1:"keyword",3:"title.function"},contains:[H]};return{name:"JavaScript",aliases:["js","jsx","mjs","cjs"],keywords:W,exports:{PARAMS_CONTAINS:y,CLASS_REFERENCE:C},illegal:/#(?![$_A-z])/,contains:[I.SHEBANG({label:"shebang",binary:"node",relevance:5}),T,I.APOS_STRING_MODE,I.QUOTE_STRING_MODE,V,X,p,F,u,{match:/\$\d+/},m,C,{className:"attr",begin:b+G.lookahead(":"),relevance:0},dI,{begin:"("+I.RE_STARTERS_RE+"|\\b(case|return|throw)\\b)\\s*",keywords:"return throw case",relevance:0,contains:[u,I.REGEXP_MODE,{className:"function",begin:ZI,returnBegin:!0,end:"\\s*=>",contains:[{className:"params",variants:[{begin:I.UNDERSCORE_IDENT_RE,relevance:0},{className:null,begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:W,contains:y}]}]},{begin:/,/,relevance:0},{match:/\s+/,relevance:0},{variants:[{begin:d.begin,end:d.end},{match:e},{begin:t.begin,"on:begin":t.isTrulyOpeningTag,end:t.end}],subLanguage:"xml",contains:[{begin:t.begin,end:t.end,skip:!0,contains:["self"]}]}]},S,{beginKeywords:"while if switch catch for"},{begin:"\\b(?!function)"+I.UNDERSCORE_IDENT_RE+"\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)\\s*\\{",returnBegin:!0,label:"func.def",contains:[H,I.inherit(I.TITLE_MODE,{begin:b,className:"title.function"})]},{match:/\.\.\./,relevance:0},VI,{match:"\\$"+b,relevance:0},{match:[/\bconstructor(?=\s*\()/],className:{1:"title.function"},contains:[H]},WI,cI,E,sI,{match:/\$[(.]/}]}}function fw(I){let G={className:"attr",begin:/"(\\.|[^\\"\r\n])*"(?=\s*:)/,relevance:1.01},l={match:/[{}[\],:]/,className:"punctuation",relevance:0},b=["true","false","null"],d={scope:"literal",beginKeywords:b.join(" ")};return{name:"JSON",keywords:{literal:b},contains:[G,l,I.QUOTE_STRING_MODE,d,I.C_NUMBER_MODE,I.C_LINE_COMMENT_MODE,I.C_BLOCK_COMMENT_MODE],illegal:"\\S"}}var On="[0-9](_*[0-9])*",Eu=`\\.(${On})`,yu="[0-9a-fA-F](_*[0-9a-fA-F])*",SL={className:"number",variants:[{begin:`(\\b(${On})((${Eu})|\\.)?|(${Eu}))[eE][+-]?(${On})[fFdD]?\\b`},{begin:`\\b(${On})((${Eu})[fFdD]?\\b|\\.([fFdD]\\b)?)`},{begin:`(${Eu})[fFdD]?\\b`},{begin:`\\b(${On})[fFdD]\\b`},{begin:`\\b0[xX]((${yu})\\.?|(${yu})?\\.(${yu}))[pP][+-]?(${On})[fFdD]?\\b`},{begin:"\\b(0|[1-9](_*[0-9])*)[lL]?\\b"},{begin:`\\b0[xX](${yu})[lL]?\\b`},{begin:"\\b0(_*[0-7])*[lL]?\\b"},{begin:"\\b0[bB][01](_*[01])*[lL]?\\b"}],relevance:0};function Sw(I){let G={keyword:"abstract as val var vararg get set class object open private protected public noinline crossinline dynamic final enum if else do while for when throw try catch finally import package is in fun override companion reified inline lateinit init interface annotation data sealed internal infix operator out by constructor super tailrec where const inner suspend typealias external expect actual",built_in:"Byte Short Char Int Long Boolean Float Double Void Unit Nothing",literal:"true false null"},l={className:"keyword",begin:/\b(break|continue|return|this)\b/,starts:{contains:[{className:"symbol",begin:/@\w+/}]}},b={className:"symbol",begin:I.UNDERSCORE_IDENT_RE+"@"},d={className:"subst",begin:/\$\{/,end:/\}/,contains:[I.C_NUMBER_MODE]},e={className:"variable",begin:"\\$"+I.UNDERSCORE_IDENT_RE},t={className:"string",variants:[{begin:'"""',end:'"""(?=[^"])',contains:[e,d]},{begin:"'",end:"'",illegal:/\n/,contains:[I.BACKSLASH_ESCAPE]},{begin:'"',end:'"',illegal:/\n/,contains:[I.BACKSLASH_ESCAPE,e,d]}]};d.contains.push(t);let W={className:"meta",begin:"@(?:file|property|field|get|set|receiver|param|setparam|delegate)\\s*:(?:\\s*"+I.UNDERSCORE_IDENT_RE+")?"},n={className:"meta",begin:"@"+I.UNDERSCORE_IDENT_RE,contains:[{begin:/\(/,end:/\)/,contains:[I.inherit(t,{className:"string"}),"self"]}]},s=SL,N=I.COMMENT("/\\*","\\*/",{contains:[I.C_BLOCK_COMMENT_MODE]}),m={variants:[{className:"type",begin:I.UNDERSCORE_IDENT_RE},{begin:/\(/,end:/\)/,contains:[]}]},h=m;return h.variants[1].contains=[m],m.variants[1].contains=[h],{name:"Kotlin",aliases:["kt","kts"],keywords:G,contains:[I.COMMENT("/\\*\\*","\\*/",{relevance:0,contains:[{className:"doctag",begin:"@[A-Za-z]+"}]}),I.C_LINE_COMMENT_MODE,N,l,b,W,n,{className:"function",beginKeywords:"fun",end:"[(]|$",returnBegin:!0,excludeEnd:!0,keywords:G,relevance:5,contains:[{begin:I.UNDERSCORE_IDENT_RE+"\\s*\\(",returnBegin:!0,relevance:0,contains:[I.UNDERSCORE_TITLE_MODE]},{className:"type",begin:/</,end:/>/,keywords:"reified",relevance:0},{className:"params",begin:/\(/,end:/\)/,endsParent:!0,keywords:G,relevance:0,contains:[{begin:/:/,end:/[=,\/]/,endsWithParent:!0,contains:[m,I.C_LINE_COMMENT_MODE,N],relevance:0},I.C_LINE_COMMENT_MODE,N,W,n,t,I.C_NUMBER_MODE]},N]},{begin:[/class|interface|trait/,/\s+/,I.UNDERSCORE_IDENT_RE],beginScope:{3:"title.class"},keywords:"class interface trait",end:/[:\{(]|$/,excludeEnd:!0,illegal:"extends implements",contains:[{beginKeywords:"public protected internal private constructor"},I.UNDERSCORE_TITLE_MODE,{className:"type",begin:/</,end:/>/,excludeBegin:!0,excludeEnd:!0,relevance:0},{className:"type",begin:/[,:]\s*/,end:/[<\(,){\s]|$/,excludeBegin:!0,returnEnd:!0},W,n]},t,{className:"meta",begin:"^#!/usr/bin/env",end:"$",illegal:`
`},s]}}var DL=I=>({IMPORTANT:{scope:"meta",begin:"!important"},BLOCK_COMMENT:I.C_BLOCK_COMMENT_MODE,HEXCOLOR:{scope:"number",begin:/#(([0-9a-fA-F]{3,4})|(([0-9a-fA-F]{2}){3,4}))\b/},FUNCTION_DISPATCH:{className:"built_in",begin:/[\w-]+(?=\()/},ATTRIBUTE_SELECTOR_MODE:{scope:"selector-attr",begin:/\[/,end:/\]/,illegal:"$",contains:[I.APOS_STRING_MODE,I.QUOTE_STRING_MODE]},CSS_NUMBER_MODE:{scope:"number",begin:I.NUMBER_RE+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",relevance:0},CSS_VARIABLE:{className:"attr",begin:/--[A-Za-z][A-Za-z0-9_-]*/}}),qL=["a","abbr","address","article","aside","audio","b","blockquote","body","button","canvas","caption","cite","code","dd","del","details","dfn","div","dl","dt","em","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","html","i","iframe","img","input","ins","kbd","label","legend","li","main","mark","menu","nav","object","ol","p","q","quote","samp","section","span","strong","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","ul","var","video"],_L=["any-hover","any-pointer","aspect-ratio","color","color-gamut","color-index","device-aspect-ratio","device-height","device-width","display-mode","forced-colors","grid","height","hover","inverted-colors","monochrome","orientation","overflow-block","overflow-inline","pointer","prefers-color-scheme","prefers-contrast","prefers-reduced-motion","prefers-reduced-transparency","resolution","scan","scripting","update","width","min-width","max-width","min-height","max-height"],Dw=["active","any-link","blank","checked","current","default","defined","dir","disabled","drop","empty","enabled","first","first-child","first-of-type","fullscreen","future","focus","focus-visible","focus-within","has","host","host-context","hover","indeterminate","in-range","invalid","is","lang","last-child","last-of-type","left","link","local-link","not","nth-child","nth-col","nth-last-child","nth-last-col","nth-last-of-type","nth-of-type","only-child","only-of-type","optional","out-of-range","past","placeholder-shown","read-only","read-write","required","right","root","scope","target","target-within","user-invalid","valid","visited","where"],qw=["after","backdrop","before","cue","cue-region","first-letter","first-line","grammar-error","marker","part","placeholder","selection","slotted","spelling-error"],PL=["align-content","align-items","align-self","all","animation","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","backface-visibility","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","block-size","border","border-block","border-block-color","border-block-end","border-block-end-color","border-block-end-style","border-block-end-width","border-block-start","border-block-start-color","border-block-start-style","border-block-start-width","border-block-style","border-block-width","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-inline","border-inline-color","border-inline-end","border-inline-end-color","border-inline-end-style","border-inline-end-width","border-inline-start","border-inline-start-color","border-inline-start-style","border-inline-start-width","border-inline-style","border-inline-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","caret-color","clear","clip","clip-path","clip-rule","color","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","contain","content","content-visibility","counter-increment","counter-reset","cue","cue-after","cue-before","cursor","direction","display","empty-cells","filter","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","flow","font","font-display","font-family","font-feature-settings","font-kerning","font-language-override","font-size","font-size-adjust","font-smoothing","font-stretch","font-style","font-synthesis","font-variant","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-variation-settings","font-weight","gap","glyph-orientation-vertical","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column","grid-column-end","grid-column-start","grid-gap","grid-row","grid-row-end","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphens","icon","image-orientation","image-rendering","image-resolution","ime-mode","inline-size","isolation","justify-content","left","letter-spacing","line-break","line-height","list-style","list-style-image","list-style-position","list-style-type","margin","margin-block","margin-block-end","margin-block-start","margin-bottom","margin-inline","margin-inline-end","margin-inline-start","margin-left","margin-right","margin-top","marks","mask","mask-border","mask-border-mode","mask-border-outset","mask-border-repeat","mask-border-slice","mask-border-source","mask-border-width","mask-clip","mask-composite","mask-image","mask-mode","mask-origin","mask-position","mask-repeat","mask-size","mask-type","max-block-size","max-height","max-inline-size","max-width","min-block-size","min-height","min-inline-size","min-width","mix-blend-mode","nav-down","nav-index","nav-left","nav-right","nav-up","none","normal","object-fit","object-position","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-wrap","overflow-x","overflow-y","padding","padding-block","padding-block-end","padding-block-start","padding-bottom","padding-inline","padding-inline-end","padding-inline-start","padding-left","padding-right","padding-top","page-break-after","page-break-before","page-break-inside","pause","pause-after","pause-before","perspective","perspective-origin","pointer-events","position","quotes","resize","rest","rest-after","rest-before","right","row-gap","scroll-margin","scroll-margin-block","scroll-margin-block-end","scroll-margin-block-start","scroll-margin-bottom","scroll-margin-inline","scroll-margin-inline-end","scroll-margin-inline-start","scroll-margin-left","scroll-margin-right","scroll-margin-top","scroll-padding","scroll-padding-block","scroll-padding-block-end","scroll-padding-block-start","scroll-padding-bottom","scroll-padding-inline","scroll-padding-inline-end","scroll-padding-inline-start","scroll-padding-left","scroll-padding-right","scroll-padding-top","scroll-snap-align","scroll-snap-stop","scroll-snap-type","scrollbar-color","scrollbar-gutter","scrollbar-width","shape-image-threshold","shape-margin","shape-outside","speak","speak-as","src","tab-size","table-layout","text-align","text-align-all","text-align-last","text-combine-upright","text-decoration","text-decoration-color","text-decoration-line","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-indent","text-justify","text-orientation","text-overflow","text-rendering","text-shadow","text-transform","text-underline-position","top","transform","transform-box","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","white-space","widows","width","will-change","word-break","word-spacing","word-wrap","writing-mode","z-index"].reverse(),$L=Dw.concat(qw);function _w(I){let G=DL(I),l=$L,b="and or not only",d="[\\w-]+",e="("+d+"|@\\{"+d+"\\})",t=[],W=[],n=function(Q){return{className:"string",begin:"~?"+Q+".*?"+Q}},s=function(Q,o,y){return{className:Q,begin:o,relevance:y}},N={$pattern:/[a-z-]+/,keyword:b,attribute:_L.join(" ")},m={begin:"\\(",end:"\\)",contains:W,keywords:N,relevance:0};W.push(I.C_LINE_COMMENT_MODE,I.C_BLOCK_COMMENT_MODE,n("'"),n('"'),G.CSS_NUMBER_MODE,{begin:"(url|data-uri)\\(",starts:{className:"string",end:"[\\)\\n]",excludeEnd:!0}},G.HEXCOLOR,m,s("variable","@@?"+d,10),s("variable","@\\{"+d+"\\}"),s("built_in","~?`[^`]*?`"),{className:"attribute",begin:d+"\\s*:",end:":",returnBegin:!0,excludeEnd:!0},G.IMPORTANT,{beginKeywords:"and not"},G.FUNCTION_DISPATCH);let h=W.concat({begin:/\{/,end:/\}/,contains:t}),V={beginKeywords:"when",endsWithParent:!0,contains:[{beginKeywords:"and not"}].concat(W)},X={begin:e+"\\s*:",returnBegin:!0,end:/[;}]/,relevance:0,contains:[{begin:/-(webkit|moz|ms|o)-/},G.CSS_VARIABLE,{className:"attribute",begin:"\\b("+PL.join("|")+")\\b",end:/(?=:)/,starts:{endsWithParent:!0,illegal:"[<=$]",relevance:0,contains:W}}]},p={className:"keyword",begin:"@(import|media|charset|font-face|(-[a-z]+-)?keyframes|supports|document|namespace|page|viewport|host)\\b",starts:{end:"[;{}]",keywords:N,returnEnd:!0,contains:W,relevance:0}},F={className:"variable",variants:[{begin:"@"+d+"\\s*:",relevance:15},{begin:"@"+d}],starts:{end:"[;}]",returnEnd:!0,contains:h}},a={variants:[{begin:"[\\.#:&\\[>]",end:"[;{}]"},{begin:e,end:/\{/}],returnBegin:!0,returnEnd:!0,illegal:`[<='$"]`,relevance:0,contains:[I.C_LINE_COMMENT_MODE,I.C_BLOCK_COMMENT_MODE,V,s("keyword","all\\b"),s("variable","@\\{"+d+"\\}"),{begin:"\\b("+qL.join("|")+")\\b",className:"selector-tag"},G.CSS_NUMBER_MODE,s("selector-tag",e,0),s("selector-id","#"+e),s("selector-class","\\."+e,0),s("selector-tag","&",0),G.ATTRIBUTE_SELECTOR_MODE,{className:"selector-pseudo",begin:":("+Dw.join("|")+")"},{className:"selector-pseudo",begin:":(:)?("+qw.join("|")+")"},{begin:/\(/,end:/\)/,relevance:0,contains:h},{begin:"!important"},G.FUNCTION_DISPATCH]},u={begin:d+`:(:)?(${l.join("|")})`,returnBegin:!0,contains:[a]};return t.push(I.C_LINE_COMMENT_MODE,I.C_BLOCK_COMMENT_MODE,p,F,u,X,a,V,G.FUNCTION_DISPATCH),{name:"Less",case_insensitive:!0,illegal:`[=>'/<($"]`,contains:t}}function Pw(I){let G="\\[=*\\[",l="\\]=*\\]",b={begin:G,end:l,contains:["self"]},d=[I.COMMENT("--(?!"+G+")","$"),I.COMMENT("--"+G,l,{contains:[b],relevance:10})];return{name:"Lua",keywords:{$pattern:I.UNDERSCORE_IDENT_RE,literal:"true false nil",keyword:"and break do else elseif end for goto if in local not or repeat return then until while",built_in:"_G _ENV _VERSION __index __newindex __mode __call __metatable __tostring __len __gc __add __sub __mul __div __mod __pow __concat __unm __eq __lt __le assert collectgarbage dofile error getfenv getmetatable ipairs load loadfile loadstring module next pairs pcall print rawequal rawget rawset require select setfenv setmetatable tonumber tostring type unpack xpcall arg self coroutine resume yield status wrap create running debug getupvalue debug sethook getmetatable gethook setmetatable setlocal traceback setfenv getinfo setupvalue getlocal getregistry getfenv io lines write close flush open output type read stderr stdin input stdout popen tmpfile math log max acos huge ldexp pi cos tanh pow deg tan cosh sinh random randomseed frexp ceil floor rad abs sqrt modf asin min mod fmod log10 atan2 exp sin atan os exit setlocale date getenv difftime remove time clock tmpname rename execute package preload loadlib loaded loaders cpath config path seeall string sub upper len gfind rep find match char dump gmatch reverse byte format gsub lower table setn insert getn foreachi maxn foreach concat sort remove"},contains:d.concat([{className:"function",beginKeywords:"function",end:"\\)",contains:[I.inherit(I.TITLE_MODE,{begin:"([_a-zA-Z]\\w*\\.)*([_a-zA-Z]\\w*:)?[_a-zA-Z]\\w*"}),{className:"params",begin:"\\(",endsWithParent:!0,contains:d}].concat(d)},I.C_NUMBER_MODE,I.APOS_STRING_MODE,I.QUOTE_STRING_MODE,{className:"string",begin:G,end:l,contains:[b],relevance:5}])}}function $w(I){let G={className:"variable",variants:[{begin:"\\$\\("+I.UNDERSCORE_IDENT_RE+"\\)",contains:[I.BACKSLASH_ESCAPE]},{begin:/\$[@%<?\^\+\*]/}]},l={className:"string",begin:/"/,end:/"/,contains:[I.BACKSLASH_ESCAPE,G]},b={className:"variable",begin:/\$\([\w-]+\s/,end:/\)/,keywords:{built_in:"subst patsubst strip findstring filter filter-out sort word wordlist firstword lastword dir notdir suffix basename addsuffix addprefix join wildcard realpath abspath error warning shell origin flavor foreach if or and call eval file value"},contains:[G]},d={begin:"^"+I.UNDERSCORE_IDENT_RE+"\\s*(?=[:+?]?=)"},e={className:"meta",begin:/^\.PHONY:/,end:/$/,keywords:{$pattern:/[\.\w]+/,keyword:".PHONY"}},t={className:"section",begin:/^[^\s]+:/,end:/$/,contains:[G]};return{name:"Makefile",aliases:["mk","mak","make"],keywords:{$pattern:/[\w-]+/,keyword:"define endef undefine ifdef ifndef ifeq ifneq else endif include -include sinclude override export unexport private vpath"},contains:[I.HASH_COMMENT_MODE,G,l,b,d,e,t]}}function Iv(I){let G=I.regex,l={begin:/<\/?[A-Za-z_]/,end:">",subLanguage:"xml",relevance:0},b={begin:"^[-\\*]{3,}",end:"$"},d={className:"code",variants:[{begin:"(`{3,})[^`](.|\\n)*?\\1`*[ ]*"},{begin:"(~{3,})[^~](.|\\n)*?\\1~*[ ]*"},{begin:"```",end:"```+[ ]*$"},{begin:"~~~",end:"~~~+[ ]*$"},{begin:"`.+?`"},{begin:"(?=^( {4}|\\t))",contains:[{begin:"^( {4}|\\t)",end:"(\\n)$"}],relevance:0}]},e={className:"bullet",begin:"^[ 	]*([*+-]|(\\d+\\.))(?=\\s+)",end:"\\s+",excludeEnd:!0},t={begin:/^\[[^\n]+\]:/,returnBegin:!0,contains:[{className:"symbol",begin:/\[/,end:/\]/,excludeBegin:!0,excludeEnd:!0},{className:"link",begin:/:\s*/,end:/$/,excludeBegin:!0}]},W=/[A-Za-z][A-Za-z0-9+.-]*/,n={variants:[{begin:/\[.+?\]\[.*?\]/,relevance:0},{begin:/\[.+?\]\(((data|javascript|mailto):|(?:http|ftp)s?:\/\/).*?\)/,relevance:2},{begin:G.concat(/\[.+?\]\(/,W,/:\/\/.*?\)/),relevance:2},{begin:/\[.+?\]\([./?&#].*?\)/,relevance:1},{begin:/\[.*?\]\(.*?\)/,relevance:0}],returnBegin:!0,contains:[{match:/\[(?=\])/},{className:"string",relevance:0,begin:"\\[",end:"\\]",excludeBegin:!0,returnEnd:!0},{className:"link",relevance:0,begin:"\\]\\(",end:"\\)",excludeBegin:!0,excludeEnd:!0},{className:"symbol",relevance:0,begin:"\\]\\[",end:"\\]",excludeBegin:!0,excludeEnd:!0}]},s={className:"strong",contains:[],variants:[{begin:/_{2}(?!\s)/,end:/_{2}/},{begin:/\*{2}(?!\s)/,end:/\*{2}/}]},N={className:"emphasis",contains:[],variants:[{begin:/\*(?![*\s])/,end:/\*/},{begin:/_(?![_\s])/,end:/_/,relevance:0}]},m=I.inherit(s,{contains:[]}),h=I.inherit(N,{contains:[]});s.contains.push(h),N.contains.push(m);let V=[l,n];return[s,N,m,h].forEach(F=>{F.contains=F.contains.concat(V)}),V=V.concat(s,N),{name:"Markdown",aliases:["md","mkdown","mkd"],contains:[{className:"section",variants:[{begin:"^#{1,6}",end:"$",contains:V},{begin:"(?=^.+?\\n[=-]{2,}$)",contains:[{begin:"^[=-]*$"},{begin:"^",end:"\\n",contains:V}]}]},l,e,s,N,{className:"quote",begin:"^>\\s+",contains:V,end:"$"},d,b,n,t]}}function lv(I){let G={className:"built_in",begin:"\\b(AV|CA|CF|CG|CI|CL|CM|CN|CT|MK|MP|MTK|MTL|NS|SCN|SK|UI|WK|XC)\\w+"},l=/[a-zA-Z@][a-zA-Z0-9_]*/,W={"variable.language":["this","super"],$pattern:l,keyword:["while","export","sizeof","typedef","const","struct","for","union","volatile","static","mutable","if","do","return","goto","enum","else","break","extern","asm","case","default","register","explicit","typename","switch","continue","inline","readonly","assign","readwrite","self","@synchronized","id","typeof","nonatomic","IBOutlet","IBAction","strong","weak","copy","in","out","inout","bycopy","byref","oneway","__strong","__weak","__block","__autoreleasing","@private","@protected","@public","@try","@property","@end","@throw","@catch","@finally","@autoreleasepool","@synthesize","@dynamic","@selector","@optional","@required","@encode","@package","@import","@defs","@compatibility_alias","__bridge","__bridge_transfer","__bridge_retained","__bridge_retain","__covariant","__contravariant","__kindof","_Nonnull","_Nullable","_Null_unspecified","__FUNCTION__","__PRETTY_FUNCTION__","__attribute__","getter","setter","retain","unsafe_unretained","nonnull","nullable","null_unspecified","null_resettable","class","instancetype","NS_DESIGNATED_INITIALIZER","NS_UNAVAILABLE","NS_REQUIRES_SUPER","NS_RETURNS_INNER_POINTER","NS_INLINE","NS_AVAILABLE","NS_DEPRECATED","NS_ENUM","NS_OPTIONS","NS_SWIFT_UNAVAILABLE","NS_ASSUME_NONNULL_BEGIN","NS_ASSUME_NONNULL_END","NS_REFINED_FOR_SWIFT","NS_SWIFT_NAME","NS_SWIFT_NOTHROW","NS_DURING","NS_HANDLER","NS_ENDHANDLER","NS_VALUERETURN","NS_VOIDRETURN"],literal:["false","true","FALSE","TRUE","nil","YES","NO","NULL"],built_in:["dispatch_once_t","dispatch_queue_t","dispatch_sync","dispatch_async","dispatch_once"],type:["int","float","char","unsigned","signed","short","long","double","wchar_t","unichar","void","bool","BOOL","id|0","_Bool"]},n={$pattern:l,keyword:["@interface","@class","@protocol","@implementation"]};return{name:"Objective-C",aliases:["mm","objc","obj-c","obj-c++","objective-c++"],keywords:W,illegal:"</",contains:[G,I.C_LINE_COMMENT_MODE,I.C_BLOCK_COMMENT_MODE,I.C_NUMBER_MODE,I.QUOTE_STRING_MODE,I.APOS_STRING_MODE,{className:"string",variants:[{begin:'@"',end:'"',illegal:"\\n",contains:[I.BACKSLASH_ESCAPE]}]},{className:"meta",begin:/#\s*[a-z]+\b/,end:/$/,keywords:{keyword:"if else elif endif define undef warning error line pragma ifdef ifndef include"},contains:[{begin:/\\\n/,relevance:0},I.inherit(I.QUOTE_STRING_MODE,{className:"string"}),{className:"string",begin:/<.*?>/,end:/$/,illegal:"\\n"},I.C_LINE_COMMENT_MODE,I.C_BLOCK_COMMENT_MODE]},{className:"class",begin:"("+n.keyword.join("|")+")\\b",end:/(\{|$)/,excludeEnd:!0,keywords:n,contains:[I.UNDERSCORE_TITLE_MODE]},{begin:"\\."+I.UNDERSCORE_IDENT_RE,relevance:0}]}}function Gv(I){let G=I.regex,l=["abs","accept","alarm","and","atan2","bind","binmode","bless","break","caller","chdir","chmod","chomp","chop","chown","chr","chroot","close","closedir","connect","continue","cos","crypt","dbmclose","dbmopen","defined","delete","die","do","dump","each","else","elsif","endgrent","endhostent","endnetent","endprotoent","endpwent","endservent","eof","eval","exec","exists","exit","exp","fcntl","fileno","flock","for","foreach","fork","format","formline","getc","getgrent","getgrgid","getgrnam","gethostbyaddr","gethostbyname","gethostent","getlogin","getnetbyaddr","getnetbyname","getnetent","getpeername","getpgrp","getpriority","getprotobyname","getprotobynumber","getprotoent","getpwent","getpwnam","getpwuid","getservbyname","getservbyport","getservent","getsockname","getsockopt","given","glob","gmtime","goto","grep","gt","hex","if","index","int","ioctl","join","keys","kill","last","lc","lcfirst","length","link","listen","local","localtime","log","lstat","lt","ma","map","mkdir","msgctl","msgget","msgrcv","msgsnd","my","ne","next","no","not","oct","open","opendir","or","ord","our","pack","package","pipe","pop","pos","print","printf","prototype","push","q|0","qq","quotemeta","qw","qx","rand","read","readdir","readline","readlink","readpipe","recv","redo","ref","rename","require","reset","return","reverse","rewinddir","rindex","rmdir","say","scalar","seek","seekdir","select","semctl","semget","semop","send","setgrent","sethostent","setnetent","setpgrp","setpriority","setprotoent","setpwent","setservent","setsockopt","shift","shmctl","shmget","shmread","shmwrite","shutdown","sin","sleep","socket","socketpair","sort","splice","split","sprintf","sqrt","srand","stat","state","study","sub","substr","symlink","syscall","sysopen","sysread","sysseek","system","syswrite","tell","telldir","tie","tied","time","times","tr","truncate","uc","ucfirst","umask","undef","unless","unlink","unpack","unshift","untie","until","use","utime","values","vec","wait","waitpid","wantarray","warn","when","while","write","x|0","xor","y|0"],b=/[dualxmsipngr]{0,12}/,d={$pattern:/[\w.]+/,keyword:l.join(" ")},e={className:"subst",begin:"[$@]\\{",end:"\\}",keywords:d},t={begin:/->\{/,end:/\}/},W={variants:[{begin:/\$\d/},{begin:G.concat(/[$%@](\^\w\b|#\w+(::\w+)*|\{\w+\}|\w+(::\w*)*)/,"(?![A-Za-z])(?![@$%])")},{begin:/[$%@][^\s\w{]/,relevance:0}]},n=[I.BACKSLASH_ESCAPE,e,W],s=[/!/,/\//,/\|/,/\?/,/'/,/"/,/#/],N=(V,X,p="\\1")=>{let F=p==="\\1"?p:G.concat(p,X);return G.concat(G.concat("(?:",V,")"),X,/(?:\\.|[^\\\/])*?/,F,/(?:\\.|[^\\\/])*?/,p,b)},m=(V,X,p)=>G.concat(G.concat("(?:",V,")"),X,/(?:\\.|[^\\\/])*?/,p,b),h=[W,I.HASH_COMMENT_MODE,I.COMMENT(/^=\w/,/=cut/,{endsWithParent:!0}),t,{className:"string",contains:n,variants:[{begin:"q[qwxr]?\\s*\\(",end:"\\)",relevance:5},{begin:"q[qwxr]?\\s*\\[",end:"\\]",relevance:5},{begin:"q[qwxr]?\\s*\\{",end:"\\}",relevance:5},{begin:"q[qwxr]?\\s*\\|",end:"\\|",relevance:5},{begin:"q[qwxr]?\\s*<",end:">",relevance:5},{begin:"qw\\s+q",end:"q",relevance:5},{begin:"'",end:"'",contains:[I.BACKSLASH_ESCAPE]},{begin:'"',end:'"'},{begin:"`",end:"`",contains:[I.BACKSLASH_ESCAPE]},{begin:/\{\w+\}/,relevance:0},{begin:"-?\\w+\\s*=>",relevance:0}]},{className:"number",begin:"(\\b0[0-7_]+)|(\\b0x[0-9a-fA-F_]+)|(\\b[1-9][0-9_]*(\\.[0-9_]+)?)|[0_]\\b",relevance:0},{begin:"(\\/\\/|"+I.RE_STARTERS_RE+"|\\b(split|return|print|reverse|grep)\\b)\\s*",keywords:"split return print reverse grep",relevance:0,contains:[I.HASH_COMMENT_MODE,{className:"regexp",variants:[{begin:N("s|tr|y",G.either(...s,{capture:!0}))},{begin:N("s|tr|y","\\(","\\)")},{begin:N("s|tr|y","\\[","\\]")},{begin:N("s|tr|y","\\{","\\}")}],relevance:2},{className:"regexp",variants:[{begin:/(m|qr)\/\//,relevance:0},{begin:m("(?:m|qr)?",/\//,/\//)},{begin:m("m|qr",G.either(...s,{capture:!0}),/\1/)},{begin:m("m|qr",/\(/,/\)/)},{begin:m("m|qr",/\[/,/\]/)},{begin:m("m|qr",/\{/,/\}/)}]}]},{className:"function",beginKeywords:"sub",end:"(\\s*\\(.*?\\))?[;{]",excludeEnd:!0,relevance:5,contains:[I.TITLE_MODE]},{begin:"-\\w\\b",relevance:0},{begin:"^__DATA__$",end:"^__END__$",subLanguage:"mojolicious",contains:[{begin:"^@@.*",end:"$",className:"comment"}]}];return e.contains=h,t.contains=h,{name:"Perl",aliases:["pl","pm"],keywords:d,contains:h}}function cv(I){let G=I.regex,l=/(?![A-Za-z0-9])(?![$])/,b=G.concat(/[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*/,l),d=G.concat(/(\\?[A-Z][a-z0-9_\x7f-\xff]+|\\?[A-Z]+(?=[A-Z][a-z0-9_\x7f-\xff])){1,}/,l),e={scope:"variable",match:"\\$+"+b},t={scope:"meta",variants:[{begin:/<\?php/,relevance:10},{begin:/<\?=/},{begin:/<\?/,relevance:.1},{begin:/\?>/}]},W={scope:"subst",variants:[{begin:/\$\w+/},{begin:/\{\$/,end:/\}/}]},n=I.inherit(I.APOS_STRING_MODE,{illegal:null}),s=I.inherit(I.QUOTE_STRING_MODE,{illegal:null,contains:I.QUOTE_STRING_MODE.contains.concat(W)}),N={begin:/<<<[ \t]*(?:(\w+)|"(\w+)")\n/,end:/[ \t]*(\w+)\b/,contains:I.QUOTE_STRING_MODE.contains.concat(W),"on:begin":(WI,VI)=>{VI.data._beginMatch=WI[1]||WI[2]},"on:end":(WI,VI)=>{VI.data._beginMatch!==WI[1]&&VI.ignoreMatch()}},m=I.END_SAME_AS_BEGIN({begin:/<<<[ \t]*'(\w+)'\n/,end:/[ \t]*(\w+)\b/}),h=`[ 	
]`,V={scope:"string",variants:[s,n,N,m]},X={scope:"number",variants:[{begin:"\\b0[bB][01]+(?:_[01]+)*\\b"},{begin:"\\b0[oO][0-7]+(?:_[0-7]+)*\\b"},{begin:"\\b0[xX][\\da-fA-F]+(?:_[\\da-fA-F]+)*\\b"},{begin:"(?:\\b\\d+(?:_\\d+)*(\\.(?:\\d+(?:_\\d+)*))?|\\B\\.\\d+)(?:[eE][+-]?\\d+)?"}],relevance:0},p=["false","null","true"],F=["__CLASS__","__DIR__","__FILE__","__FUNCTION__","__COMPILER_HALT_OFFSET__","__LINE__","__METHOD__","__NAMESPACE__","__TRAIT__","die","echo","exit","include","include_once","print","require","require_once","array","abstract","and","as","binary","bool","boolean","break","callable","case","catch","class","clone","const","continue","declare","default","do","double","else","elseif","empty","enddeclare","endfor","endforeach","endif","endswitch","endwhile","enum","eval","extends","final","finally","float","for","foreach","from","global","goto","if","implements","instanceof","insteadof","int","integer","interface","isset","iterable","list","match|0","mixed","new","never","object","or","private","protected","public","readonly","real","return","string","switch","throw","trait","try","unset","use","var","void","while","xor","yield"],a=["Error|0","AppendIterator","ArgumentCountError","ArithmeticError","ArrayIterator","ArrayObject","AssertionError","BadFunctionCallException","BadMethodCallException","CachingIterator","CallbackFilterIterator","CompileError","Countable","DirectoryIterator","DivisionByZeroError","DomainException","EmptyIterator","ErrorException","Exception","FilesystemIterator","FilterIterator","GlobIterator","InfiniteIterator","InvalidArgumentException","IteratorIterator","LengthException","LimitIterator","LogicException","MultipleIterator","NoRewindIterator","OutOfBoundsException","OutOfRangeException","OuterIterator","OverflowException","ParentIterator","ParseError","RangeException","RecursiveArrayIterator","RecursiveCachingIterator","RecursiveCallbackFilterIterator","RecursiveDirectoryIterator","RecursiveFilterIterator","RecursiveIterator","RecursiveIteratorIterator","RecursiveRegexIterator","RecursiveTreeIterator","RegexIterator","RuntimeException","SeekableIterator","SplDoublyLinkedList","SplFileInfo","SplFileObject","SplFixedArray","SplHeap","SplMaxHeap","SplMinHeap","SplObjectStorage","SplObserver","SplPriorityQueue","SplQueue","SplStack","SplSubject","SplTempFileObject","TypeError","UnderflowException","UnexpectedValueException","UnhandledMatchError","ArrayAccess","BackedEnum","Closure","Fiber","Generator","Iterator","IteratorAggregate","Serializable","Stringable","Throwable","Traversable","UnitEnum","WeakReference","WeakMap","Directory","__PHP_Incomplete_Class","parent","php_user_filter","self","static","stdClass"],Q={keyword:F,literal:(WI=>{let VI=[];return WI.forEach(sI=>{VI.push(sI),sI.toLowerCase()===sI?VI.push(sI.toUpperCase()):VI.push(sI.toLowerCase())}),VI})(p),built_in:a},o=WI=>WI.map(VI=>VI.replace(/\|\d+$/,"")),y={variants:[{match:[/new/,G.concat(h,"+"),G.concat("(?!",o(a).join("\\b|"),"\\b)"),d],scope:{1:"keyword",4:"title.class"}}]},H=G.concat(b,"\\b(?!\\()"),E={variants:[{match:[G.concat(/::/,G.lookahead(/(?!class\b)/)),H],scope:{2:"variable.constant"}},{match:[/::/,/class/],scope:{2:"variable.language"}},{match:[d,G.concat(/::/,G.lookahead(/(?!class\b)/)),H],scope:{1:"title.class",3:"variable.constant"}},{match:[d,G.concat("::",G.lookahead(/(?!class\b)/))],scope:{1:"title.class"}},{match:[d,/::/,/class/],scope:{1:"title.class",3:"variable.language"}}]},C={scope:"attr",match:G.concat(b,G.lookahead(":"),G.lookahead(/(?!::)/))},T={relevance:0,begin:/\(/,end:/\)/,keywords:Q,contains:[C,e,E,I.C_BLOCK_COMMENT_MODE,V,X,y]},S={relevance:0,match:[/\b/,G.concat("(?!fn\\b|function\\b|",o(F).join("\\b|"),"|",o(a).join("\\b|"),"\\b)"),b,G.concat(h,"*"),G.lookahead(/(?=\()/)],scope:{3:"title.function.invoke"},contains:[T]};T.contains.push(S);let cI=[C,E,I.C_BLOCK_COMMENT_MODE,V,X,y],hI={begin:G.concat(/#\[\s*/,d),beginScope:"meta",end:/]/,endScope:"meta",keywords:{literal:p,keyword:["new","array"]},contains:[{begin:/\[/,end:/]/,keywords:{literal:p,keyword:["new","array"]},contains:["self",...cI]},...cI,{scope:"meta",match:d}]};return{case_insensitive:!1,keywords:Q,contains:[hI,I.HASH_COMMENT_MODE,I.COMMENT("//","$"),I.COMMENT("/\\*","\\*/",{contains:[{scope:"doctag",match:"@[A-Za-z]+"}]}),{match:/__halt_compiler\(\);/,keywords:"__halt_compiler",starts:{scope:"comment",end:I.MATCH_NOTHING_RE,contains:[{match:/\?>/,scope:"meta",endsParent:!0}]}},t,{scope:"variable.language",match:/\$this\b/},e,S,E,{match:[/const/,/\s/,b],scope:{1:"keyword",3:"variable.constant"}},y,{scope:"function",relevance:0,beginKeywords:"fn function",end:/[;{]/,excludeEnd:!0,illegal:"[$%\\[]",contains:[{beginKeywords:"use"},I.UNDERSCORE_TITLE_MODE,{begin:"=>",endsParent:!0},{scope:"params",begin:"\\(",end:"\\)",excludeBegin:!0,excludeEnd:!0,keywords:Q,contains:["self",e,E,I.C_BLOCK_COMMENT_MODE,V,X]}]},{scope:"class",variants:[{beginKeywords:"enum",illegal:/[($"]/},{beginKeywords:"class interface trait",illegal:/[:($"]/}],relevance:0,end:/\{/,excludeEnd:!0,contains:[{beginKeywords:"extends implements"},I.UNDERSCORE_TITLE_MODE]},{beginKeywords:"namespace",relevance:0,end:";",illegal:/[.']/,contains:[I.inherit(I.UNDERSCORE_TITLE_MODE,{scope:"title.class"})]},{beginKeywords:"use",relevance:0,end:";",contains:[{match:/\b(as|const|function)\b/,scope:"keyword"},I.UNDERSCORE_TITLE_MODE]},V,X]}}function bv(I){return{name:"PHP template",subLanguage:"xml",contains:[{begin:/<\?(php|=)?/,end:/\?>/,subLanguage:"php",contains:[{begin:"/\\*",end:"\\*/",skip:!0},{begin:'b"',end:'"',skip:!0},{begin:"b'",end:"'",skip:!0},I.inherit(I.APOS_STRING_MODE,{illegal:null,className:null,contains:null,skip:!0}),I.inherit(I.QUOTE_STRING_MODE,{illegal:null,className:null,contains:null,skip:!0})]}]}}function dv(I){return{name:"Plain text",aliases:["text","txt"],disableAutodetect:!0}}function Zv(I){let G=I.regex,l=/[\p{XID_Start}_]\p{XID_Continue}*/u,b=["and","as","assert","async","await","break","case","class","continue","def","del","elif","else","except","finally","for","from","global","if","import","in","is","lambda","match","nonlocal|10","not","or","pass","raise","return","try","while","with","yield"],W={$pattern:/[A-Za-z]\w+|__\w+__/,keyword:b,built_in:["__import__","abs","all","any","ascii","bin","bool","breakpoint","bytearray","bytes","callable","chr","classmethod","compile","complex","delattr","dict","dir","divmod","enumerate","eval","exec","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip"],literal:["__debug__","Ellipsis","False","None","NotImplemented","True"],type:["Any","Callable","Coroutine","Dict","List","Literal","Generic","Optional","Sequence","Set","Tuple","Type","Union"]},n={className:"meta",begin:/^(>>>|\.\.\.) /},s={className:"subst",begin:/\{/,end:/\}/,keywords:W,illegal:/#/},N={begin:/\{\{/,relevance:0},m={className:"string",contains:[I.BACKSLASH_ESCAPE],variants:[{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?'''/,end:/'''/,contains:[I.BACKSLASH_ESCAPE,n],relevance:10},{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?"""/,end:/"""/,contains:[I.BACKSLASH_ESCAPE,n],relevance:10},{begin:/([fF][rR]|[rR][fF]|[fF])'''/,end:/'''/,contains:[I.BACKSLASH_ESCAPE,n,N,s]},{begin:/([fF][rR]|[rR][fF]|[fF])"""/,end:/"""/,contains:[I.BACKSLASH_ESCAPE,n,N,s]},{begin:/([uU]|[rR])'/,end:/'/,relevance:10},{begin:/([uU]|[rR])"/,end:/"/,relevance:10},{begin:/([bB]|[bB][rR]|[rR][bB])'/,end:/'/},{begin:/([bB]|[bB][rR]|[rR][bB])"/,end:/"/},{begin:/([fF][rR]|[rR][fF]|[fF])'/,end:/'/,contains:[I.BACKSLASH_ESCAPE,N,s]},{begin:/([fF][rR]|[rR][fF]|[fF])"/,end:/"/,contains:[I.BACKSLASH_ESCAPE,N,s]},I.APOS_STRING_MODE,I.QUOTE_STRING_MODE]},h="[0-9](_?[0-9])*",V=`(\\b(${h}))?\\.(${h})|\\b(${h})\\.`,X=`\\b|${b.join("|")}`,p={className:"number",relevance:0,variants:[{begin:`(\\b(${h})|(${V}))[eE][+-]?(${h})[jJ]?(?=${X})`},{begin:`(${V})[jJ]?`},{begin:`\\b([1-9](_?[0-9])*|0+(_?0)*)[lLjJ]?(?=${X})`},{begin:`\\b0[bB](_?[01])+[lL]?(?=${X})`},{begin:`\\b0[oO](_?[0-7])+[lL]?(?=${X})`},{begin:`\\b0[xX](_?[0-9a-fA-F])+[lL]?(?=${X})`},{begin:`\\b(${h})[jJ](?=${X})`}]},F={className:"comment",begin:G.lookahead(/# type:/),end:/$/,keywords:W,contains:[{begin:/# type:/},{begin:/#/,end:/\b\B/,endsWithParent:!0}]},a={className:"params",variants:[{className:"",begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:W,contains:["self",n,p,m,I.HASH_COMMENT_MODE]}]};return s.contains=[m,p,n],{name:"Python",aliases:["py","gyp","ipython"],unicodeRegex:!0,keywords:W,illegal:/(<\/|\?)|=>/,contains:[n,p,{begin:/\bself\b/},{beginKeywords:"if",relevance:0},m,F,I.HASH_COMMENT_MODE,{match:[/\bdef/,/\s+/,l],scope:{1:"keyword",3:"title.function"},contains:[a]},{variants:[{match:[/\bclass/,/\s+/,l,/\s*/,/\(\s*/,l,/\s*\)/]},{match:[/\bclass/,/\s+/,l]}],scope:{1:"keyword",3:"title.class",6:"title.class.inherited"}},{className:"meta",begin:/^[\t ]*@/,end:/(?=#)|$/,contains:[p,a,m]}]}}function ev(I){return{aliases:["pycon"],contains:[{className:"meta.prompt",starts:{end:/ |$/,starts:{end:"$",subLanguage:"python"}},variants:[{begin:/^>>>(?=[ ]|$)/},{begin:/^\.\.\.(?=[ ]|$)/}]}]}}function av(I){let G=I.regex,l=/(?:(?:[a-zA-Z]|\.[._a-zA-Z])[._a-zA-Z0-9]*)|\.(?!\d)/,b=G.either(/0[xX][0-9a-fA-F]+\.[0-9a-fA-F]*[pP][+-]?\d+i?/,/0[xX][0-9a-fA-F]+(?:[pP][+-]?\d+)?[Li]?/,/(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?[Li]?/),d=/[=!<>:]=|\|\||&&|:::?|<-|<<-|->>|->|\|>|[-+*\/?!$&|:<=>@^~]|\*\*/,e=G.either(/[()]/,/[{}]/,/\[\[/,/[[\]]/,/\\/,/,/);return{name:"R",keywords:{$pattern:l,keyword:"function if in break next repeat else for while",literal:"NULL NA TRUE FALSE Inf NaN NA_integer_|10 NA_real_|10 NA_character_|10 NA_complex_|10",built_in:"LETTERS letters month.abb month.name pi T F abs acos acosh all any anyNA Arg as.call as.character as.complex as.double as.environment as.integer as.logical as.null.default as.numeric as.raw asin asinh atan atanh attr attributes baseenv browser c call ceiling class Conj cos cosh cospi cummax cummin cumprod cumsum digamma dim dimnames emptyenv exp expression floor forceAndCall gamma gc.time globalenv Im interactive invisible is.array is.atomic is.call is.character is.complex is.double is.environment is.expression is.finite is.function is.infinite is.integer is.language is.list is.logical is.matrix is.na is.name is.nan is.null is.numeric is.object is.pairlist is.raw is.recursive is.single is.symbol lazyLoadDBfetch length lgamma list log max min missing Mod names nargs nzchar oldClass on.exit pos.to.env proc.time prod quote range Re rep retracemem return round seq_along seq_len seq.int sign signif sin sinh sinpi sqrt standardGeneric substitute sum switch tan tanh tanpi tracemem trigamma trunc unclass untracemem UseMethod xtfrm"},contains:[I.COMMENT(/#'/,/$/,{contains:[{scope:"doctag",match:/@examples/,starts:{end:G.lookahead(G.either(/\n^#'\s*(?=@[a-zA-Z]+)/,/\n^(?!#')/)),endsParent:!0}},{scope:"doctag",begin:"@param",end:/$/,contains:[{scope:"variable",variants:[{match:l},{match:/`(?:\\.|[^`\\])+`/}],endsParent:!0}]},{scope:"doctag",match:/@[a-zA-Z]+/},{scope:"keyword",match:/\\[a-zA-Z]+/}]}),I.HASH_COMMENT_MODE,{scope:"string",contains:[I.BACKSLASH_ESCAPE],variants:[I.END_SAME_AS_BEGIN({begin:/[rR]"(-*)\(/,end:/\)(-*)"/}),I.END_SAME_AS_BEGIN({begin:/[rR]"(-*)\{/,end:/\}(-*)"/}),I.END_SAME_AS_BEGIN({begin:/[rR]"(-*)\[/,end:/\](-*)"/}),I.END_SAME_AS_BEGIN({begin:/[rR]'(-*)\(/,end:/\)(-*)'/}),I.END_SAME_AS_BEGIN({begin:/[rR]'(-*)\{/,end:/\}(-*)'/}),I.END_SAME_AS_BEGIN({begin:/[rR]'(-*)\[/,end:/\](-*)'/}),{begin:'"',end:'"',relevance:0},{begin:"'",end:"'",relevance:0}]},{relevance:0,variants:[{scope:{1:"operator",2:"number"},match:[d,b]},{scope:{1:"operator",2:"number"},match:[/%[^%]*%/,b]},{scope:{1:"punctuation",2:"number"},match:[e,b]},{scope:{2:"number"},match:[/[^a-zA-Z0-9._]|^/,b]}]},{scope:{3:"operator"},match:[l,/\s+/,/<-/,/\s+/]},{scope:"operator",relevance:0,variants:[{match:d},{match:/%[^%]*%/}]},{scope:"punctuation",relevance:0,match:e},{begin:"`",end:"`",contains:[{begin:/\\./}]}]}}function Wv(I){let G=I.regex,l="([a-zA-Z_]\\w*[!?=]?|[-+~]@|<<|>>|=~|===?|<=>|[<>]=?|\\*\\*|[-/+%^&*~`|]|\\[\\]=?)",b=G.either(/\b([A-Z]+[a-z0-9]+)+/,/\b([A-Z]+[a-z0-9]+)+[A-Z]+/),d=G.concat(b,/(::\w+)*/),t={"variable.constant":["__FILE__","__LINE__","__ENCODING__"],"variable.language":["self","super"],keyword:["alias","and","begin","BEGIN","break","case","class","defined","do","else","elsif","end","END","ensure","for","if","in","module","next","not","or","redo","require","rescue","retry","return","then","undef","unless","until","when","while","yield",...["include","extend","prepend","public","private","protected","raise","throw"]],built_in:["proc","lambda","attr_accessor","attr_reader","attr_writer","define_method","private_constant","module_function"],literal:["true","false","nil"]},W={className:"doctag",begin:"@[A-Za-z]+"},n={begin:"#<",end:">"},s=[I.COMMENT("#","$",{contains:[W]}),I.COMMENT("^=begin","^=end",{contains:[W],relevance:10}),I.COMMENT("^__END__",I.MATCH_NOTHING_RE)],N={className:"subst",begin:/#\{/,end:/\}/,keywords:t},m={className:"string",contains:[I.BACKSLASH_ESCAPE,N],variants:[{begin:/'/,end:/'/},{begin:/"/,end:/"/},{begin:/`/,end:/`/},{begin:/%[qQwWx]?\(/,end:/\)/},{begin:/%[qQwWx]?\[/,end:/\]/},{begin:/%[qQwWx]?\{/,end:/\}/},{begin:/%[qQwWx]?</,end:/>/},{begin:/%[qQwWx]?\//,end:/\//},{begin:/%[qQwWx]?%/,end:/%/},{begin:/%[qQwWx]?-/,end:/-/},{begin:/%[qQwWx]?\|/,end:/\|/},{begin:/\B\?(\\\d{1,3})/},{begin:/\B\?(\\x[A-Fa-f0-9]{1,2})/},{begin:/\B\?(\\u\{?[A-Fa-f0-9]{1,6}\}?)/},{begin:/\B\?(\\M-\\C-|\\M-\\c|\\c\\M-|\\M-|\\C-\\M-)[\x20-\x7e]/},{begin:/\B\?\\(c|C-)[\x20-\x7e]/},{begin:/\B\?\\?\S/},{begin:G.concat(/<<[-~]?'?/,G.lookahead(/(\w+)(?=\W)[^\n]*\n(?:[^\n]*\n)*?\s*\1\b/)),contains:[I.END_SAME_AS_BEGIN({begin:/(\w+)/,end:/(\w+)/,contains:[I.BACKSLASH_ESCAPE,N]})]}]},h="[1-9](_?[0-9])*|0",V="[0-9](_?[0-9])*",X={className:"number",relevance:0,variants:[{begin:`\\b(${h})(\\.(${V}))?([eE][+-]?(${V})|r)?i?\\b`},{begin:"\\b0[dD][0-9](_?[0-9])*r?i?\\b"},{begin:"\\b0[bB][0-1](_?[0-1])*r?i?\\b"},{begin:"\\b0[oO][0-7](_?[0-7])*r?i?\\b"},{begin:"\\b0[xX][0-9a-fA-F](_?[0-9a-fA-F])*r?i?\\b"},{begin:"\\b0(_?[0-7])+r?i?\\b"}]},p={variants:[{match:/\(\)/},{className:"params",begin:/\(/,end:/(?=\))/,excludeBegin:!0,endsParent:!0,keywords:t}]},H=[m,{variants:[{match:[/class\s+/,d,/\s+<\s+/,d]},{match:[/\b(class|module)\s+/,d]}],scope:{2:"title.class",4:"title.class.inherited"},keywords:t},{match:[/(include|extend)\s+/,d],scope:{2:"title.class"},keywords:t},{relevance:0,match:[d,/\.new[. (]/],scope:{1:"title.class"}},{relevance:0,match:/\b[A-Z][A-Z_0-9]+\b/,className:"variable.constant"},{relevance:0,match:b,scope:"title.class"},{match:[/def/,/\s+/,l],scope:{1:"keyword",3:"title.function"},contains:[p]},{begin:I.IDENT_RE+"::"},{className:"symbol",begin:I.UNDERSCORE_IDENT_RE+"(!|\\?)?:",relevance:0},{className:"symbol",begin:":(?!\\s)",contains:[m,{begin:l}],relevance:0},X,{className:"variable",begin:"(\\$\\W)|((\\$|@@?)(\\w+))(?=[^@$?])(?![A-Za-z])(?![@$?'])"},{className:"params",begin:/\|/,end:/\|/,excludeBegin:!0,excludeEnd:!0,relevance:0,keywords:t},{begin:"("+I.RE_STARTERS_RE+"|unless)\\s*",keywords:"unless",contains:[{className:"regexp",contains:[I.BACKSLASH_ESCAPE,N],illegal:/\n/,variants:[{begin:"/",end:"/[a-z]*"},{begin:/%r\{/,end:/\}[a-z]*/},{begin:"%r\\(",end:"\\)[a-z]*"},{begin:"%r!",end:"![a-z]*"},{begin:"%r\\[",end:"\\][a-z]*"}]}].concat(n,s),relevance:0}].concat(n,s);N.contains=H,p.contains=H;let S=[{begin:/^\s*=>/,starts:{end:"$",contains:H}},{className:"meta.prompt",begin:"^("+"[>?]>"+"|"+"[\\w#]+\\(\\w+\\):\\d+:\\d+[>*]"+"|"+"(\\w+-)?\\d+\\.\\d+\\.\\d+(p\\d+)?[^\\d][^>]+>"+")(?=[ ])",starts:{end:"$",keywords:t,contains:H}}];return s.unshift(n),{name:"Ruby",aliases:["rb","gemspec","podspec","thor","irb"],keywords:t,illegal:/\/\*/,contains:[I.SHEBANG({binary:"ruby"})].concat(S).concat(s).concat(H)}}function tv(I){let G=I.regex,l={className:"title.function.invoke",relevance:0,begin:G.concat(/\b/,/(?!let\b)/,I.IDENT_RE,G.lookahead(/\s*\(/))},b="([ui](8|16|32|64|128|size)|f(32|64))?",d=["abstract","as","async","await","become","box","break","const","continue","crate","do","dyn","else","enum","extern","false","final","fn","for","if","impl","in","let","loop","macro","match","mod","move","mut","override","priv","pub","ref","return","self","Self","static","struct","super","trait","true","try","type","typeof","unsafe","unsized","use","virtual","where","while","yield"],e=["true","false","Some","None","Ok","Err"],t=["drop ","Copy","Send","Sized","Sync","Drop","Fn","FnMut","FnOnce","ToOwned","Clone","Debug","PartialEq","PartialOrd","Eq","Ord","AsRef","AsMut","Into","From","Default","Iterator","Extend","IntoIterator","DoubleEndedIterator","ExactSizeIterator","SliceConcatExt","ToString","assert!","assert_eq!","bitflags!","bytes!","cfg!","col!","concat!","concat_idents!","debug_assert!","debug_assert_eq!","env!","panic!","file!","format!","format_args!","include_bytes!","include_str!","line!","local_data_key!","module_path!","option_env!","print!","println!","select!","stringify!","try!","unimplemented!","unreachable!","vec!","write!","writeln!","macro_rules!","assert_ne!","debug_assert_ne!"],W=["i8","i16","i32","i64","i128","isize","u8","u16","u32","u64","u128","usize","f32","f64","str","char","bool","Box","Option","Result","String","Vec"];return{name:"Rust",aliases:["rs"],keywords:{$pattern:I.IDENT_RE+"!?",type:W,keyword:d,literal:e,built_in:t},illegal:"</",contains:[I.C_LINE_COMMENT_MODE,I.COMMENT("/\\*","\\*/",{contains:["self"]}),I.inherit(I.QUOTE_STRING_MODE,{begin:/b?"/,illegal:null}),{className:"string",variants:[{begin:/b?r(#*)"(.|\n)*?"\1(?!#)/},{begin:/b?'\\?(x\w{2}|u\w{4}|U\w{8}|.)'/}]},{className:"symbol",begin:/'[a-zA-Z_][a-zA-Z0-9_]*/},{className:"number",variants:[{begin:"\\b0b([01_]+)"+b},{begin:"\\b0o([0-7_]+)"+b},{begin:"\\b0x([A-Fa-f0-9_]+)"+b},{begin:"\\b(\\d[\\d_]*(\\.[0-9_]+)?([eE][+-]?[0-9_]+)?)"+b}],relevance:0},{begin:[/fn/,/\s+/,I.UNDERSCORE_IDENT_RE],className:{1:"keyword",3:"title.function"}},{className:"meta",begin:"#!?\\[",end:"\\]",contains:[{className:"string",begin:/"/,end:/"/}]},{begin:[/let/,/\s+/,/(?:mut\s+)?/,I.UNDERSCORE_IDENT_RE],className:{1:"keyword",3:"keyword",4:"variable"}},{begin:[/for/,/\s+/,I.UNDERSCORE_IDENT_RE,/\s+/,/in/],className:{1:"keyword",3:"variable",5:"keyword"}},{begin:[/type/,/\s+/,I.UNDERSCORE_IDENT_RE],className:{1:"keyword",3:"title.class"}},{begin:[/(?:trait|enum|struct|union|impl|for)/,/\s+/,I.UNDERSCORE_IDENT_RE],className:{1:"keyword",3:"title.class"}},{begin:I.IDENT_RE+"::",keywords:{keyword:"Self",built_in:t,type:W}},{className:"punctuation",begin:"->"},l]}}var I4=I=>({IMPORTANT:{scope:"meta",begin:"!important"},BLOCK_COMMENT:I.C_BLOCK_COMMENT_MODE,HEXCOLOR:{scope:"number",begin:/#(([0-9a-fA-F]{3,4})|(([0-9a-fA-F]{2}){3,4}))\b/},FUNCTION_DISPATCH:{className:"built_in",begin:/[\w-]+(?=\()/},ATTRIBUTE_SELECTOR_MODE:{scope:"selector-attr",begin:/\[/,end:/\]/,illegal:"$",contains:[I.APOS_STRING_MODE,I.QUOTE_STRING_MODE]},CSS_NUMBER_MODE:{scope:"number",begin:I.NUMBER_RE+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",relevance:0},CSS_VARIABLE:{className:"attr",begin:/--[A-Za-z][A-Za-z0-9_-]*/}}),l4=["a","abbr","address","article","aside","audio","b","blockquote","body","button","canvas","caption","cite","code","dd","del","details","dfn","div","dl","dt","em","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","html","i","iframe","img","input","ins","kbd","label","legend","li","main","mark","menu","nav","object","ol","p","q","quote","samp","section","span","strong","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","ul","var","video"],G4=["any-hover","any-pointer","aspect-ratio","color","color-gamut","color-index","device-aspect-ratio","device-height","device-width","display-mode","forced-colors","grid","height","hover","inverted-colors","monochrome","orientation","overflow-block","overflow-inline","pointer","prefers-color-scheme","prefers-contrast","prefers-reduced-motion","prefers-reduced-transparency","resolution","scan","scripting","update","width","min-width","max-width","min-height","max-height"],c4=["active","any-link","blank","checked","current","default","defined","dir","disabled","drop","empty","enabled","first","first-child","first-of-type","fullscreen","future","focus","focus-visible","focus-within","has","host","host-context","hover","indeterminate","in-range","invalid","is","lang","last-child","last-of-type","left","link","local-link","not","nth-child","nth-col","nth-last-child","nth-last-col","nth-last-of-type","nth-of-type","only-child","only-of-type","optional","out-of-range","past","placeholder-shown","read-only","read-write","required","right","root","scope","target","target-within","user-invalid","valid","visited","where"],b4=["after","backdrop","before","cue","cue-region","first-letter","first-line","grammar-error","marker","part","placeholder","selection","slotted","spelling-error"],d4=["align-content","align-items","align-self","all","animation","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","backface-visibility","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","block-size","border","border-block","border-block-color","border-block-end","border-block-end-color","border-block-end-style","border-block-end-width","border-block-start","border-block-start-color","border-block-start-style","border-block-start-width","border-block-style","border-block-width","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-inline","border-inline-color","border-inline-end","border-inline-end-color","border-inline-end-style","border-inline-end-width","border-inline-start","border-inline-start-color","border-inline-start-style","border-inline-start-width","border-inline-style","border-inline-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","caret-color","clear","clip","clip-path","clip-rule","color","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","contain","content","content-visibility","counter-increment","counter-reset","cue","cue-after","cue-before","cursor","direction","display","empty-cells","filter","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","flow","font","font-display","font-family","font-feature-settings","font-kerning","font-language-override","font-size","font-size-adjust","font-smoothing","font-stretch","font-style","font-synthesis","font-variant","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-variation-settings","font-weight","gap","glyph-orientation-vertical","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column","grid-column-end","grid-column-start","grid-gap","grid-row","grid-row-end","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphens","icon","image-orientation","image-rendering","image-resolution","ime-mode","inline-size","isolation","justify-content","left","letter-spacing","line-break","line-height","list-style","list-style-image","list-style-position","list-style-type","margin","margin-block","margin-block-end","margin-block-start","margin-bottom","margin-inline","margin-inline-end","margin-inline-start","margin-left","margin-right","margin-top","marks","mask","mask-border","mask-border-mode","mask-border-outset","mask-border-repeat","mask-border-slice","mask-border-source","mask-border-width","mask-clip","mask-composite","mask-image","mask-mode","mask-origin","mask-position","mask-repeat","mask-size","mask-type","max-block-size","max-height","max-inline-size","max-width","min-block-size","min-height","min-inline-size","min-width","mix-blend-mode","nav-down","nav-index","nav-left","nav-right","nav-up","none","normal","object-fit","object-position","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-wrap","overflow-x","overflow-y","padding","padding-block","padding-block-end","padding-block-start","padding-bottom","padding-inline","padding-inline-end","padding-inline-start","padding-left","padding-right","padding-top","page-break-after","page-break-before","page-break-inside","pause","pause-after","pause-before","perspective","perspective-origin","pointer-events","position","quotes","resize","rest","rest-after","rest-before","right","row-gap","scroll-margin","scroll-margin-block","scroll-margin-block-end","scroll-margin-block-start","scroll-margin-bottom","scroll-margin-inline","scroll-margin-inline-end","scroll-margin-inline-start","scroll-margin-left","scroll-margin-right","scroll-margin-top","scroll-padding","scroll-padding-block","scroll-padding-block-end","scroll-padding-block-start","scroll-padding-bottom","scroll-padding-inline","scroll-padding-inline-end","scroll-padding-inline-start","scroll-padding-left","scroll-padding-right","scroll-padding-top","scroll-snap-align","scroll-snap-stop","scroll-snap-type","scrollbar-color","scrollbar-gutter","scrollbar-width","shape-image-threshold","shape-margin","shape-outside","speak","speak-as","src","tab-size","table-layout","text-align","text-align-all","text-align-last","text-combine-upright","text-decoration","text-decoration-color","text-decoration-line","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-indent","text-justify","text-orientation","text-overflow","text-rendering","text-shadow","text-transform","text-underline-position","top","transform","transform-box","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","white-space","widows","width","will-change","word-break","word-spacing","word-wrap","writing-mode","z-index"].reverse();function nv(I){let G=I4(I),l=b4,b=c4,d="@[a-z-]+",e="and or not only",W={className:"variable",begin:"(\\$"+"[a-zA-Z-][a-zA-Z0-9_-]*"+")\\b",relevance:0};return{name:"SCSS",case_insensitive:!0,illegal:"[=/|']",contains:[I.C_LINE_COMMENT_MODE,I.C_BLOCK_COMMENT_MODE,G.CSS_NUMBER_MODE,{className:"selector-id",begin:"#[A-Za-z0-9_-]+",relevance:0},{className:"selector-class",begin:"\\.[A-Za-z0-9_-]+",relevance:0},G.ATTRIBUTE_SELECTOR_MODE,{className:"selector-tag",begin:"\\b("+l4.join("|")+")\\b",relevance:0},{className:"selector-pseudo",begin:":("+b.join("|")+")"},{className:"selector-pseudo",begin:":(:)?("+l.join("|")+")"},W,{begin:/\(/,end:/\)/,contains:[G.CSS_NUMBER_MODE]},G.CSS_VARIABLE,{className:"attribute",begin:"\\b("+d4.join("|")+")\\b"},{begin:"\\b(whitespace|wait|w-resize|visible|vertical-text|vertical-ideographic|uppercase|upper-roman|upper-alpha|underline|transparent|top|thin|thick|text|text-top|text-bottom|tb-rl|table-header-group|table-footer-group|sw-resize|super|strict|static|square|solid|small-caps|separate|se-resize|scroll|s-resize|rtl|row-resize|ridge|right|repeat|repeat-y|repeat-x|relative|progress|pointer|overline|outside|outset|oblique|nowrap|not-allowed|normal|none|nw-resize|no-repeat|no-drop|newspaper|ne-resize|n-resize|move|middle|medium|ltr|lr-tb|lowercase|lower-roman|lower-alpha|loose|list-item|line|line-through|line-edge|lighter|left|keep-all|justify|italic|inter-word|inter-ideograph|inside|inset|inline|inline-block|inherit|inactive|ideograph-space|ideograph-parenthesis|ideograph-numeric|ideograph-alpha|horizontal|hidden|help|hand|groove|fixed|ellipsis|e-resize|double|dotted|distribute|distribute-space|distribute-letter|distribute-all-lines|disc|disabled|default|decimal|dashed|crosshair|collapse|col-resize|circle|char|center|capitalize|break-word|break-all|bottom|both|bolder|bold|block|bidi-override|below|baseline|auto|always|all-scroll|absolute|table|table-cell)\\b"},{begin:/:/,end:/[;}{]/,relevance:0,contains:[G.BLOCK_COMMENT,W,G.HEXCOLOR,G.CSS_NUMBER_MODE,I.QUOTE_STRING_MODE,I.APOS_STRING_MODE,G.IMPORTANT,G.FUNCTION_DISPATCH]},{begin:"@(page|font-face)",keywords:{$pattern:d,keyword:"@page @font-face"}},{begin:"@",end:"[{;]",returnBegin:!0,keywords:{$pattern:/[a-z-]+/,keyword:e,attribute:G4.join(" ")},contains:[{begin:d,className:"keyword"},{begin:/[a-z-]+(?=:)/,className:"attribute"},W,I.QUOTE_STRING_MODE,I.APOS_STRING_MODE,G.HEXCOLOR,G.CSS_NUMBER_MODE]},G.FUNCTION_DISPATCH]}}function mv(I){return{name:"Shell Session",aliases:["console","shellsession"],contains:[{className:"meta.prompt",begin:/^\s{0,3}[/~\w\d[\]()@-]*[>%$#][ ]?/,starts:{end:/[^\\](?=\s*$)/,subLanguage:"bash"}}]}}function Nv(I){let G=I.regex,l=I.COMMENT("--","$"),b={className:"string",variants:[{begin:/'/,end:/'/,contains:[{begin:/''/}]}]},d={begin:/"/,end:/"/,contains:[{begin:/""/}]},e=["true","false","unknown"],t=["double precision","large object","with timezone","without timezone"],W=["bigint","binary","blob","boolean","char","character","clob","date","dec","decfloat","decimal","float","int","integer","interval","nchar","nclob","national","numeric","real","row","smallint","time","timestamp","varchar","varying","varbinary"],n=["add","asc","collation","desc","final","first","last","view"],s=["abs","acos","all","allocate","alter","and","any","are","array","array_agg","array_max_cardinality","as","asensitive","asin","asymmetric","at","atan","atomic","authorization","avg","begin","begin_frame","begin_partition","between","bigint","binary","blob","boolean","both","by","call","called","cardinality","cascaded","case","cast","ceil","ceiling","char","char_length","character","character_length","check","classifier","clob","close","coalesce","collate","collect","column","commit","condition","connect","constraint","contains","convert","copy","corr","corresponding","cos","cosh","count","covar_pop","covar_samp","create","cross","cube","cume_dist","current","current_catalog","current_date","current_default_transform_group","current_path","current_role","current_row","current_schema","current_time","current_timestamp","current_path","current_role","current_transform_group_for_type","current_user","cursor","cycle","date","day","deallocate","dec","decimal","decfloat","declare","default","define","delete","dense_rank","deref","describe","deterministic","disconnect","distinct","double","drop","dynamic","each","element","else","empty","end","end_frame","end_partition","end-exec","equals","escape","every","except","exec","execute","exists","exp","external","extract","false","fetch","filter","first_value","float","floor","for","foreign","frame_row","free","from","full","function","fusion","get","global","grant","group","grouping","groups","having","hold","hour","identity","in","indicator","initial","inner","inout","insensitive","insert","int","integer","intersect","intersection","interval","into","is","join","json_array","json_arrayagg","json_exists","json_object","json_objectagg","json_query","json_table","json_table_primitive","json_value","lag","language","large","last_value","lateral","lead","leading","left","like","like_regex","listagg","ln","local","localtime","localtimestamp","log","log10","lower","match","match_number","match_recognize","matches","max","member","merge","method","min","minute","mod","modifies","module","month","multiset","national","natural","nchar","nclob","new","no","none","normalize","not","nth_value","ntile","null","nullif","numeric","octet_length","occurrences_regex","of","offset","old","omit","on","one","only","open","or","order","out","outer","over","overlaps","overlay","parameter","partition","pattern","per","percent","percent_rank","percentile_cont","percentile_disc","period","portion","position","position_regex","power","precedes","precision","prepare","primary","procedure","ptf","range","rank","reads","real","recursive","ref","references","referencing","regr_avgx","regr_avgy","regr_count","regr_intercept","regr_r2","regr_slope","regr_sxx","regr_sxy","regr_syy","release","result","return","returns","revoke","right","rollback","rollup","row","row_number","rows","running","savepoint","scope","scroll","search","second","seek","select","sensitive","session_user","set","show","similar","sin","sinh","skip","smallint","some","specific","specifictype","sql","sqlexception","sqlstate","sqlwarning","sqrt","start","static","stddev_pop","stddev_samp","submultiset","subset","substring","substring_regex","succeeds","sum","symmetric","system","system_time","system_user","table","tablesample","tan","tanh","then","time","timestamp","timezone_hour","timezone_minute","to","trailing","translate","translate_regex","translation","treat","trigger","trim","trim_array","true","truncate","uescape","union","unique","unknown","unnest","update","upper","user","using","value","values","value_of","var_pop","var_samp","varbinary","varchar","varying","versioning","when","whenever","where","width_bucket","window","with","within","without","year"],N=["abs","acos","array_agg","asin","atan","avg","cast","ceil","ceiling","coalesce","corr","cos","cosh","count","covar_pop","covar_samp","cume_dist","dense_rank","deref","element","exp","extract","first_value","floor","json_array","json_arrayagg","json_exists","json_object","json_objectagg","json_query","json_table","json_table_primitive","json_value","lag","last_value","lead","listagg","ln","log","log10","lower","max","min","mod","nth_value","ntile","nullif","percent_rank","percentile_cont","percentile_disc","position","position_regex","power","rank","regr_avgx","regr_avgy","regr_count","regr_intercept","regr_r2","regr_slope","regr_sxx","regr_sxy","regr_syy","row_number","sin","sinh","sqrt","stddev_pop","stddev_samp","substring","substring_regex","sum","tan","tanh","translate","translate_regex","treat","trim","trim_array","unnest","upper","value_of","var_pop","var_samp","width_bucket"],m=["current_catalog","current_date","current_default_transform_group","current_path","current_role","current_schema","current_transform_group_for_type","current_user","session_user","system_time","system_user","current_time","localtime","current_timestamp","localtimestamp"],h=["create table","insert into","primary key","foreign key","not null","alter table","add constraint","grouping sets","on overflow","character set","respect nulls","ignore nulls","nulls first","nulls last","depth first","breadth first"],V=N,X=[...s,...n].filter(Q=>!N.includes(Q)),p={className:"variable",begin:/@[a-z0-9][a-z0-9_]*/},F={className:"operator",begin:/[-+*/=%^~]|&&?|\|\|?|!=?|<(?:=>?|<|>)?|>[>=]?/,relevance:0},a={begin:G.concat(/\b/,G.either(...V),/\s*\(/),relevance:0,keywords:{built_in:V}};function u(Q,{exceptions:o,when:y}={}){let H=y;return o=o||[],Q.map(E=>E.match(/\|\d+$/)||o.includes(E)?E:H(E)?`${E}|0`:E)}return{name:"SQL",case_insensitive:!0,illegal:/[{}]|<\//,keywords:{$pattern:/\b[\w\.]+/,keyword:u(X,{when:Q=>Q.length<3}),literal:e,type:W,built_in:m},contains:[{begin:G.either(...h),relevance:0,keywords:{$pattern:/[\w\.]+/,keyword:X.concat(h),literal:e,type:W}},{className:"type",begin:G.either(...t)},a,p,b,d,I.C_NUMBER_MODE,I.C_BLOCK_COMMENT_MODE,l,F]}}function Vv(I){return I?typeof I=="string"?I:I.source:null}function gu(I){return Yc("(?=",I,")")}function Yc(...I){return I.map(l=>Vv(l)).join("")}function Z4(I){let G=I[I.length-1];return typeof G=="object"&&G.constructor===Object?(I.splice(I.length-1,1),G):{}}function Kb(...I){return"("+(Z4(I).capture?"":"?:")+I.map(b=>Vv(b)).join("|")+")"}var cF=I=>Yc(/\b/,I,/\w$/.test(I)?/\b/:/\B/),e4=["Protocol","Type"].map(cF),sv=["init","self"].map(cF),a4=["Any","Self"],IF=["actor","any","associatedtype","async","await",/as\?/,/as!/,"as","break","case","catch","class","continue","convenience","default","defer","deinit","didSet","distributed","do","dynamic","else","enum","extension","fallthrough",/fileprivate\(set\)/,"fileprivate","final","for","func","get","guard","if","import","indirect","infix",/init\?/,/init!/,"inout",/internal\(set\)/,"internal","in","is","isolated","nonisolated","lazy","let","mutating","nonmutating",/open\(set\)/,"open","operator","optional","override","postfix","precedencegroup","prefix",/private\(set\)/,"private","protocol",/public\(set\)/,"public","repeat","required","rethrows","return","set","some","static","struct","subscript","super","switch","throws","throw",/try\?/,/try!/,"try","typealias",/unowned\(safe\)/,/unowned\(unsafe\)/,"unowned","var","weak","where","while","willSet"],Yv=["false","nil","true"],W4=["assignment","associativity","higherThan","left","lowerThan","none","right"],t4=["#colorLiteral","#column","#dsohandle","#else","#elseif","#endif","#error","#file","#fileID","#fileLiteral","#filePath","#function","#if","#imageLiteral","#keyPath","#line","#selector","#sourceLocation","#warn_unqualified_access","#warning"],hv=["abs","all","any","assert","assertionFailure","debugPrint","dump","fatalError","getVaList","isKnownUniquelyReferenced","max","min","numericCast","pointwiseMax","pointwiseMin","precondition","preconditionFailure","print","readLine","repeatElement","sequence","stride","swap","swift_unboxFromSwiftValueWithType","transcode","type","unsafeBitCast","unsafeDowncast","withExtendedLifetime","withUnsafeMutablePointer","withUnsafePointer","withVaList","withoutActuallyEscaping","zip"],pv=Kb(/[/=\-+!*%<>&|^~?]/,/[\u00A1-\u00A7]/,/[\u00A9\u00AB]/,/[\u00AC\u00AE]/,/[\u00B0\u00B1]/,/[\u00B6\u00BB\u00BF\u00D7\u00F7]/,/[\u2016-\u2017]/,/[\u2020-\u2027]/,/[\u2030-\u203E]/,/[\u2041-\u2053]/,/[\u2055-\u205E]/,/[\u2190-\u23FF]/,/[\u2500-\u2775]/,/[\u2794-\u2BFF]/,/[\u2E00-\u2E7F]/,/[\u3001-\u3003]/,/[\u3008-\u3020]/,/[\u3030]/),uv=Kb(pv,/[\u0300-\u036F]/,/[\u1DC0-\u1DFF]/,/[\u20D0-\u20FF]/,/[\uFE00-\uFE0F]/,/[\uFE20-\uFE2F]/),lF=Yc(pv,uv,"*"),Rv=Kb(/[a-zA-Z_]/,/[\u00A8\u00AA\u00AD\u00AF\u00B2-\u00B5\u00B7-\u00BA]/,/[\u00BC-\u00BE\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u00FF]/,/[\u0100-\u02FF\u0370-\u167F\u1681-\u180D\u180F-\u1DBF]/,/[\u1E00-\u1FFF]/,/[\u200B-\u200D\u202A-\u202E\u203F-\u2040\u2054\u2060-\u206F]/,/[\u2070-\u20CF\u2100-\u218F\u2460-\u24FF\u2776-\u2793]/,/[\u2C00-\u2DFF\u2E80-\u2FFF]/,/[\u3004-\u3007\u3021-\u302F\u3031-\u303F\u3040-\uD7FF]/,/[\uF900-\uFD3D\uFD40-\uFDCF\uFDF0-\uFE1F\uFE30-\uFE44]/,/[\uFE47-\uFEFE\uFF00-\uFFFD]/),Ju=Kb(Rv,/\d/,/[\u0300-\u036F\u1DC0-\u1DFF\u20D0-\u20FF\uFE20-\uFE2F]/),KZ=Yc(Rv,Ju,"*"),GF=Yc(/[A-Z]/,Ju,"*"),n4=["autoclosure",Yc(/convention\(/,Kb("swift","block","c"),/\)/),"discardableResult","dynamicCallable","dynamicMemberLookup","escaping","frozen","GKInspectable","IBAction","IBDesignable","IBInspectable","IBOutlet","IBSegueAction","inlinable","main","nonobjc","NSApplicationMain","NSCopying","NSManaged",Yc(/objc\(/,KZ,/\)/),"objc","objcMembers","propertyWrapper","requires_stored_property_inits","resultBuilder","testable","UIApplicationMain","unknown","usableFromInline"],m4=["iOS","iOSApplicationExtension","macOS","macOSApplicationExtension","macCatalyst","macCatalystApplicationExtension","watchOS","watchOSApplicationExtension","tvOS","tvOSApplicationExtension","swift"];function ov(I){let G={match:/\s+/,relevance:0},l=I.COMMENT("/\\*","\\*/",{contains:["self"]}),b=[I.C_LINE_COMMENT_MODE,l],d={match:[/\./,Kb(...e4,...sv)],className:{2:"keyword"}},e={match:Yc(/\./,Kb(...IF)),relevance:0},t=IF.filter(FI=>typeof FI=="string").concat(["_|0"]),W=IF.filter(FI=>typeof FI!="string").concat(a4).map(cF),n={variants:[{className:"keyword",match:Kb(...W,...sv)}]},s={$pattern:Kb(/\b\w+/,/#\w+/),keyword:t.concat(t4),literal:Yv},N=[d,e,n],m={match:Yc(/\./,Kb(...hv)),relevance:0},h={className:"built_in",match:Yc(/\b/,Kb(...hv),/(?=\()/)},V=[m,h],X={match:/->/,relevance:0},p={className:"operator",relevance:0,variants:[{match:lF},{match:`\\.(\\.|${uv})+`}]},F=[X,p],a="([0-9]_*)+",u="([0-9a-fA-F]_*)+",Q={className:"number",relevance:0,variants:[{match:`\\b(${a})(\\.(${a}))?([eE][+-]?(${a}))?\\b`},{match:`\\b0x(${u})(\\.(${u}))?([pP][+-]?(${a}))?\\b`},{match:/\b0o([0-7]_*)+\b/},{match:/\b0b([01]_*)+\b/}]},o=(FI="")=>({className:"subst",variants:[{match:Yc(/\\/,FI,/[0\\tnr"']/)},{match:Yc(/\\/,FI,/u\{[0-9a-fA-F]{1,8}\}/)}]}),y=(FI="")=>({className:"subst",match:Yc(/\\/,FI,/[\t ]*(?:[\r\n]|\r\n)/)}),H=(FI="")=>({className:"subst",label:"interpol",begin:Yc(/\\/,FI,/\(/),end:/\)/}),E=(FI="")=>({begin:Yc(FI,/"""/),end:Yc(/"""/,FI),contains:[o(FI),y(FI),H(FI)]}),C=(FI="")=>({begin:Yc(FI,/"/),end:Yc(/"/,FI),contains:[o(FI),H(FI)]}),T={className:"string",variants:[E(),E("#"),E("##"),E("###"),C(),C("#"),C("##"),C("###")]},S={match:Yc(/`/,KZ,/`/)},cI={className:"variable",match:/\$\d+/},hI={className:"variable",match:`\\$${Ju}+`},WI=[S,cI,hI],VI={match:/(@|#(un)?)available/,className:"keyword",starts:{contains:[{begin:/\(/,end:/\)/,keywords:m4,contains:[...F,Q,T]}]}},sI={className:"keyword",match:Yc(/@/,Kb(...n4))},ZI={className:"meta",match:Yc(/@/,KZ)},dI=[VI,sI,ZI],pI={match:gu(/\b[A-Z]/),relevance:0,contains:[{className:"type",match:Yc(/(AV|CA|CF|CG|CI|CL|CM|CN|CT|MK|MP|MTK|MTL|NS|SCN|SK|UI|WK|XC)/,Ju,"+")},{className:"type",match:GF,relevance:0},{match:/[?!]+/,relevance:0},{match:/\.\.\./,relevance:0},{match:Yc(/\s+&\s+/,gu(GF)),relevance:0}]},yI={begin:/</,end:/>/,keywords:s,contains:[...b,...N,...dI,X,pI]};pI.contains.push(yI);let eI={match:Yc(KZ,/\s*:/),keywords:"_|0",relevance:0},HI={begin:/\(/,end:/\)/,relevance:0,keywords:s,contains:["self",eI,...b,...N,...V,...F,Q,T,...WI,...dI,pI]},YI={begin:/</,end:/>/,contains:[...b,pI]},$={begin:Kb(gu(Yc(KZ,/\s*:/)),gu(Yc(KZ,/\s+/,KZ,/\s*:/))),end:/:/,relevance:0,contains:[{className:"keyword",match:/\b_\b/},{className:"params",match:KZ}]},JI={begin:/\(/,end:/\)/,keywords:s,contains:[$,...b,...N,...F,Q,T,...dI,pI,HI],endsParent:!0,illegal:/["']/},UI={match:[/func/,/\s+/,Kb(S.match,KZ,lF)],className:{1:"keyword",3:"title.function"},contains:[YI,JI,G],illegal:[/\[/,/%/]},zI={match:[/\b(?:subscript|init[?!]?)/,/\s*(?=[<(])/],className:{1:"keyword"},contains:[YI,JI,G],illegal:/\[|%/},L={match:[/operator/,/\s+/,lF],className:{1:"keyword",3:"title"}},bI={begin:[/precedencegroup/,/\s+/,GF],className:{1:"keyword",3:"title"},contains:[pI],keywords:[...W4,...Yv],end:/}/};for(let FI of T.variants){let U=FI.contains.find(w=>w.label==="interpol");U.keywords=s;let k=[...N,...V,...F,Q,T,...WI];U.contains=[...k,{begin:/\(/,end:/\)/,contains:["self",...k]}]}return{name:"Swift",keywords:s,contains:[...b,UI,zI,{beginKeywords:"struct protocol class extension enum actor",end:"\\{",excludeEnd:!0,keywords:s,contains:[I.inherit(I.TITLE_MODE,{className:"title.class",begin:/[A-Za-z$_][\u00C0-\u02B80-9A-Za-z$_]*/}),...N]},L,bI,{beginKeywords:"import",end:/$/,contains:[...b],relevance:0},...N,...V,...F,Q,T,...WI,...dI,pI,HI]}}var Cu="[A-Za-z$_][0-9A-Za-z$_]*",Fv=["as","in","of","if","for","while","finally","var","new","function","do","return","void","else","break","catch","instanceof","with","throw","case","default","try","switch","continue","typeof","delete","let","yield","const","class","debugger","async","await","static","import","from","export","extends"],Xv=["true","false","null","undefined","NaN","Infinity"],iv=["Object","Function","Boolean","Symbol","Math","Date","Number","BigInt","String","RegExp","Array","Float32Array","Float64Array","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Int32Array","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array","Set","Map","WeakSet","WeakMap","ArrayBuffer","SharedArrayBuffer","Atomics","DataView","JSON","Promise","Generator","GeneratorFunction","AsyncFunction","Reflect","Proxy","Intl","WebAssembly"],Qv=["Error","EvalError","InternalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError"],Hv=["setInterval","setTimeout","clearInterval","clearTimeout","require","exports","eval","isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","unescape"],rv=["arguments","this","super","console","window","document","localStorage","sessionStorage","module","global"],wv=[].concat(Hv,iv,Qv);function N4(I){let G=I.regex,l=(pI,{after:yI})=>{let eI="</"+pI[0].slice(1);return pI.input.indexOf(eI,yI)!==-1},b=Cu,d={begin:"<>",end:"</>"},e=/<[A-Za-z0-9\\._:-]+\s*\/>/,t={begin:/<[A-Za-z0-9\\._:-]+/,end:/\/[A-Za-z0-9\\._:-]+>|\/>/,isTrulyOpeningTag:(pI,yI)=>{let eI=pI[0].length+pI.index,HI=pI.input[eI];if(HI==="<"||HI===","){yI.ignoreMatch();return}HI===">"&&(l(pI,{after:eI})||yI.ignoreMatch());let YI,$=pI.input.substring(eI);if(YI=$.match(/^\s*=/)){yI.ignoreMatch();return}if((YI=$.match(/^\s+extends\s+/))&&YI.index===0){yI.ignoreMatch();return}}},W={$pattern:Cu,keyword:Fv,literal:Xv,built_in:wv,"variable.language":rv},n="[0-9](_?[0-9])*",s=`\\.(${n})`,N="0|[1-9](_?[0-9])*|0[0-7]*[89][0-9]*",m={className:"number",variants:[{begin:`(\\b(${N})((${s})|\\.)?|(${s}))[eE][+-]?(${n})\\b`},{begin:`\\b(${N})\\b((${s})\\b|\\.)?|(${s})\\b`},{begin:"\\b(0|[1-9](_?[0-9])*)n\\b"},{begin:"\\b0[xX][0-9a-fA-F](_?[0-9a-fA-F])*n?\\b"},{begin:"\\b0[bB][0-1](_?[0-1])*n?\\b"},{begin:"\\b0[oO][0-7](_?[0-7])*n?\\b"},{begin:"\\b0[0-7]+n?\\b"}],relevance:0},h={className:"subst",begin:"\\$\\{",end:"\\}",keywords:W,contains:[]},V={begin:"html`",end:"",starts:{end:"`",returnEnd:!1,contains:[I.BACKSLASH_ESCAPE,h],subLanguage:"xml"}},X={begin:"css`",end:"",starts:{end:"`",returnEnd:!1,contains:[I.BACKSLASH_ESCAPE,h],subLanguage:"css"}},p={begin:"gql`",end:"",starts:{end:"`",returnEnd:!1,contains:[I.BACKSLASH_ESCAPE,h],subLanguage:"graphql"}},F={className:"string",begin:"`",end:"`",contains:[I.BACKSLASH_ESCAPE,h]},u={className:"comment",variants:[I.COMMENT(/\/\*\*(?!\/)/,"\\*/",{relevance:0,contains:[{begin:"(?=@[A-Za-z]+)",relevance:0,contains:[{className:"doctag",begin:"@[A-Za-z]+"},{className:"type",begin:"\\{",end:"\\}",excludeEnd:!0,excludeBegin:!0,relevance:0},{className:"variable",begin:b+"(?=\\s*(-)|$)",endsParent:!0,relevance:0},{begin:/(?=[^\n])\s/,relevance:0}]}]}),I.C_BLOCK_COMMENT_MODE,I.C_LINE_COMMENT_MODE]},Q=[I.APOS_STRING_MODE,I.QUOTE_STRING_MODE,V,X,p,F,{match:/\$\d+/},m];h.contains=Q.concat({begin:/\{/,end:/\}/,keywords:W,contains:["self"].concat(Q)});let o=[].concat(u,h.contains),y=o.concat([{begin:/\(/,end:/\)/,keywords:W,contains:["self"].concat(o)}]),H={className:"params",begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:W,contains:y},E={variants:[{match:[/class/,/\s+/,b,/\s+/,/extends/,/\s+/,G.concat(b,"(",G.concat(/\./,b),")*")],scope:{1:"keyword",3:"title.class",5:"keyword",7:"title.class.inherited"}},{match:[/class/,/\s+/,b],scope:{1:"keyword",3:"title.class"}}]},C={relevance:0,match:G.either(/\bJSON/,/\b[A-Z][a-z]+([A-Z][a-z]*|\d)*/,/\b[A-Z]{2,}([A-Z][a-z]+|\d)+([A-Z][a-z]*)*/,/\b[A-Z]{2,}[a-z]+([A-Z][a-z]+|\d)*([A-Z][a-z]*)*/),className:"title.class",keywords:{_:[...iv,...Qv]}},T={label:"use_strict",className:"meta",relevance:10,begin:/^\s*['"]use (strict|asm)['"]/},S={variants:[{match:[/function/,/\s+/,b,/(?=\s*\()/]},{match:[/function/,/\s*(?=\()/]}],className:{1:"keyword",3:"title.function"},label:"func.def",contains:[H],illegal:/%/},cI={relevance:0,match:/\b[A-Z][A-Z_0-9]+\b/,className:"variable.constant"};function hI(pI){return G.concat("(?!",pI.join("|"),")")}let WI={match:G.concat(/\b/,hI([...Hv,"super","import"]),b,G.lookahead(/\(/)),className:"title.function",relevance:0},VI={begin:G.concat(/\./,G.lookahead(G.concat(b,/(?![0-9A-Za-z$_(])/))),end:b,excludeBegin:!0,keywords:"prototype",className:"property",relevance:0},sI={match:[/get|set/,/\s+/,b,/(?=\()/],className:{1:"keyword",3:"title.function"},contains:[{begin:/\(\)/},H]},ZI="(\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)|"+I.UNDERSCORE_IDENT_RE+")\\s*=>",dI={match:[/const|var|let/,/\s+/,b,/\s*/,/=\s*/,/(async\s*)?/,G.lookahead(ZI)],keywords:"async",className:{1:"keyword",3:"title.function"},contains:[H]};return{name:"JavaScript",aliases:["js","jsx","mjs","cjs"],keywords:W,exports:{PARAMS_CONTAINS:y,CLASS_REFERENCE:C},illegal:/#(?![$_A-z])/,contains:[I.SHEBANG({label:"shebang",binary:"node",relevance:5}),T,I.APOS_STRING_MODE,I.QUOTE_STRING_MODE,V,X,p,F,u,{match:/\$\d+/},m,C,{className:"attr",begin:b+G.lookahead(":"),relevance:0},dI,{begin:"("+I.RE_STARTERS_RE+"|\\b(case|return|throw)\\b)\\s*",keywords:"return throw case",relevance:0,contains:[u,I.REGEXP_MODE,{className:"function",begin:ZI,returnBegin:!0,end:"\\s*=>",contains:[{className:"params",variants:[{begin:I.UNDERSCORE_IDENT_RE,relevance:0},{className:null,begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:W,contains:y}]}]},{begin:/,/,relevance:0},{match:/\s+/,relevance:0},{variants:[{begin:d.begin,end:d.end},{match:e},{begin:t.begin,"on:begin":t.isTrulyOpeningTag,end:t.end}],subLanguage:"xml",contains:[{begin:t.begin,end:t.end,skip:!0,contains:["self"]}]}]},S,{beginKeywords:"while if switch catch for"},{begin:"\\b(?!function)"+I.UNDERSCORE_IDENT_RE+"\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)\\s*\\{",returnBegin:!0,label:"func.def",contains:[H,I.inherit(I.TITLE_MODE,{begin:b,className:"title.function"})]},{match:/\.\.\./,relevance:0},VI,{match:"\\$"+b,relevance:0},{match:[/\bconstructor(?=\s*\()/],className:{1:"title.function"},contains:[H]},WI,cI,E,sI,{match:/\$[(.]/}]}}function vv(I){let G=N4(I),l=Cu,b=["any","void","number","boolean","string","object","never","symbol","bigint","unknown"],d={beginKeywords:"namespace",end:/\{/,excludeEnd:!0,contains:[G.exports.CLASS_REFERENCE]},e={beginKeywords:"interface",end:/\{/,excludeEnd:!0,keywords:{keyword:"interface extends",built_in:b},contains:[G.exports.CLASS_REFERENCE]},t={className:"meta",relevance:10,begin:/^\s*['"]use strict['"]/},W=["type","namespace","interface","public","private","protected","implements","declare","abstract","readonly","enum","override"],n={$pattern:Cu,keyword:Fv.concat(W),literal:Xv,built_in:wv.concat(b),"variable.language":rv},s={className:"meta",begin:"@"+l},N=(h,V,X)=>{let p=h.contains.findIndex(F=>F.label===V);if(p===-1)throw new Error("can not find mode to replace");h.contains.splice(p,1,X)};Object.assign(G.keywords,n),G.exports.PARAMS_CONTAINS.push(s),G.contains=G.contains.concat([s,d,e]),N(G,"shebang",I.SHEBANG()),N(G,"use_strict",t);let m=G.contains.find(h=>h.label==="func.def");return m.relevance=0,Object.assign(G,{name:"TypeScript",aliases:["ts","tsx","mts","cts"]}),G}function Ev(I){let G=I.regex,l={className:"string",begin:/"(""|[^/n])"C\b/},b={className:"string",begin:/"/,end:/"/,illegal:/\n/,contains:[{begin:/""/}]},d=/\d{1,2}\/\d{1,2}\/\d{4}/,e=/\d{4}-\d{1,2}-\d{1,2}/,t=/(\d|1[012])(:\d+){0,2} *(AM|PM)/,W=/\d{1,2}(:\d{1,2}){1,2}/,n={className:"literal",variants:[{begin:G.concat(/# */,G.either(e,d),/ *#/)},{begin:G.concat(/# */,W,/ *#/)},{begin:G.concat(/# */,t,/ *#/)},{begin:G.concat(/# */,G.either(e,d),/ +/,G.either(t,W),/ *#/)}]},s={className:"number",relevance:0,variants:[{begin:/\b\d[\d_]*((\.[\d_]+(E[+-]?[\d_]+)?)|(E[+-]?[\d_]+))[RFD@!#]?/},{begin:/\b\d[\d_]*((U?[SIL])|[%&])?/},{begin:/&H[\dA-F_]+((U?[SIL])|[%&])?/},{begin:/&O[0-7_]+((U?[SIL])|[%&])?/},{begin:/&B[01_]+((U?[SIL])|[%&])?/}]},N={className:"label",begin:/^\w+:/},m=I.COMMENT(/'''/,/$/,{contains:[{className:"doctag",begin:/<\/?/,end:/>/}]}),h=I.COMMENT(null,/$/,{variants:[{begin:/'/},{begin:/([\t ]|^)REM(?=\s)/}]});return{name:"Visual Basic .NET",aliases:["vb"],case_insensitive:!0,classNameAliases:{label:"symbol"},keywords:{keyword:"addhandler alias aggregate ansi as async assembly auto binary by byref byval call case catch class compare const continue custom declare default delegate dim distinct do each equals else elseif end enum erase error event exit explicit finally for friend from function get global goto group handles if implements imports in inherits interface into iterator join key let lib loop me mid module mustinherit mustoverride mybase myclass namespace narrowing new next notinheritable notoverridable of off on operator option optional order overloads overridable overrides paramarray partial preserve private property protected public raiseevent readonly redim removehandler resume return select set shadows shared skip static step stop structure strict sub synclock take text then throw to try unicode until using when where while widening with withevents writeonly yield",built_in:"addressof and andalso await directcast gettype getxmlnamespace is isfalse isnot istrue like mod nameof new not or orelse trycast typeof xor cbool cbyte cchar cdate cdbl cdec cint clng cobj csbyte cshort csng cstr cuint culng cushort",type:"boolean byte char date decimal double integer long object sbyte short single string uinteger ulong ushort",literal:"true false nothing"},illegal:"//|\\{|\\}|endif|gosub|variant|wend|^\\$ ",contains:[l,b,n,s,N,m,h,{className:"meta",begin:/[\t ]*#(const|disable|else|elseif|enable|end|externalsource|if|region)\b/,end:/$/,keywords:{keyword:"const disable else elseif enable end externalsource if region then"},contains:[h]}]}}function yv(I){I.regex;let G=I.COMMENT(/\(;/,/;\)/);G.contains.push("self");let l=I.COMMENT(/;;/,/$/),b=["anyfunc","block","br","br_if","br_table","call","call_indirect","data","drop","elem","else","end","export","func","global.get","global.set","local.get","local.set","local.tee","get_global","get_local","global","if","import","local","loop","memory","memory.grow","memory.size","module","mut","nop","offset","param","result","return","select","set_global","set_local","start","table","tee_local","then","type","unreachable"],d={begin:[/(?:func|call|call_indirect)/,/\s+/,/\$[^\s)]+/],className:{1:"keyword",3:"title.function"}},e={className:"variable",begin:/\$[\w_]+/},t={match:/(\((?!;)|\))+/,className:"punctuation",relevance:0},W={className:"number",relevance:0,match:/[+-]?\b(?:\d(?:_?\d)*(?:\.\d(?:_?\d)*)?(?:[eE][+-]?\d(?:_?\d)*)?|0x[\da-fA-F](?:_?[\da-fA-F])*(?:\.[\da-fA-F](?:_?[\da-fA-D])*)?(?:[pP][+-]?\d(?:_?\d)*)?)\b|\binf\b|\bnan(?::0x[\da-fA-F](?:_?[\da-fA-D])*)?\b/},n={match:/(i32|i64|f32|f64)(?!\.)/,className:"type"},s={className:"keyword",match:/\b(f32|f64|i32|i64)(?:\.(?:abs|add|and|ceil|clz|const|convert_[su]\/i(?:32|64)|copysign|ctz|demote\/f64|div(?:_[su])?|eqz?|extend_[su]\/i32|floor|ge(?:_[su])?|gt(?:_[su])?|le(?:_[su])?|load(?:(?:8|16|32)_[su])?|lt(?:_[su])?|max|min|mul|nearest|neg?|or|popcnt|promote\/f32|reinterpret\/[fi](?:32|64)|rem_[su]|rot[lr]|shl|shr_[su]|store(?:8|16|32)?|sqrt|sub|trunc(?:_[su]\/f(?:32|64))?|wrap\/i64|xor))\b/};return{name:"WebAssembly",keywords:{$pattern:/[\w.]+/,keyword:b},contains:[l,G,{match:[/(?:offset|align)/,/\s*/,/=/],className:{1:"keyword",3:"operator"}},e,t,d,I.QUOTE_STRING_MODE,n,s,W]}}function gv(I){let G=I.regex,l=G.concat(/[\p{L}_]/u,G.optional(/[\p{L}0-9_.-]*:/u),/[\p{L}0-9_.-]*/u),b=/[\p{L}0-9._:-]+/u,d={className:"symbol",begin:/&[a-z]+;|&#[0-9]+;|&#x[a-f0-9]+;/},e={begin:/\s/,contains:[{className:"keyword",begin:/#?[a-z_][a-z1-9_-]+/,illegal:/\n/}]},t=I.inherit(e,{begin:/\(/,end:/\)/}),W=I.inherit(I.APOS_STRING_MODE,{className:"string"}),n=I.inherit(I.QUOTE_STRING_MODE,{className:"string"}),s={endsWithParent:!0,illegal:/</,relevance:0,contains:[{className:"attr",begin:b,relevance:0},{begin:/=\s*/,relevance:0,contains:[{className:"string",endsParent:!0,variants:[{begin:/"/,end:/"/,contains:[d]},{begin:/'/,end:/'/,contains:[d]},{begin:/[^\s"'=<>`]+/}]}]}]};return{name:"HTML, XML",aliases:["html","xhtml","rss","atom","xjb","xsd","xsl","plist","wsf","svg"],case_insensitive:!0,unicodeRegex:!0,contains:[{className:"meta",begin:/<![a-z]/,end:/>/,relevance:10,contains:[e,n,W,t,{begin:/\[/,end:/\]/,contains:[{className:"meta",begin:/<![a-z]/,end:/>/,contains:[e,t,n,W]}]}]},I.COMMENT(/<!--/,/-->/,{relevance:10}),{begin:/<!\[CDATA\[/,end:/\]\]>/,relevance:10},d,{className:"meta",end:/\?>/,variants:[{begin:/<\?xml/,relevance:10,contains:[n]},{begin:/<\?[a-z][a-z0-9]+/}]},{className:"tag",begin:/<style(?=\s|>)/,end:/>/,keywords:{name:"style"},contains:[s],starts:{end:/<\/style>/,returnEnd:!0,subLanguage:["css","xml"]}},{className:"tag",begin:/<script(?=\s|>)/,end:/>/,keywords:{name:"script"},contains:[s],starts:{end:/<\/script>/,returnEnd:!0,subLanguage:["javascript","handlebars","xml"]}},{className:"tag",begin:/<>|<\/>/},{className:"tag",begin:G.concat(/</,G.lookahead(G.concat(l,G.either(/\/>/,/>/,/\s/)))),end:/\/?>/,contains:[{className:"name",begin:l,relevance:0,starts:s}]},{className:"tag",begin:G.concat(/<\//,G.lookahead(G.concat(l,/>/))),contains:[{className:"name",begin:l,relevance:0},{begin:/>/,relevance:0,endsParent:!0}]}]}}function Jv(I){let G="true false yes no null",l="[\\w#;/?:@&=+$,.~*'()[\\]]+",b={className:"attr",variants:[{begin:"\\w[\\w :\\/.-]*:(?=[ 	]|$)"},{begin:'"\\w[\\w :\\/.-]*":(?=[ 	]|$)'},{begin:"'\\w[\\w :\\/.-]*':(?=[ 	]|$)"}]},d={className:"template-variable",variants:[{begin:/\{\{/,end:/\}\}/},{begin:/%\{/,end:/\}/}]},e={className:"string",relevance:0,variants:[{begin:/'/,end:/'/},{begin:/"/,end:/"/},{begin:/\S+/}],contains:[I.BACKSLASH_ESCAPE,d]},t=I.inherit(e,{variants:[{begin:/'/,end:/'/},{begin:/"/,end:/"/},{begin:/[^\s,{}[\]]+/}]}),m={className:"number",begin:"\\b"+"[0-9]{4}(-[0-9][0-9]){0,2}"+"([Tt \\t][0-9][0-9]?(:[0-9][0-9]){2})?"+"(\\.[0-9]*)?"+"([ \\t])*(Z|[-+][0-9][0-9]?(:[0-9][0-9])?)?"+"\\b"},h={end:",",endsWithParent:!0,excludeEnd:!0,keywords:G,relevance:0},V={begin:/\{/,end:/\}/,contains:[h],illegal:"\\n",relevance:0},X={begin:"\\[",end:"\\]",contains:[h],illegal:"\\n",relevance:0},p=[b,{className:"meta",begin:"^---\\s*$",relevance:10},{className:"string",begin:"[\\|>]([1-9]?[+-])?[ ]*\\n( +)[^ ][^\\n]*\\n(\\2[^\\n]+\\n?)*"},{begin:"<%[%=-]?",end:"[%-]?%>",subLanguage:"ruby",excludeBegin:!0,excludeEnd:!0,relevance:0},{className:"type",begin:"!\\w+!"+l},{className:"type",begin:"!<"+l+">"},{className:"type",begin:"!"+l},{className:"type",begin:"!!"+l},{className:"meta",begin:"&"+I.UNDERSCORE_IDENT_RE+"$"},{className:"meta",begin:"\\*"+I.UNDERSCORE_IDENT_RE+"$"},{className:"bullet",begin:"-(?=[ ]|$)",relevance:0},I.HASH_COMMENT_MODE,{beginKeywords:G,keywords:{literal:G}},m,{className:"number",begin:I.C_NUMBER_RE+"\\b",relevance:0},V,X,e],F=[...p];return F.pop(),F.push(t),h.contains=F,{name:"YAML",case_insensitive:!0,aliases:["yml"],contains:p}}var IE=el($v(),1);var yd=IE.default;var GE=el(lE(),1),hh=Object.assign(qa(Error),{eval:qa(EvalError),range:qa(RangeError),reference:qa(ReferenceError),syntax:qa(SyntaxError),type:qa(TypeError),uri:qa(URIError)});function qa(I){return G.displayName=I.displayName||I.name,G;function G(l,...b){let d=l&&(0,GE.default)(l,...b);return new I(d)}}var ck={}.hasOwnProperty,cE="hljs-";function bE(I,G,l={}){let b=l.prefix;if(typeof I!="string")throw hh("Expected `string` for name, got `%s`",I);if(!yd.getLanguage(I))throw hh("Unknown language: `%s` is not registered",I);if(typeof G!="string")throw hh("Expected `string` for value, got `%s`",G);b==null&&(b=cE),yd.configure({__emitter:NF,classPrefix:b});let d=yd.highlight(G,{language:I,ignoreIllegals:!0});if(yd.configure({}),d.errorRaised)throw d.errorRaised;return d._emitter.root.data.language=d.language,d._emitter.root.data.relevance=d.relevance,d._emitter.root}function bk(I,G={}){let l=G.subset||yd.listLanguages(),b=G.prefix,d=-1,e={type:"root",data:{language:null,relevance:0},children:[]};if(b==null&&(b=cE),typeof I!="string")throw hh("Expected `string` for value, got `%s`",I);for(;++d<l.length;){let t=l[d];if(!yd.getLanguage(t))continue;let W=bE(t,I,G);W.data.relevance>e.data.relevance&&(e=W)}return e}function dk(I,G){yd.registerLanguage(I,G)}var Zk=function(I,G){if(typeof I=="string")yd.registerAliases(G,{languageName:I});else{let l;for(l in I)ck.call(I,l)&&yd.registerAliases(I[l],{languageName:l})}};function ek(I){return!!yd.getLanguage(I)}function ak(){return yd.listLanguages()}var NF=class{constructor(G){this.options=G,this.root={type:"root",data:{language:null,relevance:0},children:[]},this.stack=[this.root]}addText(G){if(G==="")return;let l=this.stack[this.stack.length-1],b=l.children[l.children.length-1];b&&b.type==="text"?b.value+=G:l.children.push({type:"text",value:G})}startScope(G){this.openNode(String(G))}endScope(){this.closeNode()}__addSublanguage(G,l){let b=this.stack[this.stack.length-1],d=G.root.children;l?b.children.push({type:"element",tagName:"span",properties:{className:[l]},children:d}):b.children.push(...d)}openNode(G){let l=G.split(".").map((e,t)=>t?e+"_".repeat(t):this.options.classPrefix+e),b=this.stack[this.stack.length-1],d={type:"element",tagName:"span",properties:{className:l},children:[]};b.children.push(d),this.stack.push(d)}closeNode(){this.stack.pop()}finalize(){}toHTML(){return""}},uG={highlight:bE,highlightAuto:bk,registerLanguage:dk,registered:ek,listLanguages:ak,registerAlias:Zk};uG.registerLanguage("arduino",vw);uG.registerLanguage("bash",Ew);uG.registerLanguage("c",yw);uG.registerLanguage("cpp",gw);uG.registerLanguage("csharp",Jw);uG.registerLanguage("css",Cw);uG.registerLanguage("diff",Aw);uG.registerLanguage("go",Lw);uG.registerLanguage("graphql",kw);uG.registerLanguage("ini",xw);uG.registerLanguage("java",Mw);uG.registerLanguage("javascript",Tw);uG.registerLanguage("json",fw);uG.registerLanguage("kotlin",Sw);uG.registerLanguage("less",_w);uG.registerLanguage("lua",Pw);uG.registerLanguage("makefile",$w);uG.registerLanguage("markdown",Iv);uG.registerLanguage("objectivec",lv);uG.registerLanguage("perl",Gv);uG.registerLanguage("php",cv);uG.registerLanguage("php-template",bv);uG.registerLanguage("plaintext",dv);uG.registerLanguage("python",Zv);uG.registerLanguage("python-repl",ev);uG.registerLanguage("r",av);uG.registerLanguage("ruby",Wv);uG.registerLanguage("rust",tv);uG.registerLanguage("scss",nv);uG.registerLanguage("shell",mv);uG.registerLanguage("sql",Nv);uG.registerLanguage("swift",ov);uG.registerLanguage("typescript",vv);uG.registerLanguage("vbnet",Ev);uG.registerLanguage("wasm",yv);uG.registerLanguage("xml",gv);uG.registerLanguage("yaml",Jv);var ze=function(I){if(I==null)return sF;if(typeof I=="string")return tk(I);if(typeof I=="object")return Wk(I);if(typeof I=="function")return dE(I);throw new Error("Expected function, string, or array as test")};function Wk(I){let G=[],l=-1;for(;++l<I.length;)G[l]=ze(I[l]);return dE(b);function b(...d){let e=-1;for(;++e<G.length;)if(G[e].call(this,...d))return!0;return!1}}function tk(I){return G;function G(l){return sF(l)&&l.tagName===I}}function dE(I){return G;function G(l,...b){return sF(l)&&!!I.call(this,l,...b)}}function sF(I){return!!(I&&typeof I=="object"&&I.type==="element"&&typeof I.tagName=="string")}var zu=function(I,G,l){let b=Un(l);if(!I||!I.type||!I.children)throw new Error("Expected parent node");if(typeof G=="number"){if(G<0||G===Number.POSITIVE_INFINITY)throw new Error("Expected positive finite number as index")}else if(G=I.children.indexOf(G),G<0)throw new Error("Expected child node or index");for(;++G<I.children.length;)if(b(I.children[G],G,I))return I.children[G];return null};var ZE=/\n/g,eE=/[\t ]+/g,YF=ze("br"),nk=ze("p"),aE=ze(["th","td"]),WE=ze("tr"),mk=ze(["datalist","head","noembed","noframes","noscript","rp","script","style","template","title",hk,Vk]),tE=ze(["address","article","aside","blockquote","body","caption","center","dd","dialog","dir","dl","dt","div","figure","figcaption","footer","form,","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","legend","listing","main","menu","nav","ol","p","plaintext","pre","section","ul","xmp"]);function Uu(I,G={}){let l="children"in I?I.children:[],b=tE(I),d=NE(I,{whitespace:G.whitespace||"normal",breakBefore:!1,breakAfter:!1}),e=[];(I.type==="text"||I.type==="comment")&&e.push(...mE(I,{whitespace:d,breakBefore:!0,breakAfter:!0}));let t=-1;for(;++t<l.length;)e.push(...nE(l[t],I,{whitespace:d,breakBefore:t?void 0:b,breakAfter:t<l.length-1?YF(l[t+1]):b}));let W=[],n;for(t=-1;++t<e.length;){let s=e[t];typeof s=="number"?n!==void 0&&s>n&&(n=s):s&&(n!==void 0&&n>-1&&W.push(`
`.repeat(n)||" "),n=-1,W.push(s))}return W.join("")}function nE(I,G,l){return I.type==="element"?Nk(I,G,l):I.type==="text"?l.whitespace==="normal"?mE(I,l):sk(I):[]}function Nk(I,G,l){let b=NE(I,l),d=I.children||[],e=-1,t=[];if(mk(I))return t;let W,n;for(YF(I)||WE(I)&&zu(G,I,WE)?n=`
`:nk(I)?(W=2,n=2):tE(I)&&(W=1,n=1);++e<d.length;)t=t.concat(nE(d[e],I,{whitespace:b,breakBefore:e?void 0:W,breakAfter:e<d.length-1?YF(d[e+1]):n}));return aE(I)&&zu(G,I,aE)&&t.push("	"),W&&t.unshift(W),n&&t.push(n),t}function mE(I,G){let l=String(I.value),b=[],d=[],e=0;for(;e<=l.length;){ZE.lastIndex=e;let n=ZE.exec(l),s=n&&"index"in n?n.index:l.length;b.push(Yk(l.slice(e,s).replace(/[\u061C\u200E\u200F\u202A-\u202E\u2066-\u2069]/g,""),e===0?G.breakBefore:!0,s===l.length?G.breakAfter:!0)),e=s+1}let t=-1,W;for(;++t<b.length;)b[t].charCodeAt(b[t].length-1)===8203||t<b.length-1&&b[t+1].charCodeAt(0)===8203?(d.push(b[t]),W=void 0):b[t]?(typeof W=="number"&&d.push(W),d.push(b[t]),W=0):(t===0||t===b.length-1)&&d.push(0);return d}function sk(I){return[String(I.value)]}function Yk(I,G,l){let b=[],d=0,e;for(;d<I.length;){eE.lastIndex=d;let t=eE.exec(I);e=t?t.index:I.length,!d&&!e&&t&&!G&&b.push(""),d!==e&&b.push(I.slice(d,e)),d=t?e+t[0].length:e}return d!==e&&!l&&b.push(""),b.join(" ")}function NE(I,G){if(I.type==="element"){let l=I.properties||{};switch(I.tagName){case"listing":case"plaintext":case"xmp":return"pre";case"nobr":return"nowrap";case"pre":return l.wrap?"pre-wrap":"pre";case"td":case"th":return l.noWrap?"nowrap":G.whitespace;case"textarea":return"pre-wrap";default:}}return G.whitespace}function hk(I){return!!(I.properties||{}).hidden}function Vk(I){return I.tagName==="dialog"&&!(I.properties||{}).open}var pk={}.hasOwnProperty;function Tn(I={}){let{aliases:G,languages:l,prefix:b,plainText:d,ignoreMissing:e,subset:t,detect:W}=I,n="hljs";if(G&&uG.registerAlias(G),l){let s;for(s in l)pk.call(l,s)&&uG.registerLanguage(s,l[s])}if(b){let s=b.indexOf("-");n=s>-1?b.slice(0,s):b}return(s,N)=>{OZ(s,"element",(m,h,V)=>{let X=V;if(!X||!("tagName"in X)||X.tagName!=="pre"||m.tagName!=="code"||!m.properties)return;let p=uk(m);if(p===!1||!p&&!W||p&&d&&d.includes(p))return;Array.isArray(m.properties.className)||(m.properties.className=[]),m.properties.className.includes(n)||m.properties.className.unshift(n);let F;try{F=p?uG.highlight(p,Uu(X),{prefix:b}):uG.highlightAuto(Uu(X),{prefix:b,subset:t})}catch(a){let u=a;(!e||!/Unknown language/.test(u.message))&&N.fail(u,m,"rehype-highlight:missing-language");return}!p&&F.data.language&&m.properties.className.push("language-"+F.data.language),Array.isArray(F.children)&&F.children.length>0&&(m.children=F.children)})}}function uk(I){let G=I.properties&&I.properties.className,l=-1;if(Array.isArray(G))for(;++l<G.length;){let b=String(G[l]);if(b==="no-highlight"||b==="nohighlight")return!1;if(b.slice(0,5)==="lang-")return b.slice(5);if(b.slice(0,9)==="language-")return b.slice(9)}}var fn=el(uc());var sE=el(uc());async function YE(I){let G=await t0(I),{[G]:l}=await sE.default.storage.session.get(G).catch(()=>({}));return l}var Mu=el(IG());function Vh(I){let[G,l]=(0,Mu.useState)(!1);return(0,Mu.useEffect)(()=>{let b=()=>{l(!0)},d=I.current;return d&&(d.addEventListener("wheel",b),d.addEventListener("touchstart",b),d.addEventListener("keydown",b),d.addEventListener("mousedown",b)),()=>{d&&(d.removeEventListener("wheel",b),d.removeEventListener("touchstart",b),d.removeEventListener("keydown",b),d.removeEventListener("mousedown",b))}},[]),{interruptScroll:G,setInterruptScroll:l}}var hE=el(IG()),ph=el(RG());function hF(I){let[G,l]=(0,hE.useState)(""),b=()=>{G.trim()!==""&&(I.onMessageSend(G),I.handleChatSubmit(G),l(""))},d=W=>{l(W.target.value)},e=()=>{b()},t=W=>{W.key==="Enter"&&(W.preventDefault(),b())};return(0,ph.jsxs)("div",{className:"flex gap-1",children:[(0,ph.jsx)("input",{type:"text",disabled:I.disable,value:G,onChange:d,onKeyDown:t,placeholder:"Type your message here...",className:`block grow rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm sm:leading-6 ${I.disable?"cursor-not-allowed opacity-50":""}`}),(0,ph.jsx)("button",{disabled:I.disable,className:`items-center rounded-md border border-transparent bg-primary-500 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 ${I.disable?"cursor-not-allowed opacity-50":""}`,onClick:e,children:">"})]})}var Zd=el(RG());function VF({content:I,hideAllReferences:G,forceDisable:l}){let b=(0,gd.useRef)(null),d=(0,gd.useRef)(null),[e,t]=(0,gd.useState)([]),[W,n]=(0,gd.useState)(l),{interruptScroll:s,setInterruptScroll:N}=Vh(d),m=(0,gd.useRef)(void 0),h=fn.default.runtime.connect({name:"answerQA"});(0,gd.useEffect)(()=>{n(l)},[l]);let V=({role:a,content:u,showReference:Q})=>{t(o=>{let y=o[o.length-1],H={role:a??y.role,content:u??y.content,showReference:Q??y.showReference};return[...o.slice(0,-1),H]})},X=a=>{if(typeof a=="object"&&a!==null&&"type"in a){let u=a;switch(u.type){case"answer":{let{tokens:Q,states:o}=u.data;o&&o.start?p("","receiver"):o&&o.end?(n(!1),setTimeout(()=>V({showReference:!0}),0)):o&&o.error?(p(o.error,"receiver"),n(!1)):setTimeout(()=>V({content:Q}),0);break}case"error":{p(u.data,"receiver"),n(!1);break}}}};h.onMessage.addListener(X);let p=(a,u)=>{t(Q=>[...Q,{content:a,role:u}])},F=async a=>{fn.default.runtime.connect({name:"summarize"}).disconnect(),h.postMessage({type:"answer",question:a,text:I})};return(0,gd.useEffect)(()=>{p(fn.default.i18n.getMessage("askQuestionIntro"),"receiver")},[]),(0,gd.useEffect)(()=>{s||b.current?.scrollIntoView({behavior:"smooth"})},[e,s]),(0,gd.useEffect)(()=>()=>{m.current&&clearTimeout(m.current)},[]),(0,Zd.jsxs)("div",{className:"flex h-full flex-col px-2 py-1",children:[(0,Zd.jsxs)("div",{className:"flex flex-shrink flex-grow flex-col",ref:d,children:[e.map((a,u)=>(0,Zd.jsx)("div",{className:`flex ${a.role==="sender"?"justify-end":"justify-start"} mb-2`,children:(0,Zd.jsxs)("div",{className:`flex max-w-[70%] break-words rounded-lg px-4 py-2 ${a.role==="sender"?"bg-blue-500 text-white":"bg-gray-200 text-black"}`,children:[(0,Zd.jsx)("div",{dir:"auto",children:(0,Zd.jsx)(Mn,{rehypePlugins:[[Tn,{detect:!0}]],children:a.content})}),a.showReference&&!G&&(0,Zd.jsx)("sup",{className:"top-0",children:(0,Zd.jsxs)("a",{href:"",onClick:async Q=>{Q.preventDefault();let[o]=await fn.default.tabs.query({active:!0,currentWindow:!0});o.id&&await fn.default.tabs.sendMessage(o.id,{type:"MARK_CONTENT",content:await YE(a.content),to:"content-script"})},children:["[",u/2,"]"]})})]})},u)),(0,Zd.jsx)("div",{ref:b})]}),(0,Zd.jsx)("div",{className:"my-2",children:(0,Zd.jsx)(hF,{disable:W,onMessageSend:a=>{p(a,"sender"),n(!0),N(!1),m.current=setTimeout(()=>{n(!1)},1e4)},handleChatSubmit:F})})]})}var sZ=el(RG());function uF(){let I=ld("questionContent",()=>lo()),{settings:G}=gb(),[l,b]=(0,Bu.useState)(!1);return(0,Bu.useEffect)(()=>{G?.provider!=="api"?(Jb.sendNotification({element:(0,sZ.jsxs)("span",{children:[(0,sZ.jsx)("b",{children:"Alert:"})," ",pF.default.i18n.getMessage("alertAskQuestion")]}),position:"top-center",id:"ask-question-alert",toastType:"blank"}),b(!0)):(yb.remove("ask-question-alert"),b(!1))},[G]),(0,sZ.jsxs)(sZ.Fragment,{children:[I.isLoading&&(0,sZ.jsx)("p",{className:"animate-pulse px-4 pb-4 pt-2 text-[#b6b8ba]",children:pF.default.i18n.getMessage("extractingPageContent")}),I.error&&(0,sZ.jsx)("p",{children:I.error.message}),I.data&&(0,sZ.jsx)(VF,{content:I.data.plainSubtitles??I.data.textContent,forceDisable:l,hideAllReferences:I.data.isPdf??I.data.plainSubtitles!=null})]})}var L1=el(uc());var DZ=el(IG()),A1=el(RF());var Gm=el(uc());var FF=el(uc());var ju=el(uc());var Ku=el(RG()),pE=({text:I,callback:G,className:l})=>(0,Ku.jsx)("button",{onClick:G,className:`rounded-full border border-red-800 bg-transparent px-3 py-1.5 text-center text-xs font-medium text-red-800 hover:bg-red-900 hover:text-white focus:outline-none focus:ring-4 focus:ring-red-300 dark:border-red-600 dark:text-red-500 dark:hover:bg-red-600 dark:hover:text-white dark:focus:ring-red-800 ${l}`,children:I}),oF=()=>(0,Ku.jsx)(pE,{text:"Switch to GPT-3.5",callback:async()=>{await ju.default.storage.local.set({model:AZ.preferredModels[AZ.preferredModels.length-1]});let G=(await ju.default.storage.local.get({selectedLanguage:fR()}))?.selectedLanguage;G&&await ji(`summarizeQueryKey-${G}`,null,{revalidate:!0})}});var uE=({id:I})=>(0,Ku.jsx)(pE,{text:"Reset Now",callback:async()=>{await ju.default.storage.local.remove(["question","systemMessage"]),yb.remove(I),await Jb.dismissAnnouncement(I)}});var RE=el(RG()),ok=({text:I,url:G,className:l})=>(0,RE.jsx)("a",{href:G,target:"_blank",rel:"noreferrer",className:`rounded-full border border-red-800 bg-transparent px-3 py-1.5 text-center text-xs font-medium text-red-800 hover:bg-red-900 hover:text-white focus:outline-none focus:ring-4 focus:ring-red-300 dark:border-red-600 dark:text-red-500 dark:hover:bg-red-600 dark:hover:text-white dark:focus:ring-red-800 ${l}`,children:I}),Tu=ok;var TG=el(RG()),XF=class I{static formatError(G,l,b){if(!G)return(0,TG.jsx)(TG.Fragment,{});let d=LZ.getConfig(l);return I.isUnauthorizedError(G)||I.isCloudflareError(G)?I.formatUnauthorizedOrCloudflareError(b?.retryCount||0):I.isIncorrectApiKeyError(G)?I.formatApiKeyError():I.isUnprocessableEntityError(G)?I.formatUnprocessableEntityError():I.isOverCapacityError(G)?I.formatOverCapacityError(b):I.isSubscriptionExpiredError(G)?I.formatSubscriptionExpiredError():(0,TG.jsxs)("span",{children:[(0,TG.jsxs)("b",{children:[d.title,":"]})," ",G]})}static isAuthError(G){return!G||I.isUnauthorizedError(G)||I.isCloudflareError(G)||I.isIncorrectApiKeyError(G)||I.isUnprocessableEntityError(G)||I.isOverCapacityError(G)||I.isSubscriptionExpiredError(G)}static isUnauthorizedError(G){return G==="UNAUTHORIZED"}static isCloudflareError(G){return G==="CLOUDFLARE"}static isIncorrectApiKeyError(G){return/incorrect\sapi\skey/i.test(G||"")}static isUnprocessableEntityError(G){return/unable\sto\sproduce/i.test(G||"")}static isOverCapacityError(G){return/too\smany\smessages/i.test(G||"")}static isSubscriptionExpiredError(G){return/paid\susers/i.test(G||"")}static formatUnauthorizedOrCloudflareError(G){return(0,TG.jsxs)(TG.Fragment,{children:[(0,TG.jsx)("span",{className:"text-sm",dangerouslySetInnerHTML:{__html:FF.default.i18n.getMessage("refreshOpenAILogin").replaceAll("<a>",`<a href="${AZ.endpoint}" target="_blank" rel="noreferrer" style="text-decoration: underline">`)}}),G>0&&(0,TG.jsx)("span",{className:"mt-5 block text-xs italic",children:FF.default.i18n.getMessage("requestOpenAIProvider")})]})}static formatApiKeyError(){return(0,TG.jsxs)("div",{children:[(0,TG.jsxs)("span",{className:"text-sm",children:["Please, update your API key or switch to the ChatGPT provider.",(0,TG.jsx)("br",{}),"You can find your API key at"," ",(0,TG.jsx)("a",{href:"https://platform.openai.com/account/api-keys",target:"_blank",rel:"noreferrer",className:"underline",children:"https://platform.openai.com/account/api-keys"}),"."]}),(0,TG.jsxs)("div",{className:"mt-4 flex gap-1",children:[(0,TG.jsx)(Tu,{text:"Switch to the ChatGPT",url:"chrome-extension://cbgecfllfhmmnknmamkejadjmnmpfjmp/options/index.html"}),(0,TG.jsx)(Tu,{text:"Update API key",url:"chrome-extension://cbgecfllfhmmnknmamkejadjmnmpfjmp/options/index.html"})]})]})}static formatUnprocessableEntityError(){return(0,TG.jsx)(TG.Fragment,{children:(0,TG.jsxs)("span",{className:"text-sm",children:[(0,TG.jsx)("b",{children:"Error 422: Unprocessable Entity"}),(0,TG.jsx)("br",{}),"ChatGPT is unable to process your request because it may not align with their safety protocols or it contains unsupported or illegal characters."]})})}static formatOverCapacityError(G){let l="";if(G?.context?.detail?.clears_in){let b=G?.context?.detail?.clears_in;l=new Date(Date.now()+b*1e3).toLocaleString()}return(0,TG.jsxs)("div",{children:[(0,TG.jsxs)("span",{className:"text-sm",children:["You've reached the current usage cap for ",(0,TG.jsx)("b",{children:"GPT-4"}),". You can continue with the default model now, or try again after ",l,"."]}),(0,TG.jsxs)("div",{className:"mt-4 flex gap-1",children:[(0,TG.jsx)(oF,{}),(0,TG.jsx)(Tu,{text:"Switch to the API",url:"chrome-extension://cbgecfllfhmmnknmamkejadjmnmpfjmp/options/index.html"})]})]})}static formatSubscriptionExpiredError(){return(0,TG.jsxs)("div",{children:[(0,TG.jsx)("span",{className:"text-sm",children:"Current model only available for paid users. You can continue with the default model now, or renew your ChatGPT subscription."}),(0,TG.jsx)("div",{className:"mt-4 flex gap-1",children:(0,TG.jsx)(oF,{})})]})}},uh=XF;var Sn=el(RG());function Rh({error:I,resetErrorBoundary:G}){return console.log("error"),(0,Sn.jsxs)("div",{role:"alert",children:[(0,Sn.jsx)("p",{children:"Something went wrong:"}),(0,Sn.jsx)("pre",{children:I?.message}),(0,Sn.jsx)("button",{className:"rounded bg-primary-500 px-2 py-1 text-sm font-semibold text-white shadow-sm hover:bg-primary-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-500",onClick:G,children:"Try again"})]})}var _a=el(IG());var oh=el(uc());var Fb=el(RG());async function Fk(){let{rated:I}=await oh.default.storage.local.get(["rated"]);return!I}function iF(){let[I,G]=(0,_a.useState)(!1),[l,b]=(0,_a.useState)(null),[d,e]=(0,_a.useState)(null),[t,W]=(0,_a.useState)(!0),n=async s=>{b(s.target.value),s.target.value>3?window.open(ln+"/reviews","_blank"):window.open(ln+"/support","_blank"),W(!1),await oh.default.storage.local.set({rated:!0}),yb.remove("rate")};return(0,_a.useEffect)(()=>{Fk().then(s=>G(s))},[]),(0,Fb.jsx)("div",{className:`flex gap-2 ${t?"":"hidden"}`,children:I?(0,Fb.jsxs)(Fb.Fragment,{children:[(0,Fb.jsx)("span",{className:"italic",children:oh.default.i18n.getMessage("rateExtensionInWebstore")}),(0,Fb.jsx)("div",{className:"flex items-center",children:[...Array(5)].map((s,N)=>{let m=N+1;return(0,Fb.jsxs)("label",{children:[(0,Fb.jsx)("input",{className:"hidden",type:"radio",name:"rating",value:m,onClick:n}),(0,Fb.jsx)("svg",{className:`h-4 w-4 cursor-pointer transition-colors duration-200 ${m<=(d||l||0)?"text-yellow-500":"text-gray-300"}`,viewBox:"0 0 53.867 53.867",fill:"currentColor",onMouseEnter:()=>e(m),onMouseLeave:()=>e(null),children:(0,Fb.jsx)("polygon",{points:"26.934,1.318 35.256,18.182 53.867,20.887 40.4,34.013 43.579,52.549 26.934,43.798 10.288,52.549 13.467,34.013 0,20.887 18.611,18.182 "})})]},N)})})]}):(0,Fb.jsxs)("span",{className:"flex items-center gap-1",children:[(0,Fb.jsx)("span",{className:"text-xl",children:"\u{1F929}"}),(0,Fb.jsx)("span",{dangerouslySetInnerHTML:{__html:oh.default.i18n.getMessage("recommendExtension").replaceAll("<a>",`<a href="${ln}" target="_blank" rel="noreferrer" style="text-decoration: underline">`)}}),(0,Fb.jsx)("span",{className:"text-xl text-red-500",children:"\u2763"})]})})}var oE=el(IG());var FE=(0,oE.memo)(Mn,(I,G)=>I.children===G.children);var g1=el(q2()),Im=el(IG()),t2=el(uc());function kc(){return kc=Object.assign?Object.assign.bind():function(I){for(var G=1;G<arguments.length;G++){var l=arguments[G];for(var b in l)Object.prototype.hasOwnProperty.call(l,b)&&(I[b]=l[b])}return I},kc.apply(this,arguments)}var $l=el(IG(),1);function Kd(I,G,{checkForDefaultPrevented:l=!0}={}){return function(d){if(I?.(d),l===!1||!d.defaultPrevented)return G?.(d)}}var XE=el(IG(),1);function Xk(I,G){typeof I=="function"?I(G):I!=null&&(I.current=G)}function QF(...I){return G=>I.forEach(l=>Xk(l,G))}function YZ(...I){return(0,XE.useCallback)(QF(...I),I)}var Td=el(IG(),1);function fu(I,G=[]){let l=[];function b(e,t){let W=(0,Td.createContext)(t),n=l.length;l=[...l,t];function s(m){let{scope:h,children:V,...X}=m,p=h?.[I][n]||W,F=(0,Td.useMemo)(()=>X,Object.values(X));return(0,Td.createElement)(p.Provider,{value:F},V)}function N(m,h){let V=h?.[I][n]||W,X=(0,Td.useContext)(V);if(X)return X;if(t!==void 0)return t;throw new Error(`\`${m}\` must be used within \`${e}\``)}return s.displayName=e+"Provider",[s,N]}let d=()=>{let e=l.map(t=>(0,Td.createContext)(t));return function(W){let n=W?.[I]||e;return(0,Td.useMemo)(()=>({[`__scope${I}`]:{...W,[I]:n}}),[W,n])}};return d.scopeName=I,[b,ik(d,...G)]}function ik(...I){let G=I[0];if(I.length===1)return G;let l=()=>{let b=I.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(e){let t=b.reduce((W,{useScope:n,scopeName:s})=>{let m=n(e)[`__scope${s}`];return{...W,...m}},{});return(0,Td.useMemo)(()=>({[`__scope${G.scopeName}`]:t}),[t])}};return l.scopeName=G.scopeName,l}var Kc=el(IG(),1);var Dn=el(IG(),1),iE=el(f2(),1);var Ec=el(IG(),1);var rF=(0,Ec.forwardRef)((I,G)=>{let{children:l,...b}=I,d=Ec.Children.toArray(l),e=d.find(Qk);if(e){let t=e.props.children,W=d.map(n=>n===e?Ec.Children.count(t)>1?Ec.Children.only(null):(0,Ec.isValidElement)(t)?t.props.children:null:n);return(0,Ec.createElement)(HF,kc({},b,{ref:G}),(0,Ec.isValidElement)(t)?(0,Ec.cloneElement)(t,void 0,W):null)}return(0,Ec.createElement)(HF,kc({},b,{ref:G}),l)});rF.displayName="Slot";var HF=(0,Ec.forwardRef)((I,G)=>{let{children:l,...b}=I;return(0,Ec.isValidElement)(l)?(0,Ec.cloneElement)(l,{...Hk(b,l.props),ref:G?QF(G,l.ref):l.ref}):Ec.Children.count(l)>1?Ec.Children.only(null):null});HF.displayName="SlotClone";var wF=({children:I})=>(0,Ec.createElement)(Ec.Fragment,null,I);function Qk(I){return(0,Ec.isValidElement)(I)&&I.type===wF}function Hk(I,G){let l={...G};for(let b in G){let d=I[b],e=G[b];/^on[A-Z]/.test(b)?d&&e?l[b]=(...W)=>{e(...W),d(...W)}:d&&(l[b]=d):b==="style"?l[b]={...d,...e}:b==="className"&&(l[b]=[d,e].filter(Boolean).join(" "))}return{...I,...l}}var rk=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],TZ=rk.reduce((I,G)=>{let l=(0,Dn.forwardRef)((b,d)=>{let{asChild:e,...t}=b,W=e?rF:G;return(0,Dn.useEffect)(()=>{window[Symbol.for("radix-ui")]=!0},[]),(0,Dn.createElement)(W,kc({},t,{ref:d}))});return l.displayName=`Primitive.${G}`,{...I,[G]:l}},{});function QE(I,G){I&&(0,iE.flushSync)(()=>I.dispatchEvent(G))}var qn=el(IG(),1);function hZ(I){let G=(0,qn.useRef)(I);return(0,qn.useEffect)(()=>{G.current=I}),(0,qn.useMemo)(()=>(...l)=>{var b;return(b=G.current)===null||b===void 0?void 0:b.call(G,...l)},[])}var HE=el(IG(),1);function rE(I,G=globalThis?.document){let l=hZ(I);(0,HE.useEffect)(()=>{let b=d=>{d.key==="Escape"&&l(d)};return G.addEventListener("keydown",b),()=>G.removeEventListener("keydown",b)},[l,G])}var vF="dismissableLayer.update",wk="dismissableLayer.pointerDownOutside",vk="dismissableLayer.focusOutside",wE,Ek=(0,Kc.createContext)({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),EE=(0,Kc.forwardRef)((I,G)=>{var l;let{disableOutsidePointerEvents:b=!1,onEscapeKeyDown:d,onPointerDownOutside:e,onFocusOutside:t,onInteractOutside:W,onDismiss:n,...s}=I,N=(0,Kc.useContext)(Ek),[m,h]=(0,Kc.useState)(null),V=(l=m?.ownerDocument)!==null&&l!==void 0?l:globalThis?.document,[,X]=(0,Kc.useState)({}),p=YZ(G,C=>h(C)),F=Array.from(N.layers),[a]=[...N.layersWithOutsidePointerEventsDisabled].slice(-1),u=F.indexOf(a),Q=m?F.indexOf(m):-1,o=N.layersWithOutsidePointerEventsDisabled.size>0,y=Q>=u,H=yk(C=>{let T=C.target,S=[...N.branches].some(cI=>cI.contains(T));!y||S||(e?.(C),W?.(C),C.defaultPrevented||n?.())},V),E=gk(C=>{let T=C.target;[...N.branches].some(cI=>cI.contains(T))||(t?.(C),W?.(C),C.defaultPrevented||n?.())},V);return rE(C=>{Q===N.layers.size-1&&(d?.(C),!C.defaultPrevented&&n&&(C.preventDefault(),n()))},V),(0,Kc.useEffect)(()=>{if(m)return b&&(N.layersWithOutsidePointerEventsDisabled.size===0&&(wE=V.body.style.pointerEvents,V.body.style.pointerEvents="none"),N.layersWithOutsidePointerEventsDisabled.add(m)),N.layers.add(m),vE(),()=>{b&&N.layersWithOutsidePointerEventsDisabled.size===1&&(V.body.style.pointerEvents=wE)}},[m,V,b,N]),(0,Kc.useEffect)(()=>()=>{m&&(N.layers.delete(m),N.layersWithOutsidePointerEventsDisabled.delete(m),vE())},[m,N]),(0,Kc.useEffect)(()=>{let C=()=>X({});return document.addEventListener(vF,C),()=>document.removeEventListener(vF,C)},[]),(0,Kc.createElement)(TZ.div,kc({},s,{ref:p,style:{pointerEvents:o?y?"auto":"none":void 0,...I.style},onFocusCapture:Kd(I.onFocusCapture,E.onFocusCapture),onBlurCapture:Kd(I.onBlurCapture,E.onBlurCapture),onPointerDownCapture:Kd(I.onPointerDownCapture,H.onPointerDownCapture)}))});function yk(I,G=globalThis?.document){let l=hZ(I),b=(0,Kc.useRef)(!1),d=(0,Kc.useRef)(()=>{});return(0,Kc.useEffect)(()=>{let e=W=>{if(W.target&&!b.current){let s=function(){yE(wk,l,n,{discrete:!0})},n={originalEvent:W};W.pointerType==="touch"?(G.removeEventListener("click",d.current),d.current=s,G.addEventListener("click",d.current,{once:!0})):s()}else G.removeEventListener("click",d.current);b.current=!1},t=window.setTimeout(()=>{G.addEventListener("pointerdown",e)},0);return()=>{window.clearTimeout(t),G.removeEventListener("pointerdown",e),G.removeEventListener("click",d.current)}},[G,l]),{onPointerDownCapture:()=>b.current=!0}}function gk(I,G=globalThis?.document){let l=hZ(I),b=(0,Kc.useRef)(!1);return(0,Kc.useEffect)(()=>{let d=e=>{e.target&&!b.current&&yE(vk,l,{originalEvent:e},{discrete:!1})};return G.addEventListener("focusin",d),()=>G.removeEventListener("focusin",d)},[G,l]),{onFocusCapture:()=>b.current=!0,onBlurCapture:()=>b.current=!1}}function vE(){let I=new CustomEvent(vF);document.dispatchEvent(I)}function yE(I,G,l,{discrete:b}){let d=l.originalEvent.target,e=new CustomEvent(I,{bubbles:!1,cancelable:!0,detail:l});G&&d.addEventListener(I,G,{once:!0}),b?QE(d,e):d.dispatchEvent(e)}var Su=el(IG(),1);var gE=el(IG(),1),VZ=globalThis?.document?gE.useLayoutEffect:()=>{};var Jk=Su.useId||(()=>{}),Ck=0;function JE(I){let[G,l]=Su.useState(Jk());return VZ(()=>{I||l(b=>b??String(Ck++))},[I]),I||(G?`radix-${G}`:"")}var eb=el(IG(),1);var CE=["top","right","bottom","left"];var pZ=Math.min,Ab=Math.max,Xh=Math.round,ih=Math.floor,fZ=I=>({x:I,y:I}),Ak={left:"right",right:"left",bottom:"top",top:"bottom"},Lk={start:"end",end:"start"};function qu(I,G,l){return Ab(I,pZ(G,l))}function uZ(I,G){return typeof I=="function"?I(G):I}function RZ(I){return I.split("-")[0]}function Pa(I){return I.split("-")[1]}function _u(I){return I==="x"?"y":"x"}function Pu(I){return I==="y"?"height":"width"}function $a(I){return["top","bottom"].includes(RZ(I))?"y":"x"}function $u(I){return _u($a(I))}function AE(I,G,l){l===void 0&&(l=!1);let b=Pa(I),d=$u(I),e=Pu(d),t=d==="x"?b===(l?"end":"start")?"right":"left":b==="start"?"bottom":"top";return G.reference[e]>G.floating[e]&&(t=Fh(t)),[t,Fh(t)]}function LE(I){let G=Fh(I);return[Du(I),G,Du(G)]}function Du(I){return I.replace(/start|end/g,G=>Lk[G])}function kk(I,G,l){let b=["left","right"],d=["right","left"],e=["top","bottom"],t=["bottom","top"];switch(I){case"top":case"bottom":return l?G?d:b:G?b:d;case"left":case"right":return G?e:t;default:return[]}}function kE(I,G,l,b){let d=Pa(I),e=kk(RZ(I),l==="start",b);return d&&(e=e.map(t=>t+"-"+d),G&&(e=e.concat(e.map(Du)))),e}function Fh(I){return I.replace(/left|right|bottom|top/g,G=>Ak[G])}function xk(I){return{top:0,right:0,bottom:0,left:0,...I}}function EF(I){return typeof I!="number"?xk(I):{top:I,right:I,bottom:I,left:I}}function IW(I){return{...I,top:I.y,left:I.x,right:I.x+I.width,bottom:I.y+I.height}}function xE(I,G,l){let{reference:b,floating:d}=I,e=$a(G),t=$u(G),W=Pu(t),n=RZ(G),s=e==="y",N=b.x+b.width/2-d.width/2,m=b.y+b.height/2-d.height/2,h=b[W]/2-d[W]/2,V;switch(n){case"top":V={x:N,y:b.y-d.height};break;case"bottom":V={x:N,y:b.y+b.height};break;case"right":V={x:b.x+b.width,y:m};break;case"left":V={x:b.x-d.width,y:m};break;default:V={x:b.x,y:b.y}}switch(Pa(G)){case"start":V[t]-=h*(l&&s?-1:1);break;case"end":V[t]+=h*(l&&s?-1:1);break}return V}var ME=async(I,G,l)=>{let{placement:b="bottom",strategy:d="absolute",middleware:e=[],platform:t}=l,W=e.filter(Boolean),n=await(t.isRTL==null?void 0:t.isRTL(G)),s=await t.getElementRects({reference:I,floating:G,strategy:d}),{x:N,y:m}=xE(s,b,n),h=b,V={},X=0;for(let p=0;p<W.length;p++){let{name:F,fn:a}=W[p],{x:u,y:Q,data:o,reset:y}=await a({x:N,y:m,initialPlacement:b,placement:h,strategy:d,middlewareData:V,rects:s,platform:t,elements:{reference:I,floating:G}});if(N=u??N,m=Q??m,V={...V,[F]:{...V[F],...o}},y&&X<=50){X++,typeof y=="object"&&(y.placement&&(h=y.placement),y.rects&&(s=y.rects===!0?await t.getElementRects({reference:I,floating:G,strategy:d}):y.rects),{x:N,y:m}=xE(s,h,n)),p=-1;continue}}return{x:N,y:m,placement:h,strategy:d,middlewareData:V}};async function lW(I,G){var l;G===void 0&&(G={});let{x:b,y:d,platform:e,rects:t,elements:W,strategy:n}=I,{boundary:s="clippingAncestors",rootBoundary:N="viewport",elementContext:m="floating",altBoundary:h=!1,padding:V=0}=uZ(G,I),X=EF(V),F=W[h?m==="floating"?"reference":"floating":m],a=IW(await e.getClippingRect({element:(l=await(e.isElement==null?void 0:e.isElement(F)))==null||l?F:F.contextElement||await(e.getDocumentElement==null?void 0:e.getDocumentElement(W.floating)),boundary:s,rootBoundary:N,strategy:n})),u=m==="floating"?{...t.floating,x:b,y:d}:t.reference,Q=await(e.getOffsetParent==null?void 0:e.getOffsetParent(W.floating)),o=await(e.isElement==null?void 0:e.isElement(Q))?await(e.getScale==null?void 0:e.getScale(Q))||{x:1,y:1}:{x:1,y:1},y=IW(e.convertOffsetParentRelativeRectToViewportRelativeRect?await e.convertOffsetParentRelativeRectToViewportRelativeRect({rect:u,offsetParent:Q,strategy:n}):u);return{top:(a.top-y.top+X.top)/o.y,bottom:(y.bottom-a.bottom+X.bottom)/o.y,left:(a.left-y.left+X.left)/o.x,right:(y.right-a.right+X.right)/o.x}}var BE=I=>({name:"arrow",options:I,async fn(G){let{x:l,y:b,placement:d,rects:e,platform:t,elements:W,middlewareData:n}=G,{element:s,padding:N=0}=uZ(I,G)||{};if(s==null)return{};let m=EF(N),h={x:l,y:b},V=$u(d),X=Pu(V),p=await t.getDimensions(s),F=V==="y",a=F?"top":"left",u=F?"bottom":"right",Q=F?"clientHeight":"clientWidth",o=e.reference[X]+e.reference[V]-h[V]-e.floating[X],y=h[V]-e.reference[V],H=await(t.getOffsetParent==null?void 0:t.getOffsetParent(s)),E=H?H[Q]:0;(!E||!await(t.isElement==null?void 0:t.isElement(H)))&&(E=W.floating[Q]||e.floating[X]);let C=o/2-y/2,T=E/2-p[X]/2-1,S=pZ(m[a],T),cI=pZ(m[u],T),hI=S,WI=E-p[X]-cI,VI=E/2-p[X]/2+C,sI=qu(hI,VI,WI),ZI=!n.arrow&&Pa(d)!=null&&VI!=sI&&e.reference[X]/2-(VI<hI?S:cI)-p[X]/2<0,dI=ZI?VI<hI?VI-hI:VI-WI:0;return{[V]:h[V]+dI,data:{[V]:sI,centerOffset:VI-sI-dI,...ZI&&{alignmentOffset:dI}},reset:ZI}}});var OE=function(I){return I===void 0&&(I={}),{name:"flip",options:I,async fn(G){var l,b;let{placement:d,middlewareData:e,rects:t,initialPlacement:W,platform:n,elements:s}=G,{mainAxis:N=!0,crossAxis:m=!0,fallbackPlacements:h,fallbackStrategy:V="bestFit",fallbackAxisSideDirection:X="none",flipAlignment:p=!0,...F}=uZ(I,G);if((l=e.arrow)!=null&&l.alignmentOffset)return{};let a=RZ(d),u=RZ(W)===W,Q=await(n.isRTL==null?void 0:n.isRTL(s.floating)),o=h||(u||!p?[Fh(W)]:LE(W));!h&&X!=="none"&&o.push(...kE(W,p,X,Q));let y=[W,...o],H=await lW(G,F),E=[],C=((b=e.flip)==null?void 0:b.overflows)||[];if(N&&E.push(H[a]),m){let hI=AE(d,t,Q);E.push(H[hI[0]],H[hI[1]])}if(C=[...C,{placement:d,overflows:E}],!E.every(hI=>hI<=0)){var T,S;let hI=(((T=e.flip)==null?void 0:T.index)||0)+1,WI=y[hI];if(WI)return{data:{index:hI,overflows:C},reset:{placement:WI}};let VI=(S=C.filter(sI=>sI.overflows[0]<=0).sort((sI,ZI)=>sI.overflows[1]-ZI.overflows[1])[0])==null?void 0:S.placement;if(!VI)switch(V){case"bestFit":{var cI;let sI=(cI=C.map(ZI=>[ZI.placement,ZI.overflows.filter(dI=>dI>0).reduce((dI,pI)=>dI+pI,0)]).sort((ZI,dI)=>ZI[1]-dI[1])[0])==null?void 0:cI[0];sI&&(VI=sI);break}case"initialPlacement":VI=W;break}if(d!==VI)return{reset:{placement:VI}}}return{}}}};function zE(I,G){return{top:I.top-G.height,right:I.right-G.width,bottom:I.bottom-G.height,left:I.left-G.width}}function UE(I){return CE.some(G=>I[G]>=0)}var jE=function(I){return I===void 0&&(I={}),{name:"hide",options:I,async fn(G){let{rects:l}=G,{strategy:b="referenceHidden",...d}=uZ(I,G);switch(b){case"referenceHidden":{let e=await lW(G,{...d,elementContext:"reference"}),t=zE(e,l.reference);return{data:{referenceHiddenOffsets:t,referenceHidden:UE(t)}}}case"escaped":{let e=await lW(G,{...d,altBoundary:!0}),t=zE(e,l.floating);return{data:{escapedOffsets:t,escaped:UE(t)}}}default:return{}}}}};async function zk(I,G){let{placement:l,platform:b,elements:d}=I,e=await(b.isRTL==null?void 0:b.isRTL(d.floating)),t=RZ(l),W=Pa(l),n=$a(l)==="y",s=["left","top"].includes(t)?-1:1,N=e&&n?-1:1,m=uZ(G,I),{mainAxis:h,crossAxis:V,alignmentAxis:X}=typeof m=="number"?{mainAxis:m,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...m};return W&&typeof X=="number"&&(V=W==="end"?X*-1:X),n?{x:V*N,y:h*s}:{x:h*s,y:V*N}}var I2=function(I){return I===void 0&&(I=0),{name:"offset",options:I,async fn(G){var l,b;let{x:d,y:e,placement:t,middlewareData:W}=G,n=await zk(G,I);return t===((l=W.offset)==null?void 0:l.placement)&&(b=W.arrow)!=null&&b.alignmentOffset?{}:{x:d+n.x,y:e+n.y,data:{...n,placement:t}}}}},KE=function(I){return I===void 0&&(I={}),{name:"shift",options:I,async fn(G){let{x:l,y:b,placement:d}=G,{mainAxis:e=!0,crossAxis:t=!1,limiter:W={fn:F=>{let{x:a,y:u}=F;return{x:a,y:u}}},...n}=uZ(I,G),s={x:l,y:b},N=await lW(G,n),m=$a(RZ(d)),h=_u(m),V=s[h],X=s[m];if(e){let F=h==="y"?"top":"left",a=h==="y"?"bottom":"right",u=V+N[F],Q=V-N[a];V=qu(u,V,Q)}if(t){let F=m==="y"?"top":"left",a=m==="y"?"bottom":"right",u=X+N[F],Q=X-N[a];X=qu(u,X,Q)}let p=W.fn({...G,[h]:V,[m]:X});return{...p,data:{x:p.x-l,y:p.y-b}}}}},TE=function(I){return I===void 0&&(I={}),{options:I,fn(G){let{x:l,y:b,placement:d,rects:e,middlewareData:t}=G,{offset:W=0,mainAxis:n=!0,crossAxis:s=!0}=uZ(I,G),N={x:l,y:b},m=$a(d),h=_u(m),V=N[h],X=N[m],p=uZ(W,G),F=typeof p=="number"?{mainAxis:p,crossAxis:0}:{mainAxis:0,crossAxis:0,...p};if(n){let Q=h==="y"?"height":"width",o=e.reference[h]-e.floating[Q]+F.mainAxis,y=e.reference[h]+e.reference[Q]-F.mainAxis;V<o?V=o:V>y&&(V=y)}if(s){var a,u;let Q=h==="y"?"width":"height",o=["top","left"].includes(RZ(d)),y=e.reference[m]-e.floating[Q]+(o&&((a=t.offset)==null?void 0:a[m])||0)+(o?0:F.crossAxis),H=e.reference[m]+e.reference[Q]+(o?0:((u=t.offset)==null?void 0:u[m])||0)-(o?F.crossAxis:0);X<y?X=y:X>H&&(X=H)}return{[h]:V,[m]:X}}}},fE=function(I){return I===void 0&&(I={}),{name:"size",options:I,async fn(G){let{placement:l,rects:b,platform:d,elements:e}=G,{apply:t=()=>{},...W}=uZ(I,G),n=await lW(G,W),s=RZ(l),N=Pa(l),m=$a(l)==="y",{width:h,height:V}=b.floating,X,p;s==="top"||s==="bottom"?(X=s,p=N===(await(d.isRTL==null?void 0:d.isRTL(e.floating))?"start":"end")?"left":"right"):(p=s,X=N==="end"?"top":"bottom");let F=V-n[X],a=h-n[p],u=!G.middlewareData.shift,Q=F,o=a;if(m){let H=h-n.left-n.right;o=N||u?pZ(a,H):H}else{let H=V-n.top-n.bottom;Q=N||u?pZ(F,H):H}if(u&&!N){let H=Ab(n.left,0),E=Ab(n.right,0),C=Ab(n.top,0),T=Ab(n.bottom,0);m?o=h-2*(H!==0||E!==0?H+E:Ab(n.left,n.right)):Q=V-2*(C!==0||T!==0?C+T:Ab(n.top,n.bottom))}await t({...G,availableWidth:o,availableHeight:Q});let y=await d.getDimensions(e.floating);return h!==y.width||V!==y.height?{reset:{rects:!0}}:{}}}};function SZ(I){return DE(I)?(I.nodeName||"").toLowerCase():"#document"}function Tb(I){var G;return(I==null||(G=I.ownerDocument)==null?void 0:G.defaultView)||window}function oZ(I){var G;return(G=(DE(I)?I.ownerDocument:I.document)||window.document)==null?void 0:G.documentElement}function DE(I){return I instanceof Node||I instanceof Tb(I).Node}function FZ(I){return I instanceof Element||I instanceof Tb(I).Element}function fd(I){return I instanceof HTMLElement||I instanceof Tb(I).HTMLElement}function SE(I){return typeof ShadowRoot>"u"?!1:I instanceof ShadowRoot||I instanceof Tb(I).ShadowRoot}function _n(I){let{overflow:G,overflowX:l,overflowY:b,display:d}=ed(I);return/auto|scroll|overlay|hidden|clip/.test(G+b+l)&&!["inline","contents"].includes(d)}function qE(I){return["table","td","th"].includes(SZ(I))}function l2(I){let G=G2(),l=ed(I);return l.transform!=="none"||l.perspective!=="none"||(l.containerType?l.containerType!=="normal":!1)||!G&&(l.backdropFilter?l.backdropFilter!=="none":!1)||!G&&(l.filter?l.filter!=="none":!1)||["transform","perspective","filter"].some(b=>(l.willChange||"").includes(b))||["paint","layout","strict","content"].some(b=>(l.contain||"").includes(b))}function _E(I){let G=GW(I);for(;fd(G)&&!Qh(G);){if(l2(G))return G;G=GW(G)}return null}function G2(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Qh(I){return["html","body","#document"].includes(SZ(I))}function ed(I){return Tb(I).getComputedStyle(I)}function Hh(I){return FZ(I)?{scrollLeft:I.scrollLeft,scrollTop:I.scrollTop}:{scrollLeft:I.pageXOffset,scrollTop:I.pageYOffset}}function GW(I){if(SZ(I)==="html")return I;let G=I.assignedSlot||I.parentNode||SE(I)&&I.host||oZ(I);return SE(G)?G.host:G}function PE(I){let G=GW(I);return Qh(G)?I.ownerDocument?I.ownerDocument.body:I.body:fd(G)&&_n(G)?G:PE(G)}function cW(I,G,l){var b;G===void 0&&(G=[]),l===void 0&&(l=!0);let d=PE(I),e=d===((b=I.ownerDocument)==null?void 0:b.body),t=Tb(d);return e?G.concat(t,t.visualViewport||[],_n(d)?d:[],t.frameElement&&l?cW(t.frameElement):[]):G.concat(d,cW(d,[],l))}function l1(I){let G=ed(I),l=parseFloat(G.width)||0,b=parseFloat(G.height)||0,d=fd(I),e=d?I.offsetWidth:l,t=d?I.offsetHeight:b,W=Xh(l)!==e||Xh(b)!==t;return W&&(l=e,b=t),{width:l,height:b,$:W}}function yF(I){return FZ(I)?I:I.contextElement}function Pn(I){let G=yF(I);if(!fd(G))return fZ(1);let l=G.getBoundingClientRect(),{width:b,height:d,$:e}=l1(G),t=(e?Xh(l.width):l.width)/b,W=(e?Xh(l.height):l.height)/d;return(!t||!Number.isFinite(t))&&(t=1),(!W||!Number.isFinite(W))&&(W=1),{x:t,y:W}}var Uk=fZ(0);function G1(I){let G=Tb(I);return!G2()||!G.visualViewport?Uk:{x:G.visualViewport.offsetLeft,y:G.visualViewport.offsetTop}}function Mk(I,G,l){return G===void 0&&(G=!1),!l||G&&l!==Tb(I)?!1:G}function bW(I,G,l,b){G===void 0&&(G=!1),l===void 0&&(l=!1);let d=I.getBoundingClientRect(),e=yF(I),t=fZ(1);G&&(b?FZ(b)&&(t=Pn(b)):t=Pn(I));let W=Mk(e,l,b)?G1(e):fZ(0),n=(d.left+W.x)/t.x,s=(d.top+W.y)/t.y,N=d.width/t.x,m=d.height/t.y;if(e){let h=Tb(e),V=b&&FZ(b)?Tb(b):b,X=h.frameElement;for(;X&&b&&V!==h;){let p=Pn(X),F=X.getBoundingClientRect(),a=ed(X),u=F.left+(X.clientLeft+parseFloat(a.paddingLeft))*p.x,Q=F.top+(X.clientTop+parseFloat(a.paddingTop))*p.y;n*=p.x,s*=p.y,N*=p.x,m*=p.y,n+=u,s+=Q,X=Tb(X).frameElement}}return IW({width:N,height:m,x:n,y:s})}function Bk(I){let{rect:G,offsetParent:l,strategy:b}=I,d=fd(l),e=oZ(l);if(l===e)return G;let t={scrollLeft:0,scrollTop:0},W=fZ(1),n=fZ(0);if((d||!d&&b!=="fixed")&&((SZ(l)!=="body"||_n(e))&&(t=Hh(l)),fd(l))){let s=bW(l);W=Pn(l),n.x=s.x+l.clientLeft,n.y=s.y+l.clientTop}return{width:G.width*W.x,height:G.height*W.y,x:G.x*W.x-t.scrollLeft*W.x+n.x,y:G.y*W.y-t.scrollTop*W.y+n.y}}function Ok(I){return Array.from(I.getClientRects())}function c1(I){return bW(oZ(I)).left+Hh(I).scrollLeft}function jk(I){let G=oZ(I),l=Hh(I),b=I.ownerDocument.body,d=Ab(G.scrollWidth,G.clientWidth,b.scrollWidth,b.clientWidth),e=Ab(G.scrollHeight,G.clientHeight,b.scrollHeight,b.clientHeight),t=-l.scrollLeft+c1(I),W=-l.scrollTop;return ed(b).direction==="rtl"&&(t+=Ab(G.clientWidth,b.clientWidth)-d),{width:d,height:e,x:t,y:W}}function Kk(I,G){let l=Tb(I),b=oZ(I),d=l.visualViewport,e=b.clientWidth,t=b.clientHeight,W=0,n=0;if(d){e=d.width,t=d.height;let s=G2();(!s||s&&G==="fixed")&&(W=d.offsetLeft,n=d.offsetTop)}return{width:e,height:t,x:W,y:n}}function Tk(I,G){let l=bW(I,!0,G==="fixed"),b=l.top+I.clientTop,d=l.left+I.clientLeft,e=fd(I)?Pn(I):fZ(1),t=I.clientWidth*e.x,W=I.clientHeight*e.y,n=d*e.x,s=b*e.y;return{width:t,height:W,x:n,y:s}}function $E(I,G,l){let b;if(G==="viewport")b=Kk(I,l);else if(G==="document")b=jk(oZ(I));else if(FZ(G))b=Tk(G,l);else{let d=G1(I);b={...G,x:G.x-d.x,y:G.y-d.y}}return IW(b)}function b1(I,G){let l=GW(I);return l===G||!FZ(l)||Qh(l)?!1:ed(l).position==="fixed"||b1(l,G)}function fk(I,G){let l=G.get(I);if(l)return l;let b=cW(I,[],!1).filter(W=>FZ(W)&&SZ(W)!=="body"),d=null,e=ed(I).position==="fixed",t=e?GW(I):I;for(;FZ(t)&&!Qh(t);){let W=ed(t),n=l2(t);!n&&W.position==="fixed"&&(d=null),(e?!n&&!d:!n&&W.position==="static"&&!!d&&["absolute","fixed"].includes(d.position)||_n(t)&&!n&&b1(I,t))?b=b.filter(N=>N!==t):d=W,t=GW(t)}return G.set(I,b),b}function Sk(I){let{element:G,boundary:l,rootBoundary:b,strategy:d}=I,t=[...l==="clippingAncestors"?fk(G,this._c):[].concat(l),b],W=t[0],n=t.reduce((s,N)=>{let m=$E(G,N,d);return s.top=Ab(m.top,s.top),s.right=pZ(m.right,s.right),s.bottom=pZ(m.bottom,s.bottom),s.left=Ab(m.left,s.left),s},$E(G,W,d));return{width:n.right-n.left,height:n.bottom-n.top,x:n.left,y:n.top}}function Dk(I){let{width:G,height:l}=l1(I);return{width:G,height:l}}function qk(I,G,l){let b=fd(G),d=oZ(G),e=l==="fixed",t=bW(I,!0,e,G),W={scrollLeft:0,scrollTop:0},n=fZ(0);if(b||!b&&!e)if((SZ(G)!=="body"||_n(d))&&(W=Hh(G)),b){let s=bW(G,!0,e,G);n.x=s.x+G.clientLeft,n.y=s.y+G.clientTop}else d&&(n.x=c1(d));return{x:t.left+W.scrollLeft-n.x,y:t.top+W.scrollTop-n.y,width:t.width,height:t.height}}function I1(I,G){return!fd(I)||ed(I).position==="fixed"?null:G?G(I):I.offsetParent}function d1(I,G){let l=Tb(I);if(!fd(I))return l;let b=I1(I,G);for(;b&&qE(b)&&ed(b).position==="static";)b=I1(b,G);return b&&(SZ(b)==="html"||SZ(b)==="body"&&ed(b).position==="static"&&!l2(b))?l:b||_E(I)||l}var _k=async function(I){let{reference:G,floating:l,strategy:b}=I,d=this.getOffsetParent||d1,e=this.getDimensions;return{reference:qk(G,await d(l),b),floating:{x:0,y:0,...await e(l)}}};function Pk(I){return ed(I).direction==="rtl"}var Z1={convertOffsetParentRelativeRectToViewportRelativeRect:Bk,getDocumentElement:oZ,getClippingRect:Sk,getOffsetParent:d1,getElementRects:_k,getClientRects:Ok,getDimensions:Dk,getScale:Pn,isElement:FZ,isRTL:Pk};function $k(I,G){let l=null,b,d=oZ(I);function e(){clearTimeout(b),l&&l.disconnect(),l=null}function t(W,n){W===void 0&&(W=!1),n===void 0&&(n=1),e();let{left:s,top:N,width:m,height:h}=I.getBoundingClientRect();if(W||G(),!m||!h)return;let V=ih(N),X=ih(d.clientWidth-(s+m)),p=ih(d.clientHeight-(N+h)),F=ih(s),u={rootMargin:-V+"px "+-X+"px "+-p+"px "+-F+"px",threshold:Ab(0,pZ(1,n))||1},Q=!0;function o(y){let H=y[0].intersectionRatio;if(H!==n){if(!Q)return t();H?t(!1,H):b=setTimeout(()=>{t(!1,1e-7)},100)}Q=!1}try{l=new IntersectionObserver(o,{...u,root:d.ownerDocument})}catch{l=new IntersectionObserver(o,u)}l.observe(I)}return t(!0),e}function gF(I,G,l,b){b===void 0&&(b={});let{ancestorScroll:d=!0,ancestorResize:e=!0,elementResize:t=typeof ResizeObserver=="function",layoutShift:W=typeof IntersectionObserver=="function",animationFrame:n=!1}=b,s=yF(I),N=d||e?[...s?cW(s):[],...cW(G)]:[];N.forEach(a=>{d&&a.addEventListener("scroll",l,{passive:!0}),e&&a.addEventListener("resize",l)});let m=s&&W?$k(s,l):null,h=-1,V=null;t&&(V=new ResizeObserver(a=>{let[u]=a;u&&u.target===s&&V&&(V.unobserve(G),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{V&&V.observe(G)})),l()}),s&&!n&&V.observe(s),V.observe(G));let X,p=n?bW(I):null;n&&F();function F(){let a=bW(I);p&&(a.x!==p.x||a.y!==p.y||a.width!==p.width||a.height!==p.height)&&l(),p=a,X=requestAnimationFrame(F)}return l(),()=>{N.forEach(a=>{d&&a.removeEventListener("scroll",l),e&&a.removeEventListener("resize",l)}),m&&m(),V&&V.disconnect(),V=null,n&&cancelAnimationFrame(X)}}var JF=KE,CF=OE,AF=fE,LF=jE,kF=BE;var xF=TE,zF=(I,G,l)=>{let b=new Map,d={platform:Z1,...l},e={...d.platform,_c:b};return ME(I,G,{...d,platform:e})};var Dc=el(IG(),1),d2=el(IG(),1),W1=el(f2(),1),t1=I=>{function G(l){return{}.hasOwnProperty.call(l,"current")}return{name:"arrow",options:I,fn(l){let{element:b,padding:d}=typeof I=="function"?I(l):I;return b&&G(b)?b.current!=null?kF({element:b.current,padding:d}).fn(l):{}:b?kF({element:b,padding:d}).fn(l):{}}}},c2=typeof document<"u"?d2.useLayoutEffect:d2.useEffect;function b2(I,G){if(I===G)return!0;if(typeof I!=typeof G)return!1;if(typeof I=="function"&&I.toString()===G.toString())return!0;let l,b,d;if(I&&G&&typeof I=="object"){if(Array.isArray(I)){if(l=I.length,l!=G.length)return!1;for(b=l;b--!==0;)if(!b2(I[b],G[b]))return!1;return!0}if(d=Object.keys(I),l=d.length,l!==Object.keys(G).length)return!1;for(b=l;b--!==0;)if(!{}.hasOwnProperty.call(G,d[b]))return!1;for(b=l;b--!==0;){let e=d[b];if(!(e==="_owner"&&I.$$typeof)&&!b2(I[e],G[e]))return!1}return!0}return I!==I&&G!==G}function n1(I){return typeof window>"u"?1:(I.ownerDocument.defaultView||window).devicePixelRatio||1}function e1(I,G){let l=n1(I);return Math.round(G*l)/l}function a1(I){let G=Dc.useRef(I);return c2(()=>{G.current=I}),G}function m1(I){I===void 0&&(I={});let{placement:G="bottom",strategy:l="absolute",middleware:b=[],platform:d,elements:{reference:e,floating:t}={},transform:W=!0,whileElementsMounted:n,open:s}=I,[N,m]=Dc.useState({x:0,y:0,strategy:l,placement:G,middlewareData:{},isPositioned:!1}),[h,V]=Dc.useState(b);b2(h,b)||V(b);let[X,p]=Dc.useState(null),[F,a]=Dc.useState(null),u=Dc.useCallback(ZI=>{ZI!=H.current&&(H.current=ZI,p(ZI))},[p]),Q=Dc.useCallback(ZI=>{ZI!==E.current&&(E.current=ZI,a(ZI))},[a]),o=e||X,y=t||F,H=Dc.useRef(null),E=Dc.useRef(null),C=Dc.useRef(N),T=a1(n),S=a1(d),cI=Dc.useCallback(()=>{if(!H.current||!E.current)return;let ZI={placement:G,strategy:l,middleware:h};S.current&&(ZI.platform=S.current),zF(H.current,E.current,ZI).then(dI=>{let pI={...dI,isPositioned:!0};hI.current&&!b2(C.current,pI)&&(C.current=pI,W1.flushSync(()=>{m(pI)}))})},[h,G,l,S]);c2(()=>{s===!1&&C.current.isPositioned&&(C.current.isPositioned=!1,m(ZI=>({...ZI,isPositioned:!1})))},[s]);let hI=Dc.useRef(!1);c2(()=>(hI.current=!0,()=>{hI.current=!1}),[]),c2(()=>{if(o&&(H.current=o),y&&(E.current=y),o&&y){if(T.current)return T.current(o,y,cI);cI()}},[o,y,cI,T]);let WI=Dc.useMemo(()=>({reference:H,floating:E,setReference:u,setFloating:Q}),[u,Q]),VI=Dc.useMemo(()=>({reference:o,floating:y}),[o,y]),sI=Dc.useMemo(()=>{let ZI={position:l,left:0,top:0};if(!VI.floating)return ZI;let dI=e1(VI.floating,N.x),pI=e1(VI.floating,N.y);return W?{...ZI,transform:"translate("+dI+"px, "+pI+"px)",...n1(VI.floating)>=1.5&&{willChange:"transform"}}:{position:l,left:dI,top:pI}},[l,W,VI.floating,N.x,N.y]);return Dc.useMemo(()=>({...N,update:cI,refs:WI,elements:VI,floatingStyles:sI}),[N,cI,WI,VI,sI])}var N1=el(IG(),1);function s1(I){let[G,l]=(0,N1.useState)(void 0);return VZ(()=>{if(I){l({width:I.offsetWidth,height:I.offsetHeight});let b=new ResizeObserver(d=>{if(!Array.isArray(d)||!d.length)return;let e=d[0],t,W;if("borderBoxSize"in e){let n=e.borderBoxSize,s=Array.isArray(n)?n[0]:n;t=s.inlineSize,W=s.blockSize}else t=I.offsetWidth,W=I.offsetHeight;l({width:t,height:W})});return b.observe(I,{box:"border-box"}),()=>b.unobserve(I)}else l(void 0)},[I]),G}var Y1="Popper",[h1,UF]=fu(Y1),[I3,V1]=h1(Y1),l3=I=>{let{__scopePopper:G,children:l}=I,[b,d]=(0,eb.useState)(null);return(0,eb.createElement)(I3,{scope:G,anchor:b,onAnchorChange:d},l)},G3="PopperAnchor",c3=(0,eb.forwardRef)((I,G)=>{let{__scopePopper:l,virtualRef:b,...d}=I,e=V1(G3,l),t=(0,eb.useRef)(null),W=YZ(G,t);return(0,eb.useEffect)(()=>{e.onAnchorChange(b?.current||t.current)}),b?null:(0,eb.createElement)(TZ.div,kc({},d,{ref:W}))}),p1="PopperContent",[b3,xsI]=h1(p1),d3=(0,eb.forwardRef)((I,G)=>{var l,b,d,e,t,W,n,s;let{__scopePopper:N,side:m="bottom",sideOffset:h=0,align:V="center",alignOffset:X=0,arrowPadding:p=0,avoidCollisions:F=!0,collisionBoundary:a=[],collisionPadding:u=0,sticky:Q="partial",hideWhenDetached:o=!1,updatePositionStrategy:y="optimized",onPlaced:H,...E}=I,C=V1(p1,N),[T,S]=(0,eb.useState)(null),cI=YZ(G,O=>S(O)),[hI,WI]=(0,eb.useState)(null),VI=s1(hI),sI=(l=VI?.width)!==null&&l!==void 0?l:0,ZI=(b=VI?.height)!==null&&b!==void 0?b:0,dI=m+(V!=="center"?"-"+V:""),pI=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},yI=Array.isArray(a)?a:[a],eI=yI.length>0,HI={padding:pI,boundary:yI.filter(Z3),altBoundary:eI},{refs:YI,floatingStyles:$,placement:JI,isPositioned:UI,middlewareData:zI}=m1({strategy:"fixed",placement:dI,whileElementsMounted:(...O)=>gF(...O,{animationFrame:y==="always"}),elements:{reference:C.anchor},middleware:[I2({mainAxis:h+ZI,alignmentAxis:X}),F&&JF({mainAxis:!0,crossAxis:!1,limiter:Q==="partial"?xF():void 0,...HI}),F&&CF({...HI}),AF({...HI,apply:({elements:O,rects:K,availableWidth:q,availableHeight:GI})=>{let{width:tI,height:iI}=K.reference,B=O.floating.style;B.setProperty("--radix-popper-available-width",`${q}px`),B.setProperty("--radix-popper-available-height",`${GI}px`),B.setProperty("--radix-popper-anchor-width",`${tI}px`),B.setProperty("--radix-popper-anchor-height",`${iI}px`)}}),hI&&t1({element:hI,padding:p}),e3({arrowWidth:sI,arrowHeight:ZI}),o&&LF({strategy:"referenceHidden",...HI})]}),[L,bI]=u1(JI),FI=hZ(H);VZ(()=>{UI&&FI?.()},[UI,FI]);let U=(d=zI.arrow)===null||d===void 0?void 0:d.x,k=(e=zI.arrow)===null||e===void 0?void 0:e.y,w=((t=zI.arrow)===null||t===void 0?void 0:t.centerOffset)!==0,[r,A]=(0,eb.useState)();return VZ(()=>{T&&A(window.getComputedStyle(T).zIndex)},[T]),(0,eb.createElement)("div",{ref:YI.setFloating,"data-radix-popper-content-wrapper":"",style:{...$,transform:UI?$.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:r,"--radix-popper-transform-origin":[(W=zI.transformOrigin)===null||W===void 0?void 0:W.x,(n=zI.transformOrigin)===null||n===void 0?void 0:n.y].join(" ")},dir:I.dir},(0,eb.createElement)(b3,{scope:N,placedSide:L,onArrowChange:WI,arrowX:U,arrowY:k,shouldHideArrow:w},(0,eb.createElement)(TZ.div,kc({"data-side":L,"data-align":bI},E,{ref:cI,style:{...E.style,animation:UI?void 0:"none",opacity:(s=zI.hide)!==null&&s!==void 0&&s.referenceHidden?0:void 0}}))))});function Z3(I){return I!==null}var e3=I=>({name:"transformOrigin",options:I,fn(G){var l,b,d,e,t;let{placement:W,rects:n,middlewareData:s}=G,m=((l=s.arrow)===null||l===void 0?void 0:l.centerOffset)!==0,h=m?0:I.arrowWidth,V=m?0:I.arrowHeight,[X,p]=u1(W),F={start:"0%",center:"50%",end:"100%"}[p],a=((b=(d=s.arrow)===null||d===void 0?void 0:d.x)!==null&&b!==void 0?b:0)+h/2,u=((e=(t=s.arrow)===null||t===void 0?void 0:t.y)!==null&&e!==void 0?e:0)+V/2,Q="",o="";return X==="bottom"?(Q=m?F:`${a}px`,o=`${-V}px`):X==="top"?(Q=m?F:`${a}px`,o=`${n.floating.height+V}px`):X==="right"?(Q=`${-V}px`,o=m?F:`${u}px`):X==="left"&&(Q=`${n.floating.width+V}px`,o=m?F:`${u}px`),{data:{x:Q,y:o}}}});function u1(I){let[G,l="center"]=I.split("-");return[G,l]}var R1=l3,o1=c3,F1=d3;var Xb=el(IG(),1),X1=el(f2(),1);function a3(I,G){return(0,Xb.useReducer)((l,b)=>{let d=G[l][b];return d??l},I)}var MF=I=>{let{present:G,children:l}=I,b=W3(G),d=typeof l=="function"?l({present:b.isPresent}):Xb.Children.only(l),e=YZ(b.ref,d.ref);return typeof l=="function"||b.isPresent?(0,Xb.cloneElement)(d,{ref:e}):null};MF.displayName="Presence";function W3(I){let[G,l]=(0,Xb.useState)(),b=(0,Xb.useRef)({}),d=(0,Xb.useRef)(I),e=(0,Xb.useRef)("none"),t=I?"mounted":"unmounted",[W,n]=a3(t,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return(0,Xb.useEffect)(()=>{let s=Z2(b.current);e.current=W==="mounted"?s:"none"},[W]),VZ(()=>{let s=b.current,N=d.current;if(N!==I){let h=e.current,V=Z2(s);I?n("MOUNT"):V==="none"||s?.display==="none"?n("UNMOUNT"):n(N&&h!==V?"ANIMATION_OUT":"UNMOUNT"),d.current=I}},[I,n]),VZ(()=>{if(G){let s=m=>{let V=Z2(b.current).includes(m.animationName);m.target===G&&V&&(0,X1.flushSync)(()=>n("ANIMATION_END"))},N=m=>{m.target===G&&(e.current=Z2(b.current))};return G.addEventListener("animationstart",N),G.addEventListener("animationcancel",s),G.addEventListener("animationend",s),()=>{G.removeEventListener("animationstart",N),G.removeEventListener("animationcancel",s),G.removeEventListener("animationend",s)}}else n("ANIMATION_END")},[G,n]),{isPresent:["mounted","unmountSuspended"].includes(W),ref:(0,Xb.useCallback)(s=>{s&&(b.current=getComputedStyle(s)),l(s)},[])}}function Z2(I){return I?.animationName||"none"}var Ue=el(IG(),1);function i1({prop:I,defaultProp:G,onChange:l=()=>{}}){let[b,d]=t3({defaultProp:G,onChange:l}),e=I!==void 0,t=e?I:b,W=hZ(l),n=(0,Ue.useCallback)(s=>{if(e){let m=typeof s=="function"?s(I):s;m!==I&&W(m)}else d(s)},[e,I,d,W]);return[t,n]}function t3({defaultProp:I,onChange:G}){let l=(0,Ue.useState)(I),[b]=l,d=(0,Ue.useRef)(b),e=hZ(G);return(0,Ue.useEffect)(()=>{d.current!==b&&(e(b),d.current=b)},[b,d,e]),l}var e2=el(IG(),1);var n3=(0,e2.forwardRef)((I,G)=>(0,e2.createElement)(TZ.span,kc({},I,{ref:G,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...I.style}}))),Q1=n3;var[a2,eYI]=fu("Tooltip",[UF]),OF=UF(),m3="TooltipProvider",N3=700,BF="tooltip.open",[s3,jF]=a2(m3),Y3=I=>{let{__scopeTooltip:G,delayDuration:l=N3,skipDelayDuration:b=300,disableHoverableContent:d=!1,children:e}=I,[t,W]=(0,$l.useState)(!0),n=(0,$l.useRef)(!1),s=(0,$l.useRef)(0);return(0,$l.useEffect)(()=>{let N=s.current;return()=>window.clearTimeout(N)},[]),(0,$l.createElement)(s3,{scope:G,isOpenDelayed:t,delayDuration:l,onOpen:(0,$l.useCallback)(()=>{window.clearTimeout(s.current),W(!1)},[]),onClose:(0,$l.useCallback)(()=>{window.clearTimeout(s.current),s.current=window.setTimeout(()=>W(!0),b)},[b]),isPointerInTransitRef:n,onPointerInTransitChange:(0,$l.useCallback)(N=>{n.current=N},[]),disableHoverableContent:d},e)},KF="Tooltip",[h3,W2]=a2(KF),V3=I=>{let{__scopeTooltip:G,children:l,open:b,defaultOpen:d=!1,onOpenChange:e,disableHoverableContent:t,delayDuration:W}=I,n=jF(KF,I.__scopeTooltip),s=OF(G),[N,m]=(0,$l.useState)(null),h=JE(),V=(0,$l.useRef)(0),X=t??n.disableHoverableContent,p=W??n.delayDuration,F=(0,$l.useRef)(!1),[a=!1,u]=i1({prop:b,defaultProp:d,onChange:E=>{E?(n.onOpen(),document.dispatchEvent(new CustomEvent(BF))):n.onClose(),e?.(E)}}),Q=(0,$l.useMemo)(()=>a?F.current?"delayed-open":"instant-open":"closed",[a]),o=(0,$l.useCallback)(()=>{window.clearTimeout(V.current),F.current=!1,u(!0)},[u]),y=(0,$l.useCallback)(()=>{window.clearTimeout(V.current),u(!1)},[u]),H=(0,$l.useCallback)(()=>{window.clearTimeout(V.current),V.current=window.setTimeout(()=>{F.current=!0,u(!0)},p)},[p,u]);return(0,$l.useEffect)(()=>()=>window.clearTimeout(V.current),[]),(0,$l.createElement)(R1,s,(0,$l.createElement)(h3,{scope:G,contentId:h,open:a,stateAttribute:Q,trigger:N,onTriggerChange:m,onTriggerEnter:(0,$l.useCallback)(()=>{n.isOpenDelayed?H():o()},[n.isOpenDelayed,H,o]),onTriggerLeave:(0,$l.useCallback)(()=>{X?y():window.clearTimeout(V.current)},[y,X]),onOpen:o,onClose:y,disableHoverableContent:X},l))},H1="TooltipTrigger",p3=(0,$l.forwardRef)((I,G)=>{let{__scopeTooltip:l,...b}=I,d=W2(H1,l),e=jF(H1,l),t=OF(l),W=(0,$l.useRef)(null),n=YZ(G,W,d.onTriggerChange),s=(0,$l.useRef)(!1),N=(0,$l.useRef)(!1),m=(0,$l.useCallback)(()=>s.current=!1,[]);return(0,$l.useEffect)(()=>()=>document.removeEventListener("pointerup",m),[m]),(0,$l.createElement)(o1,kc({asChild:!0},t),(0,$l.createElement)(TZ.button,kc({"aria-describedby":d.open?d.contentId:void 0,"data-state":d.stateAttribute},b,{ref:n,onPointerMove:Kd(I.onPointerMove,h=>{h.pointerType!=="touch"&&!N.current&&!e.isPointerInTransitRef.current&&(d.onTriggerEnter(),N.current=!0)}),onPointerLeave:Kd(I.onPointerLeave,()=>{d.onTriggerLeave(),N.current=!1}),onPointerDown:Kd(I.onPointerDown,()=>{s.current=!0,document.addEventListener("pointerup",m,{once:!0})}),onFocus:Kd(I.onFocus,()=>{s.current||d.onOpen()}),onBlur:Kd(I.onBlur,d.onClose),onClick:Kd(I.onClick,d.onClose)})))}),u3="TooltipPortal",[aYI,R3]=a2(u3,{forceMount:void 0});var rh="TooltipContent",o3=(0,$l.forwardRef)((I,G)=>{let l=R3(rh,I.__scopeTooltip),{forceMount:b=l.forceMount,side:d="top",...e}=I,t=W2(rh,I.__scopeTooltip);return(0,$l.createElement)(MF,{present:b||t.open},t.disableHoverableContent?(0,$l.createElement)(r1,kc({side:d},e,{ref:G})):(0,$l.createElement)(F3,kc({side:d},e,{ref:G})))}),F3=(0,$l.forwardRef)((I,G)=>{let l=W2(rh,I.__scopeTooltip),b=jF(rh,I.__scopeTooltip),d=(0,$l.useRef)(null),e=YZ(G,d),[t,W]=(0,$l.useState)(null),{trigger:n,onClose:s}=l,N=d.current,{onPointerInTransitChange:m}=b,h=(0,$l.useCallback)(()=>{W(null),m(!1)},[m]),V=(0,$l.useCallback)((X,p)=>{let F=X.currentTarget,a={x:X.clientX,y:X.clientY},u=i3(a,F.getBoundingClientRect()),Q=Q3(a,u),o=H3(p.getBoundingClientRect()),y=w3([...Q,...o]);W(y),m(!0)},[m]);return(0,$l.useEffect)(()=>()=>h(),[h]),(0,$l.useEffect)(()=>{if(n&&N){let X=F=>V(F,N),p=F=>V(F,n);return n.addEventListener("pointerleave",X),N.addEventListener("pointerleave",p),()=>{n.removeEventListener("pointerleave",X),N.removeEventListener("pointerleave",p)}}},[n,N,V,h]),(0,$l.useEffect)(()=>{if(t){let X=p=>{let F=p.target,a={x:p.clientX,y:p.clientY},u=n?.contains(F)||N?.contains(F),Q=!r3(a,t);u?h():Q&&(h(),s())};return document.addEventListener("pointermove",X),()=>document.removeEventListener("pointermove",X)}},[n,N,t,s,h]),(0,$l.createElement)(r1,kc({},I,{ref:e}))}),[X3,WYI]=a2(KF,{isInside:!1}),r1=(0,$l.forwardRef)((I,G)=>{let{__scopeTooltip:l,children:b,"aria-label":d,onEscapeKeyDown:e,onPointerDownOutside:t,...W}=I,n=W2(rh,l),s=OF(l),{onClose:N}=n;return(0,$l.useEffect)(()=>(document.addEventListener(BF,N),()=>document.removeEventListener(BF,N)),[N]),(0,$l.useEffect)(()=>{if(n.trigger){let m=h=>{let V=h.target;V!=null&&V.contains(n.trigger)&&N()};return window.addEventListener("scroll",m,{capture:!0}),()=>window.removeEventListener("scroll",m,{capture:!0})}},[n.trigger,N]),(0,$l.createElement)(EE,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:e,onPointerDownOutside:t,onFocusOutside:m=>m.preventDefault(),onDismiss:N},(0,$l.createElement)(F1,kc({"data-state":n.stateAttribute},s,W,{ref:G,style:{...W.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"}}),(0,$l.createElement)(wF,null,b),(0,$l.createElement)(X3,{scope:l,isInside:!0},(0,$l.createElement)(Q1,{id:n.contentId,role:"tooltip"},d||b))))});function i3(I,G){let l=Math.abs(G.top-I.y),b=Math.abs(G.bottom-I.y),d=Math.abs(G.right-I.x),e=Math.abs(G.left-I.x);switch(Math.min(l,b,d,e)){case e:return"left";case d:return"right";case l:return"top";case b:return"bottom";default:throw new Error("unreachable")}}function Q3(I,G,l=5){let b=[];switch(G){case"top":b.push({x:I.x-l,y:I.y+l},{x:I.x+l,y:I.y+l});break;case"bottom":b.push({x:I.x-l,y:I.y-l},{x:I.x+l,y:I.y-l});break;case"left":b.push({x:I.x+l,y:I.y-l},{x:I.x+l,y:I.y+l});break;case"right":b.push({x:I.x-l,y:I.y-l},{x:I.x-l,y:I.y+l});break}return b}function H3(I){let{top:G,right:l,bottom:b,left:d}=I;return[{x:d,y:G},{x:l,y:G},{x:l,y:b},{x:d,y:b}]}function r3(I,G){let{x:l,y:b}=I,d=!1;for(let e=0,t=G.length-1;e<G.length;t=e++){let W=G[e].x,n=G[e].y,s=G[t].x,N=G[t].y;n>b!=N>b&&l<(s-W)*(b-n)/(N-n)+W&&(d=!d)}return d}function w3(I){let G=I.slice();return G.sort((l,b)=>l.x<b.x?-1:l.x>b.x?1:l.y<b.y?-1:l.y>b.y?1:0),v3(G)}function v3(I){if(I.length<=1)return I.slice();let G=[];for(let b=0;b<I.length;b++){let d=I[b];for(;G.length>=2;){let e=G[G.length-1],t=G[G.length-2];if((e.x-t.x)*(d.y-t.y)>=(e.y-t.y)*(d.x-t.x))G.pop();else break}G.push(d)}G.pop();let l=[];for(let b=I.length-1;b>=0;b--){let d=I[b];for(;l.length>=2;){let e=l[l.length-1],t=l[l.length-2];if((e.x-t.x)*(d.y-t.y)>=(e.y-t.y)*(d.x-t.x))l.pop();else break}l.push(d)}return l.pop(),G.length===1&&l.length===1&&G[0].x===l[0].x&&G[0].y===l[0].y?G:G.concat(l)}var w1=Y3,v1=V3,E1=p3;var y1=o3;var $n=el(RG());function TF({content:I,children:G}){return(0,$n.jsx)(w1,{delayDuration:100,children:(0,$n.jsxs)(v1,{children:[(0,$n.jsx)(E1,{asChild:!0,children:G}),(0,$n.jsx)(y1,{side:"bottom",className:"select-none rounded-[4px] bg-[#333440] px-[15px] py-[10px] text-[15px] leading-none text-white shadow-[hsl(206_22%_7%_/_35%)_0px_10px_38px_-10px,_hsl(206_22%_7%_/_20%)_0px_10px_20px_-15px] will-change-[transform,opacity] data-[state=delayed-open]:data-[side=bottom]:animate-slideUpAndFade data-[state=delayed-open]:data-[side=left]:animate-slideRightAndFade data-[state=delayed-open]:data-[side=right]:animate-slideLeftAndFade data-[state=delayed-open]:data-[side=top]:animate-slideDownAndFade",children:I})]})})}var dW=el(IG());var ad=el(RG());function fF({tokensCount:I,questions:G,answer:l}){let{settings:b}=gb(),[d,e]=(0,dW.useState)(0),[t,W]=(0,dW.useState)(0);(0,dW.useEffect)(()=>{e(0),W(0)},[G]),(0,dW.useEffect)(()=>{if(b?.provider&&LZ.getConfig(b.provider).needAPIKey){let N=LZ.findModel(b.model,b.provider)?.outputCost;N&&Kp(l.join(`
`),b.model).then(m=>{W(m/1e3*N)})}},[l,b?.model,b?.provider]),(0,dW.useEffect)(()=>{if(b?.provider&&LZ.getConfig(b.provider).needAPIKey){let N=LZ.findModel(b.model,b.provider)?.inputCost;N&&e(m=>m+I/1e3*N)}},[I,b?.model,b?.provider]);let n=d+t;return(0,ad.jsx)("table",{className:"m-0 min-w-full",children:(0,ad.jsxs)("tbody",{children:[(0,ad.jsxs)("tr",{children:[(0,ad.jsx)("td",{className:"whitespace-nowrap py-1 pl-1 pr-3 text-sm font-medium text-white sm:pl-0",children:"Provider"}),(0,ad.jsx)("td",{className:"whitespace-nowrap px-1 py-1 text-sm text-gray-300",children:b?.provider})]}),(0,ad.jsxs)("tr",{children:[(0,ad.jsx)("td",{className:"whitespace-nowrap py-1 pl-1 pr-3 text-sm font-medium text-white sm:pl-0",children:"Model"}),(0,ad.jsx)("td",{className:"whitespace-nowrap px-1 py-1 text-sm text-gray-300",children:b?.model})]}),!!n&&(0,ad.jsxs)("tr",{children:[(0,ad.jsx)("td",{className:"whitespace-nowrap py-1 pl-1 pr-3 text-sm font-medium text-white sm:pl-0",children:"Costs"}),(0,ad.jsx)("td",{className:"whitespace-nowrap px-1 py-1 text-sm text-gray-300",children:E3.format(n)})]})]})})}var E3=new Intl.NumberFormat(navigator.language,{style:"currency",currency:"USD",minimumFractionDigits:4});var fb=el(RG());function SF(I){let[G,l]=(0,Im.useState)(!1),b=(0,Im.useCallback)(async()=>{try{await navigator.clipboard.writeText(I.answerText.join(`
`)+`
Summarized by `+ln)}catch(d){console.log("Could not copy",d);return}l(!0)},[I.answerText]);return(0,Im.useEffect)(()=>{if(G){let d=setTimeout(()=>l(!1),500);return()=>clearTimeout(d)}},[G]),(0,fb.jsxs)("div",{className:(0,g1.default)("flex items-center gap-0.5 p-2",I.className),children:[(0,fb.jsx)(TF,{content:(0,fb.jsx)(fF,{tokensCount:I.tokensCount,questions:I.questions,answer:I.answerText}),children:(0,fb.jsxs)("button",{className:"rounded p-1 hover:bg-gray-200 focus:outline-none focus:ring-1 focus:ring-primary-500 disabled:hover:bg-transparent disabled:focus:ring-0 hover:dark:bg-gray-900",children:[(0,fb.jsx)(a0,{"aria-hidden":"true",className:"h-4 w-4"}),(0,fb.jsx)("span",{className:"sr-only",children:t2.default.i18n.getMessage("info")})]})}),(0,fb.jsxs)("button",{onClick:I.onRetry,className:"rounded p-1 hover:bg-gray-200 focus:outline-none focus:ring-1 focus:ring-primary-500 disabled:hover:bg-transparent disabled:focus:ring-0 hover:dark:bg-gray-900",children:[(0,fb.jsx)(d0,{"aria-hidden":"true",className:"h-4 w-4"}),(0,fb.jsx)("span",{className:"sr-only",children:t2.default.i18n.getMessage("retry")})]}),(0,fb.jsxs)("button",{onClick:b,className:"rounded p-1 hover:bg-gray-200 focus:outline-none focus:ring-1 focus:ring-primary-500 disabled:hover:bg-transparent disabled:focus:ring-0 hover:dark:bg-gray-900",children:[(0,fb.jsx)(Z0,{"aria-hidden":"true",className:"h-4 w-4"}),(0,fb.jsx)("span",{className:"sr-only",children:t2.default.i18n.getMessage("copy")})]})]})}var Be=el(IG());var Me=el(RG());function qF({children:I,onIconClick:G,index:l}){let{blockReferences:b}=(0,Be.useContext)(nZ),[d,e]=(0,Be.useState)(!1),t=(0,Be.useCallback)(()=>{let W=DF(I);G(W,l),e(!0)},[I,l,G]);return(0,Be.useEffect)(()=>{b||e(!1)},[b]),(0,Me.jsx)("li",{children:(0,Me.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,Me.jsx)("div",{children:I}),(0,Me.jsx)("button",{"data-tooltip-target":"tooltip-default",disabled:b,onClick:t,className:`h-5 w-5 text-gray-300 ${b?"":"hover:rounded hover:bg-gray-600"}`,children:d?(0,Me.jsx)(Ti,{style:"flex h-5 w-5 items-center justify-center",showMessage:!1}):(0,Me.jsx)(HR,{className:"h-5 w-5 text-gray-300 "})})]})})}function DF(I){return typeof I=="string"||typeof I=="number"?I.toString():Array.isArray(I)?I.map(DF).join(""):I&&typeof I=="object"&&"props"in I?DF(I.props.children):""}var SG=el(IG()),n2=el(uc());var J1=el(uc()),lm=class{constructor(){this.port=null;this.isConnected=!1;this.listeners=[]}connect(){this.isConnected||(this.port=J1.default.runtime.connect(),this.port.onDisconnect.addListener(this.onDisconnect.bind(this)),this.port.onMessage.addListener(this.onMessage.bind(this)),this.isConnected=!0)}onDisconnect(){this.isConnected=!1,this.port=null}addListener(G){this.listeners.push(G)}removeListener(G){this.listeners=this.listeners.filter(l=>l!==G)}disconnect(){this.isConnected=!1,this.port?.disconnect()}sendMessage(G){this.isConnected||this.connect();try{this.port?.postMessage(G)}catch(l){console.error("Error sending message:",l)}}onMessage(G){for(let l of this.listeners)l(G)}};function _F(I,G){let[l,b]=(0,SG.useState)(null),[d,e]=(0,SG.useState)(null),[t,W]=(0,SG.useState)(0),[n,s]=(0,SG.useState)(0),[N,m]=(0,SG.useState)(0),[h,V]=(0,SG.useState)(!0),[X,p]=(0,SG.useState)(!1),[F,a]=(0,SG.useState)(!1),{setInitialGPTQueryState:u,initialGPTQueryState:Q}=(0,SG.useContext)(nZ),[o,y]=(0,SG.useState)(0),[H,E]=(0,SG.useState)(0),[C,T]=(0,SG.useState)([]),S=(0,SG.useRef)(I),cI=(0,SG.useRef)(new lm),hI=(0,SG.useRef)(void 0);(0,SG.useEffect)(()=>{let yI=cI.current;return yI.connect(),()=>{yI.disconnect()}},[]),(0,SG.useEffect)(()=>{Q&&(b(null),e(null),W(0),m(0),V(!0),p(!1),y(0),a(!1),s(0),T([]),u&&u(!1))},[Q,u]);let WI=(0,SG.useCallback)(yI=>{e(null),Promise.all([Kp(S.current[t])]).then(([eI])=>{E(eI),cI.current.sendMessage({type:yI?"summarize-retry":"summarize",question:za(S.current[t]),systemMessage:G}),hI.current=setTimeout(()=>{e({message:n2.default.i18n.getMessage("timeoutError")})},1e4)}).catch(eI=>{e(typeof eI=="string"?{message:eI}:{message:eI.message,context:eI?.cause})})},[t,G]),VI=(0,SG.useCallback)(()=>{y(yI=>{let eI=yI+1,HI=I.slice(t);return dH(HI,eI).then(YI=>{let $=S.current.slice(0,t).concat(YI);S.current=$,cI.current.sendMessage({type:"summarize",question:za($[t]),systemMessage:G})}).catch(YI=>{e(YI.message)}),eI})},[t,I,G]),sI=(0,SG.useCallback)(yI=>{switch(clearTimeout(hI.current),yI.type){case"increaseTolerance":{VI();break}case"answer":{b(yI.data),T(eI=>(eI[t]=yI.data.text,eI));break}case"error":{e({message:yI.data,context:yI?.context});break}case"done":{n2.default.storage.local.get("summarizeFullText").then(eI=>{eI.summarizeFullText&&p(!0)}),s(m0(ZH(S.current),za(S.current[t]))),V(!1),a(!0);break}}},[t,VI]);(0,SG.useEffect)(()=>{let yI=cI.current;return yI.addListener(sI),()=>{yI.removeListener(sI)}},[sI]),(0,SG.useEffect)(()=>{WI()},[WI,N]);let ZI=(0,SG.useCallback)(()=>{b(null),V(!0),W(yI=>yI+1),a(!1)},[]);(0,SG.useEffect)(()=>{X&&F&&!d&&t<S.current.length-1&&ZI()},[X,F,d,I,t,ZI]);let dI=(0,SG.useCallback)(()=>{p(!0),ZI()},[ZI]),pI=(0,SG.useCallback)(async()=>{b(null),V(!0),e(null),clearTimeout(hI.current),T(yI=>yI.slice(0,-1)),await n2.default.runtime.sendMessage({type:"RETRY",to:"background",question:za(S.current[t]),systemMessage:G}),m(yI=>yI+1)},[t,G]);return(0,SG.useEffect)(()=>{let yI=async()=>{d&&uh.isAuthError(d.message)&&pI()};return window.addEventListener("focus",yI),()=>{window.removeEventListener("focus",yI)}},[d,pI]),{data:l,error:d,isLoading:h,retry:pI,retryCount:N,next:ZI,nextAll:dI,currentIndex:t,currentProgress:n,pageResult:C,tokensCount:H,questionChunksRef:S}}var Wd=el(IG()),PF=el(uc());var y3=I=>{let[G,l]=(0,Wd.useState)(""),b=(0,Wd.useRef)(""),{setBlockReferences:d}=(0,Wd.useContext)(nZ),e=(0,Wd.useRef)(new lm);(0,Wd.useEffect)(()=>{let n=e.current;return n.connect(),()=>{n.disconnect()}},[]),(0,Wd.useEffect)(()=>{b.current=G},[G]);let t=(n,s)=>{try{d&&d(!0),e.current.sendMessage({type:"summarize",question:`Give me the exact quote in the text which confirms the following statement: '${n}'. The text is: ${I[s].content} Output format: "Quote"`,systemMessage:""})}catch(N){d&&d(!1),console.error(N)}},W=(0,Wd.useCallback)(async n=>{switch(n.type){case"answer":{l(n.data.text);break}case"done":{let[s]=await PF.default.tabs.query({active:!0,currentWindow:!0});s.id&&await PF.default.tabs.sendMessage(s.id,{type:"MARK_CONTENT",to:"content-script",content:{data:{text:g3(b.current)}}}),d&&d(!1);break}case"error":{d&&d(!1),console.log(n.data);break}}},[d]);return(0,Wd.useEffect)(()=>{let n=e.current;return n.addListener(W),()=>{n.removeListener(W)}},[W]),{handleIconClick:t}};function g3(I){return I.replace(/The\sexact\squote.*is:?/giu,"")}var C1=y3;var UG=el(RG());function $F({questionChunks:I,systemMessage:G,containerRef:l,title:b}){let d=_F(I,G),e=(0,DZ.useRef)(null),{interruptScroll:t,setInterruptScroll:W}=Vh(l),{settings:n}=gb(),[s,N]=(0,DZ.useState)(!1),{handleIconClick:m}=C1(d.questionChunksRef.current),h=()=>{e.current?.scrollIntoView()};return(0,DZ.useEffect)(()=>{t||h()},[d.isLoading,t]),(0,DZ.useEffect)(()=>{n?.provider!=="api"?N(!0):N(!1)},[n]),(0,DZ.useEffect)(()=>{if(!d.isLoading&&!d.error)J3();else if(d.error){let V=uh.formatError(d.error.message,n.provider,{retryCount:d.retryCount,context:d.error.context});Jb.sendErrorNotification({element:(0,UG.jsxs)("div",{className:"flex grow gap-2",children:[V,(0,UG.jsx)("div",{className:"grow"}),(0,UG.jsx)("span",{children:(0,UG.jsx)("a",{href:"https://calmai.net/status",className:"underline",target:"_blank",rel:"noreferrer",children:"System Status"})})]}),position:"top-center",id:"gpt-error"})}},[d.isLoading,d.error,d.retryCount]),(0,DZ.useEffect)(()=>{d.error||yb.remove("gpt-error")},[d.error]),d.error&&uh.isAuthError(d.error.message)?null:(0,UG.jsxs)("div",{id:"gpt-answer",dir:"auto",children:[d.data&&(0,UG.jsxs)(UG.Fragment,{children:[(0,UG.jsx)(SF,{className:"float-right -mr-1 -mt-2",messageId:d.data.messageId,conversationId:d.data.conversationId,answerText:d.pageResult,questions:I,tokensCount:d.tokensCount,onRetry:()=>{W(!1),d.retry()}}),b&&(0,UG.jsxs)("h1",{className:"mb-3 flex space-x-1 text-base",dir:"auto",children:[(0,UG.jsx)("span",{className:"truncate",children:b||""})," ",(0,UG.jsx)("span",{children:Gm.default.i18n.getMessage("summary")})]})]}),(0,UG.jsx)(A1.ErrorBoundary,{FallbackComponent:Rh,children:(0,UG.jsx)("div",{dir:"auto",children:d.pageResult.map((V,X)=>(0,UG.jsx)(FE,{rehypePlugins:[[Tn,{detect:!0}]],components:{p:"span",li(p){return(0,UG.jsx)(UG.Fragment,{children:s?(0,UG.jsx)("li",{children:p.children}):(0,UG.jsx)(qF,{onIconClick:m,index:X,children:p.children})})}},children:V},"summary"+X))})}),!d.data&&d.isLoading&&!d.error&&(0,UG.jsx)("span",{role:"status",className:"animate-pulse text-[#b6b8ba]",children:Gm.default.i18n.getMessage("waitingForChatGPTResponse")}),d.error&&(0,UG.jsx)("div",{role:"status",children:(0,UG.jsx)("div",{children:(0,UG.jsx)("button",{type:"button",onClick:()=>{W(!1),d.retry()},className:"rounded-full bg-primary-600 px-2.5 py-1 text-sm font-semibold text-white shadow-sm hover:bg-primary-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600",children:"Retry"})})}),!d.isLoading&&!d.error&&(0,UG.jsx)(UG.Fragment,{children:d.currentProgress<100&&(0,UG.jsxs)(UG.Fragment,{children:[(0,UG.jsxs)("div",{className:"flex justify-end",children:[Gm.default.i18n.getMessage("summarized")," ",d.currentProgress,"%"]}),(0,UG.jsxs)("div",{className:"mt-2 flex justify-end gap-x-2",children:[(0,UG.jsx)("button",{className:"rounded-full bg-primary-600 px-2.5 py-1 text-sm font-semibold text-white shadow-sm hover:bg-primary-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600",onClick:()=>{W(!1),d.next()},children:Gm.default.i18n.getMessage("summarizeNextBatch")}),(0,UG.jsx)("button",{className:"rounded-full bg-primary-600 px-2.5 py-1 text-sm font-semibold text-white shadow-sm hover:bg-primary-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600",onClick:()=>{W(!1),d.nextAll()},children:Gm.default.i18n.getMessage("summarizeAll")})]})]})}),(0,UG.jsx)("div",{ref:e})]})}async function J3(){Jb.addOneTimeAnnouncement({element:(0,UG.jsx)(iF,{}),position:"bottom-center",id:"rate"})}var cm=el(RG());function IX({parentRef:I}){let{settings:G}=gb(),l=G?.selectedLanguage,b=ld(l?`summarizeQueryKey-${l}`:null,()=>{if(l)return window.textToSummarize?co(l,window.textToSummarize):Go(l)},{revalidateOnFocus:!1});return(0,cm.jsxs)("div",{className:"prose prose-sm prose-primary max-w-none break-words px-4 pb-4 pt-6 dark:prose-invert",children:[b.isLoading&&(0,cm.jsx)("p",{className:"animate-pulse text-[#b6b8ba]",children:L1.default.i18n.getMessage("extractingPageContent")}),b.error&&(0,cm.jsx)("p",{children:b.error.message}),b.data&&(0,cm.jsx)($F,{questionChunks:b.data.questionChunks,systemMessage:b.data.systemMessage,title:b.data.title,containerRef:I})]})}var k1=el(RF());var wh=el(uc());var Sb=el(RG());function lX(){let{data:I,error:G,isLoading:l}=ld("getSubtitles",A3),b=d=>{d.preventDefault();let e=d.currentTarget.getAttribute("href");e&&I&&wh.default.runtime.sendMessage({type:"SEEK_TO_TIME",tabId:I.tabId,link:e,to:"background"})};return(0,Sb.jsxs)(Sb.Fragment,{children:[l&&(0,Sb.jsx)("p",{className:"animate-pulse px-4 pb-4 pt-6 text-sm text-[#b6b8ba]",children:wh.default.i18n.getMessage("extractingPageContent")}),G&&(0,Sb.jsx)("p",{className:"text-sm",children:G.message}),I&&(0,Sb.jsx)("div",{className:"prose prose-sm prose-primary max-w-none overflow-auto break-words px-4 pb-4 pt-6 dark:prose-invert",dir:"auto",children:(0,Sb.jsx)(k1.ErrorBoundary,{FallbackComponent:Rh,children:(0,Sb.jsx)("div",{children:I.subtitles.map((d,e)=>(0,Sb.jsxs)("div",{className:"flex gap-2",children:[(0,Sb.jsx)("a",{href:d.url,onClick:b,children:(0,Sb.jsxs)("span",{children:[d.startTime," - ",d.endTime]})}),(0,Sb.jsx)("span",{style:{display:"block"},children:d.text})]},e))})})})]})}function C3(I,G){let l=new DOMParser().parseFromString(I,"text/xml");return Array.from(l.getElementsByTagName("text")).map(b=>{let d=b.textContent,e=parseFloat(b.getAttribute("start")),t=parseFloat(b.getAttribute("dur")),W=e+t,n=Math.floor(e/3600),s=Math.floor(e%3600/60),N=Math.floor(e%60),m=Math.floor(W/3600),h=Math.floor(W%3600/60),V=Math.floor(W%60),X=`${n<10?"0":""}${n}:${s<10?"0":""}${s}:${N<10?"0":""}${N}`,p=`${m<10?"0":""}${m}:${h<10?"0":""}${h}:${V<10?"0":""}${V}`;return{url:`https://www.youtube.com/watch?v=${G}&t=${Math.floor(e)}`,startTime:X,endTime:p,text:d}})}async function A3(){let[I]=await wh.default.tabs.query({active:!0,currentWindow:!0});if(I.id){let G=await wh.default.tabs.sendMessage(I.id,{type:"GET_PAGE_SUBTITLES",to:"content-script"});if(G)return{subtitles:C3(G.text,G.videoId),tabId:I.id}}throw Error("Could not get transcript of the tab")}var x1=el(IG()),z1=el(uc());var qZ=el(RG());function L3(){(0,x1.useEffect)(()=>{Jb.addOneTimeAnnouncement({element:(0,qZ.jsxs)("span",{children:["\u{1F4A1} ",(0,qZ.jsx)("b",{children:"New!"})," summarize any PDF by moving it into your browser"]}),position:"bottom-center",id:"pdf-feature"}),k3()},[]),Jb.showOneTimeAnnouncements()}async function k3(){let I="question-upgrade";(await Jb.getBackgroundAnnouncementsIds()).includes(I)&&((await z1.default.storage.local.get("question"))?.question&&Jb.addOneTimeAnnouncement({element:(0,qZ.jsxs)("div",{children:[(0,qZ.jsxs)("span",{className:"text-sm",children:[(0,qZ.jsx)("b",{children:"New!"})," We've enhanced our question template to provide you with better results. Click 'Reset Now' to apply these improvements and enhance your experience."]}),(0,qZ.jsx)("div",{className:"mt-2 flex gap-1",children:(0,qZ.jsx)(uE,{id:I})})]}),position:"bottom-center",id:I}),await Jb.removeBackgroundAnnouncement(I))}var U1=L3;var vh=el(IG());function GX(I){let G=(0,vh.useRef)(I);(0,vh.useEffect)(()=>{G.current=I},[I]),(0,vh.useEffect)(()=>{let l=b=>G.current(b);return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l)}})}var M1=el(IG());function cX(){let{cache:I,mutate:G}=In(),{settings:l}=gb(),b=l?.selectedLanguage;(0,M1.useEffect)(()=>{let d=e=>{e.data.type==="SUMMARIZE_SELECTED_TEXT"&&(window.textToSummarize=e.data.data,b&&(I.delete(`summarizeQueryKey-${b}`),G(`summarizeQueryKey-${b}`)))};return window.addEventListener("message",d),()=>window.removeEventListener("message",d)},[I,b,G])}var wG=el(RG());function ZX(){cX(),ye(),GX(p=>{p.key==="Escape"&&window.top?.postMessage({type:"CLOSE_IFRAME",runtimeId:qc.default.runtime.id},"*")});let{ref:I,isDragging:G}=CQ(),l=window!==window.parent,[b,d]=(0,Sd.useState)(0),e=x3(),t=(0,Sd.useMemo)(()=>qc.default.runtime.id!==atob("Y2JnZWNmbGxmaG1tbmtubWFta2VqYWRqbW5tcGZqbXA=")&&qc.default.runtime.id!==atob("ZWpmY2JlaG1vamZmZXBsaWdnYWVwa2ZqaW1rcGJwZWg="),[]),{settings:W}=gb(),n=!!W?.question.includes("{{SELECTED_LANGUAGE}}"),s=U3(),N=(0,Sd.useRef)(null),[m,h]=(0,Sd.useState)(!1),[V,X]=(0,Sd.useState)(!1);return U1(),(0,wG.jsxs)("div",{className:"flex h-full flex-col dark:bg-[#333440] dark:text-gray-50",children:[(0,wG.jsxs)("div",{ref:I,className:(0,dX.default)("sticky top-0 z-50 flex flex-row items-center bg-[#343541] px-4 py-3 text-[#d9d9e3] dark:border-b dark:bg-[#333440] dark:text-[#eaeaea]",{"cursor-grab":!G,"cursor-grabbing":G}),children:[(0,wG.jsx)(SR,{className:"mr-1.5 h-5 w-5 rounded-sm"}),(0,wG.jsx)("p",{className:"m-0 ml-1 text-base",children:qc.default.i18n.getMessage("appName")}),(0,wG.jsx)("div",{className:"grow"}),(0,wG.jsxs)("button",{className:"ml-1 cursor-pointer rounded leading-[0] hover:text-gray-50 focus:outline-none focus:ring-1 focus:ring-primary-500",onClick:M3,children:[(0,wG.jsx)(vR,{"aria-hidden":"true",className:"h-4 w-4"}),(0,wG.jsx)("span",{className:"sr-only",children:qc.default.i18n.getMessage("options")})]}),l&&(0,wG.jsxs)("button",{className:"ml-2 cursor-pointer rounded leading-[0] hover:text-gray-50 focus:outline-none focus:ring-1 focus:ring-green-500",onClick:()=>{window.top?.postMessage({type:"CLOSE_IFRAME",runtimeId:qc.default.runtime.id},"*")},children:[(0,wG.jsx)(ER,{"aria-hidden":"true",className:"h-7 w-7"}),(0,wG.jsx)("span",{className:"sr-only",children:qc.default.i18n.getMessage("close")})]})]}),t||e.isLoading?(0,wG.jsxs)("div",{className:"z-10 flex grow animate-bounce items-center justify-center",children:[(0,wG.jsx)(e0,{className:"h-7 w-7 text-gray-800 dark:text-gray-200"}),(0,wG.jsx)("span",{className:"sr-only",children:qc.default.i18n.getMessage("loading")})]}):e.data?(0,wG.jsx)(Qe.Group,{onChange:d,selectedIndex:b,children:(0,wG.jsxs)(nZ.Provider,{value:{initialGPTQueryState:m,setInitialGPTQueryState:h,blockReferences:V,setBlockReferences:X},children:[(0,wG.jsxs)("div",{className:" sticky top-0 flex items-center justify-between border-gray-200 bg-white pr-4 shadow-md dark:border-b dark:bg-[#333440] dark:shadow-none",children:[(0,wG.jsxs)(Qe.List,{as:"nav",className:"-mb-px flex space-x-8 px-4",children:[(0,wG.jsx)(bX,{children:qc.default.i18n.getMessage("summarize")}),(0,wG.jsx)(bX,{children:qc.default.i18n.getMessage("askQuestion")}),s.data&&(0,wG.jsx)(bX,{children:qc.default.i18n.getMessage("originalTranscript")})]}),n&&(b===0||b===1)&&(0,wG.jsx)(MQ,{})]}),(0,wG.jsx)(qR,{position:"top"}),(0,wG.jsx)("div",{className:"h-full overflow-y-auto",ref:N,children:(0,wG.jsxs)(Qe.Panels,{as:Sd.Fragment,children:[(0,wG.jsx)(Qe.Panel,{tabIndex:-1,unmount:!1,children:b===0&&(0,wG.jsx)(IX,{parentRef:N})}),(0,wG.jsx)(Qe.Panel,{tabIndex:-1,unmount:!1,children:b===1&&(0,wG.jsx)(uF,{})}),s.data&&(0,wG.jsx)(Qe.Panel,{tabIndex:-1,unmount:!1,children:b===2&&(0,wG.jsx)(lX,{})})]})}),(0,wG.jsx)(qR,{position:"bottom"})]})}):(0,wG.jsx)("div",{className:"prose prose-primary flex grow flex-col justify-center dark:prose-invert",children:(0,wG.jsx)("p",{className:"px-2 text-center",children:(0,wG.jsx)("span",{dangerouslySetInnerHTML:{__html:qc.default.i18n.getMessage("refreshOpenAILogin").replaceAll("<a>",`<a href="${AZ.endpoint}" target="_blank" rel="noreferrer">`)}})})}),(0,wG.jsxs)("div",{id:"tooltip-default",role:"tooltip",className:"tooltip invisible absolute z-10 rounded-lg bg-gray-900 px-3 py-2 text-sm font-medium text-white opacity-0 shadow-sm transition-opacity duration-300 dark:bg-gray-700",children:["Beta: Factcheck + jump to source",(0,wG.jsx)("div",{className:"tooltip-arrow","data-popper-arrow":!0})]})]})}function bX({children:I,disabled:G=!1}){return(0,wG.jsx)(Qe,{as:Sd.Fragment,children:({selected:l})=>(0,wG.jsx)("button",{onClick:function(d){if(yb.remove(),G){d.preventDefault();return}requestAnimationFrame(()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()})},className:(0,dX.default)(l?"border-primary-500 text-primary-500":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700","whitespace-nowrap border-b-2 px-1 py-3 text-sm font-medium focus:outline-none focus:ring focus:ring-primary-500 dark:text-gray-50 dark:hover:text-gray-300"),"aria-current":l?"page":void 0,children:I})})}function x3(){return ld("accessToken",z3,{shouldRetryOnError:!1})}function z3(){return bp().then(I=>I.provider==="web"?qc.default.runtime.sendMessage({type:"GET_ACCESS_TOKEN",to:"background"}).then(G=>G):!0)}function U3(){return ld("isYoutube",async()=>{let[I]=await qc.default.tabs.query({active:!0,currentWindow:!0});return Up(I.url||"")})}async function M3(){let I=qc.default.runtime.getURL("options/index.html"),[G]=await qc.default.tabs.query({url:I});G&&G.id&&G.windowId?(await Promise.all([qc.default.windows.update(G.windowId,{focused:!0}),qc.default.tabs.update(G.id,{active:!0})]),window.close()):await qc.default.tabs.create({url:I})}var O1=el(RG());window.top?.postMessage({type:"READY",runtimeId:m2.default.runtime.id},"*");window.addEventListener("message",I=>{if(I.data.type==="START"){I.data.data&&(window.textToSummarize=I.data.data);let G=document.getElementById("app");if(!G)throw new Error("Failed to find the root element");(0,B1.createRoot)(G).render((0,O1.jsx)(ZX,{}))}});addEventListener("error",I=>{m2.default.runtime.sendMessage({type:"REPORT_ERROR",errorEvent:I,to:"background"})});m2.default.runtime.onMessage.addListener((I,G,l)=>{if(I?.to!=="popup")return!1;switch(I.type){case"ARKOSE_TOKEN_REFRESH":return v0(I.data.retryCount,I.data.arkoseDx).then(b=>{l(b)}),!0;case"GET_PROOF_TOKEN":{l(E0(I.data.seed,I.data.difficulty));break}case"GET_CHAT_REQ_TOKEN":{l(y0());break}}return!1});
/*! Bundled license information:

js-sha3/src/sha3.js:
  (**
   * [js-sha3]{@link https://github.com/emn178/js-sha3}
   *
   * @version 0.9.3
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2015-2023
   * @license MIT
   *)

is-buffer/index.js:
  (*!
   * Determine if an object is a Buffer
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)

react-is/cjs/react-is.production.min.js:
  (**
   * @license React
   * react-is.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

@huggingface/transformers/dist/transformers.js:
  (*!
   * ONNX Runtime Web v1.21.0-dev.20250206-d981b153d3
   * Copyright (c) Microsoft Corporation. All rights reserved.
   * Licensed under the MIT License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2019 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (*!*****************************!*\
    !*** ./src/transformers.js ***!
    \*****************************)
*/
